<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>GDB (xrefs): /home/stan/gdb/src/gdb/solib-som.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">GDB (xrefs)
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">/home/stan/gdb/src/gdb/solib-som.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="solib-som_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* Handle SOM shared libraries.</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">   Copyright (C) 2004-2013 Free Software Foundation, Inc.</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">   This file is part of GDB.</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">   This program is free software; you can redistribute it and/or modify</span>
<a name="l00008"></a>00008 <span class="comment">   it under the terms of the GNU General Public License as published by</span>
<a name="l00009"></a>00009 <span class="comment">   the Free Software Foundation; either version 3 of the License, or</span>
<a name="l00010"></a>00010 <span class="comment">   (at your option) any later version.</span>
<a name="l00011"></a>00011 <span class="comment"></span>
<a name="l00012"></a>00012 <span class="comment">   This program is distributed in the hope that it will be useful,</span>
<a name="l00013"></a>00013 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00014"></a>00014 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00015"></a>00015 <span class="comment">   GNU General Public License for more details.</span>
<a name="l00016"></a>00016 <span class="comment"></span>
<a name="l00017"></a>00017 <span class="comment">   You should have received a copy of the GNU General Public License</span>
<a name="l00018"></a>00018 <span class="comment">   along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.  */</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="defs_8h.html">defs.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="symtab_8h.html">symtab.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;bfd.h&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="symfile_8h.html">symfile.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="objfiles_8h.html">objfiles.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="gdbcore_8h.html">gdbcore.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="target_8h.html">target.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="inferior_8h.html">inferior.h</a>&quot;</span>
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="hppa-tdep_8h.html">hppa-tdep.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="solist_8h.html">solist.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="solib_8h.html">solib.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="solib-som_8h.html">solib-som.h</a>&quot;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 <span class="preprocessor">#undef SOLIB_SOM_DBG </span>
<a name="l00037"></a>00037 <span class="preprocessor"></span>
<a name="l00038"></a>00038 <span class="comment">/* These ought to be defined in some public interface, but aren&#39;t.  They</span>
<a name="l00039"></a>00039 <span class="comment">   define the meaning of the various bits in the distinguished __dld_flags</span>
<a name="l00040"></a>00040 <span class="comment">   variable that is declared in every debuggable a.out on HP-UX, and that</span>
<a name="l00041"></a>00041 <span class="comment">   is shared between the debugger and the dynamic linker.  */</span>
<a name="l00042"></a>00042 
<a name="l00043"></a><a class="code" href="solib-som_8c.html#a5c83d618401501f2a206aa77824efed7">00043</a> <span class="preprocessor">#define DLD_FLAGS_MAPPRIVATE    0x1</span>
<a name="l00044"></a><a class="code" href="solib-som_8c.html#ad154015a847547b8de0636a5def27a95">00044</a> <span class="preprocessor"></span><span class="preprocessor">#define DLD_FLAGS_HOOKVALID     0x2</span>
<a name="l00045"></a><a class="code" href="solib-som_8c.html#a8522cf8ea445d26130f9017804d2de09">00045</a> <span class="preprocessor"></span><span class="preprocessor">#define DLD_FLAGS_LISTVALID     0x4</span>
<a name="l00046"></a><a class="code" href="solib-som_8c.html#a264115a228feed27580322dc299418f7">00046</a> <span class="preprocessor"></span><span class="preprocessor">#define DLD_FLAGS_BOR_ENABLE    0x8</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span>
<a name="l00048"></a>00048 <span class="keyword">struct </span><a class="code" href="structlm__info.html">lm_info</a>
<a name="l00049"></a>00049   {
<a name="l00050"></a>00050     <span class="comment">/* Version of this structure (it is expected to change again in</span>
<a name="l00051"></a>00051 <span class="comment">       hpux10).  */</span>
<a name="l00052"></a><a class="code" href="structlm__info.html#a9a1169b41d1bb1fd22b56dccfa334551">00052</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structlm__info.html#a9a1169b41d1bb1fd22b56dccfa334551">struct_version</a>;
<a name="l00053"></a>00053 
<a name="l00054"></a>00054     <span class="comment">/* Binding mode for this library.  */</span>
<a name="l00055"></a><a class="code" href="structlm__info.html#a0c0b34053c7dd3fee618e6f1e0c4701c">00055</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structlm__info.html#a0c0b34053c7dd3fee618e6f1e0c4701c">bind_mode</a>;
<a name="l00056"></a>00056 
<a name="l00057"></a>00057     <span class="comment">/* Version of this library.  */</span>
<a name="l00058"></a><a class="code" href="structlm__info.html#a264cbeaef12f0e2a5c366b494cc0f11f">00058</a>     <span class="keywordtype">short</span> <a class="code" href="structlm__info.html#a264cbeaef12f0e2a5c366b494cc0f11f">library_version</a>;
<a name="l00059"></a>00059 
<a name="l00060"></a>00060     <span class="comment">/* Start of text address,</span>
<a name="l00061"></a>00061 <span class="comment">       link-time text location (length of text area),</span>
<a name="l00062"></a>00062 <span class="comment">       end of text address.  */</span>
<a name="l00063"></a>00063     <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> <a class="code" href="structlm__info.html#ae00d156f2af9fd69803b6dd7688efacc">text_addr</a>;
<a name="l00064"></a><a class="code" href="structlm__info.html#a338e850e765caa5fbf5613116e497964">00064</a>     <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> <a class="code" href="structlm__info.html#a338e850e765caa5fbf5613116e497964">text_link_addr</a>;
<a name="l00065"></a><a class="code" href="structlm__info.html#adf330cc135b8331b1ba0185f4cea1705">00065</a>     <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> <a class="code" href="structlm__info.html#adf330cc135b8331b1ba0185f4cea1705">text_end</a>;
<a name="l00066"></a>00066 
<a name="l00067"></a>00067     <span class="comment">/* Start of data, start of bss and end of data.  */</span>
<a name="l00068"></a>00068     <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> <a class="code" href="structlm__info.html#a125d34e728ec8f024c31bf7777838119">data_start</a>;
<a name="l00069"></a><a class="code" href="structlm__info.html#aa9403fdcaf6e8b1fd7cd5097845c579b">00069</a>     <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> <a class="code" href="structlm__info.html#aa9403fdcaf6e8b1fd7cd5097845c579b">bss_start</a>;
<a name="l00070"></a><a class="code" href="structlm__info.html#a7eea420b74d811bb2c6832ab089bfcd2">00070</a>     <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> <a class="code" href="structlm__info.html#a7eea420b74d811bb2c6832ab089bfcd2">data_end</a>;
<a name="l00071"></a>00071 
<a name="l00072"></a>00072     <span class="comment">/* Value of linkage pointer (%r19).  */</span>
<a name="l00073"></a>00073     <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> <a class="code" href="structlm__info.html#a75cb2ce292e8a677fb3297c96370dd5c">got_value</a>;
<a name="l00074"></a>00074 
<a name="l00075"></a>00075     <span class="comment">/* Address in target of offset from thread-local register of</span>
<a name="l00076"></a>00076 <span class="comment">       start of this thread&#39;s data.  I.e., the first thread-local</span>
<a name="l00077"></a>00077 <span class="comment">       variable in this shared library starts at *(tsd_start_addr)</span>
<a name="l00078"></a>00078 <span class="comment">       from that area pointed to by cr27 (mpsfu_hi).</span>
<a name="l00079"></a>00079 <span class="comment">      </span>
<a name="l00080"></a>00080 <span class="comment">       We do the indirection as soon as we read it, so from then</span>
<a name="l00081"></a>00081 <span class="comment">       on it&#39;s the offset itself.  */</span>
<a name="l00082"></a><a class="code" href="structlm__info.html#acb351893ee21de082e9521bd2a4493b7">00082</a>     <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> <a class="code" href="structlm__info.html#acb351893ee21de082e9521bd2a4493b7">tsd_start_addr</a>;
<a name="l00083"></a>00083 
<a name="l00084"></a>00084     <span class="comment">/* Address of the link map entry in the loader.  */</span>
<a name="l00085"></a>00085     <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> <a class="code" href="structlm__info.html#a77b7677e3b3e86706a36bda2b9bd557c">lm_addr</a>;
<a name="l00086"></a>00086   };
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 <span class="comment">/* These addresses should be filled in by som_solib_create_inferior_hook.</span>
<a name="l00089"></a>00089 <span class="comment">   They are also used elsewhere in this module.  */</span>
<a name="l00090"></a>00090 
<a name="l00091"></a><a class="code" href="structaddr__and__unwind__t.html">00091</a> <span class="keyword">typedef</span> <span class="keyword">struct</span>
<a name="l00092"></a>00092   {
<a name="l00093"></a><a class="code" href="structaddr__and__unwind__t.html#af711af76f88121efb77c87aa9ba2810b">00093</a>     <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> <a class="code" href="structaddr__and__unwind__t.html#af711af76f88121efb77c87aa9ba2810b">address</a>;
<a name="l00094"></a><a class="code" href="structaddr__and__unwind__t.html#a25e30a78b109f859ea26309cc5cd51a0">00094</a>     <span class="keyword">struct </span><a class="code" href="structunwind__table__entry.html">unwind_table_entry</a> *<a class="code" href="structaddr__and__unwind__t.html#a25e30a78b109f859ea26309cc5cd51a0">unwind</a>;
<a name="l00095"></a>00095   }
<a name="l00096"></a>00096 <a class="code" href="structaddr__and__unwind__t.html">addr_and_unwind_t</a>;
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 <span class="comment">/* When adding fields, be sure to clear them in _initialize_som_solib.  */</span>
<a name="l00099"></a>00099 <span class="keyword">static</span> <span class="keyword">struct</span>
<a name="l00100"></a>00100   {
<a name="l00101"></a><a class="code" href="solib-som_8c.html#a3ba613497814aa75f4d53254ddeaadf6">00101</a>     <span class="keywordtype">int</span> <a class="code" href="solib-som_8c.html#a3ba613497814aa75f4d53254ddeaadf6">is_valid</a>;
<a name="l00102"></a><a class="code" href="solib-som_8c.html#ac56ba4d3509cdb562f90c7c986e7896e">00102</a>     <a class="code" href="structaddr__and__unwind__t.html">addr_and_unwind_t</a> <a class="code" href="solib-som_8c.html#ac56ba4d3509cdb562f90c7c986e7896e">hook</a>;
<a name="l00103"></a><a class="code" href="solib-som_8c.html#a072406592d91139345cc08568ba7ead0">00103</a>     <a class="code" href="structaddr__and__unwind__t.html">addr_and_unwind_t</a> <a class="code" href="solib-som_8c.html#a072406592d91139345cc08568ba7ead0">hook_stub</a>;
<a name="l00104"></a><a class="code" href="solib-som_8c.html#a5c9b72ffab5c002770d8d10d42a3ed46">00104</a>     <a class="code" href="structaddr__and__unwind__t.html">addr_and_unwind_t</a> <a class="code" href="solib-som_8c.html#a5c9b72ffab5c002770d8d10d42a3ed46">load</a>;
<a name="l00105"></a><a class="code" href="solib-som_8c.html#ad0bc9d41bd971d2cc7ef4d2dc26a5657">00105</a>     <a class="code" href="structaddr__and__unwind__t.html">addr_and_unwind_t</a> <a class="code" href="solib-som_8c.html#ad0bc9d41bd971d2cc7ef4d2dc26a5657">load_stub</a>;
<a name="l00106"></a><a class="code" href="solib-som_8c.html#a0c864320c3763fc53cde90e35fdaf17e">00106</a>     <a class="code" href="structaddr__and__unwind__t.html">addr_and_unwind_t</a> <a class="code" href="solib-som_8c.html#a0c864320c3763fc53cde90e35fdaf17e">unload</a>;
<a name="l00107"></a><a class="code" href="solib-som_8c.html#a026330ec392d6588595c675da3c467a7">00107</a>     <a class="code" href="structaddr__and__unwind__t.html">addr_and_unwind_t</a> <a class="code" href="solib-som_8c.html#a026330ec392d6588595c675da3c467a7">unload2</a>;
<a name="l00108"></a><a class="code" href="solib-som_8c.html#a71070e773c696d36c86ffc69d85a4eaa">00108</a>     <a class="code" href="structaddr__and__unwind__t.html">addr_and_unwind_t</a> <a class="code" href="solib-som_8c.html#a71070e773c696d36c86ffc69d85a4eaa">unload_stub</a>;
<a name="l00109"></a>00109   }
<a name="l00110"></a>00110 <a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>;
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00113"></a><a class="code" href="solib-som_8c.html#a102db1f36ead7b3a21453e645765d20a">00113</a> <a class="code" href="solib-som_8c.html#a102db1f36ead7b3a21453e645765d20a">som_relocate_section_addresses</a> (<span class="keyword">struct</span> <a class="code" href="structso__list.html">so_list</a> *so,
<a name="l00114"></a>00114                                 <span class="keyword">struct</span> <a class="code" href="structtarget__section.html">target_section</a> *sec)
<a name="l00115"></a>00115 {
<a name="l00116"></a>00116   flagword aflag = bfd_get_section_flags(so-&gt;<a class="code" href="structso__list.html#a085f5e5f0ed4f1517849da60cff8001d">abfd</a>, sec-&gt;<a class="code" href="structtarget__section.html#a3eeadf384747cb6a6e8cbb07db089723">the_bfd_section</a>);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118   <span class="keywordflow">if</span> (aflag &amp; SEC_CODE)
<a name="l00119"></a>00119     {
<a name="l00120"></a>00120       sec-&gt;<a class="code" href="structtarget__section.html#a3e4564d6ceb39f962f70bb7afdd3b260">addr</a>    += so-&gt;<a class="code" href="structso__list.html#a7b3094a89d8a05f6905733cab8c6e8e9">lm_info</a>-&gt;<a class="code" href="structlm__info.html#ae00d156f2af9fd69803b6dd7688efacc">text_addr</a> - so-&gt;<a class="code" href="structso__list.html#a7b3094a89d8a05f6905733cab8c6e8e9">lm_info</a>-&gt;<a class="code" href="structlm__info.html#a338e850e765caa5fbf5613116e497964">text_link_addr</a>; 
<a name="l00121"></a>00121       sec-&gt;<a class="code" href="structtarget__section.html#a2c1890ede65bfce986a3e16682e76072">endaddr</a> += so-&gt;<a class="code" href="structso__list.html#a7b3094a89d8a05f6905733cab8c6e8e9">lm_info</a>-&gt;<a class="code" href="structlm__info.html#ae00d156f2af9fd69803b6dd7688efacc">text_addr</a> - so-&gt;<a class="code" href="structso__list.html#a7b3094a89d8a05f6905733cab8c6e8e9">lm_info</a>-&gt;<a class="code" href="structlm__info.html#a338e850e765caa5fbf5613116e497964">text_link_addr</a>;
<a name="l00122"></a>00122     }
<a name="l00123"></a>00123   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (aflag &amp; SEC_DATA)
<a name="l00124"></a>00124     {
<a name="l00125"></a>00125       sec-&gt;<a class="code" href="structtarget__section.html#a3e4564d6ceb39f962f70bb7afdd3b260">addr</a>    += so-&gt;<a class="code" href="structso__list.html#a7b3094a89d8a05f6905733cab8c6e8e9">lm_info</a>-&gt;<a class="code" href="structlm__info.html#a125d34e728ec8f024c31bf7777838119">data_start</a>; 
<a name="l00126"></a>00126       sec-&gt;<a class="code" href="structtarget__section.html#a2c1890ede65bfce986a3e16682e76072">endaddr</a> += so-&gt;<a class="code" href="structso__list.html#a7b3094a89d8a05f6905733cab8c6e8e9">lm_info</a>-&gt;<a class="code" href="structlm__info.html#a125d34e728ec8f024c31bf7777838119">data_start</a>;
<a name="l00127"></a>00127     }
<a name="l00128"></a>00128   <span class="keywordflow">else</span>
<a name="l00129"></a>00129     {
<a name="l00130"></a>00130       <span class="comment">/* Nothing.  */</span>
<a name="l00131"></a>00131     }
<a name="l00132"></a>00132 }
<a name="l00133"></a>00133 
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 <span class="comment">/* Variable storing HP-UX major release number.</span>
<a name="l00136"></a>00136 <span class="comment"></span>
<a name="l00137"></a>00137 <span class="comment">   On non-native system, simply assume that the major release number</span>
<a name="l00138"></a>00138 <span class="comment">   is 11.  On native systems, hppa-hpux-nat.c initialization code</span>
<a name="l00139"></a>00139 <span class="comment">   sets this number to the real one on startup.</span>
<a name="l00140"></a>00140 <span class="comment">   </span>
<a name="l00141"></a>00141 <span class="comment">   We cannot compute this value here, because we need to make a native</span>
<a name="l00142"></a>00142 <span class="comment">   call to &quot;uname&quot;.  We are are not allowed to do that from here, as</span>
<a name="l00143"></a>00143 <span class="comment">   this file is used for both native and cross debugging.  */</span>
<a name="l00144"></a>00144 
<a name="l00145"></a><a class="code" href="solib-som_8c.html#a4d7515d4450521cb7855930c2b886f17">00145</a> <span class="preprocessor">#define DEFAULT_HPUX_MAJOR_RELEASE 11</span>
<a name="l00146"></a><a class="code" href="solib-som_8h.html#a091d5b2e156c72fed366f083a1e14831">00146</a> <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="solib-som_8c.html#a091d5b2e156c72fed366f083a1e14831">hpux_major_release</a> = <a class="code" href="solib-som_8c.html#a4d7515d4450521cb7855930c2b886f17">DEFAULT_HPUX_MAJOR_RELEASE</a>;
<a name="l00147"></a>00147 
<a name="l00148"></a>00148 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00149"></a><a class="code" href="solib-som_8c.html#aa3db3e3cb014c5a755c5381dd6a85015">00149</a> <a class="code" href="solib-som_8c.html#aa3db3e3cb014c5a755c5381dd6a85015">get_hpux_major_release</a> (<span class="keywordtype">void</span>)
<a name="l00150"></a>00150 {
<a name="l00151"></a>00151   <span class="keywordflow">return</span> <a class="code" href="solib-som_8c.html#a091d5b2e156c72fed366f083a1e14831">hpux_major_release</a>;
<a name="l00152"></a>00152 }
<a name="l00153"></a>00153 
<a name="l00154"></a>00154 <span class="comment">/* DL header flag defines.  */</span>
<a name="l00155"></a><a class="code" href="solib-som_8c.html#a8249b95c4a0638e3dfc599730c3e4566">00155</a> <span class="preprocessor">#define SHLIB_TEXT_PRIVATE_ENABLE 0x4000</span>
<a name="l00156"></a>00156 <span class="preprocessor"></span>
<a name="l00157"></a>00157 <span class="comment">/* The DL header is documented in &lt;shl.h&gt;.  We are only interested</span>
<a name="l00158"></a>00158 <span class="comment">   in the flags field to determine whether the executable wants shared</span>
<a name="l00159"></a>00159 <span class="comment">   libraries mapped private.  */</span>
<a name="l00160"></a>00160 <span class="keyword">struct </span>{
<a name="l00161"></a><a class="code" href="solib-som_8c.html#aab3cdcb24e81653c30da989228d3c9f6">00161</a>     <span class="keywordtype">short</span> <a class="code" href="solib-som_8c.html#aab3cdcb24e81653c30da989228d3c9f6">junk</a>[37];
<a name="l00162"></a><a class="code" href="solib-som_8c.html#a555096840020c318e34b205419e98cca">00162</a>     <span class="keywordtype">short</span> <a class="code" href="solib-som_8c.html#a555096840020c318e34b205419e98cca">flags</a>;
<a name="l00163"></a>00163 } <a class="code" href="solib-som_8c.html#a6fcd81c139afcba386b3d50c5758f34b">dl_header</a>;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 <span class="comment">/* This hook gets called just before the first instruction in the</span>
<a name="l00166"></a>00166 <span class="comment">   inferior process is executed.</span>
<a name="l00167"></a>00167 <span class="comment"></span>
<a name="l00168"></a>00168 <span class="comment">   This is our opportunity to set magic flags in the inferior so</span>
<a name="l00169"></a>00169 <span class="comment">   that GDB can be notified when a shared library is mapped in and</span>
<a name="l00170"></a>00170 <span class="comment">   to tell the dynamic linker that a private copy of the library is</span>
<a name="l00171"></a>00171 <span class="comment">   needed (so GDB can set breakpoints in the library).</span>
<a name="l00172"></a>00172 <span class="comment"></span>
<a name="l00173"></a>00173 <span class="comment">   __dld_flags is the location of the magic flags; as of this implementation</span>
<a name="l00174"></a>00174 <span class="comment">   there are 3 flags of interest:</span>
<a name="l00175"></a>00175 <span class="comment"></span>
<a name="l00176"></a>00176 <span class="comment">   bit 0 when set indicates that private copies of the libraries are needed</span>
<a name="l00177"></a>00177 <span class="comment">   bit 1 when set indicates that the callback hook routine is valid</span>
<a name="l00178"></a>00178 <span class="comment">   bit 2 when set indicates that the dynamic linker should maintain the</span>
<a name="l00179"></a>00179 <span class="comment">   __dld_list structure when loading/unloading libraries.</span>
<a name="l00180"></a>00180 <span class="comment"></span>
<a name="l00181"></a>00181 <span class="comment">   Note that shared libraries are not mapped in at this time, so we have</span>
<a name="l00182"></a>00182 <span class="comment">   run the inferior until the libraries are mapped in.  Typically this</span>
<a name="l00183"></a>00183 <span class="comment">   means running until the &quot;_start&quot; is called.  */</span>
<a name="l00184"></a>00184 
<a name="l00185"></a>00185 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00186"></a><a class="code" href="solib-som_8c.html#af5aacbc4bc40666c2f1ecb8015407108">00186</a> <a class="code" href="solib-som_8c.html#af5aacbc4bc40666c2f1ecb8015407108">som_solib_create_inferior_hook</a> (<span class="keywordtype">int</span> from_tty)
<a name="l00187"></a>00187 {
<a name="l00188"></a>00188   <span class="keyword">enum</span> bfd_endian byte_order = <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ());
<a name="l00189"></a>00189   <span class="keyword">struct </span><a class="code" href="structminimal__symbol.html">minimal_symbol</a> *msymbol;
<a name="l00190"></a>00190   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dld_flags, <a class="code" href="namespaceexsummary.html#aa4a2eed06e51a1f73ff9053ec9f2591e">status</a>, have_endo;
<a name="l00191"></a>00191   asection *shlib_info;
<a name="l00192"></a>00192   <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> buf[4];
<a name="l00193"></a>00193   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> anaddr;
<a name="l00194"></a>00194 
<a name="l00195"></a>00195   <span class="keywordflow">if</span> (<a class="code" href="progspace_8h.html#a4e703bd0d59c70e069bed3b4d9e1936b">symfile_objfile</a> == NULL)
<a name="l00196"></a>00196     <span class="keywordflow">return</span>;
<a name="l00197"></a>00197 
<a name="l00198"></a>00198   <span class="comment">/* First see if the objfile was dynamically linked.  */</span>
<a name="l00199"></a>00199   shlib_info = bfd_get_section_by_name (<a class="code" href="progspace_8h.html#a4e703bd0d59c70e069bed3b4d9e1936b">symfile_objfile</a>-&gt;obfd, <span class="stringliteral">&quot;$SHLIB_INFO$&quot;</span>);
<a name="l00200"></a>00200   <span class="keywordflow">if</span> (!shlib_info)
<a name="l00201"></a>00201     <span class="keywordflow">return</span>;
<a name="l00202"></a>00202 
<a name="l00203"></a>00203   <span class="comment">/* It&#39;s got a $SHLIB_INFO$ section, make sure it&#39;s not empty.  */</span>
<a name="l00204"></a>00204   <span class="keywordflow">if</span> (bfd_section_size (<a class="code" href="progspace_8h.html#a4e703bd0d59c70e069bed3b4d9e1936b">symfile_objfile</a>-&gt;obfd, shlib_info) == 0)
<a name="l00205"></a>00205     <span class="keywordflow">return</span>;
<a name="l00206"></a>00206 
<a name="l00207"></a>00207   <span class="comment">/* Read the DL header.  */</span>
<a name="l00208"></a>00208   bfd_get_section_contents (<a class="code" href="progspace_8h.html#a4e703bd0d59c70e069bed3b4d9e1936b">symfile_objfile</a>-&gt;obfd, shlib_info,
<a name="l00209"></a>00209                             (<span class="keywordtype">char</span> *) &amp;<a class="code" href="solib-som_8c.html#a6fcd81c139afcba386b3d50c5758f34b">dl_header</a>, 0, sizeof (dl_header));
<a name="l00210"></a>00210 
<a name="l00211"></a>00211   have_endo = 0;
<a name="l00212"></a>00212   <span class="comment">/* Slam the pid of the process into __d_pid.</span>
<a name="l00213"></a>00213 <span class="comment"></span>
<a name="l00214"></a>00214 <span class="comment">     We used to warn when this failed, but that warning is only useful</span>
<a name="l00215"></a>00215 <span class="comment">     on very old HP systems (hpux9 and older).  The warnings are an</span>
<a name="l00216"></a>00216 <span class="comment">     annoyance to users of modern systems and foul up the testsuite as</span>
<a name="l00217"></a>00217 <span class="comment">     well.  As a result, the warnings have been disabled.  */</span>
<a name="l00218"></a>00218   msymbol = <a class="code" href="minsyms_8c.html#af87f7a894386515074ddd71365bc09b8">lookup_minimal_symbol</a> (<span class="stringliteral">&quot;__d_pid&quot;</span>, NULL, <a class="code" href="progspace_8h.html#a4e703bd0d59c70e069bed3b4d9e1936b">symfile_objfile</a>);
<a name="l00219"></a>00219   <span class="keywordflow">if</span> (msymbol == NULL)
<a name="l00220"></a>00220     <span class="keywordflow">goto</span> <a class="code" href="infrun_8c.html#a8851508f61d760f67cc2f9a5090f26c3">keep_going</a>;
<a name="l00221"></a>00221 
<a name="l00222"></a>00222   anaddr = <a class="code" href="symtab_8h.html#abee697b9e3bb4f4d164ad920a87ab854">SYMBOL_VALUE_ADDRESS</a> (msymbol);
<a name="l00223"></a>00223   <a class="code" href="defs_8h.html#ad11c013c83c64d9d0ee2e4bdeb1fb62d">store_unsigned_integer</a> (buf, 4, byte_order, <a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>));
<a name="l00224"></a>00224   status = <a class="code" href="target_8c.html#a7bd38b77fbf87c003396742f775dd2d4">target_write_memory</a> (anaddr, buf, 4);
<a name="l00225"></a>00225   <span class="keywordflow">if</span> (status != 0)
<a name="l00226"></a>00226     {
<a name="l00227"></a>00227       <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l00228"></a>00228 <span class="stringliteral">Unable to write __d_pid.\n\</span>
<a name="l00229"></a>00229 <span class="stringliteral">Suggest linking with /opt/langtools/lib/end.o.\n\</span>
<a name="l00230"></a>00230 <span class="stringliteral">GDB will be unable to track shl_load/shl_unload calls&quot;</span>));
<a name="l00231"></a>00231       <span class="keywordflow">goto</span> <a class="code" href="infrun_8c.html#a8851508f61d760f67cc2f9a5090f26c3">keep_going</a>;
<a name="l00232"></a>00232     }
<a name="l00233"></a>00233 
<a name="l00234"></a>00234   <span class="comment">/* Get the value of _DLD_HOOK (an export stub) and put it in __dld_hook;</span>
<a name="l00235"></a>00235 <span class="comment">     This will force the dynamic linker to call __d_trap when significant</span>
<a name="l00236"></a>00236 <span class="comment">     events occur.</span>
<a name="l00237"></a>00237 <span class="comment"></span>
<a name="l00238"></a>00238 <span class="comment">     Note that the above is the pre-HP-UX 9.0 behaviour.  At 9.0 and above,</span>
<a name="l00239"></a>00239 <span class="comment">     the dld provides an export stub named &quot;__d_trap&quot; as well as the</span>
<a name="l00240"></a>00240 <span class="comment">     function named &quot;__d_trap&quot; itself, but doesn&#39;t provide &quot;_DLD_HOOK&quot;.</span>
<a name="l00241"></a>00241 <span class="comment">     We&#39;ll look first for the old flavor and then the new.  */</span>
<a name="l00242"></a>00242 
<a name="l00243"></a>00243   msymbol = <a class="code" href="minsyms_8c.html#af87f7a894386515074ddd71365bc09b8">lookup_minimal_symbol</a> (<span class="stringliteral">&quot;_DLD_HOOK&quot;</span>, NULL, <a class="code" href="progspace_8h.html#a4e703bd0d59c70e069bed3b4d9e1936b">symfile_objfile</a>);
<a name="l00244"></a>00244   <span class="keywordflow">if</span> (msymbol == NULL)
<a name="l00245"></a>00245     msymbol = <a class="code" href="minsyms_8c.html#af87f7a894386515074ddd71365bc09b8">lookup_minimal_symbol</a> (<span class="stringliteral">&quot;__d_trap&quot;</span>, NULL, <a class="code" href="progspace_8h.html#a4e703bd0d59c70e069bed3b4d9e1936b">symfile_objfile</a>);
<a name="l00246"></a>00246   <span class="keywordflow">if</span> (msymbol == NULL)
<a name="l00247"></a>00247     {
<a name="l00248"></a>00248       <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l00249"></a>00249 <span class="stringliteral">Unable to find _DLD_HOOK symbol in object file.\n\</span>
<a name="l00250"></a>00250 <span class="stringliteral">Suggest linking with /opt/langtools/lib/end.o.\n\</span>
<a name="l00251"></a>00251 <span class="stringliteral">GDB will be unable to track shl_load/shl_unload calls&quot;</span>));
<a name="l00252"></a>00252       <span class="keywordflow">goto</span> <a class="code" href="infrun_8c.html#a8851508f61d760f67cc2f9a5090f26c3">keep_going</a>;
<a name="l00253"></a>00253     }
<a name="l00254"></a>00254   anaddr = <a class="code" href="symtab_8h.html#abee697b9e3bb4f4d164ad920a87ab854">SYMBOL_VALUE_ADDRESS</a> (msymbol);
<a name="l00255"></a>00255   <a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.hook.address = anaddr;
<a name="l00256"></a>00256 
<a name="l00257"></a>00257   <span class="comment">/* Grrr, this might not be an export symbol!  We have to find the</span>
<a name="l00258"></a>00258 <span class="comment">     export stub.  */</span>
<a name="l00259"></a>00259   msymbol = <a class="code" href="hppa-tdep_8c.html#a861deacb3ff93d92ba5ac3061bff9d09">hppa_lookup_stub_minimal_symbol</a> (<a class="code" href="symtab_8h.html#a956b56288511a18b855d8a263d60e87f">SYMBOL_LINKAGE_NAME</a> (msymbol),
<a name="l00260"></a>00260                                              <a class="code" href="hppa-tdep_8h.html#a7bc203625751112fdefe5ad2632242d7a42a7dc57e9a45fcbbc5c19d5e270df40">EXPORT</a>);
<a name="l00261"></a>00261   <span class="keywordflow">if</span> (msymbol != NULL)
<a name="l00262"></a>00262     {
<a name="l00263"></a>00263       anaddr = <a class="code" href="symtab_8h.html#a31840856d8e3eed18cbe9ca90cd2bf39">SYMBOL_VALUE</a> (msymbol);
<a name="l00264"></a>00264       <a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.hook_stub.address = anaddr;
<a name="l00265"></a>00265     }
<a name="l00266"></a>00266   <a class="code" href="defs_8h.html#ad11c013c83c64d9d0ee2e4bdeb1fb62d">store_unsigned_integer</a> (buf, 4, byte_order, anaddr);
<a name="l00267"></a>00267 
<a name="l00268"></a>00268   msymbol = <a class="code" href="minsyms_8c.html#af87f7a894386515074ddd71365bc09b8">lookup_minimal_symbol</a> (<span class="stringliteral">&quot;__dld_hook&quot;</span>, NULL, <a class="code" href="progspace_8h.html#a4e703bd0d59c70e069bed3b4d9e1936b">symfile_objfile</a>);
<a name="l00269"></a>00269   <span class="keywordflow">if</span> (msymbol == NULL)
<a name="l00270"></a>00270     {
<a name="l00271"></a>00271       <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l00272"></a>00272 <span class="stringliteral">Unable to find __dld_hook symbol in object file.\n\</span>
<a name="l00273"></a>00273 <span class="stringliteral">Suggest linking with /opt/langtools/lib/end.o.\n\</span>
<a name="l00274"></a>00274 <span class="stringliteral">GDB will be unable to track shl_load/shl_unload calls&quot;</span>));
<a name="l00275"></a>00275       <span class="keywordflow">goto</span> <a class="code" href="infrun_8c.html#a8851508f61d760f67cc2f9a5090f26c3">keep_going</a>;
<a name="l00276"></a>00276     }
<a name="l00277"></a>00277   anaddr = <a class="code" href="symtab_8h.html#abee697b9e3bb4f4d164ad920a87ab854">SYMBOL_VALUE_ADDRESS</a> (msymbol);
<a name="l00278"></a>00278   status = <a class="code" href="target_8c.html#a7bd38b77fbf87c003396742f775dd2d4">target_write_memory</a> (anaddr, buf, 4);
<a name="l00279"></a>00279 
<a name="l00280"></a>00280   <span class="comment">/* Now set a shlib_event breakpoint at __d_trap so we can track</span>
<a name="l00281"></a>00281 <span class="comment">     significant shared library events.  */</span>
<a name="l00282"></a>00282   msymbol = <a class="code" href="minsyms_8c.html#af87f7a894386515074ddd71365bc09b8">lookup_minimal_symbol</a> (<span class="stringliteral">&quot;__d_trap&quot;</span>, NULL, <a class="code" href="progspace_8h.html#a4e703bd0d59c70e069bed3b4d9e1936b">symfile_objfile</a>);
<a name="l00283"></a>00283   <span class="keywordflow">if</span> (msymbol == NULL)
<a name="l00284"></a>00284     {
<a name="l00285"></a>00285       <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l00286"></a>00286 <span class="stringliteral">Unable to find __dld_d_trap symbol in object file.\n\</span>
<a name="l00287"></a>00287 <span class="stringliteral">Suggest linking with /opt/langtools/lib/end.o.\n\</span>
<a name="l00288"></a>00288 <span class="stringliteral">GDB will be unable to track shl_load/shl_unload calls&quot;</span>));
<a name="l00289"></a>00289       <span class="keywordflow">goto</span> <a class="code" href="infrun_8c.html#a8851508f61d760f67cc2f9a5090f26c3">keep_going</a>;
<a name="l00290"></a>00290     }
<a name="l00291"></a>00291   <a class="code" href="breakpoint_8c.html#a77e5eba285ff0706303f27d268e9b997">create_solib_event_breakpoint</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> (),
<a name="l00292"></a>00292                                  <a class="code" href="symtab_8h.html#abee697b9e3bb4f4d164ad920a87ab854">SYMBOL_VALUE_ADDRESS</a> (msymbol));
<a name="l00293"></a>00293 
<a name="l00294"></a>00294   <span class="comment">/* We have all the support usually found in end.o, so we can track</span>
<a name="l00295"></a>00295 <span class="comment">     shl_load and shl_unload calls.  */</span>
<a name="l00296"></a>00296   have_endo = 1;
<a name="l00297"></a>00297 
<a name="l00298"></a>00298 <a class="code" href="infrun_8c.html#a8851508f61d760f67cc2f9a5090f26c3">keep_going</a>:
<a name="l00299"></a>00299 
<a name="l00300"></a>00300   <span class="comment">/* Get the address of __dld_flags, if no such symbol exists, then we can</span>
<a name="l00301"></a>00301 <span class="comment">     not debug the shared code.  */</span>
<a name="l00302"></a>00302   msymbol = <a class="code" href="minsyms_8c.html#af87f7a894386515074ddd71365bc09b8">lookup_minimal_symbol</a> (<span class="stringliteral">&quot;__dld_flags&quot;</span>, NULL, NULL);
<a name="l00303"></a>00303   <span class="keywordflow">if</span> (msymbol == NULL)
<a name="l00304"></a>00304     {
<a name="l00305"></a>00305       <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Unable to find __dld_flags symbol in object file.&quot;</span>));
<a name="l00306"></a>00306     }
<a name="l00307"></a>00307 
<a name="l00308"></a>00308   anaddr = <a class="code" href="symtab_8h.html#abee697b9e3bb4f4d164ad920a87ab854">SYMBOL_VALUE_ADDRESS</a> (msymbol);
<a name="l00309"></a>00309 
<a name="l00310"></a>00310   <span class="comment">/* Read the current contents.  */</span>
<a name="l00311"></a>00311   status = <a class="code" href="target_8c.html#ac579515fbccfb9e6b1a45766a71c1d4f">target_read_memory</a> (anaddr, buf, 4);
<a name="l00312"></a>00312   <span class="keywordflow">if</span> (status != 0)
<a name="l00313"></a>00313     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Unable to read __dld_flags.&quot;</span>));
<a name="l00314"></a>00314   dld_flags = <a class="code" href="defs_8h.html#a99aec65329508b4d449a4f881026f844">extract_unsigned_integer</a> (buf, 4, byte_order);
<a name="l00315"></a>00315 
<a name="l00316"></a>00316   <span class="comment">/* If the libraries were not mapped private on HP-UX 11 and later, warn</span>
<a name="l00317"></a>00317 <span class="comment">     the user.  On HP-UX 10 and earlier, there is no easy way to specify</span>
<a name="l00318"></a>00318 <span class="comment">     that shared libraries should be privately mapped.  So, we just force</span>
<a name="l00319"></a>00319 <span class="comment">     private mapping.  */</span>
<a name="l00320"></a>00320   <span class="keywordflow">if</span> (<a class="code" href="solib-som_8c.html#aa3db3e3cb014c5a755c5381dd6a85015">get_hpux_major_release</a> () &gt;= 11
<a name="l00321"></a>00321       &amp;&amp; (dl_header.flags &amp; <a class="code" href="solib-som_8c.html#a8249b95c4a0638e3dfc599730c3e4566">SHLIB_TEXT_PRIVATE_ENABLE</a>) == 0
<a name="l00322"></a>00322       &amp;&amp; (dld_flags &amp; <a class="code" href="solib-som_8c.html#a5c83d618401501f2a206aa77824efed7">DLD_FLAGS_MAPPRIVATE</a>) == 0)
<a name="l00323"></a>00323     <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a>
<a name="l00324"></a>00324       (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l00325"></a>00325 <span class="stringliteral">Private mapping of shared library text was not specified\n\</span>
<a name="l00326"></a>00326 <span class="stringliteral">by the executable; setting a breakpoint in a shared library which\n\</span>
<a name="l00327"></a>00327 <span class="stringliteral">is not privately mapped will not work.  See the HP-UX 11i v3 chatr\n\</span>
<a name="l00328"></a>00328 <span class="stringliteral">manpage for methods to privately map shared library text.&quot;</span>));
<a name="l00329"></a>00329 
<a name="l00330"></a>00330   <span class="comment">/* Turn on the flags we care about.  */</span>
<a name="l00331"></a>00331   <span class="keywordflow">if</span> (<a class="code" href="solib-som_8c.html#aa3db3e3cb014c5a755c5381dd6a85015">get_hpux_major_release</a> () &lt; 11)
<a name="l00332"></a>00332     dld_flags |= <a class="code" href="solib-som_8c.html#a5c83d618401501f2a206aa77824efed7">DLD_FLAGS_MAPPRIVATE</a>;
<a name="l00333"></a>00333   <span class="keywordflow">if</span> (have_endo)
<a name="l00334"></a>00334     dld_flags |= <a class="code" href="solib-som_8c.html#ad154015a847547b8de0636a5def27a95">DLD_FLAGS_HOOKVALID</a>;
<a name="l00335"></a>00335   <a class="code" href="defs_8h.html#ad11c013c83c64d9d0ee2e4bdeb1fb62d">store_unsigned_integer</a> (buf, 4, byte_order, dld_flags);
<a name="l00336"></a>00336   status = <a class="code" href="target_8c.html#a7bd38b77fbf87c003396742f775dd2d4">target_write_memory</a> (anaddr, buf, 4);
<a name="l00337"></a>00337   <span class="keywordflow">if</span> (status != 0)
<a name="l00338"></a>00338     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Unable to write __dld_flags.&quot;</span>));
<a name="l00339"></a>00339 
<a name="l00340"></a>00340   <span class="comment">/* Now find the address of _start and set a breakpoint there.</span>
<a name="l00341"></a>00341 <span class="comment">     We still need this code for two reasons:</span>
<a name="l00342"></a>00342 <span class="comment"></span>
<a name="l00343"></a>00343 <span class="comment">     * Not all sites have /opt/langtools/lib/end.o, so it&#39;s not always</span>
<a name="l00344"></a>00344 <span class="comment">     possible to track the dynamic linker&#39;s events.</span>
<a name="l00345"></a>00345 <span class="comment"></span>
<a name="l00346"></a>00346 <span class="comment">     * At this time no events are triggered for shared libraries</span>
<a name="l00347"></a>00347 <span class="comment">     loaded at startup time (what a crock).  */</span>
<a name="l00348"></a>00348 
<a name="l00349"></a>00349   msymbol = <a class="code" href="minsyms_8c.html#af87f7a894386515074ddd71365bc09b8">lookup_minimal_symbol</a> (<span class="stringliteral">&quot;_start&quot;</span>, NULL, <a class="code" href="progspace_8h.html#a4e703bd0d59c70e069bed3b4d9e1936b">symfile_objfile</a>);
<a name="l00350"></a>00350   <span class="keywordflow">if</span> (msymbol == NULL)
<a name="l00351"></a>00351     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Unable to find _start symbol in object file.&quot;</span>));
<a name="l00352"></a>00352 
<a name="l00353"></a>00353   anaddr = <a class="code" href="symtab_8h.html#abee697b9e3bb4f4d164ad920a87ab854">SYMBOL_VALUE_ADDRESS</a> (msymbol);
<a name="l00354"></a>00354 
<a name="l00355"></a>00355   <span class="comment">/* Make the breakpoint at &quot;_start&quot; a shared library event breakpoint.  */</span>
<a name="l00356"></a>00356   <a class="code" href="breakpoint_8c.html#a77e5eba285ff0706303f27d268e9b997">create_solib_event_breakpoint</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> (), anaddr);
<a name="l00357"></a>00357 
<a name="l00358"></a>00358   <a class="code" href="symfile_8c.html#a872e7a71713c1059f667bb1be5948643">clear_symtab_users</a> (0);
<a name="l00359"></a>00359 }
<a name="l00360"></a>00360 
<a name="l00361"></a>00361 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00362"></a><a class="code" href="solib-som_8c.html#a0bb5a66203e75e776ede536385388e2f">00362</a> <a class="code" href="solib-som_8c.html#a0bb5a66203e75e776ede536385388e2f">som_special_symbol_handling</a> (<span class="keywordtype">void</span>)
<a name="l00363"></a>00363 {
<a name="l00364"></a>00364 }
<a name="l00365"></a>00365 
<a name="l00366"></a>00366 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00367"></a><a class="code" href="solib-som_8c.html#a746ed804e32860682a80fdf1c688f648">00367</a> <a class="code" href="solib-som_8c.html#a746ed804e32860682a80fdf1c688f648">som_solib_desire_dynamic_linker_symbols</a> (<span class="keywordtype">void</span>)
<a name="l00368"></a>00368 {
<a name="l00369"></a>00369   <span class="keyword">struct </span><a class="code" href="structobjfile.html">objfile</a> *<a class="code" href="structobjfile.html">objfile</a>;
<a name="l00370"></a>00370   <span class="keyword">struct </span><a class="code" href="structunwind__table__entry.html">unwind_table_entry</a> *u;
<a name="l00371"></a>00371   <span class="keyword">struct </span><a class="code" href="structminimal__symbol.html">minimal_symbol</a> *dld_msymbol;
<a name="l00372"></a>00372 
<a name="l00373"></a>00373   <span class="comment">/* Do we already know the value of these symbols?  If so, then</span>
<a name="l00374"></a>00374 <span class="comment">     we&#39;ve no work to do.</span>
<a name="l00375"></a>00375 <span class="comment"></span>
<a name="l00376"></a>00376 <span class="comment">     (If you add clauses to this test, be sure to likewise update the</span>
<a name="l00377"></a>00377 <span class="comment">     test within the loop.)  */</span>
<a name="l00378"></a>00378 
<a name="l00379"></a>00379   <span class="keywordflow">if</span> (<a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.is_valid)
<a name="l00380"></a>00380     <span class="keywordflow">return</span>;
<a name="l00381"></a>00381 
<a name="l00382"></a>00382   <a class="code" href="objfiles_8h.html#a8efee3b85a322006131a6056d45058b3">ALL_OBJFILES</a> (objfile)
<a name="l00383"></a>00383   {
<a name="l00384"></a>00384     dld_msymbol = <a class="code" href="minsyms_8c.html#af87f7a894386515074ddd71365bc09b8">lookup_minimal_symbol</a> (<span class="stringliteral">&quot;shl_load&quot;</span>, NULL, objfile);
<a name="l00385"></a>00385     <span class="keywordflow">if</span> (dld_msymbol != NULL)
<a name="l00386"></a>00386       {
<a name="l00387"></a>00387         <a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.load.address = <a class="code" href="symtab_8h.html#a31840856d8e3eed18cbe9ca90cd2bf39">SYMBOL_VALUE</a> (dld_msymbol);
<a name="l00388"></a>00388         <a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.load.unwind = <a class="code" href="hppa-tdep_8c.html#a487fedf95dea7ef90214e8111795c396">find_unwind_entry</a> (<a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.load.address);
<a name="l00389"></a>00389       }
<a name="l00390"></a>00390 
<a name="l00391"></a>00391     dld_msymbol = <a class="code" href="minsyms_8c.html#aea2a1ea1e59e3451805384ea0b9ff42a">lookup_minimal_symbol_solib_trampoline</a> (<span class="stringliteral">&quot;shl_load&quot;</span>,
<a name="l00392"></a>00392                                                           objfile);
<a name="l00393"></a>00393     <span class="keywordflow">if</span> (dld_msymbol != NULL)
<a name="l00394"></a>00394       {
<a name="l00395"></a>00395         <span class="keywordflow">if</span> (<a class="code" href="symtab_8h.html#a1d0b27d446f2622f464727b6a06ae263">MSYMBOL_TYPE</a> (dld_msymbol) == <a class="code" href="symtab_8h.html#a91ee0a03aba3bbd0e221547c3d82c036aa6ace68113ace3aafa25e705d9fce85d">mst_solib_trampoline</a>)
<a name="l00396"></a>00396           {
<a name="l00397"></a>00397             u = <a class="code" href="hppa-tdep_8c.html#a487fedf95dea7ef90214e8111795c396">find_unwind_entry</a> (<a class="code" href="symtab_8h.html#a31840856d8e3eed18cbe9ca90cd2bf39">SYMBOL_VALUE</a> (dld_msymbol));
<a name="l00398"></a>00398             <span class="keywordflow">if</span> ((u != NULL) &amp;&amp; (u-&gt;<a class="code" href="structunwind__table__entry.html#a4c0ed08d733301dae90c495942383614">stub_unwind</a>.<a class="code" href="structunwind__table__entry.html#a1c21ee4e0ffd7e5b3dba239177ab0873">stub_type</a> == <a class="code" href="hppa-tdep_8h.html#a7bc203625751112fdefe5ad2632242d7a42a7dc57e9a45fcbbc5c19d5e270df40">EXPORT</a>))
<a name="l00399"></a>00399               {
<a name="l00400"></a>00400                 <a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.load_stub.address = <a class="code" href="symtab_8h.html#a31840856d8e3eed18cbe9ca90cd2bf39">SYMBOL_VALUE</a> (dld_msymbol);
<a name="l00401"></a>00401                 <a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.load_stub.unwind = u;
<a name="l00402"></a>00402               }
<a name="l00403"></a>00403           }
<a name="l00404"></a>00404       }
<a name="l00405"></a>00405 
<a name="l00406"></a>00406     dld_msymbol = <a class="code" href="minsyms_8c.html#af87f7a894386515074ddd71365bc09b8">lookup_minimal_symbol</a> (<span class="stringliteral">&quot;shl_unload&quot;</span>, NULL, objfile);
<a name="l00407"></a>00407     <span class="keywordflow">if</span> (dld_msymbol != NULL)
<a name="l00408"></a>00408       {
<a name="l00409"></a>00409         <a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.unload.address = <a class="code" href="symtab_8h.html#a31840856d8e3eed18cbe9ca90cd2bf39">SYMBOL_VALUE</a> (dld_msymbol);
<a name="l00410"></a>00410         <a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.unload.unwind = <a class="code" href="hppa-tdep_8c.html#a487fedf95dea7ef90214e8111795c396">find_unwind_entry</a> (<a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.unload.address);
<a name="l00411"></a>00411 
<a name="l00412"></a>00412         <span class="comment">/* ??rehrauer: I&#39;m not sure exactly what this is, but it appears</span>
<a name="l00413"></a>00413 <span class="comment">           that on some HPUX 10.x versions, there&#39;s two unwind regions to</span>
<a name="l00414"></a>00414 <span class="comment">           cover the body of &quot;shl_unload&quot;, the second being 4 bytes past</span>
<a name="l00415"></a>00415 <span class="comment">           the end of the first.  This is a large hack to handle that</span>
<a name="l00416"></a>00416 <span class="comment">           case, but since I don&#39;t seem to have any legitimate way to</span>
<a name="l00417"></a>00417 <span class="comment">           look for this thing via the symbol table...  */</span>
<a name="l00418"></a>00418 
<a name="l00419"></a>00419         <span class="keywordflow">if</span> (<a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.unload.unwind != NULL)
<a name="l00420"></a>00420           {
<a name="l00421"></a>00421             u = <a class="code" href="hppa-tdep_8c.html#a487fedf95dea7ef90214e8111795c396">find_unwind_entry</a> (<a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.unload.unwind-&gt;region_end + 4);
<a name="l00422"></a>00422             <span class="keywordflow">if</span> (u != NULL)
<a name="l00423"></a>00423               {
<a name="l00424"></a>00424                 <a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.unload2.address = u-&gt;<a class="code" href="structunwind__table__entry.html#ac00da282684450cc0116381329d92d40">region_start</a>;
<a name="l00425"></a>00425                 <a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.unload2.unwind = u;
<a name="l00426"></a>00426               }
<a name="l00427"></a>00427           }
<a name="l00428"></a>00428       }
<a name="l00429"></a>00429 
<a name="l00430"></a>00430     dld_msymbol = <a class="code" href="minsyms_8c.html#aea2a1ea1e59e3451805384ea0b9ff42a">lookup_minimal_symbol_solib_trampoline</a> (<span class="stringliteral">&quot;shl_unload&quot;</span>,
<a name="l00431"></a>00431                                                           objfile);
<a name="l00432"></a>00432     <span class="keywordflow">if</span> (dld_msymbol != NULL)
<a name="l00433"></a>00433       {
<a name="l00434"></a>00434         <span class="keywordflow">if</span> (<a class="code" href="symtab_8h.html#a1d0b27d446f2622f464727b6a06ae263">MSYMBOL_TYPE</a> (dld_msymbol) == <a class="code" href="symtab_8h.html#a91ee0a03aba3bbd0e221547c3d82c036aa6ace68113ace3aafa25e705d9fce85d">mst_solib_trampoline</a>)
<a name="l00435"></a>00435           {
<a name="l00436"></a>00436             u = <a class="code" href="hppa-tdep_8c.html#a487fedf95dea7ef90214e8111795c396">find_unwind_entry</a> (<a class="code" href="symtab_8h.html#a31840856d8e3eed18cbe9ca90cd2bf39">SYMBOL_VALUE</a> (dld_msymbol));
<a name="l00437"></a>00437             <span class="keywordflow">if</span> ((u != NULL) &amp;&amp; (u-&gt;<a class="code" href="structunwind__table__entry.html#a4c0ed08d733301dae90c495942383614">stub_unwind</a>.<a class="code" href="structunwind__table__entry.html#a1c21ee4e0ffd7e5b3dba239177ab0873">stub_type</a> == <a class="code" href="hppa-tdep_8h.html#a7bc203625751112fdefe5ad2632242d7a42a7dc57e9a45fcbbc5c19d5e270df40">EXPORT</a>))
<a name="l00438"></a>00438               {
<a name="l00439"></a>00439                 <a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.unload_stub.address = <a class="code" href="symtab_8h.html#a31840856d8e3eed18cbe9ca90cd2bf39">SYMBOL_VALUE</a> (dld_msymbol);
<a name="l00440"></a>00440                 <a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.unload_stub.unwind = u;
<a name="l00441"></a>00441               }
<a name="l00442"></a>00442           }
<a name="l00443"></a>00443       }
<a name="l00444"></a>00444 
<a name="l00445"></a>00445     <span class="comment">/* Did we find everything we were looking for?  If so, stop.  */</span>
<a name="l00446"></a>00446     <span class="keywordflow">if</span> ((<a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.load.address != 0)
<a name="l00447"></a>00447         &amp;&amp; (<a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.load_stub.address != 0)
<a name="l00448"></a>00448         &amp;&amp; (<a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.unload.address != 0)
<a name="l00449"></a>00449         &amp;&amp; (<a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.unload_stub.address != 0))
<a name="l00450"></a>00450       {
<a name="l00451"></a>00451         <a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.is_valid = 1;
<a name="l00452"></a>00452         <span class="keywordflow">break</span>;
<a name="l00453"></a>00453       }
<a name="l00454"></a>00454   }
<a name="l00455"></a>00455 
<a name="l00456"></a>00456   <a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.hook.unwind = <a class="code" href="hppa-tdep_8c.html#a487fedf95dea7ef90214e8111795c396">find_unwind_entry</a> (<a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.hook.address);
<a name="l00457"></a>00457   <a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.hook_stub.unwind = <a class="code" href="hppa-tdep_8c.html#a487fedf95dea7ef90214e8111795c396">find_unwind_entry</a> (<a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.hook_stub.address);
<a name="l00458"></a>00458 
<a name="l00459"></a>00459   <span class="comment">/* We&#39;re prepared not to find some of these symbols, which is why</span>
<a name="l00460"></a>00460 <span class="comment">     this function is a &quot;desire&quot; operation, and not a &quot;require&quot;.  */</span>
<a name="l00461"></a>00461 }
<a name="l00462"></a>00462 
<a name="l00463"></a>00463 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00464"></a><a class="code" href="solib-som_8c.html#a6df6a64c6d316054ea26f2a5034ef4e1">00464</a> <a class="code" href="solib-som_8c.html#a6df6a64c6d316054ea26f2a5034ef4e1">som_in_dynsym_resolve_code</a> (<a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> pc)
<a name="l00465"></a>00465 {
<a name="l00466"></a>00466   <span class="keyword">struct </span><a class="code" href="structunwind__table__entry.html">unwind_table_entry</a> *u_pc;
<a name="l00467"></a>00467 
<a name="l00468"></a>00468   <span class="comment">/* Are we in the dld itself?</span>
<a name="l00469"></a>00469 <span class="comment"></span>
<a name="l00470"></a>00470 <span class="comment">     ??rehrauer: Large hack -- We&#39;ll assume that any address in a</span>
<a name="l00471"></a>00471 <span class="comment">     shared text region is the dld&#39;s text.  This would obviously</span>
<a name="l00472"></a>00472 <span class="comment">     fall down if the user attached to a process, whose shlibs</span>
<a name="l00473"></a>00473 <span class="comment">     weren&#39;t mapped to a (writeable) private region.  However, in</span>
<a name="l00474"></a>00474 <span class="comment">     that case the debugger probably isn&#39;t able to set the fundamental</span>
<a name="l00475"></a>00475 <span class="comment">     breakpoint in the dld callback anyways, so this hack should be</span>
<a name="l00476"></a>00476 <span class="comment">     safe.  */</span>
<a name="l00477"></a>00477 
<a name="l00478"></a>00478   <span class="keywordflow">if</span> ((pc &amp; (<a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a>) 0xc0000000) == (<a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a>) 0xc0000000)
<a name="l00479"></a>00479     <span class="keywordflow">return</span> 1;
<a name="l00480"></a>00480 
<a name="l00481"></a>00481   <span class="comment">/* Cache the address of some symbols that are part of the dynamic</span>
<a name="l00482"></a>00482 <span class="comment">     linker, if not already known.  */</span>
<a name="l00483"></a>00483 
<a name="l00484"></a>00484   <a class="code" href="solib-som_8c.html#a746ed804e32860682a80fdf1c688f648">som_solib_desire_dynamic_linker_symbols</a> ();
<a name="l00485"></a>00485 
<a name="l00486"></a>00486   <span class="comment">/* Are we in the dld callback?  Or its export stub?  */</span>
<a name="l00487"></a>00487   u_pc = <a class="code" href="hppa-tdep_8c.html#a487fedf95dea7ef90214e8111795c396">find_unwind_entry</a> (pc);
<a name="l00488"></a>00488   <span class="keywordflow">if</span> (u_pc == NULL)
<a name="l00489"></a>00489     <span class="keywordflow">return</span> 0;
<a name="l00490"></a>00490 
<a name="l00491"></a>00491   <span class="keywordflow">if</span> ((u_pc == <a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.hook.unwind) || (u_pc == <a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.hook_stub.unwind))
<a name="l00492"></a>00492     <span class="keywordflow">return</span> 1;
<a name="l00493"></a>00493 
<a name="l00494"></a>00494   <span class="comment">/* Or the interface of the dld (i.e., &quot;shl_load&quot; or friends)?  */</span>
<a name="l00495"></a>00495   <span class="keywordflow">if</span> ((u_pc == <a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.load.unwind)
<a name="l00496"></a>00496       || (u_pc == <a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.unload.unwind)
<a name="l00497"></a>00497       || (u_pc == <a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.unload2.unwind)
<a name="l00498"></a>00498       || (u_pc == <a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.load_stub.unwind)
<a name="l00499"></a>00499       || (u_pc == <a class="code" href="solib-som_8c.html#a48f2baebb7eb1988c6a0e3f07c480fdc">dld_cache</a>.unload_stub.unwind))
<a name="l00500"></a>00500     <span class="keywordflow">return</span> 1;
<a name="l00501"></a>00501 
<a name="l00502"></a>00502   <span class="comment">/* Apparently this address isn&#39;t part of the dld&#39;s text.  */</span>
<a name="l00503"></a>00503   <span class="keywordflow">return</span> 0;
<a name="l00504"></a>00504 }
<a name="l00505"></a>00505 
<a name="l00506"></a>00506 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00507"></a><a class="code" href="solib-som_8c.html#a4f9d7b6ceb1860812014c89de80c6948">00507</a> <a class="code" href="solib-som_8c.html#a4f9d7b6ceb1860812014c89de80c6948">som_clear_solib</a> (<span class="keywordtype">void</span>)
<a name="l00508"></a>00508 {
<a name="l00509"></a>00509 }
<a name="l00510"></a>00510 
<a name="l00511"></a><a class="code" href="structdld__list.html">00511</a> <span class="keyword">struct </span><a class="code" href="structdld__list.html">dld_list</a> {
<a name="l00512"></a><a class="code" href="structdld__list.html#a9ecaef99b8f37a74be3ce7b48730b53c">00512</a>   <span class="keywordtype">char</span> <a class="code" href="structdld__list.html#a9ecaef99b8f37a74be3ce7b48730b53c">name</a>[4];
<a name="l00513"></a><a class="code" href="structdld__list.html#a0031caaaee911a65d215c81fabc724c8">00513</a>   <span class="keywordtype">char</span> <a class="code" href="structdld__list.html#a0031caaaee911a65d215c81fabc724c8">info</a>[4];
<a name="l00514"></a><a class="code" href="structdld__list.html#a371e13d4d41aa20655acd964729c340a">00514</a>   <span class="keywordtype">char</span> <a class="code" href="structdld__list.html#a371e13d4d41aa20655acd964729c340a">text_addr</a>[4];
<a name="l00515"></a><a class="code" href="structdld__list.html#a924311bf0baaa74c43c64a94f3dc8f5d">00515</a>   <span class="keywordtype">char</span> <a class="code" href="structdld__list.html#a924311bf0baaa74c43c64a94f3dc8f5d">text_link_addr</a>[4];
<a name="l00516"></a><a class="code" href="structdld__list.html#a1d09e97fe5fc9cc3b35a97f37833c931">00516</a>   <span class="keywordtype">char</span> <a class="code" href="structdld__list.html#a1d09e97fe5fc9cc3b35a97f37833c931">text_end</a>[4];
<a name="l00517"></a><a class="code" href="structdld__list.html#a2806870451888d2da0656ad99dbe3eeb">00517</a>   <span class="keywordtype">char</span> <a class="code" href="structdld__list.html#a2806870451888d2da0656ad99dbe3eeb">data_start</a>[4];
<a name="l00518"></a><a class="code" href="structdld__list.html#ae9a6a32d8f489325e7d688b26c8080b6">00518</a>   <span class="keywordtype">char</span> <a class="code" href="structdld__list.html#ae9a6a32d8f489325e7d688b26c8080b6">bss_start</a>[4];
<a name="l00519"></a><a class="code" href="structdld__list.html#ad56d1cfbb356fe230de34cc1f974fff8">00519</a>   <span class="keywordtype">char</span> <a class="code" href="structdld__list.html#ad56d1cfbb356fe230de34cc1f974fff8">data_end</a>[4];
<a name="l00520"></a><a class="code" href="structdld__list.html#a13917e340d6e0d7e3efd04c444506759">00520</a>   <span class="keywordtype">char</span> <a class="code" href="structdld__list.html#a13917e340d6e0d7e3efd04c444506759">got_value</a>[4];
<a name="l00521"></a><a class="code" href="structdld__list.html#a0775f2fc871e859e92132f79cd2390f5">00521</a>   <span class="keywordtype">char</span> <a class="code" href="structdld__list.html#a0775f2fc871e859e92132f79cd2390f5">next</a>[4];
<a name="l00522"></a><a class="code" href="structdld__list.html#a9974627fe302fd5180071a5be5dc1fd0">00522</a>   <span class="keywordtype">char</span> <a class="code" href="structdld__list.html#a9974627fe302fd5180071a5be5dc1fd0">tsd_start_addr_ptr</a>[4];
<a name="l00523"></a>00523 };
<a name="l00524"></a>00524 
<a name="l00525"></a>00525 <span class="keyword">static</span> <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a>
<a name="l00526"></a><a class="code" href="solib-som_8c.html#abe52fd060ff70d9902b878c83f99cf3b">00526</a> <a class="code" href="solib-som_8c.html#abe52fd060ff70d9902b878c83f99cf3b">link_map_start</a> (<span class="keywordtype">void</span>)
<a name="l00527"></a>00527 {
<a name="l00528"></a>00528   <span class="keyword">enum</span> bfd_endian byte_order = <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ());
<a name="l00529"></a>00529   <span class="keyword">struct </span><a class="code" href="structminimal__symbol.html">minimal_symbol</a> *sym;
<a name="l00530"></a>00530   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> addr;
<a name="l00531"></a>00531   <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> buf[4];
<a name="l00532"></a>00532   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dld_flags;
<a name="l00533"></a>00533 
<a name="l00534"></a>00534   sym = <a class="code" href="minsyms_8c.html#af87f7a894386515074ddd71365bc09b8">lookup_minimal_symbol</a> (<span class="stringliteral">&quot;__dld_flags&quot;</span>, NULL, NULL);
<a name="l00535"></a>00535   <span class="keywordflow">if</span> (!sym)
<a name="l00536"></a>00536     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Unable to find __dld_flags symbol in object file.&quot;</span>));
<a name="l00537"></a>00537   addr = <a class="code" href="symtab_8h.html#abee697b9e3bb4f4d164ad920a87ab854">SYMBOL_VALUE_ADDRESS</a> (sym);
<a name="l00538"></a>00538   <a class="code" href="corefile_8c.html#a5e0189c6f21f1c9321b379877183b819">read_memory</a> (addr, buf, 4);
<a name="l00539"></a>00539   dld_flags = <a class="code" href="defs_8h.html#a99aec65329508b4d449a4f881026f844">extract_unsigned_integer</a> (buf, 4, byte_order);
<a name="l00540"></a>00540   <span class="keywordflow">if</span> ((dld_flags &amp; <a class="code" href="solib-som_8c.html#a8522cf8ea445d26130f9017804d2de09">DLD_FLAGS_LISTVALID</a>) == 0)
<a name="l00541"></a>00541     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;__dld_list is not valid according to __dld_flags.&quot;</span>));
<a name="l00542"></a>00542 
<a name="l00543"></a>00543   sym = <a class="code" href="minsyms_8c.html#af87f7a894386515074ddd71365bc09b8">lookup_minimal_symbol</a> (<span class="stringliteral">&quot;__dld_list&quot;</span>, NULL, NULL);
<a name="l00544"></a>00544   <span class="keywordflow">if</span> (!sym)
<a name="l00545"></a>00545     {
<a name="l00546"></a>00546       <span class="comment">/* Older crt0.o files (hpux8) don&#39;t have __dld_list as a symbol,</span>
<a name="l00547"></a>00547 <span class="comment">         but the data is still available if you know where to look.  */</span>
<a name="l00548"></a>00548       sym = <a class="code" href="minsyms_8c.html#af87f7a894386515074ddd71365bc09b8">lookup_minimal_symbol</a> (<span class="stringliteral">&quot;__dld_flags&quot;</span>, NULL, NULL);
<a name="l00549"></a>00549       <span class="keywordflow">if</span> (!sym)
<a name="l00550"></a>00550         {
<a name="l00551"></a>00551           <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Unable to find dynamic library list.&quot;</span>));
<a name="l00552"></a>00552           <span class="keywordflow">return</span> 0;
<a name="l00553"></a>00553         }
<a name="l00554"></a>00554       addr = <a class="code" href="symtab_8h.html#abee697b9e3bb4f4d164ad920a87ab854">SYMBOL_VALUE_ADDRESS</a> (sym) - 8;
<a name="l00555"></a>00555     }
<a name="l00556"></a>00556   <span class="keywordflow">else</span>
<a name="l00557"></a>00557     addr = <a class="code" href="symtab_8h.html#abee697b9e3bb4f4d164ad920a87ab854">SYMBOL_VALUE_ADDRESS</a> (sym);
<a name="l00558"></a>00558 
<a name="l00559"></a>00559   <a class="code" href="corefile_8c.html#a5e0189c6f21f1c9321b379877183b819">read_memory</a> (addr, buf, 4);
<a name="l00560"></a>00560   addr = <a class="code" href="defs_8h.html#a99aec65329508b4d449a4f881026f844">extract_unsigned_integer</a> (buf, 4, byte_order);
<a name="l00561"></a>00561   <span class="keywordflow">if</span> (addr == 0)
<a name="l00562"></a>00562     <span class="keywordflow">return</span> 0;
<a name="l00563"></a>00563 
<a name="l00564"></a>00564   <a class="code" href="corefile_8c.html#a5e0189c6f21f1c9321b379877183b819">read_memory</a> (addr, buf, 4);
<a name="l00565"></a>00565   <span class="keywordflow">return</span> <a class="code" href="defs_8h.html#a99aec65329508b4d449a4f881026f844">extract_unsigned_integer</a> (buf, 4, byte_order);
<a name="l00566"></a>00566 }
<a name="l00567"></a>00567 
<a name="l00568"></a>00568 <span class="comment">/* Does this so&#39;s name match the main binary?  */</span>
<a name="l00569"></a>00569 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00570"></a><a class="code" href="solib-som_8c.html#aced968f42f1495983bd273b63c7a6c7e">00570</a> <a class="code" href="solib-som_8c.html#aced968f42f1495983bd273b63c7a6c7e">match_main</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="aarch64-tdep_8c.html#acc128f98d9ceca227038c771308eff39">name</a>)
<a name="l00571"></a>00571 {
<a name="l00572"></a>00572   <span class="keywordflow">return</span> strcmp (name, <a class="code" href="objfiles_8c.html#a33e548a19b86b293435d3c2d6daaaec6">objfile_name</a> (<a class="code" href="progspace_8h.html#a4e703bd0d59c70e069bed3b4d9e1936b">symfile_objfile</a>)) == 0;
<a name="l00573"></a>00573 }
<a name="l00574"></a>00574 
<a name="l00575"></a>00575 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structso__list.html">so_list</a> *
<a name="l00576"></a><a class="code" href="solib-som_8c.html#a2fcc8c48f7ef1fa9412e7f3d838117a2">00576</a> <a class="code" href="solib-som_8c.html#a2fcc8c48f7ef1fa9412e7f3d838117a2">som_current_sos</a> (<span class="keywordtype">void</span>)
<a name="l00577"></a>00577 {
<a name="l00578"></a>00578   <span class="keyword">enum</span> bfd_endian byte_order = <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ());
<a name="l00579"></a>00579   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> lm;
<a name="l00580"></a>00580   <span class="keyword">struct </span><a class="code" href="structso__list.html">so_list</a> *head = 0;
<a name="l00581"></a>00581   <span class="keyword">struct </span><a class="code" href="structso__list.html">so_list</a> **link_ptr = &amp;head;
<a name="l00582"></a>00582 
<a name="l00583"></a>00583   <span class="keywordflow">for</span> (lm = <a class="code" href="solib-som_8c.html#abe52fd060ff70d9902b878c83f99cf3b">link_map_start</a> (); lm; )
<a name="l00584"></a>00584     {
<a name="l00585"></a>00585       <span class="keywordtype">char</span> *namebuf;
<a name="l00586"></a>00586       <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> addr;
<a name="l00587"></a>00587       <span class="keyword">struct </span><a class="code" href="structso__list.html">so_list</a> *<span class="keyword">new</span>;
<a name="l00588"></a>00588       <span class="keyword">struct </span><a class="code" href="structcleanup.html">cleanup</a> *old_chain;
<a name="l00589"></a>00589       <span class="keywordtype">int</span> errcode;
<a name="l00590"></a>00590       <span class="keyword">struct </span><a class="code" href="structdld__list.html">dld_list</a> dbuf;
<a name="l00591"></a>00591       <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> tsdbuf[4];
<a name="l00592"></a>00592 
<a name="l00593"></a>00593       <span class="keyword">new</span> = (<span class="keyword">struct </span><a class="code" href="structso__list.html">so_list</a> *) <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (<span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structso__list.html">so_list</a>));
<a name="l00594"></a>00594       old_chain = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, <span class="keyword">new</span>);
<a name="l00595"></a>00595 
<a name="l00596"></a>00596       <a class="code" href="gdb__string_8h.html#adb03df3679ce1445e801310614624ccb">memset</a> (<span class="keyword">new</span>, 0, <span class="keyword">sizeof</span> (*<span class="keyword">new</span>));
<a name="l00597"></a>00597       <span class="keyword">new</span>-&gt;lm_info = <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (<span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structlm__info.html">lm_info</a>));
<a name="l00598"></a>00598       <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, new-&gt;lm_info);
<a name="l00599"></a>00599 
<a name="l00600"></a>00600       <a class="code" href="corefile_8c.html#a5e0189c6f21f1c9321b379877183b819">read_memory</a> (lm, (<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *)&amp;dbuf, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structdld__list.html">dld_list</a>));
<a name="l00601"></a>00601 
<a name="l00602"></a>00602       addr = <a class="code" href="defs_8h.html#a99aec65329508b4d449a4f881026f844">extract_unsigned_integer</a> ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *)&amp;dbuf.name,
<a name="l00603"></a>00603                                        sizeof (dbuf.name), byte_order);
<a name="l00604"></a>00604       <a class="code" href="target_8c.html#a394bfbed99bddd14b28ca9b6538292c2">target_read_string</a> (addr, &amp;namebuf, <a class="code" href="solist_8h.html#ae1d2bc9bc8646c7ea3e63f3c20a1ef86">SO_NAME_MAX_PATH_SIZE</a> - 1, &amp;errcode);
<a name="l00605"></a>00605       <span class="keywordflow">if</span> (errcode != 0)
<a name="l00606"></a>00606         <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Can&#39;t read pathname for load map: %s.&quot;</span>),
<a name="l00607"></a>00607                  <a class="code" href="mingw-hdep_8c.html#a69f9363599db68d3ff495cd5e78f6b62">safe_strerror</a> (errcode));
<a name="l00608"></a>00608       <span class="keywordflow">else</span>
<a name="l00609"></a>00609         {
<a name="l00610"></a>00610           strncpy (new-&gt;so_name, namebuf, <a class="code" href="solist_8h.html#ae1d2bc9bc8646c7ea3e63f3c20a1ef86">SO_NAME_MAX_PATH_SIZE</a> - 1);
<a name="l00611"></a>00611           <span class="keyword">new</span>-&gt;so_name[<a class="code" href="solist_8h.html#ae1d2bc9bc8646c7ea3e63f3c20a1ef86">SO_NAME_MAX_PATH_SIZE</a> - 1] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00612"></a>00612           <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (namebuf);
<a name="l00613"></a>00613           strcpy (new-&gt;so_original_name, new-&gt;so_name);
<a name="l00614"></a>00614         }
<a name="l00615"></a>00615 
<a name="l00616"></a>00616         <span class="keywordflow">if</span> (new-&gt;so_name[0] &amp;&amp; !<a class="code" href="solib-som_8c.html#aced968f42f1495983bd273b63c7a6c7e">match_main</a> (new-&gt;so_name))
<a name="l00617"></a>00617           {
<a name="l00618"></a>00618             <span class="keyword">struct </span><a class="code" href="structlm__info.html">lm_info</a> *lmi = <span class="keyword">new</span>-&gt;lm_info;
<a name="l00619"></a>00619             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tmp;
<a name="l00620"></a>00620 
<a name="l00621"></a>00621             lmi-&gt;<a class="code" href="structlm__info.html#a77b7677e3b3e86706a36bda2b9bd557c">lm_addr</a> = <a class="code" href="structlm__info.html#a60517b8a0f13fccc3b947519ff4ae7ed">lm</a>;
<a name="l00622"></a>00622 
<a name="l00623"></a>00623 <span class="preprocessor">#define EXTRACT(_fld) \</span>
<a name="l00624"></a>00624 <span class="preprocessor">  extract_unsigned_integer ((gdb_byte *)&amp;dbuf._fld, \</span>
<a name="l00625"></a>00625 <span class="preprocessor">                            sizeof (dbuf._fld), byte_order);</span>
<a name="l00626"></a>00626 <span class="preprocessor"></span>
<a name="l00627"></a>00627             lmi-&gt;<a class="code" href="structlm__info.html#ae00d156f2af9fd69803b6dd7688efacc">text_addr</a> = <a class="code" href="solib-som_8c.html#aa2b582e5e17e8802240d61525d252213">EXTRACT</a> (<a class="code" href="structlm__info.html#ae00d156f2af9fd69803b6dd7688efacc">text_addr</a>);
<a name="l00628"></a>00628             tmp = <a class="code" href="solib-som_8c.html#aa2b582e5e17e8802240d61525d252213">EXTRACT</a> (info);
<a name="l00629"></a>00629             lmi-&gt;<a class="code" href="structlm__info.html#a264cbeaef12f0e2a5c366b494cc0f11f">library_version</a> = (tmp &gt;&gt; 16) &amp; 0xffff;
<a name="l00630"></a>00630             lmi-&gt;<a class="code" href="structlm__info.html#a0c0b34053c7dd3fee618e6f1e0c4701c">bind_mode</a> = (tmp &gt;&gt; 8) &amp; 0xff;
<a name="l00631"></a>00631             lmi-&gt;<a class="code" href="structlm__info.html#a9a1169b41d1bb1fd22b56dccfa334551">struct_version</a> = tmp &amp; 0xff;
<a name="l00632"></a>00632             lmi-&gt;<a class="code" href="structlm__info.html#a338e850e765caa5fbf5613116e497964">text_link_addr</a> = <a class="code" href="solib-som_8c.html#aa2b582e5e17e8802240d61525d252213">EXTRACT</a> (<a class="code" href="structlm__info.html#a338e850e765caa5fbf5613116e497964">text_link_addr</a>);
<a name="l00633"></a>00633             lmi-&gt;<a class="code" href="structlm__info.html#adf330cc135b8331b1ba0185f4cea1705">text_end</a> = <a class="code" href="solib-som_8c.html#aa2b582e5e17e8802240d61525d252213">EXTRACT</a> (<a class="code" href="structlm__info.html#adf330cc135b8331b1ba0185f4cea1705">text_end</a>);
<a name="l00634"></a>00634             lmi-&gt;<a class="code" href="structlm__info.html#a125d34e728ec8f024c31bf7777838119">data_start</a> = <a class="code" href="solib-som_8c.html#aa2b582e5e17e8802240d61525d252213">EXTRACT</a> (<a class="code" href="structlm__info.html#a125d34e728ec8f024c31bf7777838119">data_start</a>);
<a name="l00635"></a>00635             lmi-&gt;<a class="code" href="structlm__info.html#aa9403fdcaf6e8b1fd7cd5097845c579b">bss_start</a> = <a class="code" href="solib-som_8c.html#aa2b582e5e17e8802240d61525d252213">EXTRACT</a> (<a class="code" href="structlm__info.html#aa9403fdcaf6e8b1fd7cd5097845c579b">bss_start</a>);
<a name="l00636"></a>00636             lmi-&gt;<a class="code" href="structlm__info.html#a7eea420b74d811bb2c6832ab089bfcd2">data_end</a> = <a class="code" href="solib-som_8c.html#aa2b582e5e17e8802240d61525d252213">EXTRACT</a> (<a class="code" href="structlm__info.html#a7eea420b74d811bb2c6832ab089bfcd2">data_end</a>);
<a name="l00637"></a>00637             lmi-&gt;<a class="code" href="structlm__info.html#a75cb2ce292e8a677fb3297c96370dd5c">got_value</a> = <a class="code" href="solib-som_8c.html#aa2b582e5e17e8802240d61525d252213">EXTRACT</a> (<a class="code" href="structlm__info.html#a75cb2ce292e8a677fb3297c96370dd5c">got_value</a>);
<a name="l00638"></a>00638             tmp = <a class="code" href="solib-som_8c.html#aa2b582e5e17e8802240d61525d252213">EXTRACT</a> (tsd_start_addr_ptr);
<a name="l00639"></a>00639             <a class="code" href="corefile_8c.html#a5e0189c6f21f1c9321b379877183b819">read_memory</a> (tmp, tsdbuf, 4);
<a name="l00640"></a>00640             lmi-&gt;<a class="code" href="structlm__info.html#acb351893ee21de082e9521bd2a4493b7">tsd_start_addr</a>
<a name="l00641"></a>00641               = <a class="code" href="defs_8h.html#a99aec65329508b4d449a4f881026f844">extract_unsigned_integer</a> (tsdbuf, 4, byte_order);
<a name="l00642"></a>00642 
<a name="l00643"></a>00643 <span class="preprocessor">#ifdef SOLIB_SOM_DBG</span>
<a name="l00644"></a>00644 <span class="preprocessor"></span>            printf (<span class="stringliteral">&quot;\n+ library \&quot;%s\&quot; is described at %s\n&quot;</span>, new-&gt;so_name,
<a name="l00645"></a>00645                     <a class="code" href="utils_8c.html#ab5c76d72090f01d3848b63dda4e37d1c">paddress</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> (), lm));
<a name="l00646"></a>00646             printf (<span class="stringliteral">&quot;  &#39;version&#39; is %d\n&quot;</span>, new-&gt;lm_info-&gt;struct_version);
<a name="l00647"></a>00647             printf (<span class="stringliteral">&quot;  &#39;bind_mode&#39; is %d\n&quot;</span>, new-&gt;lm_info-&gt;bind_mode);
<a name="l00648"></a>00648             printf (<span class="stringliteral">&quot;  &#39;library_version&#39; is %d\n&quot;</span>, 
<a name="l00649"></a>00649                     new-&gt;lm_info-&gt;library_version);
<a name="l00650"></a>00650             printf (<span class="stringliteral">&quot;  &#39;text_addr&#39; is %s\n&quot;</span>,
<a name="l00651"></a>00651                     <a class="code" href="utils_8c.html#ab5c76d72090f01d3848b63dda4e37d1c">paddress</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> (), new-&gt;lm_info-&gt;text_addr));
<a name="l00652"></a>00652             printf (<span class="stringliteral">&quot;  &#39;text_link_addr&#39; is %s\n&quot;</span>,
<a name="l00653"></a>00653                     <a class="code" href="utils_8c.html#ab5c76d72090f01d3848b63dda4e37d1c">paddress</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> (), new-&gt;lm_info-&gt;text_link_addr));
<a name="l00654"></a>00654             printf (<span class="stringliteral">&quot;  &#39;text_end&#39; is %s\n&quot;</span>,
<a name="l00655"></a>00655                     <a class="code" href="utils_8c.html#ab5c76d72090f01d3848b63dda4e37d1c">paddress</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> (), new-&gt;lm_info-&gt;text_end));
<a name="l00656"></a>00656             printf (<span class="stringliteral">&quot;  &#39;data_start&#39; is %s\n&quot;</span>,
<a name="l00657"></a>00657                     <a class="code" href="utils_8c.html#ab5c76d72090f01d3848b63dda4e37d1c">paddress</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> (), new-&gt;lm_info-&gt;data_start));
<a name="l00658"></a>00658             printf (<span class="stringliteral">&quot;  &#39;bss_start&#39; is %s\n&quot;</span>,
<a name="l00659"></a>00659                     <a class="code" href="utils_8c.html#ab5c76d72090f01d3848b63dda4e37d1c">paddress</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> (), new-&gt;lm_info-&gt;bss_start));
<a name="l00660"></a>00660             printf (<span class="stringliteral">&quot;  &#39;data_end&#39; is %s\n&quot;</span>,
<a name="l00661"></a>00661                     <a class="code" href="utils_8c.html#ab5c76d72090f01d3848b63dda4e37d1c">paddress</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> (), new-&gt;lm_info-&gt;data_end));
<a name="l00662"></a>00662             printf (<span class="stringliteral">&quot;  &#39;got_value&#39; is %s\n&quot;</span>,
<a name="l00663"></a>00663                     <a class="code" href="utils_8c.html#ab5c76d72090f01d3848b63dda4e37d1c">paddress</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> (), new-&gt;lm_info-&gt;got_value));
<a name="l00664"></a>00664             printf (<span class="stringliteral">&quot;  &#39;tsd_start_addr&#39; is %s\n&quot;</span>,
<a name="l00665"></a>00665                     <a class="code" href="utils_8c.html#ab5c76d72090f01d3848b63dda4e37d1c">paddress</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> (), new-&gt;lm_info-&gt;tsd_start_addr));
<a name="l00666"></a>00666 <span class="preprocessor">#endif</span>
<a name="l00667"></a>00667 <span class="preprocessor"></span>
<a name="l00668"></a>00668             <span class="keyword">new</span>-&gt;addr_low = lmi-&gt;<a class="code" href="structlm__info.html#ae00d156f2af9fd69803b6dd7688efacc">text_addr</a>;
<a name="l00669"></a>00669             <span class="keyword">new</span>-&gt;addr_high = lmi-&gt;<a class="code" href="structlm__info.html#adf330cc135b8331b1ba0185f4cea1705">text_end</a>;
<a name="l00670"></a>00670 
<a name="l00671"></a>00671             <span class="comment">/* Link the new object onto the list.  */</span>
<a name="l00672"></a>00672             <span class="keyword">new</span>-&gt;next = NULL;
<a name="l00673"></a>00673             *link_ptr = <span class="keyword">new</span>;
<a name="l00674"></a>00674             link_ptr = &amp;<span class="keyword">new</span>-&gt;<a class="code" href="structso__list.html#abd46cbdf1660c79a104e6af57af31df9">next</a>;
<a name="l00675"></a>00675           }
<a name="l00676"></a>00676         <span class="keywordflow">else</span>
<a name="l00677"></a>00677           {
<a name="l00678"></a>00678             <a class="code" href="solib_8c.html#a3fdb0779b9680743df73f5fbd2163e8f">free_so</a> (<span class="keyword">new</span>);
<a name="l00679"></a>00679           }
<a name="l00680"></a>00680 
<a name="l00681"></a>00681       lm = <a class="code" href="solib-som_8c.html#aa2b582e5e17e8802240d61525d252213">EXTRACT</a> (<a class="code" href="structlm__info.html#a2a1bab842479b89e2d44bb571f38b958">next</a>);
<a name="l00682"></a>00682       <a class="code" href="cleanups_8c.html#a5ec3987bf995edcc44def9e17ada6eba">discard_cleanups</a> (old_chain);
<a name="l00683"></a>00683 <span class="preprocessor">#undef EXTRACT</span>
<a name="l00684"></a>00684 <span class="preprocessor"></span>    }
<a name="l00685"></a>00685 
<a name="l00686"></a>00686   <span class="comment">/* TODO: The original somsolib code has logic to detect and eliminate </span>
<a name="l00687"></a>00687 <span class="comment">     duplicate entries.  Do we need that?  */</span>
<a name="l00688"></a>00688 
<a name="l00689"></a>00689   <span class="keywordflow">return</span> head;
<a name="l00690"></a>00690 }
<a name="l00691"></a>00691 
<a name="l00692"></a>00692 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00693"></a><a class="code" href="solib-som_8c.html#a01ebdf6ec3b20afb4c30037b8aec878e">00693</a> <a class="code" href="solib-som_8c.html#a01ebdf6ec3b20afb4c30037b8aec878e">som_open_symbol_file_object</a> (<span class="keywordtype">void</span> *from_ttyp)
<a name="l00694"></a>00694 {
<a name="l00695"></a>00695   <span class="keyword">enum</span> bfd_endian byte_order = <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ());
<a name="l00696"></a>00696   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> <a class="code" href="structlm__info.html#a60517b8a0f13fccc3b947519ff4ae7ed">lm</a>, <a class="code" href="structlm__info.html#aaad7a075df2089c6b378f87216fbd2bb">l_name</a>;
<a name="l00697"></a>00697   <span class="keywordtype">char</span> *<a class="code" href="structlm__info.html#aa1962f391ccfdcbb760689d67448091a">filename</a>;
<a name="l00698"></a>00698   <span class="keywordtype">int</span> errcode;
<a name="l00699"></a>00699   <span class="keywordtype">int</span> from_tty = *(<span class="keywordtype">int</span> *)from_ttyp;
<a name="l00700"></a>00700   <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> buf[4];
<a name="l00701"></a>00701   <span class="keyword">struct </span><a class="code" href="structcleanup.html">cleanup</a> *<a class="code" href="structcleanup.html">cleanup</a>;
<a name="l00702"></a>00702 
<a name="l00703"></a>00703   <span class="keywordflow">if</span> (<a class="code" href="progspace_8h.html#a4e703bd0d59c70e069bed3b4d9e1936b">symfile_objfile</a>)
<a name="l00704"></a>00704     <span class="keywordflow">if</span> (!<a class="code" href="utils_8c.html#a4b369431cd1ce5d26bccf6b79a44c085">query</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Attempt to reload symbols from process? &quot;</span>)))
<a name="l00705"></a>00705       <span class="keywordflow">return</span> 0;
<a name="l00706"></a>00706 
<a name="l00707"></a>00707   <span class="comment">/* First link map member should be the executable.  */</span>
<a name="l00708"></a>00708   <span class="keywordflow">if</span> ((lm = <a class="code" href="solib-som_8c.html#abe52fd060ff70d9902b878c83f99cf3b">link_map_start</a> ()) == 0)
<a name="l00709"></a>00709     <span class="keywordflow">return</span> 0;   <span class="comment">/* failed somehow...  */</span>
<a name="l00710"></a>00710 
<a name="l00711"></a>00711   <span class="comment">/* Read address of name from target memory to GDB.  */</span>
<a name="l00712"></a>00712   <a class="code" href="corefile_8c.html#a5e0189c6f21f1c9321b379877183b819">read_memory</a> (lm + offsetof (<span class="keyword">struct</span> <a class="code" href="structdld__list.html">dld_list</a>, <a class="code" href="aarch64-tdep_8c.html#acc128f98d9ceca227038c771308eff39">name</a>), buf, 4);
<a name="l00713"></a>00713 
<a name="l00714"></a>00714   <span class="comment">/* Convert the address to host format.  Assume that the address is</span>
<a name="l00715"></a>00715 <span class="comment">     unsigned.  */</span>
<a name="l00716"></a>00716   l_name = <a class="code" href="defs_8h.html#a99aec65329508b4d449a4f881026f844">extract_unsigned_integer</a> (buf, 4, byte_order);
<a name="l00717"></a>00717 
<a name="l00718"></a>00718   <span class="keywordflow">if</span> (l_name == 0)
<a name="l00719"></a>00719     <span class="keywordflow">return</span> 0;           <span class="comment">/* No filename.  */</span>
<a name="l00720"></a>00720 
<a name="l00721"></a>00721   <span class="comment">/* Now fetch the filename from target memory.  */</span>
<a name="l00722"></a>00722   <a class="code" href="target_8c.html#a394bfbed99bddd14b28ca9b6538292c2">target_read_string</a> (l_name, &amp;filename, <a class="code" href="solist_8h.html#ae1d2bc9bc8646c7ea3e63f3c20a1ef86">SO_NAME_MAX_PATH_SIZE</a> - 1, &amp;errcode);
<a name="l00723"></a>00723 
<a name="l00724"></a>00724   <span class="keywordflow">if</span> (errcode)
<a name="l00725"></a>00725     {
<a name="l00726"></a>00726       <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;failed to read exec filename from attached file: %s&quot;</span>),
<a name="l00727"></a>00727                <a class="code" href="mingw-hdep_8c.html#a69f9363599db68d3ff495cd5e78f6b62">safe_strerror</a> (errcode));
<a name="l00728"></a>00728       <span class="keywordflow">return</span> 0;
<a name="l00729"></a>00729     }
<a name="l00730"></a>00730 
<a name="l00731"></a>00731   cleanup = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, filename);
<a name="l00732"></a>00732   <span class="comment">/* Have a pathname: read the symbol file.  */</span>
<a name="l00733"></a>00733   <a class="code" href="symfile_8c.html#ac81d8eef3d0558750ba65252613890ed">symbol_file_add_main</a> (filename, from_tty);
<a name="l00734"></a>00734 
<a name="l00735"></a>00735   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup);
<a name="l00736"></a>00736   <span class="keywordflow">return</span> 1;
<a name="l00737"></a>00737 }
<a name="l00738"></a>00738 
<a name="l00739"></a>00739 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00740"></a><a class="code" href="solib-som_8c.html#ab7a5e3116a34d30361689ff7246078c6">00740</a> <a class="code" href="solib-som_8c.html#ab7a5e3116a34d30361689ff7246078c6">som_free_so</a> (<span class="keyword">struct</span> <a class="code" href="structso__list.html">so_list</a> *so)
<a name="l00741"></a>00741 {
<a name="l00742"></a>00742   <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (so-&gt;<a class="code" href="structso__list.html#a7b3094a89d8a05f6905733cab8c6e8e9">lm_info</a>);
<a name="l00743"></a>00743 }
<a name="l00744"></a>00744 
<a name="l00745"></a>00745 <span class="keyword">static</span> <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a>
<a name="l00746"></a><a class="code" href="solib-som_8c.html#aa3166ae44746ad3948305614508d1adf">00746</a> <a class="code" href="solib-som_8c.html#aa3166ae44746ad3948305614508d1adf">som_solib_thread_start_addr</a> (<span class="keyword">struct</span> <a class="code" href="structso__list.html">so_list</a> *so)
<a name="l00747"></a>00747 {
<a name="l00748"></a>00748   <span class="keywordflow">return</span> so-&gt;<a class="code" href="structso__list.html#a7b3094a89d8a05f6905733cab8c6e8e9">lm_info</a>-&gt;<a class="code" href="structlm__info.html#acb351893ee21de082e9521bd2a4493b7">tsd_start_addr</a>;
<a name="l00749"></a>00749 }
<a name="l00750"></a>00750 
<a name="l00751"></a>00751 <span class="comment">/* Return the GOT value for the shared library in which ADDR belongs.  If</span>
<a name="l00752"></a>00752 <span class="comment">   ADDR isn&#39;t in any known shared library, return zero.  */</span>
<a name="l00753"></a>00753 
<a name="l00754"></a>00754 <span class="keyword">static</span> <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a>
<a name="l00755"></a><a class="code" href="solib-som_8c.html#a939916b42a640df5c38a3f2e14fc3952">00755</a> <a class="code" href="solib-som_8c.html#a939916b42a640df5c38a3f2e14fc3952">som_solib_get_got_by_pc</a> (<a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> addr)
<a name="l00756"></a>00756 {
<a name="l00757"></a>00757   <span class="keyword">struct </span><a class="code" href="structso__list.html">so_list</a> *<a class="code" href="structso__list.html">so_list</a> = <a class="code" href="solib_8c.html#a5488621c1e7370ffc6eb4f50c97e9484">master_so_list</a> ();
<a name="l00758"></a>00758   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> got_value = 0;
<a name="l00759"></a>00759 
<a name="l00760"></a>00760   <span class="keywordflow">while</span> (so_list)
<a name="l00761"></a>00761     {
<a name="l00762"></a>00762       <span class="keywordflow">if</span> (so_list-&gt;<a class="code" href="structso__list.html#a7b3094a89d8a05f6905733cab8c6e8e9">lm_info</a>-&gt;<a class="code" href="structlm__info.html#ae00d156f2af9fd69803b6dd7688efacc">text_addr</a> &lt;= addr
<a name="l00763"></a>00763           &amp;&amp; so_list-&gt;<a class="code" href="structso__list.html#a7b3094a89d8a05f6905733cab8c6e8e9">lm_info</a>-&gt;<a class="code" href="structlm__info.html#adf330cc135b8331b1ba0185f4cea1705">text_end</a> &gt; addr)
<a name="l00764"></a>00764         {
<a name="l00765"></a>00765           got_value = so_list-&gt;<a class="code" href="structso__list.html#a7b3094a89d8a05f6905733cab8c6e8e9">lm_info</a>-&gt;<a class="code" href="structlm__info.html#a75cb2ce292e8a677fb3297c96370dd5c">got_value</a>;
<a name="l00766"></a>00766           <span class="keywordflow">break</span>;
<a name="l00767"></a>00767         }
<a name="l00768"></a>00768       so_list = so_list-&gt;<a class="code" href="structso__list.html#abd46cbdf1660c79a104e6af57af31df9">next</a>;
<a name="l00769"></a>00769     }
<a name="l00770"></a>00770   <span class="keywordflow">return</span> got_value;
<a name="l00771"></a>00771 }
<a name="l00772"></a>00772 
<a name="l00773"></a>00773 <span class="comment">/* Return the address of the handle of the shared library in which</span>
<a name="l00774"></a>00774 <span class="comment">   ADDR belongs.  If ADDR isn&#39;t in any known shared library, return</span>
<a name="l00775"></a>00775 <span class="comment">   zero.  */</span>
<a name="l00776"></a>00776 <span class="comment">/* This function is used in initialize_hp_cxx_exception_support in </span>
<a name="l00777"></a>00777 <span class="comment">   hppa-hpux-tdep.c.  */</span>
<a name="l00778"></a>00778 
<a name="l00779"></a>00779 <span class="keyword">static</span> <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a>
<a name="l00780"></a><a class="code" href="solib-som_8c.html#a4ca93a848cd14791a010cddb9871fec8">00780</a> <a class="code" href="solib-som_8c.html#a4ca93a848cd14791a010cddb9871fec8">som_solib_get_solib_by_pc</a> (<a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> addr)
<a name="l00781"></a>00781 {
<a name="l00782"></a>00782   <span class="keyword">struct </span><a class="code" href="structso__list.html">so_list</a> *<a class="code" href="structso__list.html">so_list</a> = <a class="code" href="solib_8c.html#a5488621c1e7370ffc6eb4f50c97e9484">master_so_list</a> ();
<a name="l00783"></a>00783 
<a name="l00784"></a>00784   <span class="keywordflow">while</span> (so_list)
<a name="l00785"></a>00785     {
<a name="l00786"></a>00786       <span class="keywordflow">if</span> (so_list-&gt;<a class="code" href="structso__list.html#a7b3094a89d8a05f6905733cab8c6e8e9">lm_info</a>-&gt;<a class="code" href="structlm__info.html#ae00d156f2af9fd69803b6dd7688efacc">text_addr</a> &lt;= addr
<a name="l00787"></a>00787           &amp;&amp; so_list-&gt;<a class="code" href="structso__list.html#a7b3094a89d8a05f6905733cab8c6e8e9">lm_info</a>-&gt;<a class="code" href="structlm__info.html#adf330cc135b8331b1ba0185f4cea1705">text_end</a> &gt; addr)
<a name="l00788"></a>00788         {
<a name="l00789"></a>00789           <span class="keywordflow">break</span>;
<a name="l00790"></a>00790         }
<a name="l00791"></a>00791       so_list = so_list-&gt;<a class="code" href="structso__list.html#abd46cbdf1660c79a104e6af57af31df9">next</a>;
<a name="l00792"></a>00792     }
<a name="l00793"></a>00793   <span class="keywordflow">if</span> (so_list)
<a name="l00794"></a>00794     <span class="keywordflow">return</span> so_list-&gt;<a class="code" href="structso__list.html#a7b3094a89d8a05f6905733cab8c6e8e9">lm_info</a>-&gt;<a class="code" href="structlm__info.html#a77b7677e3b3e86706a36bda2b9bd557c">lm_addr</a>;
<a name="l00795"></a>00795   <span class="keywordflow">else</span>
<a name="l00796"></a>00796     <span class="keywordflow">return</span> 0;
<a name="l00797"></a>00797 }
<a name="l00798"></a>00798 
<a name="l00799"></a>00799 
<a name="l00800"></a><a class="code" href="solib-som_8c.html#a27c84a43522ac2ad67b379d8a3bda2a3">00800</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structtarget__so__ops.html">target_so_ops</a> <a class="code" href="solib-som_8c.html#a27c84a43522ac2ad67b379d8a3bda2a3">som_so_ops</a>;
<a name="l00801"></a>00801 
<a name="l00802"></a>00802 <span class="keyword">extern</span> <a class="code" href="defs_8h.html#a686ed07d4fdcdc366f2bc677216ca08d">initialize_file_ftype</a> <a class="code" href="solib-som_8c.html#a9239fe51257fd06dc11058b777be7c35">_initialize_som_solib</a>; <span class="comment">/* -Wmissing-prototypes */</span>
<a name="l00803"></a>00803 
<a name="l00804"></a>00804 <span class="keywordtype">void</span>
<a name="l00805"></a><a class="code" href="solib-som_8c.html#a6e77bdb8f60ade08569cdca0babd1032">00805</a> <a class="code" href="solib-som_8c.html#a9239fe51257fd06dc11058b777be7c35">_initialize_som_solib</a> (<span class="keywordtype">void</span>)
<a name="l00806"></a>00806 {
<a name="l00807"></a>00807   <a class="code" href="solib-som_8c.html#a27c84a43522ac2ad67b379d8a3bda2a3">som_so_ops</a>.<a class="code" href="structtarget__so__ops.html#a2ecaeca7f25e93824463cbf97f288fd8">relocate_section_addresses</a> = <a class="code" href="solib-som_8c.html#a102db1f36ead7b3a21453e645765d20a">som_relocate_section_addresses</a>;
<a name="l00808"></a>00808   <a class="code" href="solib-som_8c.html#a27c84a43522ac2ad67b379d8a3bda2a3">som_so_ops</a>.<a class="code" href="structtarget__so__ops.html#a7f1d1b450ebd9724199b09575f9b2841">free_so</a> = <a class="code" href="solib-som_8c.html#ab7a5e3116a34d30361689ff7246078c6">som_free_so</a>;
<a name="l00809"></a>00809   <a class="code" href="solib-som_8c.html#a27c84a43522ac2ad67b379d8a3bda2a3">som_so_ops</a>.<a class="code" href="structtarget__so__ops.html#a2511b006e5727e3363cc51f6d5bd096b">clear_solib</a> = <a class="code" href="solib-som_8c.html#a4f9d7b6ceb1860812014c89de80c6948">som_clear_solib</a>;
<a name="l00810"></a>00810   <a class="code" href="solib-som_8c.html#a27c84a43522ac2ad67b379d8a3bda2a3">som_so_ops</a>.<a class="code" href="structtarget__so__ops.html#add929a52c64b345eabcb62350b23c44f">solib_create_inferior_hook</a> = <a class="code" href="solib-som_8c.html#af5aacbc4bc40666c2f1ecb8015407108">som_solib_create_inferior_hook</a>;
<a name="l00811"></a>00811   <a class="code" href="solib-som_8c.html#a27c84a43522ac2ad67b379d8a3bda2a3">som_so_ops</a>.<a class="code" href="structtarget__so__ops.html#aecd50fa410ab64d76e8b6584133bf6fc">special_symbol_handling</a> = <a class="code" href="solib-som_8c.html#a0bb5a66203e75e776ede536385388e2f">som_special_symbol_handling</a>;
<a name="l00812"></a>00812   <a class="code" href="solib-som_8c.html#a27c84a43522ac2ad67b379d8a3bda2a3">som_so_ops</a>.<a class="code" href="structtarget__so__ops.html#a05f7d4465c729343bac0446a25a77b1d">current_sos</a> = <a class="code" href="solib-som_8c.html#a2fcc8c48f7ef1fa9412e7f3d838117a2">som_current_sos</a>;
<a name="l00813"></a>00813   <a class="code" href="solib-som_8c.html#a27c84a43522ac2ad67b379d8a3bda2a3">som_so_ops</a>.<a class="code" href="structtarget__so__ops.html#acdab1c9ae53d64aefdc1227b33159983">open_symbol_file_object</a> = <a class="code" href="solib-som_8c.html#a01ebdf6ec3b20afb4c30037b8aec878e">som_open_symbol_file_object</a>;
<a name="l00814"></a>00814   <a class="code" href="solib-som_8c.html#a27c84a43522ac2ad67b379d8a3bda2a3">som_so_ops</a>.<a class="code" href="structtarget__so__ops.html#abffc72bc9b22df15bb37a351e80f6c39">in_dynsym_resolve_code</a> = <a class="code" href="solib-som_8c.html#a6df6a64c6d316054ea26f2a5034ef4e1">som_in_dynsym_resolve_code</a>;
<a name="l00815"></a>00815   <a class="code" href="solib-som_8c.html#a27c84a43522ac2ad67b379d8a3bda2a3">som_so_ops</a>.<a class="code" href="structtarget__so__ops.html#a1a430ce429c2c8efbe6f87bea6bf6cf6">bfd_open</a> = <a class="code" href="solib_8c.html#aa95e8070f3d946cfbfa2b84ceb45d32f">solib_bfd_open</a>;
<a name="l00816"></a>00816 }
<a name="l00817"></a>00817 
<a name="l00818"></a>00818 <span class="keywordtype">void</span>
<a name="l00819"></a><a class="code" href="solib-som_8h.html#a7885e1bc046c28640717f867519a2267">00819</a> <a class="code" href="solib-som_8c.html#a7885e1bc046c28640717f867519a2267">som_solib_select</a> (<span class="keyword">struct</span> <a class="code" href="structgdbarch.html">gdbarch</a> *<a class="code" href="structgdbarch.html">gdbarch</a>)
<a name="l00820"></a>00820 {
<a name="l00821"></a>00821   <span class="keyword">struct </span><a class="code" href="structgdbarch__tdep.html">gdbarch_tdep</a> *tdep = <a class="code" href="gdbarch_8c.html#acea996b7421706849bc20567695b5b31">gdbarch_tdep</a> (gdbarch);
<a name="l00822"></a>00822 
<a name="l00823"></a>00823   <a class="code" href="solib_8c.html#a17e243f2c7b22e10ef981fb7defc8b52">set_solib_ops</a> (gdbarch, &amp;<a class="code" href="solib-som_8c.html#a27c84a43522ac2ad67b379d8a3bda2a3">som_so_ops</a>);
<a name="l00824"></a>00824   tdep-&gt;<a class="code" href="structgdbarch__tdep.html#a1287a55e4bb8ec9a821cddd6d0437f0c">solib_thread_start_addr</a> = <a class="code" href="solib-som_8c.html#aa3166ae44746ad3948305614508d1adf">som_solib_thread_start_addr</a>;
<a name="l00825"></a>00825   tdep-&gt;<a class="code" href="structgdbarch__tdep.html#af4fbf2a315c50529fb08070b91e76601">solib_get_got_by_pc</a> = <a class="code" href="solib-som_8c.html#a939916b42a640df5c38a3f2e14fc3952">som_solib_get_got_by_pc</a>;
<a name="l00826"></a>00826   tdep-&gt;<a class="code" href="structgdbarch__tdep.html#a490e2a897972fb47d1f9991f9050712c">solib_get_solib_by_pc</a> = <a class="code" href="solib-som_8c.html#a4ca93a848cd14791a010cddb9871fec8">som_solib_get_solib_by_pc</a>;
<a name="l00827"></a>00827 }
<a name="l00828"></a>00828 
<a name="l00829"></a>00829 <span class="comment">/* The rest of these functions are not part of the solib interface; they </span>
<a name="l00830"></a>00830 <span class="comment">   are used by somread.c or hppa-hpux-tdep.c.  */</span>
<a name="l00831"></a>00831 
<a name="l00832"></a>00832 <span class="keywordtype">int</span>
<a name="l00833"></a><a class="code" href="solib-som_8h.html#afdb6cda5b8aabd770f69cd175ff342eb">00833</a> <a class="code" href="solib-som_8c.html#afdb6cda5b8aabd770f69cd175ff342eb">som_solib_section_offsets</a> (<span class="keyword">struct</span> <a class="code" href="structobjfile.html">objfile</a> *<a class="code" href="structobjfile.html">objfile</a>,
<a name="l00834"></a>00834                            <span class="keyword">struct</span> <a class="code" href="structsection__offsets.html">section_offsets</a> *offsets)
<a name="l00835"></a>00835 {
<a name="l00836"></a>00836   <span class="keyword">struct </span><a class="code" href="structso__list.html">so_list</a> *<a class="code" href="structso__list.html">so_list</a> = <a class="code" href="solib_8c.html#a5488621c1e7370ffc6eb4f50c97e9484">master_so_list</a> ();
<a name="l00837"></a>00837 
<a name="l00838"></a>00838   <span class="keywordflow">while</span> (so_list)
<a name="l00839"></a>00839     {
<a name="l00840"></a>00840       <span class="comment">/* Oh what a pain!  We need the offsets before so_list-&gt;objfile</span>
<a name="l00841"></a>00841 <span class="comment">         is valid.  The BFDs will never match.  Make a best guess.  */</span>
<a name="l00842"></a>00842       <span class="keywordflow">if</span> (<a class="code" href="gdb__string_8h.html#a55c8e1e0e5f3578988a2feb0d417ad1c">strstr</a> (<a class="code" href="objfiles_8c.html#a33e548a19b86b293435d3c2d6daaaec6">objfile_name</a> (objfile), so_list-&gt;<a class="code" href="structso__list.html#a140beac8c60259f8debd88cd693b8fb4">so_name</a>))
<a name="l00843"></a>00843         {
<a name="l00844"></a>00844           asection *private_section;
<a name="l00845"></a>00845           <span class="keyword">struct </span><a class="code" href="structobj__section.html">obj_section</a> *sect;
<a name="l00846"></a>00846 
<a name="l00847"></a>00847           <span class="comment">/* The text offset is easy.  */</span>
<a name="l00848"></a>00848           offsets-&gt;<a class="code" href="structsection__offsets.html#a2fa3d08ad14bf2b0e56956936c233337">offsets</a>[<a class="code" href="objfiles_8h.html#a83de51cc69bcdda3864a605b939a518e">SECT_OFF_TEXT</a> (objfile)]
<a name="l00849"></a>00849             = (so_list-&gt;<a class="code" href="structso__list.html#a7b3094a89d8a05f6905733cab8c6e8e9">lm_info</a>-&gt;<a class="code" href="structlm__info.html#ae00d156f2af9fd69803b6dd7688efacc">text_addr</a>
<a name="l00850"></a>00850                - so_list-&gt;<a class="code" href="structso__list.html#a7b3094a89d8a05f6905733cab8c6e8e9">lm_info</a>-&gt;<a class="code" href="structlm__info.html#a338e850e765caa5fbf5613116e497964">text_link_addr</a>);
<a name="l00851"></a>00851 
<a name="l00852"></a>00852           <span class="comment">/* We should look at presumed_dp in the SOM header, but</span>
<a name="l00853"></a>00853 <span class="comment">             that&#39;s not easily available.  This should be OK though.  */</span>
<a name="l00854"></a>00854           private_section = bfd_get_section_by_name (objfile-&gt;<a class="code" href="structobjfile.html#a0b967b64f365ef71d618700b7308dcde">obfd</a>,
<a name="l00855"></a>00855                                                      <span class="stringliteral">&quot;$PRIVATE$&quot;</span>);
<a name="l00856"></a>00856           <span class="keywordflow">if</span> (!private_section)
<a name="l00857"></a>00857             {
<a name="l00858"></a>00858               <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Unable to find $PRIVATE$ in shared library!&quot;</span>));
<a name="l00859"></a>00859               offsets-&gt;<a class="code" href="structsection__offsets.html#a2fa3d08ad14bf2b0e56956936c233337">offsets</a>[<a class="code" href="objfiles_8h.html#a42a1ef9c66f0784ea10448a8a1949bf9">SECT_OFF_DATA</a> (objfile)] = 0;
<a name="l00860"></a>00860               offsets-&gt;<a class="code" href="structsection__offsets.html#a2fa3d08ad14bf2b0e56956936c233337">offsets</a>[<a class="code" href="objfiles_8h.html#a3f6faa077173baf9e24df56c66043fbb">SECT_OFF_BSS</a> (objfile)] = 0;
<a name="l00861"></a>00861               <span class="keywordflow">return</span> 1;
<a name="l00862"></a>00862             }
<a name="l00863"></a>00863           <span class="keywordflow">if</span> (objfile-&gt;<a class="code" href="structobjfile.html#a4bf85413b188f632de97609c228b1cad">sect_index_data</a> != -1)
<a name="l00864"></a>00864             {
<a name="l00865"></a>00865               offsets-&gt;<a class="code" href="structsection__offsets.html#a2fa3d08ad14bf2b0e56956936c233337">offsets</a>[<a class="code" href="objfiles_8h.html#a42a1ef9c66f0784ea10448a8a1949bf9">SECT_OFF_DATA</a> (objfile)]
<a name="l00866"></a>00866                 = (so_list-&gt;<a class="code" href="structso__list.html#a7b3094a89d8a05f6905733cab8c6e8e9">lm_info</a>-&gt;<a class="code" href="structlm__info.html#a125d34e728ec8f024c31bf7777838119">data_start</a> - private_section-&gt;vma);
<a name="l00867"></a>00867               <span class="keywordflow">if</span> (objfile-&gt;<a class="code" href="structobjfile.html#a37f41e99df323d618852ee56198e5c75">sect_index_bss</a> != -1)
<a name="l00868"></a>00868                 offsets-&gt;<a class="code" href="structsection__offsets.html#a2fa3d08ad14bf2b0e56956936c233337">offsets</a>[<a class="code" href="objfiles_8h.html#a3f6faa077173baf9e24df56c66043fbb">SECT_OFF_BSS</a> (objfile)]
<a name="l00869"></a>00869                   = <a class="code" href="symtab_8h.html#ab72b539d710f3a5a3857df5d387c4af3">ANOFFSET</a> (offsets, <a class="code" href="objfiles_8h.html#a42a1ef9c66f0784ea10448a8a1949bf9">SECT_OFF_DATA</a> (objfile));
<a name="l00870"></a>00870             }
<a name="l00871"></a>00871 
<a name="l00872"></a>00872           <a class="code" href="objfiles_8h.html#ad7608d3f6245108438ac6aca20412589">ALL_OBJFILE_OSECTIONS</a> (objfile, sect)
<a name="l00873"></a>00873             {
<a name="l00874"></a>00874               flagword <a class="code" href="solib-som_8c.html#a555096840020c318e34b205419e98cca">flags</a> = bfd_get_section_flags (objfile-&gt;<a class="code" href="structobjfile.html#a0b967b64f365ef71d618700b7308dcde">obfd</a>,
<a name="l00875"></a>00875                                                       sect-&gt;<a class="code" href="structobj__section.html#ad233927d4d1037bde66ab9628ae82345">the_bfd_section</a>);
<a name="l00876"></a>00876 
<a name="l00877"></a>00877               <span class="keywordflow">if</span> ((flags &amp; SEC_CODE) != 0)
<a name="l00878"></a>00878                 offsets-&gt;<a class="code" href="structsection__offsets.html#a2fa3d08ad14bf2b0e56956936c233337">offsets</a>[sect-&gt;<a class="code" href="structobj__section.html#ad233927d4d1037bde66ab9628ae82345">the_bfd_section</a>-&gt;index]
<a name="l00879"></a>00879                   = offsets-&gt;<a class="code" href="structsection__offsets.html#a2fa3d08ad14bf2b0e56956936c233337">offsets</a>[<a class="code" href="objfiles_8h.html#a83de51cc69bcdda3864a605b939a518e">SECT_OFF_TEXT</a> (objfile)];
<a name="l00880"></a>00880               <span class="keywordflow">else</span>
<a name="l00881"></a>00881                 offsets-&gt;<a class="code" href="structsection__offsets.html#a2fa3d08ad14bf2b0e56956936c233337">offsets</a>[sect-&gt;<a class="code" href="structobj__section.html#ad233927d4d1037bde66ab9628ae82345">the_bfd_section</a>-&gt;index]
<a name="l00882"></a>00882                   = offsets-&gt;<a class="code" href="structsection__offsets.html#a2fa3d08ad14bf2b0e56956936c233337">offsets</a>[<a class="code" href="objfiles_8h.html#a42a1ef9c66f0784ea10448a8a1949bf9">SECT_OFF_DATA</a> (objfile)];
<a name="l00883"></a>00883             }
<a name="l00884"></a>00884 
<a name="l00885"></a>00885           <span class="keywordflow">return</span> 1;
<a name="l00886"></a>00886         }
<a name="l00887"></a>00887       so_list = so_list-&gt;<a class="code" href="structso__list.html#abd46cbdf1660c79a104e6af57af31df9">next</a>;
<a name="l00888"></a>00888     }
<a name="l00889"></a>00889   <span class="keywordflow">return</span> 0;
<a name="l00890"></a>00890 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Fri Oct 11 2013 14:13:33 for GDB (xrefs) by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
