<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>GDB (xrefs): /home/stan/gdb/src/gdb/sol-thread.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">GDB (xrefs)
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">/home/stan/gdb/src/gdb/sol-thread.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="sol-thread_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* Solaris threads debugging interface.</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">   Copyright (C) 1996-2013 Free Software Foundation, Inc.</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">   This file is part of GDB.</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">   This program is free software; you can redistribute it and/or modify</span>
<a name="l00008"></a>00008 <span class="comment">   it under the terms of the GNU General Public License as published by</span>
<a name="l00009"></a>00009 <span class="comment">   the Free Software Foundation; either version 3 of the License, or</span>
<a name="l00010"></a>00010 <span class="comment">   (at your option) any later version.</span>
<a name="l00011"></a>00011 <span class="comment"></span>
<a name="l00012"></a>00012 <span class="comment">   This program is distributed in the hope that it will be useful,</span>
<a name="l00013"></a>00013 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00014"></a>00014 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00015"></a>00015 <span class="comment">   GNU General Public License for more details.</span>
<a name="l00016"></a>00016 <span class="comment"></span>
<a name="l00017"></a>00017 <span class="comment">   You should have received a copy of the GNU General Public License</span>
<a name="l00018"></a>00018 <span class="comment">   along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.  */</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="comment">/* This module implements a sort of half target that sits between the</span>
<a name="l00021"></a>00021 <span class="comment">   machine-independent parts of GDB and the /proc interface (procfs.c)</span>
<a name="l00022"></a>00022 <span class="comment">   to provide access to the Solaris user-mode thread implementation.</span>
<a name="l00023"></a>00023 <span class="comment"></span>
<a name="l00024"></a>00024 <span class="comment">   Solaris threads are true user-mode threads, which are invoked via</span>
<a name="l00025"></a>00025 <span class="comment">   the thr_* and pthread_* (native and POSIX respectivly) interfaces.</span>
<a name="l00026"></a>00026 <span class="comment">   These are mostly implemented in user-space, with all thread context</span>
<a name="l00027"></a>00027 <span class="comment">   kept in various structures that live in the user&#39;s heap.  These</span>
<a name="l00028"></a>00028 <span class="comment">   should not be confused with lightweight processes (LWPs), which are</span>
<a name="l00029"></a>00029 <span class="comment">   implemented by the kernel, and scheduled without explicit</span>
<a name="l00030"></a>00030 <span class="comment">   intervention by the process.</span>
<a name="l00031"></a>00031 <span class="comment"></span>
<a name="l00032"></a>00032 <span class="comment">   Just to confuse things a little, Solaris threads (both native and</span>
<a name="l00033"></a>00033 <span class="comment">   POSIX) are actually implemented using LWPs.  In general, there are</span>
<a name="l00034"></a>00034 <span class="comment">   going to be more threads than LWPs.  There is no fixed</span>
<a name="l00035"></a>00035 <span class="comment">   correspondence between a thread and an LWP.  When a thread wants to</span>
<a name="l00036"></a>00036 <span class="comment">   run, it gets scheduled onto the first available LWP and can</span>
<a name="l00037"></a>00037 <span class="comment">   therefore migrate from one LWP to another as time goes on.  A</span>
<a name="l00038"></a>00038 <span class="comment">   sleeping thread may not be associated with an LWP at all!</span>
<a name="l00039"></a>00039 <span class="comment"></span>
<a name="l00040"></a>00040 <span class="comment">   To make it possible to mess with threads, Sun provides a library</span>
<a name="l00041"></a>00041 <span class="comment">   called libthread_db.so.1 (not to be confused with</span>
<a name="l00042"></a>00042 <span class="comment">   libthread_db.so.0, which doesn&#39;t have a published interface).  This</span>
<a name="l00043"></a>00043 <span class="comment">   interface has an upper part, which it provides, and a lower part</span>
<a name="l00044"></a>00044 <span class="comment">   which we provide.  The upper part consists of the td_* routines,</span>
<a name="l00045"></a>00045 <span class="comment">   which allow us to find all the threads, query their state, etc...</span>
<a name="l00046"></a>00046 <span class="comment">   The lower part consists of all of the ps_*, which are used by the</span>
<a name="l00047"></a>00047 <span class="comment">   td_* routines to read/write memory, manipulate LWPs, lookup</span>
<a name="l00048"></a>00048 <span class="comment">   symbols, etc...  The ps_* routines actually do most of their work</span>
<a name="l00049"></a>00049 <span class="comment">   by calling functions in procfs.c.  */</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="defs_8h.html">defs.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &lt;thread.h&gt;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &lt;proc_service.h&gt;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &lt;thread_db.h&gt;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="gdbthread_8h.html">gdbthread.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="target_8h.html">target.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="inferior_8h.html">inferior.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="gdb__stat_8h.html">gdb_stat.h</a>&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &lt;dlfcn.h&gt;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="gdbcmd_8h.html">gdbcmd.h</a>&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="gdbcore_8h.html">gdbcore.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="regcache_8h.html">regcache.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="solib_8h.html">solib.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="symfile_8h.html">symfile.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="observer_8h.html">observer.h</a>&quot;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="gdb__string_8h.html">gdb_string.h</a>&quot;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="procfs_8h.html">procfs.h</a>&quot;</span>
<a name="l00069"></a>00069 
<a name="l00070"></a><a class="code" href="sol-thread_8c.html#a76a5ea6f020180356d5174c3b3255bcf">00070</a> <span class="keyword">struct </span><a class="code" href="structtarget__ops.html">target_ops</a> <a class="code" href="sol-thread_8c.html#a76a5ea6f020180356d5174c3b3255bcf">sol_thread_ops</a>;
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 <span class="comment">/* Prototypes for supply_gregset etc.  */</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;<a class="code" href="gregset_8h.html">gregset.h</a>&quot;</span>
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <span class="comment">/* This struct is defined by us, but mainly used for the proc_service</span>
<a name="l00076"></a>00076 <span class="comment">   interface.  We don&#39;t have much use for it, except as a handy place</span>
<a name="l00077"></a>00077 <span class="comment">   to get a real PID for memory accesses.  */</span>
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="keyword">struct </span><a class="code" href="structps__prochandle.html">ps_prochandle</a>
<a name="l00080"></a>00080 {
<a name="l00081"></a>00081   <a class="code" href="structptid.html">ptid_t</a> <a class="code" href="structps__prochandle.html#ac137f90af8832f0784aed26658870623">ptid</a>;
<a name="l00082"></a>00082 };
<a name="l00083"></a>00083 
<a name="l00084"></a><a class="code" href="structstring__map.html">00084</a> <span class="keyword">struct </span><a class="code" href="structstring__map.html">string_map</a>
<a name="l00085"></a>00085 {
<a name="l00086"></a><a class="code" href="structstring__map.html#ab2ab593d1376a2dbcb5ad3cad2b09ff5">00086</a>   <span class="keywordtype">int</span> <a class="code" href="structstring__map.html#ab2ab593d1376a2dbcb5ad3cad2b09ff5">num</a>;
<a name="l00087"></a><a class="code" href="structstring__map.html#ac3a68c4dc0be9ad694f44be676de683c">00087</a>   <span class="keywordtype">char</span> *<a class="code" href="structstring__map.html#ac3a68c4dc0be9ad694f44be676de683c">str</a>;
<a name="l00088"></a>00088 };
<a name="l00089"></a>00089 
<a name="l00090"></a><a class="code" href="sol-thread_8c.html#ad6ea4a4912226100c6116cddd62792ce">00090</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structps__prochandle.html">ps_prochandle</a> <a class="code" href="sol-thread_8c.html#ad6ea4a4912226100c6116cddd62792ce">main_ph</a>;
<a name="l00091"></a><a class="code" href="sol-thread_8c.html#a60717b62fc8e0f1f1b106661944baee6">00091</a> <span class="keyword">static</span> <a class="code" href="glibc__thread__db_8h.html#a851f228594aa5e5537c2e91657a15a8f">td_thragent_t</a> *<a class="code" href="sol-thread_8c.html#a60717b62fc8e0f1f1b106661944baee6">main_ta</a>;
<a name="l00092"></a><a class="code" href="sol-thread_8c.html#a70efa3c7278acd583ccea400b77096f0">00092</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="sol-thread_8c.html#a70efa3c7278acd583ccea400b77096f0">sol_thread_active</a> = 0;
<a name="l00093"></a>00093 
<a name="l00094"></a>00094 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="sol-thread_8c.html#a0093c6956afeec22b2647903f64955cc">init_sol_thread_ops</a> (<span class="keywordtype">void</span>);
<a name="l00095"></a>00095 
<a name="l00096"></a>00096 <span class="comment">/* Default definitions: These must be defined in tm.h if they are to</span>
<a name="l00097"></a>00097 <span class="comment">   be shared with a process module such as procfs.  */</span>
<a name="l00098"></a>00098 
<a name="l00099"></a>00099 <span class="comment">/* Pointers to routines from libthread_db resolved by dlopen().  */</span>
<a name="l00100"></a>00100 
<a name="l00101"></a><a class="code" href="sol-thread_8c.html#ae1b628462c38a45bb093f42bc35875d5">00101</a> <span class="keyword">static</span> void (*<a class="code" href="sol-thread_8c.html#ae1b628462c38a45bb093f42bc35875d5">p_td_log</a>)(<span class="keyword">const</span> <span class="keywordtype">int</span> on_off);
<a name="l00102"></a><a class="code" href="sol-thread_8c.html#ae0c9712930dc44c74597b0594cc15942">00102</a> <span class="keyword">static</span> <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> (*<a class="code" href="sol-thread_8c.html#ae0c9712930dc44c74597b0594cc15942">p_td_ta_new</a>)(<span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structps__prochandle.html">ps_prochandle</a> *ph_p,
<a name="l00103"></a>00103                                <a class="code" href="glibc__thread__db_8h.html#a851f228594aa5e5537c2e91657a15a8f">td_thragent_t</a> **ta_pp);
<a name="l00104"></a><a class="code" href="sol-thread_8c.html#a2b126eb911c6cb255747bd09d98401b7">00104</a> <span class="keyword">static</span> <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> (*<a class="code" href="sol-thread_8c.html#a2b126eb911c6cb255747bd09d98401b7">p_td_ta_delete</a>)(<a class="code" href="glibc__thread__db_8h.html#a851f228594aa5e5537c2e91657a15a8f">td_thragent_t</a> *ta_p);
<a name="l00105"></a><a class="code" href="sol-thread_8c.html#a1757620e8529cb636366bbe48290e749">00105</a> <span class="keyword">static</span> <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> (*<a class="code" href="sol-thread_8c.html#a1757620e8529cb636366bbe48290e749">p_td_init</a>)(void);
<a name="l00106"></a><a class="code" href="sol-thread_8c.html#ac77699202975486cd9134892fcc20092">00106</a> <span class="keyword">static</span> <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> (*<a class="code" href="sol-thread_8c.html#ac77699202975486cd9134892fcc20092">p_td_ta_get_ph</a>)(<span class="keyword">const</span> <a class="code" href="glibc__thread__db_8h.html#a851f228594aa5e5537c2e91657a15a8f">td_thragent_t</a> *ta_p,
<a name="l00107"></a>00107                                   <span class="keyword">struct </span><a class="code" href="structps__prochandle.html">ps_prochandle</a> **ph_pp);
<a name="l00108"></a><a class="code" href="sol-thread_8c.html#a163662945e2d4da386c8f3b05d0f1d74">00108</a> <span class="keyword">static</span> <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> (*<a class="code" href="sol-thread_8c.html#a163662945e2d4da386c8f3b05d0f1d74">p_td_ta_get_nthreads</a>)(<span class="keyword">const</span> <a class="code" href="glibc__thread__db_8h.html#a851f228594aa5e5537c2e91657a15a8f">td_thragent_t</a> *ta_p,
<a name="l00109"></a>00109                                         <span class="keywordtype">int</span> *nthread_p);
<a name="l00110"></a><a class="code" href="sol-thread_8c.html#a368e4fa578652fcc8641afec7444d950">00110</a> <span class="keyword">static</span> <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> (*<a class="code" href="sol-thread_8c.html#a368e4fa578652fcc8641afec7444d950">p_td_ta_tsd_iter</a>)(<span class="keyword">const</span> <a class="code" href="glibc__thread__db_8h.html#a851f228594aa5e5537c2e91657a15a8f">td_thragent_t</a> *ta_p,
<a name="l00111"></a>00111                                     <a class="code" href="glibc__thread__db_8h.html#a1a9c28f8b9a2636385a4c1e7bae5ec03">td_key_iter_f</a> *cb, <span class="keywordtype">void</span> *cbdata_p);
<a name="l00112"></a><a class="code" href="sol-thread_8c.html#ad6535c0b507f2282e5d6ecf2e738f305">00112</a> <span class="keyword">static</span> <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> (*<a class="code" href="sol-thread_8c.html#ad6535c0b507f2282e5d6ecf2e738f305">p_td_ta_thr_iter</a>)(<span class="keyword">const</span> <a class="code" href="glibc__thread__db_8h.html#a851f228594aa5e5537c2e91657a15a8f">td_thragent_t</a> *ta_p,
<a name="l00113"></a>00113                                     <a class="code" href="glibc__thread__db_8h.html#a3a733eebfdfaf16591cdf4986b13f530">td_thr_iter_f</a> *cb, <span class="keywordtype">void</span> *cbdata_p,
<a name="l00114"></a>00114                                     <a class="code" href="glibc__thread__db_8h.html#a7e015b84265c7d3667103553d8230d8e">td_thr_state_e</a> state, <span class="keywordtype">int</span> ti_pri,
<a name="l00115"></a>00115                                     sigset_t *ti_sigmask_p,
<a name="l00116"></a>00116                                     <span class="keywordtype">unsigned</span> ti_user_flags);
<a name="l00117"></a><a class="code" href="sol-thread_8c.html#af3c2f4871baecf53b20c80319e5377d4">00117</a> <span class="keyword">static</span> <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> (*<a class="code" href="sol-thread_8c.html#af3c2f4871baecf53b20c80319e5377d4">p_td_thr_validate</a>)(<span class="keyword">const</span> <a class="code" href="structtd__thrhandle.html">td_thrhandle_t</a> *th_p);
<a name="l00118"></a><a class="code" href="sol-thread_8c.html#a8eec328eca059231ac5df43633865804">00118</a> <span class="keyword">static</span> <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> (*<a class="code" href="sol-thread_8c.html#a8eec328eca059231ac5df43633865804">p_td_thr_tsd</a>)(<span class="keyword">const</span> <a class="code" href="structtd__thrhandle.html">td_thrhandle_t</a> * th_p,
<a name="l00119"></a>00119                                 <span class="keyword">const</span> <a class="code" href="glibc__thread__db_8h.html#a0753bf61cc9ac279c16a75f27fb88cae">thread_key_t</a> key, <span class="keywordtype">void</span> **data_pp);
<a name="l00120"></a><a class="code" href="sol-thread_8c.html#aa323030b3eb169a6e719c886dc11b3fb">00120</a> <span class="keyword">static</span> <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> (*<a class="code" href="sol-thread_8c.html#aa323030b3eb169a6e719c886dc11b3fb">p_td_thr_get_info</a>)(<span class="keyword">const</span> <a class="code" href="structtd__thrhandle.html">td_thrhandle_t</a> *th_p,
<a name="l00121"></a>00121                                      <a class="code" href="structtd__thrinfo.html">td_thrinfo_t</a> *ti_p);
<a name="l00122"></a><a class="code" href="sol-thread_8c.html#af74ca2287a63f3ac66b597de7fdce7a7">00122</a> <span class="keyword">static</span> <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> (*<a class="code" href="sol-thread_8c.html#af74ca2287a63f3ac66b597de7fdce7a7">p_td_thr_getfpregs</a>)(<span class="keyword">const</span> <a class="code" href="structtd__thrhandle.html">td_thrhandle_t</a> *th_p,
<a name="l00123"></a>00123                                       <a class="code" href="gdb__proc__service_8h.html#a116c1abc1a3d6613a354fa25606e3132">prfpregset_t</a> *fpregset);
<a name="l00124"></a><a class="code" href="sol-thread_8c.html#aec8678c2c14e2aac30a5b6d00a429f13">00124</a> <span class="keyword">static</span> <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> (*<a class="code" href="sol-thread_8c.html#aec8678c2c14e2aac30a5b6d00a429f13">p_td_thr_getxregsize</a>)(<span class="keyword">const</span> <a class="code" href="structtd__thrhandle.html">td_thrhandle_t</a> *th_p,
<a name="l00125"></a>00125                                         <span class="keywordtype">int</span> *xregsize);
<a name="l00126"></a><a class="code" href="sol-thread_8c.html#a039e69a9ff113a2c432d94e67c0240cc">00126</a> <span class="keyword">static</span> <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> (*<a class="code" href="sol-thread_8c.html#a039e69a9ff113a2c432d94e67c0240cc">p_td_thr_getxregs</a>)(<span class="keyword">const</span> <a class="code" href="structtd__thrhandle.html">td_thrhandle_t</a> *th_p,
<a name="l00127"></a>00127                                      <span class="keyword">const</span> caddr_t xregset);
<a name="l00128"></a><a class="code" href="sol-thread_8c.html#a9c7355595c8c9bc9ed64952440eec3ab">00128</a> <span class="keyword">static</span> <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> (*<a class="code" href="sol-thread_8c.html#a9c7355595c8c9bc9ed64952440eec3ab">p_td_thr_sigsetmask</a>)(<span class="keyword">const</span> <a class="code" href="structtd__thrhandle.html">td_thrhandle_t</a> *th_p,
<a name="l00129"></a>00129                                        <span class="keyword">const</span> sigset_t ti_sigmask);
<a name="l00130"></a><a class="code" href="sol-thread_8c.html#ac75c0af03be5065e113dd3cf1758bf42">00130</a> <span class="keyword">static</span> <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> (*<a class="code" href="sol-thread_8c.html#ac75c0af03be5065e113dd3cf1758bf42">p_td_thr_setprio</a>)(<span class="keyword">const</span> <a class="code" href="structtd__thrhandle.html">td_thrhandle_t</a> *th_p,
<a name="l00131"></a>00131                                     <span class="keyword">const</span> <span class="keywordtype">int</span> ti_pri);
<a name="l00132"></a><a class="code" href="sol-thread_8c.html#a0e59118431016b31e8599fdbecb693e2">00132</a> <span class="keyword">static</span> <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> (*<a class="code" href="sol-thread_8c.html#a0e59118431016b31e8599fdbecb693e2">p_td_thr_setsigpending</a>)(<span class="keyword">const</span> <a class="code" href="structtd__thrhandle.html">td_thrhandle_t</a> *th_p,
<a name="l00133"></a>00133                                           <span class="keyword">const</span> uchar_t ti_pending_flag,
<a name="l00134"></a>00134                                           <span class="keyword">const</span> sigset_t ti_pending);
<a name="l00135"></a><a class="code" href="sol-thread_8c.html#a6d1dc1ce4109725e7d91b92773e8da04">00135</a> <span class="keyword">static</span> <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> (*<a class="code" href="sol-thread_8c.html#a6d1dc1ce4109725e7d91b92773e8da04">p_td_thr_setfpregs</a>)(<span class="keyword">const</span> <a class="code" href="structtd__thrhandle.html">td_thrhandle_t</a> *th_p,
<a name="l00136"></a>00136                                       <span class="keyword">const</span> <a class="code" href="gdb__proc__service_8h.html#a116c1abc1a3d6613a354fa25606e3132">prfpregset_t</a> *fpregset);
<a name="l00137"></a><a class="code" href="sol-thread_8c.html#aa2739029a3f491a54bfda0a5a21c55d4">00137</a> <span class="keyword">static</span> <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> (*<a class="code" href="sol-thread_8c.html#aa2739029a3f491a54bfda0a5a21c55d4">p_td_thr_setxregs</a>)(<span class="keyword">const</span> <a class="code" href="structtd__thrhandle.html">td_thrhandle_t</a> *th_p,
<a name="l00138"></a>00138                                      <span class="keyword">const</span> caddr_t xregset);
<a name="l00139"></a><a class="code" href="sol-thread_8c.html#a191a2991088e6ab88152884662e1b311">00139</a> <span class="keyword">static</span> <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> (*<a class="code" href="sol-thread_8c.html#a191a2991088e6ab88152884662e1b311">p_td_ta_map_id2thr</a>)(<span class="keyword">const</span> <a class="code" href="glibc__thread__db_8h.html#a851f228594aa5e5537c2e91657a15a8f">td_thragent_t</a> *ta_p,
<a name="l00140"></a>00140                                       <a class="code" href="glibc__thread__db_8h.html#aa406fd87cfd69d7c0a93b6a241978712">thread_t</a> tid,
<a name="l00141"></a>00141                                       <a class="code" href="structtd__thrhandle.html">td_thrhandle_t</a> *th_p);
<a name="l00142"></a><a class="code" href="sol-thread_8c.html#a94f192486ed8a55b05810ee34f28c117">00142</a> <span class="keyword">static</span> <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> (*<a class="code" href="sol-thread_8c.html#a94f192486ed8a55b05810ee34f28c117">p_td_ta_map_lwp2thr</a>)(<span class="keyword">const</span> <a class="code" href="glibc__thread__db_8h.html#a851f228594aa5e5537c2e91657a15a8f">td_thragent_t</a> *ta_p,
<a name="l00143"></a>00143                                        <a class="code" href="gdb__proc__service_8h.html#ae0e8cfc4f21539a5c5b572c239bb8112">lwpid_t</a> lwpid,
<a name="l00144"></a>00144                                        <a class="code" href="structtd__thrhandle.html">td_thrhandle_t</a> *th_p);
<a name="l00145"></a><a class="code" href="sol-thread_8c.html#aca1820422902773ed8e001d8b675d30c">00145</a> <span class="keyword">static</span> <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> (*<a class="code" href="sol-thread_8c.html#aca1820422902773ed8e001d8b675d30c">p_td_thr_getgregs</a>)(<span class="keyword">const</span> <a class="code" href="structtd__thrhandle.html">td_thrhandle_t</a> *th_p,
<a name="l00146"></a>00146                                      <a class="code" href="gdb__proc__service_8h.html#a407082bbbaa95d6d5084823c24e5e4f8">prgregset_t</a> <a class="code" href="structregset.html">regset</a>);
<a name="l00147"></a><a class="code" href="sol-thread_8c.html#a253e60051a328381cd96feaf24c45357">00147</a> <span class="keyword">static</span> <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> (*<a class="code" href="sol-thread_8c.html#a253e60051a328381cd96feaf24c45357">p_td_thr_setgregs</a>)(<span class="keyword">const</span> <a class="code" href="structtd__thrhandle.html">td_thrhandle_t</a> *th_p,
<a name="l00148"></a>00148                                      <span class="keyword">const</span> <a class="code" href="gdb__proc__service_8h.html#a407082bbbaa95d6d5084823c24e5e4f8">prgregset_t</a> <a class="code" href="structregset.html">regset</a>);
<a name="l00149"></a>00149 
<a name="l00150"></a>00150 
<a name="l00151"></a>00151 <span class="comment">/* Return the libthread_db error string associated with ERRCODE.  If</span>
<a name="l00152"></a>00152 <span class="comment">   ERRCODE is unknown, return an appropriate message.  */</span>
<a name="l00153"></a>00153 
<a name="l00154"></a>00154 <span class="keyword">static</span> <span class="keywordtype">char</span> *
<a name="l00155"></a><a class="code" href="sol-thread_8c.html#a09dc617f5ccf92d320242515c2ae3dfb">00155</a> <a class="code" href="sol-thread_8c.html#a09dc617f5ccf92d320242515c2ae3dfb">td_err_string</a> (<a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> errcode)
<a name="l00156"></a>00156 {
<a name="l00157"></a>00157   <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structstring__map.html">string_map</a> td_err_table[] =
<a name="l00158"></a>00158   {
<a name="l00159"></a>00159     { <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a93e810059742feb944de782cee183f3f">TD_OK</a>, <span class="stringliteral">&quot;generic \&quot;call succeeded\&quot;&quot;</span> },
<a name="l00160"></a>00160     { <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a59f033ea09df04aef2c83400b5d245cd">TD_ERR</a>, <span class="stringliteral">&quot;generic error.&quot;</span> },
<a name="l00161"></a>00161     { <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a923e209a5e9fd286ddf7f691db028bd8">TD_NOTHR</a>, <span class="stringliteral">&quot;no thread can be found to satisfy query&quot;</span> },
<a name="l00162"></a>00162     { <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434ac3b9729dedbfd41ec77e61935717ef06">TD_NOSV</a>, <span class="stringliteral">&quot;no synch. variable can be found to satisfy query&quot;</span> },
<a name="l00163"></a>00163     { <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434aebb10b6538c75c90951c6ef972673508">TD_NOLWP</a>, <span class="stringliteral">&quot;no lwp can be found to satisfy query&quot;</span> },
<a name="l00164"></a>00164     { <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a09f100a56667a7cc3eaba21dca2ef5bb">TD_BADPH</a>, <span class="stringliteral">&quot;invalid process handle&quot;</span> },
<a name="l00165"></a>00165     { <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a9766e98fa78f694c1bc1149049a7ffa1">TD_BADTH</a>, <span class="stringliteral">&quot;invalid thread handle&quot;</span> },
<a name="l00166"></a>00166     { <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434aedd104e68a48e0219dd8df261d8a05ba">TD_BADSH</a>, <span class="stringliteral">&quot;invalid synchronization handle&quot;</span> },
<a name="l00167"></a>00167     { <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a0304c83af37ac9bbd8dd3ec2cf46d735">TD_BADTA</a>, <span class="stringliteral">&quot;invalid thread agent&quot;</span> },
<a name="l00168"></a>00168     { <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a35c9620b6daaade5adbd313777ba50f6">TD_BADKEY</a>, <span class="stringliteral">&quot;invalid key&quot;</span> },
<a name="l00169"></a>00169     { <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a7d15a6cd0a614e2ad07a716b384baaf3">TD_NOMSG</a>, <span class="stringliteral">&quot;td_thr_event_getmsg() called when there was no message&quot;</span> },
<a name="l00170"></a>00170     { <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a176156ac8bcd0cd35cc2763567a47d81">TD_NOFPREGS</a>, <span class="stringliteral">&quot;FPU register set not available for given thread&quot;</span> },
<a name="l00171"></a>00171     { <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434adc7eb8cb36425a689e6770156390a74a">TD_NOLIBTHREAD</a>, <span class="stringliteral">&quot;application not linked with libthread&quot;</span> },
<a name="l00172"></a>00172     { <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434adede655355684a3520222447afd2f010">TD_NOEVENT</a>, <span class="stringliteral">&quot;requested event is not supported&quot;</span> },
<a name="l00173"></a>00173     { <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a39c9423cfde70c6cbdaee285dfd89add">TD_NOCAPAB</a>, <span class="stringliteral">&quot;capability not available&quot;</span> },
<a name="l00174"></a>00174     { <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a15dc23b1af650848117b5052cf3b7603">TD_DBERR</a>, <span class="stringliteral">&quot;Debugger service failed&quot;</span> },
<a name="l00175"></a>00175     { <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a00ad61c57929da5e28525ac68e2535ea">TD_NOAPLIC</a>, <span class="stringliteral">&quot;Operation not applicable to&quot;</span> },
<a name="l00176"></a>00176     { <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a5d74afeba53bbaff261358d282c977b4">TD_NOTSD</a>, <span class="stringliteral">&quot;No thread specific data for this thread&quot;</span> },
<a name="l00177"></a>00177     { <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a1664fb7160fb1dbbb982039e1e594e2c">TD_MALLOC</a>, <span class="stringliteral">&quot;Malloc failed&quot;</span> },
<a name="l00178"></a>00178     { <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434ade80c9872ca4dbb6ca3fb401ae710bba">TD_PARTIALREG</a>, <span class="stringliteral">&quot;Only part of register set was written/read&quot;</span> },
<a name="l00179"></a>00179     { <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434ac05eb64179e5733c2b7636006511afaf">TD_NOXREGS</a>, <span class="stringliteral">&quot;X register set not available for given thread&quot;</span> }
<a name="l00180"></a>00180   };
<a name="l00181"></a>00181   <span class="keyword">const</span> <span class="keywordtype">int</span> td_err_size = <span class="keyword">sizeof</span> td_err_table / <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structstring__map.html">string_map</a>);
<a name="l00182"></a>00182   <span class="keywordtype">int</span> i;
<a name="l00183"></a>00183   <span class="keyword">static</span> <span class="keywordtype">char</span> buf[50];
<a name="l00184"></a>00184 
<a name="l00185"></a>00185   <span class="keywordflow">for</span> (i = 0; i &lt; td_err_size; i++)
<a name="l00186"></a>00186     <span class="keywordflow">if</span> (td_err_table[i].<a class="code" href="structstring__map.html#ab2ab593d1376a2dbcb5ad3cad2b09ff5">num</a> == errcode)
<a name="l00187"></a>00187       <span class="keywordflow">return</span> td_err_table[i].<a class="code" href="structstring__map.html#ac3a68c4dc0be9ad694f44be676de683c">str</a>;
<a name="l00188"></a>00188 
<a name="l00189"></a>00189   <a class="code" href="common-utils_8c.html#ad9940337ec98983dae9951c947879fc8">xsnprintf</a> (buf, <span class="keyword">sizeof</span> (buf), <span class="stringliteral">&quot;Unknown libthread_db error code: %d&quot;</span>,
<a name="l00190"></a>00190              errcode);
<a name="l00191"></a>00191 
<a name="l00192"></a>00192   <span class="keywordflow">return</span> buf;
<a name="l00193"></a>00193 }
<a name="l00194"></a>00194 
<a name="l00195"></a>00195 <span class="comment">/* Return the libthread_db state string assicoated with STATECODE.</span>
<a name="l00196"></a>00196 <span class="comment">   If STATECODE is unknown, return an appropriate message.  */</span>
<a name="l00197"></a>00197 
<a name="l00198"></a>00198 <span class="keyword">static</span> <span class="keywordtype">char</span> *
<a name="l00199"></a><a class="code" href="sol-thread_8c.html#aa484bd740dc8b6252b31bcd2b8a76568">00199</a> <a class="code" href="sol-thread_8c.html#aa484bd740dc8b6252b31bcd2b8a76568">td_state_string</a> (<a class="code" href="glibc__thread__db_8h.html#a7e015b84265c7d3667103553d8230d8e">td_thr_state_e</a> statecode)
<a name="l00200"></a>00200 {
<a name="l00201"></a>00201   <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structstring__map.html">string_map</a> td_thr_state_table[] =
<a name="l00202"></a>00202   {
<a name="l00203"></a>00203     { <a class="code" href="glibc__thread__db_8h.html#a7e015b84265c7d3667103553d8230d8eaa7598975576c3ad9f6900645f216ff74">TD_THR_ANY_STATE</a>, <span class="stringliteral">&quot;any state&quot;</span> },
<a name="l00204"></a>00204     { <a class="code" href="glibc__thread__db_8h.html#a7e015b84265c7d3667103553d8230d8eae5a95caf13bb3f3138f8c2f7c42a8473">TD_THR_UNKNOWN</a>, <span class="stringliteral">&quot;unknown&quot;</span> },
<a name="l00205"></a>00205     { <a class="code" href="glibc__thread__db_8h.html#a7e015b84265c7d3667103553d8230d8ea8b36ffff700a29862946d8bf7a86e236">TD_THR_STOPPED</a>, <span class="stringliteral">&quot;stopped&quot;</span> },
<a name="l00206"></a>00206     { <a class="code" href="glibc__thread__db_8h.html#a7e015b84265c7d3667103553d8230d8ea34ea41cb09d07fcf5089666087431c1e">TD_THR_RUN</a>, <span class="stringliteral">&quot;run&quot;</span> },
<a name="l00207"></a>00207     { <a class="code" href="glibc__thread__db_8h.html#a7e015b84265c7d3667103553d8230d8ead2531288df0901605a906357be33768e">TD_THR_ACTIVE</a>, <span class="stringliteral">&quot;active&quot;</span> },
<a name="l00208"></a>00208     { <a class="code" href="glibc__thread__db_8h.html#a7e015b84265c7d3667103553d8230d8eade49dca447c1cd9167eb487102f580b3">TD_THR_ZOMBIE</a>, <span class="stringliteral">&quot;zombie&quot;</span> },
<a name="l00209"></a>00209     { <a class="code" href="glibc__thread__db_8h.html#a7e015b84265c7d3667103553d8230d8ea3045ddd4f7fd42aef776b6ece1191903">TD_THR_SLEEP</a>, <span class="stringliteral">&quot;sleep&quot;</span> },
<a name="l00210"></a>00210     { <a class="code" href="glibc__thread__db_8h.html#a7e015b84265c7d3667103553d8230d8eacceb59b58d49515364ad81281cac55c9">TD_THR_STOPPED_ASLEEP</a>, <span class="stringliteral">&quot;stopped asleep&quot;</span> }
<a name="l00211"></a>00211   };
<a name="l00212"></a>00212   <span class="keyword">const</span> <span class="keywordtype">int</span> td_thr_state_table_size =
<a name="l00213"></a>00213     <span class="keyword">sizeof</span> td_thr_state_table / <span class="keyword">sizeof</span> (<span class="keyword">struct </span><a class="code" href="structstring__map.html">string_map</a>);
<a name="l00214"></a>00214   <span class="keywordtype">int</span> i;
<a name="l00215"></a>00215   <span class="keyword">static</span> <span class="keywordtype">char</span> buf[50];
<a name="l00216"></a>00216 
<a name="l00217"></a>00217   <span class="keywordflow">for</span> (i = 0; i &lt; td_thr_state_table_size; i++)
<a name="l00218"></a>00218     <span class="keywordflow">if</span> (td_thr_state_table[i].<a class="code" href="structstring__map.html#ab2ab593d1376a2dbcb5ad3cad2b09ff5">num</a> == statecode)
<a name="l00219"></a>00219       <span class="keywordflow">return</span> td_thr_state_table[i].<a class="code" href="structstring__map.html#ac3a68c4dc0be9ad694f44be676de683c">str</a>;
<a name="l00220"></a>00220 
<a name="l00221"></a>00221   <a class="code" href="common-utils_8c.html#ad9940337ec98983dae9951c947879fc8">xsnprintf</a> (buf, <span class="keyword">sizeof</span> (buf), <span class="stringliteral">&quot;Unknown libthread_db state code: %d&quot;</span>,
<a name="l00222"></a>00222              statecode);
<a name="l00223"></a>00223 
<a name="l00224"></a>00224   <span class="keywordflow">return</span> buf;
<a name="l00225"></a>00225 }
<a name="l00226"></a>00226 
<a name="l00227"></a>00227 
<a name="l00228"></a>00228 <span class="comment">/* Convert a POSIX or Solaris thread ID into a LWP ID.  If THREAD_ID</span>
<a name="l00229"></a>00229 <span class="comment">   doesn&#39;t exist, that&#39;s an error.  If it&#39;s an inactive thread, return</span>
<a name="l00230"></a>00230 <span class="comment">   DEFAULT_LWP.</span>
<a name="l00231"></a>00231 <span class="comment"></span>
<a name="l00232"></a>00232 <span class="comment">   NOTE: This function probably shouldn&#39;t call error().  */</span>
<a name="l00233"></a>00233 
<a name="l00234"></a>00234 <span class="keyword">static</span> <a class="code" href="structptid.html">ptid_t</a>
<a name="l00235"></a><a class="code" href="sol-thread_8c.html#af34ff337f26fa6d8b803a62c9d91af01">00235</a> <a class="code" href="sol-thread_8c.html#af34ff337f26fa6d8b803a62c9d91af01">thread_to_lwp</a> (<a class="code" href="structptid.html">ptid_t</a> thread_id, <span class="keywordtype">int</span> default_lwp)
<a name="l00236"></a>00236 {
<a name="l00237"></a>00237   <a class="code" href="structtd__thrinfo.html">td_thrinfo_t</a> ti;
<a name="l00238"></a>00238   <a class="code" href="structtd__thrhandle.html">td_thrhandle_t</a> th;
<a name="l00239"></a>00239   <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> val;
<a name="l00240"></a>00240 
<a name="l00241"></a>00241   <span class="keywordflow">if</span> (<a class="code" href="ptid_8c.html#a73d2359054b8de955266eb23bfca314e">ptid_lwp_p</a> (thread_id))
<a name="l00242"></a>00242     <span class="keywordflow">return</span> thread_id;           <span class="comment">/* It&#39;s already an LWP ID.  */</span>
<a name="l00243"></a>00243 
<a name="l00244"></a>00244   <span class="comment">/* It&#39;s a thread.  Convert to LWP.  */</span>
<a name="l00245"></a>00245 
<a name="l00246"></a>00246   val = <a class="code" href="sol-thread_8c.html#a191a2991088e6ab88152884662e1b311">p_td_ta_map_id2thr</a> (<a class="code" href="sol-thread_8c.html#a60717b62fc8e0f1f1b106661944baee6">main_ta</a>, <a class="code" href="ptid_8c.html#a4af97a74cc1dc6bdc1c8f0ac8398c0ac">ptid_get_tid</a> (thread_id), &amp;th);
<a name="l00247"></a>00247   <span class="keywordflow">if</span> (val == <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a923e209a5e9fd286ddf7f691db028bd8">TD_NOTHR</a>)
<a name="l00248"></a>00248     <span class="keywordflow">return</span> <a class="code" href="ptid_8c.html#a41fa537798e02ba25c7980a7c1e46272">pid_to_ptid</a> (-1);    <span class="comment">/* Thread must have terminated.  */</span>
<a name="l00249"></a>00249   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val != <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a93e810059742feb944de782cee183f3f">TD_OK</a>)
<a name="l00250"></a>00250     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;thread_to_lwp: td_ta_map_id2thr %s&quot;</span>), <a class="code" href="sol-thread_8c.html#a09dc617f5ccf92d320242515c2ae3dfb">td_err_string</a> (val));
<a name="l00251"></a>00251 
<a name="l00252"></a>00252   val = <a class="code" href="sol-thread_8c.html#aa323030b3eb169a6e719c886dc11b3fb">p_td_thr_get_info</a> (&amp;th, &amp;ti);
<a name="l00253"></a>00253   <span class="keywordflow">if</span> (val == <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a923e209a5e9fd286ddf7f691db028bd8">TD_NOTHR</a>)
<a name="l00254"></a>00254     <span class="keywordflow">return</span> <a class="code" href="ptid_8c.html#a41fa537798e02ba25c7980a7c1e46272">pid_to_ptid</a> (-1);    <span class="comment">/* Thread must have terminated.  */</span>
<a name="l00255"></a>00255   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val != <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a93e810059742feb944de782cee183f3f">TD_OK</a>)
<a name="l00256"></a>00256     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;thread_to_lwp: td_thr_get_info: %s&quot;</span>), <a class="code" href="sol-thread_8c.html#a09dc617f5ccf92d320242515c2ae3dfb">td_err_string</a> (val));
<a name="l00257"></a>00257 
<a name="l00258"></a>00258   <span class="keywordflow">if</span> (ti.<a class="code" href="structtd__thrinfo.html#a137890e3133b03a96dd780e93d9109d9">ti_state</a> != <a class="code" href="glibc__thread__db_8h.html#a7e015b84265c7d3667103553d8230d8ead2531288df0901605a906357be33768e">TD_THR_ACTIVE</a>)
<a name="l00259"></a>00259     {
<a name="l00260"></a>00260       <span class="keywordflow">if</span> (default_lwp != -1)
<a name="l00261"></a>00261         <span class="keywordflow">return</span> <a class="code" href="ptid_8c.html#a41fa537798e02ba25c7980a7c1e46272">pid_to_ptid</a> (default_lwp);
<a name="l00262"></a>00262       <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;thread_to_lwp: thread state not active: %s&quot;</span>),
<a name="l00263"></a>00263              <a class="code" href="sol-thread_8c.html#aa484bd740dc8b6252b31bcd2b8a76568">td_state_string</a> (ti.<a class="code" href="structtd__thrinfo.html#a137890e3133b03a96dd780e93d9109d9">ti_state</a>));
<a name="l00264"></a>00264     }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266   <span class="keywordflow">return</span> <a class="code" href="ptid_8c.html#aa96ee3f6a88626ec36045b4d84e27f79">ptid_build</a> (<a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (thread_id), ti.<a class="code" href="structtd__thrinfo.html#a260ea1a3410bad7ac271209bd014b467">ti_lid</a>, 0);
<a name="l00267"></a>00267 }
<a name="l00268"></a>00268 
<a name="l00269"></a>00269 <span class="comment">/* Convert an LWP ID into a POSIX or Solaris thread ID.  If LWP_ID</span>
<a name="l00270"></a>00270 <span class="comment">   doesn&#39;t exists, that&#39;s an error.</span>
<a name="l00271"></a>00271 <span class="comment"></span>
<a name="l00272"></a>00272 <span class="comment">   NOTE: This function probably shouldn&#39;t call error().  */</span>
<a name="l00273"></a>00273 
<a name="l00274"></a>00274 <span class="keyword">static</span> <a class="code" href="structptid.html">ptid_t</a>
<a name="l00275"></a><a class="code" href="sol-thread_8c.html#a5350642d69db02a1d3a0512a167b17d4">00275</a> <a class="code" href="sol-thread_8c.html#a5350642d69db02a1d3a0512a167b17d4">lwp_to_thread</a> (<a class="code" href="structptid.html">ptid_t</a> lwp)
<a name="l00276"></a>00276 {
<a name="l00277"></a>00277   <a class="code" href="structtd__thrinfo.html">td_thrinfo_t</a> ti;
<a name="l00278"></a>00278   <a class="code" href="structtd__thrhandle.html">td_thrhandle_t</a> th;
<a name="l00279"></a>00279   <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> val;
<a name="l00280"></a>00280 
<a name="l00281"></a>00281   <span class="keywordflow">if</span> (<a class="code" href="ptid_8c.html#aa96d297e8622a0b6bfaa1fbd8967399a">ptid_tid_p</a> (lwp))
<a name="l00282"></a>00282     <span class="keywordflow">return</span> lwp;                 <span class="comment">/* It&#39;s already a thread ID.  */</span>
<a name="l00283"></a>00283 
<a name="l00284"></a>00284   <span class="comment">/* It&#39;s an LWP.  Convert it to a thread ID.  */</span>
<a name="l00285"></a>00285 
<a name="l00286"></a>00286   <span class="keywordflow">if</span> (!<a class="code" href="target_8c.html#af6aa67c48ec6acc60972d699fee886a2">target_thread_alive</a> (lwp))
<a name="l00287"></a>00287     <span class="keywordflow">return</span> <a class="code" href="ptid_8c.html#a41fa537798e02ba25c7980a7c1e46272">pid_to_ptid</a> (-1);    <span class="comment">/* Must be a defunct LPW.  */</span>
<a name="l00288"></a>00288 
<a name="l00289"></a>00289   val = <a class="code" href="sol-thread_8c.html#a94f192486ed8a55b05810ee34f28c117">p_td_ta_map_lwp2thr</a> (<a class="code" href="sol-thread_8c.html#a60717b62fc8e0f1f1b106661944baee6">main_ta</a>, <a class="code" href="ptid_8c.html#af5b67a5f356c507b7809af2fa4e63b44">ptid_get_lwp</a> (lwp), &amp;th);
<a name="l00290"></a>00290   <span class="keywordflow">if</span> (val == <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a923e209a5e9fd286ddf7f691db028bd8">TD_NOTHR</a>)
<a name="l00291"></a>00291     <span class="keywordflow">return</span> <a class="code" href="ptid_8c.html#a41fa537798e02ba25c7980a7c1e46272">pid_to_ptid</a> (-1);    <span class="comment">/* Thread must have terminated.  */</span>
<a name="l00292"></a>00292   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val != <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a93e810059742feb944de782cee183f3f">TD_OK</a>)
<a name="l00293"></a>00293     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;lwp_to_thread: td_ta_map_lwp2thr: %s.&quot;</span>), <a class="code" href="sol-thread_8c.html#a09dc617f5ccf92d320242515c2ae3dfb">td_err_string</a> (val));
<a name="l00294"></a>00294 
<a name="l00295"></a>00295   val = <a class="code" href="sol-thread_8c.html#af3c2f4871baecf53b20c80319e5377d4">p_td_thr_validate</a> (&amp;th);
<a name="l00296"></a>00296   <span class="keywordflow">if</span> (val == <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a923e209a5e9fd286ddf7f691db028bd8">TD_NOTHR</a>)
<a name="l00297"></a>00297     <span class="keywordflow">return</span> lwp;                 <span class="comment">/* Unknown to libthread; just return LPW,  */</span>
<a name="l00298"></a>00298   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val != <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a93e810059742feb944de782cee183f3f">TD_OK</a>)
<a name="l00299"></a>00299     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;lwp_to_thread: td_thr_validate: %s.&quot;</span>), <a class="code" href="sol-thread_8c.html#a09dc617f5ccf92d320242515c2ae3dfb">td_err_string</a> (val));
<a name="l00300"></a>00300 
<a name="l00301"></a>00301   val = <a class="code" href="sol-thread_8c.html#aa323030b3eb169a6e719c886dc11b3fb">p_td_thr_get_info</a> (&amp;th, &amp;ti);
<a name="l00302"></a>00302   <span class="keywordflow">if</span> (val == <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a923e209a5e9fd286ddf7f691db028bd8">TD_NOTHR</a>)
<a name="l00303"></a>00303     <span class="keywordflow">return</span> <a class="code" href="ptid_8c.html#a41fa537798e02ba25c7980a7c1e46272">pid_to_ptid</a> (-1);    <span class="comment">/* Thread must have terminated.  */</span>
<a name="l00304"></a>00304   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (val != <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a93e810059742feb944de782cee183f3f">TD_OK</a>)
<a name="l00305"></a>00305     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;lwp_to_thread: td_thr_get_info: %s.&quot;</span>), <a class="code" href="sol-thread_8c.html#a09dc617f5ccf92d320242515c2ae3dfb">td_err_string</a> (val));
<a name="l00306"></a>00306 
<a name="l00307"></a>00307   <span class="keywordflow">return</span> <a class="code" href="ptid_8c.html#aa96ee3f6a88626ec36045b4d84e27f79">ptid_build</a> (<a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (lwp), 0 , ti.<a class="code" href="structtd__thrinfo.html#ab80474078af11dda15a23e9a5c4e7a5f">ti_tid</a>);
<a name="l00308"></a>00308 }
<a name="l00309"></a>00309 
<a name="l00310"></a>00310 
<a name="l00311"></a>00311 <span class="comment">/* Most target vector functions from here on actually just pass</span>
<a name="l00312"></a>00312 <span class="comment">   through to the layer beneath, as they don&#39;t need to do anything</span>
<a name="l00313"></a>00313 <span class="comment">   specific for threads.  */</span>
<a name="l00314"></a>00314 
<a name="l00315"></a>00315 <span class="comment">/* Take a program previously attached to and detaches it.  The program</span>
<a name="l00316"></a>00316 <span class="comment">   resumes execution and will no longer stop on signals, etc.  We&#39;d</span>
<a name="l00317"></a>00317 <span class="comment">   better not have left any breakpoints in the program or it&#39;ll die</span>
<a name="l00318"></a>00318 <span class="comment">   when it hits one.  For this to work, it may be necessary for the</span>
<a name="l00319"></a>00319 <span class="comment">   process to have been previously attached.  It *might* work if the</span>
<a name="l00320"></a>00320 <span class="comment">   program was started via the normal ptrace (PTRACE_TRACEME).  */</span>
<a name="l00321"></a>00321 
<a name="l00322"></a>00322 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00323"></a><a class="code" href="sol-thread_8c.html#a7ea3aec4bbc0e0a00722012a324f9788">00323</a> <a class="code" href="sol-thread_8c.html#a7ea3aec4bbc0e0a00722012a324f9788">sol_thread_detach</a> (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *ops, <span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l00324"></a>00324 {
<a name="l00325"></a>00325   <span class="keyword">struct </span><a class="code" href="structtarget__ops.html">target_ops</a> *<a class="code" href="structtarget__ops.html#a1b180ccb4db2afccf46e691862bf2ddf">beneath</a> = <a class="code" href="target_8c.html#afa1a2fb00f3ea15f9394f5b8afe14818">find_target_beneath</a> (ops);
<a name="l00326"></a>00326 
<a name="l00327"></a>00327   <a class="code" href="sol-thread_8c.html#a70efa3c7278acd583ccea400b77096f0">sol_thread_active</a> = 0;
<a name="l00328"></a>00328   <a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a> = <a class="code" href="ptid_8c.html#a41fa537798e02ba25c7980a7c1e46272">pid_to_ptid</a> (<a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (<a class="code" href="sol-thread_8c.html#ad6ea4a4912226100c6116cddd62792ce">main_ph</a>.<a class="code" href="structps__prochandle.html#ac137f90af8832f0784aed26658870623">ptid</a>));
<a name="l00329"></a>00329   <a class="code" href="target_8c.html#a9599d37847d1388531abb3f2aeba6616">unpush_target</a> (ops);
<a name="l00330"></a>00330   beneath-&gt;<a class="code" href="structtarget__ops.html#a2749c09156c21e635d6860af415b7a52">to_detach</a> (beneath, args, from_tty);
<a name="l00331"></a>00331 }
<a name="l00332"></a>00332 
<a name="l00333"></a>00333 <span class="comment">/* Resume execution of process PTID.  If STEP is nozero, then just</span>
<a name="l00334"></a>00334 <span class="comment">   single step it.  If SIGNAL is nonzero, restart it with that signal</span>
<a name="l00335"></a>00335 <span class="comment">   activated.  We may have to convert PTID from a thread ID to an LWP</span>
<a name="l00336"></a>00336 <span class="comment">   ID for procfs.  */</span>
<a name="l00337"></a>00337 
<a name="l00338"></a>00338 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00339"></a><a class="code" href="sol-thread_8c.html#ade9d0c3b5265c8ca19032d4120c963b4">00339</a> <a class="code" href="sol-thread_8c.html#ade9d0c3b5265c8ca19032d4120c963b4">sol_thread_resume</a> (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *ops,
<a name="l00340"></a>00340                    <a class="code" href="structptid.html">ptid_t</a> <a class="code" href="structptid.html">ptid</a>, <span class="keywordtype">int</span> step, <span class="keyword">enum</span> gdb_signal signo)
<a name="l00341"></a>00341 {
<a name="l00342"></a>00342   <span class="keyword">struct </span><a class="code" href="structcleanup.html">cleanup</a> *old_chain;
<a name="l00343"></a>00343   <span class="keyword">struct </span><a class="code" href="structtarget__ops.html">target_ops</a> *<a class="code" href="structtarget__ops.html#a1b180ccb4db2afccf46e691862bf2ddf">beneath</a> = <a class="code" href="target_8c.html#afa1a2fb00f3ea15f9394f5b8afe14818">find_target_beneath</a> (ops);
<a name="l00344"></a>00344 
<a name="l00345"></a>00345   old_chain = <a class="code" href="inferior_8h.html#a3f4175640dba9bda8c87957bb0c183fb">save_inferior_ptid</a> ();
<a name="l00346"></a>00346 
<a name="l00347"></a>00347   <a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a> = <a class="code" href="sol-thread_8c.html#af34ff337f26fa6d8b803a62c9d91af01">thread_to_lwp</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>, <a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (<a class="code" href="sol-thread_8c.html#ad6ea4a4912226100c6116cddd62792ce">main_ph</a>.<a class="code" href="structps__prochandle.html#ac137f90af8832f0784aed26658870623">ptid</a>));
<a name="l00348"></a>00348   <span class="keywordflow">if</span> (<a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>) == -1)
<a name="l00349"></a>00349     <a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a> = <a class="code" href="procfs_8c.html#a31818fe4236fb8af745451ec33677584">procfs_first_available</a> ();
<a name="l00350"></a>00350 
<a name="l00351"></a>00351   <span class="keywordflow">if</span> (<a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (ptid) != -1)
<a name="l00352"></a>00352     {
<a name="l00353"></a>00353       <a class="code" href="structptid.html">ptid_t</a> save_ptid = ptid;
<a name="l00354"></a>00354 
<a name="l00355"></a>00355       ptid = <a class="code" href="sol-thread_8c.html#af34ff337f26fa6d8b803a62c9d91af01">thread_to_lwp</a> (ptid, -2);
<a name="l00356"></a>00356       <span class="keywordflow">if</span> (<a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (ptid) == -2)            <span class="comment">/* Inactive thread.  */</span>
<a name="l00357"></a>00357         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;This version of Solaris can&#39;t start inactive threads.&quot;</span>));
<a name="l00358"></a>00358       <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a3f2f91ed92de5dfaa6d27fb82822f8d5">info_verbose</a> &amp;&amp; <a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (ptid) == -1)
<a name="l00359"></a>00359         <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Specified thread %ld seems to have terminated&quot;</span>),
<a name="l00360"></a>00360                  <a class="code" href="ptid_8c.html#a4af97a74cc1dc6bdc1c8f0ac8398c0ac">ptid_get_tid</a> (save_ptid));
<a name="l00361"></a>00361     }
<a name="l00362"></a>00362 
<a name="l00363"></a>00363   beneath-&gt;<a class="code" href="structtarget__ops.html#a969e77ba44f2d253e041d3b24dde8c87">to_resume</a> (beneath, ptid, step, signo);
<a name="l00364"></a>00364 
<a name="l00365"></a>00365   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l00366"></a>00366 }
<a name="l00367"></a>00367 
<a name="l00368"></a>00368 <span class="comment">/* Wait for any threads to stop.  We may have to convert PTID from a</span>
<a name="l00369"></a>00369 <span class="comment">   thread ID to an LWP ID, and vice versa on the way out.  */</span>
<a name="l00370"></a>00370 
<a name="l00371"></a>00371 <span class="keyword">static</span> <a class="code" href="structptid.html">ptid_t</a>
<a name="l00372"></a><a class="code" href="sol-thread_8c.html#ac015acb00714a20d09682342f612ae76">00372</a> <a class="code" href="sol-thread_8c.html#ac015acb00714a20d09682342f612ae76">sol_thread_wait</a> (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *ops,
<a name="l00373"></a>00373                  <a class="code" href="structptid.html">ptid_t</a> <a class="code" href="structptid.html">ptid</a>, <span class="keyword">struct</span> <a class="code" href="structtarget__waitstatus.html">target_waitstatus</a> *ourstatus, <span class="keywordtype">int</span> options)
<a name="l00374"></a>00374 {
<a name="l00375"></a>00375   <a class="code" href="structptid.html">ptid_t</a> rtnval;
<a name="l00376"></a>00376   <a class="code" href="structptid.html">ptid_t</a> save_ptid;
<a name="l00377"></a>00377   <span class="keyword">struct </span><a class="code" href="structtarget__ops.html">target_ops</a> *<a class="code" href="structtarget__ops.html#a1b180ccb4db2afccf46e691862bf2ddf">beneath</a> = <a class="code" href="target_8c.html#afa1a2fb00f3ea15f9394f5b8afe14818">find_target_beneath</a> (ops);
<a name="l00378"></a>00378   <span class="keyword">struct </span><a class="code" href="structcleanup.html">cleanup</a> *old_chain;
<a name="l00379"></a>00379 
<a name="l00380"></a>00380   save_ptid = <a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>;
<a name="l00381"></a>00381   old_chain = <a class="code" href="inferior_8h.html#a3f4175640dba9bda8c87957bb0c183fb">save_inferior_ptid</a> ();
<a name="l00382"></a>00382 
<a name="l00383"></a>00383   <a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a> = <a class="code" href="sol-thread_8c.html#af34ff337f26fa6d8b803a62c9d91af01">thread_to_lwp</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>, <a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (<a class="code" href="sol-thread_8c.html#ad6ea4a4912226100c6116cddd62792ce">main_ph</a>.<a class="code" href="structps__prochandle.html#ac137f90af8832f0784aed26658870623">ptid</a>));
<a name="l00384"></a>00384   <span class="keywordflow">if</span> (<a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>) == -1)
<a name="l00385"></a>00385     <a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a> = <a class="code" href="procfs_8c.html#a31818fe4236fb8af745451ec33677584">procfs_first_available</a> ();
<a name="l00386"></a>00386 
<a name="l00387"></a>00387   <span class="keywordflow">if</span> (<a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (ptid) != -1)
<a name="l00388"></a>00388     {
<a name="l00389"></a>00389       <a class="code" href="structptid.html">ptid_t</a> save_ptid = ptid;
<a name="l00390"></a>00390 
<a name="l00391"></a>00391       ptid = <a class="code" href="sol-thread_8c.html#af34ff337f26fa6d8b803a62c9d91af01">thread_to_lwp</a> (ptid, -2);
<a name="l00392"></a>00392       <span class="keywordflow">if</span> (<a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (ptid) == -2)            <span class="comment">/* Inactive thread.  */</span>
<a name="l00393"></a>00393         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;This version of Solaris can&#39;t start inactive threads.&quot;</span>));
<a name="l00394"></a>00394       <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a3f2f91ed92de5dfaa6d27fb82822f8d5">info_verbose</a> &amp;&amp; <a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (ptid) == -1)
<a name="l00395"></a>00395         <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Specified thread %ld seems to have terminated&quot;</span>),
<a name="l00396"></a>00396                  <a class="code" href="ptid_8c.html#a4af97a74cc1dc6bdc1c8f0ac8398c0ac">ptid_get_tid</a> (save_ptid));
<a name="l00397"></a>00397     }
<a name="l00398"></a>00398 
<a name="l00399"></a>00399   rtnval = beneath-&gt;<a class="code" href="structtarget__ops.html#ae8e22dbcc8522f0daac3fc8ed2661ca1">to_wait</a> (beneath, ptid, ourstatus, options);
<a name="l00400"></a>00400 
<a name="l00401"></a>00401   <span class="keywordflow">if</span> (ourstatus-&gt;<a class="code" href="structtarget__waitstatus.html#a17ed1783e9146f443fa51ace8da76198">kind</a> != <a class="code" href="waitstatus_8h.html#aa3229b489ec985f04f7e9f652138b7c3ab3b4a30139ccced70de23752ba9de4d4">TARGET_WAITKIND_EXITED</a>)
<a name="l00402"></a>00402     {
<a name="l00403"></a>00403       <span class="comment">/* Map the LWP of interest back to the appropriate thread ID.  */</span>
<a name="l00404"></a>00404       rtnval = <a class="code" href="sol-thread_8c.html#a5350642d69db02a1d3a0512a167b17d4">lwp_to_thread</a> (rtnval);
<a name="l00405"></a>00405       <span class="keywordflow">if</span> (<a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (rtnval) == -1)
<a name="l00406"></a>00406         rtnval = save_ptid;
<a name="l00407"></a>00407 
<a name="l00408"></a>00408       <span class="comment">/* See if we have a new thread.  */</span>
<a name="l00409"></a>00409       <span class="keywordflow">if</span> (<a class="code" href="ptid_8c.html#aa96d297e8622a0b6bfaa1fbd8967399a">ptid_tid_p</a> (rtnval)
<a name="l00410"></a>00410           &amp;&amp; !<a class="code" href="ptid_8c.html#a0df58c8db2620a2cec647934b4f77266">ptid_equal</a> (rtnval, save_ptid)
<a name="l00411"></a>00411           &amp;&amp; (!<a class="code" href="gdbthread_8h.html#a75cff5779f03e4119723fd41a5583fa7">in_thread_list</a> (rtnval)
<a name="l00412"></a>00412               || <a class="code" href="gdbthread_8h.html#a4b919e1603e4636f9bc421f4a89c1d5d">is_exited</a> (rtnval)))
<a name="l00413"></a>00413         <a class="code" href="gdbthread_8h.html#a9e123f760f2bb2f9e96499816360d1cf">add_thread</a> (rtnval);
<a name="l00414"></a>00414     }
<a name="l00415"></a>00415 
<a name="l00416"></a>00416   <span class="comment">/* During process initialization, we may get here without the thread</span>
<a name="l00417"></a>00417 <span class="comment">     package being initialized, since that can only happen after we&#39;ve</span>
<a name="l00418"></a>00418 <span class="comment">     found the shared libs.  */</span>
<a name="l00419"></a>00419 
<a name="l00420"></a>00420   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l00421"></a>00421 
<a name="l00422"></a>00422   <span class="keywordflow">return</span> rtnval;
<a name="l00423"></a>00423 }
<a name="l00424"></a>00424 
<a name="l00425"></a>00425 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00426"></a><a class="code" href="sol-thread_8c.html#aa277a642519e61fbe9ede63e32248dcf">00426</a> <a class="code" href="sol-thread_8c.html#aa277a642519e61fbe9ede63e32248dcf">sol_thread_fetch_registers</a> (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *ops,
<a name="l00427"></a>00427                             <span class="keyword">struct</span> <a class="code" href="structregcache.html">regcache</a> *<a class="code" href="structregcache.html">regcache</a>, <span class="keywordtype">int</span> <a class="code" href="aarch64-tdep_8c.html#a6b3d1ad0bca4067ccaef1366bea0db04">regnum</a>)
<a name="l00428"></a>00428 {
<a name="l00429"></a>00429   <a class="code" href="glibc__thread__db_8h.html#aa406fd87cfd69d7c0a93b6a241978712">thread_t</a> thread;
<a name="l00430"></a>00430   <a class="code" href="structtd__thrhandle.html">td_thrhandle_t</a> thandle;
<a name="l00431"></a>00431   <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> val;
<a name="l00432"></a>00432   <a class="code" href="gdb__proc__service_8h.html#a407082bbbaa95d6d5084823c24e5e4f8">prgregset_t</a> gregset;
<a name="l00433"></a>00433   <a class="code" href="gdb__proc__service_8h.html#a116c1abc1a3d6613a354fa25606e3132">prfpregset_t</a> fpregset;
<a name="l00434"></a>00434   <a class="code" href="gregset_8h.html#ad358cd20eb83ca9e131c708c8aa14c89">gdb_gregset_t</a> *gregset_p = &amp;gregset;
<a name="l00435"></a>00435   <a class="code" href="gregset_8h.html#ac5319835a36948bae33bef8f21542def">gdb_fpregset_t</a> *fpregset_p = &amp;fpregset;
<a name="l00436"></a>00436   <span class="keyword">struct </span><a class="code" href="structtarget__ops.html">target_ops</a> *<a class="code" href="structtarget__ops.html#a1b180ccb4db2afccf46e691862bf2ddf">beneath</a> = <a class="code" href="target_8c.html#afa1a2fb00f3ea15f9394f5b8afe14818">find_target_beneath</a> (ops);
<a name="l00437"></a>00437 
<a name="l00438"></a>00438   <span class="keywordflow">if</span> (!<a class="code" href="ptid_8c.html#aa96d297e8622a0b6bfaa1fbd8967399a">ptid_tid_p</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>))
<a name="l00439"></a>00439     {
<a name="l00440"></a>00440       <span class="comment">/* It&#39;s an LWP; pass the request on to the layer beneath.  */</span>
<a name="l00441"></a>00441       beneath-&gt;<a class="code" href="structtarget__ops.html#a117d2a74c4c794d5b309b106a413ef10">to_fetch_registers</a> (beneath, regcache, regnum);
<a name="l00442"></a>00442       <span class="keywordflow">return</span>;
<a name="l00443"></a>00443     }
<a name="l00444"></a>00444 
<a name="l00445"></a>00445   <span class="comment">/* Solaris thread: convert INFERIOR_PTID into a td_thrhandle_t.  */</span>
<a name="l00446"></a>00446   thread = <a class="code" href="ptid_8c.html#a4af97a74cc1dc6bdc1c8f0ac8398c0ac">ptid_get_tid</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>);
<a name="l00447"></a>00447   <span class="keywordflow">if</span> (thread == 0)
<a name="l00448"></a>00448     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;sol_thread_fetch_registers: thread == 0&quot;</span>));
<a name="l00449"></a>00449 
<a name="l00450"></a>00450   val = <a class="code" href="sol-thread_8c.html#a191a2991088e6ab88152884662e1b311">p_td_ta_map_id2thr</a> (<a class="code" href="sol-thread_8c.html#a60717b62fc8e0f1f1b106661944baee6">main_ta</a>, thread, &amp;thandle);
<a name="l00451"></a>00451   <span class="keywordflow">if</span> (val != <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a93e810059742feb944de782cee183f3f">TD_OK</a>)
<a name="l00452"></a>00452     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;sol_thread_fetch_registers: td_ta_map_id2thr: %s&quot;</span>),
<a name="l00453"></a>00453            <a class="code" href="sol-thread_8c.html#a09dc617f5ccf92d320242515c2ae3dfb">td_err_string</a> (val));
<a name="l00454"></a>00454 
<a name="l00455"></a>00455   <span class="comment">/* Get the general-purpose registers.  */</span>
<a name="l00456"></a>00456 
<a name="l00457"></a>00457   val = <a class="code" href="sol-thread_8c.html#aca1820422902773ed8e001d8b675d30c">p_td_thr_getgregs</a> (&amp;thandle, gregset);
<a name="l00458"></a>00458   <span class="keywordflow">if</span> (val != <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a93e810059742feb944de782cee183f3f">TD_OK</a> &amp;&amp; val != <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434ade80c9872ca4dbb6ca3fb401ae710bba">TD_PARTIALREG</a>)
<a name="l00459"></a>00459     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;sol_thread_fetch_registers: td_thr_getgregs %s&quot;</span>),
<a name="l00460"></a>00460            <a class="code" href="sol-thread_8c.html#a09dc617f5ccf92d320242515c2ae3dfb">td_err_string</a> (val));
<a name="l00461"></a>00461 
<a name="l00462"></a>00462   <span class="comment">/* For SPARC, TD_PARTIALREG means that only %i0...%i7, %l0..%l7, %pc</span>
<a name="l00463"></a>00463 <span class="comment">     and %sp are saved (by a thread context switch).  */</span>
<a name="l00464"></a>00464 
<a name="l00465"></a>00465   <span class="comment">/* And, now the floating-point registers.  */</span>
<a name="l00466"></a>00466 
<a name="l00467"></a>00467   val = <a class="code" href="sol-thread_8c.html#af74ca2287a63f3ac66b597de7fdce7a7">p_td_thr_getfpregs</a> (&amp;thandle, &amp;fpregset);
<a name="l00468"></a>00468   <span class="keywordflow">if</span> (val != <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a93e810059742feb944de782cee183f3f">TD_OK</a> &amp;&amp; val != <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a176156ac8bcd0cd35cc2763567a47d81">TD_NOFPREGS</a>)
<a name="l00469"></a>00469     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;sol_thread_fetch_registers: td_thr_getfpregs %s&quot;</span>),
<a name="l00470"></a>00470            <a class="code" href="sol-thread_8c.html#a09dc617f5ccf92d320242515c2ae3dfb">td_err_string</a> (val));
<a name="l00471"></a>00471 
<a name="l00472"></a>00472   <span class="comment">/* Note that we must call supply_gregset and supply_fpregset *after*</span>
<a name="l00473"></a>00473 <span class="comment">     calling the td routines because the td routines call ps_lget*</span>
<a name="l00474"></a>00474 <span class="comment">     which affect the values stored in the registers array.  */</span>
<a name="l00475"></a>00475 
<a name="l00476"></a>00476   <a class="code" href="aarch64-linux-nat_8c.html#a285dc81c71767c55f35955e6248bf1cd">supply_gregset</a> (regcache, (<span class="keyword">const</span> <a class="code" href="gregset_8h.html#ad358cd20eb83ca9e131c708c8aa14c89">gdb_gregset_t</a> *) gregset_p);
<a name="l00477"></a>00477   <a class="code" href="aarch64-linux-nat_8c.html#a784d41df464cedb2bd9a12f93af6cdb8">supply_fpregset</a> (regcache, (<span class="keyword">const</span> <a class="code" href="gregset_8h.html#ac5319835a36948bae33bef8f21542def">gdb_fpregset_t</a> *) fpregset_p);
<a name="l00478"></a>00478 }
<a name="l00479"></a>00479 
<a name="l00480"></a>00480 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00481"></a><a class="code" href="sol-thread_8c.html#a6ca5cdc9a8e1bd97465c90981a63e572">00481</a> <a class="code" href="sol-thread_8c.html#a6ca5cdc9a8e1bd97465c90981a63e572">sol_thread_store_registers</a> (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *ops,
<a name="l00482"></a>00482                             <span class="keyword">struct</span> <a class="code" href="structregcache.html">regcache</a> *<a class="code" href="structregcache.html">regcache</a>, <span class="keywordtype">int</span> <a class="code" href="aarch64-tdep_8c.html#a6b3d1ad0bca4067ccaef1366bea0db04">regnum</a>)
<a name="l00483"></a>00483 {
<a name="l00484"></a>00484   <a class="code" href="glibc__thread__db_8h.html#aa406fd87cfd69d7c0a93b6a241978712">thread_t</a> thread;
<a name="l00485"></a>00485   <a class="code" href="structtd__thrhandle.html">td_thrhandle_t</a> thandle;
<a name="l00486"></a>00486   <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> val;
<a name="l00487"></a>00487   <a class="code" href="gdb__proc__service_8h.html#a407082bbbaa95d6d5084823c24e5e4f8">prgregset_t</a> gregset;
<a name="l00488"></a>00488   <a class="code" href="gdb__proc__service_8h.html#a116c1abc1a3d6613a354fa25606e3132">prfpregset_t</a> fpregset;
<a name="l00489"></a>00489 
<a name="l00490"></a>00490   <span class="keywordflow">if</span> (!<a class="code" href="ptid_8c.html#aa96d297e8622a0b6bfaa1fbd8967399a">ptid_tid_p</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>))
<a name="l00491"></a>00491     {
<a name="l00492"></a>00492       <span class="keyword">struct </span><a class="code" href="structtarget__ops.html">target_ops</a> *<a class="code" href="structtarget__ops.html#a1b180ccb4db2afccf46e691862bf2ddf">beneath</a> = <a class="code" href="target_8c.html#afa1a2fb00f3ea15f9394f5b8afe14818">find_target_beneath</a> (ops);
<a name="l00493"></a>00493 
<a name="l00494"></a>00494       <span class="comment">/* It&#39;s an LWP; pass the request on to the layer beneath.  */</span>
<a name="l00495"></a>00495       beneath-&gt;<a class="code" href="structtarget__ops.html#a755da40b533b1467a0583a5c8e91a400">to_store_registers</a> (beneath, regcache, regnum);
<a name="l00496"></a>00496       <span class="keywordflow">return</span>;
<a name="l00497"></a>00497     }
<a name="l00498"></a>00498 
<a name="l00499"></a>00499   <span class="comment">/* Solaris thread: convert INFERIOR_PTID into a td_thrhandle_t.  */</span>
<a name="l00500"></a>00500   thread = <a class="code" href="ptid_8c.html#a4af97a74cc1dc6bdc1c8f0ac8398c0ac">ptid_get_tid</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>);
<a name="l00501"></a>00501 
<a name="l00502"></a>00502   val = <a class="code" href="sol-thread_8c.html#a191a2991088e6ab88152884662e1b311">p_td_ta_map_id2thr</a> (<a class="code" href="sol-thread_8c.html#a60717b62fc8e0f1f1b106661944baee6">main_ta</a>, thread, &amp;thandle);
<a name="l00503"></a>00503   <span class="keywordflow">if</span> (val != <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a93e810059742feb944de782cee183f3f">TD_OK</a>)
<a name="l00504"></a>00504     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;sol_thread_store_registers: td_ta_map_id2thr %s&quot;</span>),
<a name="l00505"></a>00505            <a class="code" href="sol-thread_8c.html#a09dc617f5ccf92d320242515c2ae3dfb">td_err_string</a> (val));
<a name="l00506"></a>00506 
<a name="l00507"></a>00507   <span class="keywordflow">if</span> (regnum != -1)
<a name="l00508"></a>00508     {
<a name="l00509"></a>00509       <span class="comment">/* Not writing all the registers.  */</span>
<a name="l00510"></a>00510       <span class="keywordtype">char</span> old_value[<a class="code" href="defs_8h.html#a1f9aebf1de3ebbf4283a4dcf73308562a4f3d67bb99ae292178850a8930ab8252">MAX_REGISTER_SIZE</a>];
<a name="l00511"></a>00511 
<a name="l00512"></a>00512       <span class="comment">/* Save new register value.  */</span>
<a name="l00513"></a>00513       <a class="code" href="regcache_8c.html#a3d2dc4fc1d7d491061e087b547c7f9a8">regcache_raw_collect</a> (regcache, regnum, old_value);
<a name="l00514"></a>00514 
<a name="l00515"></a>00515       val = <a class="code" href="sol-thread_8c.html#aca1820422902773ed8e001d8b675d30c">p_td_thr_getgregs</a> (&amp;thandle, gregset);
<a name="l00516"></a>00516       <span class="keywordflow">if</span> (val != <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a93e810059742feb944de782cee183f3f">TD_OK</a>)
<a name="l00517"></a>00517         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;sol_thread_store_registers: td_thr_getgregs %s&quot;</span>),
<a name="l00518"></a>00518                <a class="code" href="sol-thread_8c.html#a09dc617f5ccf92d320242515c2ae3dfb">td_err_string</a> (val));
<a name="l00519"></a>00519       val = <a class="code" href="sol-thread_8c.html#af74ca2287a63f3ac66b597de7fdce7a7">p_td_thr_getfpregs</a> (&amp;thandle, &amp;fpregset);
<a name="l00520"></a>00520       <span class="keywordflow">if</span> (val != <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a93e810059742feb944de782cee183f3f">TD_OK</a>)
<a name="l00521"></a>00521         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;sol_thread_store_registers: td_thr_getfpregs %s&quot;</span>),
<a name="l00522"></a>00522                <a class="code" href="sol-thread_8c.html#a09dc617f5ccf92d320242515c2ae3dfb">td_err_string</a> (val));
<a name="l00523"></a>00523 
<a name="l00524"></a>00524       <span class="comment">/* Restore new register value.  */</span>
<a name="l00525"></a>00525       <a class="code" href="regcache_8c.html#a127ceeb6f30d3bab748c60570ac077a6">regcache_raw_supply</a> (regcache, regnum, old_value);
<a name="l00526"></a>00526     }
<a name="l00527"></a>00527 
<a name="l00528"></a>00528   <a class="code" href="aarch64-linux-nat_8c.html#a59e9e7e4054210afa3fc8e9f0a1bbc61">fill_gregset</a> (regcache, (<a class="code" href="gregset_8h.html#ad358cd20eb83ca9e131c708c8aa14c89">gdb_gregset_t</a> *) &amp;gregset, regnum);
<a name="l00529"></a>00529   <a class="code" href="aarch64-linux-nat_8c.html#ad18ef6d17cc5848eb79210aed1177cbc">fill_fpregset</a> (regcache, (<a class="code" href="gregset_8h.html#ac5319835a36948bae33bef8f21542def">gdb_fpregset_t</a> *) &amp;fpregset, regnum);
<a name="l00530"></a>00530 
<a name="l00531"></a>00531   val = <a class="code" href="sol-thread_8c.html#a253e60051a328381cd96feaf24c45357">p_td_thr_setgregs</a> (&amp;thandle, gregset);
<a name="l00532"></a>00532   <span class="keywordflow">if</span> (val != <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a93e810059742feb944de782cee183f3f">TD_OK</a>)
<a name="l00533"></a>00533     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;sol_thread_store_registers: td_thr_setgregs %s&quot;</span>),
<a name="l00534"></a>00534            <a class="code" href="sol-thread_8c.html#a09dc617f5ccf92d320242515c2ae3dfb">td_err_string</a> (val));
<a name="l00535"></a>00535   val = <a class="code" href="sol-thread_8c.html#a6d1dc1ce4109725e7d91b92773e8da04">p_td_thr_setfpregs</a> (&amp;thandle, &amp;fpregset);
<a name="l00536"></a>00536   <span class="keywordflow">if</span> (val != <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a93e810059742feb944de782cee183f3f">TD_OK</a>)
<a name="l00537"></a>00537     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;sol_thread_store_registers: td_thr_setfpregs %s&quot;</span>),
<a name="l00538"></a>00538            <a class="code" href="sol-thread_8c.html#a09dc617f5ccf92d320242515c2ae3dfb">td_err_string</a> (val));
<a name="l00539"></a>00539 }
<a name="l00540"></a>00540 
<a name="l00541"></a>00541 <span class="comment">/* Perform partial transfers on OBJECT.  See target_read_partial and</span>
<a name="l00542"></a>00542 <span class="comment">   target_write_partial for details of each variant.  One, and only</span>
<a name="l00543"></a>00543 <span class="comment">   one, of readbuf or writebuf must be non-NULL.  */</span>
<a name="l00544"></a>00544 
<a name="l00545"></a>00545 <span class="keyword">static</span> <a class="code" href="defs_8h.html#ac7647a3f71533007c9e128f3ddda1987">LONGEST</a>
<a name="l00546"></a><a class="code" href="sol-thread_8c.html#a2357eb7ef2c877c830f0bd223764ec9c">00546</a> <a class="code" href="sol-thread_8c.html#a2357eb7ef2c877c830f0bd223764ec9c">sol_thread_xfer_partial</a> (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *ops, <span class="keyword">enum</span> <a class="code" href="target_8h.html#aa5a3e4ceb377c9f5822cdc68c6f138e2">target_object</a> <span class="keywordtype">object</span>,
<a name="l00547"></a>00547                           <span class="keyword">const</span> <span class="keywordtype">char</span> *annex, <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *readbuf,
<a name="l00548"></a>00548                           <span class="keyword">const</span> <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *writebuf,
<a name="l00549"></a>00549                          <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> <a class="code" href="common_2agent_8c.html#aed7ea92f45bd273dde380a45ddced592">offset</a>, <a class="code" href="defs_8h.html#ac7647a3f71533007c9e128f3ddda1987">LONGEST</a> <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>)
<a name="l00550"></a>00550 {
<a name="l00551"></a>00551   <span class="keywordtype">int</span> retval;
<a name="l00552"></a>00552   <span class="keyword">struct </span><a class="code" href="structcleanup.html">cleanup</a> *old_chain;
<a name="l00553"></a>00553   <span class="keyword">struct </span><a class="code" href="structtarget__ops.html">target_ops</a> *<a class="code" href="structtarget__ops.html#a1b180ccb4db2afccf46e691862bf2ddf">beneath</a> = <a class="code" href="target_8c.html#afa1a2fb00f3ea15f9394f5b8afe14818">find_target_beneath</a> (ops);
<a name="l00554"></a>00554 
<a name="l00555"></a>00555   old_chain = <a class="code" href="inferior_8h.html#a3f4175640dba9bda8c87957bb0c183fb">save_inferior_ptid</a> ();
<a name="l00556"></a>00556 
<a name="l00557"></a>00557   <span class="keywordflow">if</span> (<a class="code" href="ptid_8c.html#aa96d297e8622a0b6bfaa1fbd8967399a">ptid_tid_p</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>) || !<a class="code" href="target_8c.html#af6aa67c48ec6acc60972d699fee886a2">target_thread_alive</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>))
<a name="l00558"></a>00558     {
<a name="l00559"></a>00559       <span class="comment">/* It&#39;s either a thread or an LWP that isn&#39;t alive.  Any live</span>
<a name="l00560"></a>00560 <span class="comment">         LWP will do so use the first available.</span>
<a name="l00561"></a>00561 <span class="comment"></span>
<a name="l00562"></a>00562 <span class="comment">         NOTE: We don&#39;t need to call switch_to_thread; we&#39;re just</span>
<a name="l00563"></a>00563 <span class="comment">         reading memory.  */</span>
<a name="l00564"></a>00564       <a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a> = <a class="code" href="procfs_8c.html#a31818fe4236fb8af745451ec33677584">procfs_first_available</a> ();
<a name="l00565"></a>00565     }
<a name="l00566"></a>00566 
<a name="l00567"></a>00567   retval = beneath-&gt;<a class="code" href="structtarget__ops.html#a095389eb9862ff7550e8286c54e33ad3">to_xfer_partial</a> (beneath, <span class="keywordtype">object</span>, annex,
<a name="l00568"></a>00568                                      readbuf, writebuf, offset, len);
<a name="l00569"></a>00569 
<a name="l00570"></a>00570   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l00571"></a>00571 
<a name="l00572"></a>00572   <span class="keywordflow">return</span> retval;
<a name="l00573"></a>00573 }
<a name="l00574"></a>00574 
<a name="l00575"></a>00575 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00576"></a><a class="code" href="sol-thread_8c.html#a921bfde258a972548101598da144cda0">00576</a> <a class="code" href="linux-nat_8h.html#a653cfac1b0c11316e37be8a732176e49">check_for_thread_db</a> (<span class="keywordtype">void</span>)
<a name="l00577"></a>00577 {
<a name="l00578"></a>00578   <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> err;
<a name="l00579"></a>00579   <a class="code" href="structptid.html">ptid_t</a> <a class="code" href="structptid.html">ptid</a>;
<a name="l00580"></a>00580 
<a name="l00581"></a>00581   <span class="comment">/* Do nothing if we couldn&#39;t load libthread_db.so.1.  */</span>
<a name="l00582"></a>00582   <span class="keywordflow">if</span> (<a class="code" href="sol-thread_8c.html#ae0c9712930dc44c74597b0594cc15942">p_td_ta_new</a> == NULL)
<a name="l00583"></a>00583     <span class="keywordflow">return</span>;
<a name="l00584"></a>00584 
<a name="l00585"></a>00585   <span class="keywordflow">if</span> (<a class="code" href="sol-thread_8c.html#a70efa3c7278acd583ccea400b77096f0">sol_thread_active</a>)
<a name="l00586"></a>00586     <span class="comment">/* Nothing to do.  The thread library was already detected and the</span>
<a name="l00587"></a>00587 <span class="comment">       target vector was already activated.  */</span>
<a name="l00588"></a>00588     <span class="keywordflow">return</span>;
<a name="l00589"></a>00589 
<a name="l00590"></a>00590   <span class="comment">/* Now, initialize libthread_db.  This needs to be done after the</span>
<a name="l00591"></a>00591 <span class="comment">     shared libraries are located because it needs information from</span>
<a name="l00592"></a>00592 <span class="comment">     the user&#39;s thread library.  */</span>
<a name="l00593"></a>00593 
<a name="l00594"></a>00594   err = <a class="code" href="sol-thread_8c.html#a1757620e8529cb636366bbe48290e749">p_td_init</a> ();
<a name="l00595"></a>00595   <span class="keywordflow">if</span> (err != <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a93e810059742feb944de782cee183f3f">TD_OK</a>)
<a name="l00596"></a>00596     {
<a name="l00597"></a>00597       <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;sol_thread_new_objfile: td_init: %s&quot;</span>), <a class="code" href="sol-thread_8c.html#a09dc617f5ccf92d320242515c2ae3dfb">td_err_string</a> (err));
<a name="l00598"></a>00598       <span class="keywordflow">return</span>;
<a name="l00599"></a>00599     }
<a name="l00600"></a>00600 
<a name="l00601"></a>00601   <span class="comment">/* Now attempt to open a connection to the thread library.  */</span>
<a name="l00602"></a>00602   err = <a class="code" href="sol-thread_8c.html#ae0c9712930dc44c74597b0594cc15942">p_td_ta_new</a> (&amp;<a class="code" href="sol-thread_8c.html#ad6ea4a4912226100c6116cddd62792ce">main_ph</a>, &amp;<a class="code" href="sol-thread_8c.html#a60717b62fc8e0f1f1b106661944baee6">main_ta</a>);
<a name="l00603"></a>00603   <span class="keywordflow">switch</span> (err)
<a name="l00604"></a>00604     {
<a name="l00605"></a>00605     <span class="keywordflow">case</span> <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434adc7eb8cb36425a689e6770156390a74a">TD_NOLIBTHREAD</a>:
<a name="l00606"></a>00606       <span class="comment">/* No thread library was detected.  */</span>
<a name="l00607"></a>00607       <span class="keywordflow">break</span>;
<a name="l00608"></a>00608 
<a name="l00609"></a>00609     <span class="keywordflow">case</span> <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a93e810059742feb944de782cee183f3f">TD_OK</a>:
<a name="l00610"></a>00610       <a class="code" href="utils_8c.html#ad57145632bbcb0361dc1dfa134b1efd0">printf_unfiltered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;[Thread debugging using libthread_db enabled]\n&quot;</span>));
<a name="l00611"></a>00611 
<a name="l00612"></a>00612       <span class="comment">/* The thread library was detected.  Activate the sol_thread target.  */</span>
<a name="l00613"></a>00613       <a class="code" href="target_8c.html#ada1b9dc1eeb0546d39b86ba7ac645e67">push_target</a> (&amp;<a class="code" href="sol-thread_8c.html#a76a5ea6f020180356d5174c3b3255bcf">sol_thread_ops</a>);
<a name="l00614"></a>00614       <a class="code" href="sol-thread_8c.html#a70efa3c7278acd583ccea400b77096f0">sol_thread_active</a> = 1;
<a name="l00615"></a>00615 
<a name="l00616"></a>00616       <a class="code" href="sol-thread_8c.html#ad6ea4a4912226100c6116cddd62792ce">main_ph</a>.<a class="code" href="structps__prochandle.html#ac137f90af8832f0784aed26658870623">ptid</a> = <a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>; <span class="comment">/* Save for xfer_memory.  */</span>
<a name="l00617"></a>00617       ptid = <a class="code" href="sol-thread_8c.html#a5350642d69db02a1d3a0512a167b17d4">lwp_to_thread</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>);
<a name="l00618"></a>00618       <span class="keywordflow">if</span> (<a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (ptid) != -1)
<a name="l00619"></a>00619         <a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a> = ptid;
<a name="l00620"></a>00620 
<a name="l00621"></a>00621       <a class="code" href="target_8c.html#af3c6bd72cdea7610b1894fff87e1be22">target_find_new_threads</a> ();
<a name="l00622"></a>00622       <span class="keywordflow">break</span>;
<a name="l00623"></a>00623 
<a name="l00624"></a>00624     <span class="keywordflow">default</span>:
<a name="l00625"></a>00625       <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Cannot initialize thread debugging library: %s&quot;</span>),
<a name="l00626"></a>00626                <a class="code" href="sol-thread_8c.html#a09dc617f5ccf92d320242515c2ae3dfb">td_err_string</a> (err));
<a name="l00627"></a>00627       <span class="keywordflow">break</span>;
<a name="l00628"></a>00628     }
<a name="l00629"></a>00629 }
<a name="l00630"></a>00630 
<a name="l00631"></a>00631 <span class="comment">/* This routine is called whenever a new symbol table is read in, or</span>
<a name="l00632"></a>00632 <span class="comment">   when all symbol tables are removed.  libthread_db can only be</span>
<a name="l00633"></a>00633 <span class="comment">   initialized when it finds the right variables in libthread.so.</span>
<a name="l00634"></a>00634 <span class="comment">   Since it&#39;s a shared library, those variables don&#39;t show up until</span>
<a name="l00635"></a>00635 <span class="comment">   the library gets mapped and the symbol table is read in.  */</span>
<a name="l00636"></a>00636 
<a name="l00637"></a>00637 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00638"></a><a class="code" href="sol-thread_8c.html#aaa0cacb45ca49eab010e3294c503b432">00638</a> <a class="code" href="sol-thread_8c.html#aaa0cacb45ca49eab010e3294c503b432">sol_thread_new_objfile</a> (<span class="keyword">struct</span> <a class="code" href="structobjfile.html">objfile</a> *<a class="code" href="structobjfile.html">objfile</a>)
<a name="l00639"></a>00639 {
<a name="l00640"></a>00640   <span class="keywordflow">if</span> (objfile != NULL)
<a name="l00641"></a>00641     <a class="code" href="linux-nat_8h.html#a653cfac1b0c11316e37be8a732176e49">check_for_thread_db</a> ();
<a name="l00642"></a>00642 }
<a name="l00643"></a>00643 
<a name="l00644"></a>00644 <span class="comment">/* Clean up after the inferior dies.  */</span>
<a name="l00645"></a>00645 
<a name="l00646"></a>00646 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00647"></a><a class="code" href="sol-thread_8c.html#a4825c22904b52ea611973ac4bec3e81b">00647</a> <a class="code" href="sol-thread_8c.html#a4825c22904b52ea611973ac4bec3e81b">sol_thread_mourn_inferior</a> (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *ops)
<a name="l00648"></a>00648 {
<a name="l00649"></a>00649   <span class="keyword">struct </span><a class="code" href="structtarget__ops.html">target_ops</a> *<a class="code" href="structtarget__ops.html#a1b180ccb4db2afccf46e691862bf2ddf">beneath</a> = <a class="code" href="target_8c.html#afa1a2fb00f3ea15f9394f5b8afe14818">find_target_beneath</a> (ops);
<a name="l00650"></a>00650 
<a name="l00651"></a>00651   <a class="code" href="sol-thread_8c.html#a70efa3c7278acd583ccea400b77096f0">sol_thread_active</a> = 0;
<a name="l00652"></a>00652 
<a name="l00653"></a>00653   <a class="code" href="target_8c.html#a9599d37847d1388531abb3f2aeba6616">unpush_target</a> (ops);
<a name="l00654"></a>00654 
<a name="l00655"></a>00655   beneath-&gt;<a class="code" href="structtarget__ops.html#aa636723dd143fcd0c3c78af97f7358a5">to_mourn_inferior</a> (beneath);
<a name="l00656"></a>00656 }
<a name="l00657"></a>00657 
<a name="l00658"></a>00658 <span class="comment">/* Return true if PTID is still active in the inferior.  */</span>
<a name="l00659"></a>00659 
<a name="l00660"></a>00660 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00661"></a><a class="code" href="sol-thread_8c.html#af554d6b7309ef3efd3c027bff92dd324">00661</a> <a class="code" href="sol-thread_8c.html#af554d6b7309ef3efd3c027bff92dd324">sol_thread_alive</a> (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *ops, <a class="code" href="structptid.html">ptid_t</a> <a class="code" href="structptid.html">ptid</a>)
<a name="l00662"></a>00662 {
<a name="l00663"></a>00663   <span class="keywordflow">if</span> (<a class="code" href="ptid_8c.html#aa96d297e8622a0b6bfaa1fbd8967399a">ptid_tid_p</a> (ptid))
<a name="l00664"></a>00664     {
<a name="l00665"></a>00665       <span class="comment">/* It&#39;s a (user-level) thread.  */</span>
<a name="l00666"></a>00666       <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> val;
<a name="l00667"></a>00667       <a class="code" href="structtd__thrhandle.html">td_thrhandle_t</a> th;
<a name="l00668"></a>00668       <span class="keywordtype">int</span> pid;
<a name="l00669"></a>00669 
<a name="l00670"></a>00670       pid = <a class="code" href="ptid_8c.html#a4af97a74cc1dc6bdc1c8f0ac8398c0ac">ptid_get_tid</a> (ptid);
<a name="l00671"></a>00671       <span class="keywordflow">if</span> ((val = <a class="code" href="sol-thread_8c.html#a191a2991088e6ab88152884662e1b311">p_td_ta_map_id2thr</a> (<a class="code" href="sol-thread_8c.html#a60717b62fc8e0f1f1b106661944baee6">main_ta</a>, pid, &amp;th)) != <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a93e810059742feb944de782cee183f3f">TD_OK</a>)
<a name="l00672"></a>00672         <span class="keywordflow">return</span> 0;               <span class="comment">/* Thread not found.  */</span>
<a name="l00673"></a>00673       <span class="keywordflow">if</span> ((val = <a class="code" href="sol-thread_8c.html#af3c2f4871baecf53b20c80319e5377d4">p_td_thr_validate</a> (&amp;th)) != <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a93e810059742feb944de782cee183f3f">TD_OK</a>)
<a name="l00674"></a>00674         <span class="keywordflow">return</span> 0;               <span class="comment">/* Thread not valid.  */</span>
<a name="l00675"></a>00675       <span class="keywordflow">return</span> 1;                 <span class="comment">/* Known thread.  */</span>
<a name="l00676"></a>00676     }
<a name="l00677"></a>00677   <span class="keywordflow">else</span>
<a name="l00678"></a>00678     {
<a name="l00679"></a>00679       <span class="keyword">struct </span><a class="code" href="structtarget__ops.html">target_ops</a> *<a class="code" href="structtarget__ops.html#a1b180ccb4db2afccf46e691862bf2ddf">beneath</a> = <a class="code" href="target_8c.html#afa1a2fb00f3ea15f9394f5b8afe14818">find_target_beneath</a> (ops);
<a name="l00680"></a>00680 
<a name="l00681"></a>00681       <span class="comment">/* It&#39;s an LPW; pass the request on to the layer below.  */</span>
<a name="l00682"></a>00682       <span class="keywordflow">return</span> beneath-&gt;<a class="code" href="structtarget__ops.html#a01589152a8f74d8c236c1fab3c2838e9">to_thread_alive</a> (beneath, ptid);
<a name="l00683"></a>00683     }
<a name="l00684"></a>00684 }
<a name="l00685"></a>00685 
<a name="l00686"></a>00686 
<a name="l00687"></a>00687 <span class="comment">/* These routines implement the lower half of the thread_db interface,</span>
<a name="l00688"></a>00688 <span class="comment">   i.e. the ps_* routines.  */</span>
<a name="l00689"></a>00689 
<a name="l00690"></a>00690 <span class="comment">/* Various versions of &lt;proc_service.h&gt; have slightly different</span>
<a name="l00691"></a>00691 <span class="comment">   function prototypes.  In particular, we have</span>
<a name="l00692"></a>00692 <span class="comment"></span>
<a name="l00693"></a>00693 <span class="comment">   NEWER                        OLDER</span>
<a name="l00694"></a>00694 <span class="comment">   struct ps_prochandle *       const struct ps_prochandle *</span>
<a name="l00695"></a>00695 <span class="comment">   void*                        char*</span>
<a name="l00696"></a>00696 <span class="comment">   const void*                  char*</span>
<a name="l00697"></a>00697 <span class="comment">   int                          size_t</span>
<a name="l00698"></a>00698 <span class="comment"></span>
<a name="l00699"></a>00699 <span class="comment">   Which one you have depends on the Solaris version and what patches</span>
<a name="l00700"></a>00700 <span class="comment">   you&#39;ve applied.  On the theory that there are only two major</span>
<a name="l00701"></a>00701 <span class="comment">   variants, we have configure check the prototype of ps_pdwrite (),</span>
<a name="l00702"></a>00702 <span class="comment">   and use that info to make appropriate typedefs here.  */</span>
<a name="l00703"></a>00703 
<a name="l00704"></a>00704 <span class="preprocessor">#ifdef PROC_SERVICE_IS_OLD</span>
<a name="l00705"></a>00705 <span class="preprocessor"></span><span class="keyword">typedef</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structps__prochandle.html">ps_prochandle</a> *<a class="code" href="proc-service_8c.html#a8fc3ee9cb52d64af9cc5033757f9d624">gdb_ps_prochandle_t</a>;
<a name="l00706"></a>00706 <span class="keyword">typedef</span> <span class="keywordtype">char</span> *<a class="code" href="proc-service_8c.html#a72e6f32d95efc6a55833594344800efd">gdb_ps_read_buf_t</a>;
<a name="l00707"></a>00707 <span class="keyword">typedef</span> <span class="keywordtype">char</span> *<a class="code" href="proc-service_8c.html#ab9fefef2fb7797f1c2dedd6ddd32292e">gdb_ps_write_buf_t</a>;
<a name="l00708"></a>00708 <span class="keyword">typedef</span> <span class="keywordtype">int</span> <a class="code" href="proc-service_8c.html#a188ce89d5195295fe21da33b2c696651">gdb_ps_size_t</a>;
<a name="l00709"></a>00709 <span class="keyword">typedef</span> <a class="code" href="gdb__proc__service_8h.html#ad65a744093c157125797432097349eed">psaddr_t</a> <a class="code" href="sol-thread_8c.html#aee40b74c6f2a5503c2268d8d082965ae">gdb_ps_addr_t</a>;
<a name="l00710"></a>00710 <span class="preprocessor">#else</span>
<a name="l00711"></a><a class="code" href="sol-thread_8c.html#a8fc3ee9cb52d64af9cc5033757f9d624">00711</a> <span class="preprocessor"></span><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structps__prochandle.html">ps_prochandle</a> *<a class="code" href="proc-service_8c.html#a8fc3ee9cb52d64af9cc5033757f9d624">gdb_ps_prochandle_t</a>;
<a name="l00712"></a><a class="code" href="sol-thread_8c.html#a72e6f32d95efc6a55833594344800efd">00712</a> <span class="keyword">typedef</span> <span class="keywordtype">void</span> *<a class="code" href="proc-service_8c.html#a72e6f32d95efc6a55833594344800efd">gdb_ps_read_buf_t</a>;
<a name="l00713"></a><a class="code" href="sol-thread_8c.html#ab9fefef2fb7797f1c2dedd6ddd32292e">00713</a> <span class="keyword">typedef</span> <span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="proc-service_8c.html#ab9fefef2fb7797f1c2dedd6ddd32292e">gdb_ps_write_buf_t</a>;
<a name="l00714"></a><a class="code" href="sol-thread_8c.html#a188ce89d5195295fe21da33b2c696651">00714</a> <span class="keyword">typedef</span> <span class="keywordtype">size_t</span> <a class="code" href="proc-service_8c.html#a188ce89d5195295fe21da33b2c696651">gdb_ps_size_t</a>;
<a name="l00715"></a><a class="code" href="sol-thread_8c.html#aee40b74c6f2a5503c2268d8d082965ae">00715</a> <span class="keyword">typedef</span> <a class="code" href="gdb__proc__service_8h.html#ad65a744093c157125797432097349eed">psaddr_t</a> <a class="code" href="sol-thread_8c.html#aee40b74c6f2a5503c2268d8d082965ae">gdb_ps_addr_t</a>;
<a name="l00716"></a>00716 <span class="preprocessor">#endif</span>
<a name="l00717"></a>00717 <span class="preprocessor"></span>
<a name="l00718"></a>00718 <span class="comment">/* The next four routines are called by libthread_db to tell us to</span>
<a name="l00719"></a>00719 <span class="comment">   stop and stop a particular process or lwp.  Since GDB ensures that</span>
<a name="l00720"></a>00720 <span class="comment">   these are all stopped by the time we call anything in thread_db,</span>
<a name="l00721"></a>00721 <span class="comment">   these routines need to do nothing.  */</span>
<a name="l00722"></a>00722 
<a name="l00723"></a>00723 <span class="comment">/* Process stop.  */</span>
<a name="l00724"></a>00724 
<a name="l00725"></a>00725 <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777">ps_err_e</a>
<a name="l00726"></a><a class="code" href="sol-thread_8c.html#a89acb7f13e1327ddec31b2f4628dc4cd">00726</a> <a class="code" href="gdb__proc__service_8h.html#a4b2385575384f2a543e6a845b6bd08af">ps_pstop</a> (gdb_ps_prochandle_t ph)
<a name="l00727"></a>00727 {
<a name="l00728"></a>00728   <span class="keywordflow">return</span> <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777a4d9e1f94202d0062728898d11d1105b1">PS_OK</a>;
<a name="l00729"></a>00729 }
<a name="l00730"></a>00730 
<a name="l00731"></a>00731 <span class="comment">/* Process continue.  */</span>
<a name="l00732"></a>00732 
<a name="l00733"></a>00733 <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777">ps_err_e</a>
<a name="l00734"></a><a class="code" href="sol-thread_8c.html#aa1e400b590dc32f5adc225255fe35ef3">00734</a> <a class="code" href="gdb__proc__service_8h.html#a8c85987adb816a3be5507aa3ea8d3e5c">ps_pcontinue</a> (gdb_ps_prochandle_t ph)
<a name="l00735"></a>00735 {
<a name="l00736"></a>00736   <span class="keywordflow">return</span> <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777a4d9e1f94202d0062728898d11d1105b1">PS_OK</a>;
<a name="l00737"></a>00737 }
<a name="l00738"></a>00738 
<a name="l00739"></a>00739 <span class="comment">/* LWP stop.  */</span>
<a name="l00740"></a>00740 
<a name="l00741"></a>00741 <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777">ps_err_e</a>
<a name="l00742"></a><a class="code" href="sol-thread_8c.html#a746781d2a93dd1aa85f0b6ddb3cc1199">00742</a> <a class="code" href="gdb__proc__service_8h.html#a9f749389bcd77d2c282083972a80d832">ps_lstop</a> (gdb_ps_prochandle_t ph, <a class="code" href="gdb__proc__service_8h.html#ae0e8cfc4f21539a5c5b572c239bb8112">lwpid_t</a> lwpid)
<a name="l00743"></a>00743 {
<a name="l00744"></a>00744   <span class="keywordflow">return</span> <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777a4d9e1f94202d0062728898d11d1105b1">PS_OK</a>;
<a name="l00745"></a>00745 }
<a name="l00746"></a>00746 
<a name="l00747"></a>00747 <span class="comment">/* LWP continue.  */</span>
<a name="l00748"></a>00748 
<a name="l00749"></a>00749 <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777">ps_err_e</a>
<a name="l00750"></a><a class="code" href="sol-thread_8c.html#aff27faa3dec22fe22ca9d0fb65eaf65f">00750</a> <a class="code" href="gdb__proc__service_8h.html#a0cb9b27d9e4ad42f6e1ef6878233e72d">ps_lcontinue</a> (gdb_ps_prochandle_t ph, <a class="code" href="gdb__proc__service_8h.html#ae0e8cfc4f21539a5c5b572c239bb8112">lwpid_t</a> lwpid)
<a name="l00751"></a>00751 {
<a name="l00752"></a>00752   <span class="keywordflow">return</span> <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777a4d9e1f94202d0062728898d11d1105b1">PS_OK</a>;
<a name="l00753"></a>00753 }
<a name="l00754"></a>00754 
<a name="l00755"></a>00755 <span class="comment">/* Looks up the symbol LD_SYMBOL_NAME in the debugger&#39;s symbol table.  */</span>
<a name="l00756"></a>00756 
<a name="l00757"></a>00757 <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777">ps_err_e</a>
<a name="l00758"></a><a class="code" href="sol-thread_8c.html#a27fcdf233b3406c9bf3f48764a80d878">00758</a> <a class="code" href="gdb__proc__service_8h.html#a725b2074d03f82f1ddad408037e65cec">ps_pglobal_lookup</a> (gdb_ps_prochandle_t ph, <span class="keyword">const</span> <span class="keywordtype">char</span> *ld_object_name,
<a name="l00759"></a>00759                    <span class="keyword">const</span> <span class="keywordtype">char</span> *ld_symbol_name, <a class="code" href="sol-thread_8c.html#aee40b74c6f2a5503c2268d8d082965ae">gdb_ps_addr_t</a> *ld_symbol_addr)
<a name="l00760"></a>00760 {
<a name="l00761"></a>00761   <span class="keyword">struct </span><a class="code" href="structminimal__symbol.html">minimal_symbol</a> *ms;
<a name="l00762"></a>00762 
<a name="l00763"></a>00763   ms = <a class="code" href="minsyms_8c.html#af87f7a894386515074ddd71365bc09b8">lookup_minimal_symbol</a> (ld_symbol_name, NULL, NULL);
<a name="l00764"></a>00764   <span class="keywordflow">if</span> (!ms)
<a name="l00765"></a>00765     <span class="keywordflow">return</span> <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777a48bd84aa0aa4d92bd56e26a49bf739d8">PS_NOSYM</a>;
<a name="l00766"></a>00766 
<a name="l00767"></a>00767   *ld_symbol_addr = <a class="code" href="symtab_8h.html#abee697b9e3bb4f4d164ad920a87ab854">SYMBOL_VALUE_ADDRESS</a> (ms);
<a name="l00768"></a>00768   <span class="keywordflow">return</span> <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777a4d9e1f94202d0062728898d11d1105b1">PS_OK</a>;
<a name="l00769"></a>00769 }
<a name="l00770"></a>00770 
<a name="l00771"></a>00771 <span class="comment">/* Common routine for reading and writing memory.  */</span>
<a name="l00772"></a>00772 
<a name="l00773"></a>00773 <span class="keyword">static</span> <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777">ps_err_e</a>
<a name="l00774"></a><a class="code" href="sol-thread_8c.html#ae9bdd9ae70549b60ab41b6e162dcd2ee">00774</a> <a class="code" href="sol-thread_8c.html#ae9bdd9ae70549b60ab41b6e162dcd2ee">rw_common</a> (<span class="keywordtype">int</span> dowrite, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structps__prochandle.html">ps_prochandle</a> *ph, <a class="code" href="sol-thread_8c.html#aee40b74c6f2a5503c2268d8d082965ae">gdb_ps_addr_t</a> addr,
<a name="l00775"></a>00775            <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *buf, <span class="keywordtype">int</span> <a class="code" href="go32-nat_8c.html#a854352f53b148adc24983a58a1866d66">size</a>)
<a name="l00776"></a>00776 {
<a name="l00777"></a>00777   <span class="keywordtype">int</span> ret;
<a name="l00778"></a>00778   <span class="keyword">struct </span><a class="code" href="structcleanup.html">cleanup</a> *old_chain;
<a name="l00779"></a>00779 
<a name="l00780"></a>00780   old_chain = <a class="code" href="inferior_8h.html#a3f4175640dba9bda8c87957bb0c183fb">save_inferior_ptid</a> ();
<a name="l00781"></a>00781 
<a name="l00782"></a>00782   <span class="keywordflow">if</span> (<a class="code" href="ptid_8c.html#aa96d297e8622a0b6bfaa1fbd8967399a">ptid_tid_p</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>) || !<a class="code" href="target_8c.html#af6aa67c48ec6acc60972d699fee886a2">target_thread_alive</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>))
<a name="l00783"></a>00783     {
<a name="l00784"></a>00784       <span class="comment">/* It&#39;s either a thread or an LWP that isn&#39;t alive.  Any live</span>
<a name="l00785"></a>00785 <span class="comment">         LWP will do so use the first available.</span>
<a name="l00786"></a>00786 <span class="comment"></span>
<a name="l00787"></a>00787 <span class="comment">         NOTE: We don&#39;t need to call switch_to_thread; we&#39;re just</span>
<a name="l00788"></a>00788 <span class="comment">         reading memory.  */</span>
<a name="l00789"></a>00789       <a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a> = <a class="code" href="procfs_8c.html#a31818fe4236fb8af745451ec33677584">procfs_first_available</a> ();
<a name="l00790"></a>00790     }
<a name="l00791"></a>00791 
<a name="l00792"></a>00792 <span class="preprocessor">#if defined (__sparcv9)</span>
<a name="l00793"></a>00793 <span class="preprocessor"></span>  <span class="comment">/* For Sparc64 cross Sparc32, make sure the address has not been</span>
<a name="l00794"></a>00794 <span class="comment">     accidentally sign-extended (or whatever) to beyond 32 bits.  */</span>
<a name="l00795"></a>00795   <span class="keywordflow">if</span> (bfd_get_arch_size (<a class="code" href="exec_8h.html#ac2e2e739fca42163e235e8521b9fbbab">exec_bfd</a>) == 32)
<a name="l00796"></a>00796     addr &amp;= 0xffffffff;
<a name="l00797"></a>00797 <span class="preprocessor">#endif</span>
<a name="l00798"></a>00798 <span class="preprocessor"></span>
<a name="l00799"></a>00799   <span class="keywordflow">if</span> (dowrite)
<a name="l00800"></a>00800     ret = <a class="code" href="target_8c.html#a7bd38b77fbf87c003396742f775dd2d4">target_write_memory</a> (addr, (<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) buf, size);
<a name="l00801"></a>00801   <span class="keywordflow">else</span>
<a name="l00802"></a>00802     ret = <a class="code" href="target_8c.html#ac579515fbccfb9e6b1a45766a71c1d4f">target_read_memory</a> (addr, (<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) buf, size);
<a name="l00803"></a>00803 
<a name="l00804"></a>00804   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l00805"></a>00805 
<a name="l00806"></a>00806   <span class="keywordflow">return</span> (ret == 0 ? <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777a4d9e1f94202d0062728898d11d1105b1">PS_OK</a> : <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777addab70dfd82808e0e99f118e3e63e577">PS_ERR</a>);
<a name="l00807"></a>00807 }
<a name="l00808"></a>00808 
<a name="l00809"></a>00809 <span class="comment">/* Copies SIZE bytes from target process .data segment to debugger memory.  */</span>
<a name="l00810"></a>00810 
<a name="l00811"></a>00811 <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777">ps_err_e</a>
<a name="l00812"></a><a class="code" href="sol-thread_8c.html#a86e2251a9b2b760cb8e3e297de521d9f">00812</a> <a class="code" href="gdb__proc__service_8h.html#aee18ebe8fdd0c2dc3fdb13ae34031848">ps_pdread</a> (gdb_ps_prochandle_t ph, <a class="code" href="sol-thread_8c.html#aee40b74c6f2a5503c2268d8d082965ae">gdb_ps_addr_t</a> addr,
<a name="l00813"></a>00813            <a class="code" href="proc-service_8c.html#a72e6f32d95efc6a55833594344800efd">gdb_ps_read_buf_t</a> buf, <a class="code" href="proc-service_8c.html#a188ce89d5195295fe21da33b2c696651">gdb_ps_size_t</a> <a class="code" href="go32-nat_8c.html#a854352f53b148adc24983a58a1866d66">size</a>)
<a name="l00814"></a>00814 {
<a name="l00815"></a>00815   <span class="keywordflow">return</span> <a class="code" href="sol-thread_8c.html#ae9bdd9ae70549b60ab41b6e162dcd2ee">rw_common</a> (0, ph, addr, buf, size);
<a name="l00816"></a>00816 }
<a name="l00817"></a>00817 
<a name="l00818"></a>00818 <span class="comment">/* Copies SIZE bytes from debugger memory .data segment to target process.  */</span>
<a name="l00819"></a>00819 
<a name="l00820"></a>00820 <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777">ps_err_e</a>
<a name="l00821"></a><a class="code" href="sol-thread_8c.html#ad4c799922c4daaa044e1850dde395f49">00821</a> <a class="code" href="gdb__proc__service_8h.html#ab6d6bbc71844eb93b9b28d845708e22d">ps_pdwrite</a> (gdb_ps_prochandle_t ph, <a class="code" href="sol-thread_8c.html#aee40b74c6f2a5503c2268d8d082965ae">gdb_ps_addr_t</a> addr,
<a name="l00822"></a>00822             <a class="code" href="proc-service_8c.html#ab9fefef2fb7797f1c2dedd6ddd32292e">gdb_ps_write_buf_t</a> buf, <a class="code" href="proc-service_8c.html#a188ce89d5195295fe21da33b2c696651">gdb_ps_size_t</a> <a class="code" href="go32-nat_8c.html#a854352f53b148adc24983a58a1866d66">size</a>)
<a name="l00823"></a>00823 {
<a name="l00824"></a>00824   <span class="keywordflow">return</span> <a class="code" href="sol-thread_8c.html#ae9bdd9ae70549b60ab41b6e162dcd2ee">rw_common</a> (1, ph, addr, (<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) buf, size);
<a name="l00825"></a>00825 }
<a name="l00826"></a>00826 
<a name="l00827"></a>00827 <span class="comment">/* Copies SIZE bytes from target process .text segment to debugger memory.  */</span>
<a name="l00828"></a>00828 
<a name="l00829"></a>00829 <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777">ps_err_e</a>
<a name="l00830"></a><a class="code" href="sol-thread_8c.html#ae82e4fde887bd3794fa3ee2b0ce3a236">00830</a> <a class="code" href="gdb__proc__service_8h.html#a11712fb499450fa0971403ee02c77283">ps_ptread</a> (gdb_ps_prochandle_t ph, <a class="code" href="sol-thread_8c.html#aee40b74c6f2a5503c2268d8d082965ae">gdb_ps_addr_t</a> addr,
<a name="l00831"></a>00831            <a class="code" href="proc-service_8c.html#a72e6f32d95efc6a55833594344800efd">gdb_ps_read_buf_t</a> buf, <a class="code" href="proc-service_8c.html#a188ce89d5195295fe21da33b2c696651">gdb_ps_size_t</a> <a class="code" href="go32-nat_8c.html#a854352f53b148adc24983a58a1866d66">size</a>)
<a name="l00832"></a>00832 {
<a name="l00833"></a>00833   <span class="keywordflow">return</span> <a class="code" href="sol-thread_8c.html#ae9bdd9ae70549b60ab41b6e162dcd2ee">rw_common</a> (0, ph, addr, buf, size);
<a name="l00834"></a>00834 }
<a name="l00835"></a>00835 
<a name="l00836"></a>00836 <span class="comment">/* Copies SIZE bytes from debugger memory .text segment to target process.  */</span>
<a name="l00837"></a>00837 
<a name="l00838"></a>00838 <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777">ps_err_e</a>
<a name="l00839"></a><a class="code" href="sol-thread_8c.html#a07b53fe012ed722411e5ce1c975f3643">00839</a> <a class="code" href="gdb__proc__service_8h.html#af22abe62601862c77169a7ed408c892f">ps_ptwrite</a> (gdb_ps_prochandle_t ph, <a class="code" href="sol-thread_8c.html#aee40b74c6f2a5503c2268d8d082965ae">gdb_ps_addr_t</a> addr,
<a name="l00840"></a>00840             <a class="code" href="proc-service_8c.html#ab9fefef2fb7797f1c2dedd6ddd32292e">gdb_ps_write_buf_t</a> buf, <a class="code" href="proc-service_8c.html#a188ce89d5195295fe21da33b2c696651">gdb_ps_size_t</a> <a class="code" href="go32-nat_8c.html#a854352f53b148adc24983a58a1866d66">size</a>)
<a name="l00841"></a>00841 {
<a name="l00842"></a>00842   <span class="keywordflow">return</span> <a class="code" href="sol-thread_8c.html#ae9bdd9ae70549b60ab41b6e162dcd2ee">rw_common</a> (1, ph, addr, (<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) buf, size);
<a name="l00843"></a>00843 }
<a name="l00844"></a>00844 
<a name="l00845"></a>00845 <span class="comment">/* Get general-purpose registers for LWP.  */</span>
<a name="l00846"></a>00846 
<a name="l00847"></a>00847 <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777">ps_err_e</a>
<a name="l00848"></a><a class="code" href="sol-thread_8c.html#a1e9d01966ec2424b9875c999b3033bb6">00848</a> <a class="code" href="gdb__proc__service_8h.html#af4b5b6988b1ece7cf4c4ae6ad8c03424">ps_lgetregs</a> (gdb_ps_prochandle_t ph, <a class="code" href="gdb__proc__service_8h.html#ae0e8cfc4f21539a5c5b572c239bb8112">lwpid_t</a> lwpid, <a class="code" href="gdb__proc__service_8h.html#a407082bbbaa95d6d5084823c24e5e4f8">prgregset_t</a> gregset)
<a name="l00849"></a>00849 {
<a name="l00850"></a>00850   <span class="keyword">struct </span><a class="code" href="structcleanup.html">cleanup</a> *old_chain;
<a name="l00851"></a>00851   <span class="keyword">struct </span><a class="code" href="structregcache.html">regcache</a> *<a class="code" href="structregcache.html">regcache</a>;
<a name="l00852"></a>00852 
<a name="l00853"></a>00853   old_chain = <a class="code" href="inferior_8h.html#a3f4175640dba9bda8c87957bb0c183fb">save_inferior_ptid</a> ();
<a name="l00854"></a>00854 
<a name="l00855"></a>00855   <a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a> = <a class="code" href="ptid_8c.html#aa96ee3f6a88626ec36045b4d84e27f79">ptid_build</a> (<a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>), lwpid, 0);
<a name="l00856"></a>00856   regcache = <a class="code" href="regcache_8c.html#a25cbb6c0d6fb96e9e52937263db0986d">get_thread_arch_regcache</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>, <a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ());
<a name="l00857"></a>00857 
<a name="l00858"></a>00858   <a class="code" href="target_8c.html#a5e70515af98ce168933d973817e91a01">target_fetch_registers</a> (regcache, -1);
<a name="l00859"></a>00859   <a class="code" href="aarch64-linux-nat_8c.html#a59e9e7e4054210afa3fc8e9f0a1bbc61">fill_gregset</a> (regcache, (<a class="code" href="gregset_8h.html#ad358cd20eb83ca9e131c708c8aa14c89">gdb_gregset_t</a> *) gregset, -1);
<a name="l00860"></a>00860 
<a name="l00861"></a>00861   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l00862"></a>00862 
<a name="l00863"></a>00863   <span class="keywordflow">return</span> <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777a4d9e1f94202d0062728898d11d1105b1">PS_OK</a>;
<a name="l00864"></a>00864 }
<a name="l00865"></a>00865 
<a name="l00866"></a>00866 <span class="comment">/* Set general-purpose registers for LWP.  */</span>
<a name="l00867"></a>00867 
<a name="l00868"></a>00868 <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777">ps_err_e</a>
<a name="l00869"></a><a class="code" href="sol-thread_8c.html#ae52aa928d3e082c1d3775f3e2c18c332">00869</a> <a class="code" href="gdb__proc__service_8h.html#aa935bf59fa0a96cb48a66613ee1d1029">ps_lsetregs</a> (gdb_ps_prochandle_t ph, <a class="code" href="gdb__proc__service_8h.html#ae0e8cfc4f21539a5c5b572c239bb8112">lwpid_t</a> lwpid,
<a name="l00870"></a>00870              <span class="keyword">const</span> <a class="code" href="gdb__proc__service_8h.html#a407082bbbaa95d6d5084823c24e5e4f8">prgregset_t</a> gregset)
<a name="l00871"></a>00871 {
<a name="l00872"></a>00872   <span class="keyword">struct </span><a class="code" href="structcleanup.html">cleanup</a> *old_chain;
<a name="l00873"></a>00873   <span class="keyword">struct </span><a class="code" href="structregcache.html">regcache</a> *<a class="code" href="structregcache.html">regcache</a>;
<a name="l00874"></a>00874 
<a name="l00875"></a>00875   old_chain = <a class="code" href="inferior_8h.html#a3f4175640dba9bda8c87957bb0c183fb">save_inferior_ptid</a> ();
<a name="l00876"></a>00876 
<a name="l00877"></a>00877   <a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a> = <a class="code" href="ptid_8c.html#aa96ee3f6a88626ec36045b4d84e27f79">ptid_build</a> (<a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>), lwpid, 0);
<a name="l00878"></a>00878   regcache = <a class="code" href="regcache_8c.html#a25cbb6c0d6fb96e9e52937263db0986d">get_thread_arch_regcache</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>, <a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ());
<a name="l00879"></a>00879 
<a name="l00880"></a>00880   <a class="code" href="aarch64-linux-nat_8c.html#a285dc81c71767c55f35955e6248bf1cd">supply_gregset</a> (regcache, (<span class="keyword">const</span> <a class="code" href="gregset_8h.html#ad358cd20eb83ca9e131c708c8aa14c89">gdb_gregset_t</a> *) gregset);
<a name="l00881"></a>00881   <a class="code" href="target_8c.html#aff289e616f842c7a41461b455a23affa">target_store_registers</a> (regcache, -1);
<a name="l00882"></a>00882 
<a name="l00883"></a>00883   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l00884"></a>00884 
<a name="l00885"></a>00885   <span class="keywordflow">return</span> <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777a4d9e1f94202d0062728898d11d1105b1">PS_OK</a>;
<a name="l00886"></a>00886 }
<a name="l00887"></a>00887 
<a name="l00888"></a>00888 <span class="comment">/* Log a message (sends to gdb_stderr).  */</span>
<a name="l00889"></a>00889 
<a name="l00890"></a>00890 <span class="keywordtype">void</span>
<a name="l00891"></a><a class="code" href="sol-thread_8c.html#a8640fcc019224b34eadbf556adf1dd9e">00891</a> <a class="code" href="gdb__proc__service_8h.html#a8640fcc019224b34eadbf556adf1dd9e">ps_plog</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, ...)
<a name="l00892"></a>00892 {
<a name="l00893"></a>00893   va_list args;
<a name="l00894"></a>00894 
<a name="l00895"></a>00895   va_start (args, fmt);
<a name="l00896"></a>00896 
<a name="l00897"></a>00897   <a class="code" href="utils_8c.html#a3fcf86695d766dd60488ae3fdae3cf0c">vfprintf_filtered</a> (<a class="code" href="main_8c.html#a2a1dea1e551cadb9541353a004193a47">gdb_stderr</a>, fmt, args);
<a name="l00898"></a>00898 }
<a name="l00899"></a>00899 
<a name="l00900"></a>00900 <span class="comment">/* Get size of extra register set.  Currently a noop.  */</span>
<a name="l00901"></a>00901 
<a name="l00902"></a>00902 <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777">ps_err_e</a>
<a name="l00903"></a><a class="code" href="sol-thread_8c.html#acdb218021ead2f5bec0501cb7f462e07">00903</a> <a class="code" href="gdb__proc__service_8h.html#a0c6ec80bb8514c2fad73c4742b123aea">ps_lgetxregsize</a> (gdb_ps_prochandle_t ph, <a class="code" href="gdb__proc__service_8h.html#ae0e8cfc4f21539a5c5b572c239bb8112">lwpid_t</a> lwpid, <span class="keywordtype">int</span> *xregsize)
<a name="l00904"></a>00904 {
<a name="l00905"></a>00905   <span class="keywordflow">return</span> <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777a4d9e1f94202d0062728898d11d1105b1">PS_OK</a>;
<a name="l00906"></a>00906 }
<a name="l00907"></a>00907 
<a name="l00908"></a>00908 <span class="comment">/* Get extra register set.  Currently a noop.  */</span>
<a name="l00909"></a>00909 
<a name="l00910"></a>00910 <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777">ps_err_e</a>
<a name="l00911"></a><a class="code" href="sol-thread_8c.html#a149d8bb86a7540d31da4350d7a56e7be">00911</a> <a class="code" href="gdb__proc__service_8h.html#a63b68700baf988f06cdd4a70143eb35d">ps_lgetxregs</a> (gdb_ps_prochandle_t ph, <a class="code" href="gdb__proc__service_8h.html#ae0e8cfc4f21539a5c5b572c239bb8112">lwpid_t</a> lwpid, caddr_t xregset)
<a name="l00912"></a>00912 {
<a name="l00913"></a>00913   <span class="keywordflow">return</span> <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777a4d9e1f94202d0062728898d11d1105b1">PS_OK</a>;
<a name="l00914"></a>00914 }
<a name="l00915"></a>00915 
<a name="l00916"></a>00916 <span class="comment">/* Set extra register set.  Currently a noop.  */</span>
<a name="l00917"></a>00917 
<a name="l00918"></a>00918 <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777">ps_err_e</a>
<a name="l00919"></a><a class="code" href="sol-thread_8c.html#aac120d31827310e4622e51b753876d36">00919</a> <a class="code" href="gdb__proc__service_8h.html#ad9a7b5a71348cd36ab6acf17e458788a">ps_lsetxregs</a> (gdb_ps_prochandle_t ph, <a class="code" href="gdb__proc__service_8h.html#ae0e8cfc4f21539a5c5b572c239bb8112">lwpid_t</a> lwpid, caddr_t xregset)
<a name="l00920"></a>00920 {
<a name="l00921"></a>00921   <span class="keywordflow">return</span> <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777a4d9e1f94202d0062728898d11d1105b1">PS_OK</a>;
<a name="l00922"></a>00922 }
<a name="l00923"></a>00923 
<a name="l00924"></a>00924 <span class="comment">/* Get floating-point registers for LWP.  */</span>
<a name="l00925"></a>00925 
<a name="l00926"></a>00926 <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777">ps_err_e</a>
<a name="l00927"></a><a class="code" href="sol-thread_8c.html#aa72f90ee9a09941a82490f2b938cf3ba">00927</a> <a class="code" href="gdb__proc__service_8h.html#ab421691dbc49f54c4f8ebc335e2b8951">ps_lgetfpregs</a> (gdb_ps_prochandle_t ph, <a class="code" href="gdb__proc__service_8h.html#ae0e8cfc4f21539a5c5b572c239bb8112">lwpid_t</a> lwpid,
<a name="l00928"></a>00928                <a class="code" href="gdb__proc__service_8h.html#a116c1abc1a3d6613a354fa25606e3132">prfpregset_t</a> *fpregset)
<a name="l00929"></a>00929 {
<a name="l00930"></a>00930   <span class="keyword">struct </span><a class="code" href="structcleanup.html">cleanup</a> *old_chain;
<a name="l00931"></a>00931   <span class="keyword">struct </span><a class="code" href="structregcache.html">regcache</a> *<a class="code" href="structregcache.html">regcache</a>;
<a name="l00932"></a>00932 
<a name="l00933"></a>00933   old_chain = <a class="code" href="inferior_8h.html#a3f4175640dba9bda8c87957bb0c183fb">save_inferior_ptid</a> ();
<a name="l00934"></a>00934 
<a name="l00935"></a>00935   <a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a> = <a class="code" href="ptid_8c.html#aa96ee3f6a88626ec36045b4d84e27f79">ptid_build</a> (<a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>), lwpid, 0);
<a name="l00936"></a>00936   regcache = <a class="code" href="regcache_8c.html#a25cbb6c0d6fb96e9e52937263db0986d">get_thread_arch_regcache</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>, <a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ());
<a name="l00937"></a>00937 
<a name="l00938"></a>00938   <a class="code" href="target_8c.html#a5e70515af98ce168933d973817e91a01">target_fetch_registers</a> (regcache, -1);
<a name="l00939"></a>00939   <a class="code" href="aarch64-linux-nat_8c.html#ad18ef6d17cc5848eb79210aed1177cbc">fill_fpregset</a> (regcache, (<a class="code" href="gregset_8h.html#ac5319835a36948bae33bef8f21542def">gdb_fpregset_t</a> *) fpregset, -1);
<a name="l00940"></a>00940 
<a name="l00941"></a>00941   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l00942"></a>00942 
<a name="l00943"></a>00943   <span class="keywordflow">return</span> <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777a4d9e1f94202d0062728898d11d1105b1">PS_OK</a>;
<a name="l00944"></a>00944 }
<a name="l00945"></a>00945 
<a name="l00946"></a>00946 <span class="comment">/* Set floating-point regs for LWP.  */</span>
<a name="l00947"></a>00947 
<a name="l00948"></a>00948 <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777">ps_err_e</a>
<a name="l00949"></a><a class="code" href="sol-thread_8c.html#a41b6e5f92b5b5a92577ea8e8524acc91">00949</a> <a class="code" href="gdb__proc__service_8h.html#addcb8661a9e8c10f94cb4d942fceb467">ps_lsetfpregs</a> (gdb_ps_prochandle_t ph, <a class="code" href="gdb__proc__service_8h.html#ae0e8cfc4f21539a5c5b572c239bb8112">lwpid_t</a> lwpid,
<a name="l00950"></a>00950                <span class="keyword">const</span> <a class="code" href="gdb__proc__service_8h.html#a116c1abc1a3d6613a354fa25606e3132">prfpregset_t</a> * fpregset)
<a name="l00951"></a>00951 {
<a name="l00952"></a>00952   <span class="keyword">struct </span><a class="code" href="structcleanup.html">cleanup</a> *old_chain;
<a name="l00953"></a>00953   <span class="keyword">struct </span><a class="code" href="structregcache.html">regcache</a> *<a class="code" href="structregcache.html">regcache</a>;
<a name="l00954"></a>00954 
<a name="l00955"></a>00955   old_chain = <a class="code" href="inferior_8h.html#a3f4175640dba9bda8c87957bb0c183fb">save_inferior_ptid</a> ();
<a name="l00956"></a>00956 
<a name="l00957"></a>00957   <a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a> = <a class="code" href="ptid_8c.html#aa96ee3f6a88626ec36045b4d84e27f79">ptid_build</a> (<a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>), lwpid, 0);
<a name="l00958"></a>00958   regcache = <a class="code" href="regcache_8c.html#a25cbb6c0d6fb96e9e52937263db0986d">get_thread_arch_regcache</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>, <a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ());
<a name="l00959"></a>00959 
<a name="l00960"></a>00960   <a class="code" href="aarch64-linux-nat_8c.html#a784d41df464cedb2bd9a12f93af6cdb8">supply_fpregset</a> (regcache, (<span class="keyword">const</span> <a class="code" href="gregset_8h.html#ac5319835a36948bae33bef8f21542def">gdb_fpregset_t</a> *) fpregset);
<a name="l00961"></a>00961   <a class="code" href="target_8c.html#aff289e616f842c7a41461b455a23affa">target_store_registers</a> (regcache, -1);
<a name="l00962"></a>00962 
<a name="l00963"></a>00963   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l00964"></a>00964 
<a name="l00965"></a>00965   <span class="keywordflow">return</span> <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777a4d9e1f94202d0062728898d11d1105b1">PS_OK</a>;
<a name="l00966"></a>00966 }
<a name="l00967"></a>00967 
<a name="l00968"></a>00968 <span class="preprocessor">#ifdef PR_MODEL_LP64</span>
<a name="l00969"></a>00969 <span class="preprocessor"></span><span class="comment">/* Identify process as 32-bit or 64-bit.  At the moment we&#39;re using</span>
<a name="l00970"></a>00970 <span class="comment">   BFD to do this.  There might be a more Solaris-specific</span>
<a name="l00971"></a>00971 <span class="comment">   (e.g. procfs) method, but this ought to work.  */</span>
<a name="l00972"></a>00972 
<a name="l00973"></a>00973 <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777">ps_err_e</a>
<a name="l00974"></a>00974 ps_pdmodel (gdb_ps_prochandle_t ph, <span class="keywordtype">int</span> *data_model)
<a name="l00975"></a>00975 {
<a name="l00976"></a>00976   <span class="keywordflow">if</span> (<a class="code" href="exec_8h.html#ac2e2e739fca42163e235e8521b9fbbab">exec_bfd</a> == 0)
<a name="l00977"></a>00977     *data_model = PR_MODEL_UNKNOWN;
<a name="l00978"></a>00978   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bfd_get_arch_size (<a class="code" href="exec_8h.html#ac2e2e739fca42163e235e8521b9fbbab">exec_bfd</a>) == 32)
<a name="l00979"></a>00979     *data_model = PR_MODEL_ILP32;
<a name="l00980"></a>00980   <span class="keywordflow">else</span>
<a name="l00981"></a>00981     *data_model = PR_MODEL_LP64;
<a name="l00982"></a>00982 
<a name="l00983"></a>00983   <span class="keywordflow">return</span> <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777a4d9e1f94202d0062728898d11d1105b1">PS_OK</a>;
<a name="l00984"></a>00984 }
<a name="l00985"></a>00985 <span class="preprocessor">#endif </span><span class="comment">/* PR_MODEL_LP64 */</span>
<a name="l00986"></a>00986 
<a name="l00987"></a>00987 <span class="preprocessor">#if (defined(__i386__) || defined(__x86_64__)) &amp;&amp; defined (sun)</span>
<a name="l00988"></a>00988 <span class="preprocessor"></span>
<a name="l00989"></a>00989 <span class="comment">/* Reads the local descriptor table of a LWP.</span>
<a name="l00990"></a>00990 <span class="comment"></span>
<a name="l00991"></a>00991 <span class="comment">   This function is necessary on x86-solaris only.  Without it, the loading</span>
<a name="l00992"></a>00992 <span class="comment">   of libthread_db would fail because of ps_lgetLDT being undefined.  */</span>
<a name="l00993"></a>00993 
<a name="l00994"></a>00994 <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777">ps_err_e</a>
<a name="l00995"></a>00995 ps_lgetLDT (gdb_ps_prochandle_t ph, <a class="code" href="gdb__proc__service_8h.html#ae0e8cfc4f21539a5c5b572c239bb8112">lwpid_t</a> lwpid,
<a name="l00996"></a>00996             <span class="keyword">struct</span> ssd *pldt)
<a name="l00997"></a>00997 {
<a name="l00998"></a>00998   <span class="comment">/* NOTE: only used on Solaris, therefore OK to refer to procfs.c.  */</span>
<a name="l00999"></a>00999   <span class="keyword">struct </span>ssd *ret;
<a name="l01000"></a>01000 
<a name="l01001"></a>01001   <span class="comment">/* FIXME: can&#39;t I get the process ID from the prochandle or</span>
<a name="l01002"></a>01002 <span class="comment">     something?  */</span>
<a name="l01003"></a>01003 
<a name="l01004"></a>01004   <span class="keywordflow">if</span> (<a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>) &lt;= 0 || lwpid &lt;= 0)
<a name="l01005"></a>01005     <span class="keywordflow">return</span> <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777af6e5530891a6d238582a476581f0dabe">PS_BADLID</a>;
<a name="l01006"></a>01006 
<a name="l01007"></a>01007   ret = procfs_find_LDT_entry (<a class="code" href="ptid_8c.html#aa96ee3f6a88626ec36045b4d84e27f79">ptid_build</a> (<a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>),
<a name="l01008"></a>01008                                lwpid, 0));
<a name="l01009"></a>01009   <span class="keywordflow">if</span> (ret)
<a name="l01010"></a>01010     {
<a name="l01011"></a>01011       <a class="code" href="gdb__string_8h.html#a39ebe6a4e122707997e78b549a1e8c5e">memcpy</a> (pldt, ret, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> ssd));
<a name="l01012"></a>01012       <span class="keywordflow">return</span> <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777a4d9e1f94202d0062728898d11d1105b1">PS_OK</a>;
<a name="l01013"></a>01013     }
<a name="l01014"></a>01014   <span class="keywordflow">else</span>
<a name="l01015"></a>01015     <span class="comment">/* LDT not found.  */</span>
<a name="l01016"></a>01016     <span class="keywordflow">return</span> <a class="code" href="gdb__proc__service_8h.html#a6e7ca191f6aa7c32a4ada70ec9da4777addab70dfd82808e0e99f118e3e63e577">PS_ERR</a>;
<a name="l01017"></a>01017 }
<a name="l01018"></a>01018 <span class="preprocessor">#endif</span>
<a name="l01019"></a>01019 <span class="preprocessor"></span>
<a name="l01020"></a>01020 
<a name="l01021"></a>01021 <span class="comment">/* Convert PTID to printable form.  */</span>
<a name="l01022"></a>01022 
<a name="l01023"></a>01023 <span class="keyword">static</span> <span class="keywordtype">char</span> *
<a name="l01024"></a><a class="code" href="sol-thread_8c.html#aff459b4c258b219a0c5a5361e655dfff">01024</a> <a class="code" href="sol-thread_8c.html#aff459b4c258b219a0c5a5361e655dfff">solaris_pid_to_str</a> (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *ops, <a class="code" href="structptid.html">ptid_t</a> <a class="code" href="structptid.html">ptid</a>)
<a name="l01025"></a>01025 {
<a name="l01026"></a>01026   <span class="keyword">static</span> <span class="keywordtype">char</span> buf[100];
<a name="l01027"></a>01027 
<a name="l01028"></a>01028   <span class="keywordflow">if</span> (<a class="code" href="ptid_8c.html#aa96d297e8622a0b6bfaa1fbd8967399a">ptid_tid_p</a> (ptid))
<a name="l01029"></a>01029     {
<a name="l01030"></a>01030       <a class="code" href="structptid.html">ptid_t</a> lwp;
<a name="l01031"></a>01031 
<a name="l01032"></a>01032       lwp = <a class="code" href="sol-thread_8c.html#af34ff337f26fa6d8b803a62c9d91af01">thread_to_lwp</a> (ptid, -2);
<a name="l01033"></a>01033 
<a name="l01034"></a>01034       <span class="keywordflow">if</span> (<a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (lwp) == -1)
<a name="l01035"></a>01035         <a class="code" href="common-utils_8c.html#ad9940337ec98983dae9951c947879fc8">xsnprintf</a> (buf, <span class="keyword">sizeof</span> (buf), <span class="stringliteral">&quot;Thread %ld (defunct)&quot;</span>,
<a name="l01036"></a>01036                    <a class="code" href="ptid_8c.html#a4af97a74cc1dc6bdc1c8f0ac8398c0ac">ptid_get_tid</a> (ptid));
<a name="l01037"></a>01037       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (lwp) != -2)
<a name="l01038"></a>01038         <a class="code" href="common-utils_8c.html#ad9940337ec98983dae9951c947879fc8">xsnprintf</a> (buf, <span class="keyword">sizeof</span> (buf), <span class="stringliteral">&quot;Thread %ld (LWP %ld)&quot;</span>,
<a name="l01039"></a>01039                  <a class="code" href="ptid_8c.html#a4af97a74cc1dc6bdc1c8f0ac8398c0ac">ptid_get_tid</a> (ptid), <a class="code" href="ptid_8c.html#af5b67a5f356c507b7809af2fa4e63b44">ptid_get_lwp</a> (lwp));
<a name="l01040"></a>01040       <span class="keywordflow">else</span>
<a name="l01041"></a>01041         <a class="code" href="common-utils_8c.html#ad9940337ec98983dae9951c947879fc8">xsnprintf</a> (buf, <span class="keyword">sizeof</span> (buf), <span class="stringliteral">&quot;Thread %ld        &quot;</span>,
<a name="l01042"></a>01042                    <a class="code" href="ptid_8c.html#a4af97a74cc1dc6bdc1c8f0ac8398c0ac">ptid_get_tid</a> (ptid));
<a name="l01043"></a>01043     }
<a name="l01044"></a>01044   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ptid_8c.html#af5b67a5f356c507b7809af2fa4e63b44">ptid_get_lwp</a> (ptid) != 0)
<a name="l01045"></a>01045     <a class="code" href="common-utils_8c.html#ad9940337ec98983dae9951c947879fc8">xsnprintf</a> (buf, <span class="keyword">sizeof</span> (buf), <span class="stringliteral">&quot;LWP    %ld        &quot;</span>, <a class="code" href="ptid_8c.html#af5b67a5f356c507b7809af2fa4e63b44">ptid_get_lwp</a> (ptid));
<a name="l01046"></a>01046   <span class="keywordflow">else</span>
<a name="l01047"></a>01047     <a class="code" href="common-utils_8c.html#ad9940337ec98983dae9951c947879fc8">xsnprintf</a> (buf, <span class="keyword">sizeof</span> (buf), <span class="stringliteral">&quot;process %d    &quot;</span>, <a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (ptid));
<a name="l01048"></a>01048 
<a name="l01049"></a>01049   <span class="keywordflow">return</span> buf;
<a name="l01050"></a>01050 }
<a name="l01051"></a>01051 
<a name="l01052"></a>01052 
<a name="l01053"></a>01053 <span class="comment">/* Worker bee for find_new_threads.  Callback function that gets</span>
<a name="l01054"></a>01054 <span class="comment">   called once per user-level thread (i.e. not for LWP&#39;s).  */</span>
<a name="l01055"></a>01055 
<a name="l01056"></a>01056 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01057"></a><a class="code" href="sol-thread_8c.html#a5b2de6a0c25b8c0e7d19396655a89f60">01057</a> <a class="code" href="sol-thread_8c.html#a5b2de6a0c25b8c0e7d19396655a89f60">sol_find_new_threads_callback</a> (<span class="keyword">const</span> <a class="code" href="structtd__thrhandle.html">td_thrhandle_t</a> *th, <span class="keywordtype">void</span> *ignored)
<a name="l01058"></a>01058 {
<a name="l01059"></a>01059   <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> retval;
<a name="l01060"></a>01060   <a class="code" href="structtd__thrinfo.html">td_thrinfo_t</a> ti;
<a name="l01061"></a>01061   <a class="code" href="structptid.html">ptid_t</a> <a class="code" href="structptid.html">ptid</a>;
<a name="l01062"></a>01062 
<a name="l01063"></a>01063   retval = <a class="code" href="sol-thread_8c.html#aa323030b3eb169a6e719c886dc11b3fb">p_td_thr_get_info</a> (th, &amp;ti);
<a name="l01064"></a>01064   <span class="keywordflow">if</span> (retval != <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a93e810059742feb944de782cee183f3f">TD_OK</a>)
<a name="l01065"></a>01065     <span class="keywordflow">return</span> -1;
<a name="l01066"></a>01066 
<a name="l01067"></a>01067   ptid = <a class="code" href="ptid_8c.html#aa96ee3f6a88626ec36045b4d84e27f79">ptid_build</a> (<a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>), 0, ti.<a class="code" href="structtd__thrinfo.html#ab80474078af11dda15a23e9a5c4e7a5f">ti_tid</a>);
<a name="l01068"></a>01068   <span class="keywordflow">if</span> (!<a class="code" href="gdbthread_8h.html#a75cff5779f03e4119723fd41a5583fa7">in_thread_list</a> (ptid) || <a class="code" href="gdbthread_8h.html#a4b919e1603e4636f9bc421f4a89c1d5d">is_exited</a> (ptid))
<a name="l01069"></a>01069     <a class="code" href="gdbthread_8h.html#a9e123f760f2bb2f9e96499816360d1cf">add_thread</a> (ptid);
<a name="l01070"></a>01070 
<a name="l01071"></a>01071   <span class="keywordflow">return</span> 0;
<a name="l01072"></a>01072 }
<a name="l01073"></a>01073 
<a name="l01074"></a>01074 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01075"></a><a class="code" href="sol-thread_8c.html#a452ff20027ed0653eb7ad1efdd88a295">01075</a> <a class="code" href="sol-thread_8c.html#a452ff20027ed0653eb7ad1efdd88a295">sol_find_new_threads</a> (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *ops)
<a name="l01076"></a>01076 {
<a name="l01077"></a>01077   <span class="keyword">struct </span><a class="code" href="structtarget__ops.html">target_ops</a> *<a class="code" href="structtarget__ops.html#a1b180ccb4db2afccf46e691862bf2ddf">beneath</a> = <a class="code" href="target_8c.html#afa1a2fb00f3ea15f9394f5b8afe14818">find_target_beneath</a> (ops);
<a name="l01078"></a>01078 
<a name="l01079"></a>01079   <span class="comment">/* First Find any new LWP&#39;s.  */</span>
<a name="l01080"></a>01080   <span class="keywordflow">if</span> (beneath-&gt;<a class="code" href="structtarget__ops.html#a6af5d37da6d3dd1ef3b2beb4cd9fdd81">to_find_new_threads</a> != NULL)
<a name="l01081"></a>01081     beneath-&gt;<a class="code" href="structtarget__ops.html#a6af5d37da6d3dd1ef3b2beb4cd9fdd81">to_find_new_threads</a> (beneath);
<a name="l01082"></a>01082 
<a name="l01083"></a>01083   <span class="comment">/* Then find any new user-level threads.  */</span>
<a name="l01084"></a>01084   <a class="code" href="sol-thread_8c.html#ad6535c0b507f2282e5d6ecf2e738f305">p_td_ta_thr_iter</a> (<a class="code" href="sol-thread_8c.html#a60717b62fc8e0f1f1b106661944baee6">main_ta</a>, <a class="code" href="sol-thread_8c.html#a5b2de6a0c25b8c0e7d19396655a89f60">sol_find_new_threads_callback</a>, (<span class="keywordtype">void</span> *) 0,
<a name="l01085"></a>01085                     <a class="code" href="glibc__thread__db_8h.html#a7e015b84265c7d3667103553d8230d8eaa7598975576c3ad9f6900645f216ff74">TD_THR_ANY_STATE</a>, <a class="code" href="glibc__thread__db_8h.html#a39686658953e72ecc96340a450187dd3">TD_THR_LOWEST_PRIORITY</a>,
<a name="l01086"></a>01086                     <a class="code" href="glibc__thread__db_8h.html#a0a42742d59778244b7f5e7ab2c97527d">TD_SIGNO_MASK</a>, <a class="code" href="glibc__thread__db_8h.html#ac004d54a1e1a2221185a34a5076673d4">TD_THR_ANY_USER_FLAGS</a>);
<a name="l01087"></a>01087 }
<a name="l01088"></a>01088 
<a name="l01089"></a>01089 <span class="comment">/* Worker bee for the &quot;info sol-thread&quot; command.  This is a callback</span>
<a name="l01090"></a>01090 <span class="comment">   function that gets called once for each Solaris user-level thread</span>
<a name="l01091"></a>01091 <span class="comment">   (i.e. not for LWPs) in the inferior.  Print anything interesting</span>
<a name="l01092"></a>01092 <span class="comment">   that we can think of.  */</span>
<a name="l01093"></a>01093 
<a name="l01094"></a>01094 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01095"></a><a class="code" href="sol-thread_8c.html#a6458b2c59eb4def42e4431393e20b6a7">01095</a> <a class="code" href="sol-thread_8c.html#a6458b2c59eb4def42e4431393e20b6a7">info_cb</a> (<span class="keyword">const</span> <a class="code" href="structtd__thrhandle.html">td_thrhandle_t</a> *th, <span class="keywordtype">void</span> *s)
<a name="l01096"></a>01096 {
<a name="l01097"></a>01097   <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434">td_err_e</a> ret;
<a name="l01098"></a>01098   <a class="code" href="structtd__thrinfo.html">td_thrinfo_t</a> ti;
<a name="l01099"></a>01099 
<a name="l01100"></a>01100   ret = <a class="code" href="sol-thread_8c.html#aa323030b3eb169a6e719c886dc11b3fb">p_td_thr_get_info</a> (th, &amp;ti);
<a name="l01101"></a>01101   <span class="keywordflow">if</span> (ret == <a class="code" href="glibc__thread__db_8h.html#a03bba0f82045c1a5bb35aa55e693f434a93e810059742feb944de782cee183f3f">TD_OK</a>)
<a name="l01102"></a>01102     {
<a name="l01103"></a>01103       <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;%s thread #%d, lwp %d, &quot;</span>,
<a name="l01104"></a>01104                        ti.<a class="code" href="structtd__thrinfo.html#a219d04e79d0a3db222d021287d283987">ti_type</a> == <a class="code" href="glibc__thread__db_8h.html#aabda5874a9e345d0cb603ac251cd4860ac1abf1f8a110ef92acbfdee695e8a95a">TD_THR_SYSTEM</a> ? <span class="stringliteral">&quot;system&quot;</span> : <span class="stringliteral">&quot;user  &quot;</span>,
<a name="l01105"></a>01105                        ti.<a class="code" href="structtd__thrinfo.html#ab80474078af11dda15a23e9a5c4e7a5f">ti_tid</a>, ti.<a class="code" href="structtd__thrinfo.html#a260ea1a3410bad7ac271209bd014b467">ti_lid</a>);
<a name="l01106"></a>01106       <span class="keywordflow">switch</span> (ti.<a class="code" href="structtd__thrinfo.html#a137890e3133b03a96dd780e93d9109d9">ti_state</a>)
<a name="l01107"></a>01107         {
<a name="l01108"></a>01108         <span class="keywordflow">default</span>:
<a name="l01109"></a>01109         <span class="keywordflow">case</span> <a class="code" href="glibc__thread__db_8h.html#a7e015b84265c7d3667103553d8230d8eae5a95caf13bb3f3138f8c2f7c42a8473">TD_THR_UNKNOWN</a>:
<a name="l01110"></a>01110           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;&lt;unknown state&gt;&quot;</span>);
<a name="l01111"></a>01111           <span class="keywordflow">break</span>;
<a name="l01112"></a>01112         <span class="keywordflow">case</span> <a class="code" href="glibc__thread__db_8h.html#a7e015b84265c7d3667103553d8230d8ea8b36ffff700a29862946d8bf7a86e236">TD_THR_STOPPED</a>:
<a name="l01113"></a>01113           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;(stopped)&quot;</span>);
<a name="l01114"></a>01114           <span class="keywordflow">break</span>;
<a name="l01115"></a>01115         <span class="keywordflow">case</span> <a class="code" href="glibc__thread__db_8h.html#a7e015b84265c7d3667103553d8230d8ea34ea41cb09d07fcf5089666087431c1e">TD_THR_RUN</a>:
<a name="l01116"></a>01116           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;(run)    &quot;</span>);
<a name="l01117"></a>01117           <span class="keywordflow">break</span>;
<a name="l01118"></a>01118         <span class="keywordflow">case</span> <a class="code" href="glibc__thread__db_8h.html#a7e015b84265c7d3667103553d8230d8ead2531288df0901605a906357be33768e">TD_THR_ACTIVE</a>:
<a name="l01119"></a>01119           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;(active) &quot;</span>);
<a name="l01120"></a>01120           <span class="keywordflow">break</span>;
<a name="l01121"></a>01121         <span class="keywordflow">case</span> <a class="code" href="glibc__thread__db_8h.html#a7e015b84265c7d3667103553d8230d8eade49dca447c1cd9167eb487102f580b3">TD_THR_ZOMBIE</a>:
<a name="l01122"></a>01122           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;(zombie) &quot;</span>);
<a name="l01123"></a>01123           <span class="keywordflow">break</span>;
<a name="l01124"></a>01124         <span class="keywordflow">case</span> <a class="code" href="glibc__thread__db_8h.html#a7e015b84265c7d3667103553d8230d8ea3045ddd4f7fd42aef776b6ece1191903">TD_THR_SLEEP</a>:
<a name="l01125"></a>01125           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;(asleep) &quot;</span>);
<a name="l01126"></a>01126           <span class="keywordflow">break</span>;
<a name="l01127"></a>01127         <span class="keywordflow">case</span> <a class="code" href="glibc__thread__db_8h.html#a7e015b84265c7d3667103553d8230d8eacceb59b58d49515364ad81281cac55c9">TD_THR_STOPPED_ASLEEP</a>:
<a name="l01128"></a>01128           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;(stopped asleep)&quot;</span>);
<a name="l01129"></a>01129           <span class="keywordflow">break</span>;
<a name="l01130"></a>01130         }
<a name="l01131"></a>01131       <span class="comment">/* Print thr_create start function.  */</span>
<a name="l01132"></a>01132       <span class="keywordflow">if</span> (ti.<a class="code" href="structtd__thrinfo.html#ad951ec12605fff14290254a8830da316">ti_startfunc</a> != 0)
<a name="l01133"></a>01133         {
<a name="l01134"></a>01134           <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structbound__minimal__symbol.html">bound_minimal_symbol</a> msym
<a name="l01135"></a>01135             = <a class="code" href="minsyms_8c.html#ad4b48b6ef6c913138a8ac33f8c3cfeb2">lookup_minimal_symbol_by_pc</a> (ti.<a class="code" href="structtd__thrinfo.html#ad951ec12605fff14290254a8830da316">ti_startfunc</a>);
<a name="l01136"></a>01136 
<a name="l01137"></a>01137           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;   startfunc=%s&quot;</span>,
<a name="l01138"></a>01138                            msym.<a class="code" href="structbound__minimal__symbol.html#aabff08898c1d96d6c68a95f35b635214">minsym</a>
<a name="l01139"></a>01139                            ? <a class="code" href="symtab_8h.html#ac7f4cb1648125545fbd0e4f13b0c572c">SYMBOL_PRINT_NAME</a> (msym.<a class="code" href="structbound__minimal__symbol.html#aabff08898c1d96d6c68a95f35b635214">minsym</a>)
<a name="l01140"></a>01140                            : <a class="code" href="utils_8c.html#ab5c76d72090f01d3848b63dda4e37d1c">paddress</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> (), ti.<a class="code" href="structtd__thrinfo.html#ad951ec12605fff14290254a8830da316">ti_startfunc</a>));
<a name="l01141"></a>01141         }
<a name="l01142"></a>01142 
<a name="l01143"></a>01143       <span class="comment">/* If thread is asleep, print function that went to sleep.  */</span>
<a name="l01144"></a>01144       <span class="keywordflow">if</span> (ti.<a class="code" href="structtd__thrinfo.html#a137890e3133b03a96dd780e93d9109d9">ti_state</a> == <a class="code" href="glibc__thread__db_8h.html#a7e015b84265c7d3667103553d8230d8ea3045ddd4f7fd42aef776b6ece1191903">TD_THR_SLEEP</a>)
<a name="l01145"></a>01145         {
<a name="l01146"></a>01146           <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structbound__minimal__symbol.html">bound_minimal_symbol</a> msym
<a name="l01147"></a>01147             = <a class="code" href="minsyms_8c.html#ad4b48b6ef6c913138a8ac33f8c3cfeb2">lookup_minimal_symbol_by_pc</a> (ti.<a class="code" href="structtd__thrinfo.html#a9b37c55ee27379a2d145bc02d8328c2b">ti_pc</a>);
<a name="l01148"></a>01148 
<a name="l01149"></a>01149           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;   sleepfunc=%s&quot;</span>,
<a name="l01150"></a>01150                            msym.<a class="code" href="structbound__minimal__symbol.html#aabff08898c1d96d6c68a95f35b635214">minsym</a>
<a name="l01151"></a>01151                            ? <a class="code" href="symtab_8h.html#ac7f4cb1648125545fbd0e4f13b0c572c">SYMBOL_PRINT_NAME</a> (msym.<a class="code" href="structbound__minimal__symbol.html#aabff08898c1d96d6c68a95f35b635214">minsym</a>)
<a name="l01152"></a>01152                            : <a class="code" href="utils_8c.html#ab5c76d72090f01d3848b63dda4e37d1c">paddress</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> (), ti.<a class="code" href="structtd__thrinfo.html#a9b37c55ee27379a2d145bc02d8328c2b">ti_pc</a>));
<a name="l01153"></a>01153         }
<a name="l01154"></a>01154 
<a name="l01155"></a>01155       <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01156"></a>01156     }
<a name="l01157"></a>01157   <span class="keywordflow">else</span>
<a name="l01158"></a>01158     <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;info sol-thread: failed to get info for thread.&quot;</span>));
<a name="l01159"></a>01159 
<a name="l01160"></a>01160   <span class="keywordflow">return</span> 0;
<a name="l01161"></a>01161 }
<a name="l01162"></a>01162 
<a name="l01163"></a>01163 <span class="comment">/* List some state about each Solaris user-level thread in the</span>
<a name="l01164"></a>01164 <span class="comment">   inferior.  */</span>
<a name="l01165"></a>01165 
<a name="l01166"></a>01166 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01167"></a><a class="code" href="sol-thread_8c.html#aac31a1f3c5338ffa59b319168ae4968f">01167</a> <a class="code" href="sol-thread_8c.html#aac31a1f3c5338ffa59b319168ae4968f">info_solthreads</a> (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l01168"></a>01168 {
<a name="l01169"></a>01169   <a class="code" href="sol-thread_8c.html#ad6535c0b507f2282e5d6ecf2e738f305">p_td_ta_thr_iter</a> (<a class="code" href="sol-thread_8c.html#a60717b62fc8e0f1f1b106661944baee6">main_ta</a>, <a class="code" href="sol-thread_8c.html#a6458b2c59eb4def42e4431393e20b6a7">info_cb</a>, args,
<a name="l01170"></a>01170                     <a class="code" href="glibc__thread__db_8h.html#a7e015b84265c7d3667103553d8230d8eaa7598975576c3ad9f6900645f216ff74">TD_THR_ANY_STATE</a>, <a class="code" href="glibc__thread__db_8h.html#a39686658953e72ecc96340a450187dd3">TD_THR_LOWEST_PRIORITY</a>,
<a name="l01171"></a>01171                     <a class="code" href="glibc__thread__db_8h.html#a0a42742d59778244b7f5e7ab2c97527d">TD_SIGNO_MASK</a>, <a class="code" href="glibc__thread__db_8h.html#ac004d54a1e1a2221185a34a5076673d4">TD_THR_ANY_USER_FLAGS</a>);
<a name="l01172"></a>01172 }
<a name="l01173"></a>01173 
<a name="l01174"></a>01174 <span class="comment">/* Callback routine used to find a thread based on the TID part of</span>
<a name="l01175"></a>01175 <span class="comment">   its PTID.  */</span>
<a name="l01176"></a>01176 
<a name="l01177"></a>01177 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01178"></a><a class="code" href="sol-thread_8c.html#a907556bbfa0a5a068c88ae4efc405315">01178</a> <a class="code" href="sol-thread_8c.html#a907556bbfa0a5a068c88ae4efc405315">thread_db_find_thread_from_tid</a> (<span class="keyword">struct</span> <a class="code" href="structthread__info.html">thread_info</a> *thread, <span class="keywordtype">void</span> *data)
<a name="l01179"></a>01179 {
<a name="l01180"></a>01180   <span class="keywordtype">long</span> *tid = (<span class="keywordtype">long</span> *) data;
<a name="l01181"></a>01181 
<a name="l01182"></a>01182   <span class="keywordflow">if</span> (<a class="code" href="ptid_8c.html#a4af97a74cc1dc6bdc1c8f0ac8398c0ac">ptid_get_tid</a> (thread-&gt;<a class="code" href="structthread__info.html#a533aa3979b60affd446e9fbff93fdd2c">ptid</a>) == *tid)
<a name="l01183"></a>01183     <span class="keywordflow">return</span> 1;
<a name="l01184"></a>01184 
<a name="l01185"></a>01185   <span class="keywordflow">return</span> 0;
<a name="l01186"></a>01186 }
<a name="l01187"></a>01187 
<a name="l01188"></a>01188 <span class="keyword">static</span> <a class="code" href="structptid.html">ptid_t</a>
<a name="l01189"></a><a class="code" href="sol-thread_8c.html#ac8da4cf625cccfa202422691185b1dce">01189</a> <a class="code" href="sol-thread_8c.html#ac8da4cf625cccfa202422691185b1dce">sol_get_ada_task_ptid</a> (<span class="keywordtype">long</span> lwp, <span class="keywordtype">long</span> thread)
<a name="l01190"></a>01190 {
<a name="l01191"></a>01191   <span class="keyword">struct </span><a class="code" href="structthread__info.html">thread_info</a> *<a class="code" href="structthread__info.html">thread_info</a> =
<a name="l01192"></a>01192     <a class="code" href="gdbthread_8h.html#a5dc20fee3cc8a79f615f2f5d695ae1bc">iterate_over_threads</a> (<a class="code" href="sol-thread_8c.html#a907556bbfa0a5a068c88ae4efc405315">thread_db_find_thread_from_tid</a>, &amp;thread);
<a name="l01193"></a>01193 
<a name="l01194"></a>01194   <span class="keywordflow">if</span> (thread_info == NULL)
<a name="l01195"></a>01195     {
<a name="l01196"></a>01196       <span class="comment">/* The list of threads is probably not up to date.  Find any</span>
<a name="l01197"></a>01197 <span class="comment">         thread that is missing from the list, and try again.  */</span>
<a name="l01198"></a>01198       <a class="code" href="sol-thread_8c.html#a452ff20027ed0653eb7ad1efdd88a295">sol_find_new_threads</a> (&amp;<a class="code" href="target_8h.html#a2d8640b030266b58d3821eb5cfd112b9">current_target</a>);
<a name="l01199"></a>01199       thread_info = <a class="code" href="gdbthread_8h.html#a5dc20fee3cc8a79f615f2f5d695ae1bc">iterate_over_threads</a> (<a class="code" href="sol-thread_8c.html#a907556bbfa0a5a068c88ae4efc405315">thread_db_find_thread_from_tid</a>,
<a name="l01200"></a>01200                                           &amp;thread);
<a name="l01201"></a>01201     }
<a name="l01202"></a>01202 
<a name="l01203"></a>01203   <a class="code" href="gdb__assert_8h.html#aeb007d3e990858c7ef8e40a7e512c1ff">gdb_assert</a> (thread_info != NULL);
<a name="l01204"></a>01204 
<a name="l01205"></a>01205   <span class="keywordflow">return</span> (thread_info-&gt;<a class="code" href="structthread__info.html#a533aa3979b60affd446e9fbff93fdd2c">ptid</a>);
<a name="l01206"></a>01206 }
<a name="l01207"></a>01207 
<a name="l01208"></a>01208 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01209"></a><a class="code" href="sol-thread_8c.html#a0093c6956afeec22b2647903f64955cc">01209</a> <a class="code" href="sol-thread_8c.html#a0093c6956afeec22b2647903f64955cc">init_sol_thread_ops</a> (<span class="keywordtype">void</span>)
<a name="l01210"></a>01210 {
<a name="l01211"></a>01211   <a class="code" href="sol-thread_8c.html#a76a5ea6f020180356d5174c3b3255bcf">sol_thread_ops</a>.<a class="code" href="structtarget__ops.html#a9326c3129ee116786b1ca1a95713f125">to_shortname</a> = <span class="stringliteral">&quot;solaris-threads&quot;</span>;
<a name="l01212"></a>01212   <a class="code" href="sol-thread_8c.html#a76a5ea6f020180356d5174c3b3255bcf">sol_thread_ops</a>.<a class="code" href="structtarget__ops.html#a184ee9aa071d32ec535cf7394aba0bd1">to_longname</a> = <span class="stringliteral">&quot;Solaris threads and pthread.&quot;</span>;
<a name="l01213"></a>01213   <a class="code" href="sol-thread_8c.html#a76a5ea6f020180356d5174c3b3255bcf">sol_thread_ops</a>.<a class="code" href="structtarget__ops.html#a1b0c848329708688e3816263b16fe664">to_doc</a> = <span class="stringliteral">&quot;Solaris threads and pthread support.&quot;</span>;
<a name="l01214"></a>01214   <a class="code" href="sol-thread_8c.html#a76a5ea6f020180356d5174c3b3255bcf">sol_thread_ops</a>.<a class="code" href="structtarget__ops.html#a2749c09156c21e635d6860af415b7a52">to_detach</a> = <a class="code" href="sol-thread_8c.html#a7ea3aec4bbc0e0a00722012a324f9788">sol_thread_detach</a>;
<a name="l01215"></a>01215   <a class="code" href="sol-thread_8c.html#a76a5ea6f020180356d5174c3b3255bcf">sol_thread_ops</a>.<a class="code" href="structtarget__ops.html#a969e77ba44f2d253e041d3b24dde8c87">to_resume</a> = <a class="code" href="sol-thread_8c.html#ade9d0c3b5265c8ca19032d4120c963b4">sol_thread_resume</a>;
<a name="l01216"></a>01216   <a class="code" href="sol-thread_8c.html#a76a5ea6f020180356d5174c3b3255bcf">sol_thread_ops</a>.<a class="code" href="structtarget__ops.html#ae8e22dbcc8522f0daac3fc8ed2661ca1">to_wait</a> = <a class="code" href="sol-thread_8c.html#ac015acb00714a20d09682342f612ae76">sol_thread_wait</a>;
<a name="l01217"></a>01217   <a class="code" href="sol-thread_8c.html#a76a5ea6f020180356d5174c3b3255bcf">sol_thread_ops</a>.<a class="code" href="structtarget__ops.html#a117d2a74c4c794d5b309b106a413ef10">to_fetch_registers</a> = <a class="code" href="sol-thread_8c.html#aa277a642519e61fbe9ede63e32248dcf">sol_thread_fetch_registers</a>;
<a name="l01218"></a>01218   <a class="code" href="sol-thread_8c.html#a76a5ea6f020180356d5174c3b3255bcf">sol_thread_ops</a>.<a class="code" href="structtarget__ops.html#a755da40b533b1467a0583a5c8e91a400">to_store_registers</a> = <a class="code" href="sol-thread_8c.html#a6ca5cdc9a8e1bd97465c90981a63e572">sol_thread_store_registers</a>;
<a name="l01219"></a>01219   <a class="code" href="sol-thread_8c.html#a76a5ea6f020180356d5174c3b3255bcf">sol_thread_ops</a>.<a class="code" href="structtarget__ops.html#a095389eb9862ff7550e8286c54e33ad3">to_xfer_partial</a> = <a class="code" href="sol-thread_8c.html#a2357eb7ef2c877c830f0bd223764ec9c">sol_thread_xfer_partial</a>;
<a name="l01220"></a>01220   <a class="code" href="sol-thread_8c.html#a76a5ea6f020180356d5174c3b3255bcf">sol_thread_ops</a>.<a class="code" href="structtarget__ops.html#aa636723dd143fcd0c3c78af97f7358a5">to_mourn_inferior</a> = <a class="code" href="sol-thread_8c.html#a4825c22904b52ea611973ac4bec3e81b">sol_thread_mourn_inferior</a>;
<a name="l01221"></a>01221   <a class="code" href="sol-thread_8c.html#a76a5ea6f020180356d5174c3b3255bcf">sol_thread_ops</a>.<a class="code" href="structtarget__ops.html#a01589152a8f74d8c236c1fab3c2838e9">to_thread_alive</a> = <a class="code" href="sol-thread_8c.html#af554d6b7309ef3efd3c027bff92dd324">sol_thread_alive</a>;
<a name="l01222"></a>01222   <a class="code" href="sol-thread_8c.html#a76a5ea6f020180356d5174c3b3255bcf">sol_thread_ops</a>.<a class="code" href="structtarget__ops.html#a5259fe0b12fd9dd4e269ed44fee00603">to_pid_to_str</a> = <a class="code" href="sol-thread_8c.html#aff459b4c258b219a0c5a5361e655dfff">solaris_pid_to_str</a>;
<a name="l01223"></a>01223   <a class="code" href="sol-thread_8c.html#a76a5ea6f020180356d5174c3b3255bcf">sol_thread_ops</a>.<a class="code" href="structtarget__ops.html#a6af5d37da6d3dd1ef3b2beb4cd9fdd81">to_find_new_threads</a> = <a class="code" href="sol-thread_8c.html#a452ff20027ed0653eb7ad1efdd88a295">sol_find_new_threads</a>;
<a name="l01224"></a>01224   <a class="code" href="sol-thread_8c.html#a76a5ea6f020180356d5174c3b3255bcf">sol_thread_ops</a>.<a class="code" href="structtarget__ops.html#aaf1f75f86ec2b948e5df3548198aae4b">to_stratum</a> = <a class="code" href="target_8h.html#abf9ea8b4aa7bddf6a8aa3882d0dadd00acb67d325de9eee5f1a42ffc81d9efedf">thread_stratum</a>;
<a name="l01225"></a>01225   <a class="code" href="sol-thread_8c.html#a76a5ea6f020180356d5174c3b3255bcf">sol_thread_ops</a>.<a class="code" href="structtarget__ops.html#a1d246b305b808ee45e23eba2afcd796a">to_get_ada_task_ptid</a> = <a class="code" href="sol-thread_8c.html#ac8da4cf625cccfa202422691185b1dce">sol_get_ada_task_ptid</a>;
<a name="l01226"></a>01226   <a class="code" href="sol-thread_8c.html#a76a5ea6f020180356d5174c3b3255bcf">sol_thread_ops</a>.<a class="code" href="structtarget__ops.html#a97a3b404ed5a64b8f6229fdaf43d30fb">to_magic</a> = <a class="code" href="target_8h.html#a52de2938b46ac35e4a8c50fead44fd4d">OPS_MAGIC</a>;
<a name="l01227"></a>01227 }
<a name="l01228"></a>01228 
<a name="l01229"></a>01229 <span class="comment">/* Silence -Wmissing-prototypes.  */</span>
<a name="l01230"></a>01230 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="sol-thread_8c.html#abc6677f4fe512ab80cc9724060c76912">_initialize_sol_thread</a> (<span class="keywordtype">void</span>);
<a name="l01231"></a>01231 
<a name="l01232"></a>01232 <span class="keywordtype">void</span>
<a name="l01233"></a><a class="code" href="sol-thread_8c.html#abc6677f4fe512ab80cc9724060c76912">01233</a> <a class="code" href="sol-thread_8c.html#abc6677f4fe512ab80cc9724060c76912">_initialize_sol_thread</a> (<span class="keywordtype">void</span>)
<a name="l01234"></a>01234 {
<a name="l01235"></a>01235   <span class="keywordtype">void</span> *dlhandle;
<a name="l01236"></a>01236 
<a name="l01237"></a>01237   <a class="code" href="sol-thread_8c.html#a0093c6956afeec22b2647903f64955cc">init_sol_thread_ops</a> ();
<a name="l01238"></a>01238 
<a name="l01239"></a>01239   dlhandle = dlopen (<span class="stringliteral">&quot;libthread_db.so.1&quot;</span>, RTLD_NOW);
<a name="l01240"></a>01240   <span class="keywordflow">if</span> (!dlhandle)
<a name="l01241"></a>01241     <span class="keywordflow">goto</span> die;
<a name="l01242"></a>01242 
<a name="l01243"></a>01243 <span class="preprocessor">#define resolve(X) \</span>
<a name="l01244"></a>01244 <span class="preprocessor">  if (!(p_##X = dlsym (dlhandle, #X))) \</span>
<a name="l01245"></a>01245 <span class="preprocessor">    goto die;</span>
<a name="l01246"></a>01246 <span class="preprocessor"></span>
<a name="l01247"></a>01247   <a class="code" href="sol-thread_8c.html#abbb193592c924dcda7896a284d3bd592">resolve</a> (<a class="code" href="glibc__thread__db_8h.html#a9220d9325223b104a601436d07d90bef">td_log</a>);
<a name="l01248"></a>01248   <a class="code" href="sol-thread_8c.html#abbb193592c924dcda7896a284d3bd592">resolve</a> (<a class="code" href="glibc__thread__db_8h.html#a560ade2d2a89e429856072c075cec38b">td_ta_new</a>);
<a name="l01249"></a>01249   <a class="code" href="sol-thread_8c.html#abbb193592c924dcda7896a284d3bd592">resolve</a> (<a class="code" href="glibc__thread__db_8h.html#af1ffd364ea00f860c076b5b8d08a43f0">td_ta_delete</a>);
<a name="l01250"></a>01250   <a class="code" href="sol-thread_8c.html#abbb193592c924dcda7896a284d3bd592">resolve</a> (<a class="code" href="glibc__thread__db_8h.html#abc8d849640a0e0d2b78f2d4d2c82adca">td_init</a>);
<a name="l01251"></a>01251   <a class="code" href="sol-thread_8c.html#abbb193592c924dcda7896a284d3bd592">resolve</a> (<a class="code" href="glibc__thread__db_8h.html#a9e26a1eb8b2801d3dc6ecc79e6f8f0a1">td_ta_get_ph</a>);
<a name="l01252"></a>01252   <a class="code" href="sol-thread_8c.html#abbb193592c924dcda7896a284d3bd592">resolve</a> (<a class="code" href="glibc__thread__db_8h.html#a797dfc9f2c7d443a3225a6e994df7191">td_ta_get_nthreads</a>);
<a name="l01253"></a>01253   <a class="code" href="sol-thread_8c.html#abbb193592c924dcda7896a284d3bd592">resolve</a> (<a class="code" href="glibc__thread__db_8h.html#a0919ebcbdb79107743bff5e161755b25">td_ta_tsd_iter</a>);
<a name="l01254"></a>01254   <a class="code" href="sol-thread_8c.html#abbb193592c924dcda7896a284d3bd592">resolve</a> (<a class="code" href="glibc__thread__db_8h.html#a88fcd4452d947de238d2e5882825f7a2">td_ta_thr_iter</a>);
<a name="l01255"></a>01255   <a class="code" href="sol-thread_8c.html#abbb193592c924dcda7896a284d3bd592">resolve</a> (<a class="code" href="glibc__thread__db_8h.html#acbd836ad9df35a3ecc639dc5c527d62e">td_thr_validate</a>);
<a name="l01256"></a>01256   <a class="code" href="sol-thread_8c.html#abbb193592c924dcda7896a284d3bd592">resolve</a> (<a class="code" href="glibc__thread__db_8h.html#a6e1728b292b68d0ede71c50d48416cd5">td_thr_tsd</a>);
<a name="l01257"></a>01257   <a class="code" href="sol-thread_8c.html#abbb193592c924dcda7896a284d3bd592">resolve</a> (<a class="code" href="glibc__thread__db_8h.html#afd523bd275051655a6d6b997e9486282">td_thr_get_info</a>);
<a name="l01258"></a>01258   <a class="code" href="sol-thread_8c.html#abbb193592c924dcda7896a284d3bd592">resolve</a> (<a class="code" href="glibc__thread__db_8h.html#a31eb128e904c8ff67672f3593b901a45">td_thr_getfpregs</a>);
<a name="l01259"></a>01259   <a class="code" href="sol-thread_8c.html#abbb193592c924dcda7896a284d3bd592">resolve</a> (<a class="code" href="glibc__thread__db_8h.html#a8bdf233dda995ae3b407de1a636620d7">td_thr_getxregsize</a>);
<a name="l01260"></a>01260   <a class="code" href="sol-thread_8c.html#abbb193592c924dcda7896a284d3bd592">resolve</a> (<a class="code" href="glibc__thread__db_8h.html#a0d28439d16bbe9f26cee85844dc7d7d9">td_thr_getxregs</a>);
<a name="l01261"></a>01261   <a class="code" href="sol-thread_8c.html#abbb193592c924dcda7896a284d3bd592">resolve</a> (<a class="code" href="glibc__thread__db_8h.html#a39c4edfeba64336a5e0aa14bb8ef9789">td_thr_sigsetmask</a>);
<a name="l01262"></a>01262   <a class="code" href="sol-thread_8c.html#abbb193592c924dcda7896a284d3bd592">resolve</a> (<a class="code" href="glibc__thread__db_8h.html#a070a74765e4fe6516a7e2242cde38203">td_thr_setprio</a>);
<a name="l01263"></a>01263   <a class="code" href="sol-thread_8c.html#abbb193592c924dcda7896a284d3bd592">resolve</a> (<a class="code" href="glibc__thread__db_8h.html#aab715140cb2fd940b945366486c4c41c">td_thr_setsigpending</a>);
<a name="l01264"></a>01264   <a class="code" href="sol-thread_8c.html#abbb193592c924dcda7896a284d3bd592">resolve</a> (<a class="code" href="glibc__thread__db_8h.html#a416c3326bfd83ff7793f72a696c5670b">td_thr_setfpregs</a>);
<a name="l01265"></a>01265   <a class="code" href="sol-thread_8c.html#abbb193592c924dcda7896a284d3bd592">resolve</a> (<a class="code" href="glibc__thread__db_8h.html#a5e6d5d0b3f9a9e6457d87e43d7eefb18">td_thr_setxregs</a>);
<a name="l01266"></a>01266   <a class="code" href="sol-thread_8c.html#abbb193592c924dcda7896a284d3bd592">resolve</a> (<a class="code" href="glibc__thread__db_8h.html#a349494525c33af0675543657520c6617">td_ta_map_id2thr</a>);
<a name="l01267"></a>01267   <a class="code" href="sol-thread_8c.html#abbb193592c924dcda7896a284d3bd592">resolve</a> (<a class="code" href="glibc__thread__db_8h.html#aa7dfd6cc674cc4f3232928dd422c9966">td_ta_map_lwp2thr</a>);
<a name="l01268"></a>01268   <a class="code" href="sol-thread_8c.html#abbb193592c924dcda7896a284d3bd592">resolve</a> (<a class="code" href="glibc__thread__db_8h.html#ae163da0eb1f56cfe5db0a71bf723ca3c">td_thr_getgregs</a>);
<a name="l01269"></a>01269   <a class="code" href="sol-thread_8c.html#abbb193592c924dcda7896a284d3bd592">resolve</a> (<a class="code" href="glibc__thread__db_8h.html#a114d7269990e08ed770837f851bc73ff">td_thr_setgregs</a>);
<a name="l01270"></a>01270 
<a name="l01271"></a>01271   <a class="code" href="target_8c.html#a1cdc1b41e34c193ca58094f37746bb65">complete_target_initialization</a> (&amp;<a class="code" href="sol-thread_8c.html#a76a5ea6f020180356d5174c3b3255bcf">sol_thread_ops</a>);
<a name="l01272"></a>01272 
<a name="l01273"></a>01273   <a class="code" href="cli-decode_8c.html#ab87b0ba51ed9aa4c8aac0c96373537f8">add_cmd</a> (<span class="stringliteral">&quot;sol-threads&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49a502c7b57c7172ac88ef735f68070bb59">class_maintenance</a>, <a class="code" href="sol-thread_8c.html#aac31a1f3c5338ffa59b319168ae4968f">info_solthreads</a>,
<a name="l01274"></a>01274            <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Show info on Solaris user threads.&quot;</span>), &amp;<a class="code" href="cli-cmds_8c.html#adea9c2a6ad27de2f64d04262ff61d43f">maintenanceinfolist</a>);
<a name="l01275"></a>01275 
<a name="l01276"></a>01276   <span class="comment">/* Hook into new_objfile notification.  */</span>
<a name="l01277"></a>01277   <a class="code" href="observer_8h.html#a688df6ed7b6f01418f3498e7c376e360">observer_attach_new_objfile</a> (<a class="code" href="sol-thread_8c.html#aaa0cacb45ca49eab010e3294c503b432">sol_thread_new_objfile</a>);
<a name="l01278"></a>01278   <span class="keywordflow">return</span>;
<a name="l01279"></a>01279 
<a name="l01280"></a>01280  die:
<a name="l01281"></a>01281   <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a2a1dea1e551cadb9541353a004193a47">gdb_stderr</a>, <span class="stringliteral">&quot;\</span>
<a name="l01282"></a>01282 <span class="stringliteral">[GDB will not be able to debug user-mode threads: %s]\n&quot;</span>, dlerror ());
<a name="l01283"></a>01283 
<a name="l01284"></a>01284   <span class="keywordflow">if</span> (dlhandle)
<a name="l01285"></a>01285     dlclose (dlhandle);
<a name="l01286"></a>01286 
<a name="l01287"></a>01287   <span class="keywordflow">return</span>;
<a name="l01288"></a>01288 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Fri Oct 11 2013 14:13:33 for GDB (xrefs) by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
