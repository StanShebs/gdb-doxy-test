<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>GDB (xrefs): /home/stan/gdb/src/gdb/source.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">GDB (xrefs)
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">/home/stan/gdb/src/gdb/source.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="source_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* List lines of source files for GDB, the GNU debugger.</span>
<a name="l00002"></a>00002 <span class="comment">   Copyright (C) 1986-2013 Free Software Foundation, Inc.</span>
<a name="l00003"></a>00003 <span class="comment"></span>
<a name="l00004"></a>00004 <span class="comment">   This file is part of GDB.</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="comment">   This program is free software; you can redistribute it and/or modify</span>
<a name="l00007"></a>00007 <span class="comment">   it under the terms of the GNU General Public License as published by</span>
<a name="l00008"></a>00008 <span class="comment">   the Free Software Foundation; either version 3 of the License, or</span>
<a name="l00009"></a>00009 <span class="comment">   (at your option) any later version.</span>
<a name="l00010"></a>00010 <span class="comment"></span>
<a name="l00011"></a>00011 <span class="comment">   This program is distributed in the hope that it will be useful,</span>
<a name="l00012"></a>00012 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00013"></a>00013 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00014"></a>00014 <span class="comment">   GNU General Public License for more details.</span>
<a name="l00015"></a>00015 <span class="comment"></span>
<a name="l00016"></a>00016 <span class="comment">   You should have received a copy of the GNU General Public License</span>
<a name="l00017"></a>00017 <span class="comment">   along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.  */</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="defs_8h.html">defs.h</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="arch-utils_8h.html">arch-utils.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="symtab_8h.html">symtab.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="expression_8h.html">expression.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="language_8h.html">language.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="command_8h.html">command.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="source_8h.html">source.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="gdbcmd_8h.html">gdbcmd.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="frame_8h.html">frame.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="value_8h.html">value.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="gdb__assert_8h.html">gdb_assert.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="filestuff_8h.html">filestuff.h</a>&quot;</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="gdb__string_8h.html">gdb_string.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="gdb__stat_8h.html">gdb_stat.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="gdbcore_8h.html">gdbcore.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="gdb__regex_8h.html">gdb_regex.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="symfile_8h.html">symfile.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="objfiles_8h.html">objfiles.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="annotate_8h.html">annotate.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="gdbtypes_8h.html">gdbtypes.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="linespec_8h.html">linespec.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;filenames.h&quot;</span>          <span class="comment">/* for DOSish file names */</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="completer_8h.html">completer.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="ui-out_8h.html">ui-out.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;readline/readline.h&quot;</span>
<a name="l00047"></a>00047 
<a name="l00048"></a><a class="code" href="source_8c.html#ac66307ac68fd8e45eff295a2300b35be">00048</a> <span class="preprocessor">#define OPEN_MODE (O_RDONLY | O_BINARY)</span>
<a name="l00049"></a><a class="code" href="source_8c.html#a2c6a5da19471bdab1dcc4f95356a80c1">00049</a> <span class="preprocessor"></span><span class="preprocessor">#define FDOPEN_MODE FOPEN_RB</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span>
<a name="l00051"></a>00051 <span class="comment">/* Prototypes for exported functions.  */</span>
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="keywordtype">void</span> <a class="code" href="init_8c.html#a7af325136a76d8ee4ce928693949ecf3">_initialize_source</a> (<span class="keywordtype">void</span>);
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="comment">/* Prototypes for local functions.  */</span>
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="source_8c.html#a6cd21212028ffdb5e91ee360578884f4">get_filename_and_charpos</a> (<span class="keyword">struct</span> <a class="code" href="structsymtab.html">symtab</a> *, <span class="keywordtype">char</span> **);
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="source_8c.html#a29ccead27af7ed8aa350d5d322b75bde">reverse_search_command</a> (<span class="keywordtype">char</span> *, <span class="keywordtype">int</span>);
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="source_8c.html#ac52933592b1c243ad86c3d3df70cb2e3">forward_search_command</a> (<span class="keywordtype">char</span> *, <span class="keywordtype">int</span>);
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="source_8c.html#a360ce6d238b653379f578a32c71c0e57">line_info</a> (<span class="keywordtype">char</span> *, <span class="keywordtype">int</span>);
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="source_8c.html#a1f0220396aeed38af058dfe824accace">source_info</a> (<span class="keywordtype">char</span> *, <span class="keywordtype">int</span>);
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 <span class="comment">/* Path of directories to search for source files.</span>
<a name="l00068"></a>00068 <span class="comment">   Same format as the PATH environment variable&#39;s value.  */</span>
<a name="l00069"></a>00069 
<a name="l00070"></a><a class="code" href="source_8c.html#a7185b9daf1af3b15efc4d777cc2986b4">00070</a> <span class="keywordtype">char</span> *<a class="code" href="defs_8h.html#a7185b9daf1af3b15efc4d777cc2986b4">source_path</a>;
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 <span class="comment">/* Support for source path substitution commands.  */</span>
<a name="l00073"></a>00073 
<a name="l00074"></a><a class="code" href="structsubstitute__path__rule.html">00074</a> <span class="keyword">struct </span><a class="code" href="structsubstitute__path__rule.html">substitute_path_rule</a>
<a name="l00075"></a>00075 {
<a name="l00076"></a><a class="code" href="structsubstitute__path__rule.html#aebfd17c1e5dbdc7f1d2805b9e928b285">00076</a>   <span class="keywordtype">char</span> *<a class="code" href="structsubstitute__path__rule.html#aebfd17c1e5dbdc7f1d2805b9e928b285">from</a>;
<a name="l00077"></a><a class="code" href="structsubstitute__path__rule.html#a281aebac622618a3a880138d7f48962a">00077</a>   <span class="keywordtype">char</span> *<a class="code" href="structsubstitute__path__rule.html#a281aebac622618a3a880138d7f48962a">to</a>;
<a name="l00078"></a><a class="code" href="structsubstitute__path__rule.html#a530e032d033496b1a1376ed742964a3b">00078</a>   <span class="keyword">struct </span><a class="code" href="structsubstitute__path__rule.html">substitute_path_rule</a> *<a class="code" href="structsubstitute__path__rule.html#a530e032d033496b1a1376ed742964a3b">next</a>;
<a name="l00079"></a>00079 };
<a name="l00080"></a>00080 
<a name="l00081"></a><a class="code" href="source_8c.html#ae472785cbb06089dd2d492e5bd3dd535">00081</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structsubstitute__path__rule.html">substitute_path_rule</a> *<a class="code" href="source_8c.html#ae472785cbb06089dd2d492e5bd3dd535">substitute_path_rules</a> = NULL;
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 <span class="comment">/* Symtab of default file for listing lines of.  */</span>
<a name="l00084"></a>00084 
<a name="l00085"></a><a class="code" href="source_8c.html#a869f99e7ba57b2aac5ed4fffff8a430d">00085</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structsymtab.html">symtab</a> *<a class="code" href="source_8c.html#a869f99e7ba57b2aac5ed4fffff8a430d">current_source_symtab</a>;
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 <span class="comment">/* Default next line to list.  */</span>
<a name="l00088"></a>00088 
<a name="l00089"></a><a class="code" href="source_8c.html#a0ca95f705d9a22363e95c86a27563ea5">00089</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="source_8c.html#a0ca95f705d9a22363e95c86a27563ea5">current_source_line</a>;
<a name="l00090"></a>00090 
<a name="l00091"></a><a class="code" href="source_8c.html#ae38eb2523ad837bfc9d5de08f2a79a5e">00091</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structprogram__space.html">program_space</a> *<a class="code" href="source_8c.html#ae38eb2523ad837bfc9d5de08f2a79a5e">current_source_pspace</a>;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 <span class="comment">/* Default number of lines to print with commands like &quot;list&quot;.</span>
<a name="l00094"></a>00094 <span class="comment">   This is based on guessing how many long (i.e. more than chars_per_line</span>
<a name="l00095"></a>00095 <span class="comment">   characters) lines there will be.  To be completely correct, &quot;list&quot;</span>
<a name="l00096"></a>00096 <span class="comment">   and friends should be rewritten to count characters and see where</span>
<a name="l00097"></a>00097 <span class="comment">   things are wrapping, but that would be a fair amount of work.  */</span>
<a name="l00098"></a>00098 
<a name="l00099"></a><a class="code" href="source_8c.html#adf96a46f26a6e6235d9bb0e4a29367bb">00099</a> <span class="keywordtype">int</span> <a class="code" href="source_8c.html#adf96a46f26a6e6235d9bb0e4a29367bb">lines_to_list</a> = 10;
<a name="l00100"></a>00100 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00101"></a><a class="code" href="source_8c.html#a4a345e75bec5b2239c92716040dd5dcd">00101</a> <a class="code" href="source_8c.html#a4a345e75bec5b2239c92716040dd5dcd">show_lines_to_list</a> (<span class="keyword">struct</span> <a class="code" href="structui__file.html">ui_file</a> *file, <span class="keywordtype">int</span> from_tty,
<a name="l00102"></a>00102                     <span class="keyword">struct</span> <a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structvalue.html">value</a>)
<a name="l00103"></a>00103 {
<a name="l00104"></a>00104   <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (file,
<a name="l00105"></a>00105                     <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Number of source lines gdb &quot;</span>
<a name="l00106"></a>00106                       <span class="stringliteral">&quot;will list by default is %s.\n&quot;</span>),
<a name="l00107"></a>00107                     value);
<a name="l00108"></a>00108 }
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 <span class="comment">/* Possible values of &#39;set filename-display&#39;.  */</span>
<a name="l00111"></a><a class="code" href="source_8c.html#a68a9e5cda68cbbba189fac99a228d4d3">00111</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="source_8c.html#a68a9e5cda68cbbba189fac99a228d4d3">filename_display_basename</a>[] = <span class="stringliteral">&quot;basename&quot;</span>;
<a name="l00112"></a><a class="code" href="source_8c.html#aeadfce22f1cb7e1fb5f7ac226a56cb4d">00112</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="source_8c.html#aeadfce22f1cb7e1fb5f7ac226a56cb4d">filename_display_relative</a>[] = <span class="stringliteral">&quot;relative&quot;</span>;
<a name="l00113"></a><a class="code" href="source_8c.html#a597b27097bdf3dec21f5c9762c5eb1d3">00113</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="source_8c.html#a597b27097bdf3dec21f5c9762c5eb1d3">filename_display_absolute</a>[] = <span class="stringliteral">&quot;absolute&quot;</span>;
<a name="l00114"></a>00114 
<a name="l00115"></a><a class="code" href="source_8c.html#a0c7dc515b78d11f0ec11d0da15dc7c2e">00115</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> <a class="code" href="source_8c.html#a0c7dc515b78d11f0ec11d0da15dc7c2e">filename_display_kind_names</a>[] = {
<a name="l00116"></a>00116   <a class="code" href="source_8c.html#a68a9e5cda68cbbba189fac99a228d4d3">filename_display_basename</a>,
<a name="l00117"></a>00117   <a class="code" href="source_8c.html#aeadfce22f1cb7e1fb5f7ac226a56cb4d">filename_display_relative</a>,
<a name="l00118"></a>00118   <a class="code" href="source_8c.html#a597b27097bdf3dec21f5c9762c5eb1d3">filename_display_absolute</a>,
<a name="l00119"></a>00119   NULL
<a name="l00120"></a>00120 };
<a name="l00121"></a>00121 
<a name="l00122"></a><a class="code" href="source_8c.html#aa5ad22f3ba8d797f3bb32696f4e53ba3">00122</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="source_8c.html#aa5ad22f3ba8d797f3bb32696f4e53ba3">filename_display_string</a> = <a class="code" href="source_8c.html#aeadfce22f1cb7e1fb5f7ac226a56cb4d">filename_display_relative</a>;
<a name="l00123"></a>00123 
<a name="l00124"></a>00124 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00125"></a><a class="code" href="source_8c.html#af5ca4f9f9974b249ed62afc1a56e5b5f">00125</a> <a class="code" href="source_8c.html#af5ca4f9f9974b249ed62afc1a56e5b5f">show_filename_display_string</a> (<span class="keyword">struct</span> <a class="code" href="structui__file.html">ui_file</a> *file, <span class="keywordtype">int</span> from_tty,
<a name="l00126"></a>00126                               <span class="keyword">struct</span> <a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structvalue.html">value</a>)
<a name="l00127"></a>00127 {
<a name="l00128"></a>00128   <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (file, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Filenames are displayed as \&quot;%s\&quot;.\n&quot;</span>), value);
<a name="l00129"></a>00129 }
<a name="l00130"></a>00130  
<a name="l00131"></a>00131 <span class="comment">/* Line number of last line printed.  Default for various commands.</span>
<a name="l00132"></a>00132 <span class="comment">   current_source_line is usually, but not always, the same as this.  */</span>
<a name="l00133"></a>00133 
<a name="l00134"></a><a class="code" href="source_8c.html#a55fc4c2f4fc50973546ef051f77fae59">00134</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="source_8c.html#a55fc4c2f4fc50973546ef051f77fae59">last_line_listed</a>;
<a name="l00135"></a>00135 
<a name="l00136"></a>00136 <span class="comment">/* First line number listed by last listing command.  */</span>
<a name="l00137"></a>00137 
<a name="l00138"></a><a class="code" href="source_8c.html#a64c047ee4e91dcae470c4a1594ee0c58">00138</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="source_8c.html#a64c047ee4e91dcae470c4a1594ee0c58">first_line_listed</a>;
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 <span class="comment">/* Saves the name of the last source file visited and a possible error code.</span>
<a name="l00141"></a>00141 <span class="comment">   Used to prevent repeating annoying &quot;No such file or directories&quot; msgs.  */</span>
<a name="l00142"></a>00142 
<a name="l00143"></a><a class="code" href="source_8c.html#a9b53bb5f964fbce413a2e0a8822732c2">00143</a> <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structsymtab.html">symtab</a> *<a class="code" href="source_8c.html#a9b53bb5f964fbce413a2e0a8822732c2">last_source_visited</a> = NULL;
<a name="l00144"></a><a class="code" href="source_8c.html#a572e631a2564d0a9bf82dff62abf6c5b">00144</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="source_8c.html#a572e631a2564d0a9bf82dff62abf6c5b">last_source_error</a> = 0;
<a name="l00145"></a>00145 
<a name="l00146"></a>00146 <span class="comment">/* Return the first line listed by print_source_lines.</span>
<a name="l00147"></a>00147 <span class="comment">   Used by command interpreters to request listing from</span>
<a name="l00148"></a>00148 <span class="comment">   a previous point.  */</span>
<a name="l00149"></a>00149 
<a name="l00150"></a>00150 <span class="keywordtype">int</span>
<a name="l00151"></a><a class="code" href="source_8h.html#a5a399c98203456fe535e7527899983c2">00151</a> <a class="code" href="source_8c.html#a5a399c98203456fe535e7527899983c2">get_first_line_listed</a> (<span class="keywordtype">void</span>)
<a name="l00152"></a>00152 {
<a name="l00153"></a>00153   <span class="keywordflow">return</span> <a class="code" href="source_8c.html#a64c047ee4e91dcae470c4a1594ee0c58">first_line_listed</a>;
<a name="l00154"></a>00154 }
<a name="l00155"></a>00155 
<a name="l00156"></a>00156 <span class="comment">/* Return the default number of lines to print with commands like the</span>
<a name="l00157"></a>00157 <span class="comment">   cli &quot;list&quot;.  The caller of print_source_lines must use this to</span>
<a name="l00158"></a>00158 <span class="comment">   calculate the end line and use it in the call to print_source_lines</span>
<a name="l00159"></a>00159 <span class="comment">   as it does not automatically use this value.  */</span>
<a name="l00160"></a>00160 
<a name="l00161"></a>00161 <span class="keywordtype">int</span>
<a name="l00162"></a><a class="code" href="source_8h.html#abaae2754cf891e2db9874ba8e67f0bd6">00162</a> <a class="code" href="source_8c.html#abaae2754cf891e2db9874ba8e67f0bd6">get_lines_to_list</a> (<span class="keywordtype">void</span>)
<a name="l00163"></a>00163 {
<a name="l00164"></a>00164   <span class="keywordflow">return</span> <a class="code" href="source_8c.html#adf96a46f26a6e6235d9bb0e4a29367bb">lines_to_list</a>;
<a name="l00165"></a>00165 }
<a name="l00166"></a>00166 
<a name="l00167"></a>00167 <span class="comment">/* Return the current source file for listing and next line to list.</span>
<a name="l00168"></a>00168 <span class="comment">   NOTE: The returned sal pc and end fields are not valid.  */</span>
<a name="l00169"></a>00169    
<a name="l00170"></a>00170 <span class="keyword">struct </span><a class="code" href="structsymtab__and__line.html">symtab_and_line</a>
<a name="l00171"></a><a class="code" href="source_8h.html#a387b0906b103c4b3dec9d7cfdd41a9ad">00171</a> <a class="code" href="source_8c.html#a387b0906b103c4b3dec9d7cfdd41a9ad">get_current_source_symtab_and_line</a> (void)
<a name="l00172"></a>00172 {
<a name="l00173"></a>00173   <span class="keyword">struct </span><a class="code" href="structsymtab__and__line.html">symtab_and_line</a> cursal = { 0 };
<a name="l00174"></a>00174 
<a name="l00175"></a>00175   cursal.<a class="code" href="structsymtab__and__line.html#acc91f0276f4648cb5a970f17ddcbaf09">pspace</a> = <a class="code" href="source_8c.html#ae38eb2523ad837bfc9d5de08f2a79a5e">current_source_pspace</a>;
<a name="l00176"></a>00176   cursal.<a class="code" href="structsymtab__and__line.html#a74216e171a96d8bcaab43fe69b49c599">symtab</a> = <a class="code" href="source_8c.html#a869f99e7ba57b2aac5ed4fffff8a430d">current_source_symtab</a>;
<a name="l00177"></a>00177   cursal.<a class="code" href="structsymtab__and__line.html#a6a0468be675b9ac19a5b3ef26f471eaf">line</a> = <a class="code" href="source_8c.html#a0ca95f705d9a22363e95c86a27563ea5">current_source_line</a>;
<a name="l00178"></a>00178   cursal.<a class="code" href="structsymtab__and__line.html#a77665fa461ad187cb755efa256ba44d7">pc</a> = 0;
<a name="l00179"></a>00179   cursal.<a class="code" href="structsymtab__and__line.html#ab4a806871b9f98729ab7c9c2c345b602">end</a> = 0;
<a name="l00180"></a>00180   
<a name="l00181"></a>00181   <span class="keywordflow">return</span> cursal;
<a name="l00182"></a>00182 }
<a name="l00183"></a>00183 
<a name="l00184"></a>00184 <span class="comment">/* If the current source file for listing is not set, try and get a default.</span>
<a name="l00185"></a>00185 <span class="comment">   Usually called before get_current_source_symtab_and_line() is called.</span>
<a name="l00186"></a>00186 <span class="comment">   It may err out if a default cannot be determined.</span>
<a name="l00187"></a>00187 <span class="comment">   We must be cautious about where it is called, as it can recurse as the</span>
<a name="l00188"></a>00188 <span class="comment">   process of determining a new default may call the caller!</span>
<a name="l00189"></a>00189 <span class="comment">   Use get_current_source_symtab_and_line only to get whatever</span>
<a name="l00190"></a>00190 <span class="comment">   we have without erroring out or trying to get a default.  */</span>
<a name="l00191"></a>00191    
<a name="l00192"></a>00192 <span class="keywordtype">void</span>
<a name="l00193"></a><a class="code" href="source_8h.html#aa627308b6e6c5de7233b0d4c7017f091">00193</a> <a class="code" href="source_8c.html#aa627308b6e6c5de7233b0d4c7017f091">set_default_source_symtab_and_line</a> (<span class="keywordtype">void</span>)
<a name="l00194"></a>00194 {
<a name="l00195"></a>00195   <span class="keywordflow">if</span> (!<a class="code" href="objfiles_8c.html#aed27a8abad788fa9b74e13a3bb97c8ee">have_full_symbols</a> () &amp;&amp; !<a class="code" href="objfiles_8c.html#aa8d7d1a2b68ac871a50d0fcbca14518d">have_partial_symbols</a> ())
<a name="l00196"></a>00196     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No symbol table is loaded.  Use the \&quot;file\&quot; command.&quot;</span>));
<a name="l00197"></a>00197 
<a name="l00198"></a>00198   <span class="comment">/* Pull in a current source symtab if necessary.  */</span>
<a name="l00199"></a>00199   <span class="keywordflow">if</span> (current_source_symtab == 0)
<a name="l00200"></a>00200     <a class="code" href="source_8c.html#a0ba91e44a03ae75131aa18e8e77f41c6">select_source_symtab</a> (0);
<a name="l00201"></a>00201 }
<a name="l00202"></a>00202 
<a name="l00203"></a>00203 <span class="comment">/* Return the current default file for listing and next line to list</span>
<a name="l00204"></a>00204 <span class="comment">   (the returned sal pc and end fields are not valid.)</span>
<a name="l00205"></a>00205 <span class="comment">   and set the current default to whatever is in SAL.</span>
<a name="l00206"></a>00206 <span class="comment">   NOTE: The returned sal pc and end fields are not valid.  */</span>
<a name="l00207"></a>00207    
<a name="l00208"></a>00208 <span class="keyword">struct </span><a class="code" href="structsymtab__and__line.html">symtab_and_line</a>
<a name="l00209"></a><a class="code" href="source_8h.html#a3f15c1dcfeeec4ece1a457389a41a944">00209</a> <a class="code" href="source_8c.html#aa044b5dc1e0b3ce4eb13e02788fb9e99">set_current_source_symtab_and_line</a> (<a class="code" href="p-lang_8h.html#a21296fc6f36ba2fc4d9780fdd126acb5">const</a> struct <a class="code" href="structsymtab__and__line.html">symtab_and_line</a> *sal)
<a name="l00210"></a>00210 {
<a name="l00211"></a>00211   <span class="keyword">struct </span><a class="code" href="structsymtab__and__line.html">symtab_and_line</a> cursal = { 0 };
<a name="l00212"></a>00212 
<a name="l00213"></a>00213   cursal.<a class="code" href="structsymtab__and__line.html#acc91f0276f4648cb5a970f17ddcbaf09">pspace</a> = <a class="code" href="source_8c.html#ae38eb2523ad837bfc9d5de08f2a79a5e">current_source_pspace</a>;
<a name="l00214"></a>00214   cursal.<a class="code" href="structsymtab__and__line.html#a74216e171a96d8bcaab43fe69b49c599">symtab</a> = <a class="code" href="source_8c.html#a869f99e7ba57b2aac5ed4fffff8a430d">current_source_symtab</a>;
<a name="l00215"></a>00215   cursal.<a class="code" href="structsymtab__and__line.html#a6a0468be675b9ac19a5b3ef26f471eaf">line</a> = <a class="code" href="source_8c.html#a0ca95f705d9a22363e95c86a27563ea5">current_source_line</a>;
<a name="l00216"></a>00216   cursal.<a class="code" href="structsymtab__and__line.html#a77665fa461ad187cb755efa256ba44d7">pc</a> = 0;
<a name="l00217"></a>00217   cursal.<a class="code" href="structsymtab__and__line.html#ab4a806871b9f98729ab7c9c2c345b602">end</a> = 0;
<a name="l00218"></a>00218 
<a name="l00219"></a>00219   current_source_pspace = sal-&gt;pspace;
<a name="l00220"></a>00220   current_source_symtab = sal-&gt;symtab;
<a name="l00221"></a>00221   <a class="code" href="source_8c.html#a0ca95f705d9a22363e95c86a27563ea5">current_source_line</a> = sal-&gt;line;
<a name="l00222"></a>00222 
<a name="l00223"></a>00223   <span class="keywordflow">return</span> cursal;
<a name="l00224"></a>00224 }
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 <span class="comment">/* Reset any information stored about a default file and line to print.  */</span>
<a name="l00227"></a>00227 
<a name="l00228"></a>00228 <span class="keywordtype">void</span>
<a name="l00229"></a><a class="code" href="source_8h.html#a558350352274cca4035017daf11b42fb">00229</a> <a class="code" href="source_8c.html#a558350352274cca4035017daf11b42fb">clear_current_source_symtab_and_line</a> (<span class="keywordtype">void</span>)
<a name="l00230"></a>00230 {
<a name="l00231"></a>00231   current_source_symtab = 0;
<a name="l00232"></a>00232   <a class="code" href="source_8c.html#a0ca95f705d9a22363e95c86a27563ea5">current_source_line</a> = 0;
<a name="l00233"></a>00233 }
<a name="l00234"></a>00234 
<a name="l00235"></a>00235 <span class="comment">/* Set the source file default for the &quot;list&quot; command to be S.</span>
<a name="l00236"></a>00236 <span class="comment"></span>
<a name="l00237"></a>00237 <span class="comment">   If S is NULL, and we don&#39;t have a default, find one.  This</span>
<a name="l00238"></a>00238 <span class="comment">   should only be called when the user actually tries to use the</span>
<a name="l00239"></a>00239 <span class="comment">   default, since we produce an error if we can&#39;t find a reasonable</span>
<a name="l00240"></a>00240 <span class="comment">   default.  Also, since this can cause symbols to be read, doing it</span>
<a name="l00241"></a>00241 <span class="comment">   before we need to would make things slower than necessary.  */</span>
<a name="l00242"></a>00242 
<a name="l00243"></a>00243 <span class="keywordtype">void</span>
<a name="l00244"></a><a class="code" href="symtab_8h.html#ae4ef3e57e107b57d390baaa9a6c9ea28">00244</a> <a class="code" href="source_8c.html#a0ba91e44a03ae75131aa18e8e77f41c6">select_source_symtab</a> (<span class="keyword">struct</span> <a class="code" href="structsymtab.html">symtab</a> *s)
<a name="l00245"></a>00245 {
<a name="l00246"></a>00246   <span class="keyword">struct </span><a class="code" href="structsymtabs__and__lines.html">symtabs_and_lines</a> sals;
<a name="l00247"></a>00247   <span class="keyword">struct </span><a class="code" href="structsymtab__and__line.html">symtab_and_line</a> sal;
<a name="l00248"></a>00248   <span class="keyword">struct </span><a class="code" href="structobjfile.html">objfile</a> *ofp;
<a name="l00249"></a>00249 
<a name="l00250"></a>00250   <span class="keywordflow">if</span> (s)
<a name="l00251"></a>00251     {
<a name="l00252"></a>00252       current_source_symtab = s;
<a name="l00253"></a>00253       <a class="code" href="source_8c.html#a0ca95f705d9a22363e95c86a27563ea5">current_source_line</a> = 1;
<a name="l00254"></a>00254       current_source_pspace = <a class="code" href="symtab_8h.html#a2a71e72ee45ded613d9284b7423a90c2">SYMTAB_PSPACE</a> (s);
<a name="l00255"></a>00255       <span class="keywordflow">return</span>;
<a name="l00256"></a>00256     }
<a name="l00257"></a>00257 
<a name="l00258"></a>00258   <span class="keywordflow">if</span> (current_source_symtab)
<a name="l00259"></a>00259     <span class="keywordflow">return</span>;
<a name="l00260"></a>00260 
<a name="l00261"></a>00261   <span class="comment">/* Make the default place to list be the function `main&#39;</span>
<a name="l00262"></a>00262 <span class="comment">     if one exists.  */</span>
<a name="l00263"></a>00263   <span class="keywordflow">if</span> (<a class="code" href="symtab_8c.html#a8a5c3f803198aed047a55c0e4f61b315">lookup_symbol</a> (<a class="code" href="symtab_8c.html#ab9c2af1ae780c38e00aefb141f836dce">main_name</a> (), 0, <a class="code" href="symtab_8h.html#a5c384cef81c5f50f32caadbfd6974a1aa15693f9d844450eb4bfd4b37114f4aed">VAR_DOMAIN</a>, 0))
<a name="l00264"></a>00264     {
<a name="l00265"></a>00265       sals = <a class="code" href="linespec_8c.html#a99c1ec5e07db5d8ffc64de454d190650">decode_line_with_current_source</a> (<a class="code" href="symtab_8c.html#ab9c2af1ae780c38e00aefb141f836dce">main_name</a> (),
<a name="l00266"></a>00266                                               <a class="code" href="linespec_8h.html#a66db0c56cdf6b7d07a996c374a0572caadb5b3965c89f02bfa79f8871fde72588">DECODE_LINE_FUNFIRSTLINE</a>);
<a name="l00267"></a>00267       sal = sals.<a class="code" href="structsymtabs__and__lines.html#ab601f48fdf29c3b190ba068f57983df4">sals</a>[0];
<a name="l00268"></a>00268       <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (sals.<a class="code" href="structsymtabs__and__lines.html#ab601f48fdf29c3b190ba068f57983df4">sals</a>);
<a name="l00269"></a>00269       current_source_pspace = sal.<a class="code" href="structsymtab__and__line.html#acc91f0276f4648cb5a970f17ddcbaf09">pspace</a>;
<a name="l00270"></a>00270       current_source_symtab = sal.<a class="code" href="structsymtab__and__line.html#a74216e171a96d8bcaab43fe69b49c599">symtab</a>;
<a name="l00271"></a>00271       <a class="code" href="source_8c.html#a0ca95f705d9a22363e95c86a27563ea5">current_source_line</a> = <a class="code" href="environ_8c.html#affe776513b24d84b39af8ab0930fef7f">max</a> (sal.<a class="code" href="structsymtab__and__line.html#a6a0468be675b9ac19a5b3ef26f471eaf">line</a> - (<a class="code" href="source_8c.html#adf96a46f26a6e6235d9bb0e4a29367bb">lines_to_list</a> - 1), 1);
<a name="l00272"></a>00272       <span class="keywordflow">if</span> (current_source_symtab)
<a name="l00273"></a>00273         <span class="keywordflow">return</span>;
<a name="l00274"></a>00274     }
<a name="l00275"></a>00275 
<a name="l00276"></a>00276   <span class="comment">/* Alright; find the last file in the symtab list (ignoring .h&#39;s</span>
<a name="l00277"></a>00277 <span class="comment">     and namespace symtabs).  */</span>
<a name="l00278"></a>00278 
<a name="l00279"></a>00279   <a class="code" href="source_8c.html#a0ca95f705d9a22363e95c86a27563ea5">current_source_line</a> = 1;
<a name="l00280"></a>00280 
<a name="l00281"></a>00281   <a class="code" href="objfiles_8h.html#a8efee3b85a322006131a6056d45058b3">ALL_OBJFILES</a> (ofp)
<a name="l00282"></a>00282     {
<a name="l00283"></a>00283       <span class="keywordflow">for</span> (s = ofp-&gt;<a class="code" href="structobjfile.html#a7de941af61199f5f18580235feec7e8c">symtabs</a>; s; s = s-&gt;<a class="code" href="structsymtab.html#adc0bebc17f57006732816b5fe0e92509">next</a>)
<a name="l00284"></a>00284         {
<a name="l00285"></a>00285           <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="aarch64-tdep_8c.html#acc128f98d9ceca227038c771308eff39">name</a> = s-&gt;<a class="code" href="structsymtab.html#acd8b6d6ddeca3b61953b0c736e13c35a">filename</a>;
<a name="l00286"></a>00286           <span class="keywordtype">int</span> <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a> = strlen (name);
<a name="l00287"></a>00287 
<a name="l00288"></a>00288           <span class="keywordflow">if</span> (!(len &gt; 2 &amp;&amp; (strcmp (&amp;name[len - 2], <span class="stringliteral">&quot;.h&quot;</span>) == 0
<a name="l00289"></a>00289               || strcmp (name, <span class="stringliteral">&quot;&lt;&lt;C++-namespaces&gt;&gt;&quot;</span>) == 0)))
<a name="l00290"></a>00290             {
<a name="l00291"></a>00291               current_source_pspace = <a class="code" href="progspace_8c.html#a07722ff15a98814c086dda44f93380c9">current_program_space</a>;
<a name="l00292"></a>00292               current_source_symtab = s;
<a name="l00293"></a>00293             }
<a name="l00294"></a>00294         }
<a name="l00295"></a>00295     }
<a name="l00296"></a>00296 
<a name="l00297"></a>00297   <span class="keywordflow">if</span> (current_source_symtab)
<a name="l00298"></a>00298     <span class="keywordflow">return</span>;
<a name="l00299"></a>00299 
<a name="l00300"></a>00300   <a class="code" href="objfiles_8h.html#a8efee3b85a322006131a6056d45058b3">ALL_OBJFILES</a> (ofp)
<a name="l00301"></a>00301   {
<a name="l00302"></a>00302     <span class="keywordflow">if</span> (ofp-&gt;<a class="code" href="structobjfile.html#af6814df9c2fd1f669fd79d0b0c94262c">sf</a>)
<a name="l00303"></a>00303       s = ofp-&gt;<a class="code" href="structobjfile.html#af6814df9c2fd1f669fd79d0b0c94262c">sf</a>-&gt;<a class="code" href="structsym__fns.html#ae4cb3e689cab6e5ecf8e2fb8770b55b0">qf</a>-&gt;<a class="code" href="structquick__symbol__functions.html#a21e637863ab61dea68b0ed878145f5b0">find_last_source_symtab</a> (ofp);
<a name="l00304"></a>00304     <span class="keywordflow">if</span> (s)
<a name="l00305"></a>00305       current_source_symtab = s;
<a name="l00306"></a>00306   }
<a name="l00307"></a>00307   <span class="keywordflow">if</span> (current_source_symtab)
<a name="l00308"></a>00308     <span class="keywordflow">return</span>;
<a name="l00309"></a>00309 
<a name="l00310"></a>00310   <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Can&#39;t find a default source file&quot;</span>));
<a name="l00311"></a>00311 }
<a name="l00312"></a>00312 
<a name="l00313"></a>00313 <span class="comment">/* Handler for &quot;set directories path-list&quot; command.</span>
<a name="l00314"></a>00314 <span class="comment">   &quot;set dir mumble&quot; doesn&#39;t prepend paths, it resets the entire</span>
<a name="l00315"></a>00315 <span class="comment">   path list.  The theory is that set(show(dir)) should be a no-op.  */</span>
<a name="l00316"></a>00316 
<a name="l00317"></a>00317 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00318"></a><a class="code" href="source_8c.html#aec996fa3fc8b025db35a634199ecc387">00318</a> <a class="code" href="source_8c.html#aec996fa3fc8b025db35a634199ecc387">set_directories_command</a> (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty, <span class="keyword">struct</span> <a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c)
<a name="l00319"></a>00319 {
<a name="l00320"></a>00320   <span class="comment">/* This is the value that was set.</span>
<a name="l00321"></a>00321 <span class="comment">     It needs to be processed to maintain $cdir:$cwd and remove dups.  */</span>
<a name="l00322"></a>00322   <span class="keywordtype">char</span> *set_path = <a class="code" href="defs_8h.html#a7185b9daf1af3b15efc4d777cc2986b4">source_path</a>;
<a name="l00323"></a>00323 
<a name="l00324"></a>00324   <span class="comment">/* We preserve the invariant that $cdir:$cwd begins life at the end of</span>
<a name="l00325"></a>00325 <span class="comment">     the list by calling init_source_path.  If they appear earlier in</span>
<a name="l00326"></a>00326 <span class="comment">     SET_PATH then mod_path will move them appropriately.</span>
<a name="l00327"></a>00327 <span class="comment">     mod_path will also remove duplicates.  */</span>
<a name="l00328"></a>00328   <a class="code" href="defs_8h.html#a72f599c515e8750e28204a36ef460c24">init_source_path</a> ();
<a name="l00329"></a>00329   <span class="keywordflow">if</span> (*set_path != <span class="charliteral">&#39;\0&#39;</span>)
<a name="l00330"></a>00330     <a class="code" href="defs_8h.html#af19e40cd95c481d25a595e8c601fb9ab">mod_path</a> (set_path, &amp;<a class="code" href="defs_8h.html#a7185b9daf1af3b15efc4d777cc2986b4">source_path</a>);
<a name="l00331"></a>00331 
<a name="l00332"></a>00332   <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (set_path);
<a name="l00333"></a>00333 }
<a name="l00334"></a>00334 
<a name="l00335"></a>00335 <span class="comment">/* Print the list of source directories.</span>
<a name="l00336"></a>00336 <span class="comment">   This is used by the &quot;ld&quot; command, so it has the signature of a command</span>
<a name="l00337"></a>00337 <span class="comment">   function.  */</span>
<a name="l00338"></a>00338 
<a name="l00339"></a>00339 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00340"></a><a class="code" href="source_8c.html#a1305f7de7625e47f80fa2f5e07dfe009">00340</a> <a class="code" href="source_8c.html#a1305f7de7625e47f80fa2f5e07dfe009">show_directories_1</a> (<span class="keywordtype">char</span> *<a class="code" href="corelow_8c.html#ac54c1aef0966c38fc155dec95a38db50">ignore</a>, <span class="keywordtype">int</span> from_tty)
<a name="l00341"></a>00341 {
<a name="l00342"></a>00342   <a class="code" href="utils_8c.html#ab4c30e1b3fe2dfa6e73f320a6758ad5f">puts_filtered</a> (<span class="stringliteral">&quot;Source directories searched: &quot;</span>);
<a name="l00343"></a>00343   <a class="code" href="utils_8c.html#ab4c30e1b3fe2dfa6e73f320a6758ad5f">puts_filtered</a> (<a class="code" href="defs_8h.html#a7185b9daf1af3b15efc4d777cc2986b4">source_path</a>);
<a name="l00344"></a>00344   <a class="code" href="utils_8c.html#ab4c30e1b3fe2dfa6e73f320a6758ad5f">puts_filtered</a> (<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00345"></a>00345 }
<a name="l00346"></a>00346 
<a name="l00347"></a>00347 <span class="comment">/* Handler for &quot;show directories&quot; command.  */</span>
<a name="l00348"></a>00348 
<a name="l00349"></a>00349 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00350"></a><a class="code" href="source_8c.html#a2925a754cc9aaeb2a1cfbfa51330b218">00350</a> <a class="code" href="source_8c.html#a2925a754cc9aaeb2a1cfbfa51330b218">show_directories_command</a> (<span class="keyword">struct</span> <a class="code" href="structui__file.html">ui_file</a> *file, <span class="keywordtype">int</span> from_tty,
<a name="l00351"></a>00351                           <span class="keyword">struct</span> <a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structvalue.html">value</a>)
<a name="l00352"></a>00352 {
<a name="l00353"></a>00353   <a class="code" href="source_8c.html#a1305f7de7625e47f80fa2f5e07dfe009">show_directories_1</a> (NULL, from_tty);
<a name="l00354"></a>00354 }
<a name="l00355"></a>00355 
<a name="l00356"></a>00356 <span class="comment">/* Forget line positions and file names for the symtabs in a</span>
<a name="l00357"></a>00357 <span class="comment">   particular objfile.  */</span>
<a name="l00358"></a>00358 
<a name="l00359"></a>00359 <span class="keywordtype">void</span>
<a name="l00360"></a><a class="code" href="symtab_8h.html#a9f958ff125eff2dfd0e284c356c02a3f">00360</a> <a class="code" href="source_8c.html#a19c2fda9acef0586a9d85715add66bda">forget_cached_source_info_for_objfile</a> (<span class="keyword">struct</span> <a class="code" href="structobjfile.html">objfile</a> *<a class="code" href="structobjfile.html">objfile</a>)
<a name="l00361"></a>00361 {
<a name="l00362"></a>00362   <span class="keyword">struct </span><a class="code" href="structsymtab.html">symtab</a> *s;
<a name="l00363"></a>00363 
<a name="l00364"></a>00364   <a class="code" href="objfiles_8h.html#ad881e45502f8c05088f9c61165fb7d14">ALL_OBJFILE_SYMTABS</a> (objfile, s)
<a name="l00365"></a>00365     {
<a name="l00366"></a>00366       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structsymtab.html#af4d69f09a5ce43cf6f6c450d00b38475">line_charpos</a> != NULL)
<a name="l00367"></a>00367         {
<a name="l00368"></a>00368           <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (s-&gt;<a class="code" href="structsymtab.html#af4d69f09a5ce43cf6f6c450d00b38475">line_charpos</a>);
<a name="l00369"></a>00369           s-&gt;<a class="code" href="structsymtab.html#af4d69f09a5ce43cf6f6c450d00b38475">line_charpos</a> = NULL;
<a name="l00370"></a>00370         }
<a name="l00371"></a>00371       <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structsymtab.html#a69ab8f02c05080d73ef701cf239e9c5e">fullname</a> != NULL)
<a name="l00372"></a>00372         {
<a name="l00373"></a>00373           <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (s-&gt;<a class="code" href="structsymtab.html#a69ab8f02c05080d73ef701cf239e9c5e">fullname</a>);
<a name="l00374"></a>00374           s-&gt;<a class="code" href="structsymtab.html#a69ab8f02c05080d73ef701cf239e9c5e">fullname</a> = NULL;
<a name="l00375"></a>00375         }
<a name="l00376"></a>00376     }
<a name="l00377"></a>00377 
<a name="l00378"></a>00378   <span class="keywordflow">if</span> (objfile-&gt;<a class="code" href="structobjfile.html#af6814df9c2fd1f669fd79d0b0c94262c">sf</a>)
<a name="l00379"></a>00379     objfile-&gt;<a class="code" href="structobjfile.html#af6814df9c2fd1f669fd79d0b0c94262c">sf</a>-&gt;<a class="code" href="structsym__fns.html#ae4cb3e689cab6e5ecf8e2fb8770b55b0">qf</a>-&gt;<a class="code" href="structquick__symbol__functions.html#abf0e405aa1a23221ef0a2a55d574c189">forget_cached_source_info</a> (objfile);
<a name="l00380"></a>00380 }
<a name="l00381"></a>00381 
<a name="l00382"></a>00382 <span class="comment">/* Forget what we learned about line positions in source files, and</span>
<a name="l00383"></a>00383 <span class="comment">   which directories contain them; must check again now since files</span>
<a name="l00384"></a>00384 <span class="comment">   may be found in a different directory now.  */</span>
<a name="l00385"></a>00385 
<a name="l00386"></a>00386 <span class="keywordtype">void</span>
<a name="l00387"></a><a class="code" href="symtab_8h.html#a5b2639f3f85c2b17fca0c39fe5fcd461">00387</a> <a class="code" href="source_8c.html#a5b2639f3f85c2b17fca0c39fe5fcd461">forget_cached_source_info</a> (<span class="keywordtype">void</span>)
<a name="l00388"></a>00388 {
<a name="l00389"></a>00389   <span class="keyword">struct </span><a class="code" href="structprogram__space.html">program_space</a> *pspace;
<a name="l00390"></a>00390   <span class="keyword">struct </span><a class="code" href="structobjfile.html">objfile</a> *<a class="code" href="structobjfile.html">objfile</a>;
<a name="l00391"></a>00391 
<a name="l00392"></a>00392   <a class="code" href="progspace_8h.html#a9e4091a3fcf8c96cb18cf2042cbe21f6">ALL_PSPACES</a> (pspace)
<a name="l00393"></a>00393     <a class="code" href="objfiles_8h.html#a9c2f75ae5c5a8cb4da219f7cb063e262">ALL_PSPACE_OBJFILES</a> (pspace, objfile)
<a name="l00394"></a>00394     {
<a name="l00395"></a>00395       <a class="code" href="source_8c.html#a19c2fda9acef0586a9d85715add66bda">forget_cached_source_info_for_objfile</a> (objfile);
<a name="l00396"></a>00396     }
<a name="l00397"></a>00397 
<a name="l00398"></a>00398   last_source_visited = NULL;
<a name="l00399"></a>00399 }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401 <span class="keywordtype">void</span>
<a name="l00402"></a><a class="code" href="source_8c.html#a72f599c515e8750e28204a36ef460c24">00402</a> <a class="code" href="defs_8h.html#a72f599c515e8750e28204a36ef460c24">init_source_path</a> (<span class="keywordtype">void</span>)
<a name="l00403"></a>00403 {
<a name="l00404"></a>00404   <span class="keywordtype">char</span> buf[20];
<a name="l00405"></a>00405 
<a name="l00406"></a>00406   <a class="code" href="common-utils_8c.html#ad9940337ec98983dae9951c947879fc8">xsnprintf</a> (buf, <span class="keyword">sizeof</span> (buf), <span class="stringliteral">&quot;$cdir%c$cwd&quot;</span>, DIRNAME_SEPARATOR);
<a name="l00407"></a>00407   <a class="code" href="defs_8h.html#a7185b9daf1af3b15efc4d777cc2986b4">source_path</a> = xstrdup (buf);
<a name="l00408"></a>00408   <a class="code" href="source_8c.html#a5b2639f3f85c2b17fca0c39fe5fcd461">forget_cached_source_info</a> ();
<a name="l00409"></a>00409 }
<a name="l00410"></a>00410 
<a name="l00411"></a>00411 <span class="comment">/* Add zero or more directories to the front of the source path.  */</span>
<a name="l00412"></a>00412 
<a name="l00413"></a>00413 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00414"></a><a class="code" href="source_8c.html#ab23f96fa0023f6423d40195972a5f6c9">00414</a> <a class="code" href="source_8c.html#ab23f96fa0023f6423d40195972a5f6c9">directory_command</a> (<span class="keywordtype">char</span> *dirname, <span class="keywordtype">int</span> from_tty)
<a name="l00415"></a>00415 {
<a name="l00416"></a>00416   <a class="code" href="command_8h.html#ac7af34b03605d65b114a173d49532050">dont_repeat</a> ();
<a name="l00417"></a>00417   <span class="comment">/* FIXME, this goes to &quot;delete dir&quot;...  */</span>
<a name="l00418"></a>00418   <span class="keywordflow">if</span> (dirname == 0)
<a name="l00419"></a>00419     {
<a name="l00420"></a>00420       <span class="keywordflow">if</span> (!from_tty || <a class="code" href="utils_8c.html#a4b369431cd1ce5d26bccf6b79a44c085">query</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Reinitialize source path to empty? &quot;</span>)))
<a name="l00421"></a>00421         {
<a name="l00422"></a>00422           <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (<a class="code" href="defs_8h.html#a7185b9daf1af3b15efc4d777cc2986b4">source_path</a>);
<a name="l00423"></a>00423           <a class="code" href="defs_8h.html#a72f599c515e8750e28204a36ef460c24">init_source_path</a> ();
<a name="l00424"></a>00424         }
<a name="l00425"></a>00425     }
<a name="l00426"></a>00426   <span class="keywordflow">else</span>
<a name="l00427"></a>00427     {
<a name="l00428"></a>00428       <a class="code" href="defs_8h.html#af19e40cd95c481d25a595e8c601fb9ab">mod_path</a> (dirname, &amp;<a class="code" href="defs_8h.html#a7185b9daf1af3b15efc4d777cc2986b4">source_path</a>);
<a name="l00429"></a>00429       <a class="code" href="source_8c.html#a5b2639f3f85c2b17fca0c39fe5fcd461">forget_cached_source_info</a> ();
<a name="l00430"></a>00430     }
<a name="l00431"></a>00431   <span class="keywordflow">if</span> (from_tty)
<a name="l00432"></a>00432     <a class="code" href="source_8c.html#a1305f7de7625e47f80fa2f5e07dfe009">show_directories_1</a> ((<span class="keywordtype">char</span> *) 0, from_tty);
<a name="l00433"></a>00433 }
<a name="l00434"></a>00434 
<a name="l00435"></a>00435 <span class="comment">/* Add a path given with the -d command line switch.</span>
<a name="l00436"></a>00436 <span class="comment">   This will not be quoted so we must not treat spaces as separators.  */</span>
<a name="l00437"></a>00437 
<a name="l00438"></a>00438 <span class="keywordtype">void</span>
<a name="l00439"></a><a class="code" href="source_8c.html#aa813154bd88c9532bb33ac5136ab0c96">00439</a> <a class="code" href="defs_8h.html#a9e4b0f927e083e4563721cb7d5deb3cf">directory_switch</a> (<span class="keywordtype">char</span> *dirname, <span class="keywordtype">int</span> from_tty)
<a name="l00440"></a>00440 {
<a name="l00441"></a>00441   <a class="code" href="defs_8h.html#ae599b48ef290cf57c6ad5ed7bc7f7fab">add_path</a> (dirname, &amp;<a class="code" href="defs_8h.html#a7185b9daf1af3b15efc4d777cc2986b4">source_path</a>, 0);
<a name="l00442"></a>00442 }
<a name="l00443"></a>00443 
<a name="l00444"></a>00444 <span class="comment">/* Add zero or more directories to the front of an arbitrary path.  */</span>
<a name="l00445"></a>00445 
<a name="l00446"></a>00446 <span class="keywordtype">void</span>
<a name="l00447"></a><a class="code" href="source_8c.html#a345984680b3b295e52cc61d723682787">00447</a> <a class="code" href="defs_8h.html#af19e40cd95c481d25a595e8c601fb9ab">mod_path</a> (<span class="keywordtype">char</span> *dirname, <span class="keywordtype">char</span> **which_path)
<a name="l00448"></a>00448 {
<a name="l00449"></a>00449   <a class="code" href="defs_8h.html#ae599b48ef290cf57c6ad5ed7bc7f7fab">add_path</a> (dirname, which_path, 1);
<a name="l00450"></a>00450 }
<a name="l00451"></a>00451 
<a name="l00452"></a>00452 <span class="comment">/* Workhorse of mod_path.  Takes an extra argument to determine</span>
<a name="l00453"></a>00453 <span class="comment">   if dirname should be parsed for separators that indicate multiple</span>
<a name="l00454"></a>00454 <span class="comment">   directories.  This allows for interfaces that pre-parse the dirname</span>
<a name="l00455"></a>00455 <span class="comment">   and allow specification of traditional separator characters such</span>
<a name="l00456"></a>00456 <span class="comment">   as space or tab.  */</span>
<a name="l00457"></a>00457 
<a name="l00458"></a>00458 <span class="keywordtype">void</span>
<a name="l00459"></a><a class="code" href="source_8c.html#ab30cb78b19bb421a90a9f4f9cb71bc41">00459</a> <a class="code" href="defs_8h.html#ae599b48ef290cf57c6ad5ed7bc7f7fab">add_path</a> (<span class="keywordtype">char</span> *dirname, <span class="keywordtype">char</span> **which_path, <span class="keywordtype">int</span> parse_separators)
<a name="l00460"></a>00460 {
<a name="l00461"></a>00461   <span class="keywordtype">char</span> *old = *which_path;
<a name="l00462"></a>00462   <span class="keywordtype">int</span> prefix = 0;
<a name="l00463"></a>00463   <a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a> (<a class="code" href="gdb__vecs_8h.html#a5ea7d3fefa2144d9bddaf2053c9691a1">char_ptr</a>) *dir_vec = NULL;
<a name="l00464"></a>00464   <span class="keyword">struct </span><a class="code" href="structcleanup.html">cleanup</a> *back_to;
<a name="l00465"></a>00465   <span class="keywordtype">int</span> ix;
<a name="l00466"></a>00466   <span class="keywordtype">char</span> *<a class="code" href="aarch64-tdep_8c.html#acc128f98d9ceca227038c771308eff39">name</a>;
<a name="l00467"></a>00467 
<a name="l00468"></a>00468   <span class="keywordflow">if</span> (dirname == 0)
<a name="l00469"></a>00469     <span class="keywordflow">return</span>;
<a name="l00470"></a>00470 
<a name="l00471"></a>00471   <span class="keywordflow">if</span> (parse_separators)
<a name="l00472"></a>00472     {
<a name="l00473"></a>00473       <span class="keywordtype">char</span> **argv, **argvp;
<a name="l00474"></a>00474 
<a name="l00475"></a>00475       <span class="comment">/* This will properly parse the space and tab separators</span>
<a name="l00476"></a>00476 <span class="comment">         and any quotes that may exist.  */</span>
<a name="l00477"></a>00477       argv = <a class="code" href="utils_8c.html#a146bf06d6062174a10a36700c40fdae4">gdb_buildargv</a> (dirname);
<a name="l00478"></a>00478 
<a name="l00479"></a>00479       <span class="keywordflow">for</span> (argvp = argv; *argvp; argvp++)
<a name="l00480"></a>00480         <a class="code" href="gdb__vecs_8c.html#aca71a8e4295e596aa23e3d5aa49c59db">dirnames_to_char_ptr_vec_append</a> (&amp;dir_vec, *argvp);
<a name="l00481"></a>00481 
<a name="l00482"></a>00482       freeargv (argv);
<a name="l00483"></a>00483     }
<a name="l00484"></a>00484   <span class="keywordflow">else</span>
<a name="l00485"></a>00485     <a class="code" href="vec_8h.html#a8d090c0524726d00931070e0c438ba3f">VEC_safe_push</a> (<a class="code" href="gdb__vecs_8h.html#a5ea7d3fefa2144d9bddaf2053c9691a1">char_ptr</a>, dir_vec, xstrdup (dirname));
<a name="l00486"></a>00486   back_to = <a class="code" href="gdb__vecs_8h.html#af53fe09ad19fcfb980ef5c908b3daa20">make_cleanup_free_char_ptr_vec</a> (dir_vec);
<a name="l00487"></a>00487 
<a name="l00488"></a>00488   <span class="keywordflow">for</span> (ix = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="gdb__vecs_8h.html#a5ea7d3fefa2144d9bddaf2053c9691a1">char_ptr</a>, dir_vec, ix, name); ++ix)
<a name="l00489"></a>00489     {
<a name="l00490"></a>00490       <span class="keywordtype">char</span> *<a class="code" href="windows-nat_8c.html#ade66e4ccafbc33b117610bbc0d85feb0">p</a>;
<a name="l00491"></a>00491       <span class="keyword">struct </span>stat st;
<a name="l00492"></a>00492 
<a name="l00493"></a>00493       <span class="comment">/* Spaces and tabs will have been removed by buildargv().</span>
<a name="l00494"></a>00494 <span class="comment">         NAME is the start of the directory.</span>
<a name="l00495"></a>00495 <span class="comment">         P is the &#39;\0&#39; following the end.  */</span>
<a name="l00496"></a>00496       p = name + strlen (name);
<a name="l00497"></a>00497 
<a name="l00498"></a>00498       <span class="keywordflow">while</span> (!(IS_DIR_SEPARATOR (*name) &amp;&amp; p &lt;= name + 1)       <span class="comment">/* &quot;/&quot; */</span>
<a name="l00499"></a>00499 #ifdef HAVE_DOS_BASED_FILE_SYSTEM
<a name="l00500"></a>00500       <span class="comment">/* On MS-DOS and MS-Windows, h:\ is different from h: */</span>
<a name="l00501"></a>00501              &amp;&amp; !(p == name + 3 &amp;&amp; name[1] == <span class="charliteral">&#39;:&#39;</span>)              <span class="comment">/* &quot;d:/&quot; */</span>
<a name="l00502"></a>00502 #endif
<a name="l00503"></a>00503              &amp;&amp; IS_DIR_SEPARATOR (p[-1]))
<a name="l00504"></a>00504         <span class="comment">/* Sigh.  &quot;foo/&quot; =&gt; &quot;foo&quot; */</span>
<a name="l00505"></a>00505         --p;
<a name="l00506"></a>00506       *p = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00507"></a>00507 
<a name="l00508"></a>00508       <span class="keywordflow">while</span> (p &gt; name &amp;&amp; p[-1] == <span class="charliteral">&#39;.&#39;</span>)
<a name="l00509"></a>00509         {
<a name="l00510"></a>00510           <span class="keywordflow">if</span> (p - name == 1)
<a name="l00511"></a>00511             {
<a name="l00512"></a>00512               <span class="comment">/* &quot;.&quot; =&gt; getwd ().  */</span>
<a name="l00513"></a>00513               name = <a class="code" href="defs_8h.html#a6dd03da55f1ccd4375343b3a93aaf421">current_directory</a>;
<a name="l00514"></a>00514               <span class="keywordflow">goto</span> append;
<a name="l00515"></a>00515             }
<a name="l00516"></a>00516           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p &gt; name + 1 &amp;&amp; IS_DIR_SEPARATOR (p[-2]))
<a name="l00517"></a>00517             {
<a name="l00518"></a>00518               <span class="keywordflow">if</span> (p - name == 2)
<a name="l00519"></a>00519                 {
<a name="l00520"></a>00520                   <span class="comment">/* &quot;/.&quot; =&gt; &quot;/&quot;.  */</span>
<a name="l00521"></a>00521                   *--p = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00522"></a>00522                   <span class="keywordflow">goto</span> append;
<a name="l00523"></a>00523                 }
<a name="l00524"></a>00524               <span class="keywordflow">else</span>
<a name="l00525"></a>00525                 {
<a name="l00526"></a>00526                   <span class="comment">/* &quot;...foo/.&quot; =&gt; &quot;...foo&quot;.  */</span>
<a name="l00527"></a>00527                   p -= 2;
<a name="l00528"></a>00528                   *p = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00529"></a>00529                   <span class="keywordflow">continue</span>;
<a name="l00530"></a>00530                 }
<a name="l00531"></a>00531             }
<a name="l00532"></a>00532           <span class="keywordflow">else</span>
<a name="l00533"></a>00533             <span class="keywordflow">break</span>;
<a name="l00534"></a>00534         }
<a name="l00535"></a>00535 
<a name="l00536"></a>00536       <span class="keywordflow">if</span> (name[0] == <span class="charliteral">&#39;~&#39;</span>)
<a name="l00537"></a>00537         name = tilde_expand (name);
<a name="l00538"></a>00538 <span class="preprocessor">#ifdef HAVE_DOS_BASED_FILE_SYSTEM</span>
<a name="l00539"></a>00539 <span class="preprocessor"></span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (IS_ABSOLUTE_PATH (name) &amp;&amp; p == name + 2) <span class="comment">/* &quot;d:&quot; =&gt; &quot;d:.&quot; */</span>
<a name="l00540"></a>00540         name = concat (name, <span class="stringliteral">&quot;.&quot;</span>, (<span class="keywordtype">char</span> *)NULL);
<a name="l00541"></a>00541 <span class="preprocessor">#endif</span>
<a name="l00542"></a>00542 <span class="preprocessor"></span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!IS_ABSOLUTE_PATH (name) &amp;&amp; name[0] != <span class="charliteral">&#39;$&#39;</span>)
<a name="l00543"></a>00543         name = concat (<a class="code" href="defs_8h.html#a6dd03da55f1ccd4375343b3a93aaf421">current_directory</a>, SLASH_STRING, name, (<span class="keywordtype">char</span> *)NULL);
<a name="l00544"></a>00544       <span class="keywordflow">else</span>
<a name="l00545"></a>00545         name = <a class="code" href="common-utils_8c.html#a5f388f89054b57d850779d7d71bc4d1c">savestring</a> (name, p - name);
<a name="l00546"></a>00546       <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, name);
<a name="l00547"></a>00547 
<a name="l00548"></a>00548       <span class="comment">/* Unless it&#39;s a variable, check existence.  */</span>
<a name="l00549"></a>00549       <span class="keywordflow">if</span> (name[0] != <span class="charliteral">&#39;$&#39;</span>)
<a name="l00550"></a>00550         {
<a name="l00551"></a>00551           <span class="comment">/* These are warnings, not errors, since we don&#39;t want a</span>
<a name="l00552"></a>00552 <span class="comment">             non-existent directory in a .gdbinit file to stop processing</span>
<a name="l00553"></a>00553 <span class="comment">             of the .gdbinit file.</span>
<a name="l00554"></a>00554 <span class="comment"></span>
<a name="l00555"></a>00555 <span class="comment">             Whether they get added to the path is more debatable.  Current</span>
<a name="l00556"></a>00556 <span class="comment">             answer is yes, in case the user wants to go make the directory</span>
<a name="l00557"></a>00557 <span class="comment">             or whatever.  If the directory continues to not exist/not be</span>
<a name="l00558"></a>00558 <span class="comment">             a directory/etc, then having them in the path should be</span>
<a name="l00559"></a>00559 <span class="comment">             harmless.  */</span>
<a name="l00560"></a>00560           <span class="keywordflow">if</span> (stat (name, &amp;st) &lt; 0)
<a name="l00561"></a>00561             {
<a name="l00562"></a>00562               <span class="keywordtype">int</span> save_errno = errno;
<a name="l00563"></a>00563 
<a name="l00564"></a>00564               <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a2a1dea1e551cadb9541353a004193a47">gdb_stderr</a>, <span class="stringliteral">&quot;Warning: &quot;</span>);
<a name="l00565"></a>00565               <a class="code" href="utils_8c.html#a539ee53fd58602e5967f3852c6689792">print_sys_errmsg</a> (name, save_errno);
<a name="l00566"></a>00566             }
<a name="l00567"></a>00567           <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((st.st_mode &amp; S_IFMT) != S_IFDIR)
<a name="l00568"></a>00568             <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;%s is not a directory.&quot;</span>), name);
<a name="l00569"></a>00569         }
<a name="l00570"></a>00570 
<a name="l00571"></a>00571     append:
<a name="l00572"></a>00572       {
<a name="l00573"></a>00573         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a> = strlen (name);
<a name="l00574"></a>00574         <span class="keywordtype">char</span> tinybuf[2];
<a name="l00575"></a>00575 
<a name="l00576"></a>00576         p = *which_path;
<a name="l00577"></a>00577         <span class="comment">/* FIXME: we should use realpath() or its work-alike</span>
<a name="l00578"></a>00578 <span class="comment">           before comparing.  Then all the code above which</span>
<a name="l00579"></a>00579 <span class="comment">           removes excess slashes and dots could simply go away.  */</span>
<a name="l00580"></a>00580         <span class="keywordflow">if</span> (!filename_cmp (p, name))
<a name="l00581"></a>00581           {
<a name="l00582"></a>00582             <span class="comment">/* Found it in the search path, remove old copy.  */</span>
<a name="l00583"></a>00583             <span class="keywordflow">if</span> (p &gt; *which_path)
<a name="l00584"></a>00584               p--;              <span class="comment">/* Back over leading separator.  */</span>
<a name="l00585"></a>00585             <span class="keywordflow">if</span> (prefix &gt; p - *which_path)
<a name="l00586"></a>00586               <span class="keywordflow">goto</span> skip_dup;    <span class="comment">/* Same dir twice in one cmd.  */</span>
<a name="l00587"></a>00587             <a class="code" href="gdb__string_8h.html#a83bff071dce86912d77444c20c9fcb72">memmove</a> (p, &amp;p[len + 1], strlen (&amp;p[len + 1]) + 1); <span class="comment">/* Copy from next \0 or  : */</span>
<a name="l00588"></a>00588           }
<a name="l00589"></a>00589 
<a name="l00590"></a>00590         tinybuf[0] = DIRNAME_SEPARATOR;
<a name="l00591"></a>00591         tinybuf[1] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00592"></a>00592 
<a name="l00593"></a>00593         <span class="comment">/* If we have already tacked on a name(s) in this command,</span>
<a name="l00594"></a>00594 <span class="comment">           be sure they stay on the front as we tack on some</span>
<a name="l00595"></a>00595 <span class="comment">           more.  */</span>
<a name="l00596"></a>00596         <span class="keywordflow">if</span> (prefix)
<a name="l00597"></a>00597           {
<a name="l00598"></a>00598             <span class="keywordtype">char</span> *temp, c;
<a name="l00599"></a>00599 
<a name="l00600"></a>00600             c = old[prefix];
<a name="l00601"></a>00601             old[prefix] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00602"></a>00602             temp = concat (old, tinybuf, name, (<span class="keywordtype">char</span> *)NULL);
<a name="l00603"></a>00603             old[prefix] = c;
<a name="l00604"></a>00604             *which_path = concat (temp, <span class="stringliteral">&quot;&quot;</span>, &amp;old[prefix], (<span class="keywordtype">char</span> *) NULL);
<a name="l00605"></a>00605             prefix = strlen (temp);
<a name="l00606"></a>00606             <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (temp);
<a name="l00607"></a>00607           }
<a name="l00608"></a>00608         <span class="keywordflow">else</span>
<a name="l00609"></a>00609           {
<a name="l00610"></a>00610             *which_path = concat (name, (old[0] ? tinybuf : old),
<a name="l00611"></a>00611                                   old, (<span class="keywordtype">char</span> *)NULL);
<a name="l00612"></a>00612             prefix = strlen (name);
<a name="l00613"></a>00613           }
<a name="l00614"></a>00614         <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (old);
<a name="l00615"></a>00615         old = *which_path;
<a name="l00616"></a>00616       }
<a name="l00617"></a>00617     skip_dup:
<a name="l00618"></a>00618       ;
<a name="l00619"></a>00619     }
<a name="l00620"></a>00620 
<a name="l00621"></a>00621   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (back_to);
<a name="l00622"></a>00622 }
<a name="l00623"></a>00623 
<a name="l00624"></a>00624 
<a name="l00625"></a>00625 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00626"></a><a class="code" href="source_8c.html#a1f0220396aeed38af058dfe824accace">00626</a> <a class="code" href="source_8c.html#a1f0220396aeed38af058dfe824accace">source_info</a> (<span class="keywordtype">char</span> *<a class="code" href="corelow_8c.html#ac54c1aef0966c38fc155dec95a38db50">ignore</a>, <span class="keywordtype">int</span> from_tty)
<a name="l00627"></a>00627 {
<a name="l00628"></a>00628   <span class="keyword">struct </span><a class="code" href="structsymtab.html">symtab</a> *s = <a class="code" href="source_8c.html#a869f99e7ba57b2aac5ed4fffff8a430d">current_source_symtab</a>;
<a name="l00629"></a>00629 
<a name="l00630"></a>00630   <span class="keywordflow">if</span> (!s)
<a name="l00631"></a>00631     {
<a name="l00632"></a>00632       <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No current source file.\n&quot;</span>));
<a name="l00633"></a>00633       <span class="keywordflow">return</span>;
<a name="l00634"></a>00634     }
<a name="l00635"></a>00635   <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Current source file is %s\n&quot;</span>), s-&gt;<a class="code" href="structsymtab.html#acd8b6d6ddeca3b61953b0c736e13c35a">filename</a>);
<a name="l00636"></a>00636   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structsymtab.html#a3ced004986e8eb900b962fdc5a3ec392">dirname</a>)
<a name="l00637"></a>00637     <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Compilation directory is %s\n&quot;</span>), s-&gt;<a class="code" href="structsymtab.html#a3ced004986e8eb900b962fdc5a3ec392">dirname</a>);
<a name="l00638"></a>00638   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structsymtab.html#a69ab8f02c05080d73ef701cf239e9c5e">fullname</a>)
<a name="l00639"></a>00639     <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Located in %s\n&quot;</span>), s-&gt;<a class="code" href="structsymtab.html#a69ab8f02c05080d73ef701cf239e9c5e">fullname</a>);
<a name="l00640"></a>00640   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structsymtab.html#a36dda01fdbd5e4363ce05b2a0a8422bf">nlines</a>)
<a name="l00641"></a>00641     <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Contains %d line%s.\n&quot;</span>), s-&gt;<a class="code" href="structsymtab.html#a36dda01fdbd5e4363ce05b2a0a8422bf">nlines</a>,
<a name="l00642"></a>00642                      s-&gt;<a class="code" href="structsymtab.html#a36dda01fdbd5e4363ce05b2a0a8422bf">nlines</a> == 1 ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;s&quot;</span>);
<a name="l00643"></a>00643 
<a name="l00644"></a>00644   <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Source language is %s.\n&quot;</span>), <a class="code" href="language_8c.html#aba6ca4d60b4edf31700eccd67abc5fe4">language_str</a> (s-&gt;<a class="code" href="structsymtab.html#a26ff640a27ab8781d9e09231bd173e6c">language</a>));
<a name="l00645"></a>00645   <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Compiled with %s debugging format.\n&quot;</span>), s-&gt;<a class="code" href="structsymtab.html#a0f94551c52edf625703a3f34589badba">debugformat</a>);
<a name="l00646"></a>00646   <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;%s preprocessor macro info.\n&quot;</span>),
<a name="l00647"></a>00647                    s-&gt;<a class="code" href="structsymtab.html#abf1d62eefc00e8817d8a203699c37df6">macro_table</a> ? <span class="stringliteral">&quot;Includes&quot;</span> : <span class="stringliteral">&quot;Does not include&quot;</span>);
<a name="l00648"></a>00648 }
<a name="l00649"></a>00649 
<a name="l00650"></a>00650 
<a name="l00651"></a>00651 <span class="comment">/* Return True if the file NAME exists and is a regular file.  */</span>
<a name="l00652"></a>00652 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00653"></a><a class="code" href="source_8c.html#a3295e881a8a27ff6f96be7fa185587ed">00653</a> <a class="code" href="source_8c.html#a3295e881a8a27ff6f96be7fa185587ed">is_regular_file</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="aarch64-tdep_8c.html#acc128f98d9ceca227038c771308eff39">name</a>)
<a name="l00654"></a>00654 {
<a name="l00655"></a>00655   <span class="keyword">struct </span>stat st;
<a name="l00656"></a>00656   <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespaceexsummary.html#aa4a2eed06e51a1f73ff9053ec9f2591e">status</a> = stat (name, &amp;st);
<a name="l00657"></a>00657 
<a name="l00658"></a>00658   <span class="comment">/* Stat should never fail except when the file does not exist.</span>
<a name="l00659"></a>00659 <span class="comment">     If stat fails, analyze the source of error and return True</span>
<a name="l00660"></a>00660 <span class="comment">     unless the file does not exist, to avoid returning false results</span>
<a name="l00661"></a>00661 <span class="comment">     on obscure systems where stat does not work as expected.  */</span>
<a name="l00662"></a>00662 
<a name="l00663"></a>00663   <span class="keywordflow">if</span> (status != 0)
<a name="l00664"></a>00664     <span class="keywordflow">return</span> (errno != ENOENT);
<a name="l00665"></a>00665 
<a name="l00666"></a>00666   <span class="keywordflow">return</span> S_ISREG (st.st_mode);
<a name="l00667"></a>00667 }
<a name="l00668"></a>00668 
<a name="l00669"></a>00669 <span class="comment">/* Open a file named STRING, searching path PATH (dir names sep by some char)</span>
<a name="l00670"></a>00670 <span class="comment">   using mode MODE in the calls to open.  You cannot use this function to</span>
<a name="l00671"></a>00671 <span class="comment">   create files (O_CREAT).</span>
<a name="l00672"></a>00672 <span class="comment"></span>
<a name="l00673"></a>00673 <span class="comment">   OPTS specifies the function behaviour in specific cases.</span>
<a name="l00674"></a>00674 <span class="comment"></span>
<a name="l00675"></a>00675 <span class="comment">   If OPF_TRY_CWD_FIRST, try to open ./STRING before searching PATH.</span>
<a name="l00676"></a>00676 <span class="comment">   (ie pretend the first element of PATH is &quot;.&quot;).  This also indicates</span>
<a name="l00677"></a>00677 <span class="comment">   that, unless OPF_SEARCH_IN_PATH is also specified, a slash in STRING</span>
<a name="l00678"></a>00678 <span class="comment">   disables searching of the path (this is so that &quot;exec-file ./foo&quot; or</span>
<a name="l00679"></a>00679 <span class="comment">   &quot;symbol-file ./foo&quot; insures that you get that particular version of</span>
<a name="l00680"></a>00680 <span class="comment">   foo or an error message).</span>
<a name="l00681"></a>00681 <span class="comment"></span>
<a name="l00682"></a>00682 <span class="comment">   If OPTS has OPF_SEARCH_IN_PATH set, absolute names will also be</span>
<a name="l00683"></a>00683 <span class="comment">   searched in path (we usually want this for source files but not for</span>
<a name="l00684"></a>00684 <span class="comment">   executables).</span>
<a name="l00685"></a>00685 <span class="comment"></span>
<a name="l00686"></a>00686 <span class="comment">   If FILENAME_OPENED is non-null, set it to a newly allocated string naming</span>
<a name="l00687"></a>00687 <span class="comment">   the actual file opened (this string will always start with a &quot;/&quot;).  We</span>
<a name="l00688"></a>00688 <span class="comment">   have to take special pains to avoid doubling the &quot;/&quot; between the directory</span>
<a name="l00689"></a>00689 <span class="comment">   and the file, sigh!  Emacs gets confuzzed by this when we print the</span>
<a name="l00690"></a>00690 <span class="comment">   source file name!!! </span>
<a name="l00691"></a>00691 <span class="comment"></span>
<a name="l00692"></a>00692 <span class="comment">   If OPTS has OPF_RETURN_REALPATH set return FILENAME_OPENED resolved by</span>
<a name="l00693"></a>00693 <span class="comment">   gdb_realpath.  Even without OPF_RETURN_REALPATH this function still returns</span>
<a name="l00694"></a>00694 <span class="comment">   filename starting with &quot;/&quot;.  If FILENAME_OPENED is NULL this option has no</span>
<a name="l00695"></a>00695 <span class="comment">   effect.</span>
<a name="l00696"></a>00696 <span class="comment"></span>
<a name="l00697"></a>00697 <span class="comment">   If a file is found, return the descriptor.</span>
<a name="l00698"></a>00698 <span class="comment">   Otherwise, return -1, with errno set for the last name we tried to open.  */</span>
<a name="l00699"></a>00699 
<a name="l00700"></a>00700 <span class="comment">/*  &gt;&gt;&gt;&gt; This should only allow files of certain types,</span>
<a name="l00701"></a>00701 <span class="comment">    &gt;&gt;&gt;&gt;  eg executable, non-directory.  */</span>
<a name="l00702"></a>00702 <span class="keywordtype">int</span>
<a name="l00703"></a><a class="code" href="source_8c.html#a710990e74633c8f8214fec761e9548bd">00703</a> <a class="code" href="defs_8h.html#ad1c5ec0f63e79e6293a00ca1a30de767">openp</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *path, <span class="keywordtype">int</span> opts, <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">string</span>,
<a name="l00704"></a>00704        <span class="keywordtype">int</span> mode, <span class="keywordtype">char</span> **filename_opened)
<a name="l00705"></a>00705 {
<a name="l00706"></a>00706   <span class="keywordtype">int</span> fd;
<a name="l00707"></a>00707   <span class="keywordtype">char</span> *filename;
<a name="l00708"></a>00708   <span class="keywordtype">int</span> alloclen;
<a name="l00709"></a>00709   <a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a> (<a class="code" href="gdb__vecs_8h.html#a5ea7d3fefa2144d9bddaf2053c9691a1">char_ptr</a>) *dir_vec;
<a name="l00710"></a>00710   <span class="keyword">struct </span><a class="code" href="structcleanup.html">cleanup</a> *back_to;
<a name="l00711"></a>00711   <span class="keywordtype">int</span> ix;
<a name="l00712"></a>00712   <span class="keywordtype">char</span> *dir;
<a name="l00713"></a>00713 
<a name="l00714"></a>00714   <span class="comment">/* The open syscall MODE parameter is not specified.  */</span>
<a name="l00715"></a>00715   <a class="code" href="gdb__assert_8h.html#aeb007d3e990858c7ef8e40a7e512c1ff">gdb_assert</a> ((mode &amp; O_CREAT) == 0);
<a name="l00716"></a>00716   <a class="code" href="gdb__assert_8h.html#aeb007d3e990858c7ef8e40a7e512c1ff">gdb_assert</a> (<span class="keywordtype">string</span> != NULL);
<a name="l00717"></a>00717 
<a name="l00718"></a>00718   <span class="comment">/* A file with an empty name cannot possibly exist.  Report a failure</span>
<a name="l00719"></a>00719 <span class="comment">     without further checking.</span>
<a name="l00720"></a>00720 <span class="comment"></span>
<a name="l00721"></a>00721 <span class="comment">     This is an optimization which also defends us against buggy</span>
<a name="l00722"></a>00722 <span class="comment">     implementations of the &quot;stat&quot; function.  For instance, we have</span>
<a name="l00723"></a>00723 <span class="comment">     noticed that a MinGW debugger built on Windows XP 32bits crashes</span>
<a name="l00724"></a>00724 <span class="comment">     when the debugger is started with an empty argument.  */</span>
<a name="l00725"></a>00725   <span class="keywordflow">if</span> (<span class="keywordtype">string</span>[0] == <span class="charliteral">&#39;\0&#39;</span>)
<a name="l00726"></a>00726     {
<a name="l00727"></a>00727       errno = ENOENT;
<a name="l00728"></a>00728       <span class="keywordflow">return</span> -1;
<a name="l00729"></a>00729     }
<a name="l00730"></a>00730 
<a name="l00731"></a>00731   <span class="keywordflow">if</span> (!path)
<a name="l00732"></a>00732     path = <span class="stringliteral">&quot;.&quot;</span>;
<a name="l00733"></a>00733 
<a name="l00734"></a>00734   mode |= O_BINARY;
<a name="l00735"></a>00735 
<a name="l00736"></a>00736   <span class="keywordflow">if</span> ((opts &amp; <a class="code" href="defs_8h.html#acfe2ebd7990c064286b8551ae1fd042f">OPF_TRY_CWD_FIRST</a>) || IS_ABSOLUTE_PATH (<span class="keywordtype">string</span>))
<a name="l00737"></a>00737     {
<a name="l00738"></a>00738       <span class="keywordtype">int</span> i;
<a name="l00739"></a>00739 
<a name="l00740"></a>00740       <span class="keywordflow">if</span> (<a class="code" href="source_8c.html#a3295e881a8a27ff6f96be7fa185587ed">is_regular_file</a> (<span class="keywordtype">string</span>))
<a name="l00741"></a>00741         {
<a name="l00742"></a>00742           filename = alloca (strlen (<span class="keywordtype">string</span>) + 1);
<a name="l00743"></a>00743           strcpy (filename, <span class="keywordtype">string</span>);
<a name="l00744"></a>00744           fd = <a class="code" href="filestuff_8c.html#adf94e72f9c914500c8b9b5d1e66de811">gdb_open_cloexec</a> (filename, mode, 0);
<a name="l00745"></a>00745           <span class="keywordflow">if</span> (fd &gt;= 0)
<a name="l00746"></a>00746             <span class="keywordflow">goto</span> done;
<a name="l00747"></a>00747         }
<a name="l00748"></a>00748       <span class="keywordflow">else</span>
<a name="l00749"></a>00749         {
<a name="l00750"></a>00750           filename = NULL;
<a name="l00751"></a>00751           fd = -1;
<a name="l00752"></a>00752         }
<a name="l00753"></a>00753 
<a name="l00754"></a>00754       <span class="keywordflow">if</span> (!(opts &amp; <a class="code" href="defs_8h.html#a127eb06f9722fb25875390cbcfbaec08">OPF_SEARCH_IN_PATH</a>))
<a name="l00755"></a>00755         <span class="keywordflow">for</span> (i = 0; <span class="keywordtype">string</span>[i]; i++)
<a name="l00756"></a>00756           <span class="keywordflow">if</span> (IS_DIR_SEPARATOR (<span class="keywordtype">string</span>[i]))
<a name="l00757"></a>00757             <span class="keywordflow">goto</span> done;
<a name="l00758"></a>00758     }
<a name="l00759"></a>00759 
<a name="l00760"></a>00760   <span class="comment">/* For dos paths, d:/foo -&gt; /foo, and d:foo -&gt; foo.  */</span>
<a name="l00761"></a>00761   <span class="keywordflow">if</span> (HAS_DRIVE_SPEC (<span class="keywordtype">string</span>))
<a name="l00762"></a>00762     <span class="keywordtype">string</span> = STRIP_DRIVE_SPEC (<span class="keywordtype">string</span>);
<a name="l00763"></a>00763 
<a name="l00764"></a>00764   <span class="comment">/* /foo =&gt; foo, to avoid multiple slashes that Emacs doesn&#39;t like.  */</span>
<a name="l00765"></a>00765   <span class="keywordflow">while</span> (IS_DIR_SEPARATOR(<span class="keywordtype">string</span>[0]))
<a name="l00766"></a>00766     <span class="keywordtype">string</span>++;
<a name="l00767"></a>00767 
<a name="l00768"></a>00768   <span class="comment">/* ./foo =&gt; foo */</span>
<a name="l00769"></a>00769   <span class="keywordflow">while</span> (<span class="keywordtype">string</span>[0] == <span class="charliteral">&#39;.&#39;</span> &amp;&amp; IS_DIR_SEPARATOR (<span class="keywordtype">string</span>[1]))
<a name="l00770"></a>00770     <span class="keywordtype">string</span> += 2;
<a name="l00771"></a>00771 
<a name="l00772"></a>00772   alloclen = strlen (path) + strlen (<span class="keywordtype">string</span>) + 2;
<a name="l00773"></a>00773   filename = alloca (alloclen);
<a name="l00774"></a>00774   fd = -1;
<a name="l00775"></a>00775 
<a name="l00776"></a>00776   dir_vec = dirnames_to_char_ptr_vec (path);
<a name="l00777"></a>00777   back_to = <a class="code" href="gdb__vecs_8h.html#af53fe09ad19fcfb980ef5c908b3daa20">make_cleanup_free_char_ptr_vec</a> (dir_vec);
<a name="l00778"></a>00778 
<a name="l00779"></a>00779   <span class="keywordflow">for</span> (ix = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="gdb__vecs_8h.html#a5ea7d3fefa2144d9bddaf2053c9691a1">char_ptr</a>, dir_vec, ix, dir); ++ix)
<a name="l00780"></a>00780     {
<a name="l00781"></a>00781       <span class="keywordtype">size_t</span> <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a> = strlen (dir);
<a name="l00782"></a>00782 
<a name="l00783"></a>00783       <span class="keywordflow">if</span> (strcmp (dir, <span class="stringliteral">&quot;$cwd&quot;</span>) == 0)
<a name="l00784"></a>00784         {
<a name="l00785"></a>00785           <span class="comment">/* Name is $cwd -- insert current directory name instead.  */</span>
<a name="l00786"></a>00786           <span class="keywordtype">int</span> newlen;
<a name="l00787"></a>00787 
<a name="l00788"></a>00788           <span class="comment">/* First, realloc the filename buffer if too short.  */</span>
<a name="l00789"></a>00789           len = strlen (<a class="code" href="defs_8h.html#a6dd03da55f1ccd4375343b3a93aaf421">current_directory</a>);
<a name="l00790"></a>00790           newlen = len + strlen (<span class="keywordtype">string</span>) + 2;
<a name="l00791"></a>00791           <span class="keywordflow">if</span> (newlen &gt; alloclen)
<a name="l00792"></a>00792             {
<a name="l00793"></a>00793               alloclen = newlen;
<a name="l00794"></a>00794               filename = alloca (alloclen);
<a name="l00795"></a>00795             }
<a name="l00796"></a>00796           strcpy (filename, <a class="code" href="defs_8h.html#a6dd03da55f1ccd4375343b3a93aaf421">current_directory</a>);
<a name="l00797"></a>00797         }
<a name="l00798"></a>00798       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="gdb__string_8h.html#adf46aa8f2e08cfb505868bbfc88b5fd4">strchr</a>(dir, <span class="charliteral">&#39;~&#39;</span>))
<a name="l00799"></a>00799         {
<a name="l00800"></a>00800          <span class="comment">/* See whether we need to expand the tilde.  */</span>
<a name="l00801"></a>00801           <span class="keywordtype">int</span> newlen;
<a name="l00802"></a>00802           <span class="keywordtype">char</span> *tilde_expanded;
<a name="l00803"></a>00803 
<a name="l00804"></a>00804           tilde_expanded  = tilde_expand (dir);
<a name="l00805"></a>00805 
<a name="l00806"></a>00806           <span class="comment">/* First, realloc the filename buffer if too short.  */</span>
<a name="l00807"></a>00807           len = strlen (tilde_expanded);
<a name="l00808"></a>00808           newlen = len + strlen (<span class="keywordtype">string</span>) + 2;
<a name="l00809"></a>00809           <span class="keywordflow">if</span> (newlen &gt; alloclen)
<a name="l00810"></a>00810             {
<a name="l00811"></a>00811               alloclen = newlen;
<a name="l00812"></a>00812               filename = alloca (alloclen);
<a name="l00813"></a>00813             }
<a name="l00814"></a>00814           strcpy (filename, tilde_expanded);
<a name="l00815"></a>00815           <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (tilde_expanded);
<a name="l00816"></a>00816         }
<a name="l00817"></a>00817       <span class="keywordflow">else</span>
<a name="l00818"></a>00818         {
<a name="l00819"></a>00819           <span class="comment">/* Normal file name in path -- just use it.  */</span>
<a name="l00820"></a>00820           strcpy (filename, dir);
<a name="l00821"></a>00821 
<a name="l00822"></a>00822           <span class="comment">/* Don&#39;t search $cdir.  It&#39;s also a magic path like $cwd, but we</span>
<a name="l00823"></a>00823 <span class="comment">             don&#39;t have enough information to expand it.  The user *could*</span>
<a name="l00824"></a>00824 <span class="comment">             have an actual directory named &#39;$cdir&#39; but handling that would</span>
<a name="l00825"></a>00825 <span class="comment">             be confusing, it would mean different things in different</span>
<a name="l00826"></a>00826 <span class="comment">             contexts.  If the user really has &#39;$cdir&#39; one can use &#39;./$cdir&#39;.</span>
<a name="l00827"></a>00827 <span class="comment">             We can get $cdir when loading scripts.  When loading source files</span>
<a name="l00828"></a>00828 <span class="comment">             $cdir must have already been expanded to the correct value.  */</span>
<a name="l00829"></a>00829           <span class="keywordflow">if</span> (strcmp (dir, <span class="stringliteral">&quot;$cdir&quot;</span>) == 0)
<a name="l00830"></a>00830             <span class="keywordflow">continue</span>;
<a name="l00831"></a>00831         }
<a name="l00832"></a>00832 
<a name="l00833"></a>00833       <span class="comment">/* Remove trailing slashes.  */</span>
<a name="l00834"></a>00834       <span class="keywordflow">while</span> (len &gt; 0 &amp;&amp; IS_DIR_SEPARATOR (filename[len - 1]))
<a name="l00835"></a>00835         filename[--<a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>] = 0;
<a name="l00836"></a>00836 
<a name="l00837"></a>00837       strcat (filename + len, SLASH_STRING);
<a name="l00838"></a>00838       strcat (filename, <span class="keywordtype">string</span>);
<a name="l00839"></a>00839 
<a name="l00840"></a>00840       <span class="keywordflow">if</span> (<a class="code" href="source_8c.html#a3295e881a8a27ff6f96be7fa185587ed">is_regular_file</a> (filename))
<a name="l00841"></a>00841         {
<a name="l00842"></a>00842           fd = <a class="code" href="filestuff_8c.html#adf94e72f9c914500c8b9b5d1e66de811">gdb_open_cloexec</a> (filename, mode, 0);
<a name="l00843"></a>00843           <span class="keywordflow">if</span> (fd &gt;= 0)
<a name="l00844"></a>00844             <span class="keywordflow">break</span>;
<a name="l00845"></a>00845         }
<a name="l00846"></a>00846     }
<a name="l00847"></a>00847 
<a name="l00848"></a>00848   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (back_to);
<a name="l00849"></a>00849 
<a name="l00850"></a>00850 done:
<a name="l00851"></a>00851   <span class="keywordflow">if</span> (filename_opened)
<a name="l00852"></a>00852     {
<a name="l00853"></a>00853       <span class="comment">/* If a file was opened, canonicalize its filename.  */</span>
<a name="l00854"></a>00854       <span class="keywordflow">if</span> (fd &lt; 0)
<a name="l00855"></a>00855         *filename_opened = NULL;
<a name="l00856"></a>00856       <span class="keywordflow">else</span>
<a name="l00857"></a>00857         {
<a name="l00858"></a>00858           <span class="keywordtype">char</span> *(*realpath_fptr) (<span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00859"></a>00859 
<a name="l00860"></a>00860           realpath_fptr = ((opts &amp; <a class="code" href="defs_8h.html#aa669554d54e1c74b6654a123f95205ff">OPF_RETURN_REALPATH</a>) != 0
<a name="l00861"></a>00861                            ? <a class="code" href="utils_8c.html#a38e450f9b68243416d35f57e37e23e3e">gdb_realpath</a> : xstrdup);
<a name="l00862"></a>00862 
<a name="l00863"></a>00863           <span class="keywordflow">if</span> (IS_ABSOLUTE_PATH (filename))
<a name="l00864"></a>00864             *filename_opened = realpath_fptr (filename);
<a name="l00865"></a>00865           <span class="keywordflow">else</span>
<a name="l00866"></a>00866             {
<a name="l00867"></a>00867               <span class="comment">/* Beware the // my son, the Emacs barfs, the botch that catch...  */</span>
<a name="l00868"></a>00868 
<a name="l00869"></a>00869               <span class="keywordtype">char</span> *f = concat (<a class="code" href="defs_8h.html#a6dd03da55f1ccd4375343b3a93aaf421">current_directory</a>,
<a name="l00870"></a>00870                                 IS_DIR_SEPARATOR (<a class="code" href="defs_8h.html#a6dd03da55f1ccd4375343b3a93aaf421">current_directory</a>[strlen (<a class="code" href="defs_8h.html#a6dd03da55f1ccd4375343b3a93aaf421">current_directory</a>) - 1])
<a name="l00871"></a>00871                                 ? <span class="stringliteral">&quot;&quot;</span> : SLASH_STRING,
<a name="l00872"></a>00872                                 filename, (<span class="keywordtype">char</span> *)NULL);
<a name="l00873"></a>00873 
<a name="l00874"></a>00874               *filename_opened = realpath_fptr (f);
<a name="l00875"></a>00875               <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (f);
<a name="l00876"></a>00876             }
<a name="l00877"></a>00877         }
<a name="l00878"></a>00878     }
<a name="l00879"></a>00879 
<a name="l00880"></a>00880   <span class="keywordflow">return</span> fd;
<a name="l00881"></a>00881 }
<a name="l00882"></a>00882 
<a name="l00883"></a>00883 
<a name="l00884"></a>00884 <span class="comment">/* This is essentially a convenience, for clients that want the behaviour</span>
<a name="l00885"></a>00885 <span class="comment">   of openp, using source_path, but that really don&#39;t want the file to be</span>
<a name="l00886"></a>00886 <span class="comment">   opened but want instead just to know what the full pathname is (as</span>
<a name="l00887"></a>00887 <span class="comment">   qualified against source_path).</span>
<a name="l00888"></a>00888 <span class="comment"></span>
<a name="l00889"></a>00889 <span class="comment">   The current working directory is searched first.</span>
<a name="l00890"></a>00890 <span class="comment"></span>
<a name="l00891"></a>00891 <span class="comment">   If the file was found, this function returns 1, and FULL_PATHNAME is</span>
<a name="l00892"></a>00892 <span class="comment">   set to the fully-qualified pathname.</span>
<a name="l00893"></a>00893 <span class="comment"></span>
<a name="l00894"></a>00894 <span class="comment">   Else, this functions returns 0, and FULL_PATHNAME is set to NULL.  */</span>
<a name="l00895"></a>00895 <span class="keywordtype">int</span>
<a name="l00896"></a><a class="code" href="source_8c.html#a532414687bdbdb7bf542ea0f2d185ed2">00896</a> <a class="code" href="defs_8h.html#a3de8e620b4c688bed72e98a88646ff26">source_full_path_of</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *filename, <span class="keywordtype">char</span> **full_pathname)
<a name="l00897"></a>00897 {
<a name="l00898"></a>00898   <span class="keywordtype">int</span> fd;
<a name="l00899"></a>00899 
<a name="l00900"></a>00900   fd = <a class="code" href="defs_8h.html#ad1c5ec0f63e79e6293a00ca1a30de767">openp</a> (<a class="code" href="defs_8h.html#a7185b9daf1af3b15efc4d777cc2986b4">source_path</a>,
<a name="l00901"></a>00901               <a class="code" href="defs_8h.html#acfe2ebd7990c064286b8551ae1fd042f">OPF_TRY_CWD_FIRST</a> | <a class="code" href="defs_8h.html#a127eb06f9722fb25875390cbcfbaec08">OPF_SEARCH_IN_PATH</a> | <a class="code" href="defs_8h.html#aa669554d54e1c74b6654a123f95205ff">OPF_RETURN_REALPATH</a>,
<a name="l00902"></a>00902               filename, O_RDONLY, full_pathname);
<a name="l00903"></a>00903   <span class="keywordflow">if</span> (fd &lt; 0)
<a name="l00904"></a>00904     {
<a name="l00905"></a>00905       *full_pathname = NULL;
<a name="l00906"></a>00906       <span class="keywordflow">return</span> 0;
<a name="l00907"></a>00907     }
<a name="l00908"></a>00908 
<a name="l00909"></a>00909   close (fd);
<a name="l00910"></a>00910   <span class="keywordflow">return</span> 1;
<a name="l00911"></a>00911 }
<a name="l00912"></a>00912 
<a name="l00913"></a>00913 <span class="comment">/* Return non-zero if RULE matches PATH, that is if the rule can be</span>
<a name="l00914"></a>00914 <span class="comment">   applied to PATH.  */</span>
<a name="l00915"></a>00915 
<a name="l00916"></a>00916 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00917"></a><a class="code" href="source_8c.html#ae8dbfecfa2b500f6bcbb15dbe0942933">00917</a> <a class="code" href="source_8c.html#ae8dbfecfa2b500f6bcbb15dbe0942933">substitute_path_rule_matches</a> (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structsubstitute__path__rule.html">substitute_path_rule</a> *rule,
<a name="l00918"></a>00918                               <span class="keyword">const</span> <span class="keywordtype">char</span> *path)
<a name="l00919"></a>00919 {
<a name="l00920"></a>00920   <span class="keyword">const</span> <span class="keywordtype">int</span> from_len = strlen (rule-&gt;<a class="code" href="structsubstitute__path__rule.html#aebfd17c1e5dbdc7f1d2805b9e928b285">from</a>);
<a name="l00921"></a>00921   <span class="keyword">const</span> <span class="keywordtype">int</span> path_len = strlen (path);
<a name="l00922"></a>00922   <span class="keywordtype">char</span> *path_start;
<a name="l00923"></a>00923 
<a name="l00924"></a>00924   <span class="keywordflow">if</span> (path_len &lt; from_len)
<a name="l00925"></a>00925     <span class="keywordflow">return</span> 0;
<a name="l00926"></a>00926 
<a name="l00927"></a>00927   <span class="comment">/* The substitution rules are anchored at the start of the path,</span>
<a name="l00928"></a>00928 <span class="comment">     so the path should start with rule-&gt;from.  There is no filename</span>
<a name="l00929"></a>00929 <span class="comment">     comparison routine, so we need to extract the first FROM_LEN</span>
<a name="l00930"></a>00930 <span class="comment">     characters from PATH first and use that to do the comparison.  */</span>
<a name="l00931"></a>00931 
<a name="l00932"></a>00932   path_start = alloca (from_len + 1);
<a name="l00933"></a>00933   strncpy (path_start, path, from_len);
<a name="l00934"></a>00934   path_start[from_len] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00935"></a>00935 
<a name="l00936"></a>00936   <span class="keywordflow">if</span> (FILENAME_CMP (path_start, rule-&gt;<a class="code" href="structsubstitute__path__rule.html#aebfd17c1e5dbdc7f1d2805b9e928b285">from</a>) != 0)
<a name="l00937"></a>00937     <span class="keywordflow">return</span> 0;
<a name="l00938"></a>00938 
<a name="l00939"></a>00939   <span class="comment">/* Make sure that the region in the path that matches the substitution</span>
<a name="l00940"></a>00940 <span class="comment">     rule is immediately followed by a directory separator (or the end of</span>
<a name="l00941"></a>00941 <span class="comment">     string character).  */</span>
<a name="l00942"></a>00942   
<a name="l00943"></a>00943   <span class="keywordflow">if</span> (path[from_len] != <span class="charliteral">&#39;\0&#39;</span> &amp;&amp; !IS_DIR_SEPARATOR (path[from_len]))
<a name="l00944"></a>00944     <span class="keywordflow">return</span> 0;
<a name="l00945"></a>00945 
<a name="l00946"></a>00946   <span class="keywordflow">return</span> 1;
<a name="l00947"></a>00947 }
<a name="l00948"></a>00948 
<a name="l00949"></a>00949 <span class="comment">/* Find the substitute-path rule that applies to PATH and return it.</span>
<a name="l00950"></a>00950 <span class="comment">   Return NULL if no rule applies.  */</span>
<a name="l00951"></a>00951 
<a name="l00952"></a>00952 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structsubstitute__path__rule.html">substitute_path_rule</a> *
<a name="l00953"></a><a class="code" href="source_8c.html#a649706bea0991cb7f8988d9326feb213">00953</a> <a class="code" href="source_8c.html#a649706bea0991cb7f8988d9326feb213">get_substitute_path_rule</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *path)
<a name="l00954"></a>00954 {
<a name="l00955"></a>00955   <span class="keyword">struct </span><a class="code" href="structsubstitute__path__rule.html">substitute_path_rule</a> *rule = <a class="code" href="source_8c.html#ae472785cbb06089dd2d492e5bd3dd535">substitute_path_rules</a>;
<a name="l00956"></a>00956 
<a name="l00957"></a>00957   <span class="keywordflow">while</span> (rule != NULL &amp;&amp; !<a class="code" href="source_8c.html#ae8dbfecfa2b500f6bcbb15dbe0942933">substitute_path_rule_matches</a> (rule, path))
<a name="l00958"></a>00958     rule = rule-&gt;<a class="code" href="structsubstitute__path__rule.html#a530e032d033496b1a1376ed742964a3b">next</a>;
<a name="l00959"></a>00959 
<a name="l00960"></a>00960   <span class="keywordflow">return</span> rule;
<a name="l00961"></a>00961 }
<a name="l00962"></a>00962 
<a name="l00963"></a>00963 <span class="comment">/* If the user specified a source path substitution rule that applies</span>
<a name="l00964"></a>00964 <span class="comment">   to PATH, then apply it and return the new path.  This new path must</span>
<a name="l00965"></a>00965 <span class="comment">   be deallocated afterwards.</span>
<a name="l00966"></a>00966 <span class="comment">   </span>
<a name="l00967"></a>00967 <span class="comment">   Return NULL if no substitution rule was specified by the user,</span>
<a name="l00968"></a>00968 <span class="comment">   or if no rule applied to the given PATH.  */</span>
<a name="l00969"></a>00969    
<a name="l00970"></a>00970 <span class="keywordtype">char</span> *
<a name="l00971"></a><a class="code" href="source_8h.html#aec288411481bbf19a38b56b2a35eeb47">00971</a> <a class="code" href="source_8c.html#aec288411481bbf19a38b56b2a35eeb47">rewrite_source_path</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *path)
<a name="l00972"></a>00972 {
<a name="l00973"></a>00973   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structsubstitute__path__rule.html">substitute_path_rule</a> *rule = <a class="code" href="source_8c.html#a649706bea0991cb7f8988d9326feb213">get_substitute_path_rule</a> (path);
<a name="l00974"></a>00974   <span class="keywordtype">char</span> *new_path;
<a name="l00975"></a>00975   <span class="keywordtype">int</span> from_len;
<a name="l00976"></a>00976   
<a name="l00977"></a>00977   <span class="keywordflow">if</span> (rule == NULL)
<a name="l00978"></a>00978     <span class="keywordflow">return</span> NULL;
<a name="l00979"></a>00979 
<a name="l00980"></a>00980   from_len = strlen (rule-&gt;<a class="code" href="structsubstitute__path__rule.html#aebfd17c1e5dbdc7f1d2805b9e928b285">from</a>);
<a name="l00981"></a>00981 
<a name="l00982"></a>00982   <span class="comment">/* Compute the rewritten path and return it.  */</span>
<a name="l00983"></a>00983 
<a name="l00984"></a>00984   new_path =
<a name="l00985"></a>00985     (<span class="keywordtype">char</span> *) <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (strlen (path) + 1 + strlen (rule-&gt;<a class="code" href="structsubstitute__path__rule.html#a281aebac622618a3a880138d7f48962a">to</a>) - from_len);
<a name="l00986"></a>00986   strcpy (new_path, rule-&gt;<a class="code" href="structsubstitute__path__rule.html#a281aebac622618a3a880138d7f48962a">to</a>);
<a name="l00987"></a>00987   strcat (new_path, path + from_len);
<a name="l00988"></a>00988 
<a name="l00989"></a>00989   <span class="keywordflow">return</span> new_path;
<a name="l00990"></a>00990 }
<a name="l00991"></a>00991 
<a name="l00992"></a>00992 <span class="keywordtype">int</span>
<a name="l00993"></a><a class="code" href="source_8h.html#ae5539bbba8d780cb825400372c1dd5ea">00993</a> <a class="code" href="source_8c.html#ae5539bbba8d780cb825400372c1dd5ea">find_and_open_source</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *filename,
<a name="l00994"></a>00994                       <span class="keyword">const</span> <span class="keywordtype">char</span> *dirname,
<a name="l00995"></a>00995                       <span class="keywordtype">char</span> **fullname)
<a name="l00996"></a>00996 {
<a name="l00997"></a>00997   <span class="keywordtype">char</span> *path = <a class="code" href="defs_8h.html#a7185b9daf1af3b15efc4d777cc2986b4">source_path</a>;
<a name="l00998"></a>00998   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="windows-nat_8c.html#ade66e4ccafbc33b117610bbc0d85feb0">p</a>;
<a name="l00999"></a>00999   <span class="keywordtype">int</span> result;
<a name="l01000"></a>01000   <span class="keyword">struct </span><a class="code" href="structcleanup.html">cleanup</a> *<a class="code" href="structcleanup.html">cleanup</a>;
<a name="l01001"></a>01001 
<a name="l01002"></a>01002   <span class="comment">/* Quick way out if we already know its full name.  */</span>
<a name="l01003"></a>01003 
<a name="l01004"></a>01004   <span class="keywordflow">if</span> (*fullname)
<a name="l01005"></a>01005     {
<a name="l01006"></a>01006       <span class="comment">/* The user may have requested that source paths be rewritten</span>
<a name="l01007"></a>01007 <span class="comment">         according to substitution rules he provided.  If a substitution</span>
<a name="l01008"></a>01008 <span class="comment">         rule applies to this path, then apply it.  */</span>
<a name="l01009"></a>01009       <span class="keywordtype">char</span> *rewritten_fullname = <a class="code" href="source_8c.html#aec288411481bbf19a38b56b2a35eeb47">rewrite_source_path</a> (*fullname);
<a name="l01010"></a>01010 
<a name="l01011"></a>01011       <span class="keywordflow">if</span> (rewritten_fullname != NULL)
<a name="l01012"></a>01012         {
<a name="l01013"></a>01013           <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (*fullname);
<a name="l01014"></a>01014           *fullname = rewritten_fullname;
<a name="l01015"></a>01015         }
<a name="l01016"></a>01016 
<a name="l01017"></a>01017       result = <a class="code" href="filestuff_8c.html#adf94e72f9c914500c8b9b5d1e66de811">gdb_open_cloexec</a> (*fullname, <a class="code" href="source_8c.html#ac66307ac68fd8e45eff295a2300b35be">OPEN_MODE</a>, 0);
<a name="l01018"></a>01018       <span class="keywordflow">if</span> (result &gt;= 0)
<a name="l01019"></a>01019         {
<a name="l01020"></a>01020           <span class="keywordtype">char</span> *lpath = <a class="code" href="utils_8c.html#a38e450f9b68243416d35f57e37e23e3e">gdb_realpath</a> (*fullname);
<a name="l01021"></a>01021 
<a name="l01022"></a>01022           <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (*fullname);
<a name="l01023"></a>01023           *fullname = lpath;
<a name="l01024"></a>01024           <span class="keywordflow">return</span> result;
<a name="l01025"></a>01025         }
<a name="l01026"></a>01026 
<a name="l01027"></a>01027       <span class="comment">/* Didn&#39;t work -- free old one, try again.  */</span>
<a name="l01028"></a>01028       <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (*fullname);
<a name="l01029"></a>01029       *fullname = NULL;
<a name="l01030"></a>01030     }
<a name="l01031"></a>01031 
<a name="l01032"></a>01032   cleanup = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="cleanups_8c.html#a1ec2a3980c2be1f31f2142103d1f7abf">null_cleanup</a>, NULL);
<a name="l01033"></a>01033 
<a name="l01034"></a>01034   <span class="keywordflow">if</span> (dirname != NULL)
<a name="l01035"></a>01035     {
<a name="l01036"></a>01036       <span class="comment">/* If necessary, rewrite the compilation directory name according</span>
<a name="l01037"></a>01037 <span class="comment">         to the source path substitution rules specified by the user.  */</span>
<a name="l01038"></a>01038 
<a name="l01039"></a>01039       <span class="keywordtype">char</span> *rewritten_dirname = <a class="code" href="source_8c.html#aec288411481bbf19a38b56b2a35eeb47">rewrite_source_path</a> (dirname);
<a name="l01040"></a>01040 
<a name="l01041"></a>01041       <span class="keywordflow">if</span> (rewritten_dirname != NULL)
<a name="l01042"></a>01042         {
<a name="l01043"></a>01043           <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, rewritten_dirname);
<a name="l01044"></a>01044           dirname = rewritten_dirname;
<a name="l01045"></a>01045         }
<a name="l01046"></a>01046       
<a name="l01047"></a>01047       <span class="comment">/* Replace a path entry of $cdir with the compilation directory</span>
<a name="l01048"></a>01048 <span class="comment">         name.  */</span>
<a name="l01049"></a>01049 <span class="preprocessor">#define cdir_len        5</span>
<a name="l01050"></a>01050 <span class="preprocessor"></span>      <span class="comment">/* We cast strstr&#39;s result in case an ANSIhole has made it const,</span>
<a name="l01051"></a>01051 <span class="comment">         which produces a &quot;required warning&quot; when assigned to a nonconst.  */</span>
<a name="l01052"></a>01052       p = (<span class="keywordtype">char</span> *) <a class="code" href="gdb__string_8h.html#a55c8e1e0e5f3578988a2feb0d417ad1c">strstr</a> (<a class="code" href="defs_8h.html#a7185b9daf1af3b15efc4d777cc2986b4">source_path</a>, <span class="stringliteral">&quot;$cdir&quot;</span>);
<a name="l01053"></a>01053       <span class="keywordflow">if</span> (p &amp;&amp; (p == path || p[-1] == DIRNAME_SEPARATOR)
<a name="l01054"></a>01054           &amp;&amp; (p[<a class="code" href="source_8c.html#af334eed7e5dcff8a195e2e7140c13caa">cdir_len</a>] == DIRNAME_SEPARATOR || p[<a class="code" href="source_8c.html#af334eed7e5dcff8a195e2e7140c13caa">cdir_len</a>] == <span class="charliteral">&#39;\0&#39;</span>))
<a name="l01055"></a>01055         {
<a name="l01056"></a>01056           <span class="keywordtype">int</span> <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>;
<a name="l01057"></a>01057 
<a name="l01058"></a>01058           path = (<span class="keywordtype">char</span> *)
<a name="l01059"></a>01059             alloca (strlen (<a class="code" href="defs_8h.html#a7185b9daf1af3b15efc4d777cc2986b4">source_path</a>) + 1 + strlen (dirname) + 1);
<a name="l01060"></a>01060           len = p - <a class="code" href="defs_8h.html#a7185b9daf1af3b15efc4d777cc2986b4">source_path</a>;
<a name="l01061"></a>01061           strncpy (path, source_path, len);     <span class="comment">/* Before $cdir */</span>
<a name="l01062"></a>01062           strcpy (path + len, dirname);         <span class="comment">/* new stuff */</span>
<a name="l01063"></a>01063           strcat (path + len, source_path + len + <a class="code" href="source_8c.html#af334eed7e5dcff8a195e2e7140c13caa">cdir_len</a>);    <span class="comment">/* After</span>
<a name="l01064"></a>01064 <span class="comment">                                                                   $cdir */</span>
<a name="l01065"></a>01065         }
<a name="l01066"></a>01066     }
<a name="l01067"></a>01067 
<a name="l01068"></a>01068   <span class="keywordflow">if</span> (IS_ABSOLUTE_PATH (filename))
<a name="l01069"></a>01069     {
<a name="l01070"></a>01070       <span class="comment">/* If filename is absolute path, try the source path</span>
<a name="l01071"></a>01071 <span class="comment">         substitution on it.  */</span>
<a name="l01072"></a>01072       <span class="keywordtype">char</span> *rewritten_filename = <a class="code" href="source_8c.html#aec288411481bbf19a38b56b2a35eeb47">rewrite_source_path</a> (filename);
<a name="l01073"></a>01073 
<a name="l01074"></a>01074       <span class="keywordflow">if</span> (rewritten_filename != NULL)
<a name="l01075"></a>01075         {
<a name="l01076"></a>01076           <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, rewritten_filename);
<a name="l01077"></a>01077           filename = rewritten_filename;
<a name="l01078"></a>01078         }
<a name="l01079"></a>01079     }
<a name="l01080"></a>01080 
<a name="l01081"></a>01081   result = <a class="code" href="defs_8h.html#ad1c5ec0f63e79e6293a00ca1a30de767">openp</a> (path, <a class="code" href="defs_8h.html#a127eb06f9722fb25875390cbcfbaec08">OPF_SEARCH_IN_PATH</a> | <a class="code" href="defs_8h.html#aa669554d54e1c74b6654a123f95205ff">OPF_RETURN_REALPATH</a>, filename,
<a name="l01082"></a>01082                   <a class="code" href="source_8c.html#ac66307ac68fd8e45eff295a2300b35be">OPEN_MODE</a>, fullname);
<a name="l01083"></a>01083   <span class="keywordflow">if</span> (result &lt; 0)
<a name="l01084"></a>01084     {
<a name="l01085"></a>01085       <span class="comment">/* Didn&#39;t work.  Try using just the basename.  */</span>
<a name="l01086"></a>01086       p = lbasename (filename);
<a name="l01087"></a>01087       <span class="keywordflow">if</span> (p != filename)
<a name="l01088"></a>01088         result = <a class="code" href="defs_8h.html#ad1c5ec0f63e79e6293a00ca1a30de767">openp</a> (path, <a class="code" href="defs_8h.html#a127eb06f9722fb25875390cbcfbaec08">OPF_SEARCH_IN_PATH</a> | <a class="code" href="defs_8h.html#aa669554d54e1c74b6654a123f95205ff">OPF_RETURN_REALPATH</a>, p,
<a name="l01089"></a>01089                         <a class="code" href="source_8c.html#ac66307ac68fd8e45eff295a2300b35be">OPEN_MODE</a>, fullname);
<a name="l01090"></a>01090     }
<a name="l01091"></a>01091 
<a name="l01092"></a>01092   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup);
<a name="l01093"></a>01093   <span class="keywordflow">return</span> result;
<a name="l01094"></a>01094 }
<a name="l01095"></a>01095 
<a name="l01096"></a>01096 <span class="comment">/* Open a source file given a symtab S.  Returns a file descriptor or</span>
<a name="l01097"></a>01097 <span class="comment">   negative number for error.  </span>
<a name="l01098"></a>01098 <span class="comment">   </span>
<a name="l01099"></a>01099 <span class="comment">   This function is a convience function to find_and_open_source.  */</span>
<a name="l01100"></a>01100 
<a name="l01101"></a>01101 <span class="keywordtype">int</span>
<a name="l01102"></a><a class="code" href="source_8h.html#a676371f58055b0d35762ed9ce50d392f">01102</a> <a class="code" href="source_8c.html#a676371f58055b0d35762ed9ce50d392f">open_source_file</a> (<span class="keyword">struct</span> <a class="code" href="structsymtab.html">symtab</a> *s)
<a name="l01103"></a>01103 {
<a name="l01104"></a>01104   <span class="keywordflow">if</span> (!s)
<a name="l01105"></a>01105     <span class="keywordflow">return</span> -1;
<a name="l01106"></a>01106 
<a name="l01107"></a>01107   <span class="keywordflow">return</span> <a class="code" href="source_8c.html#ae5539bbba8d780cb825400372c1dd5ea">find_and_open_source</a> (s-&gt;<a class="code" href="structsymtab.html#acd8b6d6ddeca3b61953b0c736e13c35a">filename</a>, s-&gt;<a class="code" href="structsymtab.html#a3ced004986e8eb900b962fdc5a3ec392">dirname</a>, &amp;s-&gt;<a class="code" href="structsymtab.html#a69ab8f02c05080d73ef701cf239e9c5e">fullname</a>);
<a name="l01108"></a>01108 }
<a name="l01109"></a>01109 
<a name="l01110"></a>01110 <span class="comment">/* Finds the fullname that a symtab represents.</span>
<a name="l01111"></a>01111 <span class="comment"></span>
<a name="l01112"></a>01112 <span class="comment">   This functions finds the fullname and saves it in s-&gt;fullname.</span>
<a name="l01113"></a>01113 <span class="comment">   It will also return the value.</span>
<a name="l01114"></a>01114 <span class="comment"></span>
<a name="l01115"></a>01115 <span class="comment">   If this function fails to find the file that this symtab represents,</span>
<a name="l01116"></a>01116 <span class="comment">   the expected fullname is used.  Therefore the files does not have to</span>
<a name="l01117"></a>01117 <span class="comment">   exist.  */</span>
<a name="l01118"></a>01118 
<a name="l01119"></a>01119 <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l01120"></a><a class="code" href="source_8h.html#aa78177718e9d6c01595600975e8254df">01120</a> <a class="code" href="source_8c.html#aa78177718e9d6c01595600975e8254df">symtab_to_fullname</a> (<span class="keyword">struct</span> <a class="code" href="structsymtab.html">symtab</a> *s)
<a name="l01121"></a>01121 {
<a name="l01122"></a>01122   <span class="comment">/* Use cached copy if we have it.</span>
<a name="l01123"></a>01123 <span class="comment">     We rely on forget_cached_source_info being called appropriately</span>
<a name="l01124"></a>01124 <span class="comment">     to handle cases like the file being moved.  */</span>
<a name="l01125"></a>01125   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structsymtab.html#a69ab8f02c05080d73ef701cf239e9c5e">fullname</a> == NULL)
<a name="l01126"></a>01126     {
<a name="l01127"></a>01127       <span class="keywordtype">int</span> fd = <a class="code" href="source_8c.html#ae5539bbba8d780cb825400372c1dd5ea">find_and_open_source</a> (s-&gt;<a class="code" href="structsymtab.html#acd8b6d6ddeca3b61953b0c736e13c35a">filename</a>, s-&gt;<a class="code" href="structsymtab.html#a3ced004986e8eb900b962fdc5a3ec392">dirname</a>, &amp;s-&gt;<a class="code" href="structsymtab.html#a69ab8f02c05080d73ef701cf239e9c5e">fullname</a>);
<a name="l01128"></a>01128 
<a name="l01129"></a>01129       <span class="keywordflow">if</span> (fd &gt;= 0)
<a name="l01130"></a>01130         close (fd);
<a name="l01131"></a>01131       <span class="keywordflow">else</span>
<a name="l01132"></a>01132         {
<a name="l01133"></a>01133           <span class="keywordtype">char</span> *fullname;
<a name="l01134"></a>01134           <span class="keyword">struct </span><a class="code" href="structcleanup.html">cleanup</a> *back_to;
<a name="l01135"></a>01135 
<a name="l01136"></a>01136           <span class="comment">/* rewrite_source_path would be applied by find_and_open_source, we</span>
<a name="l01137"></a>01137 <span class="comment">             should report the pathname where GDB tried to find the file.  */</span>
<a name="l01138"></a>01138 
<a name="l01139"></a>01139           <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structsymtab.html#a3ced004986e8eb900b962fdc5a3ec392">dirname</a> == NULL || IS_ABSOLUTE_PATH (s-&gt;<a class="code" href="structsymtab.html#acd8b6d6ddeca3b61953b0c736e13c35a">filename</a>))
<a name="l01140"></a>01140             fullname = xstrdup (s-&gt;<a class="code" href="structsymtab.html#acd8b6d6ddeca3b61953b0c736e13c35a">filename</a>);
<a name="l01141"></a>01141           <span class="keywordflow">else</span>
<a name="l01142"></a>01142             fullname = concat (s-&gt;<a class="code" href="structsymtab.html#a3ced004986e8eb900b962fdc5a3ec392">dirname</a>, SLASH_STRING, s-&gt;<a class="code" href="structsymtab.html#acd8b6d6ddeca3b61953b0c736e13c35a">filename</a>, NULL);
<a name="l01143"></a>01143 
<a name="l01144"></a>01144           back_to = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, fullname);
<a name="l01145"></a>01145           s-&gt;<a class="code" href="structsymtab.html#a69ab8f02c05080d73ef701cf239e9c5e">fullname</a> = <a class="code" href="source_8c.html#aec288411481bbf19a38b56b2a35eeb47">rewrite_source_path</a> (fullname);
<a name="l01146"></a>01146           <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structsymtab.html#a69ab8f02c05080d73ef701cf239e9c5e">fullname</a> == NULL)
<a name="l01147"></a>01147             s-&gt;<a class="code" href="structsymtab.html#a69ab8f02c05080d73ef701cf239e9c5e">fullname</a> = xstrdup (fullname);
<a name="l01148"></a>01148           <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (back_to);
<a name="l01149"></a>01149         }
<a name="l01150"></a>01150     } 
<a name="l01151"></a>01151 
<a name="l01152"></a>01152   <span class="keywordflow">return</span> s-&gt;<a class="code" href="structsymtab.html#a69ab8f02c05080d73ef701cf239e9c5e">fullname</a>;
<a name="l01153"></a>01153 }
<a name="l01154"></a>01154 
<a name="l01155"></a>01155 <span class="comment">/* See commentary in source.h.  */</span>
<a name="l01156"></a>01156 
<a name="l01157"></a>01157 <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l01158"></a><a class="code" href="source_8h.html#ae251616cab166301d5fed95cbdd31232">01158</a> <a class="code" href="source_8c.html#ae251616cab166301d5fed95cbdd31232">symtab_to_filename_for_display</a> (<span class="keyword">struct</span> <a class="code" href="structsymtab.html">symtab</a> *<a class="code" href="structsymtab.html">symtab</a>)
<a name="l01159"></a>01159 {
<a name="l01160"></a>01160   <span class="keywordflow">if</span> (<a class="code" href="source_8c.html#aa5ad22f3ba8d797f3bb32696f4e53ba3">filename_display_string</a> == <a class="code" href="source_8c.html#a68a9e5cda68cbbba189fac99a228d4d3">filename_display_basename</a>)
<a name="l01161"></a>01161     <span class="keywordflow">return</span> lbasename (symtab-&gt;<a class="code" href="structsymtab.html#acd8b6d6ddeca3b61953b0c736e13c35a">filename</a>);
<a name="l01162"></a>01162   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="source_8c.html#aa5ad22f3ba8d797f3bb32696f4e53ba3">filename_display_string</a> == <a class="code" href="source_8c.html#a597b27097bdf3dec21f5c9762c5eb1d3">filename_display_absolute</a>)
<a name="l01163"></a>01163     <span class="keywordflow">return</span> <a class="code" href="source_8c.html#aa78177718e9d6c01595600975e8254df">symtab_to_fullname</a> (symtab);
<a name="l01164"></a>01164   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="source_8c.html#aa5ad22f3ba8d797f3bb32696f4e53ba3">filename_display_string</a> == <a class="code" href="source_8c.html#aeadfce22f1cb7e1fb5f7ac226a56cb4d">filename_display_relative</a>)
<a name="l01165"></a>01165     <span class="keywordflow">return</span> symtab-&gt;<a class="code" href="structsymtab.html#acd8b6d6ddeca3b61953b0c736e13c35a">filename</a>;
<a name="l01166"></a>01166   <span class="keywordflow">else</span>
<a name="l01167"></a>01167     <a class="code" href="common-utils_8h.html#aa14285d9d3d4171016ef9cf09447e8bb">internal_error</a> (__FILE__, __LINE__, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;invalid filename_display_string&quot;</span>));
<a name="l01168"></a>01168 }
<a name="l01169"></a>01169 
<a name="l01170"></a>01170 <span class="comment">/* Create and initialize the table S-&gt;line_charpos that records</span>
<a name="l01171"></a>01171 <span class="comment">   the positions of the lines in the source file, which is assumed</span>
<a name="l01172"></a>01172 <span class="comment">   to be open on descriptor DESC.</span>
<a name="l01173"></a>01173 <span class="comment">   All set S-&gt;nlines to the number of such lines.  */</span>
<a name="l01174"></a>01174 
<a name="l01175"></a>01175 <span class="keywordtype">void</span>
<a name="l01176"></a><a class="code" href="source_8h.html#aac379479cd0ad4fcf244cc7ff659e7c6">01176</a> <a class="code" href="source_8c.html#aac379479cd0ad4fcf244cc7ff659e7c6">find_source_lines</a> (<span class="keyword">struct</span> <a class="code" href="structsymtab.html">symtab</a> *s, <span class="keywordtype">int</span> desc)
<a name="l01177"></a>01177 {
<a name="l01178"></a>01178   <span class="keyword">struct </span>stat st;
<a name="l01179"></a>01179   <span class="keywordtype">char</span> *data, *<a class="code" href="windows-nat_8c.html#ade66e4ccafbc33b117610bbc0d85feb0">p</a>, *end;
<a name="l01180"></a>01180   <span class="keywordtype">int</span> nlines = 0;
<a name="l01181"></a>01181   <span class="keywordtype">int</span> lines_allocated = 1000;
<a name="l01182"></a>01182   <span class="keywordtype">int</span> *line_charpos;
<a name="l01183"></a>01183   <span class="keywordtype">long</span> mtime = 0;
<a name="l01184"></a>01184   <span class="keywordtype">int</span> <a class="code" href="go32-nat_8c.html#a854352f53b148adc24983a58a1866d66">size</a>;
<a name="l01185"></a>01185 
<a name="l01186"></a>01186   <a class="code" href="gdb__assert_8h.html#aeb007d3e990858c7ef8e40a7e512c1ff">gdb_assert</a> (s);
<a name="l01187"></a>01187   line_charpos = (<span class="keywordtype">int</span> *) <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (lines_allocated * <span class="keyword">sizeof</span> (<span class="keywordtype">int</span>));
<a name="l01188"></a>01188   <span class="keywordflow">if</span> (fstat (desc, &amp;st) &lt; 0)
<a name="l01189"></a>01189     <a class="code" href="utils_8c.html#a14801ceb45147833b8ce111c89ea0d5f">perror_with_name</a> (<a class="code" href="source_8c.html#ae251616cab166301d5fed95cbdd31232">symtab_to_filename_for_display</a> (s));
<a name="l01190"></a>01190 
<a name="l01191"></a>01191   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structsymtab.html#a5fbe801333fb00c20190a6193b708be0">objfile</a> &amp;&amp; s-&gt;<a class="code" href="structsymtab.html#a5fbe801333fb00c20190a6193b708be0">objfile</a>-&gt;<a class="code" href="structobjfile.html#a0b967b64f365ef71d618700b7308dcde">obfd</a>)
<a name="l01192"></a>01192     mtime = s-&gt;<a class="code" href="structsymtab.html#a5fbe801333fb00c20190a6193b708be0">objfile</a>-&gt;<a class="code" href="structobjfile.html#af985d4c90ce61817676ec27ab23104b7">mtime</a>;
<a name="l01193"></a>01193   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="exec_8h.html#ac2e2e739fca42163e235e8521b9fbbab">exec_bfd</a>)
<a name="l01194"></a>01194     mtime = <a class="code" href="exec_8h.html#a228f113e02649dffe72bc376a57a7858">exec_bfd_mtime</a>;
<a name="l01195"></a>01195 
<a name="l01196"></a>01196   <span class="keywordflow">if</span> (mtime &amp;&amp; mtime &lt; st.st_mtime)
<a name="l01197"></a>01197     <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Source file is more recent than executable.&quot;</span>));
<a name="l01198"></a>01198 
<a name="l01199"></a>01199   {
<a name="l01200"></a>01200     <span class="keyword">struct </span><a class="code" href="structcleanup.html">cleanup</a> *old_cleanups;
<a name="l01201"></a>01201 
<a name="l01202"></a>01202     <span class="comment">/* st_size might be a large type, but we only support source files whose </span>
<a name="l01203"></a>01203 <span class="comment">       size fits in an int.  */</span>
<a name="l01204"></a>01204     size = (<a class="code" href="command_8h.html#a74f207b5aa4ba51c3a2ad59b219a423b">int</a>) st.st_size;
<a name="l01205"></a>01205 
<a name="l01206"></a>01206     <span class="comment">/* Use malloc, not alloca, because this may be pretty large, and we may</span>
<a name="l01207"></a>01207 <span class="comment">       run into various kinds of limits on stack size.  */</span>
<a name="l01208"></a>01208     data = (<span class="keywordtype">char</span> *) <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (size);
<a name="l01209"></a>01209     old_cleanups = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, data);
<a name="l01210"></a>01210 
<a name="l01211"></a>01211     <span class="comment">/* Reassign `size&#39; to result of read for systems where \r\n -&gt; \n.  */</span>
<a name="l01212"></a>01212     size = <a class="code" href="utils_8c.html#aeb74e621818b6be869115c59657f4c1e">myread</a> (desc, data, size);
<a name="l01213"></a>01213     <span class="keywordflow">if</span> (size &lt; 0)
<a name="l01214"></a>01214       <a class="code" href="utils_8c.html#a14801ceb45147833b8ce111c89ea0d5f">perror_with_name</a> (<a class="code" href="source_8c.html#ae251616cab166301d5fed95cbdd31232">symtab_to_filename_for_display</a> (s));
<a name="l01215"></a>01215     end = data + <a class="code" href="go32-nat_8c.html#a854352f53b148adc24983a58a1866d66">size</a>;
<a name="l01216"></a>01216     p = data;
<a name="l01217"></a>01217     line_charpos[0] = 0;
<a name="l01218"></a>01218     nlines = 1;
<a name="l01219"></a>01219     <span class="keywordflow">while</span> (p != end)
<a name="l01220"></a>01220       {
<a name="l01221"></a>01221         <span class="keywordflow">if</span> (*p++ == <span class="charliteral">&#39;\n&#39;</span>
<a name="l01222"></a>01222         <span class="comment">/* A newline at the end does not start a new line.  */</span>
<a name="l01223"></a>01223             &amp;&amp; p != end)
<a name="l01224"></a>01224           {
<a name="l01225"></a>01225             <span class="keywordflow">if</span> (nlines == lines_allocated)
<a name="l01226"></a>01226               {
<a name="l01227"></a>01227                 lines_allocated *= 2;
<a name="l01228"></a>01228                 line_charpos =
<a name="l01229"></a>01229                   (<span class="keywordtype">int</span> *) <a class="code" href="common-utils_8c.html#af404b7244f442ce8c3069f31af566eae">xrealloc</a> ((<span class="keywordtype">char</span> *) line_charpos,
<a name="l01230"></a>01230                                     <span class="keyword">sizeof</span> (<a class="code" href="command_8h.html#a74f207b5aa4ba51c3a2ad59b219a423b">int</a>) * lines_allocated);
<a name="l01231"></a>01231               }
<a name="l01232"></a>01232             line_charpos[nlines++] = p - data;
<a name="l01233"></a>01233           }
<a name="l01234"></a>01234       }
<a name="l01235"></a>01235     <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_cleanups);
<a name="l01236"></a>01236   }
<a name="l01237"></a>01237 
<a name="l01238"></a>01238   s-&gt;<a class="code" href="structsymtab.html#a36dda01fdbd5e4363ce05b2a0a8422bf">nlines</a> = nlines;
<a name="l01239"></a>01239   s-&gt;<a class="code" href="structsymtab.html#af4d69f09a5ce43cf6f6c450d00b38475">line_charpos</a> =
<a name="l01240"></a>01240     (<span class="keywordtype">int</span> *) <a class="code" href="common-utils_8c.html#af404b7244f442ce8c3069f31af566eae">xrealloc</a> ((<span class="keywordtype">char</span> *) line_charpos, nlines * <span class="keyword">sizeof</span> (<a class="code" href="command_8h.html#a74f207b5aa4ba51c3a2ad59b219a423b">int</a>));
<a name="l01241"></a>01241 
<a name="l01242"></a>01242 }
<a name="l01243"></a>01243 
<a name="l01244"></a>01244 
<a name="l01245"></a>01245 
<a name="l01246"></a>01246 <span class="comment">/* Get full pathname and line number positions for a symtab.</span>
<a name="l01247"></a>01247 <span class="comment">   Return nonzero if line numbers may have changed.</span>
<a name="l01248"></a>01248 <span class="comment">   Set *FULLNAME to actual name of the file as found by `openp&#39;,</span>
<a name="l01249"></a>01249 <span class="comment">   or to 0 if the file is not found.  */</span>
<a name="l01250"></a>01250 
<a name="l01251"></a>01251 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01252"></a><a class="code" href="source_8c.html#a6cd21212028ffdb5e91ee360578884f4">01252</a> <a class="code" href="source_8c.html#a6cd21212028ffdb5e91ee360578884f4">get_filename_and_charpos</a> (<span class="keyword">struct</span> <a class="code" href="structsymtab.html">symtab</a> *s, <span class="keywordtype">char</span> **fullname)
<a name="l01253"></a>01253 {
<a name="l01254"></a>01254   <span class="keywordtype">int</span> desc, linenums_changed = 0;
<a name="l01255"></a>01255   <span class="keyword">struct </span><a class="code" href="structcleanup.html">cleanup</a> *cleanups;
<a name="l01256"></a>01256 
<a name="l01257"></a>01257   desc = <a class="code" href="source_8c.html#a676371f58055b0d35762ed9ce50d392f">open_source_file</a> (s);
<a name="l01258"></a>01258   <span class="keywordflow">if</span> (desc &lt; 0)
<a name="l01259"></a>01259     {
<a name="l01260"></a>01260       <span class="keywordflow">if</span> (fullname)
<a name="l01261"></a>01261         *fullname = NULL;
<a name="l01262"></a>01262       <span class="keywordflow">return</span> 0;
<a name="l01263"></a>01263     }
<a name="l01264"></a>01264   cleanups = <a class="code" href="utils_8c.html#ae1c81b8331e815cc346382bc13e20095">make_cleanup_close</a> (desc);
<a name="l01265"></a>01265   <span class="keywordflow">if</span> (fullname)
<a name="l01266"></a>01266     *fullname = s-&gt;<a class="code" href="structsymtab.html#a69ab8f02c05080d73ef701cf239e9c5e">fullname</a>;
<a name="l01267"></a>01267   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structsymtab.html#af4d69f09a5ce43cf6f6c450d00b38475">line_charpos</a> == 0)
<a name="l01268"></a>01268     linenums_changed = 1;
<a name="l01269"></a>01269   <span class="keywordflow">if</span> (linenums_changed)
<a name="l01270"></a>01270     <a class="code" href="source_8c.html#aac379479cd0ad4fcf244cc7ff659e7c6">find_source_lines</a> (s, desc);
<a name="l01271"></a>01271   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanups);
<a name="l01272"></a>01272   <span class="keywordflow">return</span> linenums_changed;
<a name="l01273"></a>01273 }
<a name="l01274"></a>01274 
<a name="l01275"></a>01275 <span class="comment">/* Print text describing the full name of the source file S</span>
<a name="l01276"></a>01276 <span class="comment">   and the line number LINE and its corresponding character position.</span>
<a name="l01277"></a>01277 <span class="comment">   The text starts with two Ctrl-z so that the Emacs-GDB interface</span>
<a name="l01278"></a>01278 <span class="comment">   can easily find it.</span>
<a name="l01279"></a>01279 <span class="comment"></span>
<a name="l01280"></a>01280 <span class="comment">   MID_STATEMENT is nonzero if the PC is not at the beginning of that line.</span>
<a name="l01281"></a>01281 <span class="comment"></span>
<a name="l01282"></a>01282 <span class="comment">   Return 1 if successful, 0 if could not find the file.  */</span>
<a name="l01283"></a>01283 
<a name="l01284"></a>01284 <span class="keywordtype">int</span>
<a name="l01285"></a><a class="code" href="symtab_8h.html#a9ef7c007976927b33456b0ff6f4f1608">01285</a> <a class="code" href="source_8c.html#a45ff3c684f9337c457f019421d14dacb">identify_source_line</a> (<span class="keyword">struct</span> <a class="code" href="structsymtab.html">symtab</a> *s, <span class="keywordtype">int</span> <a class="code" href="symtab_8h.html#a41ebd28ef1d7c6ade45642cb6acc1039">line</a>, <span class="keywordtype">int</span> mid_statement,
<a name="l01286"></a>01286                       <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> pc)
<a name="l01287"></a>01287 {
<a name="l01288"></a>01288   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structsymtab.html#af4d69f09a5ce43cf6f6c450d00b38475">line_charpos</a> == 0)
<a name="l01289"></a>01289     <a class="code" href="source_8c.html#a6cd21212028ffdb5e91ee360578884f4">get_filename_and_charpos</a> (s, (<span class="keywordtype">char</span> **) NULL);
<a name="l01290"></a>01290   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structsymtab.html#a69ab8f02c05080d73ef701cf239e9c5e">fullname</a> == 0)
<a name="l01291"></a>01291     <span class="keywordflow">return</span> 0;
<a name="l01292"></a>01292   <span class="keywordflow">if</span> (line &gt; s-&gt;<a class="code" href="structsymtab.html#a36dda01fdbd5e4363ce05b2a0a8422bf">nlines</a>)
<a name="l01293"></a>01293     <span class="comment">/* Don&#39;t index off the end of the line_charpos array.  */</span>
<a name="l01294"></a>01294     <span class="keywordflow">return</span> 0;
<a name="l01295"></a>01295   <a class="code" href="annotate_8c.html#a9c650d7def08d99971b1df6df44be855">annotate_source</a> (s-&gt;<a class="code" href="structsymtab.html#a69ab8f02c05080d73ef701cf239e9c5e">fullname</a>, line, s-&gt;<a class="code" href="structsymtab.html#af4d69f09a5ce43cf6f6c450d00b38475">line_charpos</a>[line - 1],
<a name="l01296"></a>01296                    mid_statement, <a class="code" href="objfiles_8c.html#a1c7101234ac2edc601fa465e48bc3463">get_objfile_arch</a> (s-&gt;<a class="code" href="structsymtab.html#a5fbe801333fb00c20190a6193b708be0">objfile</a>), pc);
<a name="l01297"></a>01297 
<a name="l01298"></a>01298   <a class="code" href="source_8c.html#a0ca95f705d9a22363e95c86a27563ea5">current_source_line</a> = <a class="code" href="symtab_8h.html#a41ebd28ef1d7c6ade45642cb6acc1039">line</a>;
<a name="l01299"></a>01299   <a class="code" href="source_8c.html#a64c047ee4e91dcae470c4a1594ee0c58">first_line_listed</a> = <a class="code" href="symtab_8h.html#a41ebd28ef1d7c6ade45642cb6acc1039">line</a>;
<a name="l01300"></a>01300   <a class="code" href="source_8c.html#a55fc4c2f4fc50973546ef051f77fae59">last_line_listed</a> = <a class="code" href="symtab_8h.html#a41ebd28ef1d7c6ade45642cb6acc1039">line</a>;
<a name="l01301"></a>01301   current_source_symtab = s;
<a name="l01302"></a>01302   <span class="keywordflow">return</span> 1;
<a name="l01303"></a>01303 }
<a name="l01304"></a>01304 
<a name="l01305"></a>01305 
<a name="l01306"></a>01306 <span class="comment">/* Print source lines from the file of symtab S,</span>
<a name="l01307"></a>01307 <span class="comment">   starting with line number LINE and stopping before line number STOPLINE.  */</span>
<a name="l01308"></a>01308 
<a name="l01309"></a>01309 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01310"></a><a class="code" href="source_8c.html#a75c1c948f7496799b19c67257d7a3d9d">01310</a> <a class="code" href="source_8c.html#a75c1c948f7496799b19c67257d7a3d9d">print_source_lines_base</a> (<span class="keyword">struct</span> <a class="code" href="structsymtab.html">symtab</a> *s, <span class="keywordtype">int</span> <a class="code" href="symtab_8h.html#a41ebd28ef1d7c6ade45642cb6acc1039">line</a>, <span class="keywordtype">int</span> stopline,
<a name="l01311"></a>01311                          <span class="keyword">enum</span> <a class="code" href="symtab_8h.html#a4fc2e9b18d837cb9db4d29ab58d0a784">print_source_lines_flags</a> <a class="code" href="solib-som_8c.html#a555096840020c318e34b205419e98cca">flags</a>)
<a name="l01312"></a>01312 {
<a name="l01313"></a>01313   <span class="keywordtype">int</span> c;
<a name="l01314"></a>01314   <span class="keywordtype">int</span> desc;
<a name="l01315"></a>01315   <span class="keywordtype">int</span> noprint = 0;
<a name="l01316"></a>01316   FILE *stream;
<a name="l01317"></a>01317   <span class="keywordtype">int</span> nlines = stopline - <a class="code" href="symtab_8h.html#a41ebd28ef1d7c6ade45642cb6acc1039">line</a>;
<a name="l01318"></a>01318   <span class="keyword">struct </span><a class="code" href="structcleanup.html">cleanup</a> *<a class="code" href="structcleanup.html">cleanup</a>;
<a name="l01319"></a>01319   <span class="keyword">struct </span><a class="code" href="structui__out.html">ui_out</a> *uiout = <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>;
<a name="l01320"></a>01320 
<a name="l01321"></a>01321   <span class="comment">/* Regardless of whether we can open the file, set current_source_symtab.  */</span>
<a name="l01322"></a>01322   current_source_symtab = s;
<a name="l01323"></a>01323   <a class="code" href="source_8c.html#a0ca95f705d9a22363e95c86a27563ea5">current_source_line</a> = <a class="code" href="symtab_8h.html#a41ebd28ef1d7c6ade45642cb6acc1039">line</a>;
<a name="l01324"></a>01324   <a class="code" href="source_8c.html#a64c047ee4e91dcae470c4a1594ee0c58">first_line_listed</a> = <a class="code" href="symtab_8h.html#a41ebd28ef1d7c6ade45642cb6acc1039">line</a>;
<a name="l01325"></a>01325 
<a name="l01326"></a>01326   <span class="comment">/* If printing of source lines is disabled, just print file and line</span>
<a name="l01327"></a>01327 <span class="comment">     number.  */</span>
<a name="l01328"></a>01328   <span class="keywordflow">if</span> (<a class="code" href="ui-out_8c.html#ab64d996d812713192a822e17d349fabb">ui_out_test_flags</a> (uiout, <a class="code" href="ui-out_8h.html#a2f43871f8b82b56474da686c0daa2ca0aed55a4315ede07121e1a408b825cc80f">ui_source_list</a>))
<a name="l01329"></a>01329     {
<a name="l01330"></a>01330       <span class="comment">/* Only prints &quot;No such file or directory&quot; once.  */</span>
<a name="l01331"></a>01331       <span class="keywordflow">if</span> ((s != last_source_visited) || (!<a class="code" href="source_8c.html#a572e631a2564d0a9bf82dff62abf6c5b">last_source_error</a>))
<a name="l01332"></a>01332         {
<a name="l01333"></a>01333           last_source_visited = s;
<a name="l01334"></a>01334           desc = <a class="code" href="source_8c.html#a676371f58055b0d35762ed9ce50d392f">open_source_file</a> (s);
<a name="l01335"></a>01335         }
<a name="l01336"></a>01336       <span class="keywordflow">else</span>
<a name="l01337"></a>01337         {
<a name="l01338"></a>01338           desc = <a class="code" href="source_8c.html#a572e631a2564d0a9bf82dff62abf6c5b">last_source_error</a>;
<a name="l01339"></a>01339           flags |= <a class="code" href="symtab_8h.html#a4fc2e9b18d837cb9db4d29ab58d0a784a58f00ea80f97ce99816439a60ee81a12">PRINT_SOURCE_LINES_NOERROR</a>;
<a name="l01340"></a>01340         }
<a name="l01341"></a>01341     }
<a name="l01342"></a>01342   <span class="keywordflow">else</span>
<a name="l01343"></a>01343     {
<a name="l01344"></a>01344       desc = <a class="code" href="source_8c.html#a572e631a2564d0a9bf82dff62abf6c5b">last_source_error</a>;
<a name="l01345"></a>01345           flags |= <a class="code" href="symtab_8h.html#a4fc2e9b18d837cb9db4d29ab58d0a784a58f00ea80f97ce99816439a60ee81a12">PRINT_SOURCE_LINES_NOERROR</a>;
<a name="l01346"></a>01346       noprint = 1;
<a name="l01347"></a>01347     }
<a name="l01348"></a>01348 
<a name="l01349"></a>01349   <span class="keywordflow">if</span> (desc &lt; 0 || noprint)
<a name="l01350"></a>01350     {
<a name="l01351"></a>01351       <a class="code" href="source_8c.html#a572e631a2564d0a9bf82dff62abf6c5b">last_source_error</a> = desc;
<a name="l01352"></a>01352 
<a name="l01353"></a>01353       <span class="keywordflow">if</span> (!(flags &amp; <a class="code" href="symtab_8h.html#a4fc2e9b18d837cb9db4d29ab58d0a784a58f00ea80f97ce99816439a60ee81a12">PRINT_SOURCE_LINES_NOERROR</a>))
<a name="l01354"></a>01354         {
<a name="l01355"></a>01355           <span class="keyword">const</span> <span class="keywordtype">char</span> *filename = <a class="code" href="source_8c.html#ae251616cab166301d5fed95cbdd31232">symtab_to_filename_for_display</a> (s);
<a name="l01356"></a>01356           <span class="keywordtype">int</span> <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a> = strlen (filename) + 100;
<a name="l01357"></a>01357           <span class="keywordtype">char</span> *<a class="code" href="aarch64-tdep_8c.html#acc128f98d9ceca227038c771308eff39">name</a> = alloca (len);
<a name="l01358"></a>01358 
<a name="l01359"></a>01359           <a class="code" href="common-utils_8c.html#ad9940337ec98983dae9951c947879fc8">xsnprintf</a> (name, len, <span class="stringliteral">&quot;%d\t%s&quot;</span>, line, filename);
<a name="l01360"></a>01360           <a class="code" href="utils_8c.html#a539ee53fd58602e5967f3852c6689792">print_sys_errmsg</a> (name, errno);
<a name="l01361"></a>01361         }
<a name="l01362"></a>01362       <span class="keywordflow">else</span>
<a name="l01363"></a>01363         {
<a name="l01364"></a>01364           <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, <span class="stringliteral">&quot;line&quot;</span>, line);
<a name="l01365"></a>01365           <a class="code" href="ui-out_8c.html#a6a23596295dce32ba2a5bd2fd2d309f8">ui_out_text</a> (uiout, <span class="stringliteral">&quot;\tin &quot;</span>);
<a name="l01366"></a>01366 
<a name="l01367"></a>01367           <span class="comment">/* CLI expects only the &quot;file&quot; field.  TUI expects only the</span>
<a name="l01368"></a>01368 <span class="comment">             &quot;fullname&quot; field (and TUI does break if &quot;file&quot; is printed).</span>
<a name="l01369"></a>01369 <span class="comment">             MI expects both fields.  ui_source_list is set only for CLI,</span>
<a name="l01370"></a>01370 <span class="comment">             not for TUI.  */</span>
<a name="l01371"></a>01371           <span class="keywordflow">if</span> (<a class="code" href="ui-out_8c.html#a473db54efcfbc60feeb5a4f54f27af46">ui_out_is_mi_like_p</a> (uiout)
<a name="l01372"></a>01372               || <a class="code" href="ui-out_8c.html#ab64d996d812713192a822e17d349fabb">ui_out_test_flags</a> (uiout, <a class="code" href="ui-out_8h.html#a2f43871f8b82b56474da686c0daa2ca0aed55a4315ede07121e1a408b825cc80f">ui_source_list</a>))
<a name="l01373"></a>01373             <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;file&quot;</span>,
<a name="l01374"></a>01374                                  <a class="code" href="source_8c.html#ae251616cab166301d5fed95cbdd31232">symtab_to_filename_for_display</a> (s));
<a name="l01375"></a>01375           <span class="keywordflow">if</span> (<a class="code" href="ui-out_8c.html#a473db54efcfbc60feeb5a4f54f27af46">ui_out_is_mi_like_p</a> (uiout)
<a name="l01376"></a>01376               || !<a class="code" href="ui-out_8c.html#ab64d996d812713192a822e17d349fabb">ui_out_test_flags</a> (uiout, <a class="code" href="ui-out_8h.html#a2f43871f8b82b56474da686c0daa2ca0aed55a4315ede07121e1a408b825cc80f">ui_source_list</a>))
<a name="l01377"></a>01377             {
<a name="l01378"></a>01378               <span class="keyword">const</span> <span class="keywordtype">char</span> *s_fullname = <a class="code" href="source_8c.html#aa78177718e9d6c01595600975e8254df">symtab_to_fullname</a> (s);
<a name="l01379"></a>01379               <span class="keywordtype">char</span> *local_fullname;
<a name="l01380"></a>01380 
<a name="l01381"></a>01381               <span class="comment">/* ui_out_field_string may free S_FULLNAME by calling</span>
<a name="l01382"></a>01382 <span class="comment">                 open_source_file for it again.  See e.g.,</span>
<a name="l01383"></a>01383 <span class="comment">                 tui_field_string-&gt;tui_show_source.  */</span>
<a name="l01384"></a>01384               local_fullname = alloca (strlen (s_fullname) + 1);
<a name="l01385"></a>01385               strcpy (local_fullname, s_fullname);
<a name="l01386"></a>01386 
<a name="l01387"></a>01387               <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;fullname&quot;</span>, local_fullname);
<a name="l01388"></a>01388             }
<a name="l01389"></a>01389 
<a name="l01390"></a>01390           <a class="code" href="ui-out_8c.html#a6a23596295dce32ba2a5bd2fd2d309f8">ui_out_text</a> (uiout, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01391"></a>01391         }
<a name="l01392"></a>01392 
<a name="l01393"></a>01393       <span class="keywordflow">return</span>;
<a name="l01394"></a>01394     }
<a name="l01395"></a>01395 
<a name="l01396"></a>01396   <a class="code" href="source_8c.html#a572e631a2564d0a9bf82dff62abf6c5b">last_source_error</a> = 0;
<a name="l01397"></a>01397 
<a name="l01398"></a>01398   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="structsymtab.html#af4d69f09a5ce43cf6f6c450d00b38475">line_charpos</a> == 0)
<a name="l01399"></a>01399     <a class="code" href="source_8c.html#aac379479cd0ad4fcf244cc7ff659e7c6">find_source_lines</a> (s, desc);
<a name="l01400"></a>01400 
<a name="l01401"></a>01401   <span class="keywordflow">if</span> (line &lt; 1 || line &gt; s-&gt;<a class="code" href="structsymtab.html#a36dda01fdbd5e4363ce05b2a0a8422bf">nlines</a>)
<a name="l01402"></a>01402     {
<a name="l01403"></a>01403       close (desc);
<a name="l01404"></a>01404       <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Line number %d out of range; %s has %d lines.&quot;</span>),
<a name="l01405"></a>01405              line, <a class="code" href="source_8c.html#ae251616cab166301d5fed95cbdd31232">symtab_to_filename_for_display</a> (s), s-&gt;<a class="code" href="structsymtab.html#a36dda01fdbd5e4363ce05b2a0a8422bf">nlines</a>);
<a name="l01406"></a>01406     }
<a name="l01407"></a>01407 
<a name="l01408"></a>01408   <span class="keywordflow">if</span> (lseek (desc, s-&gt;<a class="code" href="structsymtab.html#af4d69f09a5ce43cf6f6c450d00b38475">line_charpos</a>[line - 1], 0) &lt; 0)
<a name="l01409"></a>01409     {
<a name="l01410"></a>01410       close (desc);
<a name="l01411"></a>01411       <a class="code" href="utils_8c.html#a14801ceb45147833b8ce111c89ea0d5f">perror_with_name</a> (<a class="code" href="source_8c.html#ae251616cab166301d5fed95cbdd31232">symtab_to_filename_for_display</a> (s));
<a name="l01412"></a>01412     }
<a name="l01413"></a>01413 
<a name="l01414"></a>01414   stream = fdopen (desc, <a class="code" href="source_8c.html#a2c6a5da19471bdab1dcc4f95356a80c1">FDOPEN_MODE</a>);
<a name="l01415"></a>01415   clearerr (stream);
<a name="l01416"></a>01416   cleanup = <a class="code" href="utils_8c.html#a09531a36b9f8b4fca2c87013e8be2b45">make_cleanup_fclose</a> (stream);
<a name="l01417"></a>01417 
<a name="l01418"></a>01418   <span class="keywordflow">while</span> (nlines-- &gt; 0)
<a name="l01419"></a>01419     {
<a name="l01420"></a>01420       <span class="keywordtype">char</span> buf[20];
<a name="l01421"></a>01421 
<a name="l01422"></a>01422       c = fgetc (stream);
<a name="l01423"></a>01423       <span class="keywordflow">if</span> (c == EOF)
<a name="l01424"></a>01424         <span class="keywordflow">break</span>;
<a name="l01425"></a>01425       <a class="code" href="source_8c.html#a55fc4c2f4fc50973546ef051f77fae59">last_line_listed</a> = <a class="code" href="source_8c.html#a0ca95f705d9a22363e95c86a27563ea5">current_source_line</a>;
<a name="l01426"></a>01426       <span class="keywordflow">if</span> (flags &amp; <a class="code" href="symtab_8h.html#a4fc2e9b18d837cb9db4d29ab58d0a784a417064eb78feb20173a8ea73ffbf4291">PRINT_SOURCE_LINES_FILENAME</a>)
<a name="l01427"></a>01427         {
<a name="l01428"></a>01428           <a class="code" href="ui-out_8c.html#a6a23596295dce32ba2a5bd2fd2d309f8">ui_out_text</a> (uiout, <a class="code" href="source_8c.html#ae251616cab166301d5fed95cbdd31232">symtab_to_filename_for_display</a> (s));
<a name="l01429"></a>01429           <a class="code" href="ui-out_8c.html#a6a23596295dce32ba2a5bd2fd2d309f8">ui_out_text</a> (uiout, <span class="stringliteral">&quot;:&quot;</span>);
<a name="l01430"></a>01430         }
<a name="l01431"></a>01431       <a class="code" href="common-utils_8c.html#ad9940337ec98983dae9951c947879fc8">xsnprintf</a> (buf, <span class="keyword">sizeof</span> (buf), <span class="stringliteral">&quot;%d\t&quot;</span>, <a class="code" href="source_8c.html#a0ca95f705d9a22363e95c86a27563ea5">current_source_line</a>++);
<a name="l01432"></a>01432       <a class="code" href="ui-out_8c.html#a6a23596295dce32ba2a5bd2fd2d309f8">ui_out_text</a> (uiout, buf);
<a name="l01433"></a>01433       <span class="keywordflow">do</span>
<a name="l01434"></a>01434         {
<a name="l01435"></a>01435           <span class="keywordflow">if</span> (c &lt; 040 &amp;&amp; c != <span class="charliteral">&#39;\t&#39;</span> &amp;&amp; c != <span class="charliteral">&#39;\n&#39;</span> &amp;&amp; c != <span class="charliteral">&#39;\r&#39;</span>)
<a name="l01436"></a>01436             {
<a name="l01437"></a>01437               <a class="code" href="common-utils_8c.html#ad9940337ec98983dae9951c947879fc8">xsnprintf</a> (buf, <span class="keyword">sizeof</span> (buf), <span class="stringliteral">&quot;^%c&quot;</span>, c + 0100);
<a name="l01438"></a>01438               <a class="code" href="ui-out_8c.html#a6a23596295dce32ba2a5bd2fd2d309f8">ui_out_text</a> (uiout, buf);
<a name="l01439"></a>01439             }
<a name="l01440"></a>01440           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == 0177)
<a name="l01441"></a>01441             <a class="code" href="ui-out_8c.html#a6a23596295dce32ba2a5bd2fd2d309f8">ui_out_text</a> (uiout, <span class="stringliteral">&quot;^?&quot;</span>);
<a name="l01442"></a>01442           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;\r&#39;</span>)
<a name="l01443"></a>01443             {
<a name="l01444"></a>01444               <span class="comment">/* Skip a \r character, but only before a \n.  */</span>
<a name="l01445"></a>01445               <span class="keywordtype">int</span> c1 = fgetc (stream);
<a name="l01446"></a>01446 
<a name="l01447"></a>01447               <span class="keywordflow">if</span> (c1 != <span class="charliteral">&#39;\n&#39;</span>)
<a name="l01448"></a>01448                 <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;^%c&quot;</span>, c + 0100);
<a name="l01449"></a>01449               <span class="keywordflow">if</span> (c1 != EOF)
<a name="l01450"></a>01450                 ungetc (c1, stream);
<a name="l01451"></a>01451             }
<a name="l01452"></a>01452           <span class="keywordflow">else</span>
<a name="l01453"></a>01453             {
<a name="l01454"></a>01454               <a class="code" href="common-utils_8c.html#ad9940337ec98983dae9951c947879fc8">xsnprintf</a> (buf, <span class="keyword">sizeof</span> (buf), <span class="stringliteral">&quot;%c&quot;</span>, c);
<a name="l01455"></a>01455               <a class="code" href="ui-out_8c.html#a6a23596295dce32ba2a5bd2fd2d309f8">ui_out_text</a> (uiout, buf);
<a name="l01456"></a>01456             }
<a name="l01457"></a>01457         }
<a name="l01458"></a>01458       <span class="keywordflow">while</span> (c != <span class="charliteral">&#39;\n&#39;</span> &amp;&amp; (c = fgetc (stream)) &gt;= 0);
<a name="l01459"></a>01459     }
<a name="l01460"></a>01460 
<a name="l01461"></a>01461   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup);
<a name="l01462"></a>01462 }
<a name="l01463"></a>01463 
<a name="l01464"></a>01464 <span class="comment">/* Show source lines from the file of symtab S, starting with line</span>
<a name="l01465"></a>01465 <span class="comment">   number LINE and stopping before line number STOPLINE.  If this is</span>
<a name="l01466"></a>01466 <span class="comment">   not the command line version, then the source is shown in the source</span>
<a name="l01467"></a>01467 <span class="comment">   window otherwise it is simply printed.  */</span>
<a name="l01468"></a>01468 
<a name="l01469"></a>01469 <span class="keywordtype">void</span>
<a name="l01470"></a><a class="code" href="symtab_8h.html#a031a11a008a878b1370f03883412cd6d">01470</a> <a class="code" href="source_8c.html#a2b372e093e79fa280d0c537309a6042c">print_source_lines</a> (<span class="keyword">struct</span> <a class="code" href="structsymtab.html">symtab</a> *s, <span class="keywordtype">int</span> <a class="code" href="symtab_8h.html#a41ebd28ef1d7c6ade45642cb6acc1039">line</a>, <span class="keywordtype">int</span> stopline,
<a name="l01471"></a>01471                     <span class="keyword">enum</span> <a class="code" href="symtab_8h.html#a4fc2e9b18d837cb9db4d29ab58d0a784">print_source_lines_flags</a> <a class="code" href="solib-som_8c.html#a555096840020c318e34b205419e98cca">flags</a>)
<a name="l01472"></a>01472 {
<a name="l01473"></a>01473   <a class="code" href="source_8c.html#a75c1c948f7496799b19c67257d7a3d9d">print_source_lines_base</a> (s, line, stopline, flags);
<a name="l01474"></a>01474 }
<a name="l01475"></a>01475 
<a name="l01476"></a>01476 <span class="comment">/* Print info on range of pc&#39;s in a specified line.  */</span>
<a name="l01477"></a>01477 
<a name="l01478"></a>01478 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01479"></a><a class="code" href="source_8c.html#a360ce6d238b653379f578a32c71c0e57">01479</a> <a class="code" href="source_8c.html#a360ce6d238b653379f578a32c71c0e57">line_info</a> (<span class="keywordtype">char</span> *arg, <span class="keywordtype">int</span> from_tty)
<a name="l01480"></a>01480 {
<a name="l01481"></a>01481   <span class="keyword">struct </span><a class="code" href="structsymtabs__and__lines.html">symtabs_and_lines</a> sals;
<a name="l01482"></a>01482   <span class="keyword">struct </span><a class="code" href="structsymtab__and__line.html">symtab_and_line</a> sal;
<a name="l01483"></a>01483   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> start_pc, end_pc;
<a name="l01484"></a>01484   <span class="keywordtype">int</span> i;
<a name="l01485"></a>01485   <span class="keyword">struct </span><a class="code" href="structcleanup.html">cleanup</a> *cleanups;
<a name="l01486"></a>01486 
<a name="l01487"></a>01487   <a class="code" href="symtab_8c.html#aca3a01a4f0e1a09f99e8308faecc9028">init_sal</a> (&amp;sal);              <span class="comment">/* initialize to zeroes */</span>
<a name="l01488"></a>01488 
<a name="l01489"></a>01489   <span class="keywordflow">if</span> (arg == 0)
<a name="l01490"></a>01490     {
<a name="l01491"></a>01491       sal.<a class="code" href="structsymtab__and__line.html#a74216e171a96d8bcaab43fe69b49c599">symtab</a> = <a class="code" href="source_8c.html#a869f99e7ba57b2aac5ed4fffff8a430d">current_source_symtab</a>;
<a name="l01492"></a>01492       sal.<a class="code" href="structsymtab__and__line.html#acc91f0276f4648cb5a970f17ddcbaf09">pspace</a> = <a class="code" href="progspace_8c.html#a07722ff15a98814c086dda44f93380c9">current_program_space</a>;
<a name="l01493"></a>01493       sal.<a class="code" href="structsymtab__and__line.html#a6a0468be675b9ac19a5b3ef26f471eaf">line</a> = <a class="code" href="source_8c.html#a55fc4c2f4fc50973546ef051f77fae59">last_line_listed</a>;
<a name="l01494"></a>01494       sals.<a class="code" href="structsymtabs__and__lines.html#a1c8b832fc2f8c096c95144a2acedd36a">nelts</a> = 1;
<a name="l01495"></a>01495       sals.<a class="code" href="structsymtabs__and__lines.html#ab601f48fdf29c3b190ba068f57983df4">sals</a> = (<span class="keyword">struct </span><a class="code" href="structsymtab__and__line.html">symtab_and_line</a> *)
<a name="l01496"></a>01496         <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (<span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structsymtab__and__line.html">symtab_and_line</a>));
<a name="l01497"></a>01497       sals.<a class="code" href="structsymtabs__and__lines.html#ab601f48fdf29c3b190ba068f57983df4">sals</a>[0] = sal;
<a name="l01498"></a>01498     }
<a name="l01499"></a>01499   <span class="keywordflow">else</span>
<a name="l01500"></a>01500     {
<a name="l01501"></a>01501       sals = <a class="code" href="linespec_8c.html#a6cf53366605fcbdc9b950091efe437e4">decode_line_with_last_displayed</a> (arg, <a class="code" href="linespec_8h.html#a66db0c56cdf6b7d07a996c374a0572caae008953599e1c9328463cbbdad314799">DECODE_LINE_LIST_MODE</a>);
<a name="l01502"></a>01502 
<a name="l01503"></a>01503       <a class="code" href="command_8h.html#ac7af34b03605d65b114a173d49532050">dont_repeat</a> ();
<a name="l01504"></a>01504     }
<a name="l01505"></a>01505 
<a name="l01506"></a>01506   cleanups = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, sals.<a class="code" href="structsymtabs__and__lines.html#ab601f48fdf29c3b190ba068f57983df4">sals</a>);
<a name="l01507"></a>01507 
<a name="l01508"></a>01508   <span class="comment">/* C++  More than one line may have been specified, as when the user</span>
<a name="l01509"></a>01509 <span class="comment">     specifies an overloaded function name.  Print info on them all.  */</span>
<a name="l01510"></a>01510   <span class="keywordflow">for</span> (i = 0; i &lt; sals.<a class="code" href="structsymtabs__and__lines.html#a1c8b832fc2f8c096c95144a2acedd36a">nelts</a>; i++)
<a name="l01511"></a>01511     {
<a name="l01512"></a>01512       sal = sals.<a class="code" href="structsymtabs__and__lines.html#ab601f48fdf29c3b190ba068f57983df4">sals</a>[i];
<a name="l01513"></a>01513       <span class="keywordflow">if</span> (sal.<a class="code" href="structsymtab__and__line.html#acc91f0276f4648cb5a970f17ddcbaf09">pspace</a> != <a class="code" href="progspace_8c.html#a07722ff15a98814c086dda44f93380c9">current_program_space</a>)
<a name="l01514"></a>01514         <span class="keywordflow">continue</span>;
<a name="l01515"></a>01515 
<a name="l01516"></a>01516       <span class="keywordflow">if</span> (sal.<a class="code" href="structsymtab__and__line.html#a74216e171a96d8bcaab43fe69b49c599">symtab</a> == 0)
<a name="l01517"></a>01517         {
<a name="l01518"></a>01518           <span class="keyword">struct </span><a class="code" href="structgdbarch.html">gdbarch</a> *<a class="code" href="structgdbarch.html">gdbarch</a> = <a class="code" href="arch-utils_8c.html#a0fe1e68475f442e5d6dda589e0c62454">get_current_arch</a> ();
<a name="l01519"></a>01519 
<a name="l01520"></a>01520           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No line number information available&quot;</span>));
<a name="l01521"></a>01521           <span class="keywordflow">if</span> (sal.<a class="code" href="structsymtab__and__line.html#a77665fa461ad187cb755efa256ba44d7">pc</a> != 0)
<a name="l01522"></a>01522             {
<a name="l01523"></a>01523               <span class="comment">/* This is useful for &quot;info line *0x7f34&quot;.  If we can&#39;t tell the</span>
<a name="l01524"></a>01524 <span class="comment">                 user about a source line, at least let them have the symbolic</span>
<a name="l01525"></a>01525 <span class="comment">                 address.  */</span>
<a name="l01526"></a>01526               <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot; for address &quot;</span>);
<a name="l01527"></a>01527               <a class="code" href="utils_8c.html#a857540a17ef1cd62fef4a33cc3b6a894">wrap_here</a> (<span class="stringliteral">&quot;  &quot;</span>);
<a name="l01528"></a>01528               <a class="code" href="defs_8h.html#ac859be6d454d5718fb6faf3bd34fc27e">print_address</a> (gdbarch, sal.<a class="code" href="structsymtab__and__line.html#a77665fa461ad187cb755efa256ba44d7">pc</a>, <a class="code" href="main_8c.html#a41a2b997ba5454df787d61f051dd918c">gdb_stdout</a>);
<a name="l01529"></a>01529             }
<a name="l01530"></a>01530           <span class="keywordflow">else</span>
<a name="l01531"></a>01531             <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;.&quot;</span>);
<a name="l01532"></a>01532           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01533"></a>01533         }
<a name="l01534"></a>01534       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sal.<a class="code" href="structsymtab__and__line.html#a6a0468be675b9ac19a5b3ef26f471eaf">line</a> &gt; 0
<a name="l01535"></a>01535                &amp;&amp; <a class="code" href="symtab_8c.html#ad7abbdf5f7a0d49ce1b12200beda7d96">find_line_pc_range</a> (sal, &amp;start_pc, &amp;end_pc))
<a name="l01536"></a>01536         {
<a name="l01537"></a>01537           <span class="keyword">struct </span><a class="code" href="structgdbarch.html">gdbarch</a> *<a class="code" href="structgdbarch.html">gdbarch</a> = <a class="code" href="objfiles_8c.html#a1c7101234ac2edc601fa465e48bc3463">get_objfile_arch</a> (sal.<a class="code" href="structsymtab__and__line.html#a74216e171a96d8bcaab43fe69b49c599">symtab</a>-&gt;<a class="code" href="structsymtab.html#a5fbe801333fb00c20190a6193b708be0">objfile</a>);
<a name="l01538"></a>01538 
<a name="l01539"></a>01539           <span class="keywordflow">if</span> (start_pc == end_pc)
<a name="l01540"></a>01540             {
<a name="l01541"></a>01541               <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;Line %d of \&quot;%s\&quot;&quot;</span>,
<a name="l01542"></a>01542                                sal.<a class="code" href="structsymtab__and__line.html#a6a0468be675b9ac19a5b3ef26f471eaf">line</a>,
<a name="l01543"></a>01543                                <a class="code" href="source_8c.html#ae251616cab166301d5fed95cbdd31232">symtab_to_filename_for_display</a> (sal.<a class="code" href="structsymtab__and__line.html#a74216e171a96d8bcaab43fe69b49c599">symtab</a>));
<a name="l01544"></a>01544               <a class="code" href="utils_8c.html#a857540a17ef1cd62fef4a33cc3b6a894">wrap_here</a> (<span class="stringliteral">&quot;  &quot;</span>);
<a name="l01545"></a>01545               <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot; is at address &quot;</span>);
<a name="l01546"></a>01546               <a class="code" href="defs_8h.html#ac859be6d454d5718fb6faf3bd34fc27e">print_address</a> (gdbarch, start_pc, <a class="code" href="main_8c.html#a41a2b997ba5454df787d61f051dd918c">gdb_stdout</a>);
<a name="l01547"></a>01547               <a class="code" href="utils_8c.html#a857540a17ef1cd62fef4a33cc3b6a894">wrap_here</a> (<span class="stringliteral">&quot;  &quot;</span>);
<a name="l01548"></a>01548               <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot; but contains no code.\n&quot;</span>);
<a name="l01549"></a>01549             }
<a name="l01550"></a>01550           <span class="keywordflow">else</span>
<a name="l01551"></a>01551             {
<a name="l01552"></a>01552               <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;Line %d of \&quot;%s\&quot;&quot;</span>,
<a name="l01553"></a>01553                                sal.<a class="code" href="structsymtab__and__line.html#a6a0468be675b9ac19a5b3ef26f471eaf">line</a>,
<a name="l01554"></a>01554                                <a class="code" href="source_8c.html#ae251616cab166301d5fed95cbdd31232">symtab_to_filename_for_display</a> (sal.<a class="code" href="structsymtab__and__line.html#a74216e171a96d8bcaab43fe69b49c599">symtab</a>));
<a name="l01555"></a>01555               <a class="code" href="utils_8c.html#a857540a17ef1cd62fef4a33cc3b6a894">wrap_here</a> (<span class="stringliteral">&quot;  &quot;</span>);
<a name="l01556"></a>01556               <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot; starts at address &quot;</span>);
<a name="l01557"></a>01557               <a class="code" href="defs_8h.html#ac859be6d454d5718fb6faf3bd34fc27e">print_address</a> (gdbarch, start_pc, <a class="code" href="main_8c.html#a41a2b997ba5454df787d61f051dd918c">gdb_stdout</a>);
<a name="l01558"></a>01558               <a class="code" href="utils_8c.html#a857540a17ef1cd62fef4a33cc3b6a894">wrap_here</a> (<span class="stringliteral">&quot;  &quot;</span>);
<a name="l01559"></a>01559               <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot; and ends at &quot;</span>);
<a name="l01560"></a>01560               <a class="code" href="defs_8h.html#ac859be6d454d5718fb6faf3bd34fc27e">print_address</a> (gdbarch, end_pc, <a class="code" href="main_8c.html#a41a2b997ba5454df787d61f051dd918c">gdb_stdout</a>);
<a name="l01561"></a>01561               <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;.\n&quot;</span>);
<a name="l01562"></a>01562             }
<a name="l01563"></a>01563 
<a name="l01564"></a>01564           <span class="comment">/* x/i should display this line&#39;s code.  */</span>
<a name="l01565"></a>01565           <a class="code" href="defs_8h.html#a55e0332ed07e2318daf35ed1ee2ffba7">set_next_address</a> (gdbarch, start_pc);
<a name="l01566"></a>01566 
<a name="l01567"></a>01567           <span class="comment">/* Repeating &quot;info line&quot; should do the following line.  */</span>
<a name="l01568"></a>01568           <a class="code" href="source_8c.html#a55fc4c2f4fc50973546ef051f77fae59">last_line_listed</a> = sal.<a class="code" href="structsymtab__and__line.html#a6a0468be675b9ac19a5b3ef26f471eaf">line</a> + 1;
<a name="l01569"></a>01569 
<a name="l01570"></a>01570           <span class="comment">/* If this is the only line, show the source code.  If it could</span>
<a name="l01571"></a>01571 <span class="comment">             not find the file, don&#39;t do anything special.  */</span>
<a name="l01572"></a>01572           <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a8936079e8ffb68b6dec711d3b35133ca">annotation_level</a> &amp;&amp; sals.<a class="code" href="structsymtabs__and__lines.html#a1c8b832fc2f8c096c95144a2acedd36a">nelts</a> == 1)
<a name="l01573"></a>01573             <a class="code" href="source_8c.html#a45ff3c684f9337c457f019421d14dacb">identify_source_line</a> (sal.<a class="code" href="structsymtab__and__line.html#a74216e171a96d8bcaab43fe69b49c599">symtab</a>, sal.<a class="code" href="structsymtab__and__line.html#a6a0468be675b9ac19a5b3ef26f471eaf">line</a>, 0, start_pc);
<a name="l01574"></a>01574         }
<a name="l01575"></a>01575       <span class="keywordflow">else</span>
<a name="l01576"></a>01576         <span class="comment">/* Is there any case in which we get here, and have an address</span>
<a name="l01577"></a>01577 <span class="comment">           which the user would want to see?  If we have debugging symbols</span>
<a name="l01578"></a>01578 <span class="comment">           and no line numbers?  */</span>
<a name="l01579"></a>01579         <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Line number %d is out of range for \&quot;%s\&quot;.\n&quot;</span>),
<a name="l01580"></a>01580                          sal.<a class="code" href="structsymtab__and__line.html#a6a0468be675b9ac19a5b3ef26f471eaf">line</a>, <a class="code" href="source_8c.html#ae251616cab166301d5fed95cbdd31232">symtab_to_filename_for_display</a> (sal.<a class="code" href="structsymtab__and__line.html#a74216e171a96d8bcaab43fe69b49c599">symtab</a>));
<a name="l01581"></a>01581     }
<a name="l01582"></a>01582   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanups);
<a name="l01583"></a>01583 }
<a name="l01584"></a>01584 
<a name="l01585"></a>01585 <span class="comment">/* Commands to search the source file for a regexp.  */</span>
<a name="l01586"></a>01586 
<a name="l01587"></a>01587 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01588"></a><a class="code" href="source_8c.html#ac52933592b1c243ad86c3d3df70cb2e3">01588</a> <a class="code" href="source_8c.html#ac52933592b1c243ad86c3d3df70cb2e3">forward_search_command</a> (<span class="keywordtype">char</span> *regex, <span class="keywordtype">int</span> from_tty)
<a name="l01589"></a>01589 {
<a name="l01590"></a>01590   <span class="keywordtype">int</span> c;
<a name="l01591"></a>01591   <span class="keywordtype">int</span> desc;
<a name="l01592"></a>01592   FILE *stream;
<a name="l01593"></a>01593   <span class="keywordtype">int</span> <a class="code" href="symtab_8h.html#a41ebd28ef1d7c6ade45642cb6acc1039">line</a>;
<a name="l01594"></a>01594   <span class="keywordtype">char</span> *msg;
<a name="l01595"></a>01595   <span class="keyword">struct </span><a class="code" href="structcleanup.html">cleanup</a> *cleanups;
<a name="l01596"></a>01596 
<a name="l01597"></a>01597   line = <a class="code" href="source_8c.html#a55fc4c2f4fc50973546ef051f77fae59">last_line_listed</a> + 1;
<a name="l01598"></a>01598 
<a name="l01599"></a>01599   msg = (<span class="keywordtype">char</span> *) <a class="code" href="defs_8h.html#ad321e1eefeb38442e0c40b1279f41ca0">re_comp</a> (regex);
<a name="l01600"></a>01600   <span class="keywordflow">if</span> (msg)
<a name="l01601"></a>01601     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> ((<span class="stringliteral">&quot;%s&quot;</span>), msg);
<a name="l01602"></a>01602 
<a name="l01603"></a>01603   <span class="keywordflow">if</span> (current_source_symtab == 0)
<a name="l01604"></a>01604     <a class="code" href="source_8c.html#a0ba91e44a03ae75131aa18e8e77f41c6">select_source_symtab</a> (0);
<a name="l01605"></a>01605 
<a name="l01606"></a>01606   desc = <a class="code" href="source_8c.html#a676371f58055b0d35762ed9ce50d392f">open_source_file</a> (current_source_symtab);
<a name="l01607"></a>01607   <span class="keywordflow">if</span> (desc &lt; 0)
<a name="l01608"></a>01608     <a class="code" href="utils_8c.html#a14801ceb45147833b8ce111c89ea0d5f">perror_with_name</a> (<a class="code" href="source_8c.html#ae251616cab166301d5fed95cbdd31232">symtab_to_filename_for_display</a> (current_source_symtab));
<a name="l01609"></a>01609   cleanups = <a class="code" href="utils_8c.html#ae1c81b8331e815cc346382bc13e20095">make_cleanup_close</a> (desc);
<a name="l01610"></a>01610 
<a name="l01611"></a>01611   <span class="keywordflow">if</span> (current_source_symtab-&gt;<a class="code" href="structsymtab.html#af4d69f09a5ce43cf6f6c450d00b38475">line_charpos</a> == 0)
<a name="l01612"></a>01612     <a class="code" href="source_8c.html#aac379479cd0ad4fcf244cc7ff659e7c6">find_source_lines</a> (current_source_symtab, desc);
<a name="l01613"></a>01613 
<a name="l01614"></a>01614   <span class="keywordflow">if</span> (line &lt; 1 || line &gt; current_source_symtab-&gt;<a class="code" href="structsymtab.html#a36dda01fdbd5e4363ce05b2a0a8422bf">nlines</a>)
<a name="l01615"></a>01615     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Expression not found&quot;</span>));
<a name="l01616"></a>01616 
<a name="l01617"></a>01617   <span class="keywordflow">if</span> (lseek (desc, current_source_symtab-&gt;<a class="code" href="structsymtab.html#af4d69f09a5ce43cf6f6c450d00b38475">line_charpos</a>[line - 1], 0) &lt; 0)
<a name="l01618"></a>01618     <a class="code" href="utils_8c.html#a14801ceb45147833b8ce111c89ea0d5f">perror_with_name</a> (<a class="code" href="source_8c.html#ae251616cab166301d5fed95cbdd31232">symtab_to_filename_for_display</a> (current_source_symtab));
<a name="l01619"></a>01619 
<a name="l01620"></a>01620   <a class="code" href="cleanups_8c.html#a5ec3987bf995edcc44def9e17ada6eba">discard_cleanups</a> (cleanups);
<a name="l01621"></a>01621   stream = fdopen (desc, <a class="code" href="source_8c.html#a2c6a5da19471bdab1dcc4f95356a80c1">FDOPEN_MODE</a>);
<a name="l01622"></a>01622   clearerr (stream);
<a name="l01623"></a>01623   cleanups = <a class="code" href="utils_8c.html#a09531a36b9f8b4fca2c87013e8be2b45">make_cleanup_fclose</a> (stream);
<a name="l01624"></a>01624   <span class="keywordflow">while</span> (1)
<a name="l01625"></a>01625     {
<a name="l01626"></a>01626       <span class="keyword">static</span> <span class="keywordtype">char</span> *buf = NULL;
<a name="l01627"></a>01627       <span class="keywordtype">char</span> *<a class="code" href="windows-nat_8c.html#ade66e4ccafbc33b117610bbc0d85feb0">p</a>;
<a name="l01628"></a>01628       <span class="keywordtype">int</span> cursize, newsize;
<a name="l01629"></a>01629 
<a name="l01630"></a>01630       cursize = 256;
<a name="l01631"></a>01631       buf = <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (cursize);
<a name="l01632"></a>01632       p = buf;
<a name="l01633"></a>01633 
<a name="l01634"></a>01634       c = fgetc (stream);
<a name="l01635"></a>01635       <span class="keywordflow">if</span> (c == EOF)
<a name="l01636"></a>01636         <span class="keywordflow">break</span>;
<a name="l01637"></a>01637       <span class="keywordflow">do</span>
<a name="l01638"></a>01638         {
<a name="l01639"></a>01639           *p++ = c;
<a name="l01640"></a>01640           <span class="keywordflow">if</span> (p - buf == cursize)
<a name="l01641"></a>01641             {
<a name="l01642"></a>01642               newsize = cursize + cursize / 2;
<a name="l01643"></a>01643               buf = <a class="code" href="common-utils_8c.html#af404b7244f442ce8c3069f31af566eae">xrealloc</a> (buf, newsize);
<a name="l01644"></a>01644               p = buf + cursize;
<a name="l01645"></a>01645               cursize = newsize;
<a name="l01646"></a>01646             }
<a name="l01647"></a>01647         }
<a name="l01648"></a>01648       <span class="keywordflow">while</span> (c != <span class="charliteral">&#39;\n&#39;</span> &amp;&amp; (c = fgetc (stream)) &gt;= 0);
<a name="l01649"></a>01649 
<a name="l01650"></a>01650       <span class="comment">/* Remove the \r, if any, at the end of the line, otherwise</span>
<a name="l01651"></a>01651 <span class="comment">         regular expressions that end with $ or \n won&#39;t work.  */</span>
<a name="l01652"></a>01652       <span class="keywordflow">if</span> (p - buf &gt; 1 &amp;&amp; p[-2] == <span class="charliteral">&#39;\r&#39;</span>)
<a name="l01653"></a>01653         {
<a name="l01654"></a>01654           p--;
<a name="l01655"></a>01655           p[-1] = <span class="charliteral">&#39;\n&#39;</span>;
<a name="l01656"></a>01656         }
<a name="l01657"></a>01657 
<a name="l01658"></a>01658       <span class="comment">/* We now have a source line in buf, null terminate and match.  */</span>
<a name="l01659"></a>01659       *p = 0;
<a name="l01660"></a>01660       <span class="keywordflow">if</span> (re_exec (buf) &gt; 0)
<a name="l01661"></a>01661         {
<a name="l01662"></a>01662           <span class="comment">/* Match!  */</span>
<a name="l01663"></a>01663           <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanups);
<a name="l01664"></a>01664           <a class="code" href="source_8c.html#a2b372e093e79fa280d0c537309a6042c">print_source_lines</a> (current_source_symtab, line, line + 1, 0);
<a name="l01665"></a>01665           <a class="code" href="value_8c.html#ac0d9f889423ba9ff189ea48da13204a3">set_internalvar_integer</a> (<a class="code" href="value_8c.html#ac96b41b37d2b8eeb44137ec148ca5c7c">lookup_internalvar</a> (<span class="stringliteral">&quot;_&quot;</span>), line);
<a name="l01666"></a>01666           <a class="code" href="source_8c.html#a0ca95f705d9a22363e95c86a27563ea5">current_source_line</a> = <a class="code" href="environ_8c.html#affe776513b24d84b39af8ab0930fef7f">max</a> (line - <a class="code" href="source_8c.html#adf96a46f26a6e6235d9bb0e4a29367bb">lines_to_list</a> / 2, 1);
<a name="l01667"></a>01667           <span class="keywordflow">return</span>;
<a name="l01668"></a>01668         }
<a name="l01669"></a>01669       line++;
<a name="l01670"></a>01670     }
<a name="l01671"></a>01671 
<a name="l01672"></a>01672   <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Expression not found\n&quot;</span>));
<a name="l01673"></a>01673   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanups);
<a name="l01674"></a>01674 }
<a name="l01675"></a>01675 
<a name="l01676"></a>01676 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01677"></a><a class="code" href="source_8c.html#a29ccead27af7ed8aa350d5d322b75bde">01677</a> <a class="code" href="source_8c.html#a29ccead27af7ed8aa350d5d322b75bde">reverse_search_command</a> (<span class="keywordtype">char</span> *regex, <span class="keywordtype">int</span> from_tty)
<a name="l01678"></a>01678 {
<a name="l01679"></a>01679   <span class="keywordtype">int</span> c;
<a name="l01680"></a>01680   <span class="keywordtype">int</span> desc;
<a name="l01681"></a>01681   FILE *stream;
<a name="l01682"></a>01682   <span class="keywordtype">int</span> <a class="code" href="symtab_8h.html#a41ebd28ef1d7c6ade45642cb6acc1039">line</a>;
<a name="l01683"></a>01683   <span class="keywordtype">char</span> *msg;
<a name="l01684"></a>01684   <span class="keyword">struct </span><a class="code" href="structcleanup.html">cleanup</a> *cleanups;
<a name="l01685"></a>01685 
<a name="l01686"></a>01686   line = <a class="code" href="source_8c.html#a55fc4c2f4fc50973546ef051f77fae59">last_line_listed</a> - 1;
<a name="l01687"></a>01687 
<a name="l01688"></a>01688   msg = (<span class="keywordtype">char</span> *) <a class="code" href="defs_8h.html#ad321e1eefeb38442e0c40b1279f41ca0">re_comp</a> (regex);
<a name="l01689"></a>01689   <span class="keywordflow">if</span> (msg)
<a name="l01690"></a>01690     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> ((<span class="stringliteral">&quot;%s&quot;</span>), msg);
<a name="l01691"></a>01691 
<a name="l01692"></a>01692   <span class="keywordflow">if</span> (current_source_symtab == 0)
<a name="l01693"></a>01693     <a class="code" href="source_8c.html#a0ba91e44a03ae75131aa18e8e77f41c6">select_source_symtab</a> (0);
<a name="l01694"></a>01694 
<a name="l01695"></a>01695   desc = <a class="code" href="source_8c.html#a676371f58055b0d35762ed9ce50d392f">open_source_file</a> (current_source_symtab);
<a name="l01696"></a>01696   <span class="keywordflow">if</span> (desc &lt; 0)
<a name="l01697"></a>01697     <a class="code" href="utils_8c.html#a14801ceb45147833b8ce111c89ea0d5f">perror_with_name</a> (<a class="code" href="source_8c.html#ae251616cab166301d5fed95cbdd31232">symtab_to_filename_for_display</a> (current_source_symtab));
<a name="l01698"></a>01698   cleanups = <a class="code" href="utils_8c.html#ae1c81b8331e815cc346382bc13e20095">make_cleanup_close</a> (desc);
<a name="l01699"></a>01699 
<a name="l01700"></a>01700   <span class="keywordflow">if</span> (current_source_symtab-&gt;<a class="code" href="structsymtab.html#af4d69f09a5ce43cf6f6c450d00b38475">line_charpos</a> == 0)
<a name="l01701"></a>01701     <a class="code" href="source_8c.html#aac379479cd0ad4fcf244cc7ff659e7c6">find_source_lines</a> (current_source_symtab, desc);
<a name="l01702"></a>01702 
<a name="l01703"></a>01703   <span class="keywordflow">if</span> (line &lt; 1 || line &gt; current_source_symtab-&gt;<a class="code" href="structsymtab.html#a36dda01fdbd5e4363ce05b2a0a8422bf">nlines</a>)
<a name="l01704"></a>01704     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Expression not found&quot;</span>));
<a name="l01705"></a>01705 
<a name="l01706"></a>01706   <span class="keywordflow">if</span> (lseek (desc, current_source_symtab-&gt;<a class="code" href="structsymtab.html#af4d69f09a5ce43cf6f6c450d00b38475">line_charpos</a>[line - 1], 0) &lt; 0)
<a name="l01707"></a>01707     <a class="code" href="utils_8c.html#a14801ceb45147833b8ce111c89ea0d5f">perror_with_name</a> (<a class="code" href="source_8c.html#ae251616cab166301d5fed95cbdd31232">symtab_to_filename_for_display</a> (current_source_symtab));
<a name="l01708"></a>01708 
<a name="l01709"></a>01709   <a class="code" href="cleanups_8c.html#a5ec3987bf995edcc44def9e17ada6eba">discard_cleanups</a> (cleanups);
<a name="l01710"></a>01710   stream = fdopen (desc, <a class="code" href="source_8c.html#a2c6a5da19471bdab1dcc4f95356a80c1">FDOPEN_MODE</a>);
<a name="l01711"></a>01711   clearerr (stream);
<a name="l01712"></a>01712   cleanups = <a class="code" href="utils_8c.html#a09531a36b9f8b4fca2c87013e8be2b45">make_cleanup_fclose</a> (stream);
<a name="l01713"></a>01713   <span class="keywordflow">while</span> (line &gt; 1)
<a name="l01714"></a>01714     {
<a name="l01715"></a>01715 <span class="comment">/* FIXME!!!  We walk right off the end of buf if we get a long line!!!  */</span>
<a name="l01716"></a>01716       <span class="keywordtype">char</span> buf[4096];           <span class="comment">/* Should be reasonable???  */</span>
<a name="l01717"></a>01717       <span class="keywordtype">char</span> *<a class="code" href="windows-nat_8c.html#ade66e4ccafbc33b117610bbc0d85feb0">p</a> = buf;
<a name="l01718"></a>01718 
<a name="l01719"></a>01719       c = fgetc (stream);
<a name="l01720"></a>01720       <span class="keywordflow">if</span> (c == EOF)
<a name="l01721"></a>01721         <span class="keywordflow">break</span>;
<a name="l01722"></a>01722       <span class="keywordflow">do</span>
<a name="l01723"></a>01723         {
<a name="l01724"></a>01724           *p++ = c;
<a name="l01725"></a>01725         }
<a name="l01726"></a>01726       <span class="keywordflow">while</span> (c != <span class="charliteral">&#39;\n&#39;</span> &amp;&amp; (c = fgetc (stream)) &gt;= 0);
<a name="l01727"></a>01727 
<a name="l01728"></a>01728       <span class="comment">/* Remove the \r, if any, at the end of the line, otherwise</span>
<a name="l01729"></a>01729 <span class="comment">         regular expressions that end with $ or \n won&#39;t work.  */</span>
<a name="l01730"></a>01730       <span class="keywordflow">if</span> (p - buf &gt; 1 &amp;&amp; p[-2] == <span class="charliteral">&#39;\r&#39;</span>)
<a name="l01731"></a>01731         {
<a name="l01732"></a>01732           p--;
<a name="l01733"></a>01733           p[-1] = <span class="charliteral">&#39;\n&#39;</span>;
<a name="l01734"></a>01734         }
<a name="l01735"></a>01735 
<a name="l01736"></a>01736       <span class="comment">/* We now have a source line in buf; null terminate and match.  */</span>
<a name="l01737"></a>01737       *p = 0;
<a name="l01738"></a>01738       <span class="keywordflow">if</span> (re_exec (buf) &gt; 0)
<a name="l01739"></a>01739         {
<a name="l01740"></a>01740           <span class="comment">/* Match!  */</span>
<a name="l01741"></a>01741           <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanups);
<a name="l01742"></a>01742           <a class="code" href="source_8c.html#a2b372e093e79fa280d0c537309a6042c">print_source_lines</a> (current_source_symtab, line, line + 1, 0);
<a name="l01743"></a>01743           <a class="code" href="value_8c.html#ac0d9f889423ba9ff189ea48da13204a3">set_internalvar_integer</a> (<a class="code" href="value_8c.html#ac96b41b37d2b8eeb44137ec148ca5c7c">lookup_internalvar</a> (<span class="stringliteral">&quot;_&quot;</span>), line);
<a name="l01744"></a>01744           <a class="code" href="source_8c.html#a0ca95f705d9a22363e95c86a27563ea5">current_source_line</a> = <a class="code" href="environ_8c.html#affe776513b24d84b39af8ab0930fef7f">max</a> (line - <a class="code" href="source_8c.html#adf96a46f26a6e6235d9bb0e4a29367bb">lines_to_list</a> / 2, 1);
<a name="l01745"></a>01745           <span class="keywordflow">return</span>;
<a name="l01746"></a>01746         }
<a name="l01747"></a>01747       line--;
<a name="l01748"></a>01748       <span class="keywordflow">if</span> (fseek (stream, current_source_symtab-&gt;<a class="code" href="structsymtab.html#af4d69f09a5ce43cf6f6c450d00b38475">line_charpos</a>[line - 1], 0) &lt; 0)
<a name="l01749"></a>01749         {
<a name="l01750"></a>01750           <span class="keyword">const</span> <span class="keywordtype">char</span> *filename;
<a name="l01751"></a>01751 
<a name="l01752"></a>01752           <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanups);
<a name="l01753"></a>01753           filename = <a class="code" href="source_8c.html#ae251616cab166301d5fed95cbdd31232">symtab_to_filename_for_display</a> (current_source_symtab);
<a name="l01754"></a>01754           <a class="code" href="utils_8c.html#a14801ceb45147833b8ce111c89ea0d5f">perror_with_name</a> (filename);
<a name="l01755"></a>01755         }
<a name="l01756"></a>01756     }
<a name="l01757"></a>01757 
<a name="l01758"></a>01758   <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Expression not found\n&quot;</span>));
<a name="l01759"></a>01759   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanups);
<a name="l01760"></a>01760   <span class="keywordflow">return</span>;
<a name="l01761"></a>01761 }
<a name="l01762"></a>01762 
<a name="l01763"></a>01763 <span class="comment">/* If the last character of PATH is a directory separator, then strip it.  */</span>
<a name="l01764"></a>01764 
<a name="l01765"></a>01765 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01766"></a><a class="code" href="source_8c.html#a474ecc49057d594d5958a6bb68cbfd9d">01766</a> <a class="code" href="source_8c.html#a474ecc49057d594d5958a6bb68cbfd9d">strip_trailing_directory_separator</a> (<span class="keywordtype">char</span> *path)
<a name="l01767"></a>01767 {
<a name="l01768"></a>01768   <span class="keyword">const</span> <span class="keywordtype">int</span> last = strlen (path) - 1;
<a name="l01769"></a>01769 
<a name="l01770"></a>01770   <span class="keywordflow">if</span> (last &lt; 0)
<a name="l01771"></a>01771     <span class="keywordflow">return</span>;  <span class="comment">/* No stripping is needed if PATH is the empty string.  */</span>
<a name="l01772"></a>01772 
<a name="l01773"></a>01773   <span class="keywordflow">if</span> (IS_DIR_SEPARATOR (path[last]))
<a name="l01774"></a>01774     path[last] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01775"></a>01775 }
<a name="l01776"></a>01776 
<a name="l01777"></a>01777 <span class="comment">/* Return the path substitution rule that matches FROM.</span>
<a name="l01778"></a>01778 <span class="comment">   Return NULL if no rule matches.  */</span>
<a name="l01779"></a>01779 
<a name="l01780"></a>01780 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structsubstitute__path__rule.html">substitute_path_rule</a> *
<a name="l01781"></a><a class="code" href="source_8c.html#a0b7b58f638f254a6c6e447738d01d6b6">01781</a> <a class="code" href="source_8c.html#a0b7b58f638f254a6c6e447738d01d6b6">find_substitute_path_rule</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="varobj_8h.html#a43396decd62b46fa01cc6c66a84cbba1">from</a>)
<a name="l01782"></a>01782 {
<a name="l01783"></a>01783   <span class="keyword">struct </span><a class="code" href="structsubstitute__path__rule.html">substitute_path_rule</a> *rule = <a class="code" href="source_8c.html#ae472785cbb06089dd2d492e5bd3dd535">substitute_path_rules</a>;
<a name="l01784"></a>01784 
<a name="l01785"></a>01785   <span class="keywordflow">while</span> (rule != NULL)
<a name="l01786"></a>01786     {
<a name="l01787"></a>01787       <span class="keywordflow">if</span> (FILENAME_CMP (rule-&gt;<a class="code" href="structsubstitute__path__rule.html#aebfd17c1e5dbdc7f1d2805b9e928b285">from</a>, from) == 0)
<a name="l01788"></a>01788         <span class="keywordflow">return</span> rule;
<a name="l01789"></a>01789       rule = rule-&gt;<a class="code" href="structsubstitute__path__rule.html#a530e032d033496b1a1376ed742964a3b">next</a>;
<a name="l01790"></a>01790     }
<a name="l01791"></a>01791 
<a name="l01792"></a>01792   <span class="keywordflow">return</span> NULL;
<a name="l01793"></a>01793 }
<a name="l01794"></a>01794 
<a name="l01795"></a>01795 <span class="comment">/* Add a new substitute-path rule at the end of the current list of rules.</span>
<a name="l01796"></a>01796 <span class="comment">   The new rule will replace FROM into TO.  */</span>
<a name="l01797"></a>01797 
<a name="l01798"></a>01798 <span class="keywordtype">void</span>
<a name="l01799"></a><a class="code" href="source_8h.html#a5235b73fdefbcd2afb26184bf54cac74">01799</a> <a class="code" href="source_8c.html#a3f0f69589d81d692117bbeb368b3cf74">add_substitute_path_rule</a> (<span class="keywordtype">char</span> *<a class="code" href="varobj_8h.html#a43396decd62b46fa01cc6c66a84cbba1">from</a>, <span class="keywordtype">char</span> *<a class="code" href="varobj_8h.html#ae2a2635825813434f3201bf8ace439d2">to</a>)
<a name="l01800"></a>01800 {
<a name="l01801"></a>01801   <span class="keyword">struct </span><a class="code" href="structsubstitute__path__rule.html">substitute_path_rule</a> *rule;
<a name="l01802"></a>01802   <span class="keyword">struct </span><a class="code" href="structsubstitute__path__rule.html">substitute_path_rule</a> *new_rule;
<a name="l01803"></a>01803 
<a name="l01804"></a>01804   new_rule = <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (<span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structsubstitute__path__rule.html">substitute_path_rule</a>));
<a name="l01805"></a>01805   new_rule-&gt;<a class="code" href="structsubstitute__path__rule.html#aebfd17c1e5dbdc7f1d2805b9e928b285">from</a> = xstrdup (from);
<a name="l01806"></a>01806   new_rule-&gt;<a class="code" href="structsubstitute__path__rule.html#a281aebac622618a3a880138d7f48962a">to</a> = xstrdup (to);
<a name="l01807"></a>01807   new_rule-&gt;<a class="code" href="structsubstitute__path__rule.html#a530e032d033496b1a1376ed742964a3b">next</a> = NULL;
<a name="l01808"></a>01808 
<a name="l01809"></a>01809   <span class="comment">/* If the list of rules are empty, then insert the new rule</span>
<a name="l01810"></a>01810 <span class="comment">     at the head of the list.  */</span>
<a name="l01811"></a>01811 
<a name="l01812"></a>01812   <span class="keywordflow">if</span> (substitute_path_rules == NULL)
<a name="l01813"></a>01813     {
<a name="l01814"></a>01814       substitute_path_rules = new_rule;
<a name="l01815"></a>01815       <span class="keywordflow">return</span>;
<a name="l01816"></a>01816     }
<a name="l01817"></a>01817 
<a name="l01818"></a>01818   <span class="comment">/* Otherwise, skip to the last rule in our list and then append</span>
<a name="l01819"></a>01819 <span class="comment">     the new rule.  */</span>
<a name="l01820"></a>01820 
<a name="l01821"></a>01821   rule = <a class="code" href="source_8c.html#ae472785cbb06089dd2d492e5bd3dd535">substitute_path_rules</a>;
<a name="l01822"></a>01822   <span class="keywordflow">while</span> (rule-&gt;<a class="code" href="structsubstitute__path__rule.html#a530e032d033496b1a1376ed742964a3b">next</a> != NULL)
<a name="l01823"></a>01823     rule = rule-&gt;<a class="code" href="structsubstitute__path__rule.html#a530e032d033496b1a1376ed742964a3b">next</a>;
<a name="l01824"></a>01824 
<a name="l01825"></a>01825   rule-&gt;<a class="code" href="structsubstitute__path__rule.html#a530e032d033496b1a1376ed742964a3b">next</a> = new_rule;
<a name="l01826"></a>01826 }
<a name="l01827"></a>01827 
<a name="l01828"></a>01828 <span class="comment">/* Remove the given source path substitution rule from the current list</span>
<a name="l01829"></a>01829 <span class="comment">   of rules.  The memory allocated for that rule is also deallocated.  */</span>
<a name="l01830"></a>01830 
<a name="l01831"></a>01831 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01832"></a><a class="code" href="source_8c.html#a74fe4504d74f6eee3cf7dbb33020d4d4">01832</a> <a class="code" href="source_8c.html#a74fe4504d74f6eee3cf7dbb33020d4d4">delete_substitute_path_rule</a> (<span class="keyword">struct</span> <a class="code" href="structsubstitute__path__rule.html">substitute_path_rule</a> *rule)
<a name="l01833"></a>01833 {
<a name="l01834"></a>01834   <span class="keywordflow">if</span> (rule == substitute_path_rules)
<a name="l01835"></a>01835     substitute_path_rules = rule-&gt;<a class="code" href="structsubstitute__path__rule.html#a530e032d033496b1a1376ed742964a3b">next</a>;
<a name="l01836"></a>01836   <span class="keywordflow">else</span>
<a name="l01837"></a>01837     {
<a name="l01838"></a>01838       <span class="keyword">struct </span><a class="code" href="structsubstitute__path__rule.html">substitute_path_rule</a> *prev = <a class="code" href="source_8c.html#ae472785cbb06089dd2d492e5bd3dd535">substitute_path_rules</a>;
<a name="l01839"></a>01839 
<a name="l01840"></a>01840       <span class="keywordflow">while</span> (prev != NULL &amp;&amp; prev-&gt;<a class="code" href="structsubstitute__path__rule.html#a530e032d033496b1a1376ed742964a3b">next</a> != rule)
<a name="l01841"></a>01841         prev = prev-&gt;<a class="code" href="structsubstitute__path__rule.html#a530e032d033496b1a1376ed742964a3b">next</a>;
<a name="l01842"></a>01842 
<a name="l01843"></a>01843       <a class="code" href="gdb__assert_8h.html#aeb007d3e990858c7ef8e40a7e512c1ff">gdb_assert</a> (prev != NULL);
<a name="l01844"></a>01844 
<a name="l01845"></a>01845       prev-&gt;<a class="code" href="structsubstitute__path__rule.html#a530e032d033496b1a1376ed742964a3b">next</a> = rule-&gt;<a class="code" href="structsubstitute__path__rule.html#a530e032d033496b1a1376ed742964a3b">next</a>;
<a name="l01846"></a>01846     }
<a name="l01847"></a>01847 
<a name="l01848"></a>01848   <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (rule-&gt;<a class="code" href="structsubstitute__path__rule.html#aebfd17c1e5dbdc7f1d2805b9e928b285">from</a>);
<a name="l01849"></a>01849   <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (rule-&gt;<a class="code" href="structsubstitute__path__rule.html#a281aebac622618a3a880138d7f48962a">to</a>);
<a name="l01850"></a>01850   <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (rule);
<a name="l01851"></a>01851 }
<a name="l01852"></a>01852 
<a name="l01853"></a>01853 <span class="comment">/* Implement the &quot;show substitute-path&quot; command.  */</span>
<a name="l01854"></a>01854 
<a name="l01855"></a>01855 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01856"></a><a class="code" href="source_8c.html#a385f3a7bba6a7635a7692d2247438495">01856</a> <a class="code" href="source_8c.html#a385f3a7bba6a7635a7692d2247438495">show_substitute_path_command</a> (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l01857"></a>01857 {
<a name="l01858"></a>01858   <span class="keyword">struct </span><a class="code" href="structsubstitute__path__rule.html">substitute_path_rule</a> *rule = <a class="code" href="source_8c.html#ae472785cbb06089dd2d492e5bd3dd535">substitute_path_rules</a>;
<a name="l01859"></a>01859   <span class="keywordtype">char</span> **argv;
<a name="l01860"></a>01860   <span class="keywordtype">char</span> *<a class="code" href="varobj_8h.html#a43396decd62b46fa01cc6c66a84cbba1">from</a> = NULL;
<a name="l01861"></a>01861   <span class="keyword">struct </span><a class="code" href="structcleanup.html">cleanup</a> *<a class="code" href="structcleanup.html">cleanup</a>;
<a name="l01862"></a>01862   
<a name="l01863"></a>01863   argv = <a class="code" href="utils_8c.html#a146bf06d6062174a10a36700c40fdae4">gdb_buildargv</a> (args);
<a name="l01864"></a>01864   cleanup = <a class="code" href="utils_8c.html#aad1e14fe73668592441775f7346f558e">make_cleanup_freeargv</a> (argv);
<a name="l01865"></a>01865 
<a name="l01866"></a>01866   <span class="comment">/* We expect zero or one argument.  */</span>
<a name="l01867"></a>01867 
<a name="l01868"></a>01868   <span class="keywordflow">if</span> (argv != NULL &amp;&amp; argv[0] != NULL &amp;&amp; argv[1] != NULL)
<a name="l01869"></a>01869     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Too many arguments in command&quot;</span>));
<a name="l01870"></a>01870 
<a name="l01871"></a>01871   <span class="keywordflow">if</span> (argv != NULL &amp;&amp; argv[0] != NULL)
<a name="l01872"></a>01872     from = argv[0];
<a name="l01873"></a>01873 
<a name="l01874"></a>01874   <span class="comment">/* Print the substitution rules.  */</span>
<a name="l01875"></a>01875 
<a name="l01876"></a>01876   <span class="keywordflow">if</span> (from != NULL)
<a name="l01877"></a>01877     <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a>
<a name="l01878"></a>01878       (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Source path substitution rule matching `%s&#39;:\n&quot;</span>), from);
<a name="l01879"></a>01879   <span class="keywordflow">else</span>
<a name="l01880"></a>01880     <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;List of all source path substitution rules:\n&quot;</span>));
<a name="l01881"></a>01881 
<a name="l01882"></a>01882   <span class="keywordflow">while</span> (rule != NULL)
<a name="l01883"></a>01883     {
<a name="l01884"></a>01884       <span class="keywordflow">if</span> (from == NULL || FILENAME_CMP (rule-&gt;<a class="code" href="structsubstitute__path__rule.html#aebfd17c1e5dbdc7f1d2805b9e928b285">from</a>, from) == 0)
<a name="l01885"></a>01885         <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;  `%s&#39; -&gt; `%s&#39;.\n&quot;</span>, rule-&gt;<a class="code" href="structsubstitute__path__rule.html#aebfd17c1e5dbdc7f1d2805b9e928b285">from</a>, rule-&gt;<a class="code" href="structsubstitute__path__rule.html#a281aebac622618a3a880138d7f48962a">to</a>);
<a name="l01886"></a>01886       rule = rule-&gt;<a class="code" href="structsubstitute__path__rule.html#a530e032d033496b1a1376ed742964a3b">next</a>;
<a name="l01887"></a>01887     }
<a name="l01888"></a>01888 
<a name="l01889"></a>01889   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup);
<a name="l01890"></a>01890 }
<a name="l01891"></a>01891 
<a name="l01892"></a>01892 <span class="comment">/* Implement the &quot;unset substitute-path&quot; command.  */</span>
<a name="l01893"></a>01893 
<a name="l01894"></a>01894 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01895"></a><a class="code" href="source_8c.html#a7e2349d671fe1a977ea3c48f5e3314a2">01895</a> <a class="code" href="source_8c.html#a7e2349d671fe1a977ea3c48f5e3314a2">unset_substitute_path_command</a> (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l01896"></a>01896 {
<a name="l01897"></a>01897   <span class="keyword">struct </span><a class="code" href="structsubstitute__path__rule.html">substitute_path_rule</a> *rule = <a class="code" href="source_8c.html#ae472785cbb06089dd2d492e5bd3dd535">substitute_path_rules</a>;
<a name="l01898"></a>01898   <span class="keywordtype">char</span> **argv = <a class="code" href="utils_8c.html#a146bf06d6062174a10a36700c40fdae4">gdb_buildargv</a> (args);
<a name="l01899"></a>01899   <span class="keywordtype">char</span> *<a class="code" href="varobj_8h.html#a43396decd62b46fa01cc6c66a84cbba1">from</a> = NULL;
<a name="l01900"></a>01900   <span class="keywordtype">int</span> rule_found = 0;
<a name="l01901"></a>01901   <span class="keyword">struct </span><a class="code" href="structcleanup.html">cleanup</a> *<a class="code" href="structcleanup.html">cleanup</a>;
<a name="l01902"></a>01902 
<a name="l01903"></a>01903   <span class="comment">/* This function takes either 0 or 1 argument.  */</span>
<a name="l01904"></a>01904 
<a name="l01905"></a>01905   cleanup = <a class="code" href="utils_8c.html#aad1e14fe73668592441775f7346f558e">make_cleanup_freeargv</a> (argv);
<a name="l01906"></a>01906   <span class="keywordflow">if</span> (argv != NULL &amp;&amp; argv[0] != NULL &amp;&amp; argv[1] != NULL)
<a name="l01907"></a>01907     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Incorrect usage, too many arguments in command&quot;</span>));
<a name="l01908"></a>01908 
<a name="l01909"></a>01909   <span class="keywordflow">if</span> (argv != NULL &amp;&amp; argv[0] != NULL)
<a name="l01910"></a>01910     from = argv[0];
<a name="l01911"></a>01911 
<a name="l01912"></a>01912   <span class="comment">/* If the user asked for all the rules to be deleted, ask him</span>
<a name="l01913"></a>01913 <span class="comment">     to confirm and give him a chance to abort before the action</span>
<a name="l01914"></a>01914 <span class="comment">     is performed.  */</span>
<a name="l01915"></a>01915 
<a name="l01916"></a>01916   <span class="keywordflow">if</span> (from == NULL
<a name="l01917"></a>01917       &amp;&amp; !<a class="code" href="utils_8c.html#a4b369431cd1ce5d26bccf6b79a44c085">query</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Delete all source path substitution rules? &quot;</span>)))
<a name="l01918"></a>01918     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Canceled&quot;</span>));
<a name="l01919"></a>01919 
<a name="l01920"></a>01920   <span class="comment">/* Delete the rule matching the argument.  No argument means that</span>
<a name="l01921"></a>01921 <span class="comment">     all rules should be deleted.  */</span>
<a name="l01922"></a>01922 
<a name="l01923"></a>01923   <span class="keywordflow">while</span> (rule != NULL)
<a name="l01924"></a>01924     {
<a name="l01925"></a>01925       <span class="keyword">struct </span><a class="code" href="structsubstitute__path__rule.html">substitute_path_rule</a> *<a class="code" href="structsubstitute__path__rule.html#a530e032d033496b1a1376ed742964a3b">next</a> = rule-&gt;<a class="code" href="structsubstitute__path__rule.html#a530e032d033496b1a1376ed742964a3b">next</a>;
<a name="l01926"></a>01926 
<a name="l01927"></a>01927       <span class="keywordflow">if</span> (from == NULL || FILENAME_CMP (from, rule-&gt;<a class="code" href="structsubstitute__path__rule.html#aebfd17c1e5dbdc7f1d2805b9e928b285">from</a>) == 0)
<a name="l01928"></a>01928         {
<a name="l01929"></a>01929           <a class="code" href="source_8c.html#a74fe4504d74f6eee3cf7dbb33020d4d4">delete_substitute_path_rule</a> (rule);
<a name="l01930"></a>01930           rule_found = 1;
<a name="l01931"></a>01931         }
<a name="l01932"></a>01932 
<a name="l01933"></a>01933       rule = <a class="code" href="structsubstitute__path__rule.html#a530e032d033496b1a1376ed742964a3b">next</a>;
<a name="l01934"></a>01934     }
<a name="l01935"></a>01935   
<a name="l01936"></a>01936   <span class="comment">/* If the user asked for a specific rule to be deleted but</span>
<a name="l01937"></a>01937 <span class="comment">     we could not find it, then report an error.  */</span>
<a name="l01938"></a>01938 
<a name="l01939"></a>01939   <span class="keywordflow">if</span> (from != NULL &amp;&amp; !rule_found)
<a name="l01940"></a>01940     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No substitution rule defined for `%s&#39;&quot;</span>), from);
<a name="l01941"></a>01941 
<a name="l01942"></a>01942   <a class="code" href="source_8c.html#a5b2639f3f85c2b17fca0c39fe5fcd461">forget_cached_source_info</a> ();
<a name="l01943"></a>01943 
<a name="l01944"></a>01944   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup);
<a name="l01945"></a>01945 }
<a name="l01946"></a>01946 
<a name="l01947"></a>01947 <span class="comment">/* Add a new source path substitution rule.  */</span>
<a name="l01948"></a>01948 
<a name="l01949"></a>01949 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01950"></a><a class="code" href="source_8c.html#a41156839a696509a3092ef0bde04f2a3">01950</a> <a class="code" href="source_8c.html#a41156839a696509a3092ef0bde04f2a3">set_substitute_path_command</a> (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l01951"></a>01951 {
<a name="l01952"></a>01952   <span class="keywordtype">char</span> **argv;
<a name="l01953"></a>01953   <span class="keyword">struct </span><a class="code" href="structsubstitute__path__rule.html">substitute_path_rule</a> *rule;
<a name="l01954"></a>01954   <span class="keyword">struct </span><a class="code" href="structcleanup.html">cleanup</a> *<a class="code" href="structcleanup.html">cleanup</a>;
<a name="l01955"></a>01955   
<a name="l01956"></a>01956   argv = <a class="code" href="utils_8c.html#a146bf06d6062174a10a36700c40fdae4">gdb_buildargv</a> (args);
<a name="l01957"></a>01957   cleanup = <a class="code" href="utils_8c.html#aad1e14fe73668592441775f7346f558e">make_cleanup_freeargv</a> (argv);
<a name="l01958"></a>01958 
<a name="l01959"></a>01959   <span class="keywordflow">if</span> (argv == NULL || argv[0] == NULL || argv [1] == NULL)
<a name="l01960"></a>01960     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Incorrect usage, too few arguments in command&quot;</span>));
<a name="l01961"></a>01961 
<a name="l01962"></a>01962   <span class="keywordflow">if</span> (argv[2] != NULL)
<a name="l01963"></a>01963     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Incorrect usage, too many arguments in command&quot;</span>));
<a name="l01964"></a>01964 
<a name="l01965"></a>01965   <span class="keywordflow">if</span> (*(argv[0]) == <span class="charliteral">&#39;\0&#39;</span>)
<a name="l01966"></a>01966     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;First argument must be at least one character long&quot;</span>));
<a name="l01967"></a>01967 
<a name="l01968"></a>01968   <span class="comment">/* Strip any trailing directory separator character in either FROM</span>
<a name="l01969"></a>01969 <span class="comment">     or TO.  The substitution rule already implicitly contains them.  */</span>
<a name="l01970"></a>01970   <a class="code" href="source_8c.html#a474ecc49057d594d5958a6bb68cbfd9d">strip_trailing_directory_separator</a> (argv[0]);
<a name="l01971"></a>01971   <a class="code" href="source_8c.html#a474ecc49057d594d5958a6bb68cbfd9d">strip_trailing_directory_separator</a> (argv[1]);
<a name="l01972"></a>01972 
<a name="l01973"></a>01973   <span class="comment">/* If a rule with the same &quot;from&quot; was previously defined, then</span>
<a name="l01974"></a>01974 <span class="comment">     delete it.  This new rule replaces it.  */</span>
<a name="l01975"></a>01975 
<a name="l01976"></a>01976   rule = <a class="code" href="source_8c.html#a0b7b58f638f254a6c6e447738d01d6b6">find_substitute_path_rule</a> (argv[0]);
<a name="l01977"></a>01977   <span class="keywordflow">if</span> (rule != NULL)
<a name="l01978"></a>01978     <a class="code" href="source_8c.html#a74fe4504d74f6eee3cf7dbb33020d4d4">delete_substitute_path_rule</a> (rule);
<a name="l01979"></a>01979       
<a name="l01980"></a>01980   <span class="comment">/* Insert the new substitution rule.  */</span>
<a name="l01981"></a>01981 
<a name="l01982"></a>01982   <a class="code" href="source_8c.html#a3f0f69589d81d692117bbeb368b3cf74">add_substitute_path_rule</a> (argv[0], argv[1]);
<a name="l01983"></a>01983   <a class="code" href="source_8c.html#a5b2639f3f85c2b17fca0c39fe5fcd461">forget_cached_source_info</a> ();
<a name="l01984"></a>01984 
<a name="l01985"></a>01985   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup);
<a name="l01986"></a>01986 }
<a name="l01987"></a>01987 
<a name="l01988"></a>01988 
<a name="l01989"></a>01989 <span class="keywordtype">void</span>
<a name="l01990"></a><a class="code" href="init_8c.html#a7af325136a76d8ee4ce928693949ecf3">01990</a> <a class="code" href="init_8c.html#a7af325136a76d8ee4ce928693949ecf3">_initialize_source</a> (<span class="keywordtype">void</span>)
<a name="l01991"></a>01991 {
<a name="l01992"></a>01992   <span class="keyword">struct </span><a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c;
<a name="l01993"></a>01993 
<a name="l01994"></a>01994   current_source_symtab = 0;
<a name="l01995"></a>01995   <a class="code" href="defs_8h.html#a72f599c515e8750e28204a36ef460c24">init_source_path</a> ();
<a name="l01996"></a>01996 
<a name="l01997"></a>01997   <span class="comment">/* The intention is to use POSIX Basic Regular Expressions.</span>
<a name="l01998"></a>01998 <span class="comment">     Always use the GNU regex routine for consistency across all hosts.</span>
<a name="l01999"></a>01999 <span class="comment">     Our current GNU regex.c does not have all the POSIX features, so this is</span>
<a name="l02000"></a>02000 <span class="comment">     just an approximation.  */</span>
<a name="l02001"></a>02001   re_set_syntax (RE_SYNTAX_GREP);
<a name="l02002"></a>02002 
<a name="l02003"></a>02003   c = <a class="code" href="cli-decode_8c.html#ab87b0ba51ed9aa4c8aac0c96373537f8">add_cmd</a> (<span class="stringliteral">&quot;directory&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49aea9c092d047271fd884ae32149463054">class_files</a>, <a class="code" href="source_8c.html#ab23f96fa0023f6423d40195972a5f6c9">directory_command</a>, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l02004"></a>02004 <span class="stringliteral">Add directory DIR to beginning of search path for source files.\n\</span>
<a name="l02005"></a>02005 <span class="stringliteral">Forget cached info on source file locations and line positions.\n\</span>
<a name="l02006"></a>02006 <span class="stringliteral">DIR can also be $cwd for the current working directory, or $cdir for the\n\</span>
<a name="l02007"></a>02007 <span class="stringliteral">directory in which the source file was compiled into object code.\n\</span>
<a name="l02008"></a>02008 <span class="stringliteral">With no argument, reset the search path to $cdir:$cwd, the default.&quot;</span>),
<a name="l02009"></a>02009                &amp;<a class="code" href="cli-cmds_8c.html#a6b7ab0355d0fa8d6ce7d5feb83ff78e7">cmdlist</a>);
<a name="l02010"></a>02010 
<a name="l02011"></a>02011   <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a05c64837f5abc518eec4f97238728111">dbx_commands</a>)
<a name="l02012"></a>02012     <a class="code" href="cli-decode_8c.html#aeeea74da863db26c8d7fee1573f26a05">add_com_alias</a> (<span class="stringliteral">&quot;use&quot;</span>, <span class="stringliteral">&quot;directory&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49aea9c092d047271fd884ae32149463054">class_files</a>, 0);
<a name="l02013"></a>02013 
<a name="l02014"></a>02014   <a class="code" href="command_8h.html#abe42a75e35cfa78e2574e94904d86713">set_cmd_completer</a> (c, filename_completer);
<a name="l02015"></a>02015 
<a name="l02016"></a>02016   <a class="code" href="cli-decode_8c.html#a47cdf41908a640a5cc5cbd4a00491595">add_setshow_optional_filename_cmd</a> (<span class="stringliteral">&quot;directories&quot;</span>,
<a name="l02017"></a>02017                                      <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49aea9c092d047271fd884ae32149463054">class_files</a>,
<a name="l02018"></a>02018                                      &amp;<a class="code" href="defs_8h.html#a7185b9daf1af3b15efc4d777cc2986b4">source_path</a>,
<a name="l02019"></a>02019                                      <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l02020"></a>02020 <span class="stringliteral">Set the search path for finding source files.&quot;</span>),
<a name="l02021"></a>02021                                      <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l02022"></a>02022 <span class="stringliteral">Show the search path for finding source files.&quot;</span>),
<a name="l02023"></a>02023                                      <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l02024"></a>02024 <span class="stringliteral">$cwd in the path means the current working directory.\n\</span>
<a name="l02025"></a>02025 <span class="stringliteral">$cdir in the path means the compilation directory of the source file.\n\</span>
<a name="l02026"></a>02026 <span class="stringliteral">GDB ensures the search path always ends with $cdir:$cwd by\n\</span>
<a name="l02027"></a>02027 <span class="stringliteral">appending these directories if necessary.\n\</span>
<a name="l02028"></a>02028 <span class="stringliteral">Setting the value to an empty string sets it to $cdir:$cwd, the default.&quot;</span>),
<a name="l02029"></a>02029                             <a class="code" href="source_8c.html#aec996fa3fc8b025db35a634199ecc387">set_directories_command</a>,
<a name="l02030"></a>02030                             <a class="code" href="source_8c.html#a2925a754cc9aaeb2a1cfbfa51330b218">show_directories_command</a>,
<a name="l02031"></a>02031                             &amp;<a class="code" href="cli-cmds_8c.html#a723e0174d833cba0aa82fb936a56c8fa">setlist</a>, &amp;<a class="code" href="cli-cmds_8c.html#a003932aa76fd3f41763ecc6bee5e2ca8">showlist</a>);
<a name="l02032"></a>02032 
<a name="l02033"></a>02033   <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a195fb001f0890cfc064403357feecca1">xdb_commands</a>)
<a name="l02034"></a>02034     {
<a name="l02035"></a>02035       <a class="code" href="cli-decode_8c.html#aeeea74da863db26c8d7fee1573f26a05">add_com_alias</a> (<span class="stringliteral">&quot;D&quot;</span>, <span class="stringliteral">&quot;directory&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49aea9c092d047271fd884ae32149463054">class_files</a>, 0);
<a name="l02036"></a>02036       <a class="code" href="cli-decode_8c.html#ab87b0ba51ed9aa4c8aac0c96373537f8">add_cmd</a> (<span class="stringliteral">&quot;ld&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49afbf489a4abce7e8770b178aa54f0908b">no_class</a>, <a class="code" href="source_8c.html#a1305f7de7625e47f80fa2f5e07dfe009">show_directories_1</a>, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l02037"></a>02037 <span class="stringliteral">Current search path for finding source files.\n\</span>
<a name="l02038"></a>02038 <span class="stringliteral">$cwd in the path means the current working directory.\n\</span>
<a name="l02039"></a>02039 <span class="stringliteral">$cdir in the path means the compilation directory of the source file.&quot;</span>),
<a name="l02040"></a>02040                &amp;<a class="code" href="cli-cmds_8c.html#a6b7ab0355d0fa8d6ce7d5feb83ff78e7">cmdlist</a>);
<a name="l02041"></a>02041     }
<a name="l02042"></a>02042 
<a name="l02043"></a>02043   <a class="code" href="cli-decode_8c.html#a9f6cd2f7798c32a7a27cab617e71cf6a">add_info</a> (<span class="stringliteral">&quot;source&quot;</span>, <a class="code" href="source_8c.html#a1f0220396aeed38af058dfe824accace">source_info</a>,
<a name="l02044"></a>02044             <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Information about the current source file.&quot;</span>));
<a name="l02045"></a>02045 
<a name="l02046"></a>02046   <a class="code" href="cli-decode_8c.html#a9f6cd2f7798c32a7a27cab617e71cf6a">add_info</a> (<span class="stringliteral">&quot;line&quot;</span>, <a class="code" href="source_8c.html#a360ce6d238b653379f578a32c71c0e57">line_info</a>, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l02047"></a>02047 <span class="stringliteral">Core addresses of the code for a source line.\n\</span>
<a name="l02048"></a>02048 <span class="stringliteral">Line can be specified as\n\</span>
<a name="l02049"></a>02049 <span class="stringliteral">  LINENUM, to list around that line in current file,\n\</span>
<a name="l02050"></a>02050 <span class="stringliteral">  FILE:LINENUM, to list around that line in that file,\n\</span>
<a name="l02051"></a>02051 <span class="stringliteral">  FUNCTION, to list around beginning of that function,\n\</span>
<a name="l02052"></a>02052 <span class="stringliteral">  FILE:FUNCTION, to distinguish among like-named static functions.\n\</span>
<a name="l02053"></a>02053 <span class="stringliteral">Default is to describe the last source line that was listed.\n\n\</span>
<a name="l02054"></a>02054 <span class="stringliteral">This sets the default address for \&quot;x\&quot; to the line&#39;s first instruction\n\</span>
<a name="l02055"></a>02055 <span class="stringliteral">so that \&quot;x/i\&quot; suffices to start examining the machine code.\n\</span>
<a name="l02056"></a>02056 <span class="stringliteral">The address is also stored as the value of \&quot;$_\&quot;.&quot;</span>));
<a name="l02057"></a>02057 
<a name="l02058"></a>02058   <a class="code" href="cli-decode_8c.html#a0df0ca36d9acd96440e24407cbef593c">add_com</a> (<span class="stringliteral">&quot;forward-search&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49aea9c092d047271fd884ae32149463054">class_files</a>, <a class="code" href="source_8c.html#ac52933592b1c243ad86c3d3df70cb2e3">forward_search_command</a>, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l02059"></a>02059 <span class="stringliteral">Search for regular expression (see regex(3)) from last line listed.\n\</span>
<a name="l02060"></a>02060 <span class="stringliteral">The matching line number is also stored as the value of \&quot;$_\&quot;.&quot;</span>));
<a name="l02061"></a>02061   <a class="code" href="cli-decode_8c.html#aeeea74da863db26c8d7fee1573f26a05">add_com_alias</a> (<span class="stringliteral">&quot;search&quot;</span>, <span class="stringliteral">&quot;forward-search&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49aea9c092d047271fd884ae32149463054">class_files</a>, 0);
<a name="l02062"></a>02062   <a class="code" href="cli-decode_8c.html#aeeea74da863db26c8d7fee1573f26a05">add_com_alias</a> (<span class="stringliteral">&quot;fo&quot;</span>, <span class="stringliteral">&quot;forward-search&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49aea9c092d047271fd884ae32149463054">class_files</a>, 1);
<a name="l02063"></a>02063 
<a name="l02064"></a>02064   <a class="code" href="cli-decode_8c.html#a0df0ca36d9acd96440e24407cbef593c">add_com</a> (<span class="stringliteral">&quot;reverse-search&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49aea9c092d047271fd884ae32149463054">class_files</a>, <a class="code" href="source_8c.html#a29ccead27af7ed8aa350d5d322b75bde">reverse_search_command</a>, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l02065"></a>02065 <span class="stringliteral">Search backward for regular expression (see regex(3)) from last line listed.\n\</span>
<a name="l02066"></a>02066 <span class="stringliteral">The matching line number is also stored as the value of \&quot;$_\&quot;.&quot;</span>));
<a name="l02067"></a>02067   <a class="code" href="cli-decode_8c.html#aeeea74da863db26c8d7fee1573f26a05">add_com_alias</a> (<span class="stringliteral">&quot;rev&quot;</span>, <span class="stringliteral">&quot;reverse-search&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49aea9c092d047271fd884ae32149463054">class_files</a>, 1);
<a name="l02068"></a>02068 
<a name="l02069"></a>02069   <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a195fb001f0890cfc064403357feecca1">xdb_commands</a>)
<a name="l02070"></a>02070     {
<a name="l02071"></a>02071       <a class="code" href="cli-decode_8c.html#aeeea74da863db26c8d7fee1573f26a05">add_com_alias</a> (<span class="stringliteral">&quot;/&quot;</span>, <span class="stringliteral">&quot;forward-search&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49aea9c092d047271fd884ae32149463054">class_files</a>, 0);
<a name="l02072"></a>02072       <a class="code" href="cli-decode_8c.html#aeeea74da863db26c8d7fee1573f26a05">add_com_alias</a> (<span class="stringliteral">&quot;?&quot;</span>, <span class="stringliteral">&quot;reverse-search&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49aea9c092d047271fd884ae32149463054">class_files</a>, 0);
<a name="l02073"></a>02073     }
<a name="l02074"></a>02074 
<a name="l02075"></a>02075   <a class="code" href="cli-decode_8c.html#a2ce1e8d74152509908e59af4ddc5c69f">add_setshow_integer_cmd</a> (<span class="stringliteral">&quot;listsize&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49a92be6efbab6bd9647a6f7a2862712d9b">class_support</a>, &amp;<a class="code" href="source_8c.html#adf96a46f26a6e6235d9bb0e4a29367bb">lines_to_list</a>, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l02076"></a>02076 <span class="stringliteral">Set number of source lines gdb will list by default.&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l02077"></a>02077 <span class="stringliteral">Show number of source lines gdb will list by default.&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l02078"></a>02078 <span class="stringliteral">Use this to choose how many source lines the \&quot;list\&quot; displays (unless\n\</span>
<a name="l02079"></a>02079 <span class="stringliteral">the \&quot;list\&quot; argument explicitly specifies some other number).\n\</span>
<a name="l02080"></a>02080 <span class="stringliteral">A value of \&quot;unlimited\&quot;, or zero, means there&#39;s no limit.&quot;</span>),
<a name="l02081"></a>02081                             NULL,
<a name="l02082"></a>02082                             <a class="code" href="source_8c.html#a4a345e75bec5b2239c92716040dd5dcd">show_lines_to_list</a>,
<a name="l02083"></a>02083                             &amp;<a class="code" href="cli-cmds_8c.html#a723e0174d833cba0aa82fb936a56c8fa">setlist</a>, &amp;<a class="code" href="cli-cmds_8c.html#a003932aa76fd3f41763ecc6bee5e2ca8">showlist</a>);
<a name="l02084"></a>02084 
<a name="l02085"></a>02085   <a class="code" href="cli-decode_8c.html#ab87b0ba51ed9aa4c8aac0c96373537f8">add_cmd</a> (<span class="stringliteral">&quot;substitute-path&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49aea9c092d047271fd884ae32149463054">class_files</a>, <a class="code" href="source_8c.html#a41156839a696509a3092ef0bde04f2a3">set_substitute_path_command</a>,
<a name="l02086"></a>02086            <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l02087"></a>02087 <span class="stringliteral">Usage: set substitute-path FROM TO\n\</span>
<a name="l02088"></a>02088 <span class="stringliteral">Add a substitution rule replacing FROM into TO in source file names.\n\</span>
<a name="l02089"></a>02089 <span class="stringliteral">If a substitution rule was previously set for FROM, the old rule\n\</span>
<a name="l02090"></a>02090 <span class="stringliteral">is replaced by the new one.&quot;</span>),
<a name="l02091"></a>02091            &amp;<a class="code" href="cli-cmds_8c.html#a723e0174d833cba0aa82fb936a56c8fa">setlist</a>);
<a name="l02092"></a>02092 
<a name="l02093"></a>02093   <a class="code" href="cli-decode_8c.html#ab87b0ba51ed9aa4c8aac0c96373537f8">add_cmd</a> (<span class="stringliteral">&quot;substitute-path&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49aea9c092d047271fd884ae32149463054">class_files</a>, <a class="code" href="source_8c.html#a7e2349d671fe1a977ea3c48f5e3314a2">unset_substitute_path_command</a>,
<a name="l02094"></a>02094            <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l02095"></a>02095 <span class="stringliteral">Usage: unset substitute-path [FROM]\n\</span>
<a name="l02096"></a>02096 <span class="stringliteral">Delete the rule for substituting FROM in source file names.  If FROM\n\</span>
<a name="l02097"></a>02097 <span class="stringliteral">is not specified, all substituting rules are deleted.\n\</span>
<a name="l02098"></a>02098 <span class="stringliteral">If the debugger cannot find a rule for FROM, it will display a warning.&quot;</span>),
<a name="l02099"></a>02099            &amp;<a class="code" href="cli-cmds_8c.html#af91616d63405a407dd7cc050ff951c23">unsetlist</a>);
<a name="l02100"></a>02100 
<a name="l02101"></a>02101   <a class="code" href="cli-decode_8c.html#ab87b0ba51ed9aa4c8aac0c96373537f8">add_cmd</a> (<span class="stringliteral">&quot;substitute-path&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49aea9c092d047271fd884ae32149463054">class_files</a>, <a class="code" href="source_8c.html#a385f3a7bba6a7635a7692d2247438495">show_substitute_path_command</a>,
<a name="l02102"></a>02102            <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l02103"></a>02103 <span class="stringliteral">Usage: show substitute-path [FROM]\n\</span>
<a name="l02104"></a>02104 <span class="stringliteral">Print the rule for substituting FROM in source file names. If FROM\n\</span>
<a name="l02105"></a>02105 <span class="stringliteral">is not specified, print all substitution rules.&quot;</span>),
<a name="l02106"></a>02106            &amp;<a class="code" href="cli-cmds_8c.html#a003932aa76fd3f41763ecc6bee5e2ca8">showlist</a>);
<a name="l02107"></a>02107 
<a name="l02108"></a>02108   <a class="code" href="cli-decode_8c.html#a79332268b2efb4698434e6ddf4d8c00e">add_setshow_enum_cmd</a> (<span class="stringliteral">&quot;filename-display&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49aea9c092d047271fd884ae32149463054">class_files</a>,
<a name="l02109"></a>02109                         <a class="code" href="source_8c.html#a0c7dc515b78d11f0ec11d0da15dc7c2e">filename_display_kind_names</a>,
<a name="l02110"></a>02110                         &amp;<a class="code" href="source_8c.html#aa5ad22f3ba8d797f3bb32696f4e53ba3">filename_display_string</a>, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l02111"></a>02111 <span class="stringliteral">Set how to display filenames.&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l02112"></a>02112 <span class="stringliteral">Show how to display filenames.&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l02113"></a>02113 <span class="stringliteral">filename-display can be:\n\</span>
<a name="l02114"></a>02114 <span class="stringliteral">  basename - display only basename of a filename\n\</span>
<a name="l02115"></a>02115 <span class="stringliteral">  relative - display a filename relative to the compilation directory\n\</span>
<a name="l02116"></a>02116 <span class="stringliteral">  absolute - display an absolute filename\n\</span>
<a name="l02117"></a>02117 <span class="stringliteral">By default, relative filenames are displayed.&quot;</span>),
<a name="l02118"></a>02118                         NULL,
<a name="l02119"></a>02119                         <a class="code" href="source_8c.html#af5ca4f9f9974b249ed62afc1a56e5b5f">show_filename_display_string</a>,
<a name="l02120"></a>02120                         &amp;<a class="code" href="cli-cmds_8c.html#a723e0174d833cba0aa82fb936a56c8fa">setlist</a>, &amp;<a class="code" href="cli-cmds_8c.html#a003932aa76fd3f41763ecc6bee5e2ca8">showlist</a>);
<a name="l02121"></a>02121 
<a name="l02122"></a>02122 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Fri Oct 11 2013 14:13:33 for GDB (xrefs) by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
