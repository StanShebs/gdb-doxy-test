<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>GDB (API): /home/stan/gdb/src/gdb/arm-linux-tdep.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">GDB (API)
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">/home/stan/gdb/src/gdb/arm-linux-tdep.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="arm-linux-tdep_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* GNU/Linux on ARM target support.</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">   Copyright (C) 1999-2013 Free Software Foundation, Inc.</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">   This file is part of GDB.</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">   This program is free software; you can redistribute it and/or modify</span>
<a name="l00008"></a>00008 <span class="comment">   it under the terms of the GNU General Public License as published by</span>
<a name="l00009"></a>00009 <span class="comment">   the Free Software Foundation; either version 3 of the License, or</span>
<a name="l00010"></a>00010 <span class="comment">   (at your option) any later version.</span>
<a name="l00011"></a>00011 <span class="comment"></span>
<a name="l00012"></a>00012 <span class="comment">   This program is distributed in the hope that it will be useful,</span>
<a name="l00013"></a>00013 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00014"></a>00014 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00015"></a>00015 <span class="comment">   GNU General Public License for more details.</span>
<a name="l00016"></a>00016 <span class="comment"></span>
<a name="l00017"></a>00017 <span class="comment">   You should have received a copy of the GNU General Public License</span>
<a name="l00018"></a>00018 <span class="comment">   along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.  */</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="defs_8h.html">defs.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="target_8h.html">target.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="value_8h.html">value.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="gdbtypes_8h.html">gdbtypes.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;floatformat.h&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="gdbcore_8h.html">gdbcore.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="frame_8h.html">frame.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="regcache_8h.html">regcache.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="doublest_8h.html">doublest.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="solib-svr4_8h.html">solib-svr4.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="osabi_8h.html">osabi.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="regset_8h.html">regset.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="trad-frame_8h.html">trad-frame.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="tramp-frame_8h.html">tramp-frame.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="breakpoint_8h.html">breakpoint.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="auxv_8h.html">auxv.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="xml-syscall_8h.html">xml-syscall.h</a>&quot;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="arm-tdep_8h.html">arm-tdep.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="arm-linux-tdep_8h.html">arm-linux-tdep.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="linux-tdep_8h.html">linux-tdep.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="glibc-tdep_8h.html">glibc-tdep.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="arch-utils_8h.html">arch-utils.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="inferior_8h.html">inferior.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="gdbthread_8h.html">gdbthread.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="symfile_8h.html">symfile.h</a>&quot;</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="cli-utils_8h.html">cli/cli-utils.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="stap-probe_8h.html">stap-probe.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="parser-defs_8h.html">parser-defs.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="user-regs_8h.html">user-regs.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;elf/common.h&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="gdb__string_8h.html">gdb_string.h</a>&quot;</span>
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="arm-linux-nat_8c.html#a77dfd4d77596fabb416e373c5631335c">arm_apcs_32</a>;
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 <span class="comment">/* Under ARM GNU/Linux the traditional way of performing a breakpoint</span>
<a name="l00058"></a>00058 <span class="comment">   is to execute a particular software interrupt, rather than use a</span>
<a name="l00059"></a>00059 <span class="comment">   particular undefined instruction to provoke a trap.  Upon exection</span>
<a name="l00060"></a>00060 <span class="comment">   of the software interrupt the kernel stops the inferior with a</span>
<a name="l00061"></a>00061 <span class="comment">   SIGTRAP, and wakes the debugger.  */</span>
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> arm_linux_arm_le_breakpoint[] = { 0x01, 0x00, 0x9f, 0xef };
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> arm_linux_arm_be_breakpoint[] = { 0xef, 0x9f, 0x00, 0x01 };
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 <span class="comment">/* However, the EABI syscall interface (new in Nov. 2005) does not look at</span>
<a name="l00068"></a>00068 <span class="comment">   the operand of the swi if old-ABI compatibility is disabled.  Therefore,</span>
<a name="l00069"></a>00069 <span class="comment">   use an undefined instruction instead.  This is supported as of kernel</span>
<a name="l00070"></a>00070 <span class="comment">   version 2.5.70 (May 2003), so should be a safe assumption for EABI</span>
<a name="l00071"></a>00071 <span class="comment">   binaries.  */</span>
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> eabi_linux_arm_le_breakpoint[] = { 0xf0, 0x01, 0xf0, 0xe7 };
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> eabi_linux_arm_be_breakpoint[] = { 0xe7, 0xf0, 0x01, 0xf0 };
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 <span class="comment">/* All the kernels which support Thumb support using a specific undefined</span>
<a name="l00078"></a>00078 <span class="comment">   instruction for the Thumb breakpoint.  */</span>
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> arm_linux_thumb_be_breakpoint[] = {0xde, 0x01};
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> arm_linux_thumb_le_breakpoint[] = {0x01, 0xde};
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 <span class="comment">/* Because the 16-bit Thumb breakpoint is affected by Thumb-2 IT blocks,</span>
<a name="l00085"></a>00085 <span class="comment">   we must use a length-appropriate breakpoint for 32-bit Thumb</span>
<a name="l00086"></a>00086 <span class="comment">   instructions.  See also thumb_get_next_pc.  */</span>
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> arm_linux_thumb2_be_breakpoint[] = { 0xf7, 0xf0, 0xa0, 0x00 };
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> arm_linux_thumb2_le_breakpoint[] = { 0xf0, 0xf7, 0x00, 0xa0 };
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <span class="comment">/* Description of the longjmp buffer.  The buffer is treated as an array of </span>
<a name="l00093"></a>00093 <span class="comment">   elements of size ARM_LINUX_JB_ELEMENT_SIZE.</span>
<a name="l00094"></a>00094 <span class="comment"></span>
<a name="l00095"></a>00095 <span class="comment">   The location of saved registers in this buffer (in particular the PC</span>
<a name="l00096"></a>00096 <span class="comment">   to use after longjmp is called) varies depending on the ABI (in </span>
<a name="l00097"></a>00097 <span class="comment">   particular the FP model) and also (possibly) the C Library.</span>
<a name="l00098"></a>00098 <span class="comment"></span>
<a name="l00099"></a>00099 <span class="comment">   For glibc, eglibc, and uclibc the following holds:  If the FP model is </span>
<a name="l00100"></a>00100 <span class="comment">   SoftVFP or VFP (which implies EABI) then the PC is at offset 9 in the </span>
<a name="l00101"></a>00101 <span class="comment">   buffer.  This is also true for the SoftFPA model.  However, for the FPA </span>
<a name="l00102"></a>00102 <span class="comment">   model the PC is at offset 21 in the buffer.  */</span>
<a name="l00103"></a><a class="code" href="arm-linux-tdep_8c.html#a7a0af28d29998e961a81bccbb519a95b">00103</a> <span class="preprocessor">#define ARM_LINUX_JB_ELEMENT_SIZE       INT_REGISTER_SIZE</span>
<a name="l00104"></a><a class="code" href="arm-linux-tdep_8c.html#af0668fcaaac93f15aa8e787e25dab497">00104</a> <span class="preprocessor"></span><span class="preprocessor">#define ARM_LINUX_JB_PC_FPA             21</span>
<a name="l00105"></a><a class="code" href="arm-linux-tdep_8c.html#ad5669c9e15e549b2dbd4d2b6b98c8d2f">00105</a> <span class="preprocessor"></span><span class="preprocessor">#define ARM_LINUX_JB_PC_EABI            9</span>
<a name="l00106"></a>00106 <span class="preprocessor"></span>
<a name="l00107"></a>00107 <span class="comment">/*</span>
<a name="l00108"></a>00108 <span class="comment">   Dynamic Linking on ARM GNU/Linux</span>
<a name="l00109"></a>00109 <span class="comment">   --------------------------------</span>
<a name="l00110"></a>00110 <span class="comment"></span>
<a name="l00111"></a>00111 <span class="comment">   Note: PLT = procedure linkage table</span>
<a name="l00112"></a>00112 <span class="comment">   GOT = global offset table</span>
<a name="l00113"></a>00113 <span class="comment"></span>
<a name="l00114"></a>00114 <span class="comment">   As much as possible, ELF dynamic linking defers the resolution of</span>
<a name="l00115"></a>00115 <span class="comment">   jump/call addresses until the last minute.  The technique used is</span>
<a name="l00116"></a>00116 <span class="comment">   inspired by the i386 ELF design, and is based on the following</span>
<a name="l00117"></a>00117 <span class="comment">   constraints.</span>
<a name="l00118"></a>00118 <span class="comment"></span>
<a name="l00119"></a>00119 <span class="comment">   1) The calling technique should not force a change in the assembly</span>
<a name="l00120"></a>00120 <span class="comment">   code produced for apps; it MAY cause changes in the way assembly</span>
<a name="l00121"></a>00121 <span class="comment">   code is produced for position independent code (i.e. shared</span>
<a name="l00122"></a>00122 <span class="comment">   libraries).</span>
<a name="l00123"></a>00123 <span class="comment"></span>
<a name="l00124"></a>00124 <span class="comment">   2) The technique must be such that all executable areas must not be</span>
<a name="l00125"></a>00125 <span class="comment">   modified; and any modified areas must not be executed.</span>
<a name="l00126"></a>00126 <span class="comment"></span>
<a name="l00127"></a>00127 <span class="comment">   To do this, there are three steps involved in a typical jump:</span>
<a name="l00128"></a>00128 <span class="comment"></span>
<a name="l00129"></a>00129 <span class="comment">   1) in the code</span>
<a name="l00130"></a>00130 <span class="comment">   2) through the PLT</span>
<a name="l00131"></a>00131 <span class="comment">   3) using a pointer from the GOT</span>
<a name="l00132"></a>00132 <span class="comment"></span>
<a name="l00133"></a>00133 <span class="comment">   When the executable or library is first loaded, each GOT entry is</span>
<a name="l00134"></a>00134 <span class="comment">   initialized to point to the code which implements dynamic name</span>
<a name="l00135"></a>00135 <span class="comment">   resolution and code finding.  This is normally a function in the</span>
<a name="l00136"></a>00136 <span class="comment">   program interpreter (on ARM GNU/Linux this is usually</span>
<a name="l00137"></a>00137 <span class="comment">   ld-linux.so.2, but it does not have to be).  On the first</span>
<a name="l00138"></a>00138 <span class="comment">   invocation, the function is located and the GOT entry is replaced</span>
<a name="l00139"></a>00139 <span class="comment">   with the real function address.  Subsequent calls go through steps</span>
<a name="l00140"></a>00140 <span class="comment">   1, 2 and 3 and end up calling the real code.</span>
<a name="l00141"></a>00141 <span class="comment"></span>
<a name="l00142"></a>00142 <span class="comment">   1) In the code: </span>
<a name="l00143"></a>00143 <span class="comment"></span>
<a name="l00144"></a>00144 <span class="comment">   b    function_call</span>
<a name="l00145"></a>00145 <span class="comment">   bl   function_call</span>
<a name="l00146"></a>00146 <span class="comment"></span>
<a name="l00147"></a>00147 <span class="comment">   This is typical ARM code using the 26 bit relative branch or branch</span>
<a name="l00148"></a>00148 <span class="comment">   and link instructions.  The target of the instruction</span>
<a name="l00149"></a>00149 <span class="comment">   (function_call is usually the address of the function to be called.</span>
<a name="l00150"></a>00150 <span class="comment">   In position independent code, the target of the instruction is</span>
<a name="l00151"></a>00151 <span class="comment">   actually an entry in the PLT when calling functions in a shared</span>
<a name="l00152"></a>00152 <span class="comment">   library.  Note that this call is identical to a normal function</span>
<a name="l00153"></a>00153 <span class="comment">   call, only the target differs.</span>
<a name="l00154"></a>00154 <span class="comment"></span>
<a name="l00155"></a>00155 <span class="comment">   2) In the PLT:</span>
<a name="l00156"></a>00156 <span class="comment"></span>
<a name="l00157"></a>00157 <span class="comment">   The PLT is a synthetic area, created by the linker.  It exists in</span>
<a name="l00158"></a>00158 <span class="comment">   both executables and libraries.  It is an array of stubs, one per</span>
<a name="l00159"></a>00159 <span class="comment">   imported function call.  It looks like this:</span>
<a name="l00160"></a>00160 <span class="comment"></span>
<a name="l00161"></a>00161 <span class="comment">   PLT[0]:</span>
<a name="l00162"></a>00162 <span class="comment">   str     lr, [sp, #-4]!       @push the return address (lr)</span>
<a name="l00163"></a>00163 <span class="comment">   ldr     lr, [pc, #16]   @load from 6 words ahead</span>
<a name="l00164"></a>00164 <span class="comment">   add     lr, pc, lr      @form an address for GOT[0]</span>
<a name="l00165"></a>00165 <span class="comment">   ldr     pc, [lr, #8]!   @jump to the contents of that addr</span>
<a name="l00166"></a>00166 <span class="comment"></span>
<a name="l00167"></a>00167 <span class="comment">   The return address (lr) is pushed on the stack and used for</span>
<a name="l00168"></a>00168 <span class="comment">   calculations.  The load on the second line loads the lr with</span>
<a name="l00169"></a>00169 <span class="comment">   &amp;GOT[3] - . - 20.  The addition on the third leaves:</span>
<a name="l00170"></a>00170 <span class="comment"></span>
<a name="l00171"></a>00171 <span class="comment">   lr = (&amp;GOT[3] - . - 20) + (. + 8)</span>
<a name="l00172"></a>00172 <span class="comment">   lr = (&amp;GOT[3] - 12)</span>
<a name="l00173"></a>00173 <span class="comment">   lr = &amp;GOT[0]</span>
<a name="l00174"></a>00174 <span class="comment"></span>
<a name="l00175"></a>00175 <span class="comment">   On the fourth line, the pc and lr are both updated, so that:</span>
<a name="l00176"></a>00176 <span class="comment"></span>
<a name="l00177"></a>00177 <span class="comment">   pc = GOT[2]</span>
<a name="l00178"></a>00178 <span class="comment">   lr = &amp;GOT[0] + 8</span>
<a name="l00179"></a>00179 <span class="comment">   = &amp;GOT[2]</span>
<a name="l00180"></a>00180 <span class="comment"></span>
<a name="l00181"></a>00181 <span class="comment">   NOTE: PLT[0] borrows an offset .word from PLT[1].  This is a little</span>
<a name="l00182"></a>00182 <span class="comment">   &quot;tight&quot;, but allows us to keep all the PLT entries the same size.</span>
<a name="l00183"></a>00183 <span class="comment"></span>
<a name="l00184"></a>00184 <span class="comment">   PLT[n+1]:</span>
<a name="l00185"></a>00185 <span class="comment">   ldr     ip, [pc, #4]    @load offset from gotoff</span>
<a name="l00186"></a>00186 <span class="comment">   add     ip, pc, ip      @add the offset to the pc</span>
<a name="l00187"></a>00187 <span class="comment">   ldr     pc, [ip]        @jump to that address</span>
<a name="l00188"></a>00188 <span class="comment">   gotoff: .word   GOT[n+3] - .</span>
<a name="l00189"></a>00189 <span class="comment"></span>
<a name="l00190"></a>00190 <span class="comment">   The load on the first line, gets an offset from the fourth word of</span>
<a name="l00191"></a>00191 <span class="comment">   the PLT entry.  The add on the second line makes ip = &amp;GOT[n+3],</span>
<a name="l00192"></a>00192 <span class="comment">   which contains either a pointer to PLT[0] (the fixup trampoline) or</span>
<a name="l00193"></a>00193 <span class="comment">   a pointer to the actual code.</span>
<a name="l00194"></a>00194 <span class="comment"></span>
<a name="l00195"></a>00195 <span class="comment">   3) In the GOT:</span>
<a name="l00196"></a>00196 <span class="comment"></span>
<a name="l00197"></a>00197 <span class="comment">   The GOT contains helper pointers for both code (PLT) fixups and</span>
<a name="l00198"></a>00198 <span class="comment">   data fixups.  The first 3 entries of the GOT are special.  The next</span>
<a name="l00199"></a>00199 <span class="comment">   M entries (where M is the number of entries in the PLT) belong to</span>
<a name="l00200"></a>00200 <span class="comment">   the PLT fixups.  The next D (all remaining) entries belong to</span>
<a name="l00201"></a>00201 <span class="comment">   various data fixups.  The actual size of the GOT is 3 + M + D.</span>
<a name="l00202"></a>00202 <span class="comment"></span>
<a name="l00203"></a>00203 <span class="comment">   The GOT is also a synthetic area, created by the linker.  It exists</span>
<a name="l00204"></a>00204 <span class="comment">   in both executables and libraries.  When the GOT is first</span>
<a name="l00205"></a>00205 <span class="comment">   initialized , all the GOT entries relating to PLT fixups are</span>
<a name="l00206"></a>00206 <span class="comment">   pointing to code back at PLT[0].</span>
<a name="l00207"></a>00207 <span class="comment"></span>
<a name="l00208"></a>00208 <span class="comment">   The special entries in the GOT are:</span>
<a name="l00209"></a>00209 <span class="comment"></span>
<a name="l00210"></a>00210 <span class="comment">   GOT[0] = linked list pointer used by the dynamic loader</span>
<a name="l00211"></a>00211 <span class="comment">   GOT[1] = pointer to the reloc table for this module</span>
<a name="l00212"></a>00212 <span class="comment">   GOT[2] = pointer to the fixup/resolver code</span>
<a name="l00213"></a>00213 <span class="comment"></span>
<a name="l00214"></a>00214 <span class="comment">   The first invocation of function call comes through and uses the</span>
<a name="l00215"></a>00215 <span class="comment">   fixup/resolver code.  On the entry to the fixup/resolver code:</span>
<a name="l00216"></a>00216 <span class="comment"></span>
<a name="l00217"></a>00217 <span class="comment">   ip = &amp;GOT[n+3]</span>
<a name="l00218"></a>00218 <span class="comment">   lr = &amp;GOT[2]</span>
<a name="l00219"></a>00219 <span class="comment">   stack[0] = return address (lr) of the function call</span>
<a name="l00220"></a>00220 <span class="comment">   [r0, r1, r2, r3] are still the arguments to the function call</span>
<a name="l00221"></a>00221 <span class="comment"></span>
<a name="l00222"></a>00222 <span class="comment">   This is enough information for the fixup/resolver code to work</span>
<a name="l00223"></a>00223 <span class="comment">   with.  Before the fixup/resolver code returns, it actually calls</span>
<a name="l00224"></a>00224 <span class="comment">   the requested function and repairs &amp;GOT[n+3].  */</span>
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 <span class="comment">/* The constants below were determined by examining the following files</span>
<a name="l00227"></a>00227 <span class="comment">   in the linux kernel sources:</span>
<a name="l00228"></a>00228 <span class="comment"></span>
<a name="l00229"></a>00229 <span class="comment">      arch/arm/kernel/signal.c</span>
<a name="l00230"></a>00230 <span class="comment">          - see SWI_SYS_SIGRETURN and SWI_SYS_RT_SIGRETURN</span>
<a name="l00231"></a>00231 <span class="comment">      include/asm-arm/unistd.h</span>
<a name="l00232"></a>00232 <span class="comment">          - see __NR_sigreturn, __NR_rt_sigreturn, and __NR_SYSCALL_BASE */</span>
<a name="l00233"></a>00233 
<a name="l00234"></a><a class="code" href="arm-linux-tdep_8c.html#a88af1f76c5049419b897e9a67c894211">00234</a> <span class="preprocessor">#define ARM_LINUX_SIGRETURN_INSTR       0xef900077</span>
<a name="l00235"></a><a class="code" href="arm-linux-tdep_8c.html#a494ffd082fe566d0a5b5deb3fbe824eb">00235</a> <span class="preprocessor"></span><span class="preprocessor">#define ARM_LINUX_RT_SIGRETURN_INSTR    0xef9000ad</span>
<a name="l00236"></a>00236 <span class="preprocessor"></span>
<a name="l00237"></a>00237 <span class="comment">/* For ARM EABI, the syscall number is not in the SWI instruction</span>
<a name="l00238"></a>00238 <span class="comment">   (instead it is loaded into r7).  We recognize the pattern that</span>
<a name="l00239"></a>00239 <span class="comment">   glibc uses...  alternatively, we could arrange to do this by</span>
<a name="l00240"></a>00240 <span class="comment">   function name, but they are not always exported.  */</span>
<a name="l00241"></a><a class="code" href="arm-linux-tdep_8c.html#abce2680e0081e82c84dd35e042a1b328">00241</a> <span class="preprocessor">#define ARM_SET_R7_SIGRETURN            0xe3a07077</span>
<a name="l00242"></a><a class="code" href="arm-linux-tdep_8c.html#a5f76deb9380e8b77a6c662cc881ab136">00242</a> <span class="preprocessor"></span><span class="preprocessor">#define ARM_SET_R7_RT_SIGRETURN         0xe3a070ad</span>
<a name="l00243"></a><a class="code" href="arm-linux-tdep_8c.html#a366593c57687ef18c3ed26c07791260c">00243</a> <span class="preprocessor"></span><span class="preprocessor">#define ARM_EABI_SYSCALL                0xef000000</span>
<a name="l00244"></a>00244 <span class="preprocessor"></span>
<a name="l00245"></a>00245 <span class="comment">/* OABI syscall restart trampoline, used for EABI executables too</span>
<a name="l00246"></a>00246 <span class="comment">   whenever OABI support has been enabled in the kernel.  */</span>
<a name="l00247"></a><a class="code" href="arm-linux-tdep_8c.html#a2417e4ccbf2236f41bd2772b1a82bcc3">00247</a> <span class="preprocessor">#define ARM_OABI_SYSCALL_RESTART_SYSCALL 0xef900000</span>
<a name="l00248"></a><a class="code" href="arm-linux-tdep_8c.html#a87a95a1ec943729d278e5e3489fd6f83">00248</a> <span class="preprocessor"></span><span class="preprocessor">#define ARM_LDR_PC_SP_12                0xe49df00c</span>
<a name="l00249"></a><a class="code" href="arm-linux-tdep_8c.html#a3b9e08ab3614077f03f3d8d9d184870d">00249</a> <span class="preprocessor"></span><span class="preprocessor">#define ARM_LDR_PC_SP_4                 0xe49df004</span>
<a name="l00250"></a>00250 <span class="preprocessor"></span>
<a name="l00251"></a>00251 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00252"></a>00252 arm_linux_sigtramp_cache (<span class="keyword">struct</span> frame_info *this_frame,
<a name="l00253"></a>00253                           <span class="keyword">struct</span> trad_frame_cache *this_cache,
<a name="l00254"></a>00254                           <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> <a class="code" href="remote-fileio_8c.html#a7e97efb32ba66c3f1141bdbb82529d20">func</a>, <span class="keywordtype">int</span> regs_offset)
<a name="l00255"></a>00255 {
<a name="l00256"></a>00256   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> <a class="code" href="windows-nat_8c.html#a8d40798874dab99986478ef00ff3e297">sp</a> = <a class="code" href="frame_8c.html#affa785e8937e96fd727e46a2cfec94c4">get_frame_register_unsigned</a> (this_frame, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a9ea7438e672f1069ab82b9466196ac6d">ARM_SP_REGNUM</a>);
<a name="l00257"></a>00257   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> base = sp + regs_offset;
<a name="l00258"></a>00258   <span class="keywordtype">int</span> i;
<a name="l00259"></a>00259 
<a name="l00260"></a>00260   <span class="keywordflow">for</span> (i = 0; i &lt; 16; i++)
<a name="l00261"></a>00261     <a class="code" href="trad-frame_8c.html#a865ac8a6c048784ad0cda152172d8073">trad_frame_set_reg_addr</a> (this_cache, i, base + i * 4);
<a name="l00262"></a>00262 
<a name="l00263"></a>00263   <a class="code" href="trad-frame_8c.html#a865ac8a6c048784ad0cda152172d8073">trad_frame_set_reg_addr</a> (this_cache, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a4cb83620826d046dd42f444388bbd5b3">ARM_PS_REGNUM</a>, base + 16 * 4);
<a name="l00264"></a>00264 
<a name="l00265"></a>00265   <span class="comment">/* The VFP or iWMMXt registers may be saved on the stack, but there&#39;s</span>
<a name="l00266"></a>00266 <span class="comment">     no reliable way to restore them (yet).  */</span>
<a name="l00267"></a>00267 
<a name="l00268"></a>00268   <span class="comment">/* Save a frame ID.  */</span>
<a name="l00269"></a>00269   <a class="code" href="trad-frame_8c.html#a96ff545f27ad7cd1863225128555bb81">trad_frame_set_id</a> (this_cache, <a class="code" href="frame_8c.html#a7f32da6ddc275b4684c301448d891f5b">frame_id_build</a> (sp, func));
<a name="l00270"></a>00270 }
<a name="l00271"></a>00271 
<a name="l00272"></a>00272 <span class="comment">/* There are a couple of different possible stack layouts that</span>
<a name="l00273"></a>00273 <span class="comment">   we need to support.</span>
<a name="l00274"></a>00274 <span class="comment"></span>
<a name="l00275"></a>00275 <span class="comment">   Before version 2.6.18, the kernel used completely independent</span>
<a name="l00276"></a>00276 <span class="comment">   layouts for non-RT and RT signals.  For non-RT signals the stack</span>
<a name="l00277"></a>00277 <span class="comment">   began directly with a struct sigcontext.  For RT signals the stack</span>
<a name="l00278"></a>00278 <span class="comment">   began with two redundant pointers (to the siginfo and ucontext),</span>
<a name="l00279"></a>00279 <span class="comment">   and then the siginfo and ucontext.</span>
<a name="l00280"></a>00280 <span class="comment"></span>
<a name="l00281"></a>00281 <span class="comment">   As of version 2.6.18, the non-RT signal frame layout starts with</span>
<a name="l00282"></a>00282 <span class="comment">   a ucontext and the RT signal frame starts with a siginfo and then</span>
<a name="l00283"></a>00283 <span class="comment">   a ucontext.  Also, the ucontext now has a designated save area</span>
<a name="l00284"></a>00284 <span class="comment">   for coprocessor registers.</span>
<a name="l00285"></a>00285 <span class="comment"></span>
<a name="l00286"></a>00286 <span class="comment">   For RT signals, it&#39;s easy to tell the difference: we look for</span>
<a name="l00287"></a>00287 <span class="comment">   pinfo, the pointer to the siginfo.  If it has the expected</span>
<a name="l00288"></a>00288 <span class="comment">   value, we have an old layout.  If it doesn&#39;t, we have the new</span>
<a name="l00289"></a>00289 <span class="comment">   layout.</span>
<a name="l00290"></a>00290 <span class="comment"></span>
<a name="l00291"></a>00291 <span class="comment">   For non-RT signals, it&#39;s a bit harder.  We need something in one</span>
<a name="l00292"></a>00292 <span class="comment">   layout or the other with a recognizable offset and value.  We can&#39;t</span>
<a name="l00293"></a>00293 <span class="comment">   use the return trampoline, because ARM usually uses SA_RESTORER,</span>
<a name="l00294"></a>00294 <span class="comment">   in which case the stack return trampoline is not filled in.</span>
<a name="l00295"></a>00295 <span class="comment">   We can&#39;t use the saved stack pointer, because sigaltstack might</span>
<a name="l00296"></a>00296 <span class="comment">   be in use.  So for now we guess the new layout...  */</span>
<a name="l00297"></a>00297 
<a name="l00298"></a>00298 <span class="comment">/* There are three words (trap_no, error_code, oldmask) in</span>
<a name="l00299"></a>00299 <span class="comment">   struct sigcontext before r0.  */</span>
<a name="l00300"></a><a class="code" href="arm-linux-tdep_8c.html#ace0aa8dd6261ab0bae2b73a53dd9c86d">00300</a> <span class="preprocessor">#define ARM_SIGCONTEXT_R0 0xc</span>
<a name="l00301"></a>00301 <span class="preprocessor"></span>
<a name="l00302"></a>00302 <span class="comment">/* There are five words (uc_flags, uc_link, and three for uc_stack)</span>
<a name="l00303"></a>00303 <span class="comment">   in the ucontext_t before the sigcontext.  */</span>
<a name="l00304"></a><a class="code" href="arm-linux-tdep_8c.html#afeece2660f6eb619395918e8290c7f5f">00304</a> <span class="preprocessor">#define ARM_UCONTEXT_SIGCONTEXT 0x14</span>
<a name="l00305"></a>00305 <span class="preprocessor"></span>
<a name="l00306"></a>00306 <span class="comment">/* There are three elements in an rt_sigframe before the ucontext:</span>
<a name="l00307"></a>00307 <span class="comment">   pinfo, puc, and info.  The first two are pointers and the third</span>
<a name="l00308"></a>00308 <span class="comment">   is a struct siginfo, with size 128 bytes.  We could follow puc</span>
<a name="l00309"></a>00309 <span class="comment">   to the ucontext, but it&#39;s simpler to skip the whole thing.  */</span>
<a name="l00310"></a><a class="code" href="arm-linux-tdep_8c.html#a2103f0648209f6faa025830d7baca998">00310</a> <span class="preprocessor">#define ARM_OLD_RT_SIGFRAME_SIGINFO 0x8</span>
<a name="l00311"></a><a class="code" href="arm-linux-tdep_8c.html#af27c6dd4128203eb344c23e99c355bba">00311</a> <span class="preprocessor"></span><span class="preprocessor">#define ARM_OLD_RT_SIGFRAME_UCONTEXT 0x88</span>
<a name="l00312"></a>00312 <span class="preprocessor"></span>
<a name="l00313"></a><a class="code" href="arm-linux-tdep_8c.html#a5d15b518c4b1ecf38e2fc4b1dd33d4ef">00313</a> <span class="preprocessor">#define ARM_NEW_RT_SIGFRAME_UCONTEXT 0x80</span>
<a name="l00314"></a>00314 <span class="preprocessor"></span>
<a name="l00315"></a><a class="code" href="arm-linux-tdep_8c.html#a3b6dd69cf335c36c8b1443834dbfdcd7">00315</a> <span class="preprocessor">#define ARM_NEW_SIGFRAME_MAGIC 0x5ac3c35a</span>
<a name="l00316"></a>00316 <span class="preprocessor"></span>
<a name="l00317"></a>00317 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00318"></a>00318 arm_linux_sigreturn_init (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtramp__frame.html">tramp_frame</a> *<span class="keyword">self</span>,
<a name="l00319"></a>00319                           <span class="keyword">struct</span> frame_info *this_frame,
<a name="l00320"></a>00320                           <span class="keyword">struct</span> trad_frame_cache *this_cache,
<a name="l00321"></a>00321                           <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> <a class="code" href="remote-fileio_8c.html#a7e97efb32ba66c3f1141bdbb82529d20">func</a>)
<a name="l00322"></a>00322 {
<a name="l00323"></a>00323   <span class="keyword">struct </span>gdbarch *gdbarch = <a class="code" href="frame_8c.html#ab44507b5655da44e522ed5857835ede7">get_frame_arch</a> (this_frame);
<a name="l00324"></a>00324   <span class="keyword">enum</span> bfd_endian byte_order = <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (gdbarch);
<a name="l00325"></a>00325   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> <a class="code" href="windows-nat_8c.html#a8d40798874dab99986478ef00ff3e297">sp</a> = <a class="code" href="frame_8c.html#affa785e8937e96fd727e46a2cfec94c4">get_frame_register_unsigned</a> (this_frame, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a9ea7438e672f1069ab82b9466196ac6d">ARM_SP_REGNUM</a>);
<a name="l00326"></a>00326   <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> uc_flags = <a class="code" href="corefile_8c.html#a280cf81e766f60b30618ae3011f2cb07">read_memory_unsigned_integer</a> (sp, 4, byte_order);
<a name="l00327"></a>00327 
<a name="l00328"></a>00328   <span class="keywordflow">if</span> (uc_flags == <a class="code" href="arm-linux-tdep_8c.html#a3b6dd69cf335c36c8b1443834dbfdcd7">ARM_NEW_SIGFRAME_MAGIC</a>)
<a name="l00329"></a>00329     arm_linux_sigtramp_cache (this_frame, this_cache, func,
<a name="l00330"></a>00330                               <a class="code" href="arm-linux-tdep_8c.html#afeece2660f6eb619395918e8290c7f5f">ARM_UCONTEXT_SIGCONTEXT</a>
<a name="l00331"></a>00331                               + <a class="code" href="arm-linux-tdep_8c.html#ace0aa8dd6261ab0bae2b73a53dd9c86d">ARM_SIGCONTEXT_R0</a>);
<a name="l00332"></a>00332   <span class="keywordflow">else</span>
<a name="l00333"></a>00333     arm_linux_sigtramp_cache (this_frame, this_cache, func,
<a name="l00334"></a>00334                               <a class="code" href="arm-linux-tdep_8c.html#ace0aa8dd6261ab0bae2b73a53dd9c86d">ARM_SIGCONTEXT_R0</a>);
<a name="l00335"></a>00335 }
<a name="l00336"></a>00336 
<a name="l00337"></a>00337 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00338"></a>00338 arm_linux_rt_sigreturn_init (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtramp__frame.html">tramp_frame</a> *<span class="keyword">self</span>,
<a name="l00339"></a>00339                           <span class="keyword">struct</span> frame_info *this_frame,
<a name="l00340"></a>00340                           <span class="keyword">struct</span> trad_frame_cache *this_cache,
<a name="l00341"></a>00341                           <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> <a class="code" href="remote-fileio_8c.html#a7e97efb32ba66c3f1141bdbb82529d20">func</a>)
<a name="l00342"></a>00342 {
<a name="l00343"></a>00343   <span class="keyword">struct </span>gdbarch *gdbarch = <a class="code" href="frame_8c.html#ab44507b5655da44e522ed5857835ede7">get_frame_arch</a> (this_frame);
<a name="l00344"></a>00344   <span class="keyword">enum</span> bfd_endian byte_order = <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (gdbarch);
<a name="l00345"></a>00345   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> <a class="code" href="windows-nat_8c.html#a8d40798874dab99986478ef00ff3e297">sp</a> = <a class="code" href="frame_8c.html#affa785e8937e96fd727e46a2cfec94c4">get_frame_register_unsigned</a> (this_frame, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a9ea7438e672f1069ab82b9466196ac6d">ARM_SP_REGNUM</a>);
<a name="l00346"></a>00346   <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> pinfo = <a class="code" href="corefile_8c.html#a280cf81e766f60b30618ae3011f2cb07">read_memory_unsigned_integer</a> (sp, 4, byte_order);
<a name="l00347"></a>00347 
<a name="l00348"></a>00348   <span class="keywordflow">if</span> (pinfo == sp + <a class="code" href="arm-linux-tdep_8c.html#a2103f0648209f6faa025830d7baca998">ARM_OLD_RT_SIGFRAME_SIGINFO</a>)
<a name="l00349"></a>00349     arm_linux_sigtramp_cache (this_frame, this_cache, func,
<a name="l00350"></a>00350                               <a class="code" href="arm-linux-tdep_8c.html#af27c6dd4128203eb344c23e99c355bba">ARM_OLD_RT_SIGFRAME_UCONTEXT</a>
<a name="l00351"></a>00351                               + <a class="code" href="arm-linux-tdep_8c.html#afeece2660f6eb619395918e8290c7f5f">ARM_UCONTEXT_SIGCONTEXT</a>
<a name="l00352"></a>00352                               + <a class="code" href="arm-linux-tdep_8c.html#ace0aa8dd6261ab0bae2b73a53dd9c86d">ARM_SIGCONTEXT_R0</a>);
<a name="l00353"></a>00353   <span class="keywordflow">else</span>
<a name="l00354"></a>00354     arm_linux_sigtramp_cache (this_frame, this_cache, func,
<a name="l00355"></a>00355                               <a class="code" href="arm-linux-tdep_8c.html#a5d15b518c4b1ecf38e2fc4b1dd33d4ef">ARM_NEW_RT_SIGFRAME_UCONTEXT</a>
<a name="l00356"></a>00356                               + <a class="code" href="arm-linux-tdep_8c.html#afeece2660f6eb619395918e8290c7f5f">ARM_UCONTEXT_SIGCONTEXT</a>
<a name="l00357"></a>00357                               + <a class="code" href="arm-linux-tdep_8c.html#ace0aa8dd6261ab0bae2b73a53dd9c86d">ARM_SIGCONTEXT_R0</a>);
<a name="l00358"></a>00358 }
<a name="l00359"></a>00359 
<a name="l00360"></a>00360 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00361"></a>00361 arm_linux_restart_syscall_init (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtramp__frame.html">tramp_frame</a> *<span class="keyword">self</span>,
<a name="l00362"></a>00362                                 <span class="keyword">struct</span> frame_info *this_frame,
<a name="l00363"></a>00363                                 <span class="keyword">struct</span> trad_frame_cache *this_cache,
<a name="l00364"></a>00364                                 <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> func)
<a name="l00365"></a>00365 {
<a name="l00366"></a>00366   <span class="keyword">struct </span>gdbarch *gdbarch = <a class="code" href="frame_8c.html#ab44507b5655da44e522ed5857835ede7">get_frame_arch</a> (this_frame);
<a name="l00367"></a>00367   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> sp = <a class="code" href="frame_8c.html#affa785e8937e96fd727e46a2cfec94c4">get_frame_register_unsigned</a> (this_frame, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a9ea7438e672f1069ab82b9466196ac6d">ARM_SP_REGNUM</a>);
<a name="l00368"></a>00368   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> pc = <a class="code" href="frame_8c.html#a4f317a79de48ff98bc500e84ff6a18c7">get_frame_memory_unsigned</a> (this_frame, sp, 4);
<a name="l00369"></a>00369   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> cpsr = <a class="code" href="frame_8c.html#affa785e8937e96fd727e46a2cfec94c4">get_frame_register_unsigned</a> (this_frame, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a4cb83620826d046dd42f444388bbd5b3">ARM_PS_REGNUM</a>);
<a name="l00370"></a>00370   <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> t_bit = <a class="code" href="arm-tdep_8c.html#ab4ac7391690b407ffa6512903b634661">arm_psr_thumb_bit</a> (gdbarch);
<a name="l00371"></a>00371   <span class="keywordtype">int</span> sp_offset;
<a name="l00372"></a>00372 
<a name="l00373"></a>00373   <span class="comment">/* There are two variants of this trampoline; with older kernels, the</span>
<a name="l00374"></a>00374 <span class="comment">     stub is placed on the stack, while newer kernels use the stub from</span>
<a name="l00375"></a>00375 <span class="comment">     the vector page.  They are identical except that the older version</span>
<a name="l00376"></a>00376 <span class="comment">     increments SP by 12 (to skip stored PC and the stub itself), while</span>
<a name="l00377"></a>00377 <span class="comment">     the newer version increments SP only by 4 (just the stored PC).  */</span>
<a name="l00378"></a>00378   <span class="keywordflow">if</span> (self-&gt;insn[1].bytes == <a class="code" href="arm-linux-tdep_8c.html#a3b9e08ab3614077f03f3d8d9d184870d">ARM_LDR_PC_SP_4</a>)
<a name="l00379"></a>00379     sp_offset = 4;
<a name="l00380"></a>00380   <span class="keywordflow">else</span>
<a name="l00381"></a>00381     sp_offset = 12;
<a name="l00382"></a>00382 
<a name="l00383"></a>00383   <span class="comment">/* Update Thumb bit in CPSR.  */</span>
<a name="l00384"></a>00384   <span class="keywordflow">if</span> (pc &amp; 1)
<a name="l00385"></a>00385     cpsr |= t_bit;
<a name="l00386"></a>00386   <span class="keywordflow">else</span>
<a name="l00387"></a>00387     cpsr &amp;= ~t_bit;
<a name="l00388"></a>00388 
<a name="l00389"></a>00389   <span class="comment">/* Remove Thumb bit from PC.  */</span>
<a name="l00390"></a>00390   pc = <a class="code" href="gdbarch_8c.html#abee635dc7cb9e9793c6100971df1a859">gdbarch_addr_bits_remove</a> (gdbarch, pc);
<a name="l00391"></a>00391 
<a name="l00392"></a>00392   <span class="comment">/* Save previous register values.  */</span>
<a name="l00393"></a>00393   <a class="code" href="trad-frame_8c.html#aeb58af2dac3f03129e4c9abc33fef4fb">trad_frame_set_reg_value</a> (this_cache, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a9ea7438e672f1069ab82b9466196ac6d">ARM_SP_REGNUM</a>, sp + sp_offset);
<a name="l00394"></a>00394   <a class="code" href="trad-frame_8c.html#aeb58af2dac3f03129e4c9abc33fef4fb">trad_frame_set_reg_value</a> (this_cache, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a26bb9ca3fd0b338a1fda326f772134c6">ARM_PC_REGNUM</a>, pc);
<a name="l00395"></a>00395   <a class="code" href="trad-frame_8c.html#aeb58af2dac3f03129e4c9abc33fef4fb">trad_frame_set_reg_value</a> (this_cache, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a4cb83620826d046dd42f444388bbd5b3">ARM_PS_REGNUM</a>, cpsr);
<a name="l00396"></a>00396 
<a name="l00397"></a>00397   <span class="comment">/* Save a frame ID.  */</span>
<a name="l00398"></a>00398   <a class="code" href="trad-frame_8c.html#a96ff545f27ad7cd1863225128555bb81">trad_frame_set_id</a> (this_cache, <a class="code" href="frame_8c.html#a7f32da6ddc275b4684c301448d891f5b">frame_id_build</a> (sp, func));
<a name="l00399"></a>00399 }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structtramp__frame.html">tramp_frame</a> arm_linux_sigreturn_tramp_frame = {
<a name="l00402"></a>00402   <a class="code" href="frame_8h.html#a3ca2c0bc7578bf3d337e34b2c08a6c5fab5e81cbdc78e85afc7451a04b596914e">SIGTRAMP_FRAME</a>,
<a name="l00403"></a>00403   4,
<a name="l00404"></a>00404   {
<a name="l00405"></a>00405     { <a class="code" href="arm-linux-tdep_8c.html#a88af1f76c5049419b897e9a67c894211">ARM_LINUX_SIGRETURN_INSTR</a>, -1 },
<a name="l00406"></a>00406     { <a class="code" href="tramp-frame_8h.html#a19be675bbad987f95738005126b61c1d">TRAMP_SENTINEL_INSN</a> }
<a name="l00407"></a>00407   },
<a name="l00408"></a>00408   arm_linux_sigreturn_init
<a name="l00409"></a>00409 };
<a name="l00410"></a>00410 
<a name="l00411"></a>00411 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structtramp__frame.html">tramp_frame</a> arm_linux_rt_sigreturn_tramp_frame = {
<a name="l00412"></a>00412   <a class="code" href="frame_8h.html#a3ca2c0bc7578bf3d337e34b2c08a6c5fab5e81cbdc78e85afc7451a04b596914e">SIGTRAMP_FRAME</a>,
<a name="l00413"></a>00413   4,
<a name="l00414"></a>00414   {
<a name="l00415"></a>00415     { <a class="code" href="arm-linux-tdep_8c.html#a494ffd082fe566d0a5b5deb3fbe824eb">ARM_LINUX_RT_SIGRETURN_INSTR</a>, -1 },
<a name="l00416"></a>00416     { <a class="code" href="tramp-frame_8h.html#a19be675bbad987f95738005126b61c1d">TRAMP_SENTINEL_INSN</a> }
<a name="l00417"></a>00417   },
<a name="l00418"></a>00418   arm_linux_rt_sigreturn_init
<a name="l00419"></a>00419 };
<a name="l00420"></a>00420 
<a name="l00421"></a>00421 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structtramp__frame.html">tramp_frame</a> arm_eabi_linux_sigreturn_tramp_frame = {
<a name="l00422"></a>00422   <a class="code" href="frame_8h.html#a3ca2c0bc7578bf3d337e34b2c08a6c5fab5e81cbdc78e85afc7451a04b596914e">SIGTRAMP_FRAME</a>,
<a name="l00423"></a>00423   4,
<a name="l00424"></a>00424   {
<a name="l00425"></a>00425     { <a class="code" href="arm-linux-tdep_8c.html#abce2680e0081e82c84dd35e042a1b328">ARM_SET_R7_SIGRETURN</a>, -1 },
<a name="l00426"></a>00426     { <a class="code" href="arm-linux-tdep_8c.html#a366593c57687ef18c3ed26c07791260c">ARM_EABI_SYSCALL</a>, -1 },
<a name="l00427"></a>00427     { <a class="code" href="tramp-frame_8h.html#a19be675bbad987f95738005126b61c1d">TRAMP_SENTINEL_INSN</a> }
<a name="l00428"></a>00428   },
<a name="l00429"></a>00429   arm_linux_sigreturn_init
<a name="l00430"></a>00430 };
<a name="l00431"></a>00431 
<a name="l00432"></a>00432 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structtramp__frame.html">tramp_frame</a> arm_eabi_linux_rt_sigreturn_tramp_frame = {
<a name="l00433"></a>00433   <a class="code" href="frame_8h.html#a3ca2c0bc7578bf3d337e34b2c08a6c5fab5e81cbdc78e85afc7451a04b596914e">SIGTRAMP_FRAME</a>,
<a name="l00434"></a>00434   4,
<a name="l00435"></a>00435   {
<a name="l00436"></a>00436     { <a class="code" href="arm-linux-tdep_8c.html#a5f76deb9380e8b77a6c662cc881ab136">ARM_SET_R7_RT_SIGRETURN</a>, -1 },
<a name="l00437"></a>00437     { <a class="code" href="arm-linux-tdep_8c.html#a366593c57687ef18c3ed26c07791260c">ARM_EABI_SYSCALL</a>, -1 },
<a name="l00438"></a>00438     { <a class="code" href="tramp-frame_8h.html#a19be675bbad987f95738005126b61c1d">TRAMP_SENTINEL_INSN</a> }
<a name="l00439"></a>00439   },
<a name="l00440"></a>00440   arm_linux_rt_sigreturn_init
<a name="l00441"></a>00441 };
<a name="l00442"></a>00442 
<a name="l00443"></a>00443 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structtramp__frame.html">tramp_frame</a> arm_linux_restart_syscall_tramp_frame = {
<a name="l00444"></a>00444   <a class="code" href="frame_8h.html#a3ca2c0bc7578bf3d337e34b2c08a6c5faeb4f7fd6d9e397d1141feb133746637a">NORMAL_FRAME</a>,
<a name="l00445"></a>00445   4,
<a name="l00446"></a>00446   {
<a name="l00447"></a>00447     { <a class="code" href="arm-linux-tdep_8c.html#a2417e4ccbf2236f41bd2772b1a82bcc3">ARM_OABI_SYSCALL_RESTART_SYSCALL</a>, -1 },
<a name="l00448"></a>00448     { <a class="code" href="arm-linux-tdep_8c.html#a87a95a1ec943729d278e5e3489fd6f83">ARM_LDR_PC_SP_12</a>, -1 },
<a name="l00449"></a>00449     { <a class="code" href="tramp-frame_8h.html#a19be675bbad987f95738005126b61c1d">TRAMP_SENTINEL_INSN</a> }
<a name="l00450"></a>00450   },
<a name="l00451"></a>00451   arm_linux_restart_syscall_init
<a name="l00452"></a>00452 };
<a name="l00453"></a>00453 
<a name="l00454"></a>00454 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structtramp__frame.html">tramp_frame</a> arm_kernel_linux_restart_syscall_tramp_frame = {
<a name="l00455"></a>00455   <a class="code" href="frame_8h.html#a3ca2c0bc7578bf3d337e34b2c08a6c5faeb4f7fd6d9e397d1141feb133746637a">NORMAL_FRAME</a>,
<a name="l00456"></a>00456   4,
<a name="l00457"></a>00457   {
<a name="l00458"></a>00458     { <a class="code" href="arm-linux-tdep_8c.html#a2417e4ccbf2236f41bd2772b1a82bcc3">ARM_OABI_SYSCALL_RESTART_SYSCALL</a>, -1 },
<a name="l00459"></a>00459     { <a class="code" href="arm-linux-tdep_8c.html#a3b9e08ab3614077f03f3d8d9d184870d">ARM_LDR_PC_SP_4</a>, -1 },
<a name="l00460"></a>00460     { <a class="code" href="tramp-frame_8h.html#a19be675bbad987f95738005126b61c1d">TRAMP_SENTINEL_INSN</a> }
<a name="l00461"></a>00461   },
<a name="l00462"></a>00462   arm_linux_restart_syscall_init
<a name="l00463"></a>00463 };
<a name="l00464"></a>00464 
<a name="l00465"></a>00465 <span class="comment">/* Core file and register set support.  */</span>
<a name="l00466"></a>00466 
<a name="l00467"></a><a class="code" href="arm-linux-tdep_8c.html#a23b65c506003d4a9bff548fcd20528a5">00467</a> <span class="preprocessor">#define ARM_LINUX_SIZEOF_GREGSET (18 * INT_REGISTER_SIZE)</span>
<a name="l00468"></a>00468 <span class="preprocessor"></span>
<a name="l00469"></a>00469 <span class="keywordtype">void</span>
<a name="l00470"></a><a class="code" href="arm-linux-tdep_8h.html#a236b730e0d0daf4c23166d89c3211e94">00470</a> <a class="code" href="arm-linux-tdep_8c.html#a236b730e0d0daf4c23166d89c3211e94">arm_linux_supply_gregset</a> (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structregset.html">regset</a> *<a class="code" href="structregset.html">regset</a>,
<a name="l00471"></a>00471                           <span class="keyword">struct</span> regcache *regcache,
<a name="l00472"></a>00472                           <span class="keywordtype">int</span> <a class="code" href="aarch64-tdep_8c.html#a6b3d1ad0bca4067ccaef1366bea0db04">regnum</a>, <span class="keyword">const</span> <span class="keywordtype">void</span> *gregs_buf, <span class="keywordtype">size_t</span> <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>)
<a name="l00473"></a>00473 {
<a name="l00474"></a>00474   <span class="keyword">struct </span>gdbarch *gdbarch = <a class="code" href="regcache_8c.html#ad4f6d0cdf256b1fa45d59a6d71b50659">get_regcache_arch</a> (regcache);
<a name="l00475"></a>00475   <span class="keyword">enum</span> bfd_endian byte_order = <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (gdbarch);
<a name="l00476"></a>00476   <span class="keyword">const</span> <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *gregs = gregs_buf;
<a name="l00477"></a>00477   <span class="keywordtype">int</span> regno;
<a name="l00478"></a>00478   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> reg_pc;
<a name="l00479"></a>00479   <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> pc_buf[<a class="code" href="arm-tdep_8h.html#af8951908fefcd1695cfc95be61c50806">INT_REGISTER_SIZE</a>];
<a name="l00480"></a>00480 
<a name="l00481"></a>00481   <span class="keywordflow">for</span> (regno = <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a95438c68f8f4fdaf2b33f6681a2a3ce2">ARM_A1_REGNUM</a>; regno &lt; <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a26bb9ca3fd0b338a1fda326f772134c6">ARM_PC_REGNUM</a>; regno++)
<a name="l00482"></a>00482     <span class="keywordflow">if</span> (regnum == -1 || regnum == regno)
<a name="l00483"></a>00483       <a class="code" href="regcache_8c.html#a127ceeb6f30d3bab748c60570ac077a6">regcache_raw_supply</a> (regcache, regno,
<a name="l00484"></a>00484                            gregs + <a class="code" href="arm-tdep_8h.html#af8951908fefcd1695cfc95be61c50806">INT_REGISTER_SIZE</a> * regno);
<a name="l00485"></a>00485 
<a name="l00486"></a>00486   <span class="keywordflow">if</span> (regnum == <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a4cb83620826d046dd42f444388bbd5b3">ARM_PS_REGNUM</a> || regnum == -1)
<a name="l00487"></a>00487     {
<a name="l00488"></a>00488       <span class="keywordflow">if</span> (<a class="code" href="arm-linux-nat_8c.html#a77dfd4d77596fabb416e373c5631335c">arm_apcs_32</a>)
<a name="l00489"></a>00489         <a class="code" href="regcache_8c.html#a127ceeb6f30d3bab748c60570ac077a6">regcache_raw_supply</a> (regcache, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a4cb83620826d046dd42f444388bbd5b3">ARM_PS_REGNUM</a>,
<a name="l00490"></a>00490                              gregs + <a class="code" href="arm-tdep_8h.html#af8951908fefcd1695cfc95be61c50806">INT_REGISTER_SIZE</a> * <a class="code" href="arm-linux-tdep_8h.html#a3c75c502eb8c53e82c7bfa0eba121a43">ARM_CPSR_GREGNUM</a>);
<a name="l00491"></a>00491       <span class="keywordflow">else</span>
<a name="l00492"></a>00492         <a class="code" href="regcache_8c.html#a127ceeb6f30d3bab748c60570ac077a6">regcache_raw_supply</a> (regcache, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a4cb83620826d046dd42f444388bbd5b3">ARM_PS_REGNUM</a>,
<a name="l00493"></a>00493                              gregs + <a class="code" href="arm-tdep_8h.html#af8951908fefcd1695cfc95be61c50806">INT_REGISTER_SIZE</a> * ARM_PC_REGNUM);
<a name="l00494"></a>00494     }
<a name="l00495"></a>00495 
<a name="l00496"></a>00496   <span class="keywordflow">if</span> (regnum == ARM_PC_REGNUM || regnum == -1)
<a name="l00497"></a>00497     {
<a name="l00498"></a>00498       reg_pc = <a class="code" href="defs_8h.html#a99aec65329508b4d449a4f881026f844">extract_unsigned_integer</a> (gregs
<a name="l00499"></a>00499                                          + <a class="code" href="arm-tdep_8h.html#af8951908fefcd1695cfc95be61c50806">INT_REGISTER_SIZE</a> * ARM_PC_REGNUM,
<a name="l00500"></a>00500                                          <a class="code" href="arm-tdep_8h.html#af8951908fefcd1695cfc95be61c50806">INT_REGISTER_SIZE</a>, byte_order);
<a name="l00501"></a>00501       reg_pc = <a class="code" href="gdbarch_8c.html#abee635dc7cb9e9793c6100971df1a859">gdbarch_addr_bits_remove</a> (gdbarch, reg_pc);
<a name="l00502"></a>00502       <a class="code" href="defs_8h.html#ad11c013c83c64d9d0ee2e4bdeb1fb62d">store_unsigned_integer</a> (pc_buf, <a class="code" href="arm-tdep_8h.html#af8951908fefcd1695cfc95be61c50806">INT_REGISTER_SIZE</a>, byte_order, reg_pc);
<a name="l00503"></a>00503       <a class="code" href="regcache_8c.html#a127ceeb6f30d3bab748c60570ac077a6">regcache_raw_supply</a> (regcache, ARM_PC_REGNUM, pc_buf);
<a name="l00504"></a>00504     }
<a name="l00505"></a>00505 }
<a name="l00506"></a>00506 
<a name="l00507"></a>00507 <span class="keywordtype">void</span>
<a name="l00508"></a><a class="code" href="arm-linux-tdep_8h.html#adf6d830048e76798a4fb27f162e47d6d">00508</a> <a class="code" href="arm-linux-tdep_8c.html#adf6d830048e76798a4fb27f162e47d6d">arm_linux_collect_gregset</a> (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structregset.html">regset</a> *<a class="code" href="structregset.html">regset</a>,
<a name="l00509"></a>00509                            <span class="keyword">const</span> <span class="keyword">struct</span> regcache *regcache,
<a name="l00510"></a>00510                            <span class="keywordtype">int</span> <a class="code" href="aarch64-tdep_8c.html#a6b3d1ad0bca4067ccaef1366bea0db04">regnum</a>, <span class="keywordtype">void</span> *gregs_buf, <span class="keywordtype">size_t</span> <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>)
<a name="l00511"></a>00511 {
<a name="l00512"></a>00512   <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *gregs = gregs_buf;
<a name="l00513"></a>00513   <span class="keywordtype">int</span> regno;
<a name="l00514"></a>00514 
<a name="l00515"></a>00515   <span class="keywordflow">for</span> (regno = <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a95438c68f8f4fdaf2b33f6681a2a3ce2">ARM_A1_REGNUM</a>; regno &lt; <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a26bb9ca3fd0b338a1fda326f772134c6">ARM_PC_REGNUM</a>; regno++)
<a name="l00516"></a>00516     <span class="keywordflow">if</span> (regnum == -1 || regnum == regno)
<a name="l00517"></a>00517       <a class="code" href="regcache_8c.html#a3d2dc4fc1d7d491061e087b547c7f9a8">regcache_raw_collect</a> (regcache, regno,
<a name="l00518"></a>00518                             gregs + <a class="code" href="arm-tdep_8h.html#af8951908fefcd1695cfc95be61c50806">INT_REGISTER_SIZE</a> * regno);
<a name="l00519"></a>00519 
<a name="l00520"></a>00520   <span class="keywordflow">if</span> (regnum == <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a4cb83620826d046dd42f444388bbd5b3">ARM_PS_REGNUM</a> || regnum == -1)
<a name="l00521"></a>00521     {
<a name="l00522"></a>00522       <span class="keywordflow">if</span> (<a class="code" href="arm-linux-nat_8c.html#a77dfd4d77596fabb416e373c5631335c">arm_apcs_32</a>)
<a name="l00523"></a>00523         <a class="code" href="regcache_8c.html#a3d2dc4fc1d7d491061e087b547c7f9a8">regcache_raw_collect</a> (regcache, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a4cb83620826d046dd42f444388bbd5b3">ARM_PS_REGNUM</a>,
<a name="l00524"></a>00524                               gregs + <a class="code" href="arm-tdep_8h.html#af8951908fefcd1695cfc95be61c50806">INT_REGISTER_SIZE</a> * <a class="code" href="arm-linux-tdep_8h.html#a3c75c502eb8c53e82c7bfa0eba121a43">ARM_CPSR_GREGNUM</a>);
<a name="l00525"></a>00525       <span class="keywordflow">else</span>
<a name="l00526"></a>00526         <a class="code" href="regcache_8c.html#a3d2dc4fc1d7d491061e087b547c7f9a8">regcache_raw_collect</a> (regcache, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a4cb83620826d046dd42f444388bbd5b3">ARM_PS_REGNUM</a>,
<a name="l00527"></a>00527                               gregs + <a class="code" href="arm-tdep_8h.html#af8951908fefcd1695cfc95be61c50806">INT_REGISTER_SIZE</a> * ARM_PC_REGNUM);
<a name="l00528"></a>00528     }
<a name="l00529"></a>00529 
<a name="l00530"></a>00530   <span class="keywordflow">if</span> (regnum == ARM_PC_REGNUM || regnum == -1)
<a name="l00531"></a>00531     <a class="code" href="regcache_8c.html#a3d2dc4fc1d7d491061e087b547c7f9a8">regcache_raw_collect</a> (regcache, ARM_PC_REGNUM,
<a name="l00532"></a>00532                           gregs + <a class="code" href="arm-tdep_8h.html#af8951908fefcd1695cfc95be61c50806">INT_REGISTER_SIZE</a> * ARM_PC_REGNUM);
<a name="l00533"></a>00533 }
<a name="l00534"></a>00534 
<a name="l00535"></a>00535 <span class="comment">/* Support for register format used by the NWFPE FPA emulator.  */</span>
<a name="l00536"></a>00536 
<a name="l00537"></a><a class="code" href="arm-linux-tdep_8c.html#a21de2458a1f7fc1ddd5553f17f49681e">00537</a> <span class="preprocessor">#define typeNone                0x00</span>
<a name="l00538"></a><a class="code" href="arm-linux-tdep_8c.html#aa1d87f684977a80920697ee56c262f6a">00538</a> <span class="preprocessor"></span><span class="preprocessor">#define typeSingle              0x01</span>
<a name="l00539"></a><a class="code" href="arm-linux-tdep_8c.html#aa6258cd354fdb9b600fa486b073ce7b2">00539</a> <span class="preprocessor"></span><span class="preprocessor">#define typeDouble              0x02</span>
<a name="l00540"></a><a class="code" href="arm-linux-tdep_8c.html#a0011ed3ce0567da7a58ec6c4c8c6e7aa">00540</a> <span class="preprocessor"></span><span class="preprocessor">#define typeExtended            0x03</span>
<a name="l00541"></a>00541 <span class="preprocessor"></span>
<a name="l00542"></a>00542 <span class="keywordtype">void</span>
<a name="l00543"></a><a class="code" href="arm-linux-tdep_8h.html#a66f8fcd66b390ef8a66753c089350387">00543</a> <a class="code" href="arm-linux-tdep_8c.html#a66f8fcd66b390ef8a66753c089350387">supply_nwfpe_register</a> (<span class="keyword">struct</span> regcache *regcache, <span class="keywordtype">int</span> regno,
<a name="l00544"></a>00544                        <span class="keyword">const</span> <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *regs)
<a name="l00545"></a>00545 {
<a name="l00546"></a>00546   <span class="keyword">const</span> <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *reg_data;
<a name="l00547"></a>00547   <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> reg_tag;
<a name="l00548"></a>00548   <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> buf[<a class="code" href="arm-tdep_8h.html#a532d90c962634229443833678c8a54c3">FP_REGISTER_SIZE</a>];
<a name="l00549"></a>00549 
<a name="l00550"></a>00550   reg_data = regs + (regno - <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a922ac632f7e25706b6a67b32a8ea966f">ARM_F0_REGNUM</a>) * <a class="code" href="arm-tdep_8h.html#a532d90c962634229443833678c8a54c3">FP_REGISTER_SIZE</a>;
<a name="l00551"></a>00551   reg_tag = regs[(regno - <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a922ac632f7e25706b6a67b32a8ea966f">ARM_F0_REGNUM</a>) + <a class="code" href="arm-linux-tdep_8h.html#a22988cf7e976a1d2b364b40900351dc8">NWFPE_TAGS_OFFSET</a>];
<a name="l00552"></a>00552   <a class="code" href="gdb__string_8h.html#adb03df3679ce1445e801310614624ccb">memset</a> (buf, 0, <a class="code" href="arm-tdep_8h.html#a532d90c962634229443833678c8a54c3">FP_REGISTER_SIZE</a>);
<a name="l00553"></a>00553 
<a name="l00554"></a>00554   <span class="keywordflow">switch</span> (reg_tag)
<a name="l00555"></a>00555     {
<a name="l00556"></a>00556     <span class="keywordflow">case</span> <a class="code" href="arm-linux-tdep_8c.html#aa1d87f684977a80920697ee56c262f6a">typeSingle</a>:
<a name="l00557"></a>00557       <a class="code" href="gdb__string_8h.html#a39ebe6a4e122707997e78b549a1e8c5e">memcpy</a> (buf, reg_data, 4);
<a name="l00558"></a>00558       <span class="keywordflow">break</span>;
<a name="l00559"></a>00559     <span class="keywordflow">case</span> <a class="code" href="arm-linux-tdep_8c.html#aa6258cd354fdb9b600fa486b073ce7b2">typeDouble</a>:
<a name="l00560"></a>00560       <a class="code" href="gdb__string_8h.html#a39ebe6a4e122707997e78b549a1e8c5e">memcpy</a> (buf, reg_data + 4, 4);
<a name="l00561"></a>00561       <a class="code" href="gdb__string_8h.html#a39ebe6a4e122707997e78b549a1e8c5e">memcpy</a> (buf + 4, reg_data, 4);
<a name="l00562"></a>00562       <span class="keywordflow">break</span>;
<a name="l00563"></a>00563     <span class="keywordflow">case</span> <a class="code" href="arm-linux-tdep_8c.html#a0011ed3ce0567da7a58ec6c4c8c6e7aa">typeExtended</a>:
<a name="l00564"></a>00564       <span class="comment">/* We want sign and exponent, then least significant bits,</span>
<a name="l00565"></a>00565 <span class="comment">         then most significant.  NWFPE does sign, most, least.  */</span>
<a name="l00566"></a>00566       <a class="code" href="gdb__string_8h.html#a39ebe6a4e122707997e78b549a1e8c5e">memcpy</a> (buf, reg_data, 4);
<a name="l00567"></a>00567       <a class="code" href="gdb__string_8h.html#a39ebe6a4e122707997e78b549a1e8c5e">memcpy</a> (buf + 4, reg_data + 8, 4);
<a name="l00568"></a>00568       <a class="code" href="gdb__string_8h.html#a39ebe6a4e122707997e78b549a1e8c5e">memcpy</a> (buf + 8, reg_data + 4, 4);
<a name="l00569"></a>00569       <span class="keywordflow">break</span>;
<a name="l00570"></a>00570     <span class="keywordflow">default</span>:
<a name="l00571"></a>00571       <span class="keywordflow">break</span>;
<a name="l00572"></a>00572     }
<a name="l00573"></a>00573 
<a name="l00574"></a>00574   <a class="code" href="regcache_8c.html#a127ceeb6f30d3bab748c60570ac077a6">regcache_raw_supply</a> (regcache, regno, buf);
<a name="l00575"></a>00575 }
<a name="l00576"></a>00576 
<a name="l00577"></a>00577 <span class="keywordtype">void</span>
<a name="l00578"></a><a class="code" href="arm-linux-tdep_8h.html#ac2d55f3778e6f8232adba83845d7ce53">00578</a> <a class="code" href="arm-linux-tdep_8c.html#ac2d55f3778e6f8232adba83845d7ce53">collect_nwfpe_register</a> (<span class="keyword">const</span> <span class="keyword">struct</span> regcache *regcache, <span class="keywordtype">int</span> regno,
<a name="l00579"></a>00579                         <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *regs)
<a name="l00580"></a>00580 {
<a name="l00581"></a>00581   <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *reg_data;
<a name="l00582"></a>00582   <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> reg_tag;
<a name="l00583"></a>00583   <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> buf[<a class="code" href="arm-tdep_8h.html#a532d90c962634229443833678c8a54c3">FP_REGISTER_SIZE</a>];
<a name="l00584"></a>00584 
<a name="l00585"></a>00585   <a class="code" href="regcache_8c.html#a3d2dc4fc1d7d491061e087b547c7f9a8">regcache_raw_collect</a> (regcache, regno, buf);
<a name="l00586"></a>00586 
<a name="l00587"></a>00587   <span class="comment">/* NOTE drow/2006-06-07: This code uses the tag already in the</span>
<a name="l00588"></a>00588 <span class="comment">     register buffer.  I&#39;ve preserved that when moving the code</span>
<a name="l00589"></a>00589 <span class="comment">     from the native file to the target file.  But this doesn&#39;t</span>
<a name="l00590"></a>00590 <span class="comment">     always make sense.  */</span>
<a name="l00591"></a>00591 
<a name="l00592"></a>00592   reg_data = regs + (regno - <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a922ac632f7e25706b6a67b32a8ea966f">ARM_F0_REGNUM</a>) * <a class="code" href="arm-tdep_8h.html#a532d90c962634229443833678c8a54c3">FP_REGISTER_SIZE</a>;
<a name="l00593"></a>00593   reg_tag = regs[(regno - <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a922ac632f7e25706b6a67b32a8ea966f">ARM_F0_REGNUM</a>) + <a class="code" href="arm-linux-tdep_8h.html#a22988cf7e976a1d2b364b40900351dc8">NWFPE_TAGS_OFFSET</a>];
<a name="l00594"></a>00594 
<a name="l00595"></a>00595   <span class="keywordflow">switch</span> (reg_tag)
<a name="l00596"></a>00596     {
<a name="l00597"></a>00597     <span class="keywordflow">case</span> <a class="code" href="arm-linux-tdep_8c.html#aa1d87f684977a80920697ee56c262f6a">typeSingle</a>:
<a name="l00598"></a>00598       <a class="code" href="gdb__string_8h.html#a39ebe6a4e122707997e78b549a1e8c5e">memcpy</a> (reg_data, buf, 4);
<a name="l00599"></a>00599       <span class="keywordflow">break</span>;
<a name="l00600"></a>00600     <span class="keywordflow">case</span> <a class="code" href="arm-linux-tdep_8c.html#aa6258cd354fdb9b600fa486b073ce7b2">typeDouble</a>:
<a name="l00601"></a>00601       <a class="code" href="gdb__string_8h.html#a39ebe6a4e122707997e78b549a1e8c5e">memcpy</a> (reg_data, buf + 4, 4);
<a name="l00602"></a>00602       <a class="code" href="gdb__string_8h.html#a39ebe6a4e122707997e78b549a1e8c5e">memcpy</a> (reg_data + 4, buf, 4);
<a name="l00603"></a>00603       <span class="keywordflow">break</span>;
<a name="l00604"></a>00604     <span class="keywordflow">case</span> <a class="code" href="arm-linux-tdep_8c.html#a0011ed3ce0567da7a58ec6c4c8c6e7aa">typeExtended</a>:
<a name="l00605"></a>00605       <a class="code" href="gdb__string_8h.html#a39ebe6a4e122707997e78b549a1e8c5e">memcpy</a> (reg_data, buf, 4);
<a name="l00606"></a>00606       <a class="code" href="gdb__string_8h.html#a39ebe6a4e122707997e78b549a1e8c5e">memcpy</a> (reg_data + 4, buf + 8, 4);
<a name="l00607"></a>00607       <a class="code" href="gdb__string_8h.html#a39ebe6a4e122707997e78b549a1e8c5e">memcpy</a> (reg_data + 8, buf + 4, 4);
<a name="l00608"></a>00608       <span class="keywordflow">break</span>;
<a name="l00609"></a>00609     <span class="keywordflow">default</span>:
<a name="l00610"></a>00610       <span class="keywordflow">break</span>;
<a name="l00611"></a>00611     }
<a name="l00612"></a>00612 }
<a name="l00613"></a>00613 
<a name="l00614"></a>00614 <span class="keywordtype">void</span>
<a name="l00615"></a><a class="code" href="arm-linux-tdep_8h.html#a5cef8881e02cdcce9fa00d64ce1fcbd7">00615</a> <a class="code" href="arm-linux-tdep_8c.html#a5cef8881e02cdcce9fa00d64ce1fcbd7">arm_linux_supply_nwfpe</a> (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structregset.html">regset</a> *<a class="code" href="structregset.html">regset</a>,
<a name="l00616"></a>00616                         <span class="keyword">struct</span> regcache *regcache,
<a name="l00617"></a>00617                         <span class="keywordtype">int</span> <a class="code" href="aarch64-tdep_8c.html#a6b3d1ad0bca4067ccaef1366bea0db04">regnum</a>, <span class="keyword">const</span> <span class="keywordtype">void</span> *regs_buf, <span class="keywordtype">size_t</span> <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>)
<a name="l00618"></a>00618 {
<a name="l00619"></a>00619   <span class="keyword">const</span> <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *regs = regs_buf;
<a name="l00620"></a>00620   <span class="keywordtype">int</span> regno;
<a name="l00621"></a>00621 
<a name="l00622"></a>00622   <span class="keywordflow">if</span> (regnum == <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39aefb13a782da52622fafa8f2a0385763f">ARM_FPS_REGNUM</a> || regnum == -1)
<a name="l00623"></a>00623     <a class="code" href="regcache_8c.html#a127ceeb6f30d3bab748c60570ac077a6">regcache_raw_supply</a> (regcache, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39aefb13a782da52622fafa8f2a0385763f">ARM_FPS_REGNUM</a>,
<a name="l00624"></a>00624                          regs + <a class="code" href="arm-linux-tdep_8h.html#ab97cdaa63effb731e869949067af0867">NWFPE_FPSR_OFFSET</a>);
<a name="l00625"></a>00625 
<a name="l00626"></a>00626   <span class="keywordflow">for</span> (regno = <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a922ac632f7e25706b6a67b32a8ea966f">ARM_F0_REGNUM</a>; regno &lt;= <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a7844136c6f0b351eb57974cdec429437">ARM_F7_REGNUM</a>; regno++)
<a name="l00627"></a>00627     <span class="keywordflow">if</span> (regnum == -1 || regnum == regno)
<a name="l00628"></a>00628       <a class="code" href="arm-linux-tdep_8c.html#a66f8fcd66b390ef8a66753c089350387">supply_nwfpe_register</a> (regcache, regno, regs);
<a name="l00629"></a>00629 }
<a name="l00630"></a>00630 
<a name="l00631"></a>00631 <span class="keywordtype">void</span>
<a name="l00632"></a><a class="code" href="arm-linux-tdep_8h.html#a681d56006f6bdbacad1c965c88309418">00632</a> <a class="code" href="arm-linux-tdep_8c.html#a681d56006f6bdbacad1c965c88309418">arm_linux_collect_nwfpe</a> (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structregset.html">regset</a> *<a class="code" href="structregset.html">regset</a>,
<a name="l00633"></a>00633                          <span class="keyword">const</span> <span class="keyword">struct</span> regcache *regcache,
<a name="l00634"></a>00634                          <span class="keywordtype">int</span> <a class="code" href="aarch64-tdep_8c.html#a6b3d1ad0bca4067ccaef1366bea0db04">regnum</a>, <span class="keywordtype">void</span> *regs_buf, <span class="keywordtype">size_t</span> <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>)
<a name="l00635"></a>00635 {
<a name="l00636"></a>00636   <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *regs = regs_buf;
<a name="l00637"></a>00637   <span class="keywordtype">int</span> regno;
<a name="l00638"></a>00638 
<a name="l00639"></a>00639   <span class="keywordflow">for</span> (regno = <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a922ac632f7e25706b6a67b32a8ea966f">ARM_F0_REGNUM</a>; regno &lt;= <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a7844136c6f0b351eb57974cdec429437">ARM_F7_REGNUM</a>; regno++)
<a name="l00640"></a>00640     <span class="keywordflow">if</span> (regnum == -1 || regnum == regno)
<a name="l00641"></a>00641       <a class="code" href="arm-linux-tdep_8c.html#ac2d55f3778e6f8232adba83845d7ce53">collect_nwfpe_register</a> (regcache, regno, regs);
<a name="l00642"></a>00642 
<a name="l00643"></a>00643   <span class="keywordflow">if</span> (regnum == <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39aefb13a782da52622fafa8f2a0385763f">ARM_FPS_REGNUM</a> || regnum == -1)
<a name="l00644"></a>00644     <a class="code" href="regcache_8c.html#a3d2dc4fc1d7d491061e087b547c7f9a8">regcache_raw_collect</a> (regcache, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39aefb13a782da52622fafa8f2a0385763f">ARM_FPS_REGNUM</a>,
<a name="l00645"></a>00645                           regs + <a class="code" href="arm-tdep_8h.html#af8951908fefcd1695cfc95be61c50806">INT_REGISTER_SIZE</a> * <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39aefb13a782da52622fafa8f2a0385763f">ARM_FPS_REGNUM</a>);
<a name="l00646"></a>00646 }
<a name="l00647"></a>00647 
<a name="l00648"></a>00648 <span class="comment">/* Support VFP register format.  */</span>
<a name="l00649"></a>00649 
<a name="l00650"></a><a class="code" href="arm-linux-tdep_8c.html#a5bb6e90859d7e33cab15064004f62ac2">00650</a> <span class="preprocessor">#define ARM_LINUX_SIZEOF_VFP (32 * 8 + 4)</span>
<a name="l00651"></a>00651 <span class="preprocessor"></span>
<a name="l00652"></a>00652 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00653"></a>00653 arm_linux_supply_vfp (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structregset.html">regset</a> *<a class="code" href="structregset.html">regset</a>,
<a name="l00654"></a>00654                       <span class="keyword">struct</span> regcache *regcache,
<a name="l00655"></a>00655                       <span class="keywordtype">int</span> <a class="code" href="aarch64-tdep_8c.html#a6b3d1ad0bca4067ccaef1366bea0db04">regnum</a>, <span class="keyword">const</span> <span class="keywordtype">void</span> *regs_buf, <span class="keywordtype">size_t</span> <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>)
<a name="l00656"></a>00656 {
<a name="l00657"></a>00657   <span class="keyword">const</span> <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *regs = regs_buf;
<a name="l00658"></a>00658   <span class="keywordtype">int</span> regno;
<a name="l00659"></a>00659 
<a name="l00660"></a>00660   <span class="keywordflow">if</span> (regnum == <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a333661b23ddb7e0877059ba1c32a6d65">ARM_FPSCR_REGNUM</a> || regnum == -1)
<a name="l00661"></a>00661     <a class="code" href="regcache_8c.html#a127ceeb6f30d3bab748c60570ac077a6">regcache_raw_supply</a> (regcache, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a333661b23ddb7e0877059ba1c32a6d65">ARM_FPSCR_REGNUM</a>, regs + 32 * 8);
<a name="l00662"></a>00662 
<a name="l00663"></a>00663   <span class="keywordflow">for</span> (regno = <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a704528f53cbbdab4140a945da9610a94">ARM_D0_REGNUM</a>; regno &lt;= <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a004a188fbf115ab0acc1333140946159">ARM_D31_REGNUM</a>; regno++)
<a name="l00664"></a>00664     <span class="keywordflow">if</span> (regnum == -1 || regnum == regno)
<a name="l00665"></a>00665       <a class="code" href="regcache_8c.html#a127ceeb6f30d3bab748c60570ac077a6">regcache_raw_supply</a> (regcache, regno,
<a name="l00666"></a>00666                            regs + (regno - <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a704528f53cbbdab4140a945da9610a94">ARM_D0_REGNUM</a>) * 8);
<a name="l00667"></a>00667 }
<a name="l00668"></a>00668 
<a name="l00669"></a>00669 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00670"></a>00670 arm_linux_collect_vfp (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structregset.html">regset</a> *<a class="code" href="structregset.html">regset</a>,
<a name="l00671"></a>00671                          <span class="keyword">const</span> <span class="keyword">struct</span> regcache *regcache,
<a name="l00672"></a>00672                          <span class="keywordtype">int</span> <a class="code" href="aarch64-tdep_8c.html#a6b3d1ad0bca4067ccaef1366bea0db04">regnum</a>, <span class="keywordtype">void</span> *regs_buf, <span class="keywordtype">size_t</span> <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>)
<a name="l00673"></a>00673 {
<a name="l00674"></a>00674   <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *regs = regs_buf;
<a name="l00675"></a>00675   <span class="keywordtype">int</span> regno;
<a name="l00676"></a>00676 
<a name="l00677"></a>00677   <span class="keywordflow">if</span> (regnum == <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a333661b23ddb7e0877059ba1c32a6d65">ARM_FPSCR_REGNUM</a> || regnum == -1)
<a name="l00678"></a>00678     <a class="code" href="regcache_8c.html#a3d2dc4fc1d7d491061e087b547c7f9a8">regcache_raw_collect</a> (regcache, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a333661b23ddb7e0877059ba1c32a6d65">ARM_FPSCR_REGNUM</a>, regs + 32 * 8);
<a name="l00679"></a>00679 
<a name="l00680"></a>00680   <span class="keywordflow">for</span> (regno = <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a704528f53cbbdab4140a945da9610a94">ARM_D0_REGNUM</a>; regno &lt;= <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a004a188fbf115ab0acc1333140946159">ARM_D31_REGNUM</a>; regno++)
<a name="l00681"></a>00681     <span class="keywordflow">if</span> (regnum == -1 || regnum == regno)
<a name="l00682"></a>00682       <a class="code" href="regcache_8c.html#a3d2dc4fc1d7d491061e087b547c7f9a8">regcache_raw_collect</a> (regcache, regno,
<a name="l00683"></a>00683                             regs + (regno - <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a704528f53cbbdab4140a945da9610a94">ARM_D0_REGNUM</a>) * 8);
<a name="l00684"></a>00684 }
<a name="l00685"></a>00685 
<a name="l00686"></a>00686 <span class="comment">/* Return the appropriate register set for the core section identified</span>
<a name="l00687"></a>00687 <span class="comment">   by SECT_NAME and SECT_SIZE.  */</span>
<a name="l00688"></a>00688 
<a name="l00689"></a>00689 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span>regset *
<a name="l00690"></a>00690 arm_linux_regset_from_core_section (<span class="keyword">struct</span> gdbarch *gdbarch,
<a name="l00691"></a>00691                                     <span class="keyword">const</span> <span class="keywordtype">char</span> *sect_name, <span class="keywordtype">size_t</span> sect_size)
<a name="l00692"></a>00692 {
<a name="l00693"></a>00693   <span class="keyword">struct </span><a class="code" href="structgdbarch__tdep.html">gdbarch_tdep</a> *tdep = <a class="code" href="gdbarch_8c.html#acea996b7421706849bc20567695b5b31">gdbarch_tdep</a> (gdbarch);
<a name="l00694"></a>00694 
<a name="l00695"></a>00695   <span class="keywordflow">if</span> (strcmp (sect_name, <span class="stringliteral">&quot;.reg&quot;</span>) == 0
<a name="l00696"></a>00696       &amp;&amp; sect_size == <a class="code" href="arm-linux-tdep_8c.html#a23b65c506003d4a9bff548fcd20528a5">ARM_LINUX_SIZEOF_GREGSET</a>)
<a name="l00697"></a>00697     {
<a name="l00698"></a>00698       <span class="keywordflow">if</span> (tdep-&gt;<a class="code" href="structgdbarch__tdep.html#a0292e4e45fc2986b86c92cd4a66733fd">gregset</a> == NULL)
<a name="l00699"></a>00699         tdep-&gt;<a class="code" href="structgdbarch__tdep.html#a0292e4e45fc2986b86c92cd4a66733fd">gregset</a> = <a class="code" href="regset_8c.html#ae6cf0b8161f3cf090017a66dcbc54bcb">regset_alloc</a> (gdbarch, <a class="code" href="arm-linux-tdep_8c.html#a236b730e0d0daf4c23166d89c3211e94">arm_linux_supply_gregset</a>,
<a name="l00700"></a>00700                                       <a class="code" href="arm-linux-tdep_8c.html#adf6d830048e76798a4fb27f162e47d6d">arm_linux_collect_gregset</a>);
<a name="l00701"></a>00701       <span class="keywordflow">return</span> tdep-&gt;<a class="code" href="structgdbarch__tdep.html#a0292e4e45fc2986b86c92cd4a66733fd">gregset</a>;
<a name="l00702"></a>00702     }
<a name="l00703"></a>00703 
<a name="l00704"></a>00704   <span class="keywordflow">if</span> (strcmp (sect_name, <span class="stringliteral">&quot;.reg2&quot;</span>) == 0
<a name="l00705"></a>00705       &amp;&amp; sect_size == <a class="code" href="arm-linux-tdep_8h.html#a419eda7ad2690259faf90407808ed220">ARM_LINUX_SIZEOF_NWFPE</a>)
<a name="l00706"></a>00706     {
<a name="l00707"></a>00707       <span class="keywordflow">if</span> (tdep-&gt;<a class="code" href="structgdbarch__tdep.html#af3f6e6595d74dfa5142187feb895bfd5">fpregset</a> == NULL)
<a name="l00708"></a>00708         tdep-&gt;<a class="code" href="structgdbarch__tdep.html#af3f6e6595d74dfa5142187feb895bfd5">fpregset</a> = <a class="code" href="regset_8c.html#ae6cf0b8161f3cf090017a66dcbc54bcb">regset_alloc</a> (gdbarch, <a class="code" href="arm-linux-tdep_8c.html#a5cef8881e02cdcce9fa00d64ce1fcbd7">arm_linux_supply_nwfpe</a>,
<a name="l00709"></a>00709                                        <a class="code" href="arm-linux-tdep_8c.html#a681d56006f6bdbacad1c965c88309418">arm_linux_collect_nwfpe</a>);
<a name="l00710"></a>00710       <span class="keywordflow">return</span> tdep-&gt;<a class="code" href="structgdbarch__tdep.html#af3f6e6595d74dfa5142187feb895bfd5">fpregset</a>;
<a name="l00711"></a>00711     }
<a name="l00712"></a>00712 
<a name="l00713"></a>00713   <span class="keywordflow">if</span> (strcmp (sect_name, <span class="stringliteral">&quot;.reg-arm-vfp&quot;</span>) == 0
<a name="l00714"></a>00714       &amp;&amp; sect_size == <a class="code" href="arm-linux-tdep_8c.html#a5bb6e90859d7e33cab15064004f62ac2">ARM_LINUX_SIZEOF_VFP</a>)
<a name="l00715"></a>00715     {
<a name="l00716"></a>00716       <span class="keywordflow">if</span> (tdep-&gt;<a class="code" href="structgdbarch__tdep.html#a10fd5b2a6ae0d0dbefaf5c8badbc7fb9">vfpregset</a> == NULL)
<a name="l00717"></a>00717         tdep-&gt;<a class="code" href="structgdbarch__tdep.html#a10fd5b2a6ae0d0dbefaf5c8badbc7fb9">vfpregset</a> = <a class="code" href="regset_8c.html#ae6cf0b8161f3cf090017a66dcbc54bcb">regset_alloc</a> (gdbarch, arm_linux_supply_vfp,
<a name="l00718"></a>00718                                         arm_linux_collect_vfp);
<a name="l00719"></a>00719       <span class="keywordflow">return</span> tdep-&gt;<a class="code" href="structgdbarch__tdep.html#a10fd5b2a6ae0d0dbefaf5c8badbc7fb9">vfpregset</a>;
<a name="l00720"></a>00720     }
<a name="l00721"></a>00721 
<a name="l00722"></a>00722   <span class="keywordflow">return</span> NULL;
<a name="l00723"></a>00723 }
<a name="l00724"></a>00724 
<a name="l00725"></a>00725 <span class="comment">/* Core file register set sections.  */</span>
<a name="l00726"></a>00726 
<a name="l00727"></a>00727 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structcore__regset__section.html">core_regset_section</a> arm_linux_fpa_regset_sections[] =
<a name="l00728"></a>00728 {
<a name="l00729"></a>00729   { <span class="stringliteral">&quot;.reg&quot;</span>, <a class="code" href="arm-linux-tdep_8c.html#a23b65c506003d4a9bff548fcd20528a5">ARM_LINUX_SIZEOF_GREGSET</a>, <span class="stringliteral">&quot;general-purpose&quot;</span> },
<a name="l00730"></a>00730   { <span class="stringliteral">&quot;.reg2&quot;</span>, <a class="code" href="arm-linux-tdep_8h.html#a419eda7ad2690259faf90407808ed220">ARM_LINUX_SIZEOF_NWFPE</a>, <span class="stringliteral">&quot;FPA floating-point&quot;</span> },
<a name="l00731"></a>00731   { NULL, 0}
<a name="l00732"></a>00732 };
<a name="l00733"></a>00733 
<a name="l00734"></a>00734 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structcore__regset__section.html">core_regset_section</a> arm_linux_vfp_regset_sections[] =
<a name="l00735"></a>00735 {
<a name="l00736"></a>00736   { <span class="stringliteral">&quot;.reg&quot;</span>, <a class="code" href="arm-linux-tdep_8c.html#a23b65c506003d4a9bff548fcd20528a5">ARM_LINUX_SIZEOF_GREGSET</a>, <span class="stringliteral">&quot;general-purpose&quot;</span> },
<a name="l00737"></a>00737   { <span class="stringliteral">&quot;.reg-arm-vfp&quot;</span>, <a class="code" href="arm-linux-tdep_8c.html#a5bb6e90859d7e33cab15064004f62ac2">ARM_LINUX_SIZEOF_VFP</a>, <span class="stringliteral">&quot;VFP floating-point&quot;</span> },
<a name="l00738"></a>00738   { NULL, 0}
<a name="l00739"></a>00739 };
<a name="l00740"></a>00740 
<a name="l00741"></a>00741 <span class="comment">/* Determine target description from core file.  */</span>
<a name="l00742"></a>00742 
<a name="l00743"></a>00743 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span>target_desc *
<a name="l00744"></a>00744 arm_linux_core_read_description (<span class="keyword">struct</span> gdbarch *gdbarch,
<a name="l00745"></a>00745                                  <span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *target,
<a name="l00746"></a>00746                                  bfd *abfd)
<a name="l00747"></a>00747 {
<a name="l00748"></a>00748   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> arm_hwcap = 0;
<a name="l00749"></a>00749 
<a name="l00750"></a>00750   <span class="keywordflow">if</span> (<a class="code" href="auxv_8c.html#a381e0e50c471f99dfbdc7cf437b32bc5">target_auxv_search</a> (target, AT_HWCAP, &amp;arm_hwcap) != 1)
<a name="l00751"></a>00751     <span class="keywordflow">return</span> NULL;
<a name="l00752"></a>00752 
<a name="l00753"></a>00753   <span class="keywordflow">if</span> (arm_hwcap &amp; <a class="code" href="arm-linux-tdep_8h.html#a2d1cfb86580ddc50a677ab0c9ca28a26">HWCAP_VFP</a>)
<a name="l00754"></a>00754     {
<a name="l00755"></a>00755       <span class="comment">/* NEON implies VFPv3-D32 or no-VFP unit.  Say that we only support</span>
<a name="l00756"></a>00756 <span class="comment">         Neon with VFPv3-D32.  */</span>
<a name="l00757"></a>00757       <span class="keywordflow">if</span> (arm_hwcap &amp; <a class="code" href="arm-linux-tdep_8h.html#a10a32b800c2402e8fafa43a85dd7f878">HWCAP_NEON</a>)
<a name="l00758"></a>00758         <span class="keywordflow">return</span> <a class="code" href="arm-tdep_8h.html#a7af5be34e34bfbd7041f203123e8ace6">tdesc_arm_with_neon</a>;
<a name="l00759"></a>00759       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((arm_hwcap &amp; (<a class="code" href="arm-linux-tdep_8h.html#ac8ad7728b6991074569b46d0df85838c">HWCAP_VFPv3</a> | <a class="code" href="arm-linux-tdep_8h.html#a503270dbe9e608551a883667e1bdf3e1">HWCAP_VFPv3D16</a>)) == <a class="code" href="arm-linux-tdep_8h.html#ac8ad7728b6991074569b46d0df85838c">HWCAP_VFPv3</a>)
<a name="l00760"></a>00760         <span class="keywordflow">return</span> <a class="code" href="arm-tdep_8h.html#a3478d295d60ed5489be8cdf528d85554">tdesc_arm_with_vfpv3</a>;
<a name="l00761"></a>00761       <span class="keywordflow">else</span>
<a name="l00762"></a>00762         <span class="keywordflow">return</span> <a class="code" href="arm-tdep_8h.html#ad8d7def1b92ccd198ded08dbea657de7">tdesc_arm_with_vfpv2</a>;
<a name="l00763"></a>00763     }
<a name="l00764"></a>00764 
<a name="l00765"></a>00765   <span class="keywordflow">return</span> NULL;
<a name="l00766"></a>00766 }
<a name="l00767"></a>00767 
<a name="l00768"></a>00768 
<a name="l00769"></a>00769 <span class="comment">/* Copy the value of next pc of sigreturn and rt_sigrturn into PC,</span>
<a name="l00770"></a>00770 <span class="comment">   return 1.  In addition, set IS_THUMB depending on whether we</span>
<a name="l00771"></a>00771 <span class="comment">   will return to ARM or Thumb code.  Return 0 if it is not a</span>
<a name="l00772"></a>00772 <span class="comment">   rt_sigreturn/sigreturn syscall.  */</span>
<a name="l00773"></a>00773 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00774"></a>00774 arm_linux_sigreturn_return_addr (<span class="keyword">struct</span> frame_info *frame,
<a name="l00775"></a>00775                                  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> svc_number,
<a name="l00776"></a>00776                                  <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> *pc, <span class="keywordtype">int</span> *is_thumb)
<a name="l00777"></a>00777 {
<a name="l00778"></a>00778   <span class="comment">/* Is this a sigreturn or rt_sigreturn syscall?  */</span>
<a name="l00779"></a>00779   <span class="keywordflow">if</span> (svc_number == 119 || svc_number == 173)
<a name="l00780"></a>00780     {
<a name="l00781"></a>00781       <span class="keywordflow">if</span> (<a class="code" href="frame_8c.html#a8f965671d7b55f002c993385024a2fdb">get_frame_type</a> (frame) == <a class="code" href="frame_8h.html#a3ca2c0bc7578bf3d337e34b2c08a6c5fab5e81cbdc78e85afc7451a04b596914e">SIGTRAMP_FRAME</a>)
<a name="l00782"></a>00782         {
<a name="l00783"></a>00783           <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> t_bit = <a class="code" href="arm-tdep_8c.html#ab4ac7391690b407ffa6512903b634661">arm_psr_thumb_bit</a> (<a class="code" href="frame_8c.html#a8691e4f9e65005bf2bbf7aa42378c6fe">frame_unwind_arch</a> (frame));
<a name="l00784"></a>00784           <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> cpsr
<a name="l00785"></a>00785             = <a class="code" href="frame_8c.html#a294f6912118884550787fd59f2a08ff6">frame_unwind_register_unsigned</a> (frame, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a4cb83620826d046dd42f444388bbd5b3">ARM_PS_REGNUM</a>);
<a name="l00786"></a>00786 
<a name="l00787"></a>00787           *is_thumb = (cpsr &amp; t_bit) != 0;
<a name="l00788"></a>00788           *pc = <a class="code" href="frame_8c.html#a674f48736f1324c31ee825c8294f6101">frame_unwind_caller_pc</a> (frame);
<a name="l00789"></a>00789           <span class="keywordflow">return</span> 1;
<a name="l00790"></a>00790         }
<a name="l00791"></a>00791     }
<a name="l00792"></a>00792   <span class="keywordflow">return</span> 0;
<a name="l00793"></a>00793 }
<a name="l00794"></a>00794 
<a name="l00795"></a>00795 <span class="comment">/* At a ptrace syscall-stop, return the syscall number.  This either</span>
<a name="l00796"></a>00796 <span class="comment">   comes from the SWI instruction (OABI) or from r7 (EABI).</span>
<a name="l00797"></a>00797 <span class="comment"></span>
<a name="l00798"></a>00798 <span class="comment">   When the function fails, it should return -1.  */</span>
<a name="l00799"></a>00799 
<a name="l00800"></a>00800 <span class="keyword">static</span> <a class="code" href="defs_8h.html#ac7647a3f71533007c9e128f3ddda1987">LONGEST</a>
<a name="l00801"></a>00801 arm_linux_get_syscall_number (<span class="keyword">struct</span> gdbarch *gdbarch,
<a name="l00802"></a>00802                               <a class="code" href="structptid.html">ptid_t</a> <a class="code" href="structptid.html">ptid</a>)
<a name="l00803"></a>00803 {
<a name="l00804"></a>00804   <span class="keyword">struct </span>regcache *regs = <a class="code" href="regcache_8c.html#aec7af24a2f0b7c27c042f6a22c51291b">get_thread_regcache</a> (ptid);
<a name="l00805"></a>00805   <span class="keyword">struct </span><a class="code" href="structgdbarch__tdep.html">gdbarch_tdep</a> *tdep = <a class="code" href="gdbarch_8c.html#acea996b7421706849bc20567695b5b31">gdbarch_tdep</a> (gdbarch);
<a name="l00806"></a>00806 
<a name="l00807"></a>00807   <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> <a class="code" href="structgdbarch__tdep.html#ab7a207d4e85b564c48238283745247b8">pc</a>;
<a name="l00808"></a>00808   <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> cpsr;
<a name="l00809"></a>00809   <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> t_bit = <a class="code" href="arm-tdep_8c.html#ab4ac7391690b407ffa6512903b634661">arm_psr_thumb_bit</a> (gdbarch);
<a name="l00810"></a>00810   <span class="keywordtype">int</span> is_thumb;
<a name="l00811"></a>00811   <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> svc_number = -1;
<a name="l00812"></a>00812 
<a name="l00813"></a>00813   <a class="code" href="regcache_8c.html#a959a077d769de1641d4f9754cc7b4a1f">regcache_cooked_read_unsigned</a> (regs, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a26bb9ca3fd0b338a1fda326f772134c6">ARM_PC_REGNUM</a>, &amp;pc);
<a name="l00814"></a>00814   <a class="code" href="regcache_8c.html#a959a077d769de1641d4f9754cc7b4a1f">regcache_cooked_read_unsigned</a> (regs, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a4cb83620826d046dd42f444388bbd5b3">ARM_PS_REGNUM</a>, &amp;cpsr);
<a name="l00815"></a>00815   is_thumb = (cpsr &amp; t_bit) != 0;
<a name="l00816"></a>00816 
<a name="l00817"></a>00817   <span class="keywordflow">if</span> (is_thumb)
<a name="l00818"></a>00818     {
<a name="l00819"></a>00819       <a class="code" href="regcache_8c.html#a959a077d769de1641d4f9754cc7b4a1f">regcache_cooked_read_unsigned</a> (regs, 7, &amp;svc_number);
<a name="l00820"></a>00820     }
<a name="l00821"></a>00821   <span class="keywordflow">else</span>
<a name="l00822"></a>00822     {
<a name="l00823"></a>00823       <span class="keyword">enum</span> bfd_endian byte_order_for_code = 
<a name="l00824"></a>00824         <a class="code" href="gdbarch_8c.html#a1d2f84f99f58964411955a36571f6783">gdbarch_byte_order_for_code</a> (gdbarch);
<a name="l00825"></a>00825 
<a name="l00826"></a>00826       <span class="comment">/* PC gets incremented before the syscall-stop, so read the</span>
<a name="l00827"></a>00827 <span class="comment">         previous instruction.  */</span>
<a name="l00828"></a>00828       <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> this_instr = 
<a name="l00829"></a>00829         <a class="code" href="corefile_8c.html#a280cf81e766f60b30618ae3011f2cb07">read_memory_unsigned_integer</a> (pc - 4, 4, byte_order_for_code);
<a name="l00830"></a>00830 
<a name="l00831"></a>00831       <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> svc_operand = (0x00ffffff &amp; this_instr);
<a name="l00832"></a>00832 
<a name="l00833"></a>00833       <span class="keywordflow">if</span> (svc_operand)
<a name="l00834"></a>00834         {
<a name="l00835"></a>00835           <span class="comment">/* OABI */</span>
<a name="l00836"></a>00836           svc_number = svc_operand - 0x900000;
<a name="l00837"></a>00837         }
<a name="l00838"></a>00838       <span class="keywordflow">else</span>
<a name="l00839"></a>00839         {
<a name="l00840"></a>00840           <span class="comment">/* EABI */</span>
<a name="l00841"></a>00841           <a class="code" href="regcache_8c.html#a959a077d769de1641d4f9754cc7b4a1f">regcache_cooked_read_unsigned</a> (regs, 7, &amp;svc_number);
<a name="l00842"></a>00842         }
<a name="l00843"></a>00843     }
<a name="l00844"></a>00844 
<a name="l00845"></a>00845   <span class="keywordflow">return</span> svc_number;
<a name="l00846"></a>00846 }
<a name="l00847"></a>00847 
<a name="l00848"></a>00848 <span class="comment">/* When FRAME is at a syscall instruction, return the PC of the next</span>
<a name="l00849"></a>00849 <span class="comment">   instruction to be executed.  */</span>
<a name="l00850"></a>00850 
<a name="l00851"></a>00851 <span class="keyword">static</span> <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a>
<a name="l00852"></a>00852 arm_linux_syscall_next_pc (<span class="keyword">struct</span> frame_info *frame)
<a name="l00853"></a>00853 {
<a name="l00854"></a>00854   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> pc = <a class="code" href="frame_8c.html#a27aafb00e05cba145dfba0e4bc7b1d70">get_frame_pc</a> (frame);
<a name="l00855"></a>00855   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> return_addr = 0;
<a name="l00856"></a>00856   <span class="keywordtype">int</span> is_thumb = <a class="code" href="arm-tdep_8c.html#af771cd70b92a36a72d01814c8d40506a">arm_frame_is_thumb</a> (frame);
<a name="l00857"></a>00857   <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> svc_number = 0;
<a name="l00858"></a>00858 
<a name="l00859"></a>00859   <span class="keywordflow">if</span> (is_thumb)
<a name="l00860"></a>00860     {
<a name="l00861"></a>00861       svc_number = <a class="code" href="frame_8c.html#affa785e8937e96fd727e46a2cfec94c4">get_frame_register_unsigned</a> (frame, 7);
<a name="l00862"></a>00862       return_addr = pc + 2;
<a name="l00863"></a>00863     }
<a name="l00864"></a>00864   <span class="keywordflow">else</span>
<a name="l00865"></a>00865     {
<a name="l00866"></a>00866       <span class="keyword">struct </span>gdbarch *gdbarch = <a class="code" href="frame_8c.html#ab44507b5655da44e522ed5857835ede7">get_frame_arch</a> (frame);
<a name="l00867"></a>00867       <span class="keyword">enum</span> bfd_endian byte_order_for_code = 
<a name="l00868"></a>00868         <a class="code" href="gdbarch_8c.html#a1d2f84f99f58964411955a36571f6783">gdbarch_byte_order_for_code</a> (gdbarch);
<a name="l00869"></a>00869       <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> this_instr = 
<a name="l00870"></a>00870         <a class="code" href="corefile_8c.html#a280cf81e766f60b30618ae3011f2cb07">read_memory_unsigned_integer</a> (pc, 4, byte_order_for_code);
<a name="l00871"></a>00871 
<a name="l00872"></a>00872       <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> svc_operand = (0x00ffffff &amp; this_instr);
<a name="l00873"></a>00873       <span class="keywordflow">if</span> (svc_operand)  <span class="comment">/* OABI.  */</span>
<a name="l00874"></a>00874         {
<a name="l00875"></a>00875           svc_number = svc_operand - 0x900000;
<a name="l00876"></a>00876         }
<a name="l00877"></a>00877       <span class="keywordflow">else</span> <span class="comment">/* EABI.  */</span>
<a name="l00878"></a>00878         {
<a name="l00879"></a>00879           svc_number = <a class="code" href="frame_8c.html#affa785e8937e96fd727e46a2cfec94c4">get_frame_register_unsigned</a> (frame, 7);
<a name="l00880"></a>00880         }
<a name="l00881"></a>00881 
<a name="l00882"></a>00882       return_addr = pc + 4;
<a name="l00883"></a>00883     }
<a name="l00884"></a>00884 
<a name="l00885"></a>00885   arm_linux_sigreturn_return_addr (frame, svc_number, &amp;return_addr, &amp;is_thumb);
<a name="l00886"></a>00886 
<a name="l00887"></a>00887   <span class="comment">/* Addresses for calling Thumb functions have the bit 0 set.  */</span>
<a name="l00888"></a>00888   <span class="keywordflow">if</span> (is_thumb)
<a name="l00889"></a>00889     return_addr |= 1;
<a name="l00890"></a>00890 
<a name="l00891"></a>00891   <span class="keywordflow">return</span> return_addr;
<a name="l00892"></a>00892 }
<a name="l00893"></a>00893 
<a name="l00894"></a>00894 
<a name="l00895"></a>00895 <span class="comment">/* Insert a single step breakpoint at the next executed instruction.  */</span>
<a name="l00896"></a>00896 
<a name="l00897"></a>00897 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00898"></a>00898 arm_linux_software_single_step (<span class="keyword">struct</span> frame_info *frame)
<a name="l00899"></a>00899 {
<a name="l00900"></a>00900   <span class="keyword">struct </span>gdbarch *gdbarch = <a class="code" href="frame_8c.html#ab44507b5655da44e522ed5857835ede7">get_frame_arch</a> (frame);
<a name="l00901"></a>00901   <span class="keyword">struct </span>address_space *aspace = <a class="code" href="frame_8c.html#abdf9824b7a32ae3a71b8de560a16bfe8">get_frame_address_space</a> (frame);
<a name="l00902"></a>00902   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> next_pc;
<a name="l00903"></a>00903 
<a name="l00904"></a>00904   <span class="keywordflow">if</span> (<a class="code" href="arm-tdep_8c.html#af4ec42b95128fff5b62afa494e290556">arm_deal_with_atomic_sequence</a> (frame))
<a name="l00905"></a>00905     <span class="keywordflow">return</span> 1;
<a name="l00906"></a>00906 
<a name="l00907"></a>00907   next_pc = <a class="code" href="arm-tdep_8c.html#a9ca1b6ee5cb732646a075cbab1d97875">arm_get_next_pc</a> (frame, <a class="code" href="frame_8c.html#a27aafb00e05cba145dfba0e4bc7b1d70">get_frame_pc</a> (frame));
<a name="l00908"></a>00908 
<a name="l00909"></a>00909   <span class="comment">/* The Linux kernel offers some user-mode helpers in a high page.  We can</span>
<a name="l00910"></a>00910 <span class="comment">     not read this page (as of 2.6.23), and even if we could then we couldn&#39;t</span>
<a name="l00911"></a>00911 <span class="comment">     set breakpoints in it, and even if we could then the atomic operations</span>
<a name="l00912"></a>00912 <span class="comment">     would fail when interrupted.  They are all called as functions and return</span>
<a name="l00913"></a>00913 <span class="comment">     to the address in LR, so step to there instead.  */</span>
<a name="l00914"></a>00914   <span class="keywordflow">if</span> (next_pc &gt; 0xffff0000)
<a name="l00915"></a>00915     next_pc = <a class="code" href="frame_8c.html#affa785e8937e96fd727e46a2cfec94c4">get_frame_register_unsigned</a> (frame, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a3824b70706baa72c058dc7740b3285e6">ARM_LR_REGNUM</a>);
<a name="l00916"></a>00916 
<a name="l00917"></a>00917   <a class="code" href="arm-tdep_8c.html#a88bcd72edb126d68445381a19b83f971">arm_insert_single_step_breakpoint</a> (gdbarch, aspace, next_pc);
<a name="l00918"></a>00918 
<a name="l00919"></a>00919   <span class="keywordflow">return</span> 1;
<a name="l00920"></a>00920 }
<a name="l00921"></a>00921 
<a name="l00922"></a>00922 <span class="comment">/* Support for displaced stepping of Linux SVC instructions.  */</span>
<a name="l00923"></a>00923 
<a name="l00924"></a>00924 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00925"></a>00925 arm_linux_cleanup_svc (<span class="keyword">struct</span> gdbarch *gdbarch,
<a name="l00926"></a>00926                        <span class="keyword">struct</span> regcache *regs,
<a name="l00927"></a>00927                        <span class="keyword">struct</span> displaced_step_closure *dsc)
<a name="l00928"></a>00928 {
<a name="l00929"></a>00929   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> <a class="code" href="varobj_8h.html#a43396decd62b46fa01cc6c66a84cbba1">from</a> = dsc-&gt;insn_addr;
<a name="l00930"></a>00930   <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> apparent_pc;
<a name="l00931"></a>00931   <span class="keywordtype">int</span> within_scratch;
<a name="l00932"></a>00932 
<a name="l00933"></a>00933   <a class="code" href="regcache_8c.html#a959a077d769de1641d4f9754cc7b4a1f">regcache_cooked_read_unsigned</a> (regs, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a26bb9ca3fd0b338a1fda326f772134c6">ARM_PC_REGNUM</a>, &amp;apparent_pc);
<a name="l00934"></a>00934 
<a name="l00935"></a>00935   within_scratch = (apparent_pc &gt;= dsc-&gt;scratch_base
<a name="l00936"></a>00936                     &amp;&amp; apparent_pc &lt; (dsc-&gt;scratch_base
<a name="l00937"></a>00937                                       + <a class="code" href="arm-tdep_8h.html#a8c79da2c04c288be134fc63c13ee6af8">DISPLACED_MODIFIED_INSNS</a> * 4 + 4));
<a name="l00938"></a>00938 
<a name="l00939"></a>00939   <span class="keywordflow">if</span> (<a class="code" href="inferior_8h.html#aab9732a6e65fa8c725ca7bca0ed3c9fd">debug_displaced</a>)
<a name="l00940"></a>00940     {
<a name="l00941"></a>00941       <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;displaced: PC is apparently %.8lx after &quot;</span>
<a name="l00942"></a>00942                           <span class="stringliteral">&quot;SVC step &quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) apparent_pc);
<a name="l00943"></a>00943       <span class="keywordflow">if</span> (within_scratch)
<a name="l00944"></a>00944         <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;(within scratch space)\n&quot;</span>);
<a name="l00945"></a>00945       <span class="keywordflow">else</span>
<a name="l00946"></a>00946         <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;(outside scratch space)\n&quot;</span>);
<a name="l00947"></a>00947     }
<a name="l00948"></a>00948 
<a name="l00949"></a>00949   <span class="keywordflow">if</span> (within_scratch)
<a name="l00950"></a>00950     <a class="code" href="arm-tdep_8c.html#ac508242be68416a767908df520595b36">displaced_write_reg</a> (regs, dsc, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a26bb9ca3fd0b338a1fda326f772134c6">ARM_PC_REGNUM</a>, from + 4, <a class="code" href="arm-tdep_8h.html#a45ac2f3b672fe84a98335b1a710e7c16af5caabcf1fcd69421d8480286c3c8703">BRANCH_WRITE_PC</a>);
<a name="l00951"></a>00951 }
<a name="l00952"></a>00952 
<a name="l00953"></a>00953 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00954"></a>00954 arm_linux_copy_svc (<span class="keyword">struct</span> gdbarch *gdbarch, <span class="keyword">struct</span> regcache *regs,
<a name="l00955"></a>00955                     <span class="keyword">struct</span> displaced_step_closure *dsc)
<a name="l00956"></a>00956 {
<a name="l00957"></a>00957   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> return_to = 0;
<a name="l00958"></a>00958 
<a name="l00959"></a>00959   <span class="keyword">struct </span>frame_info *frame;
<a name="l00960"></a>00960   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> svc_number = <a class="code" href="arm-tdep_8c.html#aadeadfa550331350de3423c7a2f0eaa5">displaced_read_reg</a> (regs, dsc, 7);
<a name="l00961"></a>00961   <span class="keywordtype">int</span> is_sigreturn = 0;
<a name="l00962"></a>00962   <span class="keywordtype">int</span> is_thumb;
<a name="l00963"></a>00963 
<a name="l00964"></a>00964   frame = <a class="code" href="frame_8c.html#a5ab254510728049878a232ed1b889820">get_current_frame</a> ();
<a name="l00965"></a>00965 
<a name="l00966"></a>00966   is_sigreturn = arm_linux_sigreturn_return_addr(frame, svc_number,
<a name="l00967"></a>00967                                                  &amp;return_to, &amp;is_thumb);
<a name="l00968"></a>00968   <span class="keywordflow">if</span> (is_sigreturn)
<a name="l00969"></a>00969     {
<a name="l00970"></a>00970           <span class="keyword">struct </span><a class="code" href="structsymtab__and__line.html">symtab_and_line</a> sal;
<a name="l00971"></a>00971 
<a name="l00972"></a>00972           <span class="keywordflow">if</span> (<a class="code" href="inferior_8h.html#aab9732a6e65fa8c725ca7bca0ed3c9fd">debug_displaced</a>)
<a name="l00973"></a>00973             <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;displaced: found &quot;</span>
<a name="l00974"></a>00974               <span class="stringliteral">&quot;sigreturn/rt_sigreturn SVC call.  PC in frame = %lx\n&quot;</span>,
<a name="l00975"></a>00975               (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) <a class="code" href="frame_8c.html#a27aafb00e05cba145dfba0e4bc7b1d70">get_frame_pc</a> (frame));
<a name="l00976"></a>00976 
<a name="l00977"></a>00977           <span class="keywordflow">if</span> (<a class="code" href="inferior_8h.html#aab9732a6e65fa8c725ca7bca0ed3c9fd">debug_displaced</a>)
<a name="l00978"></a>00978             <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;displaced: unwind pc = %lx.  &quot;</span>
<a name="l00979"></a>00979               <span class="stringliteral">&quot;Setting momentary breakpoint.\n&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) return_to);
<a name="l00980"></a>00980 
<a name="l00981"></a>00981           <a class="code" href="gdb__assert_8h.html#aeb007d3e990858c7ef8e40a7e512c1ff">gdb_assert</a> (<a class="code" href="gdbthread_8h.html#a668af1dd99cac24599dc0f3ef6458924">inferior_thread</a> ()-&gt;control.step_resume_breakpoint
<a name="l00982"></a>00982                       == NULL);
<a name="l00983"></a>00983 
<a name="l00984"></a>00984           sal = <a class="code" href="symtab_8c.html#ad9bbd85700e3d7fa50e7ba0e32f37846">find_pc_line</a> (return_to, 0);
<a name="l00985"></a>00985           sal.pc = return_to;
<a name="l00986"></a>00986           sal.section = <a class="code" href="symfile_8c.html#ae3387e3fa4dfcec140196f91111883c1">find_pc_overlay</a> (return_to);
<a name="l00987"></a>00987           sal.explicit_pc = 1;
<a name="l00988"></a>00988 
<a name="l00989"></a>00989           frame = <a class="code" href="frame_8c.html#a7dc158f329065de426029f24f5578838">get_prev_frame</a> (frame);
<a name="l00990"></a>00990 
<a name="l00991"></a>00991           <span class="keywordflow">if</span> (frame)
<a name="l00992"></a>00992             {
<a name="l00993"></a>00993               <a class="code" href="gdbthread_8h.html#a668af1dd99cac24599dc0f3ef6458924">inferior_thread</a> ()-&gt;<a class="code" href="structthread__info.html#a223c3ebf1726773195c6e75c247ddd3c">control</a>.<a class="code" href="structthread__control__state.html#aedd90fdfb0479f1b2a25c73acdfb5c31">step_resume_breakpoint</a>
<a name="l00994"></a>00994                 = <a class="code" href="breakpoint_8c.html#acd9e4d103f6dc73ba3dc2ef1d0e01293">set_momentary_breakpoint</a> (gdbarch, sal, <a class="code" href="frame_8c.html#a4d69effe10c03fa7c702d490081012bf">get_frame_id</a> (frame),
<a name="l00995"></a>00995                                             <a class="code" href="breakpoint_8h.html#a67735d134567a4ba184d011f1db556cfa47c0a1a603215fb93c5db2cbb15e1edc">bp_step_resume</a>);
<a name="l00996"></a>00996 
<a name="l00997"></a>00997               <span class="comment">/* set_momentary_breakpoint invalidates FRAME.  */</span>
<a name="l00998"></a>00998               frame = NULL;
<a name="l00999"></a>00999 
<a name="l01000"></a>01000               <span class="comment">/* We need to make sure we actually insert the momentary</span>
<a name="l01001"></a>01001 <span class="comment">                 breakpoint set above.  */</span>
<a name="l01002"></a>01002               <a class="code" href="breakpoint_8c.html#ad7f103d97fab3402a0d4273193d45cf4">insert_breakpoints</a> ();
<a name="l01003"></a>01003             }
<a name="l01004"></a>01004           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="inferior_8h.html#aab9732a6e65fa8c725ca7bca0ed3c9fd">debug_displaced</a>)
<a name="l01005"></a>01005             <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a2a1dea1e551cadb9541353a004193a47">gdb_stderr</a>, <span class="stringliteral">&quot;displaced: couldn&#39;t find previous &quot;</span>
<a name="l01006"></a>01006                                 <span class="stringliteral">&quot;frame to set momentary breakpoint for &quot;</span>
<a name="l01007"></a>01007                                 <span class="stringliteral">&quot;sigreturn/rt_sigreturn\n&quot;</span>);
<a name="l01008"></a>01008         }
<a name="l01009"></a>01009       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="inferior_8h.html#aab9732a6e65fa8c725ca7bca0ed3c9fd">debug_displaced</a>)
<a name="l01010"></a>01010         <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;displaced: sigreturn/rt_sigreturn &quot;</span>
<a name="l01011"></a>01011                             <span class="stringliteral">&quot;SVC call not in signal trampoline frame\n&quot;</span>);
<a name="l01012"></a>01012     
<a name="l01013"></a>01013 
<a name="l01014"></a>01014   <span class="comment">/* Preparation: If we detect sigreturn, set momentary breakpoint at resume</span>
<a name="l01015"></a>01015 <span class="comment">                  location, else nothing.</span>
<a name="l01016"></a>01016 <span class="comment">     Insn: unmodified svc.</span>
<a name="l01017"></a>01017 <span class="comment">     Cleanup: if pc lands in scratch space, pc &lt;- insn_addr + 4</span>
<a name="l01018"></a>01018 <span class="comment">              else leave pc alone.  */</span>
<a name="l01019"></a>01019 
<a name="l01020"></a>01020 
<a name="l01021"></a>01021   dsc-&gt;cleanup = &amp;arm_linux_cleanup_svc;
<a name="l01022"></a>01022   <span class="comment">/* Pretend we wrote to the PC, so cleanup doesn&#39;t set PC to the next</span>
<a name="l01023"></a>01023 <span class="comment">     instruction.  */</span>
<a name="l01024"></a>01024   dsc-&gt;wrote_to_pc = 1;
<a name="l01025"></a>01025 
<a name="l01026"></a>01026   <span class="keywordflow">return</span> 0;
<a name="l01027"></a>01027 }
<a name="l01028"></a>01028 
<a name="l01029"></a>01029 
<a name="l01030"></a>01030 <span class="comment">/* The following two functions implement single-stepping over calls to Linux</span>
<a name="l01031"></a>01031 <span class="comment">   kernel helper routines, which perform e.g. atomic operations on architecture</span>
<a name="l01032"></a>01032 <span class="comment">   variants which don&#39;t support them natively.</span>
<a name="l01033"></a>01033 <span class="comment"></span>
<a name="l01034"></a>01034 <span class="comment">   When this function is called, the PC will be pointing at the kernel helper</span>
<a name="l01035"></a>01035 <span class="comment">   (at an address inaccessible to GDB), and r14 will point to the return</span>
<a name="l01036"></a>01036 <span class="comment">   address.  Displaced stepping always executes code in the copy area:</span>
<a name="l01037"></a>01037 <span class="comment">   so, make the copy-area instruction branch back to the kernel helper (the</span>
<a name="l01038"></a>01038 <span class="comment">   &quot;from&quot; address), and make r14 point to the breakpoint in the copy area.  In</span>
<a name="l01039"></a>01039 <span class="comment">   that way, we regain control once the kernel helper returns, and can clean</span>
<a name="l01040"></a>01040 <span class="comment">   up appropriately (as if we had just returned from the kernel helper as it</span>
<a name="l01041"></a>01041 <span class="comment">   would have been called from the non-displaced location).  */</span>
<a name="l01042"></a>01042 
<a name="l01043"></a>01043 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01044"></a>01044 cleanup_kernel_helper_return (<span class="keyword">struct</span> gdbarch *gdbarch,
<a name="l01045"></a>01045                               <span class="keyword">struct</span> regcache *regs,
<a name="l01046"></a>01046                               <span class="keyword">struct</span> displaced_step_closure *dsc)
<a name="l01047"></a>01047 {
<a name="l01048"></a>01048   <a class="code" href="arm-tdep_8c.html#ac508242be68416a767908df520595b36">displaced_write_reg</a> (regs, dsc, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a3824b70706baa72c058dc7740b3285e6">ARM_LR_REGNUM</a>, dsc-&gt;tmp[0], <a class="code" href="arm-tdep_8h.html#a45ac2f3b672fe84a98335b1a710e7c16a99e28ba0f8f5f7463a106da647c861b3">CANNOT_WRITE_PC</a>);
<a name="l01049"></a>01049   <a class="code" href="arm-tdep_8c.html#ac508242be68416a767908df520595b36">displaced_write_reg</a> (regs, dsc, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a26bb9ca3fd0b338a1fda326f772134c6">ARM_PC_REGNUM</a>, dsc-&gt;tmp[0], <a class="code" href="arm-tdep_8h.html#a45ac2f3b672fe84a98335b1a710e7c16af5caabcf1fcd69421d8480286c3c8703">BRANCH_WRITE_PC</a>);
<a name="l01050"></a>01050 }
<a name="l01051"></a>01051 
<a name="l01052"></a>01052 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01053"></a>01053 arm_catch_kernel_helper_return (<span class="keyword">struct</span> gdbarch *gdbarch, <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> from,
<a name="l01054"></a>01054                                 <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> <a class="code" href="varobj_8h.html#ae2a2635825813434f3201bf8ace439d2">to</a>, <span class="keyword">struct</span> regcache *regs,
<a name="l01055"></a>01055                                 <span class="keyword">struct</span> displaced_step_closure *dsc)
<a name="l01056"></a>01056 {
<a name="l01057"></a>01057   <span class="keyword">enum</span> bfd_endian byte_order = <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (gdbarch);
<a name="l01058"></a>01058 
<a name="l01059"></a>01059   dsc-&gt;numinsns = 1;
<a name="l01060"></a>01060   dsc-&gt;insn_addr = <a class="code" href="varobj_8h.html#a43396decd62b46fa01cc6c66a84cbba1">from</a>;
<a name="l01061"></a>01061   dsc-&gt;cleanup = &amp;cleanup_kernel_helper_return;
<a name="l01062"></a>01062   <span class="comment">/* Say we wrote to the PC, else cleanup will set PC to the next</span>
<a name="l01063"></a>01063 <span class="comment">     instruction in the helper, which isn&#39;t helpful.  */</span>
<a name="l01064"></a>01064   dsc-&gt;wrote_to_pc = 1;
<a name="l01065"></a>01065 
<a name="l01066"></a>01066   <span class="comment">/* Preparation: tmp[0] &lt;- r14</span>
<a name="l01067"></a>01067 <span class="comment">                  r14 &lt;- &lt;scratch space&gt;+4</span>
<a name="l01068"></a>01068 <span class="comment">                  *(&lt;scratch space&gt;+8) &lt;- from</span>
<a name="l01069"></a>01069 <span class="comment">     Insn: ldr pc, [r14, #4]</span>
<a name="l01070"></a>01070 <span class="comment">     Cleanup: r14 &lt;- tmp[0], pc &lt;- tmp[0].  */</span>
<a name="l01071"></a>01071 
<a name="l01072"></a>01072   dsc-&gt;tmp[0] = <a class="code" href="arm-tdep_8c.html#aadeadfa550331350de3423c7a2f0eaa5">displaced_read_reg</a> (regs, dsc, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a3824b70706baa72c058dc7740b3285e6">ARM_LR_REGNUM</a>);
<a name="l01073"></a>01073   <a class="code" href="arm-tdep_8c.html#ac508242be68416a767908df520595b36">displaced_write_reg</a> (regs, dsc, <a class="code" href="arm-tdep_8h.html#ad43b4f93ee5d7966ec86ea5c75163c39a3824b70706baa72c058dc7740b3285e6">ARM_LR_REGNUM</a>, (<a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a>) to + 4,
<a name="l01074"></a>01074                        <a class="code" href="arm-tdep_8h.html#a45ac2f3b672fe84a98335b1a710e7c16a99e28ba0f8f5f7463a106da647c861b3">CANNOT_WRITE_PC</a>);
<a name="l01075"></a>01075   <a class="code" href="corefile_8c.html#a5d984a6b6854bdefc717e88447000790">write_memory_unsigned_integer</a> (to + 8, 4, byte_order, from);
<a name="l01076"></a>01076 
<a name="l01077"></a>01077   dsc-&gt;modinsn[0] = 0xe59ef004;  <span class="comment">/* ldr pc, [lr, #4].  */</span>
<a name="l01078"></a>01078 }
<a name="l01079"></a>01079 
<a name="l01080"></a>01080 <span class="comment">/* Linux-specific displaced step instruction copying function.  Detects when</span>
<a name="l01081"></a>01081 <span class="comment">   the program has stepped into a Linux kernel helper routine (which must be</span>
<a name="l01082"></a>01082 <span class="comment">   handled as a special case), falling back to arm_displaced_step_copy_insn()</span>
<a name="l01083"></a>01083 <span class="comment">   if it hasn&#39;t.  */</span>
<a name="l01084"></a>01084 
<a name="l01085"></a>01085 <span class="keyword">static</span> <span class="keyword">struct </span>displaced_step_closure *
<a name="l01086"></a>01086 arm_linux_displaced_step_copy_insn (<span class="keyword">struct</span> gdbarch *gdbarch,
<a name="l01087"></a>01087                                     <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> from, <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> to,
<a name="l01088"></a>01088                                     <span class="keyword">struct</span> regcache *regs)
<a name="l01089"></a>01089 {
<a name="l01090"></a>01090   <span class="keyword">struct </span>displaced_step_closure *dsc
<a name="l01091"></a>01091     = <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (<span class="keyword">sizeof</span> (<span class="keyword">struct</span> displaced_step_closure));
<a name="l01092"></a>01092 
<a name="l01093"></a>01093   <span class="comment">/* Detect when we enter an (inaccessible by GDB) Linux kernel helper, and</span>
<a name="l01094"></a>01094 <span class="comment">     stop at the return location.  */</span>
<a name="l01095"></a>01095   <span class="keywordflow">if</span> (from &gt; 0xffff0000)
<a name="l01096"></a>01096     {
<a name="l01097"></a>01097       <span class="keywordflow">if</span> (<a class="code" href="inferior_8h.html#aab9732a6e65fa8c725ca7bca0ed3c9fd">debug_displaced</a>)
<a name="l01098"></a>01098         <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;displaced: detected kernel helper &quot;</span>
<a name="l01099"></a>01099                             <span class="stringliteral">&quot;at %.8lx\n&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) from);
<a name="l01100"></a>01100 
<a name="l01101"></a>01101       arm_catch_kernel_helper_return (gdbarch, from, to, regs, dsc);
<a name="l01102"></a>01102     }
<a name="l01103"></a>01103   <span class="keywordflow">else</span>
<a name="l01104"></a>01104     {
<a name="l01105"></a>01105       <span class="comment">/* Override the default handling of SVC instructions.  */</span>
<a name="l01106"></a>01106       dsc-&gt;u.svc.copy_svc_os = arm_linux_copy_svc;
<a name="l01107"></a>01107 
<a name="l01108"></a>01108       <a class="code" href="arm-tdep_8c.html#a176f9489087ede0c0a12a274ccdbd6df">arm_process_displaced_insn</a> (gdbarch, from, to, regs, dsc);
<a name="l01109"></a>01109     }
<a name="l01110"></a>01110 
<a name="l01111"></a>01111   <a class="code" href="arm-tdep_8c.html#ad8f1aed56e2a78e1982bde6df0854f84">arm_displaced_init_closure</a> (gdbarch, from, to, dsc);
<a name="l01112"></a>01112 
<a name="l01113"></a>01113   <span class="keywordflow">return</span> dsc;
<a name="l01114"></a>01114 }
<a name="l01115"></a>01115 
<a name="l01116"></a>01116 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01117"></a>01117 arm_stap_is_single_operand (<span class="keyword">struct</span> gdbarch *gdbarch, <span class="keyword">const</span> <span class="keywordtype">char</span> *s)
<a name="l01118"></a>01118 {
<a name="l01119"></a>01119   <span class="keywordflow">return</span> (*s == <span class="charliteral">&#39;#&#39;</span> <span class="comment">/* Literal number.  */</span>
<a name="l01120"></a>01120           || *s == <span class="charliteral">&#39;[&#39;</span> <span class="comment">/* Register indirection or</span>
<a name="l01121"></a>01121 <span class="comment">                          displacement.  */</span>
<a name="l01122"></a>01122           || isalpha (*s)); <span class="comment">/* Register value.  */</span>
<a name="l01123"></a>01123 }
<a name="l01124"></a>01124 
<a name="l01125"></a>01125 <span class="comment">/* This routine is used to parse a special token in ARM&#39;s assembly.</span>
<a name="l01126"></a>01126 <span class="comment"></span>
<a name="l01127"></a>01127 <span class="comment">   The special tokens parsed by it are:</span>
<a name="l01128"></a>01128 <span class="comment"></span>
<a name="l01129"></a>01129 <span class="comment">      - Register displacement (e.g, [fp, #-8])</span>
<a name="l01130"></a>01130 <span class="comment"></span>
<a name="l01131"></a>01131 <span class="comment">   It returns one if the special token has been parsed successfully,</span>
<a name="l01132"></a>01132 <span class="comment">   or zero if the current token is not considered special.  */</span>
<a name="l01133"></a>01133 
<a name="l01134"></a>01134 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01135"></a>01135 arm_stap_parse_special_token (<span class="keyword">struct</span> gdbarch *gdbarch,
<a name="l01136"></a>01136                               <span class="keyword">struct</span> <a class="code" href="structstap__parse__info.html">stap_parse_info</a> *p)
<a name="l01137"></a>01137 {
<a name="l01138"></a>01138   <span class="keywordflow">if</span> (*p-&gt;<a class="code" href="structstap__parse__info.html#aa60f88c654670a176dabf0481abcd225">arg</a> == <span class="charliteral">&#39;[&#39;</span>)
<a name="l01139"></a>01139     {
<a name="l01140"></a>01140       <span class="comment">/* Temporary holder for lookahead.  */</span>
<a name="l01141"></a>01141       <span class="keyword">const</span> <span class="keywordtype">char</span> *tmp = p-&gt;<a class="code" href="structstap__parse__info.html#aa60f88c654670a176dabf0481abcd225">arg</a>;
<a name="l01142"></a>01142       <span class="keywordtype">char</span> *endp;
<a name="l01143"></a>01143       <span class="comment">/* Used to save the register name.  */</span>
<a name="l01144"></a>01144       <span class="keyword">const</span> <span class="keywordtype">char</span> *start;
<a name="l01145"></a>01145       <span class="keywordtype">char</span> *regname;
<a name="l01146"></a>01146       <span class="keywordtype">int</span> <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>, <a class="code" href="common_2agent_8c.html#aed7ea92f45bd273dde380a45ddced592">offset</a>;
<a name="l01147"></a>01147       <span class="keywordtype">int</span> got_minus = 0;
<a name="l01148"></a>01148       <span class="keywordtype">long</span> displacement;
<a name="l01149"></a>01149       <span class="keyword">struct </span><a class="code" href="structstoken.html">stoken</a> str;
<a name="l01150"></a>01150 
<a name="l01151"></a>01151       ++tmp;
<a name="l01152"></a>01152       start = tmp;
<a name="l01153"></a>01153 
<a name="l01154"></a>01154       <span class="comment">/* Register name.  */</span>
<a name="l01155"></a>01155       <span class="keywordflow">while</span> (isalnum (*tmp))
<a name="l01156"></a>01156         ++tmp;
<a name="l01157"></a>01157 
<a name="l01158"></a>01158       <span class="keywordflow">if</span> (*tmp != <span class="charliteral">&#39;,&#39;</span>)
<a name="l01159"></a>01159         <span class="keywordflow">return</span> 0;
<a name="l01160"></a>01160 
<a name="l01161"></a>01161       len = tmp - start;
<a name="l01162"></a>01162       regname = alloca (len + 2);
<a name="l01163"></a>01163 
<a name="l01164"></a>01164       offset = 0;
<a name="l01165"></a>01165       <span class="keywordflow">if</span> (isdigit (*start))
<a name="l01166"></a>01166         {
<a name="l01167"></a>01167           <span class="comment">/* If we are dealing with a register whose name begins with a</span>
<a name="l01168"></a>01168 <span class="comment">             digit, it means we should prefix the name with the letter</span>
<a name="l01169"></a>01169 <span class="comment">             `r&#39;, because GDB expects this name pattern.  Otherwise (e.g.,</span>
<a name="l01170"></a>01170 <span class="comment">             we are dealing with the register `fp&#39;), we don&#39;t need to</span>
<a name="l01171"></a>01171 <span class="comment">             add such a prefix.  */</span>
<a name="l01172"></a>01172           regname[0] = <span class="charliteral">&#39;r&#39;</span>;
<a name="l01173"></a>01173           offset = 1;
<a name="l01174"></a>01174         }
<a name="l01175"></a>01175 
<a name="l01176"></a>01176       strncpy (regname + offset, start, len);
<a name="l01177"></a>01177       len += <a class="code" href="common_2agent_8c.html#aed7ea92f45bd273dde380a45ddced592">offset</a>;
<a name="l01178"></a>01178       regname[<a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01179"></a>01179 
<a name="l01180"></a>01180       <span class="keywordflow">if</span> (<a class="code" href="user-regs_8c.html#a73129d16744501cecc45fb94c573c277">user_reg_map_name_to_regnum</a> (gdbarch, regname, len) == -1)
<a name="l01181"></a>01181         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Invalid register name `%s&#39; on expression `%s&#39;.&quot;</span>),
<a name="l01182"></a>01182                regname, p-&gt;<a class="code" href="structstap__parse__info.html#ae1551504f27fb95d9e371c4fc5094c45">saved_arg</a>);
<a name="l01183"></a>01183 
<a name="l01184"></a>01184       ++tmp;
<a name="l01185"></a>01185       tmp = <a class="code" href="cli-utils_8c.html#aad7df612354d99c740a7ea12eccd3848">skip_spaces_const</a> (tmp);
<a name="l01186"></a>01186       <span class="keywordflow">if</span> (*tmp++ != <span class="charliteral">&#39;#&#39;</span>)
<a name="l01187"></a>01187         <span class="keywordflow">return</span> 0;
<a name="l01188"></a>01188 
<a name="l01189"></a>01189       <span class="keywordflow">if</span> (*tmp == <span class="charliteral">&#39;-&#39;</span>)
<a name="l01190"></a>01190         {
<a name="l01191"></a>01191           ++tmp;
<a name="l01192"></a>01192           got_minus = 1;
<a name="l01193"></a>01193         }
<a name="l01194"></a>01194 
<a name="l01195"></a>01195       displacement = strtol (tmp, &amp;endp, 10);
<a name="l01196"></a>01196       tmp = endp;
<a name="l01197"></a>01197 
<a name="l01198"></a>01198       <span class="comment">/* Skipping last `]&#39;.  */</span>
<a name="l01199"></a>01199       <span class="keywordflow">if</span> (*tmp++ != <span class="charliteral">&#39;]&#39;</span>)
<a name="l01200"></a>01200         <span class="keywordflow">return</span> 0;
<a name="l01201"></a>01201 
<a name="l01202"></a>01202       <span class="comment">/* The displacement.  */</span>
<a name="l01203"></a>01203       <a class="code" href="parse_8c.html#a609d0f31c6ee03ad8a531647ff6cf7d5">write_exp_elt_opcode</a> (OP_LONG);
<a name="l01204"></a>01204       <a class="code" href="parse_8c.html#a18da22a62164984a3f77d4d32f197ab1">write_exp_elt_type</a> (<a class="code" href="structbuiltin__type.html">builtin_type</a> (gdbarch)-&gt;builtin_long);
<a name="l01205"></a>01205       <a class="code" href="parse_8c.html#a64ae80b2d7d8330fcdf8c76e982b04cc">write_exp_elt_longcst</a> (displacement);
<a name="l01206"></a>01206       <a class="code" href="parse_8c.html#a609d0f31c6ee03ad8a531647ff6cf7d5">write_exp_elt_opcode</a> (OP_LONG);
<a name="l01207"></a>01207       <span class="keywordflow">if</span> (got_minus)
<a name="l01208"></a>01208         <a class="code" href="parse_8c.html#a609d0f31c6ee03ad8a531647ff6cf7d5">write_exp_elt_opcode</a> (UNOP_NEG);
<a name="l01209"></a>01209 
<a name="l01210"></a>01210       <span class="comment">/* The register name.  */</span>
<a name="l01211"></a>01211       <a class="code" href="parse_8c.html#a609d0f31c6ee03ad8a531647ff6cf7d5">write_exp_elt_opcode</a> (OP_REGISTER);
<a name="l01212"></a>01212       str.ptr = regname;
<a name="l01213"></a>01213       str.length = <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>;
<a name="l01214"></a>01214       <a class="code" href="parse_8c.html#a55b5f06af751f5dbe925473bd79e9b50">write_exp_string</a> (str);
<a name="l01215"></a>01215       <a class="code" href="parse_8c.html#a609d0f31c6ee03ad8a531647ff6cf7d5">write_exp_elt_opcode</a> (OP_REGISTER);
<a name="l01216"></a>01216 
<a name="l01217"></a>01217       <a class="code" href="parse_8c.html#a609d0f31c6ee03ad8a531647ff6cf7d5">write_exp_elt_opcode</a> (BINOP_ADD);
<a name="l01218"></a>01218 
<a name="l01219"></a>01219       <span class="comment">/* Casting to the expected type.  */</span>
<a name="l01220"></a>01220       <a class="code" href="parse_8c.html#a609d0f31c6ee03ad8a531647ff6cf7d5">write_exp_elt_opcode</a> (UNOP_CAST);
<a name="l01221"></a>01221       <a class="code" href="parse_8c.html#a18da22a62164984a3f77d4d32f197ab1">write_exp_elt_type</a> (<a class="code" href="gdbtypes_8c.html#a8edb8d75a169b1455414b420088d1887">lookup_pointer_type</a> (p-&gt;<a class="code" href="structstap__parse__info.html#afc6bf519aeaf28cfcb6f115f809d7e9e">arg_type</a>));
<a name="l01222"></a>01222       <a class="code" href="parse_8c.html#a609d0f31c6ee03ad8a531647ff6cf7d5">write_exp_elt_opcode</a> (UNOP_CAST);
<a name="l01223"></a>01223 
<a name="l01224"></a>01224       <a class="code" href="parse_8c.html#a609d0f31c6ee03ad8a531647ff6cf7d5">write_exp_elt_opcode</a> (UNOP_IND);
<a name="l01225"></a>01225 
<a name="l01226"></a>01226       p-&gt;<a class="code" href="structstap__parse__info.html#aa60f88c654670a176dabf0481abcd225">arg</a> = tmp;
<a name="l01227"></a>01227     }
<a name="l01228"></a>01228   <span class="keywordflow">else</span>
<a name="l01229"></a>01229     <span class="keywordflow">return</span> 0;
<a name="l01230"></a>01230 
<a name="l01231"></a>01231   <span class="keywordflow">return</span> 1;
<a name="l01232"></a>01232 }
<a name="l01233"></a>01233 
<a name="l01234"></a>01234 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01235"></a>01235 arm_linux_init_abi (<span class="keyword">struct</span> <a class="code" href="structgdbarch__info.html">gdbarch_info</a> info,
<a name="l01236"></a>01236                     <span class="keyword">struct</span> gdbarch *gdbarch)
<a name="l01237"></a>01237 {
<a name="l01238"></a>01238   <span class="keyword">struct </span><a class="code" href="structgdbarch__tdep.html">gdbarch_tdep</a> *tdep = <a class="code" href="gdbarch_8c.html#acea996b7421706849bc20567695b5b31">gdbarch_tdep</a> (gdbarch);
<a name="l01239"></a>01239 
<a name="l01240"></a>01240   <a class="code" href="linux-tdep_8c.html#a4f8fc8d423c3cbbab4d15bd33388b3e4">linux_init_abi</a> (info, gdbarch);
<a name="l01241"></a>01241 
<a name="l01242"></a>01242   tdep-&gt;<a class="code" href="structgdbarch__tdep.html#ab1315fad109488af7b69c3d1dedafde5">lowest_pc</a> = 0x8000;
<a name="l01243"></a>01243   <span class="keywordflow">if</span> (info.<a class="code" href="structgdbarch__info.html#a3e00b4a4262051d8be65696b48662225">byte_order</a> == BFD_ENDIAN_BIG)
<a name="l01244"></a>01244     {
<a name="l01245"></a>01245       <span class="keywordflow">if</span> (tdep-&gt;<a class="code" href="structgdbarch__tdep.html#a50f6120551679a45f42a7c200005940f">arm_abi</a> == <a class="code" href="arm-tdep_8h.html#a3dc29a5ec67bbce52b3f60f88de6c29ca3eda474c622aa5a9947544ca5f49f234">ARM_ABI_AAPCS</a>)
<a name="l01246"></a>01246         tdep-&gt;<a class="code" href="structgdbarch__tdep.html#a358b1b8065fb8765a53374922660deb5">arm_breakpoint</a> = eabi_linux_arm_be_breakpoint;
<a name="l01247"></a>01247       <span class="keywordflow">else</span>
<a name="l01248"></a>01248         tdep-&gt;<a class="code" href="structgdbarch__tdep.html#a358b1b8065fb8765a53374922660deb5">arm_breakpoint</a> = arm_linux_arm_be_breakpoint;
<a name="l01249"></a>01249       tdep-&gt;<a class="code" href="structgdbarch__tdep.html#ae2dcea210fe9ec4d6dd020dfd6aa3b8e">thumb_breakpoint</a> = arm_linux_thumb_be_breakpoint;
<a name="l01250"></a>01250       tdep-&gt;<a class="code" href="structgdbarch__tdep.html#ac49111eb91409e796d21c9a4ff5fcfba">thumb2_breakpoint</a> = arm_linux_thumb2_be_breakpoint;
<a name="l01251"></a>01251     }
<a name="l01252"></a>01252   <span class="keywordflow">else</span>
<a name="l01253"></a>01253     {
<a name="l01254"></a>01254       <span class="keywordflow">if</span> (tdep-&gt;<a class="code" href="structgdbarch__tdep.html#a50f6120551679a45f42a7c200005940f">arm_abi</a> == <a class="code" href="arm-tdep_8h.html#a3dc29a5ec67bbce52b3f60f88de6c29ca3eda474c622aa5a9947544ca5f49f234">ARM_ABI_AAPCS</a>)
<a name="l01255"></a>01255         tdep-&gt;<a class="code" href="structgdbarch__tdep.html#a358b1b8065fb8765a53374922660deb5">arm_breakpoint</a> = eabi_linux_arm_le_breakpoint;
<a name="l01256"></a>01256       <span class="keywordflow">else</span>
<a name="l01257"></a>01257         tdep-&gt;<a class="code" href="structgdbarch__tdep.html#a358b1b8065fb8765a53374922660deb5">arm_breakpoint</a> = arm_linux_arm_le_breakpoint;
<a name="l01258"></a>01258       tdep-&gt;<a class="code" href="structgdbarch__tdep.html#ae2dcea210fe9ec4d6dd020dfd6aa3b8e">thumb_breakpoint</a> = arm_linux_thumb_le_breakpoint;
<a name="l01259"></a>01259       tdep-&gt;<a class="code" href="structgdbarch__tdep.html#ac49111eb91409e796d21c9a4ff5fcfba">thumb2_breakpoint</a> = arm_linux_thumb2_le_breakpoint;
<a name="l01260"></a>01260     }
<a name="l01261"></a>01261   tdep-&gt;<a class="code" href="structgdbarch__tdep.html#ada1ff5cc815d068bb4283b46ac02a28d">arm_breakpoint_size</a> = <span class="keyword">sizeof</span> (arm_linux_arm_le_breakpoint);
<a name="l01262"></a>01262   tdep-&gt;<a class="code" href="structgdbarch__tdep.html#afe9c8596f7d7dc1675927920a14ad2b2">thumb_breakpoint_size</a> = <span class="keyword">sizeof</span> (arm_linux_thumb_le_breakpoint);
<a name="l01263"></a>01263   tdep-&gt;<a class="code" href="structgdbarch__tdep.html#a9d3e0b59cd255bcefcfdef76b74a86b0">thumb2_breakpoint_size</a> = <span class="keyword">sizeof</span> (arm_linux_thumb2_le_breakpoint);
<a name="l01264"></a>01264 
<a name="l01265"></a>01265   <span class="keywordflow">if</span> (tdep-&gt;<a class="code" href="structgdbarch__tdep.html#a53a748d892840b403d670577feae3de2">fp_model</a> == <a class="code" href="arm-tdep_8h.html#a9f4e225709d59537eba126cb9894ab7ea15c02589ecdd678d73fc153c80b02921">ARM_FLOAT_AUTO</a>)
<a name="l01266"></a>01266     tdep-&gt;<a class="code" href="structgdbarch__tdep.html#a53a748d892840b403d670577feae3de2">fp_model</a> = <a class="code" href="arm-tdep_8h.html#a9f4e225709d59537eba126cb9894ab7ea31fd2be6c3adc447513c9222e7d2aef3">ARM_FLOAT_FPA</a>;
<a name="l01267"></a>01267 
<a name="l01268"></a>01268   <span class="keywordflow">switch</span> (tdep-&gt;<a class="code" href="structgdbarch__tdep.html#a53a748d892840b403d670577feae3de2">fp_model</a>)
<a name="l01269"></a>01269     {
<a name="l01270"></a>01270     <span class="keywordflow">case</span> <a class="code" href="arm-tdep_8h.html#a9f4e225709d59537eba126cb9894ab7ea31fd2be6c3adc447513c9222e7d2aef3">ARM_FLOAT_FPA</a>:
<a name="l01271"></a>01271       tdep-&gt;<a class="code" href="structgdbarch__tdep.html#ab239cee5e4f9c98642ba75a9609f1122">jb_pc</a> = <a class="code" href="arm-linux-tdep_8c.html#af0668fcaaac93f15aa8e787e25dab497">ARM_LINUX_JB_PC_FPA</a>;
<a name="l01272"></a>01272       <span class="keywordflow">break</span>;
<a name="l01273"></a>01273     <span class="keywordflow">case</span> <a class="code" href="arm-tdep_8h.html#a9f4e225709d59537eba126cb9894ab7ea7aab390baa024917e0e5ec390d02ba43">ARM_FLOAT_SOFT_FPA</a>:
<a name="l01274"></a>01274     <span class="keywordflow">case</span> <a class="code" href="arm-tdep_8h.html#a9f4e225709d59537eba126cb9894ab7ea670a186c50a9a22ff0293a8a838d241f">ARM_FLOAT_SOFT_VFP</a>:
<a name="l01275"></a>01275     <span class="keywordflow">case</span> <a class="code" href="arm-tdep_8h.html#a9f4e225709d59537eba126cb9894ab7eac8ae5ae1622bd2002287a653d3e2e631">ARM_FLOAT_VFP</a>:
<a name="l01276"></a>01276       tdep-&gt;<a class="code" href="structgdbarch__tdep.html#ab239cee5e4f9c98642ba75a9609f1122">jb_pc</a> = <a class="code" href="arm-linux-tdep_8c.html#ad5669c9e15e549b2dbd4d2b6b98c8d2f">ARM_LINUX_JB_PC_EABI</a>;
<a name="l01277"></a>01277       <span class="keywordflow">break</span>;
<a name="l01278"></a>01278     <span class="keywordflow">default</span>:
<a name="l01279"></a>01279       <a class="code" href="common-utils_8h.html#aa14285d9d3d4171016ef9cf09447e8bb">internal_error</a>
<a name="l01280"></a>01280         (__FILE__, __LINE__,
<a name="l01281"></a>01281          <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;arm_linux_init_abi: Floating point model not supported&quot;</span>));
<a name="l01282"></a>01282       <span class="keywordflow">break</span>;
<a name="l01283"></a>01283     }
<a name="l01284"></a>01284   tdep-&gt;<a class="code" href="structgdbarch__tdep.html#ab03518eb4891a769e7816e52a7f748ae">jb_elt_size</a> = <a class="code" href="arm-linux-tdep_8c.html#a7a0af28d29998e961a81bccbb519a95b">ARM_LINUX_JB_ELEMENT_SIZE</a>;
<a name="l01285"></a>01285 
<a name="l01286"></a>01286   <a class="code" href="solib-svr4_8c.html#a10d31439da2b63753298b3b83865465e">set_solib_svr4_fetch_link_map_offsets</a>
<a name="l01287"></a>01287     (gdbarch, <a class="code" href="solib-svr4_8c.html#aa94176d616f07f4d2fe239a370103c9f">svr4_ilp32_fetch_link_map_offsets</a>);
<a name="l01288"></a>01288 
<a name="l01289"></a>01289   <span class="comment">/* Single stepping.  */</span>
<a name="l01290"></a>01290   <a class="code" href="gdbarch_8c.html#a3ef5204e360b0a4ef1d162945911c403">set_gdbarch_software_single_step</a> (gdbarch, arm_linux_software_single_step);
<a name="l01291"></a>01291 
<a name="l01292"></a>01292   <span class="comment">/* Shared library handling.  */</span>
<a name="l01293"></a>01293   <a class="code" href="gdbarch_8c.html#a07ccbd7ea452da3be3982cf93d7976c7">set_gdbarch_skip_trampoline_code</a> (gdbarch, <a class="code" href="minsyms_8c.html#a242ce2adf8d22461827406bb8ca63924">find_solib_trampoline_target</a>);
<a name="l01294"></a>01294   <a class="code" href="gdbarch_8c.html#a7628a74d0792eed255746ac557cc06c0">set_gdbarch_skip_solib_resolver</a> (gdbarch, <a class="code" href="glibc-tdep_8c.html#a6f4ba5974473bc351e9d58fc70c3a0fd">glibc_skip_solib_resolver</a>);
<a name="l01295"></a>01295 
<a name="l01296"></a>01296   <span class="comment">/* Enable TLS support.  */</span>
<a name="l01297"></a>01297   <a class="code" href="gdbarch_8c.html#a5a2e2806f4e83f8090c0d1b459e4e389">set_gdbarch_fetch_tls_load_module_address</a> (gdbarch,
<a name="l01298"></a>01298                                              <a class="code" href="solib-svr4_8c.html#a783de7f3513032bc52a0cd449abea4d7">svr4_fetch_objfile_link_map</a>);
<a name="l01299"></a>01299 
<a name="l01300"></a>01300   <a class="code" href="tramp-frame_8c.html#af13afa03536325fe059738aed7c4047d">tramp_frame_prepend_unwinder</a> (gdbarch,
<a name="l01301"></a>01301                                 &amp;arm_linux_sigreturn_tramp_frame);
<a name="l01302"></a>01302   <a class="code" href="tramp-frame_8c.html#af13afa03536325fe059738aed7c4047d">tramp_frame_prepend_unwinder</a> (gdbarch,
<a name="l01303"></a>01303                                 &amp;arm_linux_rt_sigreturn_tramp_frame);
<a name="l01304"></a>01304   <a class="code" href="tramp-frame_8c.html#af13afa03536325fe059738aed7c4047d">tramp_frame_prepend_unwinder</a> (gdbarch,
<a name="l01305"></a>01305                                 &amp;arm_eabi_linux_sigreturn_tramp_frame);
<a name="l01306"></a>01306   <a class="code" href="tramp-frame_8c.html#af13afa03536325fe059738aed7c4047d">tramp_frame_prepend_unwinder</a> (gdbarch,
<a name="l01307"></a>01307                                 &amp;arm_eabi_linux_rt_sigreturn_tramp_frame);
<a name="l01308"></a>01308   <a class="code" href="tramp-frame_8c.html#af13afa03536325fe059738aed7c4047d">tramp_frame_prepend_unwinder</a> (gdbarch,
<a name="l01309"></a>01309                                 &amp;arm_linux_restart_syscall_tramp_frame);
<a name="l01310"></a>01310   <a class="code" href="tramp-frame_8c.html#af13afa03536325fe059738aed7c4047d">tramp_frame_prepend_unwinder</a> (gdbarch,
<a name="l01311"></a>01311                                 &amp;arm_kernel_linux_restart_syscall_tramp_frame);
<a name="l01312"></a>01312 
<a name="l01313"></a>01313   <span class="comment">/* Core file support.  */</span>
<a name="l01314"></a>01314   <a class="code" href="gdbarch_8c.html#ab33881224f11fe054d4f4dee5b0d6844">set_gdbarch_regset_from_core_section</a> (gdbarch,
<a name="l01315"></a>01315                                         arm_linux_regset_from_core_section);
<a name="l01316"></a>01316   <a class="code" href="gdbarch_8c.html#a7a8fc3967566edade385e8c275c6eac0">set_gdbarch_core_read_description</a> (gdbarch, arm_linux_core_read_description);
<a name="l01317"></a>01317 
<a name="l01318"></a>01318   <span class="keywordflow">if</span> (tdep-&gt;<a class="code" href="structgdbarch__tdep.html#a6a413f7ff5a4461f50bc12932c21f1da">have_vfp_registers</a>)
<a name="l01319"></a>01319     <a class="code" href="gdbarch_8c.html#acfac313b16e13b07a6f1d339cc7a12b3">set_gdbarch_core_regset_sections</a> (gdbarch, arm_linux_vfp_regset_sections);
<a name="l01320"></a>01320   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tdep-&gt;<a class="code" href="structgdbarch__tdep.html#a1997edf4ff854cd0de5e7c0858da087c">have_fpa_registers</a>)
<a name="l01321"></a>01321     <a class="code" href="gdbarch_8c.html#acfac313b16e13b07a6f1d339cc7a12b3">set_gdbarch_core_regset_sections</a> (gdbarch, arm_linux_fpa_regset_sections);
<a name="l01322"></a>01322 
<a name="l01323"></a>01323   <a class="code" href="gdbarch_8c.html#a86560ca20a273a290b06f347fa05a6f5">set_gdbarch_get_siginfo_type</a> (gdbarch, <a class="code" href="linux-tdep_8c.html#a99c37d02167cddd375f53a64ad6e4459">linux_get_siginfo_type</a>);
<a name="l01324"></a>01324 
<a name="l01325"></a>01325   <span class="comment">/* Displaced stepping.  */</span>
<a name="l01326"></a>01326   <a class="code" href="gdbarch_8c.html#a377f439d7b2cc15ed58b05a954cd5984">set_gdbarch_displaced_step_copy_insn</a> (gdbarch,
<a name="l01327"></a>01327                                         arm_linux_displaced_step_copy_insn);
<a name="l01328"></a>01328   <a class="code" href="gdbarch_8c.html#a172d36c9ff7fbc6903ebbc57971dfb74">set_gdbarch_displaced_step_fixup</a> (gdbarch, <a class="code" href="arm-tdep_8c.html#a90b36dc7782bac8c211f9a43fc21fc14">arm_displaced_step_fixup</a>);
<a name="l01329"></a>01329   <a class="code" href="gdbarch_8c.html#a906aad6d29da88f8574e000d1048bc18">set_gdbarch_displaced_step_free_closure</a> (gdbarch,
<a name="l01330"></a>01330                                            <a class="code" href="arch-utils_8c.html#a229f932ac79dc6a79b04970a66c1828f">simple_displaced_step_free_closure</a>);
<a name="l01331"></a>01331   <a class="code" href="gdbarch_8c.html#a58d22760111bd279c9bec892edaae693">set_gdbarch_displaced_step_location</a> (gdbarch, <a class="code" href="arch-utils_8c.html#a37f304c4df681be4d0c63afb90e2724c">displaced_step_at_entry_point</a>);
<a name="l01332"></a>01332 
<a name="l01333"></a>01333   <span class="comment">/* Reversible debugging, process record.  */</span>
<a name="l01334"></a>01334   <a class="code" href="gdbarch_8c.html#aa8c9dca7e6a98c781e368e51b55080cf">set_gdbarch_process_record</a> (gdbarch, <a class="code" href="arm-tdep_8c.html#a07c811ccf523393ba33001394ec01cee">arm_process_record</a>);
<a name="l01335"></a>01335 
<a name="l01336"></a>01336   <span class="comment">/* SystemTap functions.  */</span>
<a name="l01337"></a>01337   <a class="code" href="gdbarch_8c.html#adecbe083588923af4ccae45078ada032">set_gdbarch_stap_integer_prefix</a> (gdbarch, <span class="stringliteral">&quot;#&quot;</span>);
<a name="l01338"></a>01338   <a class="code" href="gdbarch_8c.html#a1a53c9a086dcf8704a7d5b257f1500f2">set_gdbarch_stap_register_prefix</a> (gdbarch, <span class="stringliteral">&quot;r&quot;</span>);
<a name="l01339"></a>01339   <a class="code" href="gdbarch_8c.html#a614b8e9eb7a857632c27e70cb23cf022">set_gdbarch_stap_register_indirection_prefix</a> (gdbarch, <span class="stringliteral">&quot;[&quot;</span>);
<a name="l01340"></a>01340   <a class="code" href="gdbarch_8c.html#ae6e19d66c76788698add3f1326822789">set_gdbarch_stap_register_indirection_suffix</a> (gdbarch, <span class="stringliteral">&quot;]&quot;</span>);
<a name="l01341"></a>01341   <a class="code" href="gdbarch_8c.html#a313eebd514e9a2ffb50c6963da959562">set_gdbarch_stap_gdb_register_prefix</a> (gdbarch, <span class="stringliteral">&quot;r&quot;</span>);
<a name="l01342"></a>01342   <a class="code" href="gdbarch_8c.html#ad0a074d541b9af3fe54cf453016d6bfc">set_gdbarch_stap_is_single_operand</a> (gdbarch, arm_stap_is_single_operand);
<a name="l01343"></a>01343   <a class="code" href="gdbarch_8c.html#aedc3281f053661d891fc9323a4522026">set_gdbarch_stap_parse_special_token</a> (gdbarch,
<a name="l01344"></a>01344                                         arm_stap_parse_special_token);
<a name="l01345"></a>01345 
<a name="l01346"></a>01346   tdep-&gt;<a class="code" href="structgdbarch__tdep.html#adfdc65c6f29d29cb45503679732c8d21">syscall_next_pc</a> = arm_linux_syscall_next_pc;
<a name="l01347"></a>01347 
<a name="l01348"></a>01348   <span class="comment">/* `catch syscall&#39; */</span>
<a name="l01349"></a>01349   <a class="code" href="xml-syscall_8c.html#a05e4b00abfe1d7dc57ce874206c20aa4">set_xml_syscall_file_name</a> (<span class="stringliteral">&quot;syscalls/arm-linux.xml&quot;</span>);
<a name="l01350"></a>01350   <a class="code" href="gdbarch_8c.html#a70e42efda91aca6e1b5be570963fab1e">set_gdbarch_get_syscall_number</a> (gdbarch, arm_linux_get_syscall_number);
<a name="l01351"></a>01351 
<a name="l01352"></a>01352   <span class="comment">/* Syscall record.  */</span>
<a name="l01353"></a>01353   tdep-&gt;<a class="code" href="structgdbarch__tdep.html#a7f5bf17211bc9002b1535ebb1247fd0f">arm_swi_record</a> = NULL;
<a name="l01354"></a>01354 }
<a name="l01355"></a>01355 
<a name="l01356"></a>01356 <span class="comment">/* Provide a prototype to silence -Wmissing-prototypes.  */</span>
<a name="l01357"></a>01357 <span class="keyword">extern</span> <a class="code" href="defs_8h.html#a686ed07d4fdcdc366f2bc677216ca08d">initialize_file_ftype</a> <a class="code" href="arm-linux-tdep_8c.html#a4590798c4bcc3bb70d6b6f7a03c14a46">_initialize_arm_linux_tdep</a>;
<a name="l01358"></a>01358 
<a name="l01359"></a>01359 <span class="keywordtype">void</span>
<a name="l01360"></a><a class="code" href="arm-linux-tdep_8c.html#a2ab5aba02af378a6b7cc9351d2b47160">01360</a> _initialize_arm_linux_tdep (<span class="keywordtype">void</span>)
<a name="l01361"></a>01361 {
<a name="l01362"></a>01362   <a class="code" href="osabi_8c.html#a128f5a080296285ede027b712a6e3324">gdbarch_register_osabi</a> (bfd_arch_arm, 0, <a class="code" href="defs_8h.html#a9cd05255f6826ff913d539652b5e624fa0b4fe2ba722ad0accc6caf9bd6c67912">GDB_OSABI_LINUX</a>,
<a name="l01363"></a>01363                           arm_linux_init_abi);
<a name="l01364"></a>01364 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Fri Oct 11 2013 14:12:09 for GDB (API) by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
