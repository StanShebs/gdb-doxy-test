<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>GDB (API): /home/stan/gdb/src/gdb/tic6x-tdep.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">GDB (API)
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">/home/stan/gdb/src/gdb/tic6x-tdep.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="tic6x-tdep_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* Target dependent code for GDB on TI C6x systems.</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">   Copyright (C) 2010-2013 Free Software Foundation, Inc.</span>
<a name="l00004"></a>00004 <span class="comment">   Contributed by Andrew Jenner &lt;andrew@codesourcery.com&gt;</span>
<a name="l00005"></a>00005 <span class="comment">   Contributed by Yao Qi &lt;yao@codesourcery.com&gt;</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">   This file is part of GDB.</span>
<a name="l00008"></a>00008 <span class="comment"></span>
<a name="l00009"></a>00009 <span class="comment">   This program is free software; you can redistribute it and/or modify</span>
<a name="l00010"></a>00010 <span class="comment">   it under the terms of the GNU General Public License as published by</span>
<a name="l00011"></a>00011 <span class="comment">   the Free Software Foundation; either version 3 of the License, or</span>
<a name="l00012"></a>00012 <span class="comment">   (at your option) any later version.</span>
<a name="l00013"></a>00013 <span class="comment"></span>
<a name="l00014"></a>00014 <span class="comment">   This program is distributed in the hope that it will be useful,</span>
<a name="l00015"></a>00015 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00016"></a>00016 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00017"></a>00017 <span class="comment">   GNU General Public License for more details.</span>
<a name="l00018"></a>00018 <span class="comment"></span>
<a name="l00019"></a>00019 <span class="comment">   You should have received a copy of the GNU General Public License</span>
<a name="l00020"></a>00020 <span class="comment">   along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.  */</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="defs_8h.html">defs.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="frame_8h.html">frame.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="frame-unwind_8h.html">frame-unwind.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="frame-base_8h.html">frame-base.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="trad-frame_8h.html">trad-frame.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="dwarf2-frame_8h.html">dwarf2-frame.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="symtab_8h.html">symtab.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="inferior_8h.html">inferior.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="gdbtypes_8h.html">gdbtypes.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="gdbcore_8h.html">gdbcore.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="gdbcmd_8h.html">gdbcmd.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="target_8h.html">target.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;dis-asm.h&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="regcache_8h.html">regcache.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="value_8h.html">value.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="symfile_8h.html">symfile.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="arch-utils_8h.html">arch-utils.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;floatformat.h&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="glibc-tdep_8h.html">glibc-tdep.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="infcall_8h.html">infcall.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="regset_8h.html">regset.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="tramp-frame_8h.html">tramp-frame.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="linux-tdep_8h.html">linux-tdep.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="solib_8h.html">solib.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="objfiles_8h.html">objfiles.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="gdb__assert_8h.html">gdb_assert.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="osabi_8h.html">osabi.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="tic6x-tdep_8h.html">tic6x-tdep.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="language_8h.html">language.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="target-descriptions_8h.html">target-descriptions.h</a>&quot;</span>
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="tic6x-c64xp_8c.html">features/tic6x-c64xp.c</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="tic6x-c64x_8c.html">features/tic6x-c64x.c</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="tic6x-c62x_8c.html">features/tic6x-c62x.c</a>&quot;</span>
<a name="l00056"></a>00056 
<a name="l00057"></a><a class="code" href="tic6x-tdep_8c.html#a4c16fdd0b5071f963cba6ee2bcb47aaa">00057</a> <span class="preprocessor">#define TIC6X_OPCODE_SIZE 4</span>
<a name="l00058"></a><a class="code" href="tic6x-tdep_8c.html#ae294917d30d119d02071024f854a77e0">00058</a> <span class="preprocessor"></span><span class="preprocessor">#define TIC6X_FETCH_PACKET_SIZE 32</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span>
<a name="l00060"></a><a class="code" href="tic6x-tdep_8c.html#a7b1ad58f3bb4fc2cfa62467cbc0a50f7">00060</a> <span class="preprocessor">#define INST_S_BIT(INST) ((INST &gt;&gt; 1) &amp; 1)</span>
<a name="l00061"></a><a class="code" href="tic6x-tdep_8c.html#a092de10f37665ddf10408036ac4c2632">00061</a> <span class="preprocessor"></span><span class="preprocessor">#define INST_X_BIT(INST) ((INST &gt;&gt; 12) &amp; 1)</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span>
<a name="l00063"></a><a class="code" href="tic6x-tdep_8h.html#a25a69111f410e45a9639d764f5fb0b21">00063</a> <span class="keyword">const</span> <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> <a class="code" href="tic6x-tdep_8c.html#a25a69111f410e45a9639d764f5fb0b21">tic6x_bkpt_illegal_opcode_be</a>[] = { 0x56, 0x45, 0x43, 0x14 };
<a name="l00064"></a><a class="code" href="tic6x-tdep_8h.html#aa51928c1f364bee726563ce4f77ebab9">00064</a> <span class="keyword">const</span> <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> <a class="code" href="tic6x-tdep_8c.html#aa51928c1f364bee726563ce4f77ebab9">tic6x_bkpt_illegal_opcode_le</a>[] = { 0x14, 0x43, 0x45, 0x56 };
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <span class="keyword">struct </span>tic6x_unwind_cache
<a name="l00067"></a>00067 {
<a name="l00068"></a>00068   <span class="comment">/* The frame&#39;s base, optionally used by the high-level debug info.  */</span>
<a name="l00069"></a>00069   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> base;
<a name="l00070"></a>00070 
<a name="l00071"></a>00071   <span class="comment">/* The previous frame&#39;s inner most stack address.  Used as this</span>
<a name="l00072"></a>00072 <span class="comment">     frame ID&#39;s stack_addr.  */</span>
<a name="l00073"></a>00073   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> cfa;
<a name="l00074"></a>00074 
<a name="l00075"></a>00075   <span class="comment">/* The address of the first instruction in this function */</span>
<a name="l00076"></a>00076   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> pc;
<a name="l00077"></a>00077 
<a name="l00078"></a>00078   <span class="comment">/* Which register holds the return address for the frame.  */</span>
<a name="l00079"></a>00079   <span class="keywordtype">int</span> return_regnum;
<a name="l00080"></a>00080 
<a name="l00081"></a>00081   <span class="comment">/* The offset of register saved on stack.  If register is not saved, the</span>
<a name="l00082"></a>00082 <span class="comment">     corresponding element is -1.  */</span>
<a name="l00083"></a>00083   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> reg_saved[<a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13dac3eb407b6a6a1d0ec7bd09bc98a17ba9">TIC6X_NUM_CORE_REGS</a>];
<a name="l00084"></a>00084 };
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 <span class="comment">/* Name of TI C6x core registers.  */</span>
<a name="l00088"></a>00088 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> tic6x_register_names[] =
<a name="l00089"></a>00089 {
<a name="l00090"></a>00090   <span class="stringliteral">&quot;A0&quot;</span>,  <span class="stringliteral">&quot;A1&quot;</span>,  <span class="stringliteral">&quot;A2&quot;</span>,  <span class="stringliteral">&quot;A3&quot;</span>,  <span class="comment">/*  0  1  2  3 */</span>
<a name="l00091"></a>00091   <span class="stringliteral">&quot;A4&quot;</span>,  <span class="stringliteral">&quot;A5&quot;</span>,  <span class="stringliteral">&quot;A6&quot;</span>,  <span class="stringliteral">&quot;A7&quot;</span>,  <span class="comment">/*  4  5  6  7 */</span>
<a name="l00092"></a>00092   <span class="stringliteral">&quot;A8&quot;</span>,  <span class="stringliteral">&quot;A9&quot;</span>,  <span class="stringliteral">&quot;A10&quot;</span>, <span class="stringliteral">&quot;A11&quot;</span>, <span class="comment">/*  8  9 10 11 */</span>
<a name="l00093"></a>00093   <span class="stringliteral">&quot;A12&quot;</span>, <span class="stringliteral">&quot;A13&quot;</span>, <span class="stringliteral">&quot;A14&quot;</span>, <span class="stringliteral">&quot;A15&quot;</span>, <span class="comment">/* 12 13 14 15 */</span>
<a name="l00094"></a>00094   <span class="stringliteral">&quot;B0&quot;</span>,  <span class="stringliteral">&quot;B1&quot;</span>,  <span class="stringliteral">&quot;B2&quot;</span>,  <span class="stringliteral">&quot;B3&quot;</span>,  <span class="comment">/* 16 17 18 19 */</span>
<a name="l00095"></a>00095   <span class="stringliteral">&quot;B4&quot;</span>,  <span class="stringliteral">&quot;B5&quot;</span>,  <span class="stringliteral">&quot;B6&quot;</span>,  <span class="stringliteral">&quot;B7&quot;</span>,  <span class="comment">/* 20 21 22 23 */</span>
<a name="l00096"></a>00096   <span class="stringliteral">&quot;B8&quot;</span>,  <span class="stringliteral">&quot;B9&quot;</span>,  <span class="stringliteral">&quot;B10&quot;</span>, <span class="stringliteral">&quot;B11&quot;</span>, <span class="comment">/* 24 25 26 27 */</span>
<a name="l00097"></a>00097   <span class="stringliteral">&quot;B12&quot;</span>, <span class="stringliteral">&quot;B13&quot;</span>, <span class="stringliteral">&quot;B14&quot;</span>, <span class="stringliteral">&quot;B15&quot;</span>, <span class="comment">/* 28 29 30 31 */</span>
<a name="l00098"></a>00098   <span class="stringliteral">&quot;CSR&quot;</span>, <span class="stringliteral">&quot;PC&quot;</span>,                <span class="comment">/* 32 33       */</span>
<a name="l00099"></a>00099 };
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 <span class="comment">/* This array maps the arguments to the register number which passes argument</span>
<a name="l00102"></a>00102 <span class="comment">   in function call according to C6000 ELF ABI.  */</span>
<a name="l00103"></a>00103 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> arg_regs[] = { 4, 20, 6, 22, 8, 24, 10, 26, 12, 28 };
<a name="l00104"></a>00104 
<a name="l00105"></a>00105 <span class="comment">/* This is the implementation of gdbarch method register_name.  */</span>
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l00108"></a>00108 tic6x_register_name (<span class="keyword">struct</span> gdbarch *gdbarch, <span class="keywordtype">int</span> regno)
<a name="l00109"></a>00109 {
<a name="l00110"></a>00110   <span class="keywordflow">if</span> (regno &lt; 0)
<a name="l00111"></a>00111     <span class="keywordflow">return</span> NULL;
<a name="l00112"></a>00112 
<a name="l00113"></a>00113   <span class="keywordflow">if</span> (<a class="code" href="target-descriptions_8c.html#a54a8994f193cc0a0cf6dbb6d771becf2">tdesc_has_registers</a> (<a class="code" href="gdbarch_8c.html#a6c19d10a220639cc8f9751ad2235a9f1">gdbarch_target_desc</a> (gdbarch)))
<a name="l00114"></a>00114     <span class="keywordflow">return</span> <a class="code" href="target-descriptions_8c.html#a716bc159e6ca1ac43edf39191e252820">tdesc_register_name</a> (gdbarch, regno);
<a name="l00115"></a>00115   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (regno &gt;= ARRAY_SIZE (tic6x_register_names))
<a name="l00116"></a>00116     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00117"></a>00117   <span class="keywordflow">else</span>
<a name="l00118"></a>00118     <span class="keywordflow">return</span> tic6x_register_names[regno];
<a name="l00119"></a>00119 }
<a name="l00120"></a>00120 
<a name="l00121"></a>00121 <span class="comment">/* This is the implementation of gdbarch method register_type.  */</span>
<a name="l00122"></a>00122 
<a name="l00123"></a>00123 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structtype.html">type</a> *
<a name="l00124"></a>00124 tic6x_register_type (<span class="keyword">struct</span> gdbarch *gdbarch, <span class="keywordtype">int</span> regno)
<a name="l00125"></a>00125 {
<a name="l00126"></a>00126 
<a name="l00127"></a>00127   <span class="keywordflow">if</span> (regno == <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13dad84f8317e56046c7df78ff9ec4469eee">TIC6X_PC_REGNUM</a>)
<a name="l00128"></a>00128     <span class="keywordflow">return</span> <a class="code" href="gdbtypes_8c.html#addd01ebc9ccdf2cacb33ab01e281ddb8">builtin_type</a> (gdbarch)-&gt;<a class="code" href="structbuiltin__type.html#a3db2ea73bd0003f6e6103bd031ba7cb1">builtin_func_ptr</a>;
<a name="l00129"></a>00129   <span class="keywordflow">else</span>
<a name="l00130"></a>00130     <span class="keywordflow">return</span> <a class="code" href="gdbtypes_8c.html#addd01ebc9ccdf2cacb33ab01e281ddb8">builtin_type</a> (gdbarch)-&gt;<a class="code" href="structbuiltin__type.html#a7d0cf7d4e93c3cd2f1b744a18fa23b80">builtin_uint32</a>;
<a name="l00131"></a>00131 }
<a name="l00132"></a>00132 
<a name="l00133"></a>00133 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00134"></a>00134 tic6x_setup_default (<span class="keyword">struct</span> tic6x_unwind_cache *cache)
<a name="l00135"></a>00135 {
<a name="l00136"></a>00136   <span class="keywordtype">int</span> i;
<a name="l00137"></a>00137 
<a name="l00138"></a>00138   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13dac3eb407b6a6a1d0ec7bd09bc98a17ba9">TIC6X_NUM_CORE_REGS</a>; i++)
<a name="l00139"></a>00139     cache-&gt;reg_saved[i] = -1;
<a name="l00140"></a>00140 }
<a name="l00141"></a>00141 
<a name="l00142"></a>00142 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> tic6x_fetch_instruction (<span class="keyword">struct</span> gdbarch *, <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a>);
<a name="l00143"></a>00143 <span class="keyword">static</span> <span class="keywordtype">int</span> tic6x_register_number (<span class="keywordtype">int</span> <a class="code" href="structreg.html">reg</a>, <span class="keywordtype">int</span> side, <span class="keywordtype">int</span> crosspath);
<a name="l00144"></a>00144 
<a name="l00145"></a>00145 <span class="comment">/* Do a full analysis of the prologue at START_PC and update CACHE accordingly.</span>
<a name="l00146"></a>00146 <span class="comment">   Bail out early if CURRENT_PC is reached.  Returns the address of the first</span>
<a name="l00147"></a>00147 <span class="comment">   instruction after the prologue.  */</span>
<a name="l00148"></a>00148 
<a name="l00149"></a>00149 <span class="keyword">static</span> <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a>
<a name="l00150"></a>00150 tic6x_analyze_prologue (<span class="keyword">struct</span> gdbarch *gdbarch, <span class="keyword">const</span> <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> start_pc,
<a name="l00151"></a>00151                         <span class="keyword">const</span> <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> current_pc,
<a name="l00152"></a>00152                         <span class="keyword">struct</span> tic6x_unwind_cache *cache,
<a name="l00153"></a>00153                         <span class="keyword">struct</span> frame_info *this_frame)
<a name="l00154"></a>00154 {
<a name="l00155"></a>00155   <span class="keyword">enum</span> bfd_endian byte_order = <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (gdbarch);
<a name="l00156"></a>00156   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> inst;
<a name="l00157"></a>00157   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> src_reg, base_reg, dst_reg;
<a name="l00158"></a>00158   <span class="keywordtype">int</span> i;
<a name="l00159"></a>00159   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> pc = start_pc;
<a name="l00160"></a>00160   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> return_pc = start_pc;
<a name="l00161"></a>00161   <span class="keywordtype">int</span> frame_base_offset_to_sp = 0;
<a name="l00162"></a>00162   <span class="comment">/* Counter of non-stw instructions after first insn ` sub sp, xxx, sp&#39;.  */</span>
<a name="l00163"></a>00163   <span class="keywordtype">int</span> non_stw_insn_counter = 0;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165   <span class="keywordflow">if</span> (start_pc &gt;= current_pc)
<a name="l00166"></a>00166     return_pc = current_pc;
<a name="l00167"></a>00167 
<a name="l00168"></a>00168   cache-&gt;base = 0;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170   <span class="comment">/* The landmarks in prologue is one or two SUB instructions to SP.</span>
<a name="l00171"></a>00171 <span class="comment">     Instructions on setting up dsbt are in the last part of prologue, if</span>
<a name="l00172"></a>00172 <span class="comment">     needed.  In maxim, prologue can be divided to three parts by two</span>
<a name="l00173"></a>00173 <span class="comment">     `sub sp, xx, sp&#39; insns.  */</span>
<a name="l00174"></a>00174 
<a name="l00175"></a>00175   <span class="comment">/* Step 1: Look for the 1st and 2nd insn `sub sp, xx, sp&#39;,  in which, the</span>
<a name="l00176"></a>00176 <span class="comment">     2nd one is optional.  */</span>
<a name="l00177"></a>00177   <span class="keywordflow">while</span> (pc &lt; current_pc)
<a name="l00178"></a>00178     {
<a name="l00179"></a>00179       <span class="keywordtype">int</span> <a class="code" href="common_2agent_8c.html#aed7ea92f45bd273dde380a45ddced592">offset</a> = 0;
<a name="l00180"></a>00180 
<a name="l00181"></a>00181       <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> inst = tic6x_fetch_instruction (gdbarch, pc);
<a name="l00182"></a>00182 
<a name="l00183"></a>00183       <span class="keywordflow">if</span> ((inst &amp; 0x1ffc) == 0x1dc0 || (inst &amp; 0x1ffc) == 0x1bc0
<a name="l00184"></a>00184           || (inst &amp; 0x0ffc) == 0x9c0)
<a name="l00185"></a>00185         {
<a name="l00186"></a>00186           <span class="comment">/* SUBAW/SUBAH/SUB, and src1 is ucst 5.  */</span>
<a name="l00187"></a>00187           <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> src2 = tic6x_register_number ((inst &gt;&gt; 18) &amp; 0x1f,
<a name="l00188"></a>00188                                                      <a class="code" href="tic6x-tdep_8c.html#a7b1ad58f3bb4fc2cfa62467cbc0a50f7">INST_S_BIT</a> (inst), 0);
<a name="l00189"></a>00189           <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> dst = tic6x_register_number ((inst &gt;&gt; 23) &amp; 0x1f,
<a name="l00190"></a>00190                                                     <a class="code" href="tic6x-tdep_8c.html#a7b1ad58f3bb4fc2cfa62467cbc0a50f7">INST_S_BIT</a> (inst), 0);
<a name="l00191"></a>00191 
<a name="l00192"></a>00192           <span class="keywordflow">if</span> (src2 == <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da5da070e8fd88704a05f42848c2060587">TIC6X_SP_REGNUM</a> &amp;&amp; dst == <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da5da070e8fd88704a05f42848c2060587">TIC6X_SP_REGNUM</a>)
<a name="l00193"></a>00193             {
<a name="l00194"></a>00194               <span class="comment">/* Extract const from insn SUBAW/SUBAH/SUB, and translate it to</span>
<a name="l00195"></a>00195 <span class="comment">                 offset.  The constant offset is decoded in bit 13-17 in all</span>
<a name="l00196"></a>00196 <span class="comment">                 these three kinds of instructions.  */</span>
<a name="l00197"></a>00197               <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ucst5 = (inst &gt;&gt; 13) &amp; 0x1f;
<a name="l00198"></a>00198 
<a name="l00199"></a>00199               <span class="keywordflow">if</span> ((inst &amp; 0x1ffc) == 0x1dc0)    <span class="comment">/* SUBAW */</span>
<a name="l00200"></a>00200                 frame_base_offset_to_sp += ucst5 &lt;&lt; 2;
<a name="l00201"></a>00201               <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((inst &amp; 0x1ffc) == 0x1bc0)       <span class="comment">/* SUBAH */</span>
<a name="l00202"></a>00202                 frame_base_offset_to_sp += ucst5 &lt;&lt; 1;
<a name="l00203"></a>00203               <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((inst &amp; 0x0ffc) == 0x9c0)        <span class="comment">/* SUB */</span>
<a name="l00204"></a>00204                 frame_base_offset_to_sp += ucst5;
<a name="l00205"></a>00205               <span class="keywordflow">else</span>
<a name="l00206"></a>00206                 <a class="code" href="gdb__assert_8h.html#aa0526ecd768317edecf0b46c981cbcc0">gdb_assert_not_reached</a> (<span class="stringliteral">&quot;unexpected instruction&quot;</span>);
<a name="l00207"></a>00207 
<a name="l00208"></a>00208               return_pc = pc + 4;
<a name="l00209"></a>00209             }
<a name="l00210"></a>00210         }
<a name="l00211"></a>00211       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((inst &amp; 0x174) == 0x74)  <span class="comment">/* stw SRC, *+b15(uconst) */</span>
<a name="l00212"></a>00212         {
<a name="l00213"></a>00213           <span class="comment">/* The y bit determines which file base is read from.  */</span>
<a name="l00214"></a>00214           base_reg = tic6x_register_number ((inst &gt;&gt; 18) &amp; 0x1f,
<a name="l00215"></a>00215                                             (inst &gt;&gt; 7) &amp; 1, 0);
<a name="l00216"></a>00216 
<a name="l00217"></a>00217           <span class="keywordflow">if</span> (base_reg == <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da5da070e8fd88704a05f42848c2060587">TIC6X_SP_REGNUM</a>)
<a name="l00218"></a>00218             {
<a name="l00219"></a>00219               src_reg = tic6x_register_number ((inst &gt;&gt; 23) &amp; 0x1f,
<a name="l00220"></a>00220                                                <a class="code" href="tic6x-tdep_8c.html#a7b1ad58f3bb4fc2cfa62467cbc0a50f7">INST_S_BIT</a> (inst), 0);
<a name="l00221"></a>00221 
<a name="l00222"></a>00222               cache-&gt;reg_saved[src_reg] = ((inst &gt;&gt; 13) &amp; 0x1f) &lt;&lt; 2;
<a name="l00223"></a>00223 
<a name="l00224"></a>00224               return_pc = pc + 4;
<a name="l00225"></a>00225             }
<a name="l00226"></a>00226           non_stw_insn_counter = 0;
<a name="l00227"></a>00227         }
<a name="l00228"></a>00228       <span class="keywordflow">else</span>
<a name="l00229"></a>00229         {
<a name="l00230"></a>00230           non_stw_insn_counter++;
<a name="l00231"></a>00231           <span class="comment">/* Following instruction sequence may be emitted in prologue:</span>
<a name="l00232"></a>00232 <span class="comment"></span>
<a name="l00233"></a>00233 <span class="comment">             &lt;+0&gt;: subah .D2 b15,28,b15</span>
<a name="l00234"></a>00234 <span class="comment">             &lt;+4&gt;: or .L2X 0,a4,b0</span>
<a name="l00235"></a>00235 <span class="comment">             &lt;+8&gt;: || stw .D2T2 b14,*+b15(56)</span>
<a name="l00236"></a>00236 <span class="comment">             &lt;+12&gt;:[!b0] b .S1 0xe50e4c1c &lt;sleep+220&gt;</span>
<a name="l00237"></a>00237 <span class="comment">             &lt;+16&gt;:|| stw .D2T1 a10,*+b15(48)</span>
<a name="l00238"></a>00238 <span class="comment">             &lt;+20&gt;:stw .D2T2 b3,*+b15(52)</span>
<a name="l00239"></a>00239 <span class="comment">             &lt;+24&gt;:stw .D2T1 a4,*+b15(40)</span>
<a name="l00240"></a>00240 <span class="comment"></span>
<a name="l00241"></a>00241 <span class="comment">             we should look forward for next instruction instead of breaking loop</span>
<a name="l00242"></a>00242 <span class="comment">             here.  So far, we allow almost two sequential non-stw instructions</span>
<a name="l00243"></a>00243 <span class="comment">             in prologue.  */</span>
<a name="l00244"></a>00244           <span class="keywordflow">if</span> (non_stw_insn_counter &gt;= 2)
<a name="l00245"></a>00245             <span class="keywordflow">break</span>;
<a name="l00246"></a>00246         }
<a name="l00247"></a>00247 
<a name="l00248"></a>00248 
<a name="l00249"></a>00249       pc += 4;
<a name="l00250"></a>00250     }
<a name="l00251"></a>00251   <span class="comment">/* Step 2: Skip insn on setting up dsbt if it is.  Usually, it looks like,</span>
<a name="l00252"></a>00252 <span class="comment">     ldw .D2T2 *+b14(0),b14 */</span>
<a name="l00253"></a>00253   inst = tic6x_fetch_instruction (gdbarch, pc);
<a name="l00254"></a>00254   <span class="comment">/* The s bit determines which file dst will be loaded into, same effect as</span>
<a name="l00255"></a>00255 <span class="comment">     other places.  */</span>
<a name="l00256"></a>00256   dst_reg = tic6x_register_number ((inst &gt;&gt; 23) &amp; 0x1f, (inst &gt;&gt; 1) &amp; 1, 0);
<a name="l00257"></a>00257   <span class="comment">/* The y bit (bit 7), instead of s bit, determines which file base be</span>
<a name="l00258"></a>00258 <span class="comment">     used.  */</span>
<a name="l00259"></a>00259   base_reg = tic6x_register_number ((inst &gt;&gt; 18) &amp; 0x1f, (inst &gt;&gt; 7) &amp; 1, 0);
<a name="l00260"></a>00260 
<a name="l00261"></a>00261   <span class="keywordflow">if</span> ((inst &amp; 0x164) == 0x64    <span class="comment">/* ldw */</span>
<a name="l00262"></a>00262       &amp;&amp; dst_reg == <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13dab709a32206c15107aa6cfb81b0ee7001">TIC6X_DP_REGNUM</a>     <span class="comment">/* dst is B14 */</span>
<a name="l00263"></a>00263       &amp;&amp; base_reg == <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13dab709a32206c15107aa6cfb81b0ee7001">TIC6X_DP_REGNUM</a>)   <span class="comment">/* baseR is B14 */</span>
<a name="l00264"></a>00264     {
<a name="l00265"></a>00265       return_pc = pc + 4;
<a name="l00266"></a>00266     }
<a name="l00267"></a>00267 
<a name="l00268"></a>00268   <span class="keywordflow">if</span> (this_frame)
<a name="l00269"></a>00269     {
<a name="l00270"></a>00270       cache-&gt;base = <a class="code" href="frame_8c.html#affa785e8937e96fd727e46a2cfec94c4">get_frame_register_unsigned</a> (this_frame, <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da5da070e8fd88704a05f42848c2060587">TIC6X_SP_REGNUM</a>);
<a name="l00271"></a>00271 
<a name="l00272"></a>00272       <span class="keywordflow">if</span> (cache-&gt;reg_saved[<a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da013375ca6ef6f1c24e713d62abe94c7f">TIC6X_FP_REGNUM</a>] != -1)
<a name="l00273"></a>00273         {
<a name="l00274"></a>00274           <span class="comment">/* If the FP now holds an offset from the CFA then this is a frame</span>
<a name="l00275"></a>00275 <span class="comment">             which uses the frame pointer.  */</span>
<a name="l00276"></a>00276 
<a name="l00277"></a>00277           cache-&gt;cfa = <a class="code" href="frame_8c.html#affa785e8937e96fd727e46a2cfec94c4">get_frame_register_unsigned</a> (this_frame,
<a name="l00278"></a>00278                                                     <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da013375ca6ef6f1c24e713d62abe94c7f">TIC6X_FP_REGNUM</a>);
<a name="l00279"></a>00279         }
<a name="l00280"></a>00280       <span class="keywordflow">else</span>
<a name="l00281"></a>00281         {
<a name="l00282"></a>00282           <span class="comment">/* FP doesn&#39;t hold an offset from the CFA.  If SP still holds an</span>
<a name="l00283"></a>00283 <span class="comment">             offset from the CFA then we might be in a function which omits</span>
<a name="l00284"></a>00284 <span class="comment">             the frame pointer.  */</span>
<a name="l00285"></a>00285 
<a name="l00286"></a>00286           cache-&gt;cfa = cache-&gt;base + frame_base_offset_to_sp;
<a name="l00287"></a>00287         }
<a name="l00288"></a>00288     }
<a name="l00289"></a>00289 
<a name="l00290"></a>00290   <span class="comment">/* Adjust all the saved registers such that they contain addresses</span>
<a name="l00291"></a>00291 <span class="comment">     instead of offsets.  */</span>
<a name="l00292"></a>00292   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13dac3eb407b6a6a1d0ec7bd09bc98a17ba9">TIC6X_NUM_CORE_REGS</a>; i++)
<a name="l00293"></a>00293     <span class="keywordflow">if</span> (cache-&gt;reg_saved[i] != -1)
<a name="l00294"></a>00294       cache-&gt;reg_saved[i] = cache-&gt;base + cache-&gt;reg_saved[i];
<a name="l00295"></a>00295 
<a name="l00296"></a>00296   <span class="keywordflow">return</span> return_pc;
<a name="l00297"></a>00297 }
<a name="l00298"></a>00298 
<a name="l00299"></a>00299 <span class="comment">/* This is the implementation of gdbarch method skip_prologue.  */</span>
<a name="l00300"></a>00300 
<a name="l00301"></a>00301 <span class="keyword">static</span> <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a>
<a name="l00302"></a>00302 tic6x_skip_prologue (<span class="keyword">struct</span> gdbarch *gdbarch, <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> start_pc)
<a name="l00303"></a>00303 {
<a name="l00304"></a>00304   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> func_addr;
<a name="l00305"></a>00305   <span class="keyword">struct </span>tic6x_unwind_cache cache;
<a name="l00306"></a>00306 
<a name="l00307"></a>00307   <span class="comment">/* See if we can determine the end of the prologue via the symbol table.</span>
<a name="l00308"></a>00308 <span class="comment">     If so, then return either PC, or the PC after the prologue, whichever is</span>
<a name="l00309"></a>00309 <span class="comment">     greater.  */</span>
<a name="l00310"></a>00310   <span class="keywordflow">if</span> (<a class="code" href="blockframe_8c.html#a2dae2257ad1417604d2c26f8b9071ca9">find_pc_partial_function</a> (start_pc, NULL, &amp;func_addr, NULL))
<a name="l00311"></a>00311     {
<a name="l00312"></a>00312       <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> post_prologue_pc
<a name="l00313"></a>00313         = <a class="code" href="symtab_8c.html#a5e411a18b63476022fe4b9420138ae44">skip_prologue_using_sal</a> (gdbarch, func_addr);
<a name="l00314"></a>00314       <span class="keywordflow">if</span> (post_prologue_pc != 0)
<a name="l00315"></a>00315         <span class="keywordflow">return</span> <a class="code" href="environ_8c.html#affe776513b24d84b39af8ab0930fef7f">max</a> (start_pc, post_prologue_pc);
<a name="l00316"></a>00316     }
<a name="l00317"></a>00317 
<a name="l00318"></a>00318   <span class="comment">/* Can&#39;t determine prologue from the symbol table, need to examine</span>
<a name="l00319"></a>00319 <span class="comment">     instructions.  */</span>
<a name="l00320"></a>00320   <span class="keywordflow">return</span> tic6x_analyze_prologue (gdbarch, start_pc, (<a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a>) -1, &amp;cache,
<a name="l00321"></a>00321                                  NULL);
<a name="l00322"></a>00322 }
<a name="l00323"></a>00323 
<a name="l00324"></a>00324 <span class="comment">/* This is the implementation of gdbarch method breakpiont_from_pc.  */</span>
<a name="l00325"></a>00325 
<a name="l00326"></a>00326 <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *
<a name="l00327"></a>00327 tic6x_breakpoint_from_pc (<span class="keyword">struct</span> gdbarch *gdbarch, <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> *bp_addr,
<a name="l00328"></a>00328                           <span class="keywordtype">int</span> *bp_size)
<a name="l00329"></a>00329 {
<a name="l00330"></a>00330   <span class="keyword">struct </span><a class="code" href="structgdbarch__tdep.html">gdbarch_tdep</a> *tdep = <a class="code" href="gdbarch_8c.html#acea996b7421706849bc20567695b5b31">gdbarch_tdep</a> (gdbarch);
<a name="l00331"></a>00331 
<a name="l00332"></a>00332   *bp_size = 4;
<a name="l00333"></a>00333 
<a name="l00334"></a>00334   <span class="keywordflow">if</span> (tdep == NULL || tdep-&gt;<a class="code" href="structgdbarch__tdep.html#ab28b724e73850514d5ebbed1e02f2137">breakpoint</a> == NULL)
<a name="l00335"></a>00335     {
<a name="l00336"></a>00336       <span class="keywordflow">if</span> (BFD_ENDIAN_BIG == <a class="code" href="gdbarch_8c.html#a1d2f84f99f58964411955a36571f6783">gdbarch_byte_order_for_code</a> (gdbarch))
<a name="l00337"></a>00337         <span class="keywordflow">return</span> <a class="code" href="tic6x-tdep_8c.html#a25a69111f410e45a9639d764f5fb0b21">tic6x_bkpt_illegal_opcode_be</a>;
<a name="l00338"></a>00338       <span class="keywordflow">else</span>
<a name="l00339"></a>00339         <span class="keywordflow">return</span> <a class="code" href="tic6x-tdep_8c.html#aa51928c1f364bee726563ce4f77ebab9">tic6x_bkpt_illegal_opcode_le</a>;
<a name="l00340"></a>00340     }
<a name="l00341"></a>00341   <span class="keywordflow">else</span>
<a name="l00342"></a>00342     <span class="keywordflow">return</span> tdep-&gt;<a class="code" href="structgdbarch__tdep.html#ab28b724e73850514d5ebbed1e02f2137">breakpoint</a>;
<a name="l00343"></a>00343 }
<a name="l00344"></a>00344 
<a name="l00345"></a>00345 <span class="comment">/* This is the implementation of gdbarch method print_insn.  */</span>
<a name="l00346"></a>00346 
<a name="l00347"></a>00347 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00348"></a>00348 tic6x_print_insn (bfd_vma <a class="code" href="exec_8h.html#ab268c3184bf49615e16de006a296a542">memaddr</a>, disassemble_info *info)
<a name="l00349"></a>00349 {
<a name="l00350"></a>00350   <span class="keywordflow">return</span> print_insn_tic6x (memaddr, info);
<a name="l00351"></a>00351 }
<a name="l00352"></a>00352 
<a name="l00353"></a>00353 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00354"></a>00354 tic6x_dwarf2_frame_init_reg (<span class="keyword">struct</span> gdbarch *gdbarch, <span class="keywordtype">int</span> <a class="code" href="aarch64-tdep_8c.html#a6b3d1ad0bca4067ccaef1366bea0db04">regnum</a>,
<a name="l00355"></a>00355                              <span class="keyword">struct</span> <a class="code" href="structdwarf2__frame__state__reg.html">dwarf2_frame_state_reg</a> *<a class="code" href="structreg.html">reg</a>,
<a name="l00356"></a>00356                              <span class="keyword">struct</span> frame_info *this_frame)
<a name="l00357"></a>00357 {
<a name="l00358"></a>00358   <span class="comment">/* Mark the PC as the destination for the return address.  */</span>
<a name="l00359"></a>00359   <span class="keywordflow">if</span> (regnum == <a class="code" href="gdbarch_8c.html#a07a162ebafea1269eb8f341db44e53e7">gdbarch_pc_regnum</a> (gdbarch))
<a name="l00360"></a>00360     reg-&gt;<a class="code" href="structdwarf2__frame__state__reg.html#a7e41a3dc58552db7d15a52d1c8d896e6">how</a> = <a class="code" href="dwarf2-frame_8h.html#af4ee6f839eb1316c9d6b1d4ef2b171c9a1b032cd6ccb1f0d62eaf38995d6f828a">DWARF2_FRAME_REG_RA</a>;
<a name="l00361"></a>00361 
<a name="l00362"></a>00362   <span class="comment">/* Mark the stack pointer as the call frame address.  */</span>
<a name="l00363"></a>00363   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (regnum == <a class="code" href="gdbarch_8c.html#a86f6193dd957c193df77477d9d84c4f3">gdbarch_sp_regnum</a> (gdbarch))
<a name="l00364"></a>00364     reg-&gt;<a class="code" href="structdwarf2__frame__state__reg.html#a7e41a3dc58552db7d15a52d1c8d896e6">how</a> = <a class="code" href="dwarf2-frame_8h.html#af4ee6f839eb1316c9d6b1d4ef2b171c9aec7e1b9b75d0f5231ae82868d659c2fa">DWARF2_FRAME_REG_CFA</a>;
<a name="l00365"></a>00365 
<a name="l00366"></a>00366   <span class="comment">/* The above was taken from the default init_reg in dwarf2-frame.c</span>
<a name="l00367"></a>00367 <span class="comment">     while the below is c6x specific.  */</span>
<a name="l00368"></a>00368 
<a name="l00369"></a>00369   <span class="comment">/* Callee save registers.  The ABI designates A10-A15 and B10-B15 as</span>
<a name="l00370"></a>00370 <span class="comment">     callee-save.  */</span>
<a name="l00371"></a>00371   <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((regnum &gt;= 10 &amp;&amp; regnum &lt;= 15) || (regnum &gt;= 26 &amp;&amp; regnum &lt;= 31))
<a name="l00372"></a>00372     reg-&gt;<a class="code" href="structdwarf2__frame__state__reg.html#a7e41a3dc58552db7d15a52d1c8d896e6">how</a> = <a class="code" href="dwarf2-frame_8h.html#af4ee6f839eb1316c9d6b1d4ef2b171c9ac4036b95d8f2db6a6d51f184517d8921">DWARF2_FRAME_REG_SAME_VALUE</a>;
<a name="l00373"></a>00373   <span class="keywordflow">else</span>
<a name="l00374"></a>00374     <span class="comment">/* All other registers are caller-save.  */</span>
<a name="l00375"></a>00375     reg-&gt;<a class="code" href="structdwarf2__frame__state__reg.html#a7e41a3dc58552db7d15a52d1c8d896e6">how</a> = <a class="code" href="dwarf2-frame_8h.html#af4ee6f839eb1316c9d6b1d4ef2b171c9ae453ac257eeb298001c4929f4762c2b2">DWARF2_FRAME_REG_UNDEFINED</a>;
<a name="l00376"></a>00376 }
<a name="l00377"></a>00377 
<a name="l00378"></a>00378 <span class="comment">/* This is the implementation of gdbarch method unwind_pc.  */</span>
<a name="l00379"></a>00379 
<a name="l00380"></a>00380 <span class="keyword">static</span> <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a>
<a name="l00381"></a>00381 tic6x_unwind_pc (<span class="keyword">struct</span> gdbarch *gdbarch, <span class="keyword">struct</span> frame_info *next_frame)
<a name="l00382"></a>00382 {
<a name="l00383"></a>00383   <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> buf[8];
<a name="l00384"></a>00384 
<a name="l00385"></a>00385   <a class="code" href="frame_8c.html#af11d8d673027d53c4420da4895abc230">frame_unwind_register</a> (next_frame,  <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13dad84f8317e56046c7df78ff9ec4469eee">TIC6X_PC_REGNUM</a>, buf);
<a name="l00386"></a>00386   <span class="keywordflow">return</span> <a class="code" href="defs_8h.html#a8a619d8cb1c6d12c6354da6e663dbd95">extract_typed_address</a> (buf, <a class="code" href="structbuiltin__type.html">builtin_type</a> (gdbarch)-&gt;builtin_func_ptr);
<a name="l00387"></a>00387 }
<a name="l00388"></a>00388 
<a name="l00389"></a>00389 <span class="comment">/* This is the implementation of gdbarch method unwind_sp.  */</span>
<a name="l00390"></a>00390 
<a name="l00391"></a>00391 <span class="keyword">static</span> <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a>
<a name="l00392"></a>00392 tic6x_unwind_sp (<span class="keyword">struct</span> gdbarch *gdbarch, <span class="keyword">struct</span> frame_info *this_frame)
<a name="l00393"></a>00393 {
<a name="l00394"></a>00394   <span class="keywordflow">return</span> <a class="code" href="frame_8c.html#a294f6912118884550787fd59f2a08ff6">frame_unwind_register_unsigned</a> (this_frame, <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da5da070e8fd88704a05f42848c2060587">TIC6X_SP_REGNUM</a>);
<a name="l00395"></a>00395 }
<a name="l00396"></a>00396 
<a name="l00397"></a>00397 
<a name="l00398"></a>00398 <span class="comment">/* Frame base handling.  */</span>
<a name="l00399"></a>00399 
<a name="l00400"></a>00400 <span class="keyword">static</span> <span class="keyword">struct </span>tic6x_unwind_cache*
<a name="l00401"></a>00401 tic6x_frame_unwind_cache (<span class="keyword">struct</span> frame_info *this_frame,
<a name="l00402"></a>00402                           <span class="keywordtype">void</span> **this_prologue_cache)
<a name="l00403"></a>00403 {
<a name="l00404"></a>00404   <span class="keyword">struct </span>gdbarch *gdbarch = <a class="code" href="frame_8c.html#ab44507b5655da44e522ed5857835ede7">get_frame_arch</a> (this_frame);
<a name="l00405"></a>00405   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> current_pc;
<a name="l00406"></a>00406   <span class="keyword">struct </span>tic6x_unwind_cache *cache;
<a name="l00407"></a>00407 
<a name="l00408"></a>00408   <span class="keywordflow">if</span> (*this_prologue_cache)
<a name="l00409"></a>00409     <span class="keywordflow">return</span> *this_prologue_cache;
<a name="l00410"></a>00410 
<a name="l00411"></a>00411   cache = <a class="code" href="frame_8h.html#af9f5c3008a0d58374aa310c5c63af552">FRAME_OBSTACK_ZALLOC</a> (<span class="keyword">struct</span> tic6x_unwind_cache);
<a name="l00412"></a>00412   (*this_prologue_cache) = cache;
<a name="l00413"></a>00413 
<a name="l00414"></a>00414   cache-&gt;return_regnum = <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da7a422511af8ea7046be3cd0bddfec464">TIC6X_RA_REGNUM</a>;
<a name="l00415"></a>00415 
<a name="l00416"></a>00416   tic6x_setup_default (cache);
<a name="l00417"></a>00417 
<a name="l00418"></a>00418   cache-&gt;pc = <a class="code" href="frame_8c.html#ac64c0ce600cc134b2256c0d507f57cde">get_frame_func</a> (this_frame);
<a name="l00419"></a>00419   current_pc = <a class="code" href="frame_8c.html#a27aafb00e05cba145dfba0e4bc7b1d70">get_frame_pc</a> (this_frame);
<a name="l00420"></a>00420 
<a name="l00421"></a>00421   <span class="comment">/* Prologue analysis does the rest...  */</span>
<a name="l00422"></a>00422   <span class="keywordflow">if</span> (cache-&gt;pc != 0)
<a name="l00423"></a>00423     tic6x_analyze_prologue (gdbarch, cache-&gt;pc, current_pc, cache, this_frame);
<a name="l00424"></a>00424 
<a name="l00425"></a>00425   <span class="keywordflow">return</span> cache;
<a name="l00426"></a>00426 }
<a name="l00427"></a>00427 
<a name="l00428"></a>00428 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00429"></a>00429 tic6x_frame_this_id (<span class="keyword">struct</span> frame_info *this_frame, <span class="keywordtype">void</span> **this_cache,
<a name="l00430"></a>00430                      <span class="keyword">struct</span> <a class="code" href="structframe__id.html">frame_id</a> *this_id)
<a name="l00431"></a>00431 {
<a name="l00432"></a>00432   <span class="keyword">struct </span>tic6x_unwind_cache *cache =
<a name="l00433"></a>00433     tic6x_frame_unwind_cache (this_frame, this_cache);
<a name="l00434"></a>00434 
<a name="l00435"></a>00435   <span class="comment">/* This marks the outermost frame.  */</span>
<a name="l00436"></a>00436   <span class="keywordflow">if</span> (cache-&gt;base == 0)
<a name="l00437"></a>00437     <span class="keywordflow">return</span>;
<a name="l00438"></a>00438 
<a name="l00439"></a>00439   (*this_id) = <a class="code" href="frame_8c.html#a7f32da6ddc275b4684c301448d891f5b">frame_id_build</a> (cache-&gt;cfa, cache-&gt;pc);
<a name="l00440"></a>00440 }
<a name="l00441"></a>00441 
<a name="l00442"></a>00442 <span class="keyword">static</span> <span class="keyword">struct </span>value *
<a name="l00443"></a>00443 tic6x_frame_prev_register (<span class="keyword">struct</span> frame_info *this_frame, <span class="keywordtype">void</span> **this_cache,
<a name="l00444"></a>00444                            <span class="keywordtype">int</span> regnum)
<a name="l00445"></a>00445 {
<a name="l00446"></a>00446   <span class="keyword">struct </span>tic6x_unwind_cache *cache =
<a name="l00447"></a>00447     tic6x_frame_unwind_cache (this_frame, this_cache);
<a name="l00448"></a>00448 
<a name="l00449"></a>00449   <a class="code" href="gdb__assert_8h.html#aeb007d3e990858c7ef8e40a7e512c1ff">gdb_assert</a> (regnum &gt;= 0);
<a name="l00450"></a>00450 
<a name="l00451"></a>00451   <span class="comment">/* The PC of the previous frame is stored in the RA register of</span>
<a name="l00452"></a>00452 <span class="comment">     the current frame.  Frob regnum so that we pull the value from</span>
<a name="l00453"></a>00453 <span class="comment">     the correct place.  */</span>
<a name="l00454"></a>00454   <span class="keywordflow">if</span> (regnum == <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13dad84f8317e56046c7df78ff9ec4469eee">TIC6X_PC_REGNUM</a>)
<a name="l00455"></a>00455     regnum = cache-&gt;return_regnum;
<a name="l00456"></a>00456 
<a name="l00457"></a>00457   <span class="keywordflow">if</span> (regnum == <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da5da070e8fd88704a05f42848c2060587">TIC6X_SP_REGNUM</a> &amp;&amp; cache-&gt;cfa)
<a name="l00458"></a>00458     <span class="keywordflow">return</span> <a class="code" href="frame-unwind_8c.html#ac7df103c9cdd8847accaa5752e4f52ea">frame_unwind_got_constant</a> (this_frame, regnum, cache-&gt;cfa);
<a name="l00459"></a>00459 
<a name="l00460"></a>00460   <span class="comment">/* If we&#39;ve worked out where a register is stored then load it from</span>
<a name="l00461"></a>00461 <span class="comment">     there.  */</span>
<a name="l00462"></a>00462   <span class="keywordflow">if</span> (regnum &lt; TIC6X_NUM_CORE_REGS &amp;&amp; cache-&gt;reg_saved[regnum] != -1)
<a name="l00463"></a>00463     <span class="keywordflow">return</span> <a class="code" href="frame-unwind_8c.html#ae7eed0715ca9ef71b626f80e3f026be9">frame_unwind_got_memory</a> (this_frame, regnum,
<a name="l00464"></a>00464                                     cache-&gt;reg_saved[regnum]);
<a name="l00465"></a>00465 
<a name="l00466"></a>00466   <span class="keywordflow">return</span> <a class="code" href="frame-unwind_8c.html#a07784a5660795d4ca4bb82e05e0bc4f5">frame_unwind_got_register</a> (this_frame, regnum, regnum);
<a name="l00467"></a>00467 }
<a name="l00468"></a>00468 
<a name="l00469"></a>00469 <span class="keyword">static</span> <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a>
<a name="l00470"></a>00470 tic6x_frame_base_address (<span class="keyword">struct</span> frame_info *this_frame, <span class="keywordtype">void</span> **this_cache)
<a name="l00471"></a>00471 {
<a name="l00472"></a>00472   <span class="keyword">struct </span>tic6x_unwind_cache *info
<a name="l00473"></a>00473     = tic6x_frame_unwind_cache (this_frame, this_cache);
<a name="l00474"></a>00474   <span class="keywordflow">return</span> info-&gt;base;
<a name="l00475"></a>00475 }
<a name="l00476"></a>00476 
<a name="l00477"></a>00477 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structframe__unwind.html">frame_unwind</a> tic6x_frame_unwind =
<a name="l00478"></a>00478 {
<a name="l00479"></a>00479   <a class="code" href="frame_8h.html#a3ca2c0bc7578bf3d337e34b2c08a6c5faeb4f7fd6d9e397d1141feb133746637a">NORMAL_FRAME</a>,
<a name="l00480"></a>00480   <a class="code" href="frame-unwind_8c.html#aa950afe60921514574c6150f0821f05c">default_frame_unwind_stop_reason</a>,
<a name="l00481"></a>00481   tic6x_frame_this_id,
<a name="l00482"></a>00482   tic6x_frame_prev_register,
<a name="l00483"></a>00483   NULL,
<a name="l00484"></a>00484   <a class="code" href="frame-unwind_8c.html#ade64a9807fa508622581cc779b10ff9c">default_frame_sniffer</a>
<a name="l00485"></a>00485 };
<a name="l00486"></a>00486 
<a name="l00487"></a>00487 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structframe__base.html">frame_base</a> tic6x_frame_base =
<a name="l00488"></a>00488 {
<a name="l00489"></a>00489   &amp;tic6x_frame_unwind,
<a name="l00490"></a>00490   tic6x_frame_base_address,
<a name="l00491"></a>00491   tic6x_frame_base_address,
<a name="l00492"></a>00492   tic6x_frame_base_address
<a name="l00493"></a>00493 };
<a name="l00494"></a>00494 
<a name="l00495"></a>00495 
<a name="l00496"></a>00496 <span class="keyword">static</span> <span class="keyword">struct </span>tic6x_unwind_cache *
<a name="l00497"></a>00497 tic6x_make_stub_cache (<span class="keyword">struct</span> frame_info *this_frame)
<a name="l00498"></a>00498 {
<a name="l00499"></a>00499   <span class="keyword">struct </span>tic6x_unwind_cache *cache;
<a name="l00500"></a>00500 
<a name="l00501"></a>00501   cache = <a class="code" href="frame_8h.html#af9f5c3008a0d58374aa310c5c63af552">FRAME_OBSTACK_ZALLOC</a> (<span class="keyword">struct</span> tic6x_unwind_cache);
<a name="l00502"></a>00502 
<a name="l00503"></a>00503   cache-&gt;return_regnum = <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da7a422511af8ea7046be3cd0bddfec464">TIC6X_RA_REGNUM</a>;
<a name="l00504"></a>00504 
<a name="l00505"></a>00505   tic6x_setup_default (cache);
<a name="l00506"></a>00506 
<a name="l00507"></a>00507   cache-&gt;cfa = <a class="code" href="frame_8c.html#affa785e8937e96fd727e46a2cfec94c4">get_frame_register_unsigned</a> (this_frame, <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da5da070e8fd88704a05f42848c2060587">TIC6X_SP_REGNUM</a>);
<a name="l00508"></a>00508 
<a name="l00509"></a>00509   <span class="keywordflow">return</span> cache;
<a name="l00510"></a>00510 }
<a name="l00511"></a>00511 
<a name="l00512"></a>00512 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00513"></a>00513 tic6x_stub_this_id (<span class="keyword">struct</span> frame_info *this_frame, <span class="keywordtype">void</span> **this_cache,
<a name="l00514"></a>00514                     <span class="keyword">struct</span> <a class="code" href="structframe__id.html">frame_id</a> *this_id)
<a name="l00515"></a>00515 {
<a name="l00516"></a>00516   <span class="keyword">struct </span>tic6x_unwind_cache *cache;
<a name="l00517"></a>00517 
<a name="l00518"></a>00518   <span class="keywordflow">if</span> (*this_cache == NULL)
<a name="l00519"></a>00519     *this_cache = tic6x_make_stub_cache (this_frame);
<a name="l00520"></a>00520   cache = *this_cache;
<a name="l00521"></a>00521 
<a name="l00522"></a>00522   *this_id = <a class="code" href="frame_8c.html#a7f32da6ddc275b4684c301448d891f5b">frame_id_build</a> (cache-&gt;cfa, <a class="code" href="frame_8c.html#a27aafb00e05cba145dfba0e4bc7b1d70">get_frame_pc</a> (this_frame));
<a name="l00523"></a>00523 }
<a name="l00524"></a>00524 
<a name="l00525"></a>00525 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00526"></a>00526 tic6x_stub_unwind_sniffer (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structframe__unwind.html">frame_unwind</a> *<span class="keyword">self</span>,
<a name="l00527"></a>00527                            <span class="keyword">struct</span> frame_info *this_frame,
<a name="l00528"></a>00528                            <span class="keywordtype">void</span> **this_prologue_cache)
<a name="l00529"></a>00529 {
<a name="l00530"></a>00530   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> addr_in_block;
<a name="l00531"></a>00531 
<a name="l00532"></a>00532   addr_in_block = <a class="code" href="frame_8c.html#a9035a35b7470b669f9bafee9c3961559">get_frame_address_in_block</a> (this_frame);
<a name="l00533"></a>00533   <span class="keywordflow">if</span> (in_plt_section (addr_in_block))
<a name="l00534"></a>00534     <span class="keywordflow">return</span> 1;
<a name="l00535"></a>00535 
<a name="l00536"></a>00536   <span class="keywordflow">return</span> 0;
<a name="l00537"></a>00537 }
<a name="l00538"></a>00538 
<a name="l00539"></a>00539 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structframe__unwind.html">frame_unwind</a> tic6x_stub_unwind =
<a name="l00540"></a>00540 {
<a name="l00541"></a>00541   <a class="code" href="frame_8h.html#a3ca2c0bc7578bf3d337e34b2c08a6c5faeb4f7fd6d9e397d1141feb133746637a">NORMAL_FRAME</a>,
<a name="l00542"></a>00542   <a class="code" href="frame-unwind_8c.html#aa950afe60921514574c6150f0821f05c">default_frame_unwind_stop_reason</a>,
<a name="l00543"></a>00543   tic6x_stub_this_id,
<a name="l00544"></a>00544   tic6x_frame_prev_register,
<a name="l00545"></a>00545   NULL,
<a name="l00546"></a>00546   tic6x_stub_unwind_sniffer
<a name="l00547"></a>00547 };
<a name="l00548"></a>00548 
<a name="l00549"></a>00549 <span class="comment">/* Return the instruction on address PC.  */</span>
<a name="l00550"></a>00550 
<a name="l00551"></a>00551 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>
<a name="l00552"></a>00552 tic6x_fetch_instruction (<span class="keyword">struct</span> gdbarch *gdbarch, <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> pc)
<a name="l00553"></a>00553 {
<a name="l00554"></a>00554   <span class="keyword">enum</span> bfd_endian byte_order = <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (gdbarch);
<a name="l00555"></a>00555   <span class="keywordflow">return</span> <a class="code" href="corefile_8c.html#a280cf81e766f60b30618ae3011f2cb07">read_memory_unsigned_integer</a> (pc, <a class="code" href="tic6x-tdep_8c.html#a4c16fdd0b5071f963cba6ee2bcb47aaa">TIC6X_OPCODE_SIZE</a>, byte_order);
<a name="l00556"></a>00556 }
<a name="l00557"></a>00557 
<a name="l00558"></a>00558 <span class="comment">/* Compute the condition of INST if it is a conditional instruction.  Always</span>
<a name="l00559"></a>00559 <span class="comment">   return 1 if INST is not a conditional instruction.  */</span>
<a name="l00560"></a>00560 
<a name="l00561"></a>00561 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00562"></a>00562 tic6x_condition_true (<span class="keyword">struct</span> frame_info *frame, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> inst)
<a name="l00563"></a>00563 {
<a name="l00564"></a>00564   <span class="keywordtype">int</span> register_number;
<a name="l00565"></a>00565   <span class="keywordtype">int</span> register_value;
<a name="l00566"></a>00566   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> register_numbers[8] = { -1, 16, 17, 18, 1, 2, 0, -1 };
<a name="l00567"></a>00567 
<a name="l00568"></a>00568   register_number = register_numbers[(inst &gt;&gt; 29) &amp; 7];
<a name="l00569"></a>00569   <span class="keywordflow">if</span> (register_number == -1)
<a name="l00570"></a>00570     <span class="keywordflow">return</span> 1;
<a name="l00571"></a>00571 
<a name="l00572"></a>00572   register_value = <a class="code" href="frame_8c.html#abd9e6d8ee95caae2621108bbbb44bd2f">get_frame_register_signed</a> (frame, register_number);
<a name="l00573"></a>00573   <span class="keywordflow">if</span> ((inst &amp; 0x10000000) != 0)
<a name="l00574"></a>00574     <span class="keywordflow">return</span> register_value == 0;
<a name="l00575"></a>00575   <span class="keywordflow">return</span> register_value != 0;
<a name="l00576"></a>00576 }
<a name="l00577"></a>00577 
<a name="l00578"></a>00578 <span class="comment">/* Get the register number by decoding raw bits REG, SIDE, and CROSSPATH in</span>
<a name="l00579"></a>00579 <span class="comment">   instruction.  */</span>
<a name="l00580"></a>00580 
<a name="l00581"></a>00581 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00582"></a>00582 tic6x_register_number (<span class="keywordtype">int</span> reg, <span class="keywordtype">int</span> side, <span class="keywordtype">int</span> crosspath)
<a name="l00583"></a>00583 {
<a name="l00584"></a>00584   <span class="keywordtype">int</span> r = (reg &amp; 15) | ((crosspath ^ side) &lt;&lt; 4);
<a name="l00585"></a>00585   <span class="keywordflow">if</span> ((reg &amp; 16) != 0) <span class="comment">/* A16 - A31, B16 - B31 */</span>
<a name="l00586"></a>00586     r += 37;
<a name="l00587"></a>00587   <span class="keywordflow">return</span> r;
<a name="l00588"></a>00588 }
<a name="l00589"></a>00589 
<a name="l00590"></a>00590 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00591"></a>00591 tic6x_extract_signed_field (<span class="keywordtype">int</span> value, <span class="keywordtype">int</span> low_bit, <span class="keywordtype">int</span> <a class="code" href="arm-tdep_8c.html#a6d53921cd0f216408c4aed2806a0cb1f">bits</a>)
<a name="l00592"></a>00592 {
<a name="l00593"></a>00593   <span class="keywordtype">int</span> mask = (1 &lt;&lt; <a class="code" href="arm-tdep_8c.html#a6d53921cd0f216408c4aed2806a0cb1f">bits</a>) - 1;
<a name="l00594"></a>00594   <span class="keywordtype">int</span> r = (value &gt;&gt; low_bit) &amp; mask;
<a name="l00595"></a>00595   <span class="keywordflow">if</span> ((r &amp; (1 &lt;&lt; (bits - 1))) != 0)
<a name="l00596"></a>00596     r -= mask + 1;
<a name="l00597"></a>00597   <span class="keywordflow">return</span> r;
<a name="l00598"></a>00598 }
<a name="l00599"></a>00599 
<a name="l00600"></a>00600 <span class="comment">/* Determine where to set a single step breakpoint.  */</span>
<a name="l00601"></a>00601 
<a name="l00602"></a>00602 <span class="keyword">static</span> <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a>
<a name="l00603"></a>00603 tic6x_get_next_pc (<span class="keyword">struct</span> frame_info *frame, <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> pc)
<a name="l00604"></a>00604 {
<a name="l00605"></a>00605   <span class="keyword">struct </span>gdbarch *gdbarch = <a class="code" href="frame_8c.html#ab44507b5655da44e522ed5857835ede7">get_frame_arch</a> (frame);
<a name="l00606"></a>00606   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> inst;
<a name="l00607"></a>00607   <span class="keywordtype">int</span> register_number;
<a name="l00608"></a>00608   <span class="keywordtype">int</span> last = 0;
<a name="l00609"></a>00609 
<a name="l00610"></a>00610   <span class="keywordflow">do</span>
<a name="l00611"></a>00611     {
<a name="l00612"></a>00612       inst = tic6x_fetch_instruction (gdbarch, pc);
<a name="l00613"></a>00613 
<a name="l00614"></a>00614       last = !(inst &amp; 1);
<a name="l00615"></a>00615 
<a name="l00616"></a>00616       <span class="keywordflow">if</span> (inst == <a class="code" href="tic6x-tdep_8h.html#a73f65bb78d3b299d4bfef503b828bda0">TIC6X_INST_SWE</a>)
<a name="l00617"></a>00617         {
<a name="l00618"></a>00618           <span class="keyword">struct </span><a class="code" href="structgdbarch__tdep.html">gdbarch_tdep</a> *tdep = <a class="code" href="gdbarch_8c.html#acea996b7421706849bc20567695b5b31">gdbarch_tdep</a> (gdbarch);
<a name="l00619"></a>00619 
<a name="l00620"></a>00620           <span class="keywordflow">if</span> (tdep-&gt;<a class="code" href="structgdbarch__tdep.html#adfdc65c6f29d29cb45503679732c8d21">syscall_next_pc</a> != NULL)
<a name="l00621"></a>00621             <span class="keywordflow">return</span> tdep-&gt;<a class="code" href="structgdbarch__tdep.html#adfdc65c6f29d29cb45503679732c8d21">syscall_next_pc</a> (frame);
<a name="l00622"></a>00622         }
<a name="l00623"></a>00623 
<a name="l00624"></a>00624       <span class="keywordflow">if</span> (tic6x_condition_true (frame, inst))
<a name="l00625"></a>00625         {
<a name="l00626"></a>00626           <span class="keywordflow">if</span> ((inst &amp; 0x0000007c) == 0x00000010)
<a name="l00627"></a>00627             {
<a name="l00628"></a>00628               <span class="comment">/* B with displacement */</span>
<a name="l00629"></a>00629               pc &amp;= ~(<a class="code" href="tic6x-tdep_8c.html#ae294917d30d119d02071024f854a77e0">TIC6X_FETCH_PACKET_SIZE</a> - 1);
<a name="l00630"></a>00630               pc += tic6x_extract_signed_field (inst, 7, 21) &lt;&lt; 2;
<a name="l00631"></a>00631               <span class="keywordflow">break</span>;
<a name="l00632"></a>00632             }
<a name="l00633"></a>00633           <span class="keywordflow">if</span> ((inst &amp; 0x0f83effc) == 0x00000360)
<a name="l00634"></a>00634             {
<a name="l00635"></a>00635               <span class="comment">/* B with register */</span>
<a name="l00636"></a>00636 
<a name="l00637"></a>00637               register_number = tic6x_register_number ((inst &gt;&gt; 18) &amp; 0x1f,
<a name="l00638"></a>00638                                                        <a class="code" href="tic6x-tdep_8c.html#a7b1ad58f3bb4fc2cfa62467cbc0a50f7">INST_S_BIT</a> (inst),
<a name="l00639"></a>00639                                                        <a class="code" href="tic6x-tdep_8c.html#a092de10f37665ddf10408036ac4c2632">INST_X_BIT</a> (inst));
<a name="l00640"></a>00640               pc = <a class="code" href="frame_8c.html#affa785e8937e96fd727e46a2cfec94c4">get_frame_register_unsigned</a> (frame, register_number);
<a name="l00641"></a>00641               <span class="keywordflow">break</span>;
<a name="l00642"></a>00642             }
<a name="l00643"></a>00643           <span class="keywordflow">if</span> ((inst &amp; 0x00001ffc) == 0x00001020)
<a name="l00644"></a>00644             {
<a name="l00645"></a>00645               <span class="comment">/* BDEC */</span>
<a name="l00646"></a>00646               register_number = tic6x_register_number ((inst &gt;&gt; 23) &amp; 0x1f,
<a name="l00647"></a>00647                                                        <a class="code" href="tic6x-tdep_8c.html#a7b1ad58f3bb4fc2cfa62467cbc0a50f7">INST_S_BIT</a> (inst), 0);
<a name="l00648"></a>00648               <span class="keywordflow">if</span> (<a class="code" href="frame_8c.html#abd9e6d8ee95caae2621108bbbb44bd2f">get_frame_register_signed</a> (frame, register_number) &gt;= 0)
<a name="l00649"></a>00649                 {
<a name="l00650"></a>00650                   pc &amp;= ~(<a class="code" href="tic6x-tdep_8c.html#ae294917d30d119d02071024f854a77e0">TIC6X_FETCH_PACKET_SIZE</a> - 1);
<a name="l00651"></a>00651                   pc += tic6x_extract_signed_field (inst, 7, 10) &lt;&lt; 2;
<a name="l00652"></a>00652                 }
<a name="l00653"></a>00653               <span class="keywordflow">break</span>;
<a name="l00654"></a>00654             }
<a name="l00655"></a>00655           <span class="keywordflow">if</span> ((inst &amp; 0x00001ffc) == 0x00000120)
<a name="l00656"></a>00656             {
<a name="l00657"></a>00657               <span class="comment">/* BNOP with displacement */</span>
<a name="l00658"></a>00658               pc &amp;= ~(<a class="code" href="tic6x-tdep_8c.html#ae294917d30d119d02071024f854a77e0">TIC6X_FETCH_PACKET_SIZE</a> - 1);
<a name="l00659"></a>00659               pc += tic6x_extract_signed_field (inst, 16, 12) &lt;&lt; 2;
<a name="l00660"></a>00660               <span class="keywordflow">break</span>;
<a name="l00661"></a>00661             }
<a name="l00662"></a>00662           <span class="keywordflow">if</span> ((inst &amp; 0x0f830ffe) == 0x00800362)
<a name="l00663"></a>00663             {
<a name="l00664"></a>00664               <span class="comment">/* BNOP with register */</span>
<a name="l00665"></a>00665               register_number = tic6x_register_number ((inst &gt;&gt; 18) &amp; 0x1f,
<a name="l00666"></a>00666                                                        1, <a class="code" href="tic6x-tdep_8c.html#a092de10f37665ddf10408036ac4c2632">INST_X_BIT</a> (inst));
<a name="l00667"></a>00667               pc = <a class="code" href="frame_8c.html#affa785e8937e96fd727e46a2cfec94c4">get_frame_register_unsigned</a> (frame, register_number);
<a name="l00668"></a>00668               <span class="keywordflow">break</span>;
<a name="l00669"></a>00669             }
<a name="l00670"></a>00670           <span class="keywordflow">if</span> ((inst &amp; 0x00001ffc) == 0x00000020)
<a name="l00671"></a>00671             {
<a name="l00672"></a>00672               <span class="comment">/* BPOS */</span>
<a name="l00673"></a>00673               register_number = tic6x_register_number ((inst &gt;&gt; 23) &amp; 0x1f,
<a name="l00674"></a>00674                                                        <a class="code" href="tic6x-tdep_8c.html#a7b1ad58f3bb4fc2cfa62467cbc0a50f7">INST_S_BIT</a> (inst), 0);
<a name="l00675"></a>00675               <span class="keywordflow">if</span> (<a class="code" href="frame_8c.html#abd9e6d8ee95caae2621108bbbb44bd2f">get_frame_register_signed</a> (frame, register_number) &gt;= 0)
<a name="l00676"></a>00676                 {
<a name="l00677"></a>00677                   pc &amp;= ~(<a class="code" href="tic6x-tdep_8c.html#ae294917d30d119d02071024f854a77e0">TIC6X_FETCH_PACKET_SIZE</a> - 1);
<a name="l00678"></a>00678                   pc += tic6x_extract_signed_field (inst, 13, 10) &lt;&lt; 2;
<a name="l00679"></a>00679                 }
<a name="l00680"></a>00680               <span class="keywordflow">break</span>;
<a name="l00681"></a>00681             }
<a name="l00682"></a>00682           <span class="keywordflow">if</span> ((inst &amp; 0xf000007c) == 0x10000010)
<a name="l00683"></a>00683             {
<a name="l00684"></a>00684               <span class="comment">/* CALLP */</span>
<a name="l00685"></a>00685               pc &amp;= ~(<a class="code" href="tic6x-tdep_8c.html#ae294917d30d119d02071024f854a77e0">TIC6X_FETCH_PACKET_SIZE</a> - 1);
<a name="l00686"></a>00686               pc += tic6x_extract_signed_field (inst, 7, 21) &lt;&lt; 2;
<a name="l00687"></a>00687               <span class="keywordflow">break</span>;
<a name="l00688"></a>00688             }
<a name="l00689"></a>00689         }
<a name="l00690"></a>00690       pc += <a class="code" href="tic6x-tdep_8c.html#a4c16fdd0b5071f963cba6ee2bcb47aaa">TIC6X_OPCODE_SIZE</a>;
<a name="l00691"></a>00691     }
<a name="l00692"></a>00692   <span class="keywordflow">while</span> (!last);
<a name="l00693"></a>00693   <span class="keywordflow">return</span> <a class="code" href="structgdbarch__tdep.html#ab7a207d4e85b564c48238283745247b8">pc</a>;
<a name="l00694"></a>00694 }
<a name="l00695"></a>00695 
<a name="l00696"></a>00696 <span class="comment">/* This is the implementation of gdbarch method software_single_step.  */</span>
<a name="l00697"></a>00697 
<a name="l00698"></a>00698 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00699"></a>00699 tic6x_software_single_step (<span class="keyword">struct</span> frame_info *frame)
<a name="l00700"></a>00700 {
<a name="l00701"></a>00701   <span class="keyword">struct </span>gdbarch *gdbarch = <a class="code" href="frame_8c.html#ab44507b5655da44e522ed5857835ede7">get_frame_arch</a> (frame);
<a name="l00702"></a>00702   <span class="keyword">struct </span>address_space *aspace = <a class="code" href="frame_8c.html#abdf9824b7a32ae3a71b8de560a16bfe8">get_frame_address_space</a> (frame);
<a name="l00703"></a>00703   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> next_pc = tic6x_get_next_pc (frame, <a class="code" href="frame_8c.html#a27aafb00e05cba145dfba0e4bc7b1d70">get_frame_pc</a> (frame));
<a name="l00704"></a>00704 
<a name="l00705"></a>00705   <a class="code" href="breakpoint_8c.html#a8decd828f1a0042e3e40a1ed86940140">insert_single_step_breakpoint</a> (gdbarch, aspace, next_pc);
<a name="l00706"></a>00706 
<a name="l00707"></a>00707   <span class="keywordflow">return</span> 1;
<a name="l00708"></a>00708 }
<a name="l00709"></a>00709 
<a name="l00710"></a>00710 <span class="comment">/* This is the implementation of gdbarch method frame_align.  */</span>
<a name="l00711"></a>00711 
<a name="l00712"></a>00712 <span class="keyword">static</span> <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a>
<a name="l00713"></a>00713 tic6x_frame_align (<span class="keyword">struct</span> gdbarch *gdbarch, <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> addr)
<a name="l00714"></a>00714 {
<a name="l00715"></a>00715   <span class="keywordflow">return</span> <a class="code" href="utils_8c.html#a2333cae8a4809e09f8e851c83838ecaf">align_down</a> (addr, 8);
<a name="l00716"></a>00716 }
<a name="l00717"></a>00717 
<a name="l00718"></a>00718 <span class="comment">/* Given a return value in REGCACHE with a type VALTYPE, extract and copy its</span>
<a name="l00719"></a>00719 <span class="comment">   value into VALBUF.  */</span>
<a name="l00720"></a>00720 
<a name="l00721"></a>00721 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00722"></a>00722 tic6x_extract_return_value (<span class="keyword">struct</span> <a class="code" href="structtype.html">type</a> *valtype, <span class="keyword">struct</span> regcache *regcache,
<a name="l00723"></a>00723                             <span class="keyword">enum</span> bfd_endian byte_order, <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *valbuf)
<a name="l00724"></a>00724 {
<a name="l00725"></a>00725   <span class="keywordtype">int</span> <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a> = <a class="code" href="gdbtypes_8h.html#aeac33f868e763780094aec8a2dcb9a1a">TYPE_LENGTH</a> (valtype);
<a name="l00726"></a>00726 
<a name="l00727"></a>00727   <span class="comment">/* pointer types are returned in register A4,</span>
<a name="l00728"></a>00728 <span class="comment">     up to 32-bit types in A4</span>
<a name="l00729"></a>00729 <span class="comment">     up to 64-bit types in A5:A4  */</span>
<a name="l00730"></a>00730   <span class="keywordflow">if</span> (len &lt;= 4)
<a name="l00731"></a>00731     {
<a name="l00732"></a>00732       <span class="comment">/* In big-endian,</span>
<a name="l00733"></a>00733 <span class="comment">         - one-byte structure or union occupies the LSB of single even register.</span>
<a name="l00734"></a>00734 <span class="comment">         - for two-byte structure or union, the first byte occupies byte 1 of</span>
<a name="l00735"></a>00735 <span class="comment">         register and the second byte occupies byte 0.</span>
<a name="l00736"></a>00736 <span class="comment">         so, we read the contents in VAL from the LSBs of register.  */</span>
<a name="l00737"></a>00737       <span class="keywordflow">if</span> (len &lt; 3 &amp;&amp; byte_order == BFD_ENDIAN_BIG)
<a name="l00738"></a>00738         <a class="code" href="regcache_8c.html#a0df90ba73f76a25dbbd99903a5b57a27">regcache_cooked_read_part</a> (regcache, <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da244f3088af1b305a07bf81ae6ca3bea8">TIC6X_A4_REGNUM</a>, 4 - len, len,
<a name="l00739"></a>00739                                    valbuf);
<a name="l00740"></a>00740       <span class="keywordflow">else</span>
<a name="l00741"></a>00741         <a class="code" href="regcache_8c.html#a7056a5ea585aa0938893952f52d95e2e">regcache_cooked_read</a> (regcache, <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da244f3088af1b305a07bf81ae6ca3bea8">TIC6X_A4_REGNUM</a>, valbuf);
<a name="l00742"></a>00742     }
<a name="l00743"></a>00743   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len &lt;= 8)
<a name="l00744"></a>00744     {
<a name="l00745"></a>00745       <span class="comment">/* For a 5-8 byte structure or union in big-endian, the first byte</span>
<a name="l00746"></a>00746 <span class="comment">         occupies byte 3 (the MSB) of the upper (odd) register and the</span>
<a name="l00747"></a>00747 <span class="comment">         remaining bytes fill the decreasingly significant bytes.  5-7</span>
<a name="l00748"></a>00748 <span class="comment">         byte structures or unions have padding in the LSBs of the</span>
<a name="l00749"></a>00749 <span class="comment">         lower (even) register.  */</span>
<a name="l00750"></a>00750       <span class="keywordflow">if</span> (byte_order == BFD_ENDIAN_BIG)
<a name="l00751"></a>00751         {
<a name="l00752"></a>00752           <a class="code" href="regcache_8c.html#a7056a5ea585aa0938893952f52d95e2e">regcache_cooked_read</a> (regcache, <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da244f3088af1b305a07bf81ae6ca3bea8">TIC6X_A4_REGNUM</a>, valbuf + 4);
<a name="l00753"></a>00753           <a class="code" href="regcache_8c.html#a7056a5ea585aa0938893952f52d95e2e">regcache_cooked_read</a> (regcache, <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da3ad7aad7f1ac832b90cffb4be002ff2a">TIC6X_A5_REGNUM</a>, valbuf);
<a name="l00754"></a>00754         }
<a name="l00755"></a>00755       <span class="keywordflow">else</span>
<a name="l00756"></a>00756         {
<a name="l00757"></a>00757           <a class="code" href="regcache_8c.html#a7056a5ea585aa0938893952f52d95e2e">regcache_cooked_read</a> (regcache, <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da244f3088af1b305a07bf81ae6ca3bea8">TIC6X_A4_REGNUM</a>, valbuf);
<a name="l00758"></a>00758           <a class="code" href="regcache_8c.html#a7056a5ea585aa0938893952f52d95e2e">regcache_cooked_read</a> (regcache, <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da3ad7aad7f1ac832b90cffb4be002ff2a">TIC6X_A5_REGNUM</a>, valbuf + 4);
<a name="l00759"></a>00759         }
<a name="l00760"></a>00760     }
<a name="l00761"></a>00761 }
<a name="l00762"></a>00762 
<a name="l00763"></a>00763 <span class="comment">/* Write into appropriate registers a function return value</span>
<a name="l00764"></a>00764 <span class="comment">   of type TYPE, given in virtual format.  */</span>
<a name="l00765"></a>00765 
<a name="l00766"></a>00766 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00767"></a>00767 tic6x_store_return_value (<span class="keyword">struct</span> <a class="code" href="structtype.html">type</a> *valtype, <span class="keyword">struct</span> regcache *regcache,
<a name="l00768"></a>00768                           <span class="keyword">enum</span> bfd_endian byte_order, <span class="keyword">const</span> <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *valbuf)
<a name="l00769"></a>00769 {
<a name="l00770"></a>00770   <span class="keywordtype">int</span> len = <a class="code" href="gdbtypes_8h.html#aeac33f868e763780094aec8a2dcb9a1a">TYPE_LENGTH</a> (valtype);
<a name="l00771"></a>00771 
<a name="l00772"></a>00772   <span class="comment">/* return values of up to 8 bytes are returned in A5:A4 */</span>
<a name="l00773"></a>00773 
<a name="l00774"></a>00774   <span class="keywordflow">if</span> (len &lt;= 4)
<a name="l00775"></a>00775     {
<a name="l00776"></a>00776       <span class="keywordflow">if</span> (len &lt; 3 &amp;&amp; byte_order == BFD_ENDIAN_BIG)
<a name="l00777"></a>00777         <a class="code" href="regcache_8c.html#a722867e06f34f859c10d2c3e175f4519">regcache_cooked_write_part</a> (regcache, <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da244f3088af1b305a07bf81ae6ca3bea8">TIC6X_A4_REGNUM</a>, 4 - len, len,
<a name="l00778"></a>00778                                     valbuf);
<a name="l00779"></a>00779       <span class="keywordflow">else</span>
<a name="l00780"></a>00780         <a class="code" href="regcache_8c.html#a25a43a21da95fa740c8efca31cf61d56">regcache_cooked_write</a> (regcache, <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da244f3088af1b305a07bf81ae6ca3bea8">TIC6X_A4_REGNUM</a>, valbuf);
<a name="l00781"></a>00781     }
<a name="l00782"></a>00782   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len &lt;= 8)
<a name="l00783"></a>00783     {
<a name="l00784"></a>00784       <span class="keywordflow">if</span> (byte_order == BFD_ENDIAN_BIG)
<a name="l00785"></a>00785         {
<a name="l00786"></a>00786           <a class="code" href="regcache_8c.html#a25a43a21da95fa740c8efca31cf61d56">regcache_cooked_write</a> (regcache, <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da244f3088af1b305a07bf81ae6ca3bea8">TIC6X_A4_REGNUM</a>, valbuf + 4);
<a name="l00787"></a>00787           <a class="code" href="regcache_8c.html#a25a43a21da95fa740c8efca31cf61d56">regcache_cooked_write</a> (regcache, <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da3ad7aad7f1ac832b90cffb4be002ff2a">TIC6X_A5_REGNUM</a>, valbuf);
<a name="l00788"></a>00788         }
<a name="l00789"></a>00789       <span class="keywordflow">else</span>
<a name="l00790"></a>00790         {
<a name="l00791"></a>00791           <a class="code" href="regcache_8c.html#a25a43a21da95fa740c8efca31cf61d56">regcache_cooked_write</a> (regcache, <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da244f3088af1b305a07bf81ae6ca3bea8">TIC6X_A4_REGNUM</a>, valbuf);
<a name="l00792"></a>00792           <a class="code" href="regcache_8c.html#a25a43a21da95fa740c8efca31cf61d56">regcache_cooked_write</a> (regcache, <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da3ad7aad7f1ac832b90cffb4be002ff2a">TIC6X_A5_REGNUM</a>, valbuf + 4);
<a name="l00793"></a>00793         }
<a name="l00794"></a>00794     }
<a name="l00795"></a>00795 }
<a name="l00796"></a>00796 
<a name="l00797"></a>00797 <span class="comment">/* This is the implementation of gdbarch method return_value.  */</span>
<a name="l00798"></a>00798 
<a name="l00799"></a>00799 <span class="keyword">static</span> <span class="keyword">enum</span> <a class="code" href="defs_8h.html#ad73ff2db888df8f297b907f7093082a5">return_value_convention</a>
<a name="l00800"></a>00800 tic6x_return_value (<span class="keyword">struct</span> gdbarch *gdbarch, <span class="keyword">struct</span> value *<span class="keyword">function</span>,
<a name="l00801"></a>00801                     <span class="keyword">struct</span> <a class="code" href="structtype.html">type</a> *<a class="code" href="structtype.html">type</a>, <span class="keyword">struct</span> regcache *regcache,
<a name="l00802"></a>00802                     <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *readbuf, <span class="keyword">const</span> <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *writebuf)
<a name="l00803"></a>00803 {
<a name="l00804"></a>00804   <span class="comment">/* In C++, when function returns an object, even its size is small</span>
<a name="l00805"></a>00805 <span class="comment">     enough, it stii has to be passed via reference, pointed by register</span>
<a name="l00806"></a>00806 <span class="comment">     A3.  */</span>
<a name="l00807"></a>00807   <span class="keywordflow">if</span> (<a class="code" href="language_8c.html#acd2505a014a95629da9c836f8914fc79">current_language</a>-&gt;<a class="code" href="structlanguage__defn.html#a1395b7eb05a09e5798dc29257f30810a">la_language</a> == <a class="code" href="defs_8h.html#aa37aa8979934d47ac32fd96ecff32202a44cdc45a15de5e8e690da9ebf1b91132">language_cplus</a>)
<a name="l00808"></a>00808     {
<a name="l00809"></a>00809       <span class="keywordflow">if</span> (type != NULL)
<a name="l00810"></a>00810         {
<a name="l00811"></a>00811           <a class="code" href="gdbtypes_8h.html#ae2f9348c644babaa9038b4dc18bffaac">CHECK_TYPEDEF</a> (type);
<a name="l00812"></a>00812           <span class="keywordflow">if</span> (<a class="code" href="language_8c.html#a4daebc1b24978eb0543f17c24d80585f">language_pass_by_reference</a> (type))
<a name="l00813"></a>00813             <span class="keywordflow">return</span> <a class="code" href="defs_8h.html#ad73ff2db888df8f297b907f7093082a5a1fab6a0bfd44af88ba17a143673dc937">RETURN_VALUE_STRUCT_CONVENTION</a>;
<a name="l00814"></a>00814         }
<a name="l00815"></a>00815     }
<a name="l00816"></a>00816 
<a name="l00817"></a>00817   <span class="keywordflow">if</span> (<a class="code" href="gdbtypes_8h.html#aeac33f868e763780094aec8a2dcb9a1a">TYPE_LENGTH</a> (type) &gt; 8)
<a name="l00818"></a>00818     <span class="keywordflow">return</span> <a class="code" href="defs_8h.html#ad73ff2db888df8f297b907f7093082a5a1fab6a0bfd44af88ba17a143673dc937">RETURN_VALUE_STRUCT_CONVENTION</a>;
<a name="l00819"></a>00819 
<a name="l00820"></a>00820   <span class="keywordflow">if</span> (readbuf)
<a name="l00821"></a>00821     tic6x_extract_return_value (type, regcache,
<a name="l00822"></a>00822                                 <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (gdbarch), readbuf);
<a name="l00823"></a>00823   <span class="keywordflow">if</span> (writebuf)
<a name="l00824"></a>00824     tic6x_store_return_value (type, regcache,
<a name="l00825"></a>00825                               <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (gdbarch), writebuf);
<a name="l00826"></a>00826 
<a name="l00827"></a>00827   <span class="keywordflow">return</span> <a class="code" href="defs_8h.html#ad73ff2db888df8f297b907f7093082a5a0cd14b7546740080384acc0c7e5caf3b">RETURN_VALUE_REGISTER_CONVENTION</a>;
<a name="l00828"></a>00828 }
<a name="l00829"></a>00829 
<a name="l00830"></a>00830 <span class="comment">/* This is the implementation of gdbarch method dummy_id.  */</span>
<a name="l00831"></a>00831 
<a name="l00832"></a>00832 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structframe__id.html">frame_id</a>
<a name="l00833"></a>00833 tic6x_dummy_id (struct gdbarch *gdbarch, <span class="keyword">struct </span>frame_info *this_frame)
<a name="l00834"></a>00834 {
<a name="l00835"></a>00835   <span class="keywordflow">return</span> <a class="code" href="frame_8c.html#a7f32da6ddc275b4684c301448d891f5b">frame_id_build</a>
<a name="l00836"></a>00836     (<a class="code" href="frame_8c.html#affa785e8937e96fd727e46a2cfec94c4">get_frame_register_unsigned</a> (this_frame, <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da5da070e8fd88704a05f42848c2060587">TIC6X_SP_REGNUM</a>),
<a name="l00837"></a>00837      <a class="code" href="frame_8c.html#a27aafb00e05cba145dfba0e4bc7b1d70">get_frame_pc</a> (this_frame));
<a name="l00838"></a>00838 }
<a name="l00839"></a>00839 
<a name="l00840"></a>00840 <span class="comment">/* Get the alignment requirement of TYPE.  */</span>
<a name="l00841"></a>00841 
<a name="l00842"></a>00842 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00843"></a>00843 tic6x_arg_type_alignment (<span class="keyword">struct</span> type *type)
<a name="l00844"></a>00844 {
<a name="l00845"></a>00845   <span class="keywordtype">int</span> len = <a class="code" href="gdbtypes_8h.html#aeac33f868e763780094aec8a2dcb9a1a">TYPE_LENGTH</a> (<a class="code" href="gdbtypes_8c.html#a0bf29d7521d8a8b8735b9a259e380386">check_typedef</a> (type));
<a name="l00846"></a>00846   <span class="keyword">enum</span> <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462">type_code</a> typecode = <a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (<a class="code" href="gdbtypes_8c.html#a0bf29d7521d8a8b8735b9a259e380386">check_typedef</a> (type));
<a name="l00847"></a>00847 
<a name="l00848"></a>00848   <span class="keywordflow">if</span> (typecode == <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462af3b3fc76f66c95e12946c0ef84409365">TYPE_CODE_STRUCT</a> || typecode == <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a8c3218d2f780665395d57dcd4d909191">TYPE_CODE_UNION</a>)
<a name="l00849"></a>00849     {
<a name="l00850"></a>00850       <span class="comment">/* The stack alignment of a structure (and union) passed by value is the</span>
<a name="l00851"></a>00851 <span class="comment">         smallest power of two greater than or equal to its size.</span>
<a name="l00852"></a>00852 <span class="comment">         This cannot exceed 8 bytes, which is the largest allowable size for</span>
<a name="l00853"></a>00853 <span class="comment">         a structure passed by value.  */</span>
<a name="l00854"></a>00854 
<a name="l00855"></a>00855       <span class="keywordflow">if</span> (len &lt;= 2)
<a name="l00856"></a>00856         <span class="keywordflow">return</span> <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>;
<a name="l00857"></a>00857       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len &lt;= 4)
<a name="l00858"></a>00858         <span class="keywordflow">return</span> 4;
<a name="l00859"></a>00859       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len &lt;= 8)
<a name="l00860"></a>00860         <span class="keywordflow">return</span> 8;
<a name="l00861"></a>00861       <span class="keywordflow">else</span>
<a name="l00862"></a>00862         <a class="code" href="gdb__assert_8h.html#aa0526ecd768317edecf0b46c981cbcc0">gdb_assert_not_reached</a> (<span class="stringliteral">&quot;unexpected length of data&quot;</span>);
<a name="l00863"></a>00863     }
<a name="l00864"></a>00864   <span class="keywordflow">else</span>
<a name="l00865"></a>00865     {
<a name="l00866"></a>00866       <span class="keywordflow">if</span> (len &lt;= 4)
<a name="l00867"></a>00867         <span class="keywordflow">return</span> 4;
<a name="l00868"></a>00868       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len == 8)
<a name="l00869"></a>00869         {
<a name="l00870"></a>00870           <span class="keywordflow">if</span> (typecode == <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462ad8de4d143b624cd2bcab740a51a04658">TYPE_CODE_COMPLEX</a>)
<a name="l00871"></a>00871             <span class="keywordflow">return</span> 4;
<a name="l00872"></a>00872           <span class="keywordflow">else</span>
<a name="l00873"></a>00873             <span class="keywordflow">return</span> 8;
<a name="l00874"></a>00874         }
<a name="l00875"></a>00875       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len == 16)
<a name="l00876"></a>00876         {
<a name="l00877"></a>00877           <span class="keywordflow">if</span> (typecode == <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462ad8de4d143b624cd2bcab740a51a04658">TYPE_CODE_COMPLEX</a>)
<a name="l00878"></a>00878             <span class="keywordflow">return</span> 8;
<a name="l00879"></a>00879           <span class="keywordflow">else</span>
<a name="l00880"></a>00880             <span class="keywordflow">return</span> 16;
<a name="l00881"></a>00881         }
<a name="l00882"></a>00882       <span class="keywordflow">else</span>
<a name="l00883"></a>00883         <a class="code" href="common-utils_8h.html#aa14285d9d3d4171016ef9cf09447e8bb">internal_error</a> (__FILE__, __LINE__, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;unexpected length %d of type&quot;</span>),
<a name="l00884"></a>00884                         len);
<a name="l00885"></a>00885     }
<a name="l00886"></a>00886 }
<a name="l00887"></a>00887 
<a name="l00888"></a>00888 <span class="comment">/* This is the implementation of gdbarch method push_dummy_call.  */</span>
<a name="l00889"></a>00889 
<a name="l00890"></a>00890 <span class="keyword">static</span> <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a>
<a name="l00891"></a>00891 tic6x_push_dummy_call (<span class="keyword">struct</span> gdbarch *gdbarch, <span class="keyword">struct</span> value *<span class="keyword">function</span>,
<a name="l00892"></a>00892                        <span class="keyword">struct</span> regcache *regcache, <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> bp_addr,
<a name="l00893"></a>00893                        <span class="keywordtype">int</span> nargs, <span class="keyword">struct</span> value **args, <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> sp,
<a name="l00894"></a>00894                        <span class="keywordtype">int</span> <a class="code" href="arm-tdep_8h.html#aabb639d85dec2f973451bb1e7b6d1be8">struct_return</a>, <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> struct_addr)
<a name="l00895"></a>00895 {
<a name="l00896"></a>00896   <span class="keywordtype">int</span> argreg = 0;
<a name="l00897"></a>00897   <span class="keywordtype">int</span> argnum;
<a name="l00898"></a>00898   <span class="keywordtype">int</span> stack_offset = 4;
<a name="l00899"></a>00899   <span class="keywordtype">int</span> references_offset = 4;
<a name="l00900"></a>00900   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> func_addr = <a class="code" href="infcall_8c.html#a68f258349aa77867901ff0b0ba2815a9">find_function_addr</a> (<span class="keyword">function</span>, NULL);
<a name="l00901"></a>00901   <span class="keyword">enum</span> bfd_endian byte_order = <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (gdbarch);
<a name="l00902"></a>00902   <span class="keyword">struct </span>type *<a class="code" href="structfunc__type.html">func_type</a> = <a class="code" href="value_8c.html#a263a4c0bee0b0df41074b952d3c121d0">value_type</a> (<span class="keyword">function</span>);
<a name="l00903"></a>00903   <span class="comment">/* The first arg passed on stack.  Mostly the first 10 args are passed by</span>
<a name="l00904"></a>00904 <span class="comment">     registers.  */</span>
<a name="l00905"></a>00905   <span class="keywordtype">int</span> first_arg_on_stack = 10;
<a name="l00906"></a>00906 
<a name="l00907"></a>00907   <span class="comment">/* Set the return address register to point to the entry point of</span>
<a name="l00908"></a>00908 <span class="comment">     the program, where a breakpoint lies in wait.  */</span>
<a name="l00909"></a>00909   <a class="code" href="regcache_8c.html#ae5fb22bfd07bc89a855768ef6f910745">regcache_cooked_write_unsigned</a> (regcache, <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da7a422511af8ea7046be3cd0bddfec464">TIC6X_RA_REGNUM</a>, bp_addr);
<a name="l00910"></a>00910 
<a name="l00911"></a>00911   <span class="comment">/* The caller must pass an argument in A3 containing a destination address</span>
<a name="l00912"></a>00912 <span class="comment">     for the returned value.  The callee returns the object by copying it to</span>
<a name="l00913"></a>00913 <span class="comment">     the address in A3.  */</span>
<a name="l00914"></a>00914   <span class="keywordflow">if</span> (struct_return)
<a name="l00915"></a>00915     <a class="code" href="regcache_8c.html#ae5fb22bfd07bc89a855768ef6f910745">regcache_cooked_write_unsigned</a> (regcache, 3, struct_addr);
<a name="l00916"></a>00916 
<a name="l00917"></a>00917   <span class="comment">/* Determine the type of this function.  */</span>
<a name="l00918"></a>00918   func_type = <a class="code" href="gdbtypes_8c.html#a0bf29d7521d8a8b8735b9a259e380386">check_typedef</a> (func_type);
<a name="l00919"></a>00919   <span class="keywordflow">if</span> (<a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (func_type) == <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a1a639160f3e3a2f9f7ac55255942c581">TYPE_CODE_PTR</a>)
<a name="l00920"></a>00920     func_type = <a class="code" href="gdbtypes_8c.html#a0bf29d7521d8a8b8735b9a259e380386">check_typedef</a> (<a class="code" href="gdbtypes_8h.html#a87a33d723acd28a033e63c4297c6c916">TYPE_TARGET_TYPE</a> (func_type));
<a name="l00921"></a>00921 
<a name="l00922"></a>00922   <a class="code" href="gdb__assert_8h.html#aeb007d3e990858c7ef8e40a7e512c1ff">gdb_assert</a> (<a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (func_type) == <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a4b6327934915849a4e96eef151fe312b">TYPE_CODE_FUNC</a>
<a name="l00923"></a>00923               || <a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (func_type) == <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a581771a1410949e8b505dd51426949e9">TYPE_CODE_METHOD</a>);
<a name="l00924"></a>00924 
<a name="l00925"></a>00925   <span class="comment">/* For a variadic C function, the last explicitly declared argument and all</span>
<a name="l00926"></a>00926 <span class="comment">     remaining arguments are passed on the stack.  */</span>
<a name="l00927"></a>00927   <span class="keywordflow">if</span> (<a class="code" href="gdbtypes_8h.html#ac64534be7706a7ed40f5b2de42df4371">TYPE_VARARGS</a> (func_type))
<a name="l00928"></a>00928     first_arg_on_stack = <a class="code" href="gdbtypes_8h.html#a2872fd7f60b18f9cf1ed3227fc4441cd">TYPE_NFIELDS</a> (func_type) - 1;
<a name="l00929"></a>00929 
<a name="l00930"></a>00930   <span class="comment">/* Now make space on the stack for the args.  */</span>
<a name="l00931"></a>00931   <span class="keywordflow">for</span> (argnum = 0; argnum &lt; nargs; argnum++)
<a name="l00932"></a>00932     {
<a name="l00933"></a>00933       <span class="keywordtype">int</span> len = <a class="code" href="utils_8c.html#a1597f2e569978430feec3d64b5e4caa6">align_up</a> (<a class="code" href="gdbtypes_8h.html#aeac33f868e763780094aec8a2dcb9a1a">TYPE_LENGTH</a> (<a class="code" href="value_8c.html#a263a4c0bee0b0df41074b952d3c121d0">value_type</a> (args[argnum])), 4);
<a name="l00934"></a>00934       <span class="keywordflow">if</span> (argnum &gt;= 10 - argreg)
<a name="l00935"></a>00935         references_offset += <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>;
<a name="l00936"></a>00936       stack_offset += <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>;
<a name="l00937"></a>00937     }
<a name="l00938"></a>00938   sp -= stack_offset;
<a name="l00939"></a>00939   <span class="comment">/* SP should be 8-byte aligned, see C6000 ABI section 4.4.1</span>
<a name="l00940"></a>00940 <span class="comment">     Stack Alignment.  */</span>
<a name="l00941"></a>00941   sp = <a class="code" href="utils_8c.html#a2333cae8a4809e09f8e851c83838ecaf">align_down</a> (sp, 8);
<a name="l00942"></a>00942   stack_offset = 4;
<a name="l00943"></a>00943 
<a name="l00944"></a>00944   <span class="comment">/* Now load as many as possible of the first arguments into</span>
<a name="l00945"></a>00945 <span class="comment">     registers, and push the rest onto the stack.  Loop through args</span>
<a name="l00946"></a>00946 <span class="comment">     from first to last.  */</span>
<a name="l00947"></a>00947   <span class="keywordflow">for</span> (argnum = 0; argnum &lt; nargs; argnum++)
<a name="l00948"></a>00948     {
<a name="l00949"></a>00949       <span class="keyword">const</span> <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *val;
<a name="l00950"></a>00950       <span class="keyword">struct </span>value *arg = args[argnum];
<a name="l00951"></a>00951       <span class="keyword">struct </span>type *arg_type = <a class="code" href="gdbtypes_8c.html#a0bf29d7521d8a8b8735b9a259e380386">check_typedef</a> (<a class="code" href="value_8c.html#a263a4c0bee0b0df41074b952d3c121d0">value_type</a> (arg));
<a name="l00952"></a>00952       <span class="keywordtype">int</span> len = <a class="code" href="gdbtypes_8h.html#aeac33f868e763780094aec8a2dcb9a1a">TYPE_LENGTH</a> (arg_type);
<a name="l00953"></a>00953       <span class="keyword">enum</span> <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462">type_code</a> typecode = <a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (arg_type);
<a name="l00954"></a>00954 
<a name="l00955"></a>00955       val = <a class="code" href="value_8c.html#ad41a6de8fde15c01e1ffabb603c4f108">value_contents</a> (arg);
<a name="l00956"></a>00956 
<a name="l00957"></a>00957       <span class="comment">/* Copy the argument to general registers or the stack in</span>
<a name="l00958"></a>00958 <span class="comment">         register-sized pieces.  */</span>
<a name="l00959"></a>00959       <span class="keywordflow">if</span> (argreg &lt; first_arg_on_stack)
<a name="l00960"></a>00960         {
<a name="l00961"></a>00961           <span class="keywordflow">if</span> (len &lt;= 4)
<a name="l00962"></a>00962             {
<a name="l00963"></a>00963               <span class="keywordflow">if</span> (typecode == <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462af3b3fc76f66c95e12946c0ef84409365">TYPE_CODE_STRUCT</a> || typecode == <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a8c3218d2f780665395d57dcd4d909191">TYPE_CODE_UNION</a>)
<a name="l00964"></a>00964                 {
<a name="l00965"></a>00965                   <span class="comment">/* In big-endian,</span>
<a name="l00966"></a>00966 <span class="comment">                     - one-byte structure or union occupies the LSB of single</span>
<a name="l00967"></a>00967 <span class="comment">                     even register.</span>
<a name="l00968"></a>00968 <span class="comment">                     - for two-byte structure or union, the first byte</span>
<a name="l00969"></a>00969 <span class="comment">                     occupies byte 1 of register and the second byte occupies</span>
<a name="l00970"></a>00970 <span class="comment">                     byte 0.</span>
<a name="l00971"></a>00971 <span class="comment">                     so, we write the contents in VAL to the lsp of</span>
<a name="l00972"></a>00972 <span class="comment">                     register.  */</span>
<a name="l00973"></a>00973                   <span class="keywordflow">if</span> (len &lt; 3 &amp;&amp; byte_order == BFD_ENDIAN_BIG)
<a name="l00974"></a>00974                     <a class="code" href="regcache_8c.html#a722867e06f34f859c10d2c3e175f4519">regcache_cooked_write_part</a> (regcache, arg_regs[argreg],
<a name="l00975"></a>00975                                                 4 - len, len, val);
<a name="l00976"></a>00976                   <span class="keywordflow">else</span>
<a name="l00977"></a>00977                     <a class="code" href="regcache_8c.html#a25a43a21da95fa740c8efca31cf61d56">regcache_cooked_write</a> (regcache, arg_regs[argreg], val);
<a name="l00978"></a>00978                 }
<a name="l00979"></a>00979               <span class="keywordflow">else</span>
<a name="l00980"></a>00980                 {
<a name="l00981"></a>00981                   <span class="comment">/* The argument is being passed by value in a single</span>
<a name="l00982"></a>00982 <span class="comment">                     register.  */</span>
<a name="l00983"></a>00983                   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> regval = <a class="code" href="defs_8h.html#a99aec65329508b4d449a4f881026f844">extract_unsigned_integer</a> (val, len,
<a name="l00984"></a>00984                                                                byte_order);
<a name="l00985"></a>00985 
<a name="l00986"></a>00986                   <a class="code" href="regcache_8c.html#ae5fb22bfd07bc89a855768ef6f910745">regcache_cooked_write_unsigned</a> (regcache, arg_regs[argreg],
<a name="l00987"></a>00987                                                   regval);
<a name="l00988"></a>00988                 }
<a name="l00989"></a>00989             }
<a name="l00990"></a>00990           <span class="keywordflow">else</span>
<a name="l00991"></a>00991             {
<a name="l00992"></a>00992               <span class="keywordflow">if</span> (len &lt;= 8)
<a name="l00993"></a>00993                 {
<a name="l00994"></a>00994                   <span class="keywordflow">if</span> (typecode == <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462af3b3fc76f66c95e12946c0ef84409365">TYPE_CODE_STRUCT</a>
<a name="l00995"></a>00995                       || typecode == <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a8c3218d2f780665395d57dcd4d909191">TYPE_CODE_UNION</a>)
<a name="l00996"></a>00996                     {
<a name="l00997"></a>00997                       <span class="comment">/* For a 5-8 byte structure or union in big-endian, the</span>
<a name="l00998"></a>00998 <span class="comment">                         first byte occupies byte 3 (the MSB) of the upper (odd)</span>
<a name="l00999"></a>00999 <span class="comment">                         register and the remaining bytes fill the decreasingly</span>
<a name="l01000"></a>01000 <span class="comment">                         significant bytes.  5-7 byte structures or unions have</span>
<a name="l01001"></a>01001 <span class="comment">                         padding in the LSBs of the lower (even) register.  */</span>
<a name="l01002"></a>01002                       <span class="keywordflow">if</span> (byte_order == BFD_ENDIAN_BIG)
<a name="l01003"></a>01003                         {
<a name="l01004"></a>01004                           <a class="code" href="regcache_8c.html#a25a43a21da95fa740c8efca31cf61d56">regcache_cooked_write</a> (regcache,
<a name="l01005"></a>01005                                                  arg_regs[argreg] + 1, val);
<a name="l01006"></a>01006                           <a class="code" href="regcache_8c.html#a722867e06f34f859c10d2c3e175f4519">regcache_cooked_write_part</a> (regcache,
<a name="l01007"></a>01007                                                       arg_regs[argreg], 0,
<a name="l01008"></a>01008                                                       len - 4, val + 4);
<a name="l01009"></a>01009                         }
<a name="l01010"></a>01010                       <span class="keywordflow">else</span>
<a name="l01011"></a>01011                         {
<a name="l01012"></a>01012                           <a class="code" href="regcache_8c.html#a25a43a21da95fa740c8efca31cf61d56">regcache_cooked_write</a> (regcache, arg_regs[argreg],
<a name="l01013"></a>01013                                                  val);
<a name="l01014"></a>01014                           <a class="code" href="regcache_8c.html#a722867e06f34f859c10d2c3e175f4519">regcache_cooked_write_part</a> (regcache,
<a name="l01015"></a>01015                                                       arg_regs[argreg] + 1, 0,
<a name="l01016"></a>01016                                                       len - 4, val + 4);
<a name="l01017"></a>01017                         }
<a name="l01018"></a>01018                     }
<a name="l01019"></a>01019                   <span class="keywordflow">else</span>
<a name="l01020"></a>01020                     {
<a name="l01021"></a>01021                       <span class="comment">/* The argument is being passed by value in a pair of</span>
<a name="l01022"></a>01022 <span class="comment">                         registers.  */</span>
<a name="l01023"></a>01023                       <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> regval = <a class="code" href="defs_8h.html#a99aec65329508b4d449a4f881026f844">extract_unsigned_integer</a> (val, len,
<a name="l01024"></a>01024                                                                   byte_order);
<a name="l01025"></a>01025 
<a name="l01026"></a>01026                       <a class="code" href="regcache_8c.html#ae5fb22bfd07bc89a855768ef6f910745">regcache_cooked_write_unsigned</a> (regcache,
<a name="l01027"></a>01027                                                       arg_regs[argreg],
<a name="l01028"></a>01028                                                       regval);
<a name="l01029"></a>01029                       <a class="code" href="regcache_8c.html#ae5fb22bfd07bc89a855768ef6f910745">regcache_cooked_write_unsigned</a> (regcache,
<a name="l01030"></a>01030                                                       arg_regs[argreg] + 1,
<a name="l01031"></a>01031                                                       regval &gt;&gt; 32);
<a name="l01032"></a>01032                     }
<a name="l01033"></a>01033                 }
<a name="l01034"></a>01034               <span class="keywordflow">else</span>
<a name="l01035"></a>01035                 {
<a name="l01036"></a>01036                   <span class="comment">/* The argument is being passed by reference in a single</span>
<a name="l01037"></a>01037 <span class="comment">                     register.  */</span>
<a name="l01038"></a>01038                   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> addr;
<a name="l01039"></a>01039 
<a name="l01040"></a>01040                   <span class="comment">/* It is not necessary to adjust REFERENCES_OFFSET to</span>
<a name="l01041"></a>01041 <span class="comment">                     8-byte aligned in some cases, in which 4-byte alignment</span>
<a name="l01042"></a>01042 <span class="comment">                     is sufficient.  For simplicity, we adjust</span>
<a name="l01043"></a>01043 <span class="comment">                     REFERENCES_OFFSET to 8-byte aligned.  */</span>
<a name="l01044"></a>01044                   references_offset = <a class="code" href="utils_8c.html#a1597f2e569978430feec3d64b5e4caa6">align_up</a> (references_offset, 8);
<a name="l01045"></a>01045 
<a name="l01046"></a>01046                   addr = sp + references_offset;
<a name="l01047"></a>01047                   <a class="code" href="corefile_8c.html#a05c568c157071d9349667fab589228e5">write_memory</a> (addr, val, len);
<a name="l01048"></a>01048                   references_offset += <a class="code" href="utils_8c.html#a1597f2e569978430feec3d64b5e4caa6">align_up</a> (len, 4);
<a name="l01049"></a>01049                   <a class="code" href="regcache_8c.html#ae5fb22bfd07bc89a855768ef6f910745">regcache_cooked_write_unsigned</a> (regcache, arg_regs[argreg],
<a name="l01050"></a>01050                                                   addr);
<a name="l01051"></a>01051                 }
<a name="l01052"></a>01052             }
<a name="l01053"></a>01053           argreg++;
<a name="l01054"></a>01054         }
<a name="l01055"></a>01055       <span class="keywordflow">else</span>
<a name="l01056"></a>01056         {
<a name="l01057"></a>01057           <span class="comment">/* The argument is being passed on the stack.  */</span>
<a name="l01058"></a>01058           <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> addr;
<a name="l01059"></a>01059 
<a name="l01060"></a>01060           <span class="comment">/* There are six different cases of alignment, and these rules can</span>
<a name="l01061"></a>01061 <span class="comment">             be found in tic6x_arg_type_alignment:</span>
<a name="l01062"></a>01062 <span class="comment"></span>
<a name="l01063"></a>01063 <span class="comment">             1) 4-byte aligned if size is less than or equal to 4 byte, such</span>
<a name="l01064"></a>01064 <span class="comment">             as short, int, struct, union etc.</span>
<a name="l01065"></a>01065 <span class="comment">             2) 8-byte aligned if size is less than or equal to 8-byte, such</span>
<a name="l01066"></a>01066 <span class="comment">             as double, long long,</span>
<a name="l01067"></a>01067 <span class="comment">             3) 4-byte aligned if it is of type _Complex float, even its size</span>
<a name="l01068"></a>01068 <span class="comment">             is 8-byte.</span>
<a name="l01069"></a>01069 <span class="comment">             4) 8-byte aligned if it is of type _Complex double or _Complex</span>
<a name="l01070"></a>01070 <span class="comment">             long double, even its size is 16-byte.  Because, the address of</span>
<a name="l01071"></a>01071 <span class="comment">             variable is passed as reference.</span>
<a name="l01072"></a>01072 <span class="comment">             5) struct and union larger than 8-byte are passed by reference, so</span>
<a name="l01073"></a>01073 <span class="comment">             it is 4-byte aligned.</span>
<a name="l01074"></a>01074 <span class="comment">             6) struct and union of size between 4 byte and 8 byte varies.</span>
<a name="l01075"></a>01075 <span class="comment">             alignment of struct variable is the alignment of its first field,</span>
<a name="l01076"></a>01076 <span class="comment">             while alignment of union variable is the max of all its fields&#39;</span>
<a name="l01077"></a>01077 <span class="comment">             alignment.  */</span>
<a name="l01078"></a>01078 
<a name="l01079"></a>01079           <span class="keywordflow">if</span> (len &lt;= 4)
<a name="l01080"></a>01080             ; <span class="comment">/* Default is 4-byte aligned.  Nothing to be done.  */</span>
<a name="l01081"></a>01081           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len &lt;= 8)
<a name="l01082"></a>01082             stack_offset = <a class="code" href="utils_8c.html#a1597f2e569978430feec3d64b5e4caa6">align_up</a> (stack_offset,
<a name="l01083"></a>01083                                      tic6x_arg_type_alignment (arg_type));
<a name="l01084"></a>01084           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len == 16)
<a name="l01085"></a>01085             {
<a name="l01086"></a>01086               <span class="comment">/* _Complex double or _Complex long double */</span>
<a name="l01087"></a>01087               <span class="keywordflow">if</span> (typecode == <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462ad8de4d143b624cd2bcab740a51a04658">TYPE_CODE_COMPLEX</a>)
<a name="l01088"></a>01088                 {
<a name="l01089"></a>01089                   <span class="comment">/* The argument is being passed by reference on stack.  */</span>
<a name="l01090"></a>01090                   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> addr;
<a name="l01091"></a>01091                   references_offset = <a class="code" href="utils_8c.html#a1597f2e569978430feec3d64b5e4caa6">align_up</a> (references_offset, 8);
<a name="l01092"></a>01092 
<a name="l01093"></a>01093                   addr = sp + references_offset;
<a name="l01094"></a>01094                   <span class="comment">/* Store variable on stack.  */</span>
<a name="l01095"></a>01095                   <a class="code" href="corefile_8c.html#a05c568c157071d9349667fab589228e5">write_memory</a> (addr, val, len);
<a name="l01096"></a>01096 
<a name="l01097"></a>01097                   references_offset += <a class="code" href="utils_8c.html#a1597f2e569978430feec3d64b5e4caa6">align_up</a> (len, 4);
<a name="l01098"></a>01098 
<a name="l01099"></a>01099                   <span class="comment">/* Pass the address of variable on stack as reference.  */</span>
<a name="l01100"></a>01100                   <a class="code" href="defs_8h.html#ad11c013c83c64d9d0ee2e4bdeb1fb62d">store_unsigned_integer</a> ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) val, 4, byte_order,
<a name="l01101"></a>01101                                           addr);
<a name="l01102"></a>01102                   len = 4;
<a name="l01103"></a>01103 
<a name="l01104"></a>01104                 }
<a name="l01105"></a>01105               <span class="keywordflow">else</span>
<a name="l01106"></a>01106                 <a class="code" href="common-utils_8h.html#aa14285d9d3d4171016ef9cf09447e8bb">internal_error</a> (__FILE__, __LINE__,
<a name="l01107"></a>01107                                 <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;unexpected type %d of arg %d&quot;</span>),
<a name="l01108"></a>01108                                 typecode, argnum);
<a name="l01109"></a>01109             }
<a name="l01110"></a>01110           <span class="keywordflow">else</span>
<a name="l01111"></a>01111             <a class="code" href="common-utils_8h.html#aa14285d9d3d4171016ef9cf09447e8bb">internal_error</a> (__FILE__, __LINE__,
<a name="l01112"></a>01112                             <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;unexpected length %d of arg %d&quot;</span>), len, argnum);
<a name="l01113"></a>01113 
<a name="l01114"></a>01114           addr = sp + stack_offset;
<a name="l01115"></a>01115           <a class="code" href="corefile_8c.html#a05c568c157071d9349667fab589228e5">write_memory</a> (addr, val, len);
<a name="l01116"></a>01116           stack_offset += <a class="code" href="utils_8c.html#a1597f2e569978430feec3d64b5e4caa6">align_up</a> (len, 4);
<a name="l01117"></a>01117         }
<a name="l01118"></a>01118     }
<a name="l01119"></a>01119 
<a name="l01120"></a>01120   <a class="code" href="regcache_8c.html#a81b7aed5cdcbde3896b0522e932d251a">regcache_cooked_write_signed</a> (regcache, <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da5da070e8fd88704a05f42848c2060587">TIC6X_SP_REGNUM</a>, sp);
<a name="l01121"></a>01121 
<a name="l01122"></a>01122   <span class="comment">/* Return adjusted stack pointer.  */</span>
<a name="l01123"></a>01123   <span class="keywordflow">return</span> sp;
<a name="l01124"></a>01124 }
<a name="l01125"></a>01125 
<a name="l01126"></a>01126 <span class="comment">/* This is the implementation of gdbarch method in_function_epilogue_p.  */</span>
<a name="l01127"></a>01127 
<a name="l01128"></a>01128 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01129"></a>01129 tic6x_in_function_epilogue_p (<span class="keyword">struct</span> gdbarch *gdbarch, <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> pc)
<a name="l01130"></a>01130 {
<a name="l01131"></a>01131   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> inst = tic6x_fetch_instruction (gdbarch, pc);
<a name="l01132"></a>01132   <span class="comment">/* Normally, the epilogue is composed by instruction `b .S2 b3&#39;.  */</span>
<a name="l01133"></a>01133   <span class="keywordflow">if</span> ((inst &amp; 0x0f83effc) == 0x360)
<a name="l01134"></a>01134     {
<a name="l01135"></a>01135       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> src2 = tic6x_register_number ((inst &gt;&gt; 18) &amp; 0x1f,
<a name="l01136"></a>01136                                                  <a class="code" href="tic6x-tdep_8c.html#a7b1ad58f3bb4fc2cfa62467cbc0a50f7">INST_S_BIT</a> (inst),
<a name="l01137"></a>01137                                                  <a class="code" href="tic6x-tdep_8c.html#a092de10f37665ddf10408036ac4c2632">INST_X_BIT</a> (inst));
<a name="l01138"></a>01138       <span class="keywordflow">if</span> (src2 == <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da7a422511af8ea7046be3cd0bddfec464">TIC6X_RA_REGNUM</a>)
<a name="l01139"></a>01139         <span class="keywordflow">return</span> 1;
<a name="l01140"></a>01140     }
<a name="l01141"></a>01141 
<a name="l01142"></a>01142   <span class="keywordflow">return</span> 0;
<a name="l01143"></a>01143 }
<a name="l01144"></a>01144 
<a name="l01145"></a>01145 <span class="comment">/* This is the implementation of gdbarch method get_longjmp_target.  */</span>
<a name="l01146"></a>01146 
<a name="l01147"></a>01147 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01148"></a>01148 tic6x_get_longjmp_target (<span class="keyword">struct</span> frame_info *frame, <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> *pc)
<a name="l01149"></a>01149 {
<a name="l01150"></a>01150   <span class="keyword">struct </span>gdbarch *gdbarch = <a class="code" href="frame_8c.html#ab44507b5655da44e522ed5857835ede7">get_frame_arch</a> (frame);
<a name="l01151"></a>01151   <span class="keyword">enum</span> bfd_endian byte_order = <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (gdbarch);
<a name="l01152"></a>01152   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> jb_addr;
<a name="l01153"></a>01153   <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> buf[4];
<a name="l01154"></a>01154 
<a name="l01155"></a>01155   <span class="comment">/* JMP_BUF is passed by reference in A4.  */</span>
<a name="l01156"></a>01156   jb_addr = <a class="code" href="frame_8c.html#affa785e8937e96fd727e46a2cfec94c4">get_frame_register_unsigned</a> (frame, 4);
<a name="l01157"></a>01157 
<a name="l01158"></a>01158   <span class="comment">/* JMP_BUF contains 13 elements of type int, and return address is stored</span>
<a name="l01159"></a>01159 <span class="comment">     in the last slot.  */</span>
<a name="l01160"></a>01160   <span class="keywordflow">if</span> (<a class="code" href="target_8c.html#ac579515fbccfb9e6b1a45766a71c1d4f">target_read_memory</a> (jb_addr + 12 * 4, buf, 4))
<a name="l01161"></a>01161     <span class="keywordflow">return</span> 0;
<a name="l01162"></a>01162 
<a name="l01163"></a>01163   *pc = <a class="code" href="defs_8h.html#a99aec65329508b4d449a4f881026f844">extract_unsigned_integer</a> (buf, 4, byte_order);
<a name="l01164"></a>01164 
<a name="l01165"></a>01165   <span class="keywordflow">return</span> 1;
<a name="l01166"></a>01166 }
<a name="l01167"></a>01167 
<a name="l01168"></a>01168 <span class="comment">/* This is the implementation of gdbarch method</span>
<a name="l01169"></a>01169 <span class="comment">   return_in_first_hidden_param_p.  */</span>
<a name="l01170"></a>01170 
<a name="l01171"></a>01171 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01172"></a>01172 tic6x_return_in_first_hidden_param_p (<span class="keyword">struct</span> gdbarch *gdbarch,
<a name="l01173"></a>01173                                       <span class="keyword">struct</span> type *type)
<a name="l01174"></a>01174 {
<a name="l01175"></a>01175   <span class="keywordflow">return</span> 0;
<a name="l01176"></a>01176 }
<a name="l01177"></a>01177 
<a name="l01178"></a>01178 <span class="keyword">static</span> <span class="keyword">struct </span>gdbarch *
<a name="l01179"></a>01179 tic6x_gdbarch_init (<span class="keyword">struct</span> <a class="code" href="structgdbarch__info.html">gdbarch_info</a> info, <span class="keyword">struct</span> <a class="code" href="structgdbarch__list.html">gdbarch_list</a> *arches)
<a name="l01180"></a>01180 {
<a name="l01181"></a>01181   <span class="keyword">struct </span>gdbarch *gdbarch;
<a name="l01182"></a>01182   <span class="keyword">struct </span><a class="code" href="structgdbarch__tdep.html">gdbarch_tdep</a> *tdep;
<a name="l01183"></a>01183   <span class="keyword">struct </span>tdesc_arch_data *tdesc_data = NULL;
<a name="l01184"></a>01184   <span class="keyword">const</span> <span class="keyword">struct </span>target_desc *tdesc = info.<a class="code" href="structgdbarch__info.html#ac92a2218499c8147be64826e303d688e">target_desc</a>;
<a name="l01185"></a>01185   <span class="keywordtype">int</span> has_gp = 0;
<a name="l01186"></a>01186 
<a name="l01187"></a>01187   <span class="comment">/* Check any target description for validity.  */</span>
<a name="l01188"></a>01188   <span class="keywordflow">if</span> (<a class="code" href="target-descriptions_8c.html#a54a8994f193cc0a0cf6dbb6d771becf2">tdesc_has_registers</a> (tdesc))
<a name="l01189"></a>01189     {
<a name="l01190"></a>01190       <span class="keyword">const</span> <span class="keyword">struct </span>tdesc_feature *feature;
<a name="l01191"></a>01191       <span class="keywordtype">int</span> valid_p, i;
<a name="l01192"></a>01192 
<a name="l01193"></a>01193       feature = <a class="code" href="target-descriptions_8c.html#abc4d5a3eeb4bfc94bd14ac763516e938">tdesc_find_feature</a> (tdesc, <span class="stringliteral">&quot;org.gnu.gdb.tic6x.core&quot;</span>);
<a name="l01194"></a>01194 
<a name="l01195"></a>01195       <span class="keywordflow">if</span> (feature == NULL)
<a name="l01196"></a>01196         <span class="keywordflow">return</span> NULL;
<a name="l01197"></a>01197 
<a name="l01198"></a>01198       tdesc_data = <a class="code" href="target-descriptions_8c.html#ae51f8476cf65c9be4b3ed6a83aff1671">tdesc_data_alloc</a> ();
<a name="l01199"></a>01199 
<a name="l01200"></a>01200       valid_p = 1;
<a name="l01201"></a>01201       <span class="keywordflow">for</span> (i = 0; i &lt; 32; i++)  <span class="comment">/* A0 - A15, B0 - B15 */</span>
<a name="l01202"></a>01202         valid_p &amp;= <a class="code" href="target-descriptions_8c.html#a32eadffa81e6bfdd019d344e218f0e65">tdesc_numbered_register</a> (feature, tdesc_data, i,
<a name="l01203"></a>01203                                             tic6x_register_names[i]);
<a name="l01204"></a>01204 
<a name="l01205"></a>01205       <span class="comment">/* CSR */</span>
<a name="l01206"></a>01206       valid_p &amp;= <a class="code" href="target-descriptions_8c.html#a32eadffa81e6bfdd019d344e218f0e65">tdesc_numbered_register</a> (feature, tdesc_data, i++,
<a name="l01207"></a>01207                                           tic6x_register_names[<a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da60e479805f87ec4aeae587e827fccb26">TIC6X_CSR_REGNUM</a>]);
<a name="l01208"></a>01208       valid_p &amp;= <a class="code" href="target-descriptions_8c.html#a32eadffa81e6bfdd019d344e218f0e65">tdesc_numbered_register</a> (feature, tdesc_data, i++,
<a name="l01209"></a>01209                                           tic6x_register_names[<a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13dad84f8317e56046c7df78ff9ec4469eee">TIC6X_PC_REGNUM</a>]);
<a name="l01210"></a>01210 
<a name="l01211"></a>01211       <span class="keywordflow">if</span> (!valid_p)
<a name="l01212"></a>01212         {
<a name="l01213"></a>01213           <a class="code" href="target-descriptions_8c.html#a873586b621fb2a8ab911f5506cfd9bc7">tdesc_data_cleanup</a> (tdesc_data);
<a name="l01214"></a>01214           <span class="keywordflow">return</span> NULL;
<a name="l01215"></a>01215         }
<a name="l01216"></a>01216 
<a name="l01217"></a>01217       feature = <a class="code" href="target-descriptions_8c.html#abc4d5a3eeb4bfc94bd14ac763516e938">tdesc_find_feature</a> (tdesc, <span class="stringliteral">&quot;org.gnu.gdb.tic6x.gp&quot;</span>);
<a name="l01218"></a>01218       <span class="keywordflow">if</span> (feature)
<a name="l01219"></a>01219         {
<a name="l01220"></a>01220           <span class="keywordtype">int</span> j = 0;
<a name="l01221"></a>01221           <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> gp[] =
<a name="l01222"></a>01222             {
<a name="l01223"></a>01223               <span class="stringliteral">&quot;A16&quot;</span>, <span class="stringliteral">&quot;A17&quot;</span>, <span class="stringliteral">&quot;A18&quot;</span>, <span class="stringliteral">&quot;A19&quot;</span>, <span class="stringliteral">&quot;A20&quot;</span>, <span class="stringliteral">&quot;A21&quot;</span>, <span class="stringliteral">&quot;A22&quot;</span>, <span class="stringliteral">&quot;A23&quot;</span>,
<a name="l01224"></a>01224               <span class="stringliteral">&quot;A24&quot;</span>, <span class="stringliteral">&quot;A25&quot;</span>, <span class="stringliteral">&quot;A26&quot;</span>, <span class="stringliteral">&quot;A27&quot;</span>, <span class="stringliteral">&quot;A28&quot;</span>, <span class="stringliteral">&quot;A29&quot;</span>, <span class="stringliteral">&quot;A30&quot;</span>, <span class="stringliteral">&quot;A31&quot;</span>,
<a name="l01225"></a>01225               <span class="stringliteral">&quot;B16&quot;</span>, <span class="stringliteral">&quot;B17&quot;</span>, <span class="stringliteral">&quot;B18&quot;</span>, <span class="stringliteral">&quot;B19&quot;</span>, <span class="stringliteral">&quot;B20&quot;</span>, <span class="stringliteral">&quot;B21&quot;</span>, <span class="stringliteral">&quot;B22&quot;</span>, <span class="stringliteral">&quot;B23&quot;</span>,
<a name="l01226"></a>01226               <span class="stringliteral">&quot;B24&quot;</span>, <span class="stringliteral">&quot;B25&quot;</span>, <span class="stringliteral">&quot;B26&quot;</span>, <span class="stringliteral">&quot;B27&quot;</span>, <span class="stringliteral">&quot;B28&quot;</span>, <span class="stringliteral">&quot;B29&quot;</span>, <span class="stringliteral">&quot;B30&quot;</span>, <span class="stringliteral">&quot;B31&quot;</span>,
<a name="l01227"></a>01227             };
<a name="l01228"></a>01228 
<a name="l01229"></a>01229           has_gp = 1;
<a name="l01230"></a>01230           valid_p = 1;
<a name="l01231"></a>01231           <span class="keywordflow">for</span> (j = 0; j &lt; 32; j++)      <span class="comment">/* A16 - A31, B16 - B31 */</span>
<a name="l01232"></a>01232             valid_p &amp;= <a class="code" href="target-descriptions_8c.html#a32eadffa81e6bfdd019d344e218f0e65">tdesc_numbered_register</a> (feature, tdesc_data, i++,
<a name="l01233"></a>01233                                                 gp[j]);
<a name="l01234"></a>01234 
<a name="l01235"></a>01235           <span class="keywordflow">if</span> (!valid_p)
<a name="l01236"></a>01236             {
<a name="l01237"></a>01237               <a class="code" href="target-descriptions_8c.html#a873586b621fb2a8ab911f5506cfd9bc7">tdesc_data_cleanup</a> (tdesc_data);
<a name="l01238"></a>01238               <span class="keywordflow">return</span> NULL;
<a name="l01239"></a>01239             }
<a name="l01240"></a>01240         }
<a name="l01241"></a>01241 
<a name="l01242"></a>01242       feature = <a class="code" href="target-descriptions_8c.html#abc4d5a3eeb4bfc94bd14ac763516e938">tdesc_find_feature</a> (tdesc, <span class="stringliteral">&quot;org.gnu.gdb.tic6x.c6xp&quot;</span>);
<a name="l01243"></a>01243       <span class="keywordflow">if</span> (feature)
<a name="l01244"></a>01244         {
<a name="l01245"></a>01245           valid_p &amp;= <a class="code" href="target-descriptions_8c.html#a32eadffa81e6bfdd019d344e218f0e65">tdesc_numbered_register</a> (feature, tdesc_data, i++, <span class="stringliteral">&quot;TSR&quot;</span>);
<a name="l01246"></a>01246           valid_p &amp;= <a class="code" href="target-descriptions_8c.html#a32eadffa81e6bfdd019d344e218f0e65">tdesc_numbered_register</a> (feature, tdesc_data, i++, <span class="stringliteral">&quot;ILC&quot;</span>);
<a name="l01247"></a>01247           valid_p &amp;= <a class="code" href="target-descriptions_8c.html#a32eadffa81e6bfdd019d344e218f0e65">tdesc_numbered_register</a> (feature, tdesc_data, i++, <span class="stringliteral">&quot;RILC&quot;</span>);
<a name="l01248"></a>01248 
<a name="l01249"></a>01249           <span class="keywordflow">if</span> (!valid_p)
<a name="l01250"></a>01250             {
<a name="l01251"></a>01251               <a class="code" href="target-descriptions_8c.html#a873586b621fb2a8ab911f5506cfd9bc7">tdesc_data_cleanup</a> (tdesc_data);
<a name="l01252"></a>01252               <span class="keywordflow">return</span> NULL;
<a name="l01253"></a>01253             }
<a name="l01254"></a>01254         }
<a name="l01255"></a>01255 
<a name="l01256"></a>01256     }
<a name="l01257"></a>01257 
<a name="l01258"></a>01258   <span class="comment">/* Find a candidate among extant architectures.  */</span>
<a name="l01259"></a>01259   <span class="keywordflow">for</span> (arches = <a class="code" href="gdbarch_8c.html#aa3ea1c25a21a533dfd0d924a7d9778e4">gdbarch_list_lookup_by_info</a> (arches, &amp;info);
<a name="l01260"></a>01260        arches != NULL;
<a name="l01261"></a>01261        arches = <a class="code" href="gdbarch_8c.html#aa3ea1c25a21a533dfd0d924a7d9778e4">gdbarch_list_lookup_by_info</a> (arches-&gt;<a class="code" href="structgdbarch__list.html#a9da6f84112797b67d5d8e7b8d4e26b14">next</a>, &amp;info))
<a name="l01262"></a>01262     {
<a name="l01263"></a>01263       tdep = <a class="code" href="gdbarch_8c.html#acea996b7421706849bc20567695b5b31">gdbarch_tdep</a> (arches-&gt;<a class="code" href="structgdbarch__list.html#a6c51da8c4c95249704dfe18394fd08f9">gdbarch</a>);
<a name="l01264"></a>01264 
<a name="l01265"></a>01265       <span class="keywordflow">if</span> (has_gp != tdep-&gt;<a class="code" href="structgdbarch__tdep.html#ae4ba4956dc4404f1b452f798748c6722">has_gp</a>)
<a name="l01266"></a>01266         <span class="keywordflow">continue</span>;
<a name="l01267"></a>01267 
<a name="l01268"></a>01268       <span class="keywordflow">if</span> (tdep &amp;&amp; tdep-&gt;<a class="code" href="structgdbarch__tdep.html#ab28b724e73850514d5ebbed1e02f2137">breakpoint</a>)
<a name="l01269"></a>01269         <span class="keywordflow">return</span> arches-&gt;<a class="code" href="structgdbarch__list.html#a6c51da8c4c95249704dfe18394fd08f9">gdbarch</a>;
<a name="l01270"></a>01270     }
<a name="l01271"></a>01271 
<a name="l01272"></a>01272   tdep = <a class="code" href="common-utils_8c.html#a05a0a3435b91a07d6cc1a0b4c8788a4d">xcalloc</a> (1, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structgdbarch__tdep.html">gdbarch_tdep</a>));
<a name="l01273"></a>01273 
<a name="l01274"></a>01274   tdep-&gt;<a class="code" href="structgdbarch__tdep.html#ae4ba4956dc4404f1b452f798748c6722">has_gp</a> = has_gp;
<a name="l01275"></a>01275   gdbarch = <a class="code" href="gdbarch_8c.html#a9e0b0979fa2cb7439f41f66deda8dec5">gdbarch_alloc</a> (&amp;info, tdep);
<a name="l01276"></a>01276 
<a name="l01277"></a>01277   <span class="comment">/* Data type sizes.  */</span>
<a name="l01278"></a>01278   <a class="code" href="gdbarch_8c.html#abaaa21a756f3f8a689513c6df8b47ced">set_gdbarch_ptr_bit</a> (gdbarch, 32);
<a name="l01279"></a>01279   <a class="code" href="gdbarch_8c.html#a028fd40e003f89fcf02d7c2f9335b6ad">set_gdbarch_addr_bit</a> (gdbarch, 32);
<a name="l01280"></a>01280   <a class="code" href="gdbarch_8c.html#aa8ab344aebdb71839678ff3d3e248f9b">set_gdbarch_short_bit</a> (gdbarch, 16);
<a name="l01281"></a>01281   <a class="code" href="gdbarch_8c.html#a4dbde89c15b9ee9f1808a4e01f2a758d">set_gdbarch_int_bit</a> (gdbarch, 32);
<a name="l01282"></a>01282   <a class="code" href="gdbarch_8c.html#ab661d4332c2357c6242d5f3f57f1bc44">set_gdbarch_long_bit</a> (gdbarch, 32);
<a name="l01283"></a>01283   <a class="code" href="gdbarch_8c.html#a00b33f93ffedea6960d0ed4a9d7e1fba">set_gdbarch_long_long_bit</a> (gdbarch, 64);
<a name="l01284"></a>01284   <a class="code" href="gdbarch_8c.html#aa04e7a5715ca0c94652f8d35f44411f7">set_gdbarch_float_bit</a> (gdbarch, 32);
<a name="l01285"></a>01285   <a class="code" href="gdbarch_8c.html#a6dde6fbd6439a96136e99bed4a7d98cd">set_gdbarch_double_bit</a> (gdbarch, 64);
<a name="l01286"></a>01286 
<a name="l01287"></a>01287   <a class="code" href="gdbarch_8c.html#af3d3823011ac395f80e7f616ba59d252">set_gdbarch_float_format</a> (gdbarch, <a class="code" href="gdbtypes_8c.html#a2fcc5f34f85af43cce0eb78225fd2a11">floatformats_ieee_single</a>);
<a name="l01288"></a>01288   <a class="code" href="gdbarch_8c.html#aeda072f3599a56ad1fdfe82f4c99f1f8">set_gdbarch_double_format</a> (gdbarch, <a class="code" href="gdbtypes_8c.html#ab5eaf32f7eeeb57f880c28ff0d7544ae">floatformats_ieee_double</a>);
<a name="l01289"></a>01289 
<a name="l01290"></a>01290   <span class="comment">/* The register set.  */</span>
<a name="l01291"></a>01291   <a class="code" href="gdbarch_8c.html#ad8417c5d66cf04d0587f58f82de94c48">set_gdbarch_num_regs</a> (gdbarch, <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13daaad379185e14e5dfadaff621839f9b44">TIC6X_NUM_REGS</a>);
<a name="l01292"></a>01292   <a class="code" href="gdbarch_8c.html#a81a92a88a67093d18e59fd5650fda352">set_gdbarch_sp_regnum</a> (gdbarch, <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13da5da070e8fd88704a05f42848c2060587">TIC6X_SP_REGNUM</a>);
<a name="l01293"></a>01293   <a class="code" href="gdbarch_8c.html#a8852f70e2afc74953a57521ed08a3381">set_gdbarch_pc_regnum</a> (gdbarch, <a class="code" href="tic6x-tdep_8h.html#a1812ab31015cef0a41c6d4f3ae07f13dad84f8317e56046c7df78ff9ec4469eee">TIC6X_PC_REGNUM</a>);
<a name="l01294"></a>01294 
<a name="l01295"></a>01295   <a class="code" href="gdbarch_8c.html#a378ba40a6275393e204873c5bba602ad">set_gdbarch_register_name</a> (gdbarch, tic6x_register_name);
<a name="l01296"></a>01296   <a class="code" href="gdbarch_8c.html#a21919f6adfae80ed36e69e89cdfea531">set_gdbarch_register_type</a> (gdbarch, tic6x_register_type);
<a name="l01297"></a>01297 
<a name="l01298"></a>01298   <a class="code" href="gdbarch_8c.html#ad66381ed135b13aa5635f0485211ca71">set_gdbarch_inner_than</a> (gdbarch, <a class="code" href="arch-utils_8c.html#aaceae1c07203f3091df647f813b9f20e">core_addr_lessthan</a>);
<a name="l01299"></a>01299 
<a name="l01300"></a>01300   <a class="code" href="gdbarch_8c.html#a841509ae0070f2f12aa9b3b7fd52b92f">set_gdbarch_skip_prologue</a> (gdbarch, tic6x_skip_prologue);
<a name="l01301"></a>01301   <a class="code" href="gdbarch_8c.html#ad738cdf37fa27f4cf3642107cadf61d3">set_gdbarch_breakpoint_from_pc</a> (gdbarch, tic6x_breakpoint_from_pc);
<a name="l01302"></a>01302 
<a name="l01303"></a>01303   <a class="code" href="gdbarch_8c.html#a1974f5f26c09a4cd32165286c3769621">set_gdbarch_unwind_pc</a> (gdbarch, tic6x_unwind_pc);
<a name="l01304"></a>01304   <a class="code" href="gdbarch_8c.html#ababd871cc4b5fac1831e52f7331d7572">set_gdbarch_unwind_sp</a> (gdbarch, tic6x_unwind_sp);
<a name="l01305"></a>01305 
<a name="l01306"></a>01306   <span class="comment">/* Unwinding.  */</span>
<a name="l01307"></a>01307   <a class="code" href="dwarf2-frame_8c.html#ab2a0a14bba7f1db72907039eb3356975">dwarf2_append_unwinders</a> (gdbarch);
<a name="l01308"></a>01308 
<a name="l01309"></a>01309   <a class="code" href="frame-unwind_8c.html#afa4de8a130514bfd524d46f32e35a534">frame_unwind_append_unwinder</a> (gdbarch, &amp;tic6x_stub_unwind);
<a name="l01310"></a>01310   <a class="code" href="frame-unwind_8c.html#afa4de8a130514bfd524d46f32e35a534">frame_unwind_append_unwinder</a> (gdbarch, &amp;tic6x_frame_unwind);
<a name="l01311"></a>01311 
<a name="l01312"></a>01312   <a class="code" href="dwarf2-frame_8c.html#ad49836c98fc45f9fde8518a0f599aff0">dwarf2_frame_set_init_reg</a> (gdbarch, tic6x_dwarf2_frame_init_reg);
<a name="l01313"></a>01313 
<a name="l01314"></a>01314   <span class="comment">/* Single stepping.  */</span>
<a name="l01315"></a>01315   <a class="code" href="gdbarch_8c.html#a3ef5204e360b0a4ef1d162945911c403">set_gdbarch_software_single_step</a> (gdbarch, tic6x_software_single_step);
<a name="l01316"></a>01316 
<a name="l01317"></a>01317   <a class="code" href="gdbarch_8c.html#a0c9e9e391e44d476b74debefc407e9bb">set_gdbarch_print_insn</a> (gdbarch, tic6x_print_insn);
<a name="l01318"></a>01318 
<a name="l01319"></a>01319   <span class="comment">/* Call dummy code.  */</span>
<a name="l01320"></a>01320   <a class="code" href="gdbarch_8c.html#aff48f6a8b2982831522fc7b3af596654">set_gdbarch_frame_align</a> (gdbarch, tic6x_frame_align);
<a name="l01321"></a>01321 
<a name="l01322"></a>01322   <a class="code" href="gdbarch_8c.html#ad9b13a9323cac027c4b805953b4fff63">set_gdbarch_return_value</a> (gdbarch, tic6x_return_value);
<a name="l01323"></a>01323 
<a name="l01324"></a>01324   <a class="code" href="gdbarch_8c.html#a23da982924f904d22d0b58639a48bccf">set_gdbarch_dummy_id</a> (gdbarch, tic6x_dummy_id);
<a name="l01325"></a>01325 
<a name="l01326"></a>01326   <span class="comment">/* Enable inferior call support.  */</span>
<a name="l01327"></a>01327   <a class="code" href="gdbarch_8c.html#a853528dceff46211c1bb8c57b77dca31">set_gdbarch_push_dummy_call</a> (gdbarch, tic6x_push_dummy_call);
<a name="l01328"></a>01328 
<a name="l01329"></a>01329   <a class="code" href="gdbarch_8c.html#ae8e313db3a0bf29bc29ab4173b6d4418">set_gdbarch_get_longjmp_target</a> (gdbarch, tic6x_get_longjmp_target);
<a name="l01330"></a>01330 
<a name="l01331"></a>01331   <a class="code" href="gdbarch_8c.html#ab1ffbc0d23252e88823c50139b8464fb">set_gdbarch_in_function_epilogue_p</a> (gdbarch, tic6x_in_function_epilogue_p);
<a name="l01332"></a>01332 
<a name="l01333"></a>01333   <a class="code" href="gdbarch_8c.html#a4162f4419433b9b02990dffc2051a0d7">set_gdbarch_return_in_first_hidden_param_p</a> (gdbarch,
<a name="l01334"></a>01334                                               tic6x_return_in_first_hidden_param_p);
<a name="l01335"></a>01335 
<a name="l01336"></a>01336   <span class="comment">/* Hook in ABI-specific overrides, if they have been registered.  */</span>
<a name="l01337"></a>01337   <a class="code" href="osabi_8c.html#a38a6d312b216043e2dc48d1ada09035b">gdbarch_init_osabi</a> (info, gdbarch);
<a name="l01338"></a>01338 
<a name="l01339"></a>01339   <span class="keywordflow">if</span> (tdesc_data)
<a name="l01340"></a>01340     <a class="code" href="target-descriptions_8c.html#a6e7158d012f081cc038d2b5b1b0830ee">tdesc_use_registers</a> (gdbarch, tdesc, tdesc_data);
<a name="l01341"></a>01341 
<a name="l01342"></a>01342   <span class="keywordflow">return</span> gdbarch;
<a name="l01343"></a>01343 }
<a name="l01344"></a>01344 
<a name="l01345"></a>01345 <span class="comment">/* -Wmissing-prototypes */</span>
<a name="l01346"></a>01346 <span class="keyword">extern</span> <a class="code" href="defs_8h.html#a686ed07d4fdcdc366f2bc677216ca08d">initialize_file_ftype</a> <a class="code" href="tic6x-tdep_8c.html#a9021a73cee78632444b81e15b8487f9e">_initialize_tic6x_tdep</a>;
<a name="l01347"></a>01347 
<a name="l01348"></a>01348 <span class="keywordtype">void</span>
<a name="l01349"></a><a class="code" href="tic6x-tdep_8c.html#a0f8077e83ea58075d85401a055dbf4a7">01349</a> _initialize_tic6x_tdep (<span class="keywordtype">void</span>)
<a name="l01350"></a>01350 {
<a name="l01351"></a>01351   <a class="code" href="gdbarch_8c.html#adb96505b62850783929ff38de0c39062">register_gdbarch_init</a> (bfd_arch_tic6x, tic6x_gdbarch_init);
<a name="l01352"></a>01352 
<a name="l01353"></a>01353   initialize_tdesc_tic6x_c64xp ();
<a name="l01354"></a>01354   initialize_tdesc_tic6x_c64x ();
<a name="l01355"></a>01355   initialize_tdesc_tic6x_c62x ();
<a name="l01356"></a>01356 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Fri Oct 11 2013 14:12:26 for GDB (API) by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
