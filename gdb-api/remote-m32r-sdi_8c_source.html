<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>GDB (API): /home/stan/gdb/src/gdb/remote-m32r-sdi.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">GDB (API)
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">/home/stan/gdb/src/gdb/remote-m32r-sdi.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="remote-m32r-sdi_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* Remote debugging interface for M32R/SDI.</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">   Copyright (C) 2003-2013 Free Software Foundation, Inc.</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">   Contributed by Renesas Technology Co.</span>
<a name="l00006"></a>00006 <span class="comment">   Written by Kei Sakamoto &lt;sakamoto.kei@renesas.com&gt;.</span>
<a name="l00007"></a>00007 <span class="comment"></span>
<a name="l00008"></a>00008 <span class="comment">   This file is part of GDB.</span>
<a name="l00009"></a>00009 <span class="comment"></span>
<a name="l00010"></a>00010 <span class="comment">   This program is free software; you can redistribute it and/or modify</span>
<a name="l00011"></a>00011 <span class="comment">   it under the terms of the GNU General Public License as published by</span>
<a name="l00012"></a>00012 <span class="comment">   the Free Software Foundation; either version 3 of the License, or</span>
<a name="l00013"></a>00013 <span class="comment">   (at your option) any later version.</span>
<a name="l00014"></a>00014 <span class="comment"></span>
<a name="l00015"></a>00015 <span class="comment">   This program is distributed in the hope that it will be useful,</span>
<a name="l00016"></a>00016 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00017"></a>00017 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00018"></a>00018 <span class="comment">   GNU General Public License for more details.</span>
<a name="l00019"></a>00019 <span class="comment"></span>
<a name="l00020"></a>00020 <span class="comment">   You should have received a copy of the GNU General Public License</span>
<a name="l00021"></a>00021 <span class="comment">   along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.  */</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="defs_8h.html">defs.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="gdbcmd_8h.html">gdbcmd.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="gdbcore_8h.html">gdbcore.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="inferior_8h.html">inferior.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="target_8h.html">target.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="regcache_8h.html">regcache.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="gdb__string_8h.html">gdb_string.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="gdbthread_8h.html">gdbthread.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;signal.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#ifdef __MINGW32__</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span><span class="preprocessor">#include &lt;winsock2.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#else</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span><span class="preprocessor">#include &lt;netinet/in.h&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#endif</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span><span class="preprocessor">#include &lt;sys/types.h&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;sys/time.h&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;signal.h&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;time.h&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="gdb__bfd_8h.html">gdb_bfd.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="cli-utils_8h.html">cli/cli-utils.h</a>&quot;</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="serial_8h.html">serial.h</a>&quot;</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="comment">/* Descriptor for I/O to remote machine.  */</span>
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structserial.html">serial</a> *sdi_desc = NULL;
<a name="l00050"></a>00050 
<a name="l00051"></a><a class="code" href="remote-m32r-sdi_8c.html#afdfc7e62456a50146cda3faaa6ba3cd3">00051</a> <span class="preprocessor">#define SDI_TIMEOUT 30</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span>
<a name="l00053"></a>00053 
<a name="l00054"></a><a class="code" href="remote-m32r-sdi_8c.html#a652f1d270ab72ff5714a177179775452">00054</a> <span class="preprocessor">#define SDIPORT 3232</span>
<a name="l00055"></a>00055 <span class="preprocessor"></span>
<a name="l00056"></a>00056 <span class="keyword">static</span> <span class="keywordtype">char</span> chip_name[64];
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="keyword">static</span> <span class="keywordtype">int</span> step_mode;
<a name="l00059"></a>00059 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> last_pc_addr = 0xffffffff;
<a name="l00060"></a>00060 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> last_pc_addr_data[2];
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 <span class="keyword">static</span> <span class="keywordtype">int</span> mmu_on = 0;
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="keyword">static</span> <span class="keywordtype">int</span> use_ib_breakpoints = 1;
<a name="l00065"></a>00065 
<a name="l00066"></a><a class="code" href="remote-m32r-sdi_8c.html#a996fc495c80dc29ca7641d887ae4a462">00066</a> <span class="preprocessor">#define MAX_BREAKPOINTS 1024</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">int</span> max_ib_breakpoints;
<a name="l00068"></a>00068 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> bp_address[<a class="code" href="remote-m32r-sdi_8c.html#a996fc495c80dc29ca7641d887ae4a462">MAX_BREAKPOINTS</a>];
<a name="l00069"></a>00069 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> bp_data[<a class="code" href="remote-m32r-sdi_8c.html#a996fc495c80dc29ca7641d887ae4a462">MAX_BREAKPOINTS</a>][4];
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 <span class="comment">/* dbt -&gt; nop */</span>
<a name="l00072"></a>00072 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> dbt_bp_entry[] = {
<a name="l00073"></a>00073   0x10, 0xe0, 0x70, 0x00
<a name="l00074"></a>00074 };
<a name="l00075"></a>00075 
<a name="l00076"></a><a class="code" href="remote-m32r-sdi_8c.html#ab1669bf63379062035a09b3ad864a201">00076</a> <span class="preprocessor">#define MAX_ACCESS_BREAKS 4</span>
<a name="l00077"></a>00077 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">int</span> max_access_breaks;
<a name="l00078"></a>00078 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ab_address[<a class="code" href="remote-m32r-sdi_8c.html#ab1669bf63379062035a09b3ad864a201">MAX_ACCESS_BREAKS</a>];
<a name="l00079"></a>00079 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ab_type[<a class="code" href="remote-m32r-sdi_8c.html#ab1669bf63379062035a09b3ad864a201">MAX_ACCESS_BREAKS</a>];
<a name="l00080"></a>00080 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ab_size[<a class="code" href="remote-m32r-sdi_8c.html#ab1669bf63379062035a09b3ad864a201">MAX_ACCESS_BREAKS</a>];
<a name="l00081"></a>00081 <span class="keyword">static</span> <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> hit_watchpoint_addr = 0;
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 <span class="keyword">static</span> <span class="keywordtype">int</span> interrupted = 0;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 <span class="comment">/* Forward data declarations */</span>
<a name="l00086"></a>00086 <span class="keyword">extern</span> <span class="keyword">struct </span><a class="code" href="structtarget__ops.html">target_ops</a> <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>;
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 <span class="comment">/* This is the ptid we use while we&#39;re connected to the remote.  Its</span>
<a name="l00089"></a>00089 <span class="comment">   value is arbitrary, as the target doesn&#39;t have a notion of</span>
<a name="l00090"></a>00090 <span class="comment">   processes or threads, but we need something non-null to place in</span>
<a name="l00091"></a>00091 <span class="comment">   inferior_ptid.  */</span>
<a name="l00092"></a>00092 <span class="keyword">static</span> <a class="code" href="structptid.html">ptid_t</a> remote_m32r_ptid;
<a name="l00093"></a>00093 
<a name="l00094"></a>00094 <span class="comment">/* Commands */</span>
<a name="l00095"></a><a class="code" href="remote-m32r-sdi_8c.html#a09d29b793e527030b3c4760407c1e0a6">00095</a> <span class="preprocessor">#define SDI_OPEN                 1</span>
<a name="l00096"></a><a class="code" href="remote-m32r-sdi_8c.html#a6bfb52a39ec33487fdd1ba1ce9d398eb">00096</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_CLOSE                2</span>
<a name="l00097"></a><a class="code" href="remote-m32r-sdi_8c.html#ad46f40bb49c48ebb263c2a8e4996e769">00097</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_RELEASE              3</span>
<a name="l00098"></a><a class="code" href="remote-m32r-sdi_8c.html#a7bdb53a493108e405c091d8ee167fc5e">00098</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_READ_CPU_REG         4</span>
<a name="l00099"></a><a class="code" href="remote-m32r-sdi_8c.html#a78d1521eda3d95caf7e41c9cf8f3ea8c">00099</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_WRITE_CPU_REG        5</span>
<a name="l00100"></a><a class="code" href="remote-m32r-sdi_8c.html#ab11af9ddf5e11a8f0a495b2b5ca79b79">00100</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_READ_MEMORY          6</span>
<a name="l00101"></a><a class="code" href="remote-m32r-sdi_8c.html#a93dd7f491f7a7ac6206d79a4dd73f58b">00101</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_WRITE_MEMORY         7</span>
<a name="l00102"></a><a class="code" href="remote-m32r-sdi_8c.html#a4f0ed7542c1906c14f57d942cc6861f4">00102</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_EXEC_CPU             8</span>
<a name="l00103"></a><a class="code" href="remote-m32r-sdi_8c.html#a82ef2d0cc2b6e09224ef91fe77aeeb0d">00103</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_STOP_CPU             9</span>
<a name="l00104"></a><a class="code" href="remote-m32r-sdi_8c.html#a9cd0773f11bab2fc3d7eb6754591a80b">00104</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_WAIT_FOR_READY      10</span>
<a name="l00105"></a><a class="code" href="remote-m32r-sdi_8c.html#a335387926a99717d366e3fc13c9c2311">00105</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_GET_ATTR            11</span>
<a name="l00106"></a><a class="code" href="remote-m32r-sdi_8c.html#a6e5ba87568bbcad7b88276891f172bcf">00106</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_SET_ATTR            12</span>
<a name="l00107"></a><a class="code" href="remote-m32r-sdi_8c.html#ad41dfe3bbe34b7ea026924e0af6c1122">00107</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_STATUS              13</span>
<a name="l00108"></a>00108 <span class="preprocessor"></span>
<a name="l00109"></a>00109 <span class="comment">/* Attributes */</span>
<a name="l00110"></a><a class="code" href="remote-m32r-sdi_8c.html#a6f7ae1a43941b618b5eb24a00d0652dc">00110</a> <span class="preprocessor">#define SDI_ATTR_NAME            1</span>
<a name="l00111"></a><a class="code" href="remote-m32r-sdi_8c.html#ae0fe8df15a37ed3533391b8d9b5c99d9">00111</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_ATTR_BRK             2</span>
<a name="l00112"></a><a class="code" href="remote-m32r-sdi_8c.html#a9ba48fa1235a22a77bdcbad5328ec04a">00112</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_ATTR_ABRK            3</span>
<a name="l00113"></a><a class="code" href="remote-m32r-sdi_8c.html#a626490b9be4cce935dd5d3f6918baf56">00113</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_ATTR_CACHE           4</span>
<a name="l00114"></a><a class="code" href="remote-m32r-sdi_8c.html#adaf3360615f04eb741b5ba75238c073f">00114</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_CACHE_TYPE_M32102    0</span>
<a name="l00115"></a><a class="code" href="remote-m32r-sdi_8c.html#ad17fc003a1a88966a2906e59d3723015">00115</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_CACHE_TYPE_CHAOS     1</span>
<a name="l00116"></a><a class="code" href="remote-m32r-sdi_8c.html#ae7cab526bb346c03ae42a688ec190210">00116</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_ATTR_MEM_ACCESS      5</span>
<a name="l00117"></a><a class="code" href="remote-m32r-sdi_8c.html#a52f57dde885f964f491b82e1529f7702">00117</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_MEM_ACCESS_DEBUG_DMA 0</span>
<a name="l00118"></a><a class="code" href="remote-m32r-sdi_8c.html#af9b3c8ebf567a0edd6cbf3f37d654149">00118</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_MEM_ACCESS_MON_CODE  1</span>
<a name="l00119"></a>00119 <span class="preprocessor"></span>
<a name="l00120"></a>00120 <span class="comment">/* Registers */</span>
<a name="l00121"></a><a class="code" href="remote-m32r-sdi_8c.html#abe7721c1a21b9810430ce7825602cc83">00121</a> <span class="preprocessor">#define SDI_REG_R0               0</span>
<a name="l00122"></a><a class="code" href="remote-m32r-sdi_8c.html#a583bdf9f7040a1ce4f626cff7027f652">00122</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_R1               1</span>
<a name="l00123"></a><a class="code" href="remote-m32r-sdi_8c.html#ac4abc71284754daf11a1bae7ccd850e5">00123</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_R2               2</span>
<a name="l00124"></a><a class="code" href="remote-m32r-sdi_8c.html#a3da31e08fe0dc001eb2adb5728ca1d8c">00124</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_R3               3</span>
<a name="l00125"></a><a class="code" href="remote-m32r-sdi_8c.html#a121bdbacff15fb712f06c44eb2987434">00125</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_R4               4</span>
<a name="l00126"></a><a class="code" href="remote-m32r-sdi_8c.html#a9f514ec7777bbe0bd6cbff44f09ea547">00126</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_R5               5</span>
<a name="l00127"></a><a class="code" href="remote-m32r-sdi_8c.html#a2b21d8094ea1ba27877f438733679fe6">00127</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_R6               6</span>
<a name="l00128"></a><a class="code" href="remote-m32r-sdi_8c.html#a254440fad5e825036a2dc1c05ac27cc9">00128</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_R7               7</span>
<a name="l00129"></a><a class="code" href="remote-m32r-sdi_8c.html#aa2f47cbfc6bc31730563d31cf0c35f9f">00129</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_R8               8</span>
<a name="l00130"></a><a class="code" href="remote-m32r-sdi_8c.html#acf01d66f8e72c925e285097020d3ea9f">00130</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_R9               9</span>
<a name="l00131"></a><a class="code" href="remote-m32r-sdi_8c.html#a17e7f687773dba5ffaea7aa6923d4026">00131</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_R10             10</span>
<a name="l00132"></a><a class="code" href="remote-m32r-sdi_8c.html#a8986d9afd93523d754a3421e474a8ac4">00132</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_R11             11</span>
<a name="l00133"></a><a class="code" href="remote-m32r-sdi_8c.html#a564d6cba638b06189b2199b08dbaf1b7">00133</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_R12             12</span>
<a name="l00134"></a><a class="code" href="remote-m32r-sdi_8c.html#a95c67979e7779814d7f309059485d29e">00134</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_FP              13</span>
<a name="l00135"></a><a class="code" href="remote-m32r-sdi_8c.html#a045d3e5597ffb846f68218c6b77f1b97">00135</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_LR              14</span>
<a name="l00136"></a><a class="code" href="remote-m32r-sdi_8c.html#ae02651bb15b1998c7d0df30a4ca56e57">00136</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_SP              15</span>
<a name="l00137"></a><a class="code" href="remote-m32r-sdi_8c.html#a530a5a29c26a05d18d17a474bbe2eec3">00137</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_PSW             16</span>
<a name="l00138"></a><a class="code" href="remote-m32r-sdi_8c.html#a6850c794aa7e93be042b10ebb4c657b4">00138</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_CBR             17</span>
<a name="l00139"></a><a class="code" href="remote-m32r-sdi_8c.html#a1a6f8adb4aca346d430949f08bec8955">00139</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_SPI             18</span>
<a name="l00140"></a><a class="code" href="remote-m32r-sdi_8c.html#a9ff3936a7a2908ac310ee819d6bbab76">00140</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_SPU             19</span>
<a name="l00141"></a><a class="code" href="remote-m32r-sdi_8c.html#a20449bbf08241e476dd377fade25ec51">00141</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_CR4             20</span>
<a name="l00142"></a><a class="code" href="remote-m32r-sdi_8c.html#a2737e35c8b0c1bc09725e18d2e99203f">00142</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_EVB             21</span>
<a name="l00143"></a><a class="code" href="remote-m32r-sdi_8c.html#a02b4a6c0e3de771482cdb9e3d7de3278">00143</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_BPC             22</span>
<a name="l00144"></a><a class="code" href="remote-m32r-sdi_8c.html#a6a89ed1d30503b984e42550af2d5bb4c">00144</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_CR7             23</span>
<a name="l00145"></a><a class="code" href="remote-m32r-sdi_8c.html#ac8b8df23322fae346f1ad43d3e8d6f91">00145</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_BBPSW           24</span>
<a name="l00146"></a><a class="code" href="remote-m32r-sdi_8c.html#aff31799d24b6cb80d375cfa595812873">00146</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_CR9             25</span>
<a name="l00147"></a><a class="code" href="remote-m32r-sdi_8c.html#a28f7efe6dfb5facfd41eac57714a2ea1">00147</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_CR10            26</span>
<a name="l00148"></a><a class="code" href="remote-m32r-sdi_8c.html#ad8a73e939375d305ed2a7f71956d0f8e">00148</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_CR11            27</span>
<a name="l00149"></a><a class="code" href="remote-m32r-sdi_8c.html#a8efac3aa2963399087f4970bdb8c0794">00149</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_CR12            28</span>
<a name="l00150"></a><a class="code" href="remote-m32r-sdi_8c.html#a41be3a238651a0ba97005db3580a9ad0">00150</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_WR              29</span>
<a name="l00151"></a><a class="code" href="remote-m32r-sdi_8c.html#a6e896e6862a716fc10f8c8a8dff10ff8">00151</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_BBPC            30</span>
<a name="l00152"></a><a class="code" href="remote-m32r-sdi_8c.html#adf2023e70f49fb2e32c8c6d76559cbe5">00152</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_PBP             31</span>
<a name="l00153"></a><a class="code" href="remote-m32r-sdi_8c.html#af2390a8cb89c35873b31702aad1c5833">00153</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_ACCH            32</span>
<a name="l00154"></a><a class="code" href="remote-m32r-sdi_8c.html#aadcd70d0cead8f39eafb58bfe774b0e6">00154</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_ACCL            33</span>
<a name="l00155"></a><a class="code" href="remote-m32r-sdi_8c.html#a9e2c98f0ca5fc9bea839d79ffa104c46">00155</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_ACC1H           34</span>
<a name="l00156"></a><a class="code" href="remote-m32r-sdi_8c.html#a729edc8f869db32829daf59576963989">00156</a> <span class="preprocessor"></span><span class="preprocessor">#define SDI_REG_ACC1L           35</span>
<a name="l00157"></a>00157 <span class="preprocessor"></span>
<a name="l00158"></a>00158 
<a name="l00159"></a>00159 <span class="comment">/* Low level communication functions.  */</span>
<a name="l00160"></a>00160 
<a name="l00161"></a>00161 <span class="comment">/* Check an ack packet from the target.  */</span>
<a name="l00162"></a>00162 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00163"></a>00163 get_ack (<span class="keywordtype">void</span>)
<a name="l00164"></a>00164 {
<a name="l00165"></a>00165   <span class="keywordtype">int</span> c;
<a name="l00166"></a>00166 
<a name="l00167"></a>00167   <span class="keywordflow">if</span> (!sdi_desc)
<a name="l00168"></a>00168     <span class="keywordflow">return</span> -1;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170   c = <a class="code" href="serial_8c.html#aa36fd875c1c5bbb220faa370e965acd7">serial_readchar</a> (sdi_desc, <a class="code" href="remote-m32r-sdi_8c.html#afdfc7e62456a50146cda3faaa6ba3cd3">SDI_TIMEOUT</a>);
<a name="l00171"></a>00171 
<a name="l00172"></a>00172   <span class="keywordflow">if</span> (c &lt; 0)
<a name="l00173"></a>00173     <span class="keywordflow">return</span> -1;
<a name="l00174"></a>00174 
<a name="l00175"></a>00175   <span class="keywordflow">if</span> (c != <span class="charliteral">&#39;+&#39;</span>)                 <span class="comment">/* error */</span>
<a name="l00176"></a>00176     <span class="keywordflow">return</span> -1;
<a name="l00177"></a>00177 
<a name="l00178"></a>00178   <span class="keywordflow">return</span> 0;
<a name="l00179"></a>00179 }
<a name="l00180"></a>00180 
<a name="l00181"></a>00181 <span class="comment">/* Send data to the target and check an ack packet.  */</span>
<a name="l00182"></a>00182 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00183"></a>00183 send_data (<span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>)
<a name="l00184"></a>00184 {
<a name="l00185"></a>00185   <span class="keywordflow">if</span> (!sdi_desc)
<a name="l00186"></a>00186     <span class="keywordflow">return</span> -1;
<a name="l00187"></a>00187 
<a name="l00188"></a>00188   <span class="keywordflow">if</span> (<a class="code" href="serial_8c.html#a60477906c21a815cb7c71503e1acdc35">serial_write</a> (sdi_desc, buf, len) != 0)
<a name="l00189"></a>00189     <span class="keywordflow">return</span> -1;
<a name="l00190"></a>00190 
<a name="l00191"></a>00191   <span class="keywordflow">if</span> (get_ack () == -1)
<a name="l00192"></a>00192     <span class="keywordflow">return</span> -1;
<a name="l00193"></a>00193 
<a name="l00194"></a>00194   <span class="keywordflow">return</span> <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>;
<a name="l00195"></a>00195 }
<a name="l00196"></a>00196 
<a name="l00197"></a>00197 <span class="comment">/* Receive data from the target.  */</span>
<a name="l00198"></a>00198 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00199"></a>00199 recv_data (<span class="keywordtype">void</span> *buf, <span class="keywordtype">int</span> len)
<a name="l00200"></a>00200 {
<a name="l00201"></a>00201   <span class="keywordtype">int</span> total = 0;
<a name="l00202"></a>00202   <span class="keywordtype">int</span> c;
<a name="l00203"></a>00203 
<a name="l00204"></a>00204   <span class="keywordflow">if</span> (!sdi_desc)
<a name="l00205"></a>00205     <span class="keywordflow">return</span> -1;
<a name="l00206"></a>00206 
<a name="l00207"></a>00207   <span class="keywordflow">while</span> (total &lt; len)
<a name="l00208"></a>00208     {
<a name="l00209"></a>00209       c = <a class="code" href="serial_8c.html#aa36fd875c1c5bbb220faa370e965acd7">serial_readchar</a> (sdi_desc, <a class="code" href="remote-m32r-sdi_8c.html#afdfc7e62456a50146cda3faaa6ba3cd3">SDI_TIMEOUT</a>);
<a name="l00210"></a>00210 
<a name="l00211"></a>00211       <span class="keywordflow">if</span> (c &lt; 0)
<a name="l00212"></a>00212         <span class="keywordflow">return</span> -1;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214       ((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) buf)[total++] = c;
<a name="l00215"></a>00215     }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217   <span class="keywordflow">return</span> <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>;
<a name="l00218"></a>00218 }
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 <span class="comment">/* Store unsigned long parameter on packet.  */</span>
<a name="l00221"></a>00221 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00222"></a>00222 store_long_parameter (<span class="keywordtype">void</span> *buf, <span class="keywordtype">long</span> val)
<a name="l00223"></a>00223 {
<a name="l00224"></a>00224   val = htonl (val);
<a name="l00225"></a>00225   <a class="code" href="gdb__string_8h.html#a39ebe6a4e122707997e78b549a1e8c5e">memcpy</a> (buf, &amp;val, 4);
<a name="l00226"></a>00226 }
<a name="l00227"></a>00227 
<a name="l00228"></a>00228 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00229"></a>00229 send_cmd (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> cmd)
<a name="l00230"></a>00230 {
<a name="l00231"></a>00231   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buf[1];
<a name="l00232"></a>00232 
<a name="l00233"></a>00233   buf[0] = cmd;
<a name="l00234"></a>00234   <span class="keywordflow">return</span> send_data (buf, 1);
<a name="l00235"></a>00235 }
<a name="l00236"></a>00236 
<a name="l00237"></a>00237 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00238"></a>00238 send_one_arg_cmd (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> cmd, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> arg1)
<a name="l00239"></a>00239 {
<a name="l00240"></a>00240   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buf[2];
<a name="l00241"></a>00241 
<a name="l00242"></a>00242   buf[0] = cmd;
<a name="l00243"></a>00243   buf[1] = arg1;
<a name="l00244"></a>00244   <span class="keywordflow">return</span> send_data (buf, 2);
<a name="l00245"></a>00245 }
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00248"></a>00248 send_two_arg_cmd (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> cmd, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> arg1, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> arg2)
<a name="l00249"></a>00249 {
<a name="l00250"></a>00250   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buf[6];
<a name="l00251"></a>00251 
<a name="l00252"></a>00252   buf[0] = cmd;
<a name="l00253"></a>00253   buf[1] = arg1;
<a name="l00254"></a>00254   store_long_parameter (buf + 2, arg2);
<a name="l00255"></a>00255   <span class="keywordflow">return</span> send_data (buf, 6);
<a name="l00256"></a>00256 }
<a name="l00257"></a>00257 
<a name="l00258"></a>00258 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00259"></a>00259 send_three_arg_cmd (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> cmd, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> arg1, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> arg2,
<a name="l00260"></a>00260                     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> arg3)
<a name="l00261"></a>00261 {
<a name="l00262"></a>00262   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buf[13];
<a name="l00263"></a>00263 
<a name="l00264"></a>00264   buf[0] = cmd;
<a name="l00265"></a>00265   store_long_parameter (buf + 1, arg1);
<a name="l00266"></a>00266   store_long_parameter (buf + 5, arg2);
<a name="l00267"></a>00267   store_long_parameter (buf + 9, arg3);
<a name="l00268"></a>00268   <span class="keywordflow">return</span> send_data (buf, 13);
<a name="l00269"></a>00269 }
<a name="l00270"></a>00270 
<a name="l00271"></a>00271 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>
<a name="l00272"></a>00272 recv_char_data (<span class="keywordtype">void</span>)
<a name="l00273"></a>00273 {
<a name="l00274"></a>00274   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> val;
<a name="l00275"></a>00275 
<a name="l00276"></a>00276   recv_data (&amp;val, 1);
<a name="l00277"></a>00277   <span class="keywordflow">return</span> val;
<a name="l00278"></a>00278 }
<a name="l00279"></a>00279 
<a name="l00280"></a>00280 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>
<a name="l00281"></a>00281 recv_long_data (<span class="keywordtype">void</span>)
<a name="l00282"></a>00282 {
<a name="l00283"></a>00283   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> val;
<a name="l00284"></a>00284 
<a name="l00285"></a>00285   recv_data (&amp;val, 4);
<a name="l00286"></a>00286   <span class="keywordflow">return</span> ntohl (val);
<a name="l00287"></a>00287 }
<a name="l00288"></a>00288 
<a name="l00289"></a>00289 
<a name="l00290"></a>00290 <span class="comment">/* Check if MMU is on.  */</span>
<a name="l00291"></a>00291 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00292"></a>00292 check_mmu_status (<span class="keywordtype">void</span>)
<a name="l00293"></a>00293 {
<a name="l00294"></a>00294   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> val;
<a name="l00295"></a>00295 
<a name="l00296"></a>00296   <span class="comment">/* Read PC address.  */</span>
<a name="l00297"></a>00297   <span class="keywordflow">if</span> (send_one_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a7bdb53a493108e405c091d8ee167fc5e">SDI_READ_CPU_REG</a>, <a class="code" href="remote-m32r-sdi_8c.html#a02b4a6c0e3de771482cdb9e3d7de3278">SDI_REG_BPC</a>) == -1)
<a name="l00298"></a>00298     <span class="keywordflow">return</span>;
<a name="l00299"></a>00299   val = recv_long_data ();
<a name="l00300"></a>00300   <span class="keywordflow">if</span> ((val &amp; 0xc0000000) == 0x80000000)
<a name="l00301"></a>00301     {
<a name="l00302"></a>00302       mmu_on = 1;
<a name="l00303"></a>00303       <span class="keywordflow">return</span>;
<a name="l00304"></a>00304     }
<a name="l00305"></a>00305 
<a name="l00306"></a>00306   <span class="comment">/* Read EVB address.  */</span>
<a name="l00307"></a>00307   <span class="keywordflow">if</span> (send_one_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a7bdb53a493108e405c091d8ee167fc5e">SDI_READ_CPU_REG</a>, <a class="code" href="remote-m32r-sdi_8c.html#a2737e35c8b0c1bc09725e18d2e99203f">SDI_REG_EVB</a>) == -1)
<a name="l00308"></a>00308     <span class="keywordflow">return</span>;
<a name="l00309"></a>00309   val = recv_long_data ();
<a name="l00310"></a>00310   <span class="keywordflow">if</span> ((val &amp; 0xc0000000) == 0x80000000)
<a name="l00311"></a>00311     {
<a name="l00312"></a>00312       mmu_on = 1;
<a name="l00313"></a>00313       <span class="keywordflow">return</span>;
<a name="l00314"></a>00314     }
<a name="l00315"></a>00315 
<a name="l00316"></a>00316   mmu_on = 0;
<a name="l00317"></a>00317 }
<a name="l00318"></a>00318 
<a name="l00319"></a>00319 
<a name="l00320"></a>00320 <span class="comment">/* This is called not only when we first attach, but also when the</span>
<a name="l00321"></a>00321 <span class="comment">   user types &quot;run&quot; after having attached.  */</span>
<a name="l00322"></a>00322 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00323"></a>00323 m32r_create_inferior (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *ops, <span class="keywordtype">char</span> *execfile,
<a name="l00324"></a>00324                       <span class="keywordtype">char</span> *args, <span class="keywordtype">char</span> **env, <span class="keywordtype">int</span> from_tty)
<a name="l00325"></a>00325 {
<a name="l00326"></a>00326   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> entry_pt;
<a name="l00327"></a>00327 
<a name="l00328"></a>00328   <span class="keywordflow">if</span> (args &amp;&amp; *args)
<a name="l00329"></a>00329     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Cannot pass arguments to remote STDEBUG process&quot;</span>));
<a name="l00330"></a>00330 
<a name="l00331"></a>00331   <span class="keywordflow">if</span> (execfile == 0 || <a class="code" href="exec_8h.html#ac2e2e739fca42163e235e8521b9fbbab">exec_bfd</a> == 0)
<a name="l00332"></a>00332     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No executable file specified&quot;</span>));
<a name="l00333"></a>00333 
<a name="l00334"></a>00334   <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l00335"></a>00335     <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;m32r_create_inferior(%s,%s)\n&quot;</span>, execfile,
<a name="l00336"></a>00336                         args);
<a name="l00337"></a>00337 
<a name="l00338"></a>00338   entry_pt = bfd_get_start_address (<a class="code" href="exec_8h.html#ac2e2e739fca42163e235e8521b9fbbab">exec_bfd</a>);
<a name="l00339"></a>00339 
<a name="l00340"></a>00340   <span class="comment">/* The &quot;process&quot; (board) is already stopped awaiting our commands, and</span>
<a name="l00341"></a>00341 <span class="comment">     the program is already downloaded.  We just set its PC and go.  */</span>
<a name="l00342"></a>00342 
<a name="l00343"></a>00343   <a class="code" href="inferior_8h.html#a8c032d638c8cc6a62945a19c70a64f71">clear_proceed_status</a> ();
<a name="l00344"></a>00344 
<a name="l00345"></a>00345   <span class="comment">/* Tell wait_for_inferior that we&#39;ve started a new process.  */</span>
<a name="l00346"></a>00346   <a class="code" href="inferior_8h.html#ad001ef10c3482aa4407388402a065099">init_wait_for_inferior</a> ();
<a name="l00347"></a>00347 
<a name="l00348"></a>00348   <span class="comment">/* Set up the &quot;saved terminal modes&quot; of the inferior</span>
<a name="l00349"></a>00349 <span class="comment">     based on what modes we are starting it with.  */</span>
<a name="l00350"></a>00350   <a class="code" href="target_8h.html#abc203d114dec4f2b057c8e9f7a960461">target_terminal_init</a> ();
<a name="l00351"></a>00351 
<a name="l00352"></a>00352   <span class="comment">/* Install inferior&#39;s terminal modes.  */</span>
<a name="l00353"></a>00353   <a class="code" href="target_8c.html#aab397975a1893898dcd07c8ed9aca04c">target_terminal_inferior</a> ();
<a name="l00354"></a>00354 
<a name="l00355"></a>00355   <a class="code" href="regcache_8c.html#ab2bc5dc8948a1ae0b5efb4e2503375b8">regcache_write_pc</a> (<a class="code" href="regcache_8c.html#a09a386286dc22d882378f639630fecef">get_current_regcache</a> (), entry_pt);
<a name="l00356"></a>00356 }
<a name="l00357"></a>00357 
<a name="l00358"></a>00358 <span class="comment">/* Open a connection to a remote debugger.</span>
<a name="l00359"></a>00359 <span class="comment">   NAME is the filename used for communication.  */</span>
<a name="l00360"></a>00360 
<a name="l00361"></a>00361 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00362"></a>00362 m32r_open (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l00363"></a>00363 {
<a name="l00364"></a>00364   <span class="keyword">struct </span>hostent *host_ent;
<a name="l00365"></a>00365   <span class="keyword">struct </span>sockaddr_in server_addr;
<a name="l00366"></a>00366   <span class="keywordtype">char</span> *port_str, hostname[256];
<a name="l00367"></a>00367   <span class="keywordtype">int</span> port;
<a name="l00368"></a>00368   <span class="keywordtype">int</span> i, n;
<a name="l00369"></a>00369   <span class="keywordtype">int</span> <a class="code" href="inflow_8c.html#a83e8bc15645f9d99ab91a152bb3dc8ceaa447884a6b7ce069acc4b7eb98acdb92">yes</a> = 1;
<a name="l00370"></a>00370 
<a name="l00371"></a>00371   <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l00372"></a>00372     <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;m32r_open(%d)\n&quot;</span>, from_tty);
<a name="l00373"></a>00373 
<a name="l00374"></a>00374   <a class="code" href="target_8c.html#acc9e6257009bd3dd81f0577b44f924d9">target_preopen</a> (from_tty);
<a name="l00375"></a>00375 
<a name="l00376"></a>00376   <a class="code" href="target_8c.html#ada1b9dc1eeb0546d39b86ba7ac645e67">push_target</a> (&amp;<a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>);
<a name="l00377"></a>00377 
<a name="l00378"></a>00378   <span class="keywordflow">if</span> (args == NULL)
<a name="l00379"></a>00379     <a class="code" href="common-utils_8c.html#ad9940337ec98983dae9951c947879fc8">xsnprintf</a> (hostname, <span class="keyword">sizeof</span> (hostname), <span class="stringliteral">&quot;localhost:%d&quot;</span>, <a class="code" href="remote-m32r-sdi_8c.html#a652f1d270ab72ff5714a177179775452">SDIPORT</a>);
<a name="l00380"></a>00380   <span class="keywordflow">else</span>
<a name="l00381"></a>00381     {
<a name="l00382"></a>00382       port_str = <a class="code" href="gdb__string_8h.html#adf46aa8f2e08cfb505868bbfc88b5fd4">strchr</a> (args, <span class="charliteral">&#39;:&#39;</span>);
<a name="l00383"></a>00383       <span class="keywordflow">if</span> (port_str == NULL)
<a name="l00384"></a>00384         <a class="code" href="common-utils_8c.html#ad9940337ec98983dae9951c947879fc8">xsnprintf</a> (hostname, <span class="keyword">sizeof</span> (hostname), <span class="stringliteral">&quot;%s:%d&quot;</span>, args, <a class="code" href="remote-m32r-sdi_8c.html#a652f1d270ab72ff5714a177179775452">SDIPORT</a>);
<a name="l00385"></a>00385       <span class="keywordflow">else</span>
<a name="l00386"></a>00386         <a class="code" href="common-utils_8c.html#ad9940337ec98983dae9951c947879fc8">xsnprintf</a> (hostname, <span class="keyword">sizeof</span> (hostname), <span class="stringliteral">&quot;%s&quot;</span>, args);
<a name="l00387"></a>00387     }
<a name="l00388"></a>00388 
<a name="l00389"></a>00389   sdi_desc = <a class="code" href="serial_8c.html#add1271717237a2b567b09ca41495a665">serial_open</a> (hostname);
<a name="l00390"></a>00390   <span class="keywordflow">if</span> (!sdi_desc)
<a name="l00391"></a>00391     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Connection refused.&quot;</span>));
<a name="l00392"></a>00392 
<a name="l00393"></a>00393   <span class="keywordflow">if</span> (get_ack () == -1)
<a name="l00394"></a>00394     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Cannot connect to SDI target.&quot;</span>));
<a name="l00395"></a>00395 
<a name="l00396"></a>00396   <span class="keywordflow">if</span> (send_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a09d29b793e527030b3c4760407c1e0a6">SDI_OPEN</a>) == -1)
<a name="l00397"></a>00397     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Cannot connect to SDI target.&quot;</span>));
<a name="l00398"></a>00398 
<a name="l00399"></a>00399   <span class="comment">/* Get maximum number of ib breakpoints.  */</span>
<a name="l00400"></a>00400   send_one_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a335387926a99717d366e3fc13c9c2311">SDI_GET_ATTR</a>, <a class="code" href="remote-m32r-sdi_8c.html#ae0fe8df15a37ed3533391b8d9b5c99d9">SDI_ATTR_BRK</a>);
<a name="l00401"></a>00401   max_ib_breakpoints = recv_char_data ();
<a name="l00402"></a>00402   <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l00403"></a>00403     <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;Max IB Breakpoints = %d\n&quot;</span>, max_ib_breakpoints);
<a name="l00404"></a>00404 
<a name="l00405"></a>00405   <span class="comment">/* Initialize breakpoints.  */</span>
<a name="l00406"></a>00406   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="remote-m32r-sdi_8c.html#a996fc495c80dc29ca7641d887ae4a462">MAX_BREAKPOINTS</a>; i++)
<a name="l00407"></a>00407     bp_address[i] = 0xffffffff;
<a name="l00408"></a>00408 
<a name="l00409"></a>00409   <span class="comment">/* Get maximum number of access breaks.  */</span>
<a name="l00410"></a>00410   send_one_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a335387926a99717d366e3fc13c9c2311">SDI_GET_ATTR</a>, <a class="code" href="remote-m32r-sdi_8c.html#a9ba48fa1235a22a77bdcbad5328ec04a">SDI_ATTR_ABRK</a>);
<a name="l00411"></a>00411   max_access_breaks = recv_char_data ();
<a name="l00412"></a>00412   <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l00413"></a>00413     <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;Max Access Breaks = %d\n&quot;</span>, max_access_breaks);
<a name="l00414"></a>00414 
<a name="l00415"></a>00415   <span class="comment">/* Initialize access breask.  */</span>
<a name="l00416"></a>00416   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="remote-m32r-sdi_8c.html#ab1669bf63379062035a09b3ad864a201">MAX_ACCESS_BREAKS</a>; i++)
<a name="l00417"></a>00417     ab_address[i] = 0x00000000;
<a name="l00418"></a>00418 
<a name="l00419"></a>00419   check_mmu_status ();
<a name="l00420"></a>00420 
<a name="l00421"></a>00421   <span class="comment">/* Get the name of chip on target board.  */</span>
<a name="l00422"></a>00422   send_one_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a335387926a99717d366e3fc13c9c2311">SDI_GET_ATTR</a>, <a class="code" href="remote-m32r-sdi_8c.html#a6f7ae1a43941b618b5eb24a00d0652dc">SDI_ATTR_NAME</a>);
<a name="l00423"></a>00423   recv_data (chip_name, 64);
<a name="l00424"></a>00424 
<a name="l00425"></a>00425   <span class="keywordflow">if</span> (from_tty)
<a name="l00426"></a>00426     <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;Remote %s connected to %s\n&quot;</span>, <a class="code" href="target_8h.html#a82f16780537e85ac9b42873b0008108c">target_shortname</a>,
<a name="l00427"></a>00427                      chip_name);
<a name="l00428"></a>00428 }
<a name="l00429"></a>00429 
<a name="l00430"></a>00430 <span class="comment">/* Close out all files and local state before this target loses control.  */</span>
<a name="l00431"></a>00431 
<a name="l00432"></a>00432 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00433"></a>00433 m32r_close (<span class="keywordtype">void</span>)
<a name="l00434"></a>00434 {
<a name="l00435"></a>00435   <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l00436"></a>00436     <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;m32r_close()\n&quot;</span>);
<a name="l00437"></a>00437 
<a name="l00438"></a>00438   <span class="keywordflow">if</span> (sdi_desc)
<a name="l00439"></a>00439     {
<a name="l00440"></a>00440       send_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a6bfb52a39ec33487fdd1ba1ce9d398eb">SDI_CLOSE</a>);
<a name="l00441"></a>00441       <a class="code" href="serial_8c.html#af410650bb7861b7d6324f56da95b193a">serial_close</a> (sdi_desc);
<a name="l00442"></a>00442       sdi_desc = NULL;
<a name="l00443"></a>00443     }
<a name="l00444"></a>00444 
<a name="l00445"></a>00445   <a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a> = <a class="code" href="ptid_8c.html#acba69c857786546b204883bbcc90a64e">null_ptid</a>;
<a name="l00446"></a>00446   <a class="code" href="gdbthread_8h.html#af1d382a6b63612246df3963cb93c797d">delete_thread_silent</a> (remote_m32r_ptid);
<a name="l00447"></a>00447   <span class="keywordflow">return</span>;
<a name="l00448"></a>00448 }
<a name="l00449"></a>00449 
<a name="l00450"></a>00450 <span class="comment">/* Tell the remote machine to resume.  */</span>
<a name="l00451"></a>00451 
<a name="l00452"></a>00452 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00453"></a>00453 m32r_resume (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *ops,
<a name="l00454"></a>00454              <a class="code" href="structptid.html">ptid_t</a> <a class="code" href="structptid.html">ptid</a>, <span class="keywordtype">int</span> step, <span class="keyword">enum</span> <a class="code" href="signals_8h.html#a1169a44d7b94bdcf747c3f69138dafe7">gdb_signal</a> sig)
<a name="l00455"></a>00455 {
<a name="l00456"></a>00456   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> pc_addr, bp_addr, ab_addr;
<a name="l00457"></a>00457   <span class="keywordtype">int</span> ib_breakpoints;
<a name="l00458"></a>00458   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buf[13];
<a name="l00459"></a>00459   <span class="keywordtype">int</span> i;
<a name="l00460"></a>00460 
<a name="l00461"></a>00461   <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l00462"></a>00462     {
<a name="l00463"></a>00463       <span class="keywordflow">if</span> (step)
<a name="l00464"></a>00464         <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;\nm32r_resume(step)\n&quot;</span>);
<a name="l00465"></a>00465       <span class="keywordflow">else</span>
<a name="l00466"></a>00466         <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;\nm32r_resume(cont)\n&quot;</span>);
<a name="l00467"></a>00467     }
<a name="l00468"></a>00468 
<a name="l00469"></a>00469   check_mmu_status ();
<a name="l00470"></a>00470 
<a name="l00471"></a>00471   pc_addr = <a class="code" href="regcache_8c.html#a01b72bb2ee2d14e0097af17241cee731">regcache_read_pc</a> (<a class="code" href="regcache_8c.html#a09a386286dc22d882378f639630fecef">get_current_regcache</a> ());
<a name="l00472"></a>00472   <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l00473"></a>00473     <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;pc &lt;= 0x%lx\n&quot;</span>, pc_addr);
<a name="l00474"></a>00474 
<a name="l00475"></a>00475   <span class="comment">/* At pc address there is a parallel instruction with +2 offset,</span>
<a name="l00476"></a>00476 <span class="comment">     so we have to make it a serial instruction or avoid it.  */</span>
<a name="l00477"></a>00477   <span class="keywordflow">if</span> (pc_addr == last_pc_addr)
<a name="l00478"></a>00478     {
<a name="l00479"></a>00479       <span class="comment">/* Avoid a parallel nop.  */</span>
<a name="l00480"></a>00480       <span class="keywordflow">if</span> (last_pc_addr_data[0] == 0xf0 &amp;&amp; last_pc_addr_data[1] == 0x00)
<a name="l00481"></a>00481         {
<a name="l00482"></a>00482           pc_addr += 2;
<a name="l00483"></a>00483           <span class="comment">/* Now we can forget this instruction.  */</span>
<a name="l00484"></a>00484           last_pc_addr = 0xffffffff;
<a name="l00485"></a>00485         }
<a name="l00486"></a>00486       <span class="comment">/* Clear a parallel bit.  */</span>
<a name="l00487"></a>00487       <span class="keywordflow">else</span>
<a name="l00488"></a>00488         {
<a name="l00489"></a>00489           buf[0] = <a class="code" href="remote-m32r-sdi_8c.html#a93dd7f491f7a7ac6206d79a4dd73f58b">SDI_WRITE_MEMORY</a>;
<a name="l00490"></a>00490           <span class="keywordflow">if</span> (<a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ()) == BFD_ENDIAN_BIG)
<a name="l00491"></a>00491             store_long_parameter (buf + 1, pc_addr);
<a name="l00492"></a>00492           <span class="keywordflow">else</span>
<a name="l00493"></a>00493             store_long_parameter (buf + 1, pc_addr - 1);
<a name="l00494"></a>00494           store_long_parameter (buf + 5, 1);
<a name="l00495"></a>00495           buf[9] = last_pc_addr_data[0] &amp; 0x7f;
<a name="l00496"></a>00496           send_data (buf, 10);
<a name="l00497"></a>00497         }
<a name="l00498"></a>00498     }
<a name="l00499"></a>00499 
<a name="l00500"></a>00500   <span class="comment">/* Set PC.  */</span>
<a name="l00501"></a>00501   send_two_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a78d1521eda3d95caf7e41c9cf8f3ea8c">SDI_WRITE_CPU_REG</a>, <a class="code" href="remote-m32r-sdi_8c.html#a02b4a6c0e3de771482cdb9e3d7de3278">SDI_REG_BPC</a>, pc_addr);
<a name="l00502"></a>00502 
<a name="l00503"></a>00503   <span class="comment">/* step mode.  */</span>
<a name="l00504"></a>00504   step_mode = step;
<a name="l00505"></a>00505   <span class="keywordflow">if</span> (step)
<a name="l00506"></a>00506     {
<a name="l00507"></a>00507       <span class="comment">/* Set PBP.  */</span>
<a name="l00508"></a>00508       send_two_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a78d1521eda3d95caf7e41c9cf8f3ea8c">SDI_WRITE_CPU_REG</a>, <a class="code" href="remote-m32r-sdi_8c.html#adf2023e70f49fb2e32c8c6d76559cbe5">SDI_REG_PBP</a>, pc_addr | 1);
<a name="l00509"></a>00509     }
<a name="l00510"></a>00510   <span class="keywordflow">else</span>
<a name="l00511"></a>00511     {
<a name="l00512"></a>00512       <span class="comment">/* Unset PBP.  */</span>
<a name="l00513"></a>00513       send_two_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a78d1521eda3d95caf7e41c9cf8f3ea8c">SDI_WRITE_CPU_REG</a>, <a class="code" href="remote-m32r-sdi_8c.html#adf2023e70f49fb2e32c8c6d76559cbe5">SDI_REG_PBP</a>, 0x00000000);
<a name="l00514"></a>00514     }
<a name="l00515"></a>00515 
<a name="l00516"></a>00516   <span class="keywordflow">if</span> (use_ib_breakpoints)
<a name="l00517"></a>00517     ib_breakpoints = max_ib_breakpoints;
<a name="l00518"></a>00518   <span class="keywordflow">else</span>
<a name="l00519"></a>00519     ib_breakpoints = 0;
<a name="l00520"></a>00520 
<a name="l00521"></a>00521   <span class="comment">/* Set ib breakpoints.  */</span>
<a name="l00522"></a>00522   <span class="keywordflow">for</span> (i = 0; i &lt; ib_breakpoints; i++)
<a name="l00523"></a>00523     {
<a name="l00524"></a>00524       bp_addr = bp_address[i];
<a name="l00525"></a>00525 
<a name="l00526"></a>00526       <span class="keywordflow">if</span> (bp_addr == 0xffffffff)
<a name="l00527"></a>00527         <span class="keywordflow">continue</span>;
<a name="l00528"></a>00528 
<a name="l00529"></a>00529       <span class="comment">/* Set PBP.  */</span>
<a name="l00530"></a>00530       <span class="keywordflow">if</span> (<a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ()) == BFD_ENDIAN_BIG)
<a name="l00531"></a>00531         send_three_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a93dd7f491f7a7ac6206d79a4dd73f58b">SDI_WRITE_MEMORY</a>, 0xffff8000 + 4 * i, 4,
<a name="l00532"></a>00532                             0x00000006);
<a name="l00533"></a>00533       <span class="keywordflow">else</span>
<a name="l00534"></a>00534         send_three_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a93dd7f491f7a7ac6206d79a4dd73f58b">SDI_WRITE_MEMORY</a>, 0xffff8000 + 4 * i, 4,
<a name="l00535"></a>00535                             0x06000000);
<a name="l00536"></a>00536 
<a name="l00537"></a>00537       send_three_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a93dd7f491f7a7ac6206d79a4dd73f58b">SDI_WRITE_MEMORY</a>, 0xffff8080 + 4 * i, 4, bp_addr);
<a name="l00538"></a>00538     }
<a name="l00539"></a>00539 
<a name="l00540"></a>00540   <span class="comment">/* Set dbt breakpoints.  */</span>
<a name="l00541"></a>00541   <span class="keywordflow">for</span> (i = ib_breakpoints; i &lt; <a class="code" href="remote-m32r-sdi_8c.html#a996fc495c80dc29ca7641d887ae4a462">MAX_BREAKPOINTS</a>; i++)
<a name="l00542"></a>00542     {
<a name="l00543"></a>00543       bp_addr = bp_address[i];
<a name="l00544"></a>00544 
<a name="l00545"></a>00545       <span class="keywordflow">if</span> (bp_addr == 0xffffffff)
<a name="l00546"></a>00546         <span class="keywordflow">continue</span>;
<a name="l00547"></a>00547 
<a name="l00548"></a>00548       <span class="keywordflow">if</span> (!mmu_on)
<a name="l00549"></a>00549         bp_addr &amp;= 0x7fffffff;
<a name="l00550"></a>00550 
<a name="l00551"></a>00551       <span class="comment">/* Write DBT instruction.  */</span>
<a name="l00552"></a>00552       buf[0] = <a class="code" href="remote-m32r-sdi_8c.html#a93dd7f491f7a7ac6206d79a4dd73f58b">SDI_WRITE_MEMORY</a>;
<a name="l00553"></a>00553       store_long_parameter (buf + 1, (bp_addr &amp; 0xfffffffc));
<a name="l00554"></a>00554       store_long_parameter (buf + 5, 4);
<a name="l00555"></a>00555       <span class="keywordflow">if</span> ((bp_addr &amp; 2) == 0 &amp;&amp; bp_addr != (pc_addr &amp; 0xfffffffc))
<a name="l00556"></a>00556         {
<a name="l00557"></a>00557           <span class="keywordflow">if</span> (<a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ()) == BFD_ENDIAN_BIG)
<a name="l00558"></a>00558             {
<a name="l00559"></a>00559               buf[9] = dbt_bp_entry[0];
<a name="l00560"></a>00560               buf[10] = dbt_bp_entry[1];
<a name="l00561"></a>00561               buf[11] = dbt_bp_entry[2];
<a name="l00562"></a>00562               buf[12] = dbt_bp_entry[3];
<a name="l00563"></a>00563             }
<a name="l00564"></a>00564           <span class="keywordflow">else</span>
<a name="l00565"></a>00565             {
<a name="l00566"></a>00566               buf[9] = dbt_bp_entry[3];
<a name="l00567"></a>00567               buf[10] = dbt_bp_entry[2];
<a name="l00568"></a>00568               buf[11] = dbt_bp_entry[1];
<a name="l00569"></a>00569               buf[12] = dbt_bp_entry[0];
<a name="l00570"></a>00570             }
<a name="l00571"></a>00571         }
<a name="l00572"></a>00572       <span class="keywordflow">else</span>
<a name="l00573"></a>00573         {
<a name="l00574"></a>00574           <span class="keywordflow">if</span> (<a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ()) == BFD_ENDIAN_BIG)
<a name="l00575"></a>00575             {
<a name="l00576"></a>00576               <span class="keywordflow">if</span> ((bp_addr &amp; 2) == 0)
<a name="l00577"></a>00577                 {
<a name="l00578"></a>00578                   buf[9] = dbt_bp_entry[0];
<a name="l00579"></a>00579                   buf[10] = dbt_bp_entry[1];
<a name="l00580"></a>00580                   buf[11] = bp_data[i][2] &amp; 0x7f;
<a name="l00581"></a>00581                   buf[12] = bp_data[i][3];
<a name="l00582"></a>00582                 }
<a name="l00583"></a>00583               <span class="keywordflow">else</span>
<a name="l00584"></a>00584                 {
<a name="l00585"></a>00585                   buf[9] = bp_data[i][0];
<a name="l00586"></a>00586                   buf[10] = bp_data[i][1];
<a name="l00587"></a>00587                   buf[11] = dbt_bp_entry[0];
<a name="l00588"></a>00588                   buf[12] = dbt_bp_entry[1];
<a name="l00589"></a>00589                 }
<a name="l00590"></a>00590             }
<a name="l00591"></a>00591           <span class="keywordflow">else</span>
<a name="l00592"></a>00592             {
<a name="l00593"></a>00593               <span class="keywordflow">if</span> ((bp_addr &amp; 2) == 0)
<a name="l00594"></a>00594                 {
<a name="l00595"></a>00595                   buf[9] = bp_data[i][0];
<a name="l00596"></a>00596                   buf[10] = bp_data[i][1] &amp; 0x7f;
<a name="l00597"></a>00597                   buf[11] = dbt_bp_entry[1];
<a name="l00598"></a>00598                   buf[12] = dbt_bp_entry[0];
<a name="l00599"></a>00599                 }
<a name="l00600"></a>00600               <span class="keywordflow">else</span>
<a name="l00601"></a>00601                 {
<a name="l00602"></a>00602                   buf[9] = dbt_bp_entry[1];
<a name="l00603"></a>00603                   buf[10] = dbt_bp_entry[0];
<a name="l00604"></a>00604                   buf[11] = bp_data[i][2];
<a name="l00605"></a>00605                   buf[12] = bp_data[i][3];
<a name="l00606"></a>00606                 }
<a name="l00607"></a>00607             }
<a name="l00608"></a>00608         }
<a name="l00609"></a>00609       send_data (buf, 13);
<a name="l00610"></a>00610     }
<a name="l00611"></a>00611 
<a name="l00612"></a>00612   <span class="comment">/* Set access breaks.  */</span>
<a name="l00613"></a>00613   <span class="keywordflow">for</span> (i = 0; i &lt; max_access_breaks; i++)
<a name="l00614"></a>00614     {
<a name="l00615"></a>00615       ab_addr = ab_address[i];
<a name="l00616"></a>00616 
<a name="l00617"></a>00617       <span class="keywordflow">if</span> (ab_addr == 0x00000000)
<a name="l00618"></a>00618         <span class="keywordflow">continue</span>;
<a name="l00619"></a>00619 
<a name="l00620"></a>00620       <span class="comment">/* DBC register.  */</span>
<a name="l00621"></a>00621       <span class="keywordflow">if</span> (<a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ()) == BFD_ENDIAN_BIG)
<a name="l00622"></a>00622         {
<a name="l00623"></a>00623           <span class="keywordflow">switch</span> (ab_type[i])
<a name="l00624"></a>00624             {
<a name="l00625"></a>00625             <span class="keywordflow">case</span> 0:             <span class="comment">/* write watch */</span>
<a name="l00626"></a>00626               send_three_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a93dd7f491f7a7ac6206d79a4dd73f58b">SDI_WRITE_MEMORY</a>, 0xffff8100 + 4 * i, 4,
<a name="l00627"></a>00627                                   0x00000086);
<a name="l00628"></a>00628               <span class="keywordflow">break</span>;
<a name="l00629"></a>00629             <span class="keywordflow">case</span> 1:             <span class="comment">/* read watch */</span>
<a name="l00630"></a>00630               send_three_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a93dd7f491f7a7ac6206d79a4dd73f58b">SDI_WRITE_MEMORY</a>, 0xffff8100 + 4 * i, 4,
<a name="l00631"></a>00631                                   0x00000046);
<a name="l00632"></a>00632               <span class="keywordflow">break</span>;
<a name="l00633"></a>00633             <span class="keywordflow">case</span> 2:             <span class="comment">/* access watch */</span>
<a name="l00634"></a>00634               send_three_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a93dd7f491f7a7ac6206d79a4dd73f58b">SDI_WRITE_MEMORY</a>, 0xffff8100 + 4 * i, 4,
<a name="l00635"></a>00635                                   0x00000006);
<a name="l00636"></a>00636               <span class="keywordflow">break</span>;
<a name="l00637"></a>00637             }
<a name="l00638"></a>00638         }
<a name="l00639"></a>00639       <span class="keywordflow">else</span>
<a name="l00640"></a>00640         {
<a name="l00641"></a>00641           <span class="keywordflow">switch</span> (ab_type[i])
<a name="l00642"></a>00642             {
<a name="l00643"></a>00643             <span class="keywordflow">case</span> 0:             <span class="comment">/* write watch */</span>
<a name="l00644"></a>00644               send_three_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a93dd7f491f7a7ac6206d79a4dd73f58b">SDI_WRITE_MEMORY</a>, 0xffff8100 + 4 * i, 4,
<a name="l00645"></a>00645                                   0x86000000);
<a name="l00646"></a>00646               <span class="keywordflow">break</span>;
<a name="l00647"></a>00647             <span class="keywordflow">case</span> 1:             <span class="comment">/* read watch */</span>
<a name="l00648"></a>00648               send_three_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a93dd7f491f7a7ac6206d79a4dd73f58b">SDI_WRITE_MEMORY</a>, 0xffff8100 + 4 * i, 4,
<a name="l00649"></a>00649                                   0x46000000);
<a name="l00650"></a>00650               <span class="keywordflow">break</span>;
<a name="l00651"></a>00651             <span class="keywordflow">case</span> 2:             <span class="comment">/* access watch */</span>
<a name="l00652"></a>00652               send_three_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a93dd7f491f7a7ac6206d79a4dd73f58b">SDI_WRITE_MEMORY</a>, 0xffff8100 + 4 * i, 4,
<a name="l00653"></a>00653                                   0x06000000);
<a name="l00654"></a>00654               <span class="keywordflow">break</span>;
<a name="l00655"></a>00655             }
<a name="l00656"></a>00656         }
<a name="l00657"></a>00657 
<a name="l00658"></a>00658       <span class="comment">/* DBAH register.  */</span>
<a name="l00659"></a>00659       send_three_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a93dd7f491f7a7ac6206d79a4dd73f58b">SDI_WRITE_MEMORY</a>, 0xffff8180 + 4 * i, 4, ab_addr);
<a name="l00660"></a>00660 
<a name="l00661"></a>00661       <span class="comment">/* DBAL register.  */</span>
<a name="l00662"></a>00662       send_three_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a93dd7f491f7a7ac6206d79a4dd73f58b">SDI_WRITE_MEMORY</a>, 0xffff8200 + 4 * i, 4,
<a name="l00663"></a>00663                           0xffffffff);
<a name="l00664"></a>00664 
<a name="l00665"></a>00665       <span class="comment">/* DBD register.  */</span>
<a name="l00666"></a>00666       send_three_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a93dd7f491f7a7ac6206d79a4dd73f58b">SDI_WRITE_MEMORY</a>, 0xffff8280 + 4 * i, 4,
<a name="l00667"></a>00667                           0x00000000);
<a name="l00668"></a>00668 
<a name="l00669"></a>00669       <span class="comment">/* DBDM register.  */</span>
<a name="l00670"></a>00670       send_three_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a93dd7f491f7a7ac6206d79a4dd73f58b">SDI_WRITE_MEMORY</a>, 0xffff8300 + 4 * i, 4,
<a name="l00671"></a>00671                           0x00000000);
<a name="l00672"></a>00672     }
<a name="l00673"></a>00673 
<a name="l00674"></a>00674   <span class="comment">/* Resume program.  */</span>
<a name="l00675"></a>00675   send_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a4f0ed7542c1906c14f57d942cc6861f4">SDI_EXEC_CPU</a>);
<a name="l00676"></a>00676 
<a name="l00677"></a>00677   <span class="comment">/* Without this, some commands which require an active target (such as kill)</span>
<a name="l00678"></a>00678 <span class="comment">     won&#39;t work.  This variable serves (at least) double duty as both the pid</span>
<a name="l00679"></a>00679 <span class="comment">     of the target process (if it has such), and as a flag indicating that a</span>
<a name="l00680"></a>00680 <span class="comment">     target is active.  These functions should be split out into seperate</span>
<a name="l00681"></a>00681 <span class="comment">     variables, especially since GDB will someday have a notion of debugging</span>
<a name="l00682"></a>00682 <span class="comment">     several processes.  */</span>
<a name="l00683"></a>00683   <a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a> = remote_m32r_ptid;
<a name="l00684"></a>00684   <a class="code" href="gdbthread_8h.html#a750acf3bf37055ba79a72576d21819bd">add_thread_silent</a> (remote_m32r_ptid);
<a name="l00685"></a>00685 
<a name="l00686"></a>00686   <span class="keywordflow">return</span>;
<a name="l00687"></a>00687 }
<a name="l00688"></a>00688 
<a name="l00689"></a>00689 <span class="comment">/* Wait until the remote machine stops, then return,</span>
<a name="l00690"></a>00690 <span class="comment">   storing status in STATUS just as `wait&#39; would.  */</span>
<a name="l00691"></a>00691 
<a name="l00692"></a>00692 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00693"></a>00693 gdb_cntrl_c (<span class="keywordtype">int</span> signo)
<a name="l00694"></a>00694 {
<a name="l00695"></a>00695   <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l00696"></a>00696     <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;interrupt\n&quot;</span>);
<a name="l00697"></a>00697   interrupted = 1;
<a name="l00698"></a>00698 }
<a name="l00699"></a>00699 
<a name="l00700"></a>00700 <span class="keyword">static</span> <a class="code" href="structptid.html">ptid_t</a>
<a name="l00701"></a>00701 m32r_wait (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *ops,
<a name="l00702"></a>00702            <a class="code" href="structptid.html">ptid_t</a> ptid, <span class="keyword">struct</span> <a class="code" href="structtarget__waitstatus.html">target_waitstatus</a> *<a class="code" href="namespaceexsummary.html#aa4a2eed06e51a1f73ff9053ec9f2591e">status</a>, <span class="keywordtype">int</span> options)
<a name="l00703"></a>00703 {
<a name="l00704"></a>00704   <span class="keyword">static</span> <a class="code" href="config_8h.html#adbe5dcee9c146b338794974137c55e70">RETSIGTYPE</a> (*prev_sigint) ();
<a name="l00705"></a>00705   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> bp_addr, pc_addr;
<a name="l00706"></a>00706   <span class="keywordtype">int</span> ib_breakpoints;
<a name="l00707"></a>00707   <span class="keywordtype">long</span> i;
<a name="l00708"></a>00708   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buf[13];
<a name="l00709"></a>00709   <span class="keywordtype">int</span> ret, c;
<a name="l00710"></a>00710 
<a name="l00711"></a>00711   <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l00712"></a>00712     <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;m32r_wait()\n&quot;</span>);
<a name="l00713"></a>00713 
<a name="l00714"></a>00714   status-&gt;<a class="code" href="structtarget__waitstatus.html#a17ed1783e9146f443fa51ace8da76198">kind</a> = <a class="code" href="waitstatus_8h.html#aa3229b489ec985f04f7e9f652138b7c3ab3b4a30139ccced70de23752ba9de4d4">TARGET_WAITKIND_EXITED</a>;
<a name="l00715"></a>00715   status-&gt;<a class="code" href="structtarget__waitstatus.html#af33b8f5721dc36f6b5b829286d38f825">value</a>.<a class="code" href="structtarget__waitstatus.html#a7cc711572c26d1f095a87105f4afd1e1">sig</a> = GDB_SIGNAL_0;
<a name="l00716"></a>00716 
<a name="l00717"></a>00717   interrupted = 0;
<a name="l00718"></a>00718   prev_sigint = signal (SIGINT, gdb_cntrl_c);
<a name="l00719"></a>00719 
<a name="l00720"></a>00720   <span class="comment">/* Wait for ready.  */</span>
<a name="l00721"></a>00721   buf[0] = <a class="code" href="remote-m32r-sdi_8c.html#a9cd0773f11bab2fc3d7eb6754591a80b">SDI_WAIT_FOR_READY</a>;
<a name="l00722"></a>00722   <span class="keywordflow">if</span> (<a class="code" href="serial_8c.html#a60477906c21a815cb7c71503e1acdc35">serial_write</a> (sdi_desc, buf, 1) != 0)
<a name="l00723"></a>00723     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Remote connection closed&quot;</span>));
<a name="l00724"></a>00724 
<a name="l00725"></a>00725   <span class="keywordflow">while</span> (1)
<a name="l00726"></a>00726     {
<a name="l00727"></a>00727       c = <a class="code" href="serial_8c.html#aa36fd875c1c5bbb220faa370e965acd7">serial_readchar</a> (sdi_desc, <a class="code" href="remote-m32r-sdi_8c.html#afdfc7e62456a50146cda3faaa6ba3cd3">SDI_TIMEOUT</a>);
<a name="l00728"></a>00728       <span class="keywordflow">if</span> (c &lt; 0)
<a name="l00729"></a>00729         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Remote connection closed&quot;</span>));
<a name="l00730"></a>00730 
<a name="l00731"></a>00731       <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;-&#39;</span>)             <span class="comment">/* error */</span>
<a name="l00732"></a>00732         {
<a name="l00733"></a>00733           status-&gt;<a class="code" href="structtarget__waitstatus.html#a17ed1783e9146f443fa51ace8da76198">kind</a> = <a class="code" href="waitstatus_8h.html#aa3229b489ec985f04f7e9f652138b7c3a8e1dc525cf3131501a541b4412bcd493">TARGET_WAITKIND_STOPPED</a>;
<a name="l00734"></a>00734           status-&gt;<a class="code" href="structtarget__waitstatus.html#af33b8f5721dc36f6b5b829286d38f825">value</a>.<a class="code" href="structtarget__waitstatus.html#a7cc711572c26d1f095a87105f4afd1e1">sig</a> = GDB_SIGNAL_HUP;
<a name="l00735"></a>00735           <span class="keywordflow">return</span> <a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>;
<a name="l00736"></a>00736         }
<a name="l00737"></a>00737       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;+&#39;</span>)        <span class="comment">/* stopped */</span>
<a name="l00738"></a>00738         <span class="keywordflow">break</span>;
<a name="l00739"></a>00739 
<a name="l00740"></a>00740       <span class="keywordflow">if</span> (interrupted)
<a name="l00741"></a>00741         ret = <a class="code" href="serial_8c.html#a60477906c21a815cb7c71503e1acdc35">serial_write</a> (sdi_desc, <span class="stringliteral">&quot;!&quot;</span>, 1);  <span class="comment">/* packet to interrupt */</span>
<a name="l00742"></a>00742       <span class="keywordflow">else</span>
<a name="l00743"></a>00743         ret = <a class="code" href="serial_8c.html#a60477906c21a815cb7c71503e1acdc35">serial_write</a> (sdi_desc, <span class="stringliteral">&quot;.&quot;</span>, 1);  <span class="comment">/* packet to wait */</span>
<a name="l00744"></a>00744       <span class="keywordflow">if</span> (ret != 0)
<a name="l00745"></a>00745         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Remote connection closed&quot;</span>));
<a name="l00746"></a>00746     }
<a name="l00747"></a>00747 
<a name="l00748"></a>00748   status-&gt;<a class="code" href="structtarget__waitstatus.html#a17ed1783e9146f443fa51ace8da76198">kind</a> = <a class="code" href="waitstatus_8h.html#aa3229b489ec985f04f7e9f652138b7c3a8e1dc525cf3131501a541b4412bcd493">TARGET_WAITKIND_STOPPED</a>;
<a name="l00749"></a>00749   <span class="keywordflow">if</span> (interrupted)
<a name="l00750"></a>00750     status-&gt;<a class="code" href="structtarget__waitstatus.html#af33b8f5721dc36f6b5b829286d38f825">value</a>.<a class="code" href="structtarget__waitstatus.html#a7cc711572c26d1f095a87105f4afd1e1">sig</a> = GDB_SIGNAL_INT;
<a name="l00751"></a>00751   <span class="keywordflow">else</span>
<a name="l00752"></a>00752     status-&gt;<a class="code" href="structtarget__waitstatus.html#af33b8f5721dc36f6b5b829286d38f825">value</a>.<a class="code" href="structtarget__waitstatus.html#a7cc711572c26d1f095a87105f4afd1e1">sig</a> = GDB_SIGNAL_TRAP;
<a name="l00753"></a>00753 
<a name="l00754"></a>00754   interrupted = 0;
<a name="l00755"></a>00755   signal (SIGINT, prev_sigint);
<a name="l00756"></a>00756 
<a name="l00757"></a>00757   check_mmu_status ();
<a name="l00758"></a>00758 
<a name="l00759"></a>00759   <span class="comment">/* Recover parallel bit.  */</span>
<a name="l00760"></a>00760   <span class="keywordflow">if</span> (last_pc_addr != 0xffffffff)
<a name="l00761"></a>00761     {
<a name="l00762"></a>00762       buf[0] = <a class="code" href="remote-m32r-sdi_8c.html#a93dd7f491f7a7ac6206d79a4dd73f58b">SDI_WRITE_MEMORY</a>;
<a name="l00763"></a>00763       <span class="keywordflow">if</span> (<a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ()) == BFD_ENDIAN_BIG)
<a name="l00764"></a>00764         store_long_parameter (buf + 1, last_pc_addr);
<a name="l00765"></a>00765       <span class="keywordflow">else</span>
<a name="l00766"></a>00766         store_long_parameter (buf + 1, last_pc_addr - 1);
<a name="l00767"></a>00767       store_long_parameter (buf + 5, 1);
<a name="l00768"></a>00768       buf[9] = last_pc_addr_data[0];
<a name="l00769"></a>00769       send_data (buf, 10);
<a name="l00770"></a>00770       last_pc_addr = 0xffffffff;
<a name="l00771"></a>00771     }
<a name="l00772"></a>00772 
<a name="l00773"></a>00773   <span class="keywordflow">if</span> (use_ib_breakpoints)
<a name="l00774"></a>00774     ib_breakpoints = max_ib_breakpoints;
<a name="l00775"></a>00775   <span class="keywordflow">else</span>
<a name="l00776"></a>00776     ib_breakpoints = 0;
<a name="l00777"></a>00777 
<a name="l00778"></a>00778   <span class="comment">/* Set back pc by 2 if m32r is stopped with dbt.  */</span>
<a name="l00779"></a>00779   last_pc_addr = 0xffffffff;
<a name="l00780"></a>00780   send_one_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a7bdb53a493108e405c091d8ee167fc5e">SDI_READ_CPU_REG</a>, <a class="code" href="remote-m32r-sdi_8c.html#a02b4a6c0e3de771482cdb9e3d7de3278">SDI_REG_BPC</a>);
<a name="l00781"></a>00781   pc_addr = recv_long_data () - 2;
<a name="l00782"></a>00782   <span class="keywordflow">for</span> (i = ib_breakpoints; i &lt; <a class="code" href="remote-m32r-sdi_8c.html#a996fc495c80dc29ca7641d887ae4a462">MAX_BREAKPOINTS</a>; i++)
<a name="l00783"></a>00783     {
<a name="l00784"></a>00784       <span class="keywordflow">if</span> (pc_addr == bp_address[i])
<a name="l00785"></a>00785         {
<a name="l00786"></a>00786           send_two_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a78d1521eda3d95caf7e41c9cf8f3ea8c">SDI_WRITE_CPU_REG</a>, <a class="code" href="remote-m32r-sdi_8c.html#a02b4a6c0e3de771482cdb9e3d7de3278">SDI_REG_BPC</a>, pc_addr);
<a name="l00787"></a>00787 
<a name="l00788"></a>00788           <span class="comment">/* If there is a parallel instruction with +2 offset at pc</span>
<a name="l00789"></a>00789 <span class="comment">             address, we have to take care of it later.  */</span>
<a name="l00790"></a>00790           <span class="keywordflow">if</span> ((pc_addr &amp; 0x2) != 0)
<a name="l00791"></a>00791             {
<a name="l00792"></a>00792               <span class="keywordflow">if</span> (<a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ()) == BFD_ENDIAN_BIG)
<a name="l00793"></a>00793                 {
<a name="l00794"></a>00794                   <span class="keywordflow">if</span> ((bp_data[i][2] &amp; 0x80) != 0)
<a name="l00795"></a>00795                     {
<a name="l00796"></a>00796                       last_pc_addr = pc_addr;
<a name="l00797"></a>00797                       last_pc_addr_data[0] = bp_data[i][2];
<a name="l00798"></a>00798                       last_pc_addr_data[1] = bp_data[i][3];
<a name="l00799"></a>00799                     }
<a name="l00800"></a>00800                 }
<a name="l00801"></a>00801               <span class="keywordflow">else</span>
<a name="l00802"></a>00802                 {
<a name="l00803"></a>00803                   <span class="keywordflow">if</span> ((bp_data[i][1] &amp; 0x80) != 0)
<a name="l00804"></a>00804                     {
<a name="l00805"></a>00805                       last_pc_addr = pc_addr;
<a name="l00806"></a>00806                       last_pc_addr_data[0] = bp_data[i][1];
<a name="l00807"></a>00807                       last_pc_addr_data[1] = bp_data[i][0];
<a name="l00808"></a>00808                     }
<a name="l00809"></a>00809                 }
<a name="l00810"></a>00810             }
<a name="l00811"></a>00811           <span class="keywordflow">break</span>;
<a name="l00812"></a>00812         }
<a name="l00813"></a>00813     }
<a name="l00814"></a>00814 
<a name="l00815"></a>00815   <span class="comment">/* Remove ib breakpoints.  */</span>
<a name="l00816"></a>00816   <span class="keywordflow">for</span> (i = 0; i &lt; ib_breakpoints; i++)
<a name="l00817"></a>00817     {
<a name="l00818"></a>00818       <span class="keywordflow">if</span> (bp_address[i] != 0xffffffff)
<a name="l00819"></a>00819         send_three_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a93dd7f491f7a7ac6206d79a4dd73f58b">SDI_WRITE_MEMORY</a>, 0xffff8000 + 4 * i, 4,
<a name="l00820"></a>00820                             0x00000000);
<a name="l00821"></a>00821     }
<a name="l00822"></a>00822   <span class="comment">/* Remove dbt breakpoints.  */</span>
<a name="l00823"></a>00823   <span class="keywordflow">for</span> (i = ib_breakpoints; i &lt; <a class="code" href="remote-m32r-sdi_8c.html#a996fc495c80dc29ca7641d887ae4a462">MAX_BREAKPOINTS</a>; i++)
<a name="l00824"></a>00824     {
<a name="l00825"></a>00825       bp_addr = bp_address[i];
<a name="l00826"></a>00826       <span class="keywordflow">if</span> (bp_addr != 0xffffffff)
<a name="l00827"></a>00827         {
<a name="l00828"></a>00828           <span class="keywordflow">if</span> (!mmu_on)
<a name="l00829"></a>00829             bp_addr &amp;= 0x7fffffff;
<a name="l00830"></a>00830           buf[0] = <a class="code" href="remote-m32r-sdi_8c.html#a93dd7f491f7a7ac6206d79a4dd73f58b">SDI_WRITE_MEMORY</a>;
<a name="l00831"></a>00831           store_long_parameter (buf + 1, bp_addr &amp; 0xfffffffc);
<a name="l00832"></a>00832           store_long_parameter (buf + 5, 4);
<a name="l00833"></a>00833           buf[9] = bp_data[i][0];
<a name="l00834"></a>00834           buf[10] = bp_data[i][1];
<a name="l00835"></a>00835           buf[11] = bp_data[i][2];
<a name="l00836"></a>00836           buf[12] = bp_data[i][3];
<a name="l00837"></a>00837           send_data (buf, 13);
<a name="l00838"></a>00838         }
<a name="l00839"></a>00839     }
<a name="l00840"></a>00840 
<a name="l00841"></a>00841   <span class="comment">/* Remove access breaks.  */</span>
<a name="l00842"></a>00842   hit_watchpoint_addr = 0;
<a name="l00843"></a>00843   <span class="keywordflow">for</span> (i = 0; i &lt; max_access_breaks; i++)
<a name="l00844"></a>00844     {
<a name="l00845"></a>00845       <span class="keywordflow">if</span> (ab_address[i] != 0x00000000)
<a name="l00846"></a>00846         {
<a name="l00847"></a>00847           buf[0] = <a class="code" href="remote-m32r-sdi_8c.html#ab11af9ddf5e11a8f0a495b2b5ca79b79">SDI_READ_MEMORY</a>;
<a name="l00848"></a>00848           store_long_parameter (buf + 1, 0xffff8100 + 4 * i);
<a name="l00849"></a>00849           store_long_parameter (buf + 5, 4);
<a name="l00850"></a>00850           <a class="code" href="serial_8c.html#a60477906c21a815cb7c71503e1acdc35">serial_write</a> (sdi_desc, buf, 9);
<a name="l00851"></a>00851           c = <a class="code" href="serial_8c.html#aa36fd875c1c5bbb220faa370e965acd7">serial_readchar</a> (sdi_desc, <a class="code" href="remote-m32r-sdi_8c.html#afdfc7e62456a50146cda3faaa6ba3cd3">SDI_TIMEOUT</a>);
<a name="l00852"></a>00852           <span class="keywordflow">if</span> (c != <span class="charliteral">&#39;-&#39;</span> &amp;&amp; recv_data (buf, 4) != -1)
<a name="l00853"></a>00853             {
<a name="l00854"></a>00854               <span class="keywordflow">if</span> (<a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ()) == BFD_ENDIAN_BIG)
<a name="l00855"></a>00855                 {
<a name="l00856"></a>00856                   <span class="keywordflow">if</span> ((buf[3] &amp; 0x1) == 0x1)
<a name="l00857"></a>00857                     hit_watchpoint_addr = ab_address[i];
<a name="l00858"></a>00858                 }
<a name="l00859"></a>00859               <span class="keywordflow">else</span>
<a name="l00860"></a>00860                 {
<a name="l00861"></a>00861                   <span class="keywordflow">if</span> ((buf[0] &amp; 0x1) == 0x1)
<a name="l00862"></a>00862                     hit_watchpoint_addr = ab_address[i];
<a name="l00863"></a>00863                 }
<a name="l00864"></a>00864             }
<a name="l00865"></a>00865 
<a name="l00866"></a>00866           send_three_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a93dd7f491f7a7ac6206d79a4dd73f58b">SDI_WRITE_MEMORY</a>, 0xffff8100 + 4 * i, 4,
<a name="l00867"></a>00867                               0x00000000);
<a name="l00868"></a>00868         }
<a name="l00869"></a>00869     }
<a name="l00870"></a>00870 
<a name="l00871"></a>00871   <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l00872"></a>00872     <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;pc =&gt; 0x%lx\n&quot;</span>, pc_addr);
<a name="l00873"></a>00873 
<a name="l00874"></a>00874   <span class="keywordflow">return</span> <a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>;
<a name="l00875"></a>00875 }
<a name="l00876"></a>00876 
<a name="l00877"></a>00877 <span class="comment">/* Terminate the open connection to the remote debugger.</span>
<a name="l00878"></a>00878 <span class="comment">   Use this when you want to detach and do something else</span>
<a name="l00879"></a>00879 <span class="comment">   with your gdb.  */</span>
<a name="l00880"></a>00880 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00881"></a>00881 m32r_detach (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *ops, <span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l00882"></a>00882 {
<a name="l00883"></a>00883   <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l00884"></a>00884     <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;m32r_detach(%d)\n&quot;</span>, from_tty);
<a name="l00885"></a>00885 
<a name="l00886"></a>00886   m32r_resume (ops, <a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>, 0, GDB_SIGNAL_0);
<a name="l00887"></a>00887 
<a name="l00888"></a>00888   <span class="comment">/* Calls m32r_close to do the real work.  */</span>
<a name="l00889"></a>00889   <a class="code" href="target_8c.html#a9599d37847d1388531abb3f2aeba6616">unpush_target</a> (ops);
<a name="l00890"></a>00890   <span class="keywordflow">if</span> (from_tty)
<a name="l00891"></a>00891     <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;Ending remote %s debugging\n&quot;</span>,
<a name="l00892"></a>00892                         <a class="code" href="target_8h.html#a82f16780537e85ac9b42873b0008108c">target_shortname</a>);
<a name="l00893"></a>00893 }
<a name="l00894"></a>00894 
<a name="l00895"></a>00895 <span class="comment">/* Return the id of register number REGNO.  */</span>
<a name="l00896"></a>00896 
<a name="l00897"></a>00897 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00898"></a>00898 get_reg_id (<span class="keywordtype">int</span> regno)
<a name="l00899"></a>00899 {
<a name="l00900"></a>00900   <span class="keywordflow">switch</span> (regno)
<a name="l00901"></a>00901     {
<a name="l00902"></a>00902     <span class="keywordflow">case</span> 20:
<a name="l00903"></a>00903       <span class="keywordflow">return</span> <a class="code" href="remote-m32r-sdi_8c.html#a6e896e6862a716fc10f8c8a8dff10ff8">SDI_REG_BBPC</a>;
<a name="l00904"></a>00904     <span class="keywordflow">case</span> 21:
<a name="l00905"></a>00905       <span class="keywordflow">return</span> <a class="code" href="remote-m32r-sdi_8c.html#a02b4a6c0e3de771482cdb9e3d7de3278">SDI_REG_BPC</a>;
<a name="l00906"></a>00906     <span class="keywordflow">case</span> 22:
<a name="l00907"></a>00907       <span class="keywordflow">return</span> <a class="code" href="remote-m32r-sdi_8c.html#aadcd70d0cead8f39eafb58bfe774b0e6">SDI_REG_ACCL</a>;
<a name="l00908"></a>00908     <span class="keywordflow">case</span> 23:
<a name="l00909"></a>00909       <span class="keywordflow">return</span> <a class="code" href="remote-m32r-sdi_8c.html#af2390a8cb89c35873b31702aad1c5833">SDI_REG_ACCH</a>;
<a name="l00910"></a>00910     <span class="keywordflow">case</span> 24:
<a name="l00911"></a>00911       <span class="keywordflow">return</span> <a class="code" href="remote-m32r-sdi_8c.html#a2737e35c8b0c1bc09725e18d2e99203f">SDI_REG_EVB</a>;
<a name="l00912"></a>00912     }
<a name="l00913"></a>00913 
<a name="l00914"></a>00914   <span class="keywordflow">return</span> regno;
<a name="l00915"></a>00915 }
<a name="l00916"></a>00916 
<a name="l00917"></a>00917 <span class="comment">/* Fetch register REGNO, or all registers if REGNO is -1.</span>
<a name="l00918"></a>00918 <span class="comment">   Returns errno value.  */</span>
<a name="l00919"></a>00919 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00920"></a>00920 m32r_fetch_register (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *ops,
<a name="l00921"></a>00921                      <span class="keyword">struct</span> regcache *regcache, <span class="keywordtype">int</span> regno)
<a name="l00922"></a>00922 {
<a name="l00923"></a>00923   <span class="keyword">struct </span>gdbarch *gdbarch = <a class="code" href="regcache_8c.html#ad4f6d0cdf256b1fa45d59a6d71b50659">get_regcache_arch</a> (regcache);
<a name="l00924"></a>00924   <span class="keyword">enum</span> bfd_endian byte_order = <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (gdbarch);
<a name="l00925"></a>00925   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> val, val2, regid;
<a name="l00926"></a>00926 
<a name="l00927"></a>00927   <span class="keywordflow">if</span> (regno == -1)
<a name="l00928"></a>00928     {
<a name="l00929"></a>00929       <span class="keywordflow">for</span> (regno = 0;
<a name="l00930"></a>00930            regno &lt; <a class="code" href="gdbarch_8c.html#a69069435754d0b434c7043a21d247325">gdbarch_num_regs</a> (<a class="code" href="regcache_8c.html#ad4f6d0cdf256b1fa45d59a6d71b50659">get_regcache_arch</a> (regcache));
<a name="l00931"></a>00931            regno++)
<a name="l00932"></a>00932         m32r_fetch_register (ops, regcache, regno);
<a name="l00933"></a>00933     }
<a name="l00934"></a>00934   <span class="keywordflow">else</span>
<a name="l00935"></a>00935     {
<a name="l00936"></a>00936       <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> <a class="code" href="structbuffer.html">buffer</a>[<a class="code" href="defs_8h.html#a1f9aebf1de3ebbf4283a4dcf73308562a4f3d67bb99ae292178850a8930ab8252">MAX_REGISTER_SIZE</a>];
<a name="l00937"></a>00937 
<a name="l00938"></a>00938       regid = get_reg_id (regno);
<a name="l00939"></a>00939       send_one_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a7bdb53a493108e405c091d8ee167fc5e">SDI_READ_CPU_REG</a>, regid);
<a name="l00940"></a>00940       val = recv_long_data ();
<a name="l00941"></a>00941 
<a name="l00942"></a>00942       <span class="keywordflow">if</span> (regid == <a class="code" href="remote-m32r-sdi_8c.html#a530a5a29c26a05d18d17a474bbe2eec3">SDI_REG_PSW</a>)
<a name="l00943"></a>00943         {
<a name="l00944"></a>00944           send_one_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a7bdb53a493108e405c091d8ee167fc5e">SDI_READ_CPU_REG</a>, <a class="code" href="remote-m32r-sdi_8c.html#ac8b8df23322fae346f1ad43d3e8d6f91">SDI_REG_BBPSW</a>);
<a name="l00945"></a>00945           val2 = recv_long_data ();
<a name="l00946"></a>00946           val = ((0x00cf &amp; val2) &lt;&lt; 8) | ((0xcf00 &amp; val) &gt;&gt; 8);
<a name="l00947"></a>00947         }
<a name="l00948"></a>00948 
<a name="l00949"></a>00949       <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l00950"></a>00950         <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;m32r_fetch_register(%d,0x%08lx)\n&quot;</span>,
<a name="l00951"></a>00951                             regno, val);
<a name="l00952"></a>00952 
<a name="l00953"></a>00953       <span class="comment">/* We got the number the register holds, but gdb expects to see a</span>
<a name="l00954"></a>00954 <span class="comment">         value in the target byte ordering.  */</span>
<a name="l00955"></a>00955       <a class="code" href="defs_8h.html#ad11c013c83c64d9d0ee2e4bdeb1fb62d">store_unsigned_integer</a> (buffer, 4, byte_order, val);
<a name="l00956"></a>00956       <a class="code" href="regcache_8c.html#a127ceeb6f30d3bab748c60570ac077a6">regcache_raw_supply</a> (regcache, regno, buffer);
<a name="l00957"></a>00957     }
<a name="l00958"></a>00958   <span class="keywordflow">return</span>;
<a name="l00959"></a>00959 }
<a name="l00960"></a>00960 
<a name="l00961"></a>00961 <span class="comment">/* Store register REGNO, or all if REGNO == 0.</span>
<a name="l00962"></a>00962 <span class="comment">   Return errno value.  */</span>
<a name="l00963"></a>00963 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00964"></a>00964 m32r_store_register (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *ops,
<a name="l00965"></a>00965                      <span class="keyword">struct</span> regcache *regcache, <span class="keywordtype">int</span> regno)
<a name="l00966"></a>00966 {
<a name="l00967"></a>00967   <span class="keywordtype">int</span> regid;
<a name="l00968"></a>00968   <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> regval, tmp;
<a name="l00969"></a>00969 
<a name="l00970"></a>00970   <span class="keywordflow">if</span> (regno == -1)
<a name="l00971"></a>00971     {
<a name="l00972"></a>00972       <span class="keywordflow">for</span> (regno = 0;
<a name="l00973"></a>00973            regno &lt; <a class="code" href="gdbarch_8c.html#a69069435754d0b434c7043a21d247325">gdbarch_num_regs</a> (<a class="code" href="regcache_8c.html#ad4f6d0cdf256b1fa45d59a6d71b50659">get_regcache_arch</a> (regcache));
<a name="l00974"></a>00974            regno++)
<a name="l00975"></a>00975         m32r_store_register (ops, regcache, regno);
<a name="l00976"></a>00976     }
<a name="l00977"></a>00977   <span class="keywordflow">else</span>
<a name="l00978"></a>00978     {
<a name="l00979"></a>00979       <a class="code" href="regcache_8c.html#a959a077d769de1641d4f9754cc7b4a1f">regcache_cooked_read_unsigned</a> (regcache, regno, &amp;regval);
<a name="l00980"></a>00980       regid = get_reg_id (regno);
<a name="l00981"></a>00981 
<a name="l00982"></a>00982       <span class="keywordflow">if</span> (regid == <a class="code" href="remote-m32r-sdi_8c.html#a530a5a29c26a05d18d17a474bbe2eec3">SDI_REG_PSW</a>)
<a name="l00983"></a>00983         {
<a name="l00984"></a>00984           <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> psw, bbpsw;
<a name="l00985"></a>00985 
<a name="l00986"></a>00986           send_one_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a7bdb53a493108e405c091d8ee167fc5e">SDI_READ_CPU_REG</a>, <a class="code" href="remote-m32r-sdi_8c.html#a530a5a29c26a05d18d17a474bbe2eec3">SDI_REG_PSW</a>);
<a name="l00987"></a>00987           psw = recv_long_data ();
<a name="l00988"></a>00988 
<a name="l00989"></a>00989           send_one_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a7bdb53a493108e405c091d8ee167fc5e">SDI_READ_CPU_REG</a>, <a class="code" href="remote-m32r-sdi_8c.html#ac8b8df23322fae346f1ad43d3e8d6f91">SDI_REG_BBPSW</a>);
<a name="l00990"></a>00990           bbpsw = recv_long_data ();
<a name="l00991"></a>00991 
<a name="l00992"></a>00992           tmp = (0x00cf &amp; psw) | ((0x00cf &amp; regval) &lt;&lt; 8);
<a name="l00993"></a>00993           send_two_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a78d1521eda3d95caf7e41c9cf8f3ea8c">SDI_WRITE_CPU_REG</a>, <a class="code" href="remote-m32r-sdi_8c.html#a530a5a29c26a05d18d17a474bbe2eec3">SDI_REG_PSW</a>, tmp);
<a name="l00994"></a>00994 
<a name="l00995"></a>00995           tmp = (0x0030 &amp; bbpsw) | ((0xcf00 &amp; regval) &gt;&gt; 8);
<a name="l00996"></a>00996           send_two_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a78d1521eda3d95caf7e41c9cf8f3ea8c">SDI_WRITE_CPU_REG</a>, <a class="code" href="remote-m32r-sdi_8c.html#ac8b8df23322fae346f1ad43d3e8d6f91">SDI_REG_BBPSW</a>, tmp);
<a name="l00997"></a>00997         }
<a name="l00998"></a>00998       <span class="keywordflow">else</span>
<a name="l00999"></a>00999         {
<a name="l01000"></a>01000           send_two_arg_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a78d1521eda3d95caf7e41c9cf8f3ea8c">SDI_WRITE_CPU_REG</a>, regid, regval);
<a name="l01001"></a>01001         }
<a name="l01002"></a>01002 
<a name="l01003"></a>01003       <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l01004"></a>01004         <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;m32r_store_register(%d,0x%08lu)\n&quot;</span>,
<a name="l01005"></a>01005                             regno, (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) regval);
<a name="l01006"></a>01006     }
<a name="l01007"></a>01007 }
<a name="l01008"></a>01008 
<a name="l01009"></a>01009 <span class="comment">/* Get ready to modify the registers array.  On machines which store</span>
<a name="l01010"></a>01010 <span class="comment">   individual registers, this doesn&#39;t need to do anything.  On machines</span>
<a name="l01011"></a>01011 <span class="comment">   which store all the registers in one fell swoop, this makes sure</span>
<a name="l01012"></a>01012 <span class="comment">   that registers contains all the registers from the program being</span>
<a name="l01013"></a>01013 <span class="comment">   debugged.  */</span>
<a name="l01014"></a>01014 
<a name="l01015"></a>01015 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01016"></a>01016 m32r_prepare_to_store (<span class="keyword">struct</span> regcache *regcache)
<a name="l01017"></a>01017 {
<a name="l01018"></a>01018   <span class="comment">/* Do nothing, since we can store individual regs.  */</span>
<a name="l01019"></a>01019   <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l01020"></a>01020     <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;m32r_prepare_to_store()\n&quot;</span>);
<a name="l01021"></a>01021 }
<a name="l01022"></a>01022 
<a name="l01023"></a>01023 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01024"></a>01024 m32r_files_info (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *target)
<a name="l01025"></a>01025 {
<a name="l01026"></a>01026   <span class="keyword">const</span> <span class="keywordtype">char</span> *file = <span class="stringliteral">&quot;nothing&quot;</span>;
<a name="l01027"></a>01027 
<a name="l01028"></a>01028   <span class="keywordflow">if</span> (<a class="code" href="exec_8h.html#ac2e2e739fca42163e235e8521b9fbbab">exec_bfd</a>)
<a name="l01029"></a>01029     {
<a name="l01030"></a>01030       file = bfd_get_filename (<a class="code" href="exec_8h.html#ac2e2e739fca42163e235e8521b9fbbab">exec_bfd</a>);
<a name="l01031"></a>01031       <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;\tAttached to %s running program %s\n&quot;</span>,
<a name="l01032"></a>01032                        chip_name, file);
<a name="l01033"></a>01033     }
<a name="l01034"></a>01034 }
<a name="l01035"></a>01035 
<a name="l01036"></a>01036 <span class="comment">/* Read/Write memory.  */</span>
<a name="l01037"></a>01037 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01038"></a>01038 m32r_xfer_memory (<a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> <a class="code" href="exec_8h.html#ab268c3184bf49615e16de006a296a542">memaddr</a>, <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *myaddr, <span class="keywordtype">int</span> len,
<a name="l01039"></a>01039                   <span class="keywordtype">int</span> write,
<a name="l01040"></a>01040                   <span class="keyword">struct</span> <a class="code" href="structmem__attrib.html">mem_attrib</a> *attrib, <span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *target)
<a name="l01041"></a>01041 {
<a name="l01042"></a>01042   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> taddr;
<a name="l01043"></a>01043   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buf[0x2000];
<a name="l01044"></a>01044   <span class="keywordtype">int</span> ret, c;
<a name="l01045"></a>01045 
<a name="l01046"></a>01046   taddr = <a class="code" href="exec_8h.html#ab268c3184bf49615e16de006a296a542">memaddr</a>;
<a name="l01047"></a>01047 
<a name="l01048"></a>01048   <span class="keywordflow">if</span> (!mmu_on)
<a name="l01049"></a>01049     {
<a name="l01050"></a>01050       <span class="keywordflow">if</span> ((taddr &amp; 0xa0000000) == 0x80000000)
<a name="l01051"></a>01051         taddr &amp;= 0x7fffffff;
<a name="l01052"></a>01052     }
<a name="l01053"></a>01053 
<a name="l01054"></a>01054   <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l01055"></a>01055     {
<a name="l01056"></a>01056       <span class="keywordflow">if</span> (write)
<a name="l01057"></a>01057         <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;m32r_xfer_memory(%s,%d,write)\n&quot;</span>,
<a name="l01058"></a>01058                             <a class="code" href="utils_8c.html#ab5c76d72090f01d3848b63dda4e37d1c">paddress</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> (), memaddr), len);
<a name="l01059"></a>01059       <span class="keywordflow">else</span>
<a name="l01060"></a>01060         <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;m32r_xfer_memory(%s,%d,read)\n&quot;</span>,
<a name="l01061"></a>01061                             <a class="code" href="utils_8c.html#ab5c76d72090f01d3848b63dda4e37d1c">paddress</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> (), memaddr), len);
<a name="l01062"></a>01062     }
<a name="l01063"></a>01063 
<a name="l01064"></a>01064   <span class="keywordflow">if</span> (write)
<a name="l01065"></a>01065     {
<a name="l01066"></a>01066       buf[0] = <a class="code" href="remote-m32r-sdi_8c.html#a93dd7f491f7a7ac6206d79a4dd73f58b">SDI_WRITE_MEMORY</a>;
<a name="l01067"></a>01067       store_long_parameter (buf + 1, taddr);
<a name="l01068"></a>01068       store_long_parameter (buf + 5, len);
<a name="l01069"></a>01069       <span class="keywordflow">if</span> (len &lt; 0x1000)
<a name="l01070"></a>01070         {
<a name="l01071"></a>01071           <a class="code" href="gdb__string_8h.html#a39ebe6a4e122707997e78b549a1e8c5e">memcpy</a> (buf + 9, myaddr, len);
<a name="l01072"></a>01072           ret = send_data (buf, len + 9) - 9;
<a name="l01073"></a>01073         }
<a name="l01074"></a>01074       <span class="keywordflow">else</span>
<a name="l01075"></a>01075         {
<a name="l01076"></a>01076           <span class="keywordflow">if</span> (<a class="code" href="serial_8c.html#a60477906c21a815cb7c71503e1acdc35">serial_write</a> (sdi_desc, buf, 9) != 0)
<a name="l01077"></a>01077             {
<a name="l01078"></a>01078               <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l01079"></a>01079                 <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>,
<a name="l01080"></a>01080                                     <span class="stringliteral">&quot;m32r_xfer_memory() failed\n&quot;</span>);
<a name="l01081"></a>01081               <span class="keywordflow">return</span> 0;
<a name="l01082"></a>01082             }
<a name="l01083"></a>01083           ret = send_data (myaddr, len);
<a name="l01084"></a>01084         }
<a name="l01085"></a>01085     }
<a name="l01086"></a>01086   <span class="keywordflow">else</span>
<a name="l01087"></a>01087     {
<a name="l01088"></a>01088       buf[0] = <a class="code" href="remote-m32r-sdi_8c.html#ab11af9ddf5e11a8f0a495b2b5ca79b79">SDI_READ_MEMORY</a>;
<a name="l01089"></a>01089       store_long_parameter (buf + 1, taddr);
<a name="l01090"></a>01090       store_long_parameter (buf + 5, len);
<a name="l01091"></a>01091       <span class="keywordflow">if</span> (<a class="code" href="serial_8c.html#a60477906c21a815cb7c71503e1acdc35">serial_write</a> (sdi_desc, buf, 9) != 0)
<a name="l01092"></a>01092         {
<a name="l01093"></a>01093           <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l01094"></a>01094             <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;m32r_xfer_memory() failed\n&quot;</span>);
<a name="l01095"></a>01095           <span class="keywordflow">return</span> 0;
<a name="l01096"></a>01096         }
<a name="l01097"></a>01097 
<a name="l01098"></a>01098       c = <a class="code" href="serial_8c.html#aa36fd875c1c5bbb220faa370e965acd7">serial_readchar</a> (sdi_desc, <a class="code" href="remote-m32r-sdi_8c.html#afdfc7e62456a50146cda3faaa6ba3cd3">SDI_TIMEOUT</a>);
<a name="l01099"></a>01099       <span class="keywordflow">if</span> (c &lt; 0 || c == <span class="charliteral">&#39;-&#39;</span>)
<a name="l01100"></a>01100         {
<a name="l01101"></a>01101           <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l01102"></a>01102             <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;m32r_xfer_memory() failed\n&quot;</span>);
<a name="l01103"></a>01103           <span class="keywordflow">return</span> 0;
<a name="l01104"></a>01104         }
<a name="l01105"></a>01105 
<a name="l01106"></a>01106       ret = recv_data (myaddr, len);
<a name="l01107"></a>01107     }
<a name="l01108"></a>01108 
<a name="l01109"></a>01109   <span class="keywordflow">if</span> (ret &lt;= 0)
<a name="l01110"></a>01110     {
<a name="l01111"></a>01111       <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l01112"></a>01112         <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;m32r_xfer_memory() fails\n&quot;</span>);
<a name="l01113"></a>01113       <span class="keywordflow">return</span> 0;
<a name="l01114"></a>01114     }
<a name="l01115"></a>01115 
<a name="l01116"></a>01116   <span class="keywordflow">return</span> ret;
<a name="l01117"></a>01117 }
<a name="l01118"></a>01118 
<a name="l01119"></a>01119 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01120"></a>01120 m32r_kill (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *ops)
<a name="l01121"></a>01121 {
<a name="l01122"></a>01122   <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l01123"></a>01123     <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;m32r_kill()\n&quot;</span>);
<a name="l01124"></a>01124 
<a name="l01125"></a>01125   <a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a> = <a class="code" href="ptid_8c.html#acba69c857786546b204883bbcc90a64e">null_ptid</a>;
<a name="l01126"></a>01126   <a class="code" href="gdbthread_8h.html#af1d382a6b63612246df3963cb93c797d">delete_thread_silent</a> (remote_m32r_ptid);
<a name="l01127"></a>01127 
<a name="l01128"></a>01128   <span class="keywordflow">return</span>;
<a name="l01129"></a>01129 }
<a name="l01130"></a>01130 
<a name="l01131"></a>01131 <span class="comment">/* Clean up when a program exits.</span>
<a name="l01132"></a>01132 <span class="comment"></span>
<a name="l01133"></a>01133 <span class="comment">   The program actually lives on in the remote processor&#39;s RAM, and may be</span>
<a name="l01134"></a>01134 <span class="comment">   run again without a download.  Don&#39;t leave it full of breakpoint</span>
<a name="l01135"></a>01135 <span class="comment">   instructions.  */</span>
<a name="l01136"></a>01136 
<a name="l01137"></a>01137 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01138"></a>01138 m32r_mourn_inferior (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *ops)
<a name="l01139"></a>01139 {
<a name="l01140"></a>01140   <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l01141"></a>01141     <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;m32r_mourn_inferior()\n&quot;</span>);
<a name="l01142"></a>01142 
<a name="l01143"></a>01143   <a class="code" href="breakpoint_8c.html#a2db16b74521896c3272f36c1b09c28e6">remove_breakpoints</a> ();
<a name="l01144"></a>01144   <a class="code" href="inferior_8h.html#a9a32ba9b0213fdcd9dbf83969884ebcd">generic_mourn_inferior</a> ();
<a name="l01145"></a>01145 }
<a name="l01146"></a>01146 
<a name="l01147"></a>01147 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01148"></a>01148 m32r_insert_breakpoint (<span class="keyword">struct</span> gdbarch *gdbarch,
<a name="l01149"></a>01149                         <span class="keyword">struct</span> <a class="code" href="structbp__target__info.html">bp_target_info</a> *bp_tgt)
<a name="l01150"></a>01150 {
<a name="l01151"></a>01151   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> addr = bp_tgt-&gt;<a class="code" href="structbp__target__info.html#a8e3d47e670e13db11873c3ff52934fbb">placed_address</a>;
<a name="l01152"></a>01152   <span class="keywordtype">int</span> ib_breakpoints;
<a name="l01153"></a>01153   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buf[13];
<a name="l01154"></a>01154   <span class="keywordtype">int</span> i, c;
<a name="l01155"></a>01155 
<a name="l01156"></a>01156   <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l01157"></a>01157     <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;m32r_insert_breakpoint(%s,...)\n&quot;</span>,
<a name="l01158"></a>01158                         <a class="code" href="utils_8c.html#ab5c76d72090f01d3848b63dda4e37d1c">paddress</a> (gdbarch, addr));
<a name="l01159"></a>01159 
<a name="l01160"></a>01160   <span class="keywordflow">if</span> (use_ib_breakpoints)
<a name="l01161"></a>01161     ib_breakpoints = max_ib_breakpoints;
<a name="l01162"></a>01162   <span class="keywordflow">else</span>
<a name="l01163"></a>01163     ib_breakpoints = 0;
<a name="l01164"></a>01164 
<a name="l01165"></a>01165   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="remote-m32r-sdi_8c.html#a996fc495c80dc29ca7641d887ae4a462">MAX_BREAKPOINTS</a>; i++)
<a name="l01166"></a>01166     {
<a name="l01167"></a>01167       <span class="keywordflow">if</span> (bp_address[i] == 0xffffffff)
<a name="l01168"></a>01168         {
<a name="l01169"></a>01169           bp_address[i] = addr;
<a name="l01170"></a>01170           <span class="keywordflow">if</span> (i &gt;= ib_breakpoints)
<a name="l01171"></a>01171             {
<a name="l01172"></a>01172               buf[0] = <a class="code" href="remote-m32r-sdi_8c.html#ab11af9ddf5e11a8f0a495b2b5ca79b79">SDI_READ_MEMORY</a>;
<a name="l01173"></a>01173               <span class="keywordflow">if</span> (mmu_on)
<a name="l01174"></a>01174                 store_long_parameter (buf + 1, addr &amp; 0xfffffffc);
<a name="l01175"></a>01175               <span class="keywordflow">else</span>
<a name="l01176"></a>01176                 store_long_parameter (buf + 1, addr &amp; 0x7ffffffc);
<a name="l01177"></a>01177               store_long_parameter (buf + 5, 4);
<a name="l01178"></a>01178               <a class="code" href="serial_8c.html#a60477906c21a815cb7c71503e1acdc35">serial_write</a> (sdi_desc, buf, 9);
<a name="l01179"></a>01179               c = <a class="code" href="serial_8c.html#aa36fd875c1c5bbb220faa370e965acd7">serial_readchar</a> (sdi_desc, <a class="code" href="remote-m32r-sdi_8c.html#afdfc7e62456a50146cda3faaa6ba3cd3">SDI_TIMEOUT</a>);
<a name="l01180"></a>01180               <span class="keywordflow">if</span> (c != <span class="charliteral">&#39;-&#39;</span>)
<a name="l01181"></a>01181                 recv_data (bp_data[i], 4);
<a name="l01182"></a>01182             }
<a name="l01183"></a>01183           <span class="keywordflow">return</span> 0;
<a name="l01184"></a>01184         }
<a name="l01185"></a>01185     }
<a name="l01186"></a>01186 
<a name="l01187"></a>01187   <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Too many breakpoints&quot;</span>));
<a name="l01188"></a>01188   <span class="keywordflow">return</span> 1;
<a name="l01189"></a>01189 }
<a name="l01190"></a>01190 
<a name="l01191"></a>01191 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01192"></a>01192 m32r_remove_breakpoint (<span class="keyword">struct</span> gdbarch *gdbarch,
<a name="l01193"></a>01193                         <span class="keyword">struct</span> <a class="code" href="structbp__target__info.html">bp_target_info</a> *bp_tgt)
<a name="l01194"></a>01194 {
<a name="l01195"></a>01195   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> addr = bp_tgt-&gt;<a class="code" href="structbp__target__info.html#a8e3d47e670e13db11873c3ff52934fbb">placed_address</a>;
<a name="l01196"></a>01196   <span class="keywordtype">int</span> i;
<a name="l01197"></a>01197 
<a name="l01198"></a>01198   <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l01199"></a>01199     <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;m32r_remove_breakpoint(%s)\n&quot;</span>,
<a name="l01200"></a>01200                         <a class="code" href="utils_8c.html#ab5c76d72090f01d3848b63dda4e37d1c">paddress</a> (gdbarch, addr));
<a name="l01201"></a>01201 
<a name="l01202"></a>01202   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="remote-m32r-sdi_8c.html#a996fc495c80dc29ca7641d887ae4a462">MAX_BREAKPOINTS</a>; i++)
<a name="l01203"></a>01203     {
<a name="l01204"></a>01204       <span class="keywordflow">if</span> (bp_address[i] == addr)
<a name="l01205"></a>01205         {
<a name="l01206"></a>01206           bp_address[i] = 0xffffffff;
<a name="l01207"></a>01207           <span class="keywordflow">break</span>;
<a name="l01208"></a>01208         }
<a name="l01209"></a>01209     }
<a name="l01210"></a>01210 
<a name="l01211"></a>01211   <span class="keywordflow">return</span> 0;
<a name="l01212"></a>01212 }
<a name="l01213"></a>01213 
<a name="l01214"></a>01214 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01215"></a>01215 m32r_load (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l01216"></a>01216 {
<a name="l01217"></a>01217   <span class="keyword">struct </span>cleanup *old_chain;
<a name="l01218"></a>01218   asection *section;
<a name="l01219"></a>01219   bfd *pbfd;
<a name="l01220"></a>01220   bfd_vma entry;
<a name="l01221"></a>01221   <span class="keywordtype">char</span> *filename;
<a name="l01222"></a>01222   <span class="keywordtype">int</span> quiet;
<a name="l01223"></a>01223   <span class="keywordtype">int</span> nostart;
<a name="l01224"></a>01224   <span class="keyword">struct </span>timeval start_time, end_time;
<a name="l01225"></a>01225   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> data_count;     <span class="comment">/* Number of bytes transferred to memory.  */</span>
<a name="l01226"></a>01226   <span class="keyword">static</span> <a class="code" href="config_8h.html#adbe5dcee9c146b338794974137c55e70">RETSIGTYPE</a> (*prev_sigint) ();
<a name="l01227"></a>01227 
<a name="l01228"></a>01228   <span class="comment">/* for direct tcp connections, we can do a fast binary download.  */</span>
<a name="l01229"></a>01229   quiet = 0;
<a name="l01230"></a>01230   nostart = 0;
<a name="l01231"></a>01231   filename = NULL;
<a name="l01232"></a>01232 
<a name="l01233"></a>01233   <span class="keywordflow">while</span> (*args != <span class="charliteral">&#39;\000&#39;</span>)
<a name="l01234"></a>01234     {
<a name="l01235"></a>01235       <span class="keywordtype">char</span> *arg;
<a name="l01236"></a>01236 
<a name="l01237"></a>01237       args = <a class="code" href="cli-utils_8c.html#afa70bcaee54d487b4412d2a7a5a0c8fa">skip_spaces</a> (args);
<a name="l01238"></a>01238 
<a name="l01239"></a>01239       arg = args;
<a name="l01240"></a>01240 
<a name="l01241"></a>01241       <span class="keywordflow">while</span> ((*args != <span class="charliteral">&#39;\000&#39;</span>) &amp;&amp; !isspace (*args))
<a name="l01242"></a>01242         args++;
<a name="l01243"></a>01243 
<a name="l01244"></a>01244       <span class="keywordflow">if</span> (*args != <span class="charliteral">&#39;\000&#39;</span>)
<a name="l01245"></a>01245         *args++ = <span class="charliteral">&#39;\000&#39;</span>;
<a name="l01246"></a>01246 
<a name="l01247"></a>01247       <span class="keywordflow">if</span> (*arg != <span class="charliteral">&#39;-&#39;</span>)
<a name="l01248"></a>01248         filename = arg;
<a name="l01249"></a>01249       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (arg, <span class="stringliteral">&quot;-quiet&quot;</span>, strlen (arg)) == 0)
<a name="l01250"></a>01250         quiet = 1;
<a name="l01251"></a>01251       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (arg, <span class="stringliteral">&quot;-nostart&quot;</span>, strlen (arg)) == 0)
<a name="l01252"></a>01252         nostart = 1;
<a name="l01253"></a>01253       <span class="keywordflow">else</span>
<a name="l01254"></a>01254         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Unknown option `%s&#39;&quot;</span>), arg);
<a name="l01255"></a>01255     }
<a name="l01256"></a>01256 
<a name="l01257"></a>01257   <span class="keywordflow">if</span> (!filename)
<a name="l01258"></a>01258     filename = <a class="code" href="corefile_8c.html#a4e814b1531684005d22fea3e17f1781d">get_exec_file</a> (1);
<a name="l01259"></a>01259 
<a name="l01260"></a>01260   pbfd = <a class="code" href="gdb__bfd_8c.html#a5ba645a00a78462b46b2d0c3445eb988">gdb_bfd_open</a> (filename, <a class="code" href="corefile_8c.html#aa6db5afe2b3bfa2cec356b9e68eea21d">gnutarget</a>, -1);
<a name="l01261"></a>01261   <span class="keywordflow">if</span> (pbfd == NULL)
<a name="l01262"></a>01262     {
<a name="l01263"></a>01263       <a class="code" href="utils_8c.html#a14801ceb45147833b8ce111c89ea0d5f">perror_with_name</a> (filename);
<a name="l01264"></a>01264       <span class="keywordflow">return</span>;
<a name="l01265"></a>01265     }
<a name="l01266"></a>01266   old_chain = <a class="code" href="utils_8c.html#aefcbd004e34c553d07ce2a6b4a196852">make_cleanup_bfd_unref</a> (pbfd);
<a name="l01267"></a>01267 
<a name="l01268"></a>01268   <span class="keywordflow">if</span> (!bfd_check_format (pbfd, bfd_object))
<a name="l01269"></a>01269     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\&quot;%s\&quot; is not an object file: %s&quot;</span>), filename,
<a name="l01270"></a>01270            bfd_errmsg (bfd_get_error ()));
<a name="l01271"></a>01271 
<a name="l01272"></a>01272   gettimeofday (&amp;start_time, NULL);
<a name="l01273"></a>01273   data_count = 0;
<a name="l01274"></a>01274 
<a name="l01275"></a>01275   interrupted = 0;
<a name="l01276"></a>01276   prev_sigint = signal (SIGINT, gdb_cntrl_c);
<a name="l01277"></a>01277 
<a name="l01278"></a>01278   <span class="keywordflow">for</span> (section = pbfd-&gt;sections; section; section = section-&gt;next)
<a name="l01279"></a>01279     {
<a name="l01280"></a>01280       <span class="keywordflow">if</span> (bfd_get_section_flags (pbfd, section) &amp; SEC_LOAD)
<a name="l01281"></a>01281         {
<a name="l01282"></a>01282           bfd_vma section_address;
<a name="l01283"></a>01283           bfd_size_type section_size;
<a name="l01284"></a>01284           file_ptr fptr;
<a name="l01285"></a>01285           <span class="keywordtype">int</span> n;
<a name="l01286"></a>01286 
<a name="l01287"></a>01287           section_address = bfd_section_lma (pbfd, section);
<a name="l01288"></a>01288           section_size = bfd_get_section_size (section);
<a name="l01289"></a>01289 
<a name="l01290"></a>01290           <span class="keywordflow">if</span> (!mmu_on)
<a name="l01291"></a>01291             {
<a name="l01292"></a>01292               <span class="keywordflow">if</span> ((section_address &amp; 0xa0000000) == 0x80000000)
<a name="l01293"></a>01293                 section_address &amp;= 0x7fffffff;
<a name="l01294"></a>01294             }
<a name="l01295"></a>01295 
<a name="l01296"></a>01296           <span class="keywordflow">if</span> (!quiet)
<a name="l01297"></a>01297             <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;[Loading section %s at 0x%lx (%d bytes)]\n&quot;</span>,
<a name="l01298"></a>01298                              bfd_get_section_name (pbfd, section),
<a name="l01299"></a>01299                              (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) section_address,
<a name="l01300"></a>01300                              (<span class="keywordtype">int</span>) section_size);
<a name="l01301"></a>01301 
<a name="l01302"></a>01302           fptr = 0;
<a name="l01303"></a>01303 
<a name="l01304"></a>01304           data_count += section_size;
<a name="l01305"></a>01305 
<a name="l01306"></a>01306           n = 0;
<a name="l01307"></a>01307           <span class="keywordflow">while</span> (section_size &gt; 0)
<a name="l01308"></a>01308             {
<a name="l01309"></a>01309               <span class="keywordtype">char</span> <span class="keywordtype">unsigned</span> buf[0x1000 + 9];
<a name="l01310"></a>01310               <span class="keywordtype">int</span> count;
<a name="l01311"></a>01311 
<a name="l01312"></a>01312               count = <a class="code" href="environ_8c.html#ac6afabdc09a49a433ee19d8a9486056d">min</a> (section_size, 0x1000);
<a name="l01313"></a>01313 
<a name="l01314"></a>01314               buf[0] = <a class="code" href="remote-m32r-sdi_8c.html#a93dd7f491f7a7ac6206d79a4dd73f58b">SDI_WRITE_MEMORY</a>;
<a name="l01315"></a>01315               store_long_parameter (buf + 1, section_address);
<a name="l01316"></a>01316               store_long_parameter (buf + 5, count);
<a name="l01317"></a>01317 
<a name="l01318"></a>01318               bfd_get_section_contents (pbfd, section, buf + 9, fptr, count);
<a name="l01319"></a>01319               <span class="keywordflow">if</span> (send_data (buf, count + 9) &lt;= 0)
<a name="l01320"></a>01320                 <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Error while downloading %s section.&quot;</span>),
<a name="l01321"></a>01321                        bfd_get_section_name (pbfd, section));
<a name="l01322"></a>01322 
<a name="l01323"></a>01323               <span class="keywordflow">if</span> (!quiet)
<a name="l01324"></a>01324                 {
<a name="l01325"></a>01325                   <a class="code" href="utils_8c.html#ad57145632bbcb0361dc1dfa134b1efd0">printf_unfiltered</a> (<span class="stringliteral">&quot;.&quot;</span>);
<a name="l01326"></a>01326                   <span class="keywordflow">if</span> (n++ &gt; 60)
<a name="l01327"></a>01327                     {
<a name="l01328"></a>01328                       <a class="code" href="utils_8c.html#ad57145632bbcb0361dc1dfa134b1efd0">printf_unfiltered</a> (<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01329"></a>01329                       n = 0;
<a name="l01330"></a>01330                     }
<a name="l01331"></a>01331                   <a class="code" href="ui-file_8c.html#a046f07b5ef1bcc35c28b4be983e39998">gdb_flush</a> (<a class="code" href="main_8c.html#a41a2b997ba5454df787d61f051dd918c">gdb_stdout</a>);
<a name="l01332"></a>01332                 }
<a name="l01333"></a>01333 
<a name="l01334"></a>01334               section_address += count;
<a name="l01335"></a>01335               fptr += count;
<a name="l01336"></a>01336               section_size -= count;
<a name="l01337"></a>01337 
<a name="l01338"></a>01338               <span class="keywordflow">if</span> (interrupted)
<a name="l01339"></a>01339                 <span class="keywordflow">break</span>;
<a name="l01340"></a>01340             }
<a name="l01341"></a>01341 
<a name="l01342"></a>01342           <span class="keywordflow">if</span> (!quiet &amp;&amp; !interrupted)
<a name="l01343"></a>01343             {
<a name="l01344"></a>01344               <a class="code" href="utils_8c.html#ad57145632bbcb0361dc1dfa134b1efd0">printf_unfiltered</a> (<span class="stringliteral">&quot;done.\n&quot;</span>);
<a name="l01345"></a>01345               <a class="code" href="ui-file_8c.html#a046f07b5ef1bcc35c28b4be983e39998">gdb_flush</a> (<a class="code" href="main_8c.html#a41a2b997ba5454df787d61f051dd918c">gdb_stdout</a>);
<a name="l01346"></a>01346             }
<a name="l01347"></a>01347         }
<a name="l01348"></a>01348 
<a name="l01349"></a>01349       <span class="keywordflow">if</span> (interrupted)
<a name="l01350"></a>01350         {
<a name="l01351"></a>01351           <a class="code" href="utils_8c.html#ad57145632bbcb0361dc1dfa134b1efd0">printf_unfiltered</a> (<span class="stringliteral">&quot;Interrupted.\n&quot;</span>);
<a name="l01352"></a>01352           <span class="keywordflow">break</span>;
<a name="l01353"></a>01353         }
<a name="l01354"></a>01354     }
<a name="l01355"></a>01355 
<a name="l01356"></a>01356   interrupted = 0;
<a name="l01357"></a>01357   signal (SIGINT, prev_sigint);
<a name="l01358"></a>01358 
<a name="l01359"></a>01359   gettimeofday (&amp;end_time, NULL);
<a name="l01360"></a>01360 
<a name="l01361"></a>01361   <span class="comment">/* Make the PC point at the start address.  */</span>
<a name="l01362"></a>01362   <span class="keywordflow">if</span> (<a class="code" href="exec_8h.html#ac2e2e739fca42163e235e8521b9fbbab">exec_bfd</a>)
<a name="l01363"></a>01363     <a class="code" href="regcache_8c.html#ab2bc5dc8948a1ae0b5efb4e2503375b8">regcache_write_pc</a> (<a class="code" href="regcache_8c.html#a09a386286dc22d882378f639630fecef">get_current_regcache</a> (),
<a name="l01364"></a>01364                        bfd_get_start_address (<a class="code" href="exec_8h.html#ac2e2e739fca42163e235e8521b9fbbab">exec_bfd</a>));
<a name="l01365"></a>01365 
<a name="l01366"></a>01366   <a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a> = <a class="code" href="ptid_8c.html#acba69c857786546b204883bbcc90a64e">null_ptid</a>;    <span class="comment">/* No process now.  */</span>
<a name="l01367"></a>01367   <a class="code" href="gdbthread_8h.html#af1d382a6b63612246df3963cb93c797d">delete_thread_silent</a> (remote_m32r_ptid);
<a name="l01368"></a>01368 
<a name="l01369"></a>01369   <span class="comment">/* This is necessary because many things were based on the PC at the time</span>
<a name="l01370"></a>01370 <span class="comment">     that we attached to the monitor, which is no longer valid now that we</span>
<a name="l01371"></a>01371 <span class="comment">     have loaded new code (and just changed the PC).  Another way to do this</span>
<a name="l01372"></a>01372 <span class="comment">     might be to call normal_stop, except that the stack may not be valid,</span>
<a name="l01373"></a>01373 <span class="comment">     and things would get horribly confused...  */</span>
<a name="l01374"></a>01374 
<a name="l01375"></a>01375   <a class="code" href="symfile_8c.html#a872e7a71713c1059f667bb1be5948643">clear_symtab_users</a> (0);
<a name="l01376"></a>01376 
<a name="l01377"></a>01377   <span class="keywordflow">if</span> (!nostart)
<a name="l01378"></a>01378     {
<a name="l01379"></a>01379       entry = bfd_get_start_address (pbfd);
<a name="l01380"></a>01380 
<a name="l01381"></a>01381       <span class="keywordflow">if</span> (!quiet)
<a name="l01382"></a>01382         <a class="code" href="utils_8c.html#ad57145632bbcb0361dc1dfa134b1efd0">printf_unfiltered</a> (<span class="stringliteral">&quot;[Starting %s at 0x%lx]\n&quot;</span>, filename,
<a name="l01383"></a>01383                            (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>) entry);
<a name="l01384"></a>01384     }
<a name="l01385"></a>01385 
<a name="l01386"></a>01386   <a class="code" href="defs_8h.html#a9c33386f322615c9c72a2713be67cf24">print_transfer_performance</a> (<a class="code" href="main_8c.html#a41a2b997ba5454df787d61f051dd918c">gdb_stdout</a>, data_count, 0, &amp;start_time,
<a name="l01387"></a>01387                               &amp;end_time);
<a name="l01388"></a>01388 
<a name="l01389"></a>01389   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l01390"></a>01390 }
<a name="l01391"></a>01391 
<a name="l01392"></a>01392 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01393"></a>01393 m32r_stop (<a class="code" href="structptid.html">ptid_t</a> ptid)
<a name="l01394"></a>01394 {
<a name="l01395"></a>01395   <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l01396"></a>01396     <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;m32r_stop()\n&quot;</span>);
<a name="l01397"></a>01397 
<a name="l01398"></a>01398   send_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a82ef2d0cc2b6e09224ef91fe77aeeb0d">SDI_STOP_CPU</a>);
<a name="l01399"></a>01399 
<a name="l01400"></a>01400   <span class="keywordflow">return</span>;
<a name="l01401"></a>01401 }
<a name="l01402"></a>01402 
<a name="l01403"></a>01403 
<a name="l01404"></a>01404 <span class="comment">/* Tell whether this target can support a hardware breakpoint.  CNT</span>
<a name="l01405"></a>01405 <span class="comment">   is the number of hardware breakpoints already installed.  This</span>
<a name="l01406"></a>01406 <span class="comment">   implements the target_can_use_hardware_watchpoint macro.  */</span>
<a name="l01407"></a>01407 
<a name="l01408"></a>01408 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01409"></a>01409 m32r_can_use_hw_watchpoint (<span class="keywordtype">int</span> <a class="code" href="structtype.html">type</a>, <span class="keywordtype">int</span> cnt, <span class="keywordtype">int</span> othertype)
<a name="l01410"></a>01410 {
<a name="l01411"></a>01411   <span class="keywordflow">return</span> sdi_desc != NULL &amp;&amp; cnt &lt; max_access_breaks;
<a name="l01412"></a>01412 }
<a name="l01413"></a>01413 
<a name="l01414"></a>01414 <span class="comment">/* Set a data watchpoint.  ADDR and LEN should be obvious.  TYPE is 0</span>
<a name="l01415"></a>01415 <span class="comment">   for a write watchpoint, 1 for a read watchpoint, or 2 for a read/write</span>
<a name="l01416"></a>01416 <span class="comment">   watchpoint.  */</span>
<a name="l01417"></a>01417 
<a name="l01418"></a>01418 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01419"></a>01419 m32r_insert_watchpoint (<a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> addr, <span class="keywordtype">int</span> len, <span class="keywordtype">int</span> <a class="code" href="structtype.html">type</a>,
<a name="l01420"></a>01420                         <span class="keyword">struct</span> <a class="code" href="structexpression.html">expression</a> *cond)
<a name="l01421"></a>01421 {
<a name="l01422"></a>01422   <span class="keywordtype">int</span> i;
<a name="l01423"></a>01423 
<a name="l01424"></a>01424   <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l01425"></a>01425     <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;m32r_insert_watchpoint(%s,%d,%d)\n&quot;</span>,
<a name="l01426"></a>01426                         <a class="code" href="utils_8c.html#ab5c76d72090f01d3848b63dda4e37d1c">paddress</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> (), addr), len, type);
<a name="l01427"></a>01427 
<a name="l01428"></a>01428   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="remote-m32r-sdi_8c.html#ab1669bf63379062035a09b3ad864a201">MAX_ACCESS_BREAKS</a>; i++)
<a name="l01429"></a>01429     {
<a name="l01430"></a>01430       <span class="keywordflow">if</span> (ab_address[i] == 0x00000000)
<a name="l01431"></a>01431         {
<a name="l01432"></a>01432           ab_address[i] = addr;
<a name="l01433"></a>01433           ab_size[i] = <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>;
<a name="l01434"></a>01434           ab_type[i] = type;
<a name="l01435"></a>01435           <span class="keywordflow">return</span> 0;
<a name="l01436"></a>01436         }
<a name="l01437"></a>01437     }
<a name="l01438"></a>01438 
<a name="l01439"></a>01439   <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Too many watchpoints&quot;</span>));
<a name="l01440"></a>01440   <span class="keywordflow">return</span> 1;
<a name="l01441"></a>01441 }
<a name="l01442"></a>01442 
<a name="l01443"></a>01443 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01444"></a>01444 m32r_remove_watchpoint (<a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> addr, <span class="keywordtype">int</span> len, <span class="keywordtype">int</span> type,
<a name="l01445"></a>01445                         <span class="keyword">struct</span> <a class="code" href="structexpression.html">expression</a> *cond)
<a name="l01446"></a>01446 {
<a name="l01447"></a>01447   <span class="keywordtype">int</span> i;
<a name="l01448"></a>01448 
<a name="l01449"></a>01449   <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l01450"></a>01450     <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;m32r_remove_watchpoint(%s,%d,%d)\n&quot;</span>,
<a name="l01451"></a>01451                         <a class="code" href="utils_8c.html#ab5c76d72090f01d3848b63dda4e37d1c">paddress</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> (), addr), len, type);
<a name="l01452"></a>01452 
<a name="l01453"></a>01453   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="remote-m32r-sdi_8c.html#ab1669bf63379062035a09b3ad864a201">MAX_ACCESS_BREAKS</a>; i++)
<a name="l01454"></a>01454     {
<a name="l01455"></a>01455       <span class="keywordflow">if</span> (ab_address[i] == addr)
<a name="l01456"></a>01456         {
<a name="l01457"></a>01457           ab_address[i] = 0x00000000;
<a name="l01458"></a>01458           <span class="keywordflow">break</span>;
<a name="l01459"></a>01459         }
<a name="l01460"></a>01460     }
<a name="l01461"></a>01461 
<a name="l01462"></a>01462   <span class="keywordflow">return</span> 0;
<a name="l01463"></a>01463 }
<a name="l01464"></a>01464 
<a name="l01465"></a>01465 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01466"></a>01466 m32r_stopped_data_address (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *target, <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> *addr_p)
<a name="l01467"></a>01467 {
<a name="l01468"></a>01468   <span class="keywordtype">int</span> rc = 0;
<a name="l01469"></a>01469 
<a name="l01470"></a>01470   <span class="keywordflow">if</span> (hit_watchpoint_addr != 0x00000000)
<a name="l01471"></a>01471     {
<a name="l01472"></a>01472       *addr_p = hit_watchpoint_addr;
<a name="l01473"></a>01473       rc = 1;
<a name="l01474"></a>01474     }
<a name="l01475"></a>01475   <span class="keywordflow">return</span> rc;
<a name="l01476"></a>01476 }
<a name="l01477"></a>01477 
<a name="l01478"></a>01478 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01479"></a>01479 m32r_stopped_by_watchpoint (<span class="keywordtype">void</span>)
<a name="l01480"></a>01480 {
<a name="l01481"></a>01481   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> addr;
<a name="l01482"></a>01482 
<a name="l01483"></a>01483   <span class="keywordflow">return</span> m32r_stopped_data_address (&amp;current_target, &amp;addr);
<a name="l01484"></a>01484 }
<a name="l01485"></a>01485 
<a name="l01486"></a>01486 <span class="comment">/* Check to see if a thread is still alive.  */</span>
<a name="l01487"></a>01487 
<a name="l01488"></a>01488 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01489"></a>01489 m32r_thread_alive (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *ops, <a class="code" href="structptid.html">ptid_t</a> ptid)
<a name="l01490"></a>01490 {
<a name="l01491"></a>01491   <span class="keywordflow">if</span> (<a class="code" href="ptid_8c.html#a0df58c8db2620a2cec647934b4f77266">ptid_equal</a> (ptid, remote_m32r_ptid))
<a name="l01492"></a>01492     <span class="comment">/* The main task is always alive.  */</span>
<a name="l01493"></a>01493     <span class="keywordflow">return</span> 1;
<a name="l01494"></a>01494 
<a name="l01495"></a>01495   <span class="keywordflow">return</span> 0;
<a name="l01496"></a>01496 }
<a name="l01497"></a>01497 
<a name="l01498"></a>01498 <span class="comment">/* Convert a thread ID to a string.  Returns the string in a static</span>
<a name="l01499"></a>01499 <span class="comment">   buffer.  */</span>
<a name="l01500"></a>01500 
<a name="l01501"></a>01501 <span class="keyword">static</span> <span class="keywordtype">char</span> *
<a name="l01502"></a>01502 m32r_pid_to_str (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *ops, <a class="code" href="structptid.html">ptid_t</a> ptid)
<a name="l01503"></a>01503 {
<a name="l01504"></a>01504   <span class="keyword">static</span> <span class="keywordtype">char</span> buf[64];
<a name="l01505"></a>01505 
<a name="l01506"></a>01506   <span class="keywordflow">if</span> (<a class="code" href="ptid_8c.html#a0df58c8db2620a2cec647934b4f77266">ptid_equal</a> (remote_m32r_ptid, ptid))
<a name="l01507"></a>01507     {
<a name="l01508"></a>01508       <a class="code" href="common-utils_8c.html#ad9940337ec98983dae9951c947879fc8">xsnprintf</a> (buf, <span class="keyword">sizeof</span> buf, <span class="stringliteral">&quot;Thread &lt;main&gt;&quot;</span>);
<a name="l01509"></a>01509       <span class="keywordflow">return</span> buf;
<a name="l01510"></a>01510     }
<a name="l01511"></a>01511 
<a name="l01512"></a>01512   <span class="keywordflow">return</span> <a class="code" href="target_8c.html#aa0e232d9b9de56e922b988294faa05d6">normal_pid_to_str</a> (ptid);
<a name="l01513"></a>01513 }
<a name="l01514"></a>01514 
<a name="l01515"></a>01515 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01516"></a>01516 sdireset_command (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l01517"></a>01517 {
<a name="l01518"></a>01518   <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l01519"></a>01519     <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;m32r_sdireset()\n&quot;</span>);
<a name="l01520"></a>01520 
<a name="l01521"></a>01521   send_cmd (<a class="code" href="remote-m32r-sdi_8c.html#a09d29b793e527030b3c4760407c1e0a6">SDI_OPEN</a>);
<a name="l01522"></a>01522 
<a name="l01523"></a>01523   <a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a> = <a class="code" href="ptid_8c.html#acba69c857786546b204883bbcc90a64e">null_ptid</a>;
<a name="l01524"></a>01524   <a class="code" href="gdbthread_8h.html#af1d382a6b63612246df3963cb93c797d">delete_thread_silent</a> (remote_m32r_ptid);
<a name="l01525"></a>01525 }
<a name="l01526"></a>01526 
<a name="l01527"></a>01527 
<a name="l01528"></a>01528 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01529"></a>01529 sdistatus_command (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l01530"></a>01530 {
<a name="l01531"></a>01531   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buf[4096];
<a name="l01532"></a>01532   <span class="keywordtype">int</span> i, c;
<a name="l01533"></a>01533 
<a name="l01534"></a>01534   <span class="keywordflow">if</span> (<a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a>)
<a name="l01535"></a>01535     <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;m32r_sdireset()\n&quot;</span>);
<a name="l01536"></a>01536 
<a name="l01537"></a>01537   <span class="keywordflow">if</span> (!sdi_desc)
<a name="l01538"></a>01538     <span class="keywordflow">return</span>;
<a name="l01539"></a>01539 
<a name="l01540"></a>01540   send_cmd (<a class="code" href="remote-m32r-sdi_8c.html#ad41dfe3bbe34b7ea026924e0af6c1122">SDI_STATUS</a>);
<a name="l01541"></a>01541   <span class="keywordflow">for</span> (i = 0; i &lt; 4096; i++)
<a name="l01542"></a>01542     {
<a name="l01543"></a>01543       c = <a class="code" href="serial_8c.html#aa36fd875c1c5bbb220faa370e965acd7">serial_readchar</a> (sdi_desc, <a class="code" href="remote-m32r-sdi_8c.html#afdfc7e62456a50146cda3faaa6ba3cd3">SDI_TIMEOUT</a>);
<a name="l01544"></a>01544       <span class="keywordflow">if</span> (c &lt; 0)
<a name="l01545"></a>01545         <span class="keywordflow">return</span>;
<a name="l01546"></a>01546       buf[i] = c;
<a name="l01547"></a>01547       <span class="keywordflow">if</span> (c == 0)
<a name="l01548"></a>01548         <span class="keywordflow">break</span>;
<a name="l01549"></a>01549     }
<a name="l01550"></a>01550 
<a name="l01551"></a>01551   <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;%s&quot;</span>, buf);
<a name="l01552"></a>01552 }
<a name="l01553"></a>01553 
<a name="l01554"></a>01554 
<a name="l01555"></a>01555 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01556"></a>01556 debug_chaos_command (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l01557"></a>01557 {
<a name="l01558"></a>01558   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buf[3];
<a name="l01559"></a>01559 
<a name="l01560"></a>01560   buf[0] = <a class="code" href="remote-m32r-sdi_8c.html#a6e5ba87568bbcad7b88276891f172bcf">SDI_SET_ATTR</a>;
<a name="l01561"></a>01561   buf[1] = <a class="code" href="remote-m32r-sdi_8c.html#a626490b9be4cce935dd5d3f6918baf56">SDI_ATTR_CACHE</a>;
<a name="l01562"></a>01562   buf[2] = <a class="code" href="remote-m32r-sdi_8c.html#ad17fc003a1a88966a2906e59d3723015">SDI_CACHE_TYPE_CHAOS</a>;
<a name="l01563"></a>01563   send_data (buf, 3);
<a name="l01564"></a>01564 }
<a name="l01565"></a>01565 
<a name="l01566"></a>01566 
<a name="l01567"></a>01567 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01568"></a>01568 use_debug_dma_command (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l01569"></a>01569 {
<a name="l01570"></a>01570   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buf[3];
<a name="l01571"></a>01571 
<a name="l01572"></a>01572   buf[0] = <a class="code" href="remote-m32r-sdi_8c.html#a6e5ba87568bbcad7b88276891f172bcf">SDI_SET_ATTR</a>;
<a name="l01573"></a>01573   buf[1] = <a class="code" href="remote-m32r-sdi_8c.html#ae7cab526bb346c03ae42a688ec190210">SDI_ATTR_MEM_ACCESS</a>;
<a name="l01574"></a>01574   buf[2] = <a class="code" href="remote-m32r-sdi_8c.html#a52f57dde885f964f491b82e1529f7702">SDI_MEM_ACCESS_DEBUG_DMA</a>;
<a name="l01575"></a>01575   send_data (buf, 3);
<a name="l01576"></a>01576 }
<a name="l01577"></a>01577 
<a name="l01578"></a>01578 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01579"></a>01579 use_mon_code_command (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l01580"></a>01580 {
<a name="l01581"></a>01581   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buf[3];
<a name="l01582"></a>01582 
<a name="l01583"></a>01583   buf[0] = <a class="code" href="remote-m32r-sdi_8c.html#a6e5ba87568bbcad7b88276891f172bcf">SDI_SET_ATTR</a>;
<a name="l01584"></a>01584   buf[1] = <a class="code" href="remote-m32r-sdi_8c.html#ae7cab526bb346c03ae42a688ec190210">SDI_ATTR_MEM_ACCESS</a>;
<a name="l01585"></a>01585   buf[2] = <a class="code" href="remote-m32r-sdi_8c.html#af9b3c8ebf567a0edd6cbf3f37d654149">SDI_MEM_ACCESS_MON_CODE</a>;
<a name="l01586"></a>01586   send_data (buf, 3);
<a name="l01587"></a>01587 }
<a name="l01588"></a>01588 
<a name="l01589"></a>01589 
<a name="l01590"></a>01590 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01591"></a>01591 use_ib_breakpoints_command (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l01592"></a>01592 {
<a name="l01593"></a>01593   use_ib_breakpoints = 1;
<a name="l01594"></a>01594 }
<a name="l01595"></a>01595 
<a name="l01596"></a>01596 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01597"></a>01597 use_dbt_breakpoints_command (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l01598"></a>01598 {
<a name="l01599"></a>01599   use_ib_breakpoints = 0;
<a name="l01600"></a>01600 }
<a name="l01601"></a>01601 
<a name="l01602"></a>01602 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01603"></a>01603 m32r_return_one (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *target)
<a name="l01604"></a>01604 {
<a name="l01605"></a>01605   <span class="keywordflow">return</span> 1;
<a name="l01606"></a>01606 }
<a name="l01607"></a>01607 
<a name="l01608"></a>01608 <span class="comment">/* Implementation of the to_has_execution method.  */</span>
<a name="l01609"></a>01609 
<a name="l01610"></a>01610 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01611"></a>01611 m32r_has_execution (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *target, <a class="code" href="structptid.html">ptid_t</a> the_ptid)
<a name="l01612"></a>01612 {
<a name="l01613"></a>01613   <span class="keywordflow">return</span> 1;
<a name="l01614"></a>01614 }
<a name="l01615"></a>01615 
<a name="l01616"></a>01616 <span class="comment">/* Define the target subroutine names.  */</span>
<a name="l01617"></a>01617 
<a name="l01618"></a><a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">01618</a> <span class="keyword">struct </span><a class="code" href="structtarget__ops.html">target_ops</a> <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>;
<a name="l01619"></a>01619 
<a name="l01620"></a>01620 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01621"></a>01621 init_m32r_ops (<span class="keywordtype">void</span>)
<a name="l01622"></a>01622 {
<a name="l01623"></a>01623   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#a9326c3129ee116786b1ca1a95713f125">to_shortname</a> = <span class="stringliteral">&quot;m32rsdi&quot;</span>;
<a name="l01624"></a>01624   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#a184ee9aa071d32ec535cf7394aba0bd1">to_longname</a> = <span class="stringliteral">&quot;Remote M32R debugging over SDI interface&quot;</span>;
<a name="l01625"></a>01625   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#a1b0c848329708688e3816263b16fe664">to_doc</a> = <span class="stringliteral">&quot;Use an M32R board using SDI debugging protocol.&quot;</span>;
<a name="l01626"></a>01626   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#a5a0cfeca4b463ea49d8c2f5913a93eae">to_open</a> = m32r_open;
<a name="l01627"></a>01627   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#a3a192fb4ed386bc561179111e53b5ccb">to_close</a> = m32r_close;
<a name="l01628"></a>01628   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#a2749c09156c21e635d6860af415b7a52">to_detach</a> = m32r_detach;
<a name="l01629"></a>01629   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#a969e77ba44f2d253e041d3b24dde8c87">to_resume</a> = m32r_resume;
<a name="l01630"></a>01630   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#ae8e22dbcc8522f0daac3fc8ed2661ca1">to_wait</a> = m32r_wait;
<a name="l01631"></a>01631   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#a117d2a74c4c794d5b309b106a413ef10">to_fetch_registers</a> = m32r_fetch_register;
<a name="l01632"></a>01632   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#a755da40b533b1467a0583a5c8e91a400">to_store_registers</a> = m32r_store_register;
<a name="l01633"></a>01633   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#abdb55efb6b0e0ad9c481f99da56b26a9">to_prepare_to_store</a> = m32r_prepare_to_store;
<a name="l01634"></a>01634   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#a64b004350c177cdbdde9b311226f397b">deprecated_xfer_memory</a> = m32r_xfer_memory;
<a name="l01635"></a>01635   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#a2cb65189c2ab4edb8dbe4f18adcaaf78">to_files_info</a> = m32r_files_info;
<a name="l01636"></a>01636   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#a5dc36c9743ec74fedbd285cbb4e55c57">to_insert_breakpoint</a> = m32r_insert_breakpoint;
<a name="l01637"></a>01637   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#a16e49fec6924ab7dc500d3343fc90e33">to_remove_breakpoint</a> = m32r_remove_breakpoint;
<a name="l01638"></a>01638   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#a7a1a220e1eb3c600f820ce09b1763a26">to_can_use_hw_breakpoint</a> = m32r_can_use_hw_watchpoint;
<a name="l01639"></a>01639   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#a11a089e0b00d79a77ad0cb247de34949">to_insert_watchpoint</a> = m32r_insert_watchpoint;
<a name="l01640"></a>01640   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#a310e5f59e27544ae28803274e2aa8338">to_remove_watchpoint</a> = m32r_remove_watchpoint;
<a name="l01641"></a>01641   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#aed96211f2a6c49e995e790caa2fb83b4">to_stopped_by_watchpoint</a> = m32r_stopped_by_watchpoint;
<a name="l01642"></a>01642   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#a89a0d3c90763c2307c5c17b99003a20b">to_stopped_data_address</a> = m32r_stopped_data_address;
<a name="l01643"></a>01643   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#ad7479d77480dfc6097829ae4eb694e97">to_kill</a> = m32r_kill;
<a name="l01644"></a>01644   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#aadbd5f1631198a381b5422adc6653e29">to_load</a> = m32r_load;
<a name="l01645"></a>01645   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#ac137c7edca115afb65715c6aecc093a8">to_create_inferior</a> = m32r_create_inferior;
<a name="l01646"></a>01646   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#aa636723dd143fcd0c3c78af97f7358a5">to_mourn_inferior</a> = m32r_mourn_inferior;
<a name="l01647"></a>01647   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#a83d943a3006b96ec7821e5d65eed8b5e">to_stop</a> = m32r_stop;
<a name="l01648"></a>01648   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#a6f9daded6ff01b15f8ee5142a8c9da65">to_log_command</a> = <a class="code" href="serial_8c.html#ab8a301c959fe9b1caecd0f8ce330561a">serial_log_command</a>;
<a name="l01649"></a>01649   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#a01589152a8f74d8c236c1fab3c2838e9">to_thread_alive</a> = m32r_thread_alive;
<a name="l01650"></a>01650   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#a5259fe0b12fd9dd4e269ed44fee00603">to_pid_to_str</a> = m32r_pid_to_str;
<a name="l01651"></a>01651   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#aaf1f75f86ec2b948e5df3548198aae4b">to_stratum</a> = <a class="code" href="target_8h.html#abf9ea8b4aa7bddf6a8aa3882d0dadd00a4178bf9e6b076f5d0e36cc5727f9e168">process_stratum</a>;
<a name="l01652"></a>01652   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#ad625bdaf8afca492722a20deb7f120c3">to_has_all_memory</a> = m32r_return_one;
<a name="l01653"></a>01653   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#aa672926e3d72e596d67efde607d13b86">to_has_memory</a> = m32r_return_one;
<a name="l01654"></a>01654   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#aded338ce92e6ae64169ece3b6666ff6a">to_has_stack</a> = m32r_return_one;
<a name="l01655"></a>01655   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#a6392e322d5a0b45f5fd487cf8d94caaf">to_has_registers</a> = m32r_return_one;
<a name="l01656"></a>01656   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#ac83decb629de59475995bb0a100dc82a">to_has_execution</a> = m32r_has_execution;
<a name="l01657"></a>01657   <a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>.<a class="code" href="structtarget__ops.html#a97a3b404ed5a64b8f6229fdaf43d30fb">to_magic</a> = <a class="code" href="target_8h.html#a52de2938b46ac35e4a8c50fead44fd4d">OPS_MAGIC</a>;
<a name="l01658"></a>01658 };
<a name="l01659"></a>01659 
<a name="l01660"></a>01660 
<a name="l01661"></a>01661 <span class="keyword">extern</span> <a class="code" href="defs_8h.html#a686ed07d4fdcdc366f2bc677216ca08d">initialize_file_ftype</a> <a class="code" href="remote-m32r-sdi_8c.html#a5ba52d0b431db2d2da4ab13bbfcf1663">_initialize_remote_m32r</a>;
<a name="l01662"></a>01662 
<a name="l01663"></a>01663 <span class="keywordtype">void</span>
<a name="l01664"></a><a class="code" href="remote-m32r-sdi_8c.html#a0f6d95c4445c89175207e2d8e74e95a2">01664</a> _initialize_remote_m32r (<span class="keywordtype">void</span>)
<a name="l01665"></a>01665 {
<a name="l01666"></a>01666   <span class="keywordtype">int</span> i;
<a name="l01667"></a>01667 
<a name="l01668"></a>01668   init_m32r_ops ();
<a name="l01669"></a>01669 
<a name="l01670"></a>01670   <span class="comment">/* Initialize breakpoints.  */</span>
<a name="l01671"></a>01671   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="remote-m32r-sdi_8c.html#a996fc495c80dc29ca7641d887ae4a462">MAX_BREAKPOINTS</a>; i++)
<a name="l01672"></a>01672     bp_address[i] = 0xffffffff;
<a name="l01673"></a>01673 
<a name="l01674"></a>01674   <span class="comment">/* Initialize access breaks.  */</span>
<a name="l01675"></a>01675   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="remote-m32r-sdi_8c.html#ab1669bf63379062035a09b3ad864a201">MAX_ACCESS_BREAKS</a>; i++)
<a name="l01676"></a>01676     ab_address[i] = 0x00000000;
<a name="l01677"></a>01677 
<a name="l01678"></a>01678   <a class="code" href="target_8c.html#ac7643c290e176b1e1ccfdb03ebacf421">add_target</a> (&amp;<a class="code" href="remote-m32r-sdi_8c.html#a782b3c245c668714ef38cc73eee7eeff">m32r_ops</a>);
<a name="l01679"></a>01679 
<a name="l01680"></a>01680   <a class="code" href="cli-decode_8c.html#a0df0ca36d9acd96440e24407cbef593c">add_com</a> (<span class="stringliteral">&quot;sdireset&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49a4994a96ac693a93b56bf997637605172">class_obscure</a>, sdireset_command,
<a name="l01681"></a>01681            <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Reset SDI connection.&quot;</span>));
<a name="l01682"></a>01682 
<a name="l01683"></a>01683   <a class="code" href="cli-decode_8c.html#a0df0ca36d9acd96440e24407cbef593c">add_com</a> (<span class="stringliteral">&quot;sdistatus&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49a4994a96ac693a93b56bf997637605172">class_obscure</a>, sdistatus_command,
<a name="l01684"></a>01684            <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Show status of SDI connection.&quot;</span>));
<a name="l01685"></a>01685 
<a name="l01686"></a>01686   <a class="code" href="cli-decode_8c.html#a0df0ca36d9acd96440e24407cbef593c">add_com</a> (<span class="stringliteral">&quot;debug_chaos&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49a4994a96ac693a93b56bf997637605172">class_obscure</a>, debug_chaos_command,
<a name="l01687"></a>01687            <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Debug M32R/Chaos.&quot;</span>));
<a name="l01688"></a>01688 
<a name="l01689"></a>01689   <a class="code" href="cli-decode_8c.html#a0df0ca36d9acd96440e24407cbef593c">add_com</a> (<span class="stringliteral">&quot;use_debug_dma&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49a4994a96ac693a93b56bf997637605172">class_obscure</a>, use_debug_dma_command,
<a name="l01690"></a>01690            <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Use debug DMA mem access.&quot;</span>));
<a name="l01691"></a>01691   <a class="code" href="cli-decode_8c.html#a0df0ca36d9acd96440e24407cbef593c">add_com</a> (<span class="stringliteral">&quot;use_mon_code&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49a4994a96ac693a93b56bf997637605172">class_obscure</a>, use_mon_code_command,
<a name="l01692"></a>01692            <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Use mon code mem access.&quot;</span>));
<a name="l01693"></a>01693 
<a name="l01694"></a>01694   <a class="code" href="cli-decode_8c.html#a0df0ca36d9acd96440e24407cbef593c">add_com</a> (<span class="stringliteral">&quot;use_ib_break&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49a4994a96ac693a93b56bf997637605172">class_obscure</a>, use_ib_breakpoints_command,
<a name="l01695"></a>01695            <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Set breakpoints by IB break.&quot;</span>));
<a name="l01696"></a>01696   <a class="code" href="cli-decode_8c.html#a0df0ca36d9acd96440e24407cbef593c">add_com</a> (<span class="stringliteral">&quot;use_dbt_break&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49a4994a96ac693a93b56bf997637605172">class_obscure</a>, use_dbt_breakpoints_command,
<a name="l01697"></a>01697            <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Set breakpoints by dbt.&quot;</span>));
<a name="l01698"></a>01698 
<a name="l01699"></a>01699   <span class="comment">/* Yes, 42000 is arbitrary.  The only sense out of it, is that it</span>
<a name="l01700"></a>01700 <span class="comment">     isn&#39;t 0.  */</span>
<a name="l01701"></a>01701   remote_m32r_ptid = <a class="code" href="ptid_8c.html#aa96ee3f6a88626ec36045b4d84e27f79">ptid_build</a> (42000, 0, 42000);
<a name="l01702"></a>01702 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Fri Oct 11 2013 14:12:23 for GDB (API) by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
