<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>GDB (API): /home/stan/gdb/src/gdb/python/py-type.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">GDB (API)
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">/home/stan/gdb/src/gdb/python/py-type.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="py-type_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* Python interface to types.</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">   Copyright (C) 2008-2013 Free Software Foundation, Inc.</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">   This file is part of GDB.</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">   This program is free software; you can redistribute it and/or modify</span>
<a name="l00008"></a>00008 <span class="comment">   it under the terms of the GNU General Public License as published by</span>
<a name="l00009"></a>00009 <span class="comment">   the Free Software Foundation; either version 3 of the License, or</span>
<a name="l00010"></a>00010 <span class="comment">   (at your option) any later version.</span>
<a name="l00011"></a>00011 <span class="comment"></span>
<a name="l00012"></a>00012 <span class="comment">   This program is distributed in the hope that it will be useful,</span>
<a name="l00013"></a>00013 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00014"></a>00014 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00015"></a>00015 <span class="comment">   GNU General Public License for more details.</span>
<a name="l00016"></a>00016 <span class="comment"></span>
<a name="l00017"></a>00017 <span class="comment">   You should have received a copy of the GNU General Public License</span>
<a name="l00018"></a>00018 <span class="comment">   along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.  */</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="defs_8h.html">defs.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="value_8h.html">value.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="exceptions_8h.html">exceptions.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="python-internal_8h.html">python-internal.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="charset_8h.html">charset.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="gdbtypes_8h.html">gdbtypes.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="cp-support_8h.html">cp-support.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;demangle.h&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="objfiles_8h.html">objfiles.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="language_8h.html">language.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="vec_8h.html">vec.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="bcache_8h.html">bcache.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="dwarf2loc_8h.html">dwarf2loc.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="typeprint_8h.html">typeprint.h</a>&quot;</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="keyword">typedef</span> <span class="keyword">struct </span>pyty_type_object
<a name="l00036"></a>00036 {
<a name="l00037"></a>00037   PyObject_HEAD
<a name="l00038"></a>00038   <span class="keyword">struct </span><a class="code" href="structtype.html">type</a> *<a class="code" href="structtype.html">type</a>;
<a name="l00039"></a>00039 
<a name="l00040"></a>00040   <span class="comment">/* If a Type object is associated with an objfile, it is kept on a</span>
<a name="l00041"></a>00041 <span class="comment">     doubly-linked list, rooted in the objfile.  This lets us copy the</span>
<a name="l00042"></a>00042 <span class="comment">     underlying struct type when the objfile is deleted.  */</span>
<a name="l00043"></a>00043   <span class="keyword">struct </span>pyty_type_object *prev;
<a name="l00044"></a>00044   <span class="keyword">struct </span>pyty_type_object *next;
<a name="l00045"></a>00045 } <a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a>;
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="keyword">static</span> PyTypeObject type_object_type
<a name="l00048"></a>00048     <a class="code" href="python-internal_8h.html#a4c726b7d3d54c85859cb9a70b8563b84">CPYCHECKER_TYPE_OBJECT_FOR_TYPEDEF</a> (<span class="stringliteral">&quot;type_object&quot;</span>);
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="comment">/* A Field object.  */</span>
<a name="l00051"></a>00051 <span class="keyword">typedef</span> <span class="keyword">struct </span>pyty_field_object
<a name="l00052"></a>00052 {
<a name="l00053"></a>00053   PyObject_HEAD
<a name="l00054"></a>00054 
<a name="l00055"></a>00055   <span class="comment">/* Dictionary holding our attributes.  */</span>
<a name="l00056"></a>00056   <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *dict;
<a name="l00057"></a>00057 } <a class="code" href="py-type_8c.html#abc451703566d66eee2891acbc0bfd661">field_object</a>;
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <span class="keyword">static</span> PyTypeObject field_object_type
<a name="l00060"></a>00060     <a class="code" href="python-internal_8h.html#a4c726b7d3d54c85859cb9a70b8563b84">CPYCHECKER_TYPE_OBJECT_FOR_TYPEDEF</a> (<span class="stringliteral">&quot;field_object&quot;</span>);
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 <span class="comment">/* A type iterator object.  */</span>
<a name="l00063"></a>00063 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00064"></a>00064   PyObject_HEAD
<a name="l00065"></a>00065   <span class="comment">/* The current field index.  */</span>
<a name="l00066"></a>00066   <span class="keywordtype">int</span> field;
<a name="l00067"></a>00067   <span class="comment">/* What to return.  */</span>
<a name="l00068"></a>00068   <span class="keyword">enum</span> <a class="code" href="python-internal_8h.html#a55ecc5986ea86c7a3349b18fda10852e">gdbpy_iter_kind</a> kind;
<a name="l00069"></a>00069   <span class="comment">/* Pointer back to the original source type object.  */</span>
<a name="l00070"></a>00070   <span class="keyword">struct </span>pyty_type_object *source;
<a name="l00071"></a>00071 } typy_iterator_object;
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 <span class="keyword">static</span> PyTypeObject type_iterator_object_type
<a name="l00074"></a>00074     <a class="code" href="python-internal_8h.html#a4c726b7d3d54c85859cb9a70b8563b84">CPYCHECKER_TYPE_OBJECT_FOR_TYPEDEF</a> (<span class="stringliteral">&quot;typy_iterator_object&quot;</span>);
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <span class="comment">/* This is used to initialize various gdb.TYPE_ constants.  */</span>
<a name="l00077"></a>00077 <span class="keyword">struct </span>pyty_code
<a name="l00078"></a>00078 {
<a name="l00079"></a>00079   <span class="comment">/* The code.  */</span>
<a name="l00080"></a>00080   <span class="keyword">enum</span> <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462">type_code</a> <a class="code" href="ser-unix_8c.html#a45a5b7c00a796a23f01673cef1dbe0a9">code</a>;
<a name="l00081"></a>00081   <span class="comment">/* The name.  */</span>
<a name="l00082"></a>00082   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="aarch64-tdep_8c.html#acc128f98d9ceca227038c771308eff39">name</a>;
<a name="l00083"></a>00083 };
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 <span class="comment">/* Forward declarations.  */</span>
<a name="l00086"></a>00086 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *typy_make_iter (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <span class="keyword">enum</span> <a class="code" href="python-internal_8h.html#a55ecc5986ea86c7a3349b18fda10852e">gdbpy_iter_kind</a> kind);
<a name="l00087"></a>00087 
<a name="l00088"></a><a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">00088</a> <span class="preprocessor">#define ENTRY(X) { X, #X }</span>
<a name="l00089"></a>00089 <span class="preprocessor"></span>
<a name="l00090"></a>00090 <span class="keyword">static</span> <span class="keyword">struct </span>pyty_code pyty_codes[] =
<a name="l00091"></a>00091 {
<a name="l00092"></a>00092   <a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">ENTRY</a> (<a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a74d961bf3f28597b74d926defb06bde5">TYPE_CODE_BITSTRING</a>),
<a name="l00093"></a>00093   <a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">ENTRY</a> (<a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a1a639160f3e3a2f9f7ac55255942c581">TYPE_CODE_PTR</a>),
<a name="l00094"></a>00094   <a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">ENTRY</a> (<a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a00c795b43d1a39f57d3e222385f14fc0">TYPE_CODE_ARRAY</a>),
<a name="l00095"></a>00095   <a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">ENTRY</a> (<a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462af3b3fc76f66c95e12946c0ef84409365">TYPE_CODE_STRUCT</a>),
<a name="l00096"></a>00096   <a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">ENTRY</a> (<a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a8c3218d2f780665395d57dcd4d909191">TYPE_CODE_UNION</a>),
<a name="l00097"></a>00097   <a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">ENTRY</a> (<a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a1afbc1e8f69012b205070a3b5eac7217">TYPE_CODE_ENUM</a>),
<a name="l00098"></a>00098   <a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">ENTRY</a> (<a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462ab9ceda9934dbdad598b6b28b166a9176">TYPE_CODE_FLAGS</a>),
<a name="l00099"></a>00099   <a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">ENTRY</a> (<a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a4b6327934915849a4e96eef151fe312b">TYPE_CODE_FUNC</a>),
<a name="l00100"></a>00100   <a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">ENTRY</a> (<a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a7071a71840688811b992838bb09d0ddd">TYPE_CODE_INT</a>),
<a name="l00101"></a>00101   <a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">ENTRY</a> (<a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a98f3aa25f923ee0cd1d009e77b0a551a">TYPE_CODE_FLT</a>),
<a name="l00102"></a>00102   <a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">ENTRY</a> (<a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462ad142a78789548b777dee1a3313e3e64f">TYPE_CODE_VOID</a>),
<a name="l00103"></a>00103   <a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">ENTRY</a> (<a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a216bf69a8ff9dd9c986dab10f4fe6894">TYPE_CODE_SET</a>),
<a name="l00104"></a>00104   <a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">ENTRY</a> (<a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a31cf8189b076711e63dea04c1136bafe">TYPE_CODE_RANGE</a>),
<a name="l00105"></a>00105   <a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">ENTRY</a> (<a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a956ce01e5c83060e05208c9404fedca2">TYPE_CODE_STRING</a>),
<a name="l00106"></a>00106   <a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">ENTRY</a> (<a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a36e1735c46b31ec7fc392e40606f8f65">TYPE_CODE_ERROR</a>),
<a name="l00107"></a>00107   <a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">ENTRY</a> (<a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a581771a1410949e8b505dd51426949e9">TYPE_CODE_METHOD</a>),
<a name="l00108"></a>00108   <a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">ENTRY</a> (<a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462adec2c2388675220f922bae85d149f170">TYPE_CODE_METHODPTR</a>),
<a name="l00109"></a>00109   <a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">ENTRY</a> (<a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a0311d6e6980a50c23e68350f1b8fb5ae">TYPE_CODE_MEMBERPTR</a>),
<a name="l00110"></a>00110   <a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">ENTRY</a> (<a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a476430709e5a251f7e0f8e3fb48a713f">TYPE_CODE_REF</a>),
<a name="l00111"></a>00111   <a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">ENTRY</a> (<a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462ae991dd7ea70631f3e1b67a1a75020b5f">TYPE_CODE_CHAR</a>),
<a name="l00112"></a>00112   <a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">ENTRY</a> (<a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462afbf0aa0241df408e1017ae7ff8e6798c">TYPE_CODE_BOOL</a>),
<a name="l00113"></a>00113   <a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">ENTRY</a> (<a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462ad8de4d143b624cd2bcab740a51a04658">TYPE_CODE_COMPLEX</a>),
<a name="l00114"></a>00114   <a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">ENTRY</a> (<a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462abd0f09e6db7ab38fde35eabec26f1d77">TYPE_CODE_TYPEDEF</a>),
<a name="l00115"></a>00115   <a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">ENTRY</a> (<a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462ae5cdf73186d3029211503380f64949b6">TYPE_CODE_NAMESPACE</a>),
<a name="l00116"></a>00116   <a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">ENTRY</a> (<a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462ace4e1a5aff0ea601f04c6f25eb8ed47b">TYPE_CODE_DECFLOAT</a>),
<a name="l00117"></a>00117   <a class="code" href="py-type_8c.html#a8a027337d4518bf87dc4018a84c60f46">ENTRY</a> (<a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a5d698fd1c5c048c06f19bb245a856fbb">TYPE_CODE_INTERNAL_FUNCTION</a>),
<a name="l00118"></a>00118   { <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462ac0ed09886a958d1a94646893440004a8">TYPE_CODE_UNDEF</a>, NULL }
<a name="l00119"></a>00119 };
<a name="l00120"></a>00120 
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 
<a name="l00123"></a>00123 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00124"></a>00124 field_dealloc (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *obj)
<a name="l00125"></a>00125 {
<a name="l00126"></a>00126   <a class="code" href="py-type_8c.html#abc451703566d66eee2891acbc0bfd661">field_object</a> *f = (<a class="code" href="py-type_8c.html#abc451703566d66eee2891acbc0bfd661">field_object</a> *) obj;
<a name="l00127"></a>00127 
<a name="l00128"></a>00128   Py_XDECREF (f-&gt;dict);
<a name="l00129"></a>00129   Py_TYPE (obj)-&gt;tp_free (obj);
<a name="l00130"></a>00130 }
<a name="l00131"></a>00131 
<a name="l00132"></a>00132 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l00133"></a>00133 field_new (<span class="keywordtype">void</span>)
<a name="l00134"></a>00134 {
<a name="l00135"></a>00135   <a class="code" href="py-type_8c.html#abc451703566d66eee2891acbc0bfd661">field_object</a> *result = PyObject_New (<a class="code" href="py-type_8c.html#abc451703566d66eee2891acbc0bfd661">field_object</a>, &amp;field_object_type);
<a name="l00136"></a>00136 
<a name="l00137"></a>00137   <span class="keywordflow">if</span> (result)
<a name="l00138"></a>00138     {
<a name="l00139"></a>00139       result-&gt;dict = PyDict_New ();
<a name="l00140"></a>00140       <span class="keywordflow">if</span> (!result-&gt;dict)
<a name="l00141"></a>00141         {
<a name="l00142"></a>00142           <a class="code" href="python-internal_8h.html#a19be7acd3e9a57b82c7be99b8594d293">Py_DECREF</a> (result);
<a name="l00143"></a>00143           result = NULL;
<a name="l00144"></a>00144         }
<a name="l00145"></a>00145     }
<a name="l00146"></a>00146   <span class="keywordflow">return</span> (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *) result;
<a name="l00147"></a>00147 }
<a name="l00148"></a>00148 
<a name="l00149"></a>00149 
<a name="l00150"></a>00150 
<a name="l00151"></a>00151 <span class="comment">/* Return the code for this type.  */</span>
<a name="l00152"></a>00152 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l00153"></a>00153 typy_get_code (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <span class="keywordtype">void</span> *closure)
<a name="l00154"></a>00154 {
<a name="l00155"></a>00155   <span class="keyword">struct </span><a class="code" href="structtype.html">type</a> *<a class="code" href="structtype.html">type</a> = ((<a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *) <span class="keyword">self</span>)-&gt;type;
<a name="l00156"></a>00156 
<a name="l00157"></a>00157   <span class="keywordflow">return</span> PyInt_FromLong (<a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (type));
<a name="l00158"></a>00158 }
<a name="l00159"></a>00159 
<a name="l00160"></a>00160 <span class="comment">/* Helper function for typy_fields which converts a single field to a</span>
<a name="l00161"></a>00161 <span class="comment">   gdb.Field object.  Returns NULL on error.  */</span>
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l00164"></a>00164 convert_field (<span class="keyword">struct</span> type *type, <span class="keywordtype">int</span> field)
<a name="l00165"></a>00165 {
<a name="l00166"></a>00166   <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *result = field_new ();
<a name="l00167"></a>00167   <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *arg;
<a name="l00168"></a>00168 
<a name="l00169"></a>00169   <span class="keywordflow">if</span> (!result)
<a name="l00170"></a>00170     <span class="keywordflow">return</span> NULL;
<a name="l00171"></a>00171 
<a name="l00172"></a>00172   <span class="keywordflow">if</span> (!<a class="code" href="gdbtypes_8c.html#a38a5ce3cc244d3f0618908f9a7ceca62">field_is_static</a> (&amp;<a class="code" href="gdbtypes_8h.html#a8beaef20f443a0d98c7b445bbcfcf031">TYPE_FIELD</a> (type, field)))
<a name="l00173"></a>00173     {
<a name="l00174"></a>00174       <span class="keyword">const</span> <span class="keywordtype">char</span> *attrstring;
<a name="l00175"></a>00175 
<a name="l00176"></a>00176       <span class="keywordflow">if</span> (<a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (type) == <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a1afbc1e8f69012b205070a3b5eac7217">TYPE_CODE_ENUM</a>)
<a name="l00177"></a>00177         {
<a name="l00178"></a>00178           arg = <a class="code" href="python-internal_8h.html#ab057269feffea5766e98aa0142788ad1">gdb_py_long_from_longest</a> (<a class="code" href="gdbtypes_8h.html#a2ab26ef1ee13615e128e3cb3cd058a5c">TYPE_FIELD_ENUMVAL</a> (type, field));
<a name="l00179"></a>00179           attrstring = <span class="stringliteral">&quot;enumval&quot;</span>;
<a name="l00180"></a>00180         }
<a name="l00181"></a>00181       <span class="keywordflow">else</span>
<a name="l00182"></a>00182         {
<a name="l00183"></a>00183           arg = <a class="code" href="python-internal_8h.html#ab057269feffea5766e98aa0142788ad1">gdb_py_long_from_longest</a> (<a class="code" href="gdbtypes_8h.html#a676725f445f8fc5dad99cd215778b3a4">TYPE_FIELD_BITPOS</a> (type, field));
<a name="l00184"></a>00184           attrstring = <span class="stringliteral">&quot;bitpos&quot;</span>;
<a name="l00185"></a>00185         }
<a name="l00186"></a>00186 
<a name="l00187"></a>00187       <span class="keywordflow">if</span> (!arg)
<a name="l00188"></a>00188         <span class="keywordflow">goto</span> fail;
<a name="l00189"></a>00189 
<a name="l00190"></a>00190       <span class="comment">/* At least python-2.4 had the second parameter non-const.  */</span>
<a name="l00191"></a>00191       <span class="keywordflow">if</span> (PyObject_SetAttrString (result, (<span class="keywordtype">char</span> *) attrstring, arg) &lt; 0)
<a name="l00192"></a>00192         <span class="keywordflow">goto</span> failarg;
<a name="l00193"></a>00193       <a class="code" href="python-internal_8h.html#a19be7acd3e9a57b82c7be99b8594d293">Py_DECREF</a> (arg);
<a name="l00194"></a>00194     }
<a name="l00195"></a>00195 
<a name="l00196"></a>00196   <span class="keywordflow">if</span> (<a class="code" href="gdbtypes_8h.html#a01947c4de3aced365e02aa6e8e6a9dc3">TYPE_FIELD_NAME</a> (type, field))
<a name="l00197"></a>00197     arg = PyString_FromString (<a class="code" href="gdbtypes_8h.html#a01947c4de3aced365e02aa6e8e6a9dc3">TYPE_FIELD_NAME</a> (type, field));
<a name="l00198"></a>00198   <span class="keywordflow">else</span>
<a name="l00199"></a>00199     {
<a name="l00200"></a>00200       arg = Py_None;
<a name="l00201"></a>00201       Py_INCREF (arg);
<a name="l00202"></a>00202     }
<a name="l00203"></a>00203   <span class="keywordflow">if</span> (!arg)
<a name="l00204"></a>00204     <span class="keywordflow">goto</span> fail;
<a name="l00205"></a>00205   <span class="keywordflow">if</span> (PyObject_SetAttrString (result, <span class="stringliteral">&quot;name&quot;</span>, arg) &lt; 0)
<a name="l00206"></a>00206     <span class="keywordflow">goto</span> failarg;
<a name="l00207"></a>00207   <a class="code" href="python-internal_8h.html#a19be7acd3e9a57b82c7be99b8594d293">Py_DECREF</a> (arg);
<a name="l00208"></a>00208 
<a name="l00209"></a>00209   arg = <a class="code" href="gdbtypes_8h.html#aa2bb2f58f95f604830c665368481946d">TYPE_FIELD_ARTIFICIAL</a> (type, field) ? Py_True : Py_False;
<a name="l00210"></a>00210   Py_INCREF (arg);
<a name="l00211"></a>00211   <span class="keywordflow">if</span> (PyObject_SetAttrString (result, <span class="stringliteral">&quot;artificial&quot;</span>, arg) &lt; 0)
<a name="l00212"></a>00212     <span class="keywordflow">goto</span> failarg;
<a name="l00213"></a>00213   <a class="code" href="python-internal_8h.html#a19be7acd3e9a57b82c7be99b8594d293">Py_DECREF</a> (arg);
<a name="l00214"></a>00214 
<a name="l00215"></a>00215   <span class="keywordflow">if</span> (<a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (type) == <a class="code" href="gdbtypes_8h.html#a9f70b67b4d14548a879667f544eab4ef">TYPE_CODE_CLASS</a>)
<a name="l00216"></a>00216     arg = field &lt; <a class="code" href="gdbtypes_8h.html#ae19e9d182aaab51bcb695d4828b4fd53">TYPE_N_BASECLASSES</a> (type) ? Py_True : Py_False;
<a name="l00217"></a>00217   <span class="keywordflow">else</span>
<a name="l00218"></a>00218     arg = Py_False;
<a name="l00219"></a>00219   Py_INCREF (arg);
<a name="l00220"></a>00220   <span class="keywordflow">if</span> (PyObject_SetAttrString (result, <span class="stringliteral">&quot;is_base_class&quot;</span>, arg) &lt; 0)
<a name="l00221"></a>00221     <span class="keywordflow">goto</span> failarg;
<a name="l00222"></a>00222   <a class="code" href="python-internal_8h.html#a19be7acd3e9a57b82c7be99b8594d293">Py_DECREF</a> (arg);
<a name="l00223"></a>00223 
<a name="l00224"></a>00224   arg = PyLong_FromLong (<a class="code" href="gdbtypes_8h.html#abc55e4d1aac1dfb1c8183d412aca66b1">TYPE_FIELD_BITSIZE</a> (type, field));
<a name="l00225"></a>00225   <span class="keywordflow">if</span> (!arg)
<a name="l00226"></a>00226     <span class="keywordflow">goto</span> fail;
<a name="l00227"></a>00227   <span class="keywordflow">if</span> (PyObject_SetAttrString (result, <span class="stringliteral">&quot;bitsize&quot;</span>, arg) &lt; 0)
<a name="l00228"></a>00228     <span class="keywordflow">goto</span> failarg;
<a name="l00229"></a>00229   <a class="code" href="python-internal_8h.html#a19be7acd3e9a57b82c7be99b8594d293">Py_DECREF</a> (arg);
<a name="l00230"></a>00230 
<a name="l00231"></a>00231   <span class="comment">/* A field can have a NULL type in some situations.  */</span>
<a name="l00232"></a>00232   <span class="keywordflow">if</span> (<a class="code" href="gdbtypes_8h.html#a57f5958d4f2803d1e17748bcfa9c23c3">TYPE_FIELD_TYPE</a> (type, field) == NULL)
<a name="l00233"></a>00233     {
<a name="l00234"></a>00234       arg = Py_None;
<a name="l00235"></a>00235       Py_INCREF (arg);
<a name="l00236"></a>00236     }
<a name="l00237"></a>00237   <span class="keywordflow">else</span>
<a name="l00238"></a>00238     arg = <a class="code" href="py-type_8c.html#a81e3b010e21ee3b3fc80a056f22ff6d5">type_to_type_object</a> (<a class="code" href="gdbtypes_8h.html#a57f5958d4f2803d1e17748bcfa9c23c3">TYPE_FIELD_TYPE</a> (type, field));
<a name="l00239"></a>00239   <span class="keywordflow">if</span> (!arg)
<a name="l00240"></a>00240     <span class="keywordflow">goto</span> fail;
<a name="l00241"></a>00241   <span class="keywordflow">if</span> (PyObject_SetAttrString (result, <span class="stringliteral">&quot;type&quot;</span>, arg) &lt; 0)
<a name="l00242"></a>00242     <span class="keywordflow">goto</span> failarg;
<a name="l00243"></a>00243   <a class="code" href="python-internal_8h.html#a19be7acd3e9a57b82c7be99b8594d293">Py_DECREF</a> (arg);
<a name="l00244"></a>00244 
<a name="l00245"></a>00245   <span class="keywordflow">return</span> result;
<a name="l00246"></a>00246 
<a name="l00247"></a>00247  failarg:
<a name="l00248"></a>00248   <a class="code" href="python-internal_8h.html#a19be7acd3e9a57b82c7be99b8594d293">Py_DECREF</a> (arg);
<a name="l00249"></a>00249  fail:
<a name="l00250"></a>00250   <a class="code" href="python-internal_8h.html#a19be7acd3e9a57b82c7be99b8594d293">Py_DECREF</a> (result);
<a name="l00251"></a>00251   <span class="keywordflow">return</span> NULL;
<a name="l00252"></a>00252 }
<a name="l00253"></a>00253 
<a name="l00254"></a>00254 <span class="comment">/* Helper function to return the name of a field, as a gdb.Field object.</span>
<a name="l00255"></a>00255 <span class="comment">   If the field doesn&#39;t have a name, None is returned.  */</span>
<a name="l00256"></a>00256 
<a name="l00257"></a>00257 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l00258"></a>00258 field_name (<span class="keyword">struct</span> type *type, <span class="keywordtype">int</span> field)
<a name="l00259"></a>00259 {
<a name="l00260"></a>00260   <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *result;
<a name="l00261"></a>00261 
<a name="l00262"></a>00262   <span class="keywordflow">if</span> (<a class="code" href="gdbtypes_8h.html#a01947c4de3aced365e02aa6e8e6a9dc3">TYPE_FIELD_NAME</a> (type, field))
<a name="l00263"></a>00263     result = PyString_FromString (<a class="code" href="gdbtypes_8h.html#a01947c4de3aced365e02aa6e8e6a9dc3">TYPE_FIELD_NAME</a> (type, field));
<a name="l00264"></a>00264   <span class="keywordflow">else</span>
<a name="l00265"></a>00265     {
<a name="l00266"></a>00266       result = Py_None;
<a name="l00267"></a>00267       Py_INCREF (result);
<a name="l00268"></a>00268     }
<a name="l00269"></a>00269   <span class="keywordflow">return</span> result;
<a name="l00270"></a>00270 }
<a name="l00271"></a>00271 
<a name="l00272"></a>00272 <span class="comment">/* Helper function for Type standard mapping methods.  Returns a</span>
<a name="l00273"></a>00273 <span class="comment">   Python object for field i of the type.  &quot;kind&quot; specifies what to</span>
<a name="l00274"></a>00274 <span class="comment">   return: the name of the field, a gdb.Field object corresponding to</span>
<a name="l00275"></a>00275 <span class="comment">   the field, or a tuple consisting of field name and gdb.Field</span>
<a name="l00276"></a>00276 <span class="comment">   object.  */</span>
<a name="l00277"></a>00277 
<a name="l00278"></a>00278 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l00279"></a>00279 make_fielditem (<span class="keyword">struct</span> type *type, <span class="keywordtype">int</span> i, <span class="keyword">enum</span> <a class="code" href="python-internal_8h.html#a55ecc5986ea86c7a3349b18fda10852e">gdbpy_iter_kind</a> kind)
<a name="l00280"></a>00280 {
<a name="l00281"></a>00281   <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *item = NULL, *key = NULL, *value = NULL;
<a name="l00282"></a>00282 
<a name="l00283"></a>00283   <span class="keywordflow">switch</span> (kind)
<a name="l00284"></a>00284     {
<a name="l00285"></a>00285     <span class="keywordflow">case</span> <a class="code" href="python-internal_8h.html#a55ecc5986ea86c7a3349b18fda10852eab88aac0d7bc7d011af3315b948a8b8ed">iter_items</a>:
<a name="l00286"></a>00286       key = field_name (type, i);
<a name="l00287"></a>00287       <span class="keywordflow">if</span> (key == NULL)
<a name="l00288"></a>00288         <span class="keywordflow">goto</span> fail;
<a name="l00289"></a>00289       value = convert_field (type, i);
<a name="l00290"></a>00290       <span class="keywordflow">if</span> (value == NULL)
<a name="l00291"></a>00291         <span class="keywordflow">goto</span> fail;
<a name="l00292"></a>00292       item = PyTuple_New (2);
<a name="l00293"></a>00293       <span class="keywordflow">if</span> (item == NULL)
<a name="l00294"></a>00294         <span class="keywordflow">goto</span> fail;
<a name="l00295"></a>00295       PyTuple_SET_ITEM (item, 0, key);
<a name="l00296"></a>00296       PyTuple_SET_ITEM (item, 1, value);
<a name="l00297"></a>00297       <span class="keywordflow">break</span>;
<a name="l00298"></a>00298     <span class="keywordflow">case</span> <a class="code" href="python-internal_8h.html#a55ecc5986ea86c7a3349b18fda10852eafa3709c282b0c168e9d64101618aa9c9">iter_keys</a>:
<a name="l00299"></a>00299       item = field_name (type, i);
<a name="l00300"></a>00300       <span class="keywordflow">break</span>;
<a name="l00301"></a>00301     <span class="keywordflow">case</span> <a class="code" href="python-internal_8h.html#a55ecc5986ea86c7a3349b18fda10852ea3300de765d0f874bcc89cb2003644cf3">iter_values</a>:
<a name="l00302"></a>00302       item =  convert_field (type, i);
<a name="l00303"></a>00303       <span class="keywordflow">break</span>;
<a name="l00304"></a>00304     <span class="keywordflow">default</span>:
<a name="l00305"></a>00305       <a class="code" href="gdb__assert_8h.html#aa0526ecd768317edecf0b46c981cbcc0">gdb_assert_not_reached</a> (<span class="stringliteral">&quot;invalid gdbpy_iter_kind&quot;</span>);
<a name="l00306"></a>00306     }
<a name="l00307"></a>00307   <span class="keywordflow">return</span> item;
<a name="l00308"></a>00308   
<a name="l00309"></a>00309  fail:
<a name="l00310"></a>00310   Py_XDECREF (key);
<a name="l00311"></a>00311   Py_XDECREF (value);
<a name="l00312"></a>00312   Py_XDECREF (item);
<a name="l00313"></a>00313   <span class="keywordflow">return</span> NULL;
<a name="l00314"></a>00314 }
<a name="l00315"></a>00315 
<a name="l00316"></a>00316 <span class="comment">/* Return a sequence of all field names, fields, or (name, field) pairs.</span>
<a name="l00317"></a>00317 <span class="comment">   Each field is a gdb.Field object.  */</span>
<a name="l00318"></a>00318 
<a name="l00319"></a>00319 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l00320"></a>00320 typy_fields_items (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <span class="keyword">enum</span> <a class="code" href="python-internal_8h.html#a55ecc5986ea86c7a3349b18fda10852e">gdbpy_iter_kind</a> kind)
<a name="l00321"></a>00321 {
<a name="l00322"></a>00322   <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *py_type = <span class="keyword">self</span>;
<a name="l00323"></a>00323   <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *result = NULL, *iter = NULL;
<a name="l00324"></a>00324   <span class="keyword">volatile</span> <span class="keyword">struct </span><a class="code" href="structgdb__exception.html">gdb_exception</a> except;
<a name="l00325"></a>00325   <span class="keyword">struct </span>type *type = ((<a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *) py_type)-&gt;type;
<a name="l00326"></a>00326   <span class="keyword">struct </span>type *checked_type = type;
<a name="l00327"></a>00327 
<a name="l00328"></a>00328   <a class="code" href="exceptions_8h.html#aef4514ee39b9305fddee27f49c7c34eb">TRY_CATCH</a> (except, <a class="code" href="exceptions_8h.html#abfa3a3b99557b11f5766baf69465fdf6ab50fde886a7de8c013bf2bd4e7c073a4">RETURN_MASK_ALL</a>)
<a name="l00329"></a>00329     {
<a name="l00330"></a>00330       <a class="code" href="gdbtypes_8h.html#ae2f9348c644babaa9038b4dc18bffaac">CHECK_TYPEDEF</a> (checked_type);
<a name="l00331"></a>00331     }
<a name="l00332"></a>00332   <a class="code" href="python-internal_8h.html#af341ab0b81fa8efcec4c816710785a56">GDB_PY_HANDLE_EXCEPTION</a> (except);
<a name="l00333"></a>00333 
<a name="l00334"></a>00334   <span class="keywordflow">if</span> (checked_type != type)
<a name="l00335"></a>00335     py_type = <a class="code" href="py-type_8c.html#a81e3b010e21ee3b3fc80a056f22ff6d5">type_to_type_object</a> (checked_type);
<a name="l00336"></a>00336   iter = typy_make_iter (py_type, kind);
<a name="l00337"></a>00337   <span class="keywordflow">if</span> (checked_type != type)
<a name="l00338"></a>00338     {
<a name="l00339"></a>00339       <span class="comment">/* Need to wrap this in braces because Py_DECREF isn&#39;t wrapped</span>
<a name="l00340"></a>00340 <span class="comment">         in a do{}while(0).  */</span>
<a name="l00341"></a>00341       <a class="code" href="python-internal_8h.html#a19be7acd3e9a57b82c7be99b8594d293">Py_DECREF</a> (py_type);
<a name="l00342"></a>00342     }
<a name="l00343"></a>00343   <span class="keywordflow">if</span> (iter != NULL)
<a name="l00344"></a>00344     {
<a name="l00345"></a>00345       result = PySequence_List (iter);
<a name="l00346"></a>00346       <a class="code" href="python-internal_8h.html#a19be7acd3e9a57b82c7be99b8594d293">Py_DECREF</a> (iter);
<a name="l00347"></a>00347     }
<a name="l00348"></a>00348 
<a name="l00349"></a>00349   <span class="keywordflow">return</span> result;
<a name="l00350"></a>00350 }
<a name="l00351"></a>00351 
<a name="l00352"></a>00352 <span class="comment">/* Return a sequence of all fields.  Each field is a gdb.Field object.  */</span>
<a name="l00353"></a>00353 
<a name="l00354"></a>00354 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l00355"></a>00355 typy_values (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *args)
<a name="l00356"></a>00356 {
<a name="l00357"></a>00357   <span class="keywordflow">return</span> typy_fields_items (<span class="keyword">self</span>, <a class="code" href="python-internal_8h.html#a55ecc5986ea86c7a3349b18fda10852ea3300de765d0f874bcc89cb2003644cf3">iter_values</a>);
<a name="l00358"></a>00358 }
<a name="l00359"></a>00359 
<a name="l00360"></a>00360 <span class="comment">/* Return a sequence of all fields.  Each field is a gdb.Field object.</span>
<a name="l00361"></a>00361 <span class="comment">   This method is similar to typy_values, except where the supplied </span>
<a name="l00362"></a>00362 <span class="comment">   gdb.Type is an array, in which case it returns a list of one entry</span>
<a name="l00363"></a>00363 <span class="comment">   which is a gdb.Field object for a range (the array bounds).  */</span>
<a name="l00364"></a>00364 
<a name="l00365"></a>00365 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l00366"></a>00366 typy_fields (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *args)
<a name="l00367"></a>00367 {
<a name="l00368"></a>00368   <span class="keyword">struct </span>type *type = ((<a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *) <span class="keyword">self</span>)-&gt;type;
<a name="l00369"></a>00369   <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *r, *rl;
<a name="l00370"></a>00370   
<a name="l00371"></a>00371   <span class="keywordflow">if</span> (<a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (type) != <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a00c795b43d1a39f57d3e222385f14fc0">TYPE_CODE_ARRAY</a>)
<a name="l00372"></a>00372     <span class="keywordflow">return</span> typy_fields_items (<span class="keyword">self</span>, <a class="code" href="python-internal_8h.html#a55ecc5986ea86c7a3349b18fda10852ea3300de765d0f874bcc89cb2003644cf3">iter_values</a>);
<a name="l00373"></a>00373 
<a name="l00374"></a>00374   <span class="comment">/* Array type.  Handle this as a special case because the common</span>
<a name="l00375"></a>00375 <span class="comment">     machinery wants struct or union or enum types.  Build a list of</span>
<a name="l00376"></a>00376 <span class="comment">     one entry which is the range for the array.  */</span>
<a name="l00377"></a>00377   r = convert_field (type, 0);
<a name="l00378"></a>00378   <span class="keywordflow">if</span> (r == NULL)
<a name="l00379"></a>00379     <span class="keywordflow">return</span> NULL;
<a name="l00380"></a>00380   
<a name="l00381"></a>00381   rl = Py_BuildValue (<span class="stringliteral">&quot;[O]&quot;</span>, r);
<a name="l00382"></a>00382   <a class="code" href="python-internal_8h.html#a19be7acd3e9a57b82c7be99b8594d293">Py_DECREF</a> (r);
<a name="l00383"></a>00383 
<a name="l00384"></a>00384   <span class="keywordflow">return</span> rl;
<a name="l00385"></a>00385 }
<a name="l00386"></a>00386 
<a name="l00387"></a>00387 <span class="comment">/* Return a sequence of all field names.  Each field is a gdb.Field object.  */</span>
<a name="l00388"></a>00388 
<a name="l00389"></a>00389 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l00390"></a>00390 typy_field_names (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *args)
<a name="l00391"></a>00391 {
<a name="l00392"></a>00392   <span class="keywordflow">return</span> typy_fields_items (<span class="keyword">self</span>, <a class="code" href="python-internal_8h.html#a55ecc5986ea86c7a3349b18fda10852eafa3709c282b0c168e9d64101618aa9c9">iter_keys</a>);
<a name="l00393"></a>00393 }
<a name="l00394"></a>00394 
<a name="l00395"></a>00395 <span class="comment">/* Return a sequence of all (name, fields) pairs.  Each field is a </span>
<a name="l00396"></a>00396 <span class="comment">   gdb.Field object.  */</span>
<a name="l00397"></a>00397 
<a name="l00398"></a>00398 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l00399"></a>00399 typy_items (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *args)
<a name="l00400"></a>00400 {
<a name="l00401"></a>00401   <span class="keywordflow">return</span> typy_fields_items (<span class="keyword">self</span>, <a class="code" href="python-internal_8h.html#a55ecc5986ea86c7a3349b18fda10852eab88aac0d7bc7d011af3315b948a8b8ed">iter_items</a>);
<a name="l00402"></a>00402 }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404 <span class="comment">/* Return the type&#39;s tag, or None.  */</span>
<a name="l00405"></a>00405 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l00406"></a>00406 typy_get_tag (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <span class="keywordtype">void</span> *closure)
<a name="l00407"></a>00407 {
<a name="l00408"></a>00408   <span class="keyword">struct </span>type *type = ((<a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *) <span class="keyword">self</span>)-&gt;type;
<a name="l00409"></a>00409 
<a name="l00410"></a>00410   <span class="keywordflow">if</span> (!<a class="code" href="gdbtypes_8h.html#acb2abdd2de64c35b3041ddfe1aa64099">TYPE_TAG_NAME</a> (type))
<a name="l00411"></a>00411     Py_RETURN_NONE;
<a name="l00412"></a>00412   <span class="keywordflow">return</span> PyString_FromString (<a class="code" href="gdbtypes_8h.html#acb2abdd2de64c35b3041ddfe1aa64099">TYPE_TAG_NAME</a> (type));
<a name="l00413"></a>00413 }
<a name="l00414"></a>00414 
<a name="l00415"></a>00415 <span class="comment">/* Return the type, stripped of typedefs. */</span>
<a name="l00416"></a>00416 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l00417"></a>00417 typy_strip_typedefs (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *args)
<a name="l00418"></a>00418 {
<a name="l00419"></a>00419   <span class="keyword">struct </span>type *type = ((<a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *) <span class="keyword">self</span>)-&gt;type;
<a name="l00420"></a>00420   <span class="keyword">volatile</span> <span class="keyword">struct </span><a class="code" href="structgdb__exception.html">gdb_exception</a> except;
<a name="l00421"></a>00421 
<a name="l00422"></a>00422   <a class="code" href="exceptions_8h.html#aef4514ee39b9305fddee27f49c7c34eb">TRY_CATCH</a> (except, <a class="code" href="exceptions_8h.html#abfa3a3b99557b11f5766baf69465fdf6ab50fde886a7de8c013bf2bd4e7c073a4">RETURN_MASK_ALL</a>)
<a name="l00423"></a>00423     {
<a name="l00424"></a>00424       type = <a class="code" href="gdbtypes_8c.html#a0bf29d7521d8a8b8735b9a259e380386">check_typedef</a> (type);
<a name="l00425"></a>00425     }
<a name="l00426"></a>00426   <a class="code" href="python-internal_8h.html#af341ab0b81fa8efcec4c816710785a56">GDB_PY_HANDLE_EXCEPTION</a> (except);
<a name="l00427"></a>00427 
<a name="l00428"></a>00428   <span class="keywordflow">return</span> <a class="code" href="py-type_8c.html#a81e3b010e21ee3b3fc80a056f22ff6d5">type_to_type_object</a> (type);
<a name="l00429"></a>00429 }
<a name="l00430"></a>00430 
<a name="l00431"></a>00431 <span class="comment">/* Strip typedefs and pointers/reference from a type.  Then check that</span>
<a name="l00432"></a>00432 <span class="comment">   it is a struct, union, or enum type.  If not, raise TypeError.  */</span>
<a name="l00433"></a>00433 
<a name="l00434"></a>00434 <span class="keyword">static</span> <span class="keyword">struct </span>type *
<a name="l00435"></a>00435 typy_get_composite (<span class="keyword">struct</span> type *type)
<a name="l00436"></a>00436 {
<a name="l00437"></a>00437   <span class="keyword">volatile</span> <span class="keyword">struct </span><a class="code" href="structgdb__exception.html">gdb_exception</a> except;
<a name="l00438"></a>00438 
<a name="l00439"></a>00439   <span class="keywordflow">for</span> (;;)
<a name="l00440"></a>00440     {
<a name="l00441"></a>00441       <a class="code" href="exceptions_8h.html#aef4514ee39b9305fddee27f49c7c34eb">TRY_CATCH</a> (except, <a class="code" href="exceptions_8h.html#abfa3a3b99557b11f5766baf69465fdf6ab50fde886a7de8c013bf2bd4e7c073a4">RETURN_MASK_ALL</a>)
<a name="l00442"></a>00442         {
<a name="l00443"></a>00443           <a class="code" href="gdbtypes_8h.html#ae2f9348c644babaa9038b4dc18bffaac">CHECK_TYPEDEF</a> (type);
<a name="l00444"></a>00444         }
<a name="l00445"></a>00445       <a class="code" href="python-internal_8h.html#af341ab0b81fa8efcec4c816710785a56">GDB_PY_HANDLE_EXCEPTION</a> (except);
<a name="l00446"></a>00446 
<a name="l00447"></a>00447       <span class="keywordflow">if</span> (<a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (type) != <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a1a639160f3e3a2f9f7ac55255942c581">TYPE_CODE_PTR</a>
<a name="l00448"></a>00448           &amp;&amp; <a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (type) != <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a476430709e5a251f7e0f8e3fb48a713f">TYPE_CODE_REF</a>)
<a name="l00449"></a>00449         <span class="keywordflow">break</span>;
<a name="l00450"></a>00450       type = <a class="code" href="gdbtypes_8h.html#a87a33d723acd28a033e63c4297c6c916">TYPE_TARGET_TYPE</a> (type);
<a name="l00451"></a>00451     }
<a name="l00452"></a>00452 
<a name="l00453"></a>00453   <span class="comment">/* If this is not a struct, union, or enum type, raise TypeError</span>
<a name="l00454"></a>00454 <span class="comment">     exception.  */</span>
<a name="l00455"></a>00455   <span class="keywordflow">if</span> (<a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (type) != <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462af3b3fc76f66c95e12946c0ef84409365">TYPE_CODE_STRUCT</a> 
<a name="l00456"></a>00456       &amp;&amp; <a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (type) != <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a8c3218d2f780665395d57dcd4d909191">TYPE_CODE_UNION</a>
<a name="l00457"></a>00457       &amp;&amp; <a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (type) != <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a1afbc1e8f69012b205070a3b5eac7217">TYPE_CODE_ENUM</a>)
<a name="l00458"></a>00458     {
<a name="l00459"></a>00459       PyErr_SetString (PyExc_TypeError,
<a name="l00460"></a>00460                        <span class="stringliteral">&quot;Type is not a structure, union, or enum type.&quot;</span>);
<a name="l00461"></a>00461       <span class="keywordflow">return</span> NULL;
<a name="l00462"></a>00462     }
<a name="l00463"></a>00463   
<a name="l00464"></a>00464   <span class="keywordflow">return</span> type;
<a name="l00465"></a>00465 }
<a name="l00466"></a>00466 
<a name="l00467"></a>00467 <span class="comment">/* Helper for typy_array and typy_vector.  */</span>
<a name="l00468"></a>00468 
<a name="l00469"></a>00469 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l00470"></a>00470 typy_array_1 (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *args, <span class="keywordtype">int</span> is_vector)
<a name="l00471"></a>00471 {
<a name="l00472"></a>00472   <span class="keywordtype">long</span> n1, n2;
<a name="l00473"></a>00473   <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *n2_obj = NULL;
<a name="l00474"></a>00474   <span class="keyword">struct </span>type *array = NULL;
<a name="l00475"></a>00475   <span class="keyword">struct </span>type *type = ((<a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *) <span class="keyword">self</span>)-&gt;type;
<a name="l00476"></a>00476   <span class="keyword">volatile</span> <span class="keyword">struct </span><a class="code" href="structgdb__exception.html">gdb_exception</a> except;
<a name="l00477"></a>00477 
<a name="l00478"></a>00478   <span class="keywordflow">if</span> (! PyArg_ParseTuple (args, <span class="stringliteral">&quot;l|O&quot;</span>, &amp;n1, &amp;n2_obj))
<a name="l00479"></a>00479     <span class="keywordflow">return</span> NULL;
<a name="l00480"></a>00480 
<a name="l00481"></a>00481   <span class="keywordflow">if</span> (n2_obj)
<a name="l00482"></a>00482     {
<a name="l00483"></a>00483       <span class="keywordflow">if</span> (!PyInt_Check (n2_obj))
<a name="l00484"></a>00484         {
<a name="l00485"></a>00485           PyErr_SetString (PyExc_RuntimeError,
<a name="l00486"></a>00486                            <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Array bound must be an integer&quot;</span>));
<a name="l00487"></a>00487           <span class="keywordflow">return</span> NULL;
<a name="l00488"></a>00488         }
<a name="l00489"></a>00489 
<a name="l00490"></a>00490       <span class="keywordflow">if</span> (! <a class="code" href="py-utils_8c.html#a51ead1ac0abb9b8533d84a915bce41a0">gdb_py_int_as_long</a> (n2_obj, &amp;n2))
<a name="l00491"></a>00491         <span class="keywordflow">return</span> NULL;
<a name="l00492"></a>00492     }
<a name="l00493"></a>00493   <span class="keywordflow">else</span>
<a name="l00494"></a>00494     {
<a name="l00495"></a>00495       n2 = n1;
<a name="l00496"></a>00496       n1 = 0;
<a name="l00497"></a>00497     }
<a name="l00498"></a>00498 
<a name="l00499"></a>00499   <span class="keywordflow">if</span> (n2 &lt; n1)
<a name="l00500"></a>00500     {
<a name="l00501"></a>00501       PyErr_SetString (PyExc_ValueError,
<a name="l00502"></a>00502                        <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Array length must not be negative&quot;</span>));
<a name="l00503"></a>00503       <span class="keywordflow">return</span> NULL;
<a name="l00504"></a>00504     }
<a name="l00505"></a>00505 
<a name="l00506"></a>00506   <a class="code" href="exceptions_8h.html#aef4514ee39b9305fddee27f49c7c34eb">TRY_CATCH</a> (except, <a class="code" href="exceptions_8h.html#abfa3a3b99557b11f5766baf69465fdf6ab50fde886a7de8c013bf2bd4e7c073a4">RETURN_MASK_ALL</a>)
<a name="l00507"></a>00507     {
<a name="l00508"></a>00508       array = <a class="code" href="gdbtypes_8c.html#a91c24db4658fe0833c46b6fe5d677159">lookup_array_range_type</a> (type, n1, n2);
<a name="l00509"></a>00509       <span class="keywordflow">if</span> (is_vector)
<a name="l00510"></a>00510         <a class="code" href="gdbtypes_8c.html#af80dd4539475753c833d2a7df64e3060">make_vector_type</a> (array);
<a name="l00511"></a>00511     }
<a name="l00512"></a>00512   <a class="code" href="python-internal_8h.html#af341ab0b81fa8efcec4c816710785a56">GDB_PY_HANDLE_EXCEPTION</a> (except);
<a name="l00513"></a>00513 
<a name="l00514"></a>00514   <span class="keywordflow">return</span> <a class="code" href="py-type_8c.html#a81e3b010e21ee3b3fc80a056f22ff6d5">type_to_type_object</a> (array);
<a name="l00515"></a>00515 }
<a name="l00516"></a>00516 
<a name="l00517"></a>00517 <span class="comment">/* Return an array type.  */</span>
<a name="l00518"></a>00518 
<a name="l00519"></a>00519 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l00520"></a>00520 typy_array (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *args)
<a name="l00521"></a>00521 {
<a name="l00522"></a>00522   <span class="keywordflow">return</span> typy_array_1 (<span class="keyword">self</span>, args, 0);
<a name="l00523"></a>00523 }
<a name="l00524"></a>00524 
<a name="l00525"></a>00525 <span class="comment">/* Return a vector type.  */</span>
<a name="l00526"></a>00526 
<a name="l00527"></a>00527 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l00528"></a>00528 typy_vector (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *args)
<a name="l00529"></a>00529 {
<a name="l00530"></a>00530   <span class="keywordflow">return</span> typy_array_1 (<span class="keyword">self</span>, args, 1);
<a name="l00531"></a>00531 }
<a name="l00532"></a>00532 
<a name="l00533"></a>00533 <span class="comment">/* Return a Type object which represents a pointer to SELF.  */</span>
<a name="l00534"></a>00534 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l00535"></a>00535 typy_pointer (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *args)
<a name="l00536"></a>00536 {
<a name="l00537"></a>00537   <span class="keyword">struct </span>type *type = ((<a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *) <span class="keyword">self</span>)-&gt;type;
<a name="l00538"></a>00538   <span class="keyword">volatile</span> <span class="keyword">struct </span><a class="code" href="structgdb__exception.html">gdb_exception</a> except;
<a name="l00539"></a>00539 
<a name="l00540"></a>00540   <a class="code" href="exceptions_8h.html#aef4514ee39b9305fddee27f49c7c34eb">TRY_CATCH</a> (except, <a class="code" href="exceptions_8h.html#abfa3a3b99557b11f5766baf69465fdf6ab50fde886a7de8c013bf2bd4e7c073a4">RETURN_MASK_ALL</a>)
<a name="l00541"></a>00541     {
<a name="l00542"></a>00542       type = <a class="code" href="gdbtypes_8c.html#a8edb8d75a169b1455414b420088d1887">lookup_pointer_type</a> (type);
<a name="l00543"></a>00543     }
<a name="l00544"></a>00544   <a class="code" href="python-internal_8h.html#af341ab0b81fa8efcec4c816710785a56">GDB_PY_HANDLE_EXCEPTION</a> (except);
<a name="l00545"></a>00545 
<a name="l00546"></a>00546   <span class="keywordflow">return</span> <a class="code" href="py-type_8c.html#a81e3b010e21ee3b3fc80a056f22ff6d5">type_to_type_object</a> (type);
<a name="l00547"></a>00547 }
<a name="l00548"></a>00548 
<a name="l00549"></a>00549 <span class="comment">/* Return the range of a type represented by SELF.  The return type is</span>
<a name="l00550"></a>00550 <span class="comment">   a tuple.  The first element of the tuple contains the low bound,</span>
<a name="l00551"></a>00551 <span class="comment">   while the second element of the tuple contains the high bound.  */</span>
<a name="l00552"></a>00552 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l00553"></a>00553 typy_range (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *args)
<a name="l00554"></a>00554 {
<a name="l00555"></a>00555   <span class="keyword">struct </span>type *type = ((<a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *) <span class="keyword">self</span>)-&gt;type;
<a name="l00556"></a>00556   <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *result;
<a name="l00557"></a>00557   <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *low_bound = NULL, *high_bound = NULL;
<a name="l00558"></a>00558   <span class="comment">/* Initialize these to appease GCC warnings.  */</span>
<a name="l00559"></a>00559   <a class="code" href="defs_8h.html#ac7647a3f71533007c9e128f3ddda1987">LONGEST</a> low = 0, high = 0;
<a name="l00560"></a>00560 
<a name="l00561"></a>00561   <span class="keywordflow">if</span> (<a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (type) != <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a00c795b43d1a39f57d3e222385f14fc0">TYPE_CODE_ARRAY</a>
<a name="l00562"></a>00562       &amp;&amp; <a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (type) != <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a956ce01e5c83060e05208c9404fedca2">TYPE_CODE_STRING</a>
<a name="l00563"></a>00563       &amp;&amp; <a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (type) != <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a31cf8189b076711e63dea04c1136bafe">TYPE_CODE_RANGE</a>)
<a name="l00564"></a>00564     {
<a name="l00565"></a>00565       PyErr_SetString (PyExc_RuntimeError,
<a name="l00566"></a>00566                        <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;This type does not have a range.&quot;</span>));
<a name="l00567"></a>00567       <span class="keywordflow">return</span> NULL;
<a name="l00568"></a>00568     }
<a name="l00569"></a>00569 
<a name="l00570"></a>00570   <span class="keywordflow">switch</span> (<a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (type))
<a name="l00571"></a>00571     {
<a name="l00572"></a>00572     <span class="keywordflow">case</span> <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a00c795b43d1a39f57d3e222385f14fc0">TYPE_CODE_ARRAY</a>:
<a name="l00573"></a>00573     <span class="keywordflow">case</span> <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a956ce01e5c83060e05208c9404fedca2">TYPE_CODE_STRING</a>:
<a name="l00574"></a>00574       low = <a class="code" href="gdbtypes_8h.html#a8a35064d1a955f191b0a63b03755689b">TYPE_LOW_BOUND</a> (<a class="code" href="gdbtypes_8h.html#a6448238a234e871dd78756230f4f57f1">TYPE_INDEX_TYPE</a> (type));
<a name="l00575"></a>00575       high = <a class="code" href="gdbtypes_8h.html#a77cdc334123abc6858b3ea8b3361cd5d">TYPE_HIGH_BOUND</a> (<a class="code" href="gdbtypes_8h.html#a6448238a234e871dd78756230f4f57f1">TYPE_INDEX_TYPE</a> (type));
<a name="l00576"></a>00576       <span class="keywordflow">break</span>;
<a name="l00577"></a>00577     <span class="keywordflow">case</span> <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a31cf8189b076711e63dea04c1136bafe">TYPE_CODE_RANGE</a>:
<a name="l00578"></a>00578       low = <a class="code" href="gdbtypes_8h.html#a8a35064d1a955f191b0a63b03755689b">TYPE_LOW_BOUND</a> (type);
<a name="l00579"></a>00579       high = <a class="code" href="gdbtypes_8h.html#a77cdc334123abc6858b3ea8b3361cd5d">TYPE_HIGH_BOUND</a> (type);
<a name="l00580"></a>00580       <span class="keywordflow">break</span>;
<a name="l00581"></a>00581     }
<a name="l00582"></a>00582 
<a name="l00583"></a>00583   low_bound = PyLong_FromLong (low);
<a name="l00584"></a>00584   <span class="keywordflow">if</span> (!low_bound)
<a name="l00585"></a>00585     <span class="keywordflow">goto</span> failarg;
<a name="l00586"></a>00586 
<a name="l00587"></a>00587   high_bound = PyLong_FromLong (high);
<a name="l00588"></a>00588   <span class="keywordflow">if</span> (!high_bound)
<a name="l00589"></a>00589     <span class="keywordflow">goto</span> failarg;
<a name="l00590"></a>00590 
<a name="l00591"></a>00591   result = PyTuple_New (2);
<a name="l00592"></a>00592   <span class="keywordflow">if</span> (!result)
<a name="l00593"></a>00593     <span class="keywordflow">goto</span> failarg;
<a name="l00594"></a>00594 
<a name="l00595"></a>00595   <span class="keywordflow">if</span> (PyTuple_SetItem (result, 0, low_bound) != 0)
<a name="l00596"></a>00596     {
<a name="l00597"></a>00597       <a class="code" href="python-internal_8h.html#a19be7acd3e9a57b82c7be99b8594d293">Py_DECREF</a> (result);
<a name="l00598"></a>00598       <span class="keywordflow">goto</span> failarg;
<a name="l00599"></a>00599     }
<a name="l00600"></a>00600   <span class="keywordflow">if</span> (PyTuple_SetItem (result, 1, high_bound) != 0)
<a name="l00601"></a>00601     {
<a name="l00602"></a>00602       <a class="code" href="python-internal_8h.html#a19be7acd3e9a57b82c7be99b8594d293">Py_DECREF</a> (high_bound);
<a name="l00603"></a>00603       <a class="code" href="python-internal_8h.html#a19be7acd3e9a57b82c7be99b8594d293">Py_DECREF</a> (result);
<a name="l00604"></a>00604       <span class="keywordflow">return</span> NULL;
<a name="l00605"></a>00605     }
<a name="l00606"></a>00606   <span class="keywordflow">return</span> result;
<a name="l00607"></a>00607   
<a name="l00608"></a>00608  failarg:
<a name="l00609"></a>00609   Py_XDECREF (high_bound);
<a name="l00610"></a>00610   Py_XDECREF (low_bound);
<a name="l00611"></a>00611   <span class="keywordflow">return</span> NULL;
<a name="l00612"></a>00612 }
<a name="l00613"></a>00613 
<a name="l00614"></a>00614 <span class="comment">/* Return a Type object which represents a reference to SELF.  */</span>
<a name="l00615"></a>00615 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l00616"></a>00616 typy_reference (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *args)
<a name="l00617"></a>00617 {
<a name="l00618"></a>00618   <span class="keyword">struct </span>type *type = ((<a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *) <span class="keyword">self</span>)-&gt;type;
<a name="l00619"></a>00619   <span class="keyword">volatile</span> <span class="keyword">struct </span><a class="code" href="structgdb__exception.html">gdb_exception</a> except;
<a name="l00620"></a>00620 
<a name="l00621"></a>00621   <a class="code" href="exceptions_8h.html#aef4514ee39b9305fddee27f49c7c34eb">TRY_CATCH</a> (except, <a class="code" href="exceptions_8h.html#abfa3a3b99557b11f5766baf69465fdf6ab50fde886a7de8c013bf2bd4e7c073a4">RETURN_MASK_ALL</a>)
<a name="l00622"></a>00622     {
<a name="l00623"></a>00623       type = <a class="code" href="gdbtypes_8c.html#afa9bb6a94856e413a9932abea7356e22">lookup_reference_type</a> (type);
<a name="l00624"></a>00624     }
<a name="l00625"></a>00625   <a class="code" href="python-internal_8h.html#af341ab0b81fa8efcec4c816710785a56">GDB_PY_HANDLE_EXCEPTION</a> (except);
<a name="l00626"></a>00626 
<a name="l00627"></a>00627   <span class="keywordflow">return</span> <a class="code" href="py-type_8c.html#a81e3b010e21ee3b3fc80a056f22ff6d5">type_to_type_object</a> (type);
<a name="l00628"></a>00628 }
<a name="l00629"></a>00629 
<a name="l00630"></a>00630 <span class="comment">/* Return a Type object which represents the target type of SELF.  */</span>
<a name="l00631"></a>00631 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l00632"></a>00632 typy_target (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *args)
<a name="l00633"></a>00633 {
<a name="l00634"></a>00634   <span class="keyword">struct </span>type *type = ((<a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *) <span class="keyword">self</span>)-&gt;type;
<a name="l00635"></a>00635 
<a name="l00636"></a>00636   <span class="keywordflow">if</span> (!<a class="code" href="gdbtypes_8h.html#a87a33d723acd28a033e63c4297c6c916">TYPE_TARGET_TYPE</a> (type))
<a name="l00637"></a>00637     {
<a name="l00638"></a>00638       PyErr_SetString (PyExc_RuntimeError, 
<a name="l00639"></a>00639                        <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Type does not have a target.&quot;</span>));
<a name="l00640"></a>00640       <span class="keywordflow">return</span> NULL;
<a name="l00641"></a>00641     }
<a name="l00642"></a>00642 
<a name="l00643"></a>00643   <span class="keywordflow">return</span> <a class="code" href="py-type_8c.html#a81e3b010e21ee3b3fc80a056f22ff6d5">type_to_type_object</a> (<a class="code" href="gdbtypes_8h.html#a87a33d723acd28a033e63c4297c6c916">TYPE_TARGET_TYPE</a> (type));
<a name="l00644"></a>00644 }
<a name="l00645"></a>00645 
<a name="l00646"></a>00646 <span class="comment">/* Return a const-qualified type variant.  */</span>
<a name="l00647"></a>00647 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l00648"></a>00648 typy_const (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *args)
<a name="l00649"></a>00649 {
<a name="l00650"></a>00650   <span class="keyword">struct </span>type *type = ((<a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *) <span class="keyword">self</span>)-&gt;type;
<a name="l00651"></a>00651   <span class="keyword">volatile</span> <span class="keyword">struct </span><a class="code" href="structgdb__exception.html">gdb_exception</a> except;
<a name="l00652"></a>00652 
<a name="l00653"></a>00653   <a class="code" href="exceptions_8h.html#aef4514ee39b9305fddee27f49c7c34eb">TRY_CATCH</a> (except, <a class="code" href="exceptions_8h.html#abfa3a3b99557b11f5766baf69465fdf6ab50fde886a7de8c013bf2bd4e7c073a4">RETURN_MASK_ALL</a>)
<a name="l00654"></a>00654     {
<a name="l00655"></a>00655       type = <a class="code" href="gdbtypes_8c.html#ab5e31dbb249efdac4f48d4871290bf46">make_cv_type</a> (1, 0, type, NULL);
<a name="l00656"></a>00656     }
<a name="l00657"></a>00657   <a class="code" href="python-internal_8h.html#af341ab0b81fa8efcec4c816710785a56">GDB_PY_HANDLE_EXCEPTION</a> (except);
<a name="l00658"></a>00658 
<a name="l00659"></a>00659   <span class="keywordflow">return</span> <a class="code" href="py-type_8c.html#a81e3b010e21ee3b3fc80a056f22ff6d5">type_to_type_object</a> (type);
<a name="l00660"></a>00660 }
<a name="l00661"></a>00661 
<a name="l00662"></a>00662 <span class="comment">/* Return a volatile-qualified type variant.  */</span>
<a name="l00663"></a>00663 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l00664"></a>00664 typy_volatile (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *args)
<a name="l00665"></a>00665 {
<a name="l00666"></a>00666   <span class="keyword">struct </span>type *type = ((<a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *) <span class="keyword">self</span>)-&gt;type;
<a name="l00667"></a>00667   <span class="keyword">volatile</span> <span class="keyword">struct </span><a class="code" href="structgdb__exception.html">gdb_exception</a> except;
<a name="l00668"></a>00668 
<a name="l00669"></a>00669   <a class="code" href="exceptions_8h.html#aef4514ee39b9305fddee27f49c7c34eb">TRY_CATCH</a> (except, <a class="code" href="exceptions_8h.html#abfa3a3b99557b11f5766baf69465fdf6ab50fde886a7de8c013bf2bd4e7c073a4">RETURN_MASK_ALL</a>)
<a name="l00670"></a>00670     {
<a name="l00671"></a>00671       type = <a class="code" href="gdbtypes_8c.html#ab5e31dbb249efdac4f48d4871290bf46">make_cv_type</a> (0, 1, type, NULL);
<a name="l00672"></a>00672     }
<a name="l00673"></a>00673   <a class="code" href="python-internal_8h.html#af341ab0b81fa8efcec4c816710785a56">GDB_PY_HANDLE_EXCEPTION</a> (except);
<a name="l00674"></a>00674 
<a name="l00675"></a>00675   <span class="keywordflow">return</span> <a class="code" href="py-type_8c.html#a81e3b010e21ee3b3fc80a056f22ff6d5">type_to_type_object</a> (type);
<a name="l00676"></a>00676 }
<a name="l00677"></a>00677 
<a name="l00678"></a>00678 <span class="comment">/* Return an unqualified type variant.  */</span>
<a name="l00679"></a>00679 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l00680"></a>00680 typy_unqualified (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *args)
<a name="l00681"></a>00681 {
<a name="l00682"></a>00682   <span class="keyword">struct </span>type *type = ((<a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *) <span class="keyword">self</span>)-&gt;type;
<a name="l00683"></a>00683   <span class="keyword">volatile</span> <span class="keyword">struct </span><a class="code" href="structgdb__exception.html">gdb_exception</a> except;
<a name="l00684"></a>00684 
<a name="l00685"></a>00685   <a class="code" href="exceptions_8h.html#aef4514ee39b9305fddee27f49c7c34eb">TRY_CATCH</a> (except, <a class="code" href="exceptions_8h.html#abfa3a3b99557b11f5766baf69465fdf6ab50fde886a7de8c013bf2bd4e7c073a4">RETURN_MASK_ALL</a>)
<a name="l00686"></a>00686     {
<a name="l00687"></a>00687       type = <a class="code" href="gdbtypes_8c.html#ab5e31dbb249efdac4f48d4871290bf46">make_cv_type</a> (0, 0, type, NULL);
<a name="l00688"></a>00688     }
<a name="l00689"></a>00689   <a class="code" href="python-internal_8h.html#af341ab0b81fa8efcec4c816710785a56">GDB_PY_HANDLE_EXCEPTION</a> (except);
<a name="l00690"></a>00690 
<a name="l00691"></a>00691   <span class="keywordflow">return</span> <a class="code" href="py-type_8c.html#a81e3b010e21ee3b3fc80a056f22ff6d5">type_to_type_object</a> (type);
<a name="l00692"></a>00692 }
<a name="l00693"></a>00693 
<a name="l00694"></a>00694 <span class="comment">/* Return the size of the type represented by SELF, in bytes.  */</span>
<a name="l00695"></a>00695 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l00696"></a>00696 typy_get_sizeof (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <span class="keywordtype">void</span> *closure)
<a name="l00697"></a>00697 {
<a name="l00698"></a>00698   <span class="keyword">struct </span>type *type = ((<a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *) <span class="keyword">self</span>)-&gt;type;
<a name="l00699"></a>00699   <span class="keyword">volatile</span> <span class="keyword">struct </span><a class="code" href="structgdb__exception.html">gdb_exception</a> except;
<a name="l00700"></a>00700 
<a name="l00701"></a>00701   <a class="code" href="exceptions_8h.html#aef4514ee39b9305fddee27f49c7c34eb">TRY_CATCH</a> (except, <a class="code" href="exceptions_8h.html#abfa3a3b99557b11f5766baf69465fdf6ab50fde886a7de8c013bf2bd4e7c073a4">RETURN_MASK_ALL</a>)
<a name="l00702"></a>00702     {
<a name="l00703"></a>00703       <a class="code" href="gdbtypes_8c.html#a0bf29d7521d8a8b8735b9a259e380386">check_typedef</a> (type);
<a name="l00704"></a>00704     }
<a name="l00705"></a>00705   <span class="comment">/* Ignore exceptions.  */</span>
<a name="l00706"></a>00706 
<a name="l00707"></a>00707   <span class="keywordflow">return</span> <a class="code" href="python-internal_8h.html#ab057269feffea5766e98aa0142788ad1">gdb_py_long_from_longest</a> (<a class="code" href="gdbtypes_8h.html#aeac33f868e763780094aec8a2dcb9a1a">TYPE_LENGTH</a> (type));
<a name="l00708"></a>00708 }
<a name="l00709"></a>00709 
<a name="l00710"></a>00710 <span class="keyword">static</span> <span class="keyword">struct </span>type *
<a name="l00711"></a>00711 typy_lookup_typename (<span class="keyword">const</span> <span class="keywordtype">char</span> *type_name, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structblock.html">block</a> *<a class="code" href="structblock.html">block</a>)
<a name="l00712"></a>00712 {
<a name="l00713"></a>00713   <span class="keyword">struct </span>type *type = NULL;
<a name="l00714"></a>00714   <span class="keyword">volatile</span> <span class="keyword">struct </span><a class="code" href="structgdb__exception.html">gdb_exception</a> except;
<a name="l00715"></a>00715 
<a name="l00716"></a>00716   <a class="code" href="exceptions_8h.html#aef4514ee39b9305fddee27f49c7c34eb">TRY_CATCH</a> (except, <a class="code" href="exceptions_8h.html#abfa3a3b99557b11f5766baf69465fdf6ab50fde886a7de8c013bf2bd4e7c073a4">RETURN_MASK_ALL</a>)
<a name="l00717"></a>00717     {
<a name="l00718"></a>00718       <span class="keywordflow">if</span> (!strncmp (type_name, <span class="stringliteral">&quot;struct &quot;</span>, 7))
<a name="l00719"></a>00719         type = <a class="code" href="gdbtypes_8c.html#ab3e055862374c2d5b474e7a3ab7f59d5">lookup_struct</a> (type_name + 7, NULL);
<a name="l00720"></a>00720       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncmp (type_name, <span class="stringliteral">&quot;union &quot;</span>, 6))
<a name="l00721"></a>00721         type = <a class="code" href="gdbtypes_8c.html#a4a3b66ad256182d22b39ad9c68272de8">lookup_union</a> (type_name + 6, NULL);
<a name="l00722"></a>00722       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncmp (type_name, <span class="stringliteral">&quot;enum &quot;</span>, 5))
<a name="l00723"></a>00723         type = <a class="code" href="gdbtypes_8c.html#af34500b42276bcee199024fbbf599b4b">lookup_enum</a> (type_name + 5, NULL);
<a name="l00724"></a>00724       <span class="keywordflow">else</span>
<a name="l00725"></a>00725         type = <a class="code" href="gdbtypes_8c.html#adadb1dc66dab92ad081c55f355a1582c">lookup_typename</a> (python_language, python_gdbarch,
<a name="l00726"></a>00726                                 type_name, block, 0);
<a name="l00727"></a>00727     }
<a name="l00728"></a>00728   <a class="code" href="python-internal_8h.html#af341ab0b81fa8efcec4c816710785a56">GDB_PY_HANDLE_EXCEPTION</a> (except);
<a name="l00729"></a>00729 
<a name="l00730"></a>00730   <span class="keywordflow">return</span> type;
<a name="l00731"></a>00731 }
<a name="l00732"></a>00732 
<a name="l00733"></a>00733 <span class="keyword">static</span> <span class="keyword">struct </span>type *
<a name="l00734"></a>00734 typy_lookup_type (<span class="keyword">struct</span> demangle_component *demangled,
<a name="l00735"></a>00735                   <span class="keyword">const</span> <span class="keyword">struct</span> block *block)
<a name="l00736"></a>00736 {
<a name="l00737"></a>00737   <span class="keyword">struct </span>type *type, *rtype = NULL;
<a name="l00738"></a>00738   <span class="keywordtype">char</span> *type_name = NULL;
<a name="l00739"></a>00739   <span class="keyword">enum</span> demangle_component_type demangled_type;
<a name="l00740"></a>00740   <span class="keyword">volatile</span> <span class="keyword">struct </span><a class="code" href="structgdb__exception.html">gdb_exception</a> except;
<a name="l00741"></a>00741 
<a name="l00742"></a>00742   <span class="comment">/* Save the type: typy_lookup_type() may (indirectly) overwrite</span>
<a name="l00743"></a>00743 <span class="comment">     memory pointed by demangled.  */</span>
<a name="l00744"></a>00744   demangled_type = demangled-&gt;type;
<a name="l00745"></a>00745 
<a name="l00746"></a>00746   <span class="keywordflow">if</span> (demangled_type == DEMANGLE_COMPONENT_POINTER
<a name="l00747"></a>00747       || demangled_type == DEMANGLE_COMPONENT_REFERENCE
<a name="l00748"></a>00748       || demangled_type == DEMANGLE_COMPONENT_CONST
<a name="l00749"></a>00749       || demangled_type == DEMANGLE_COMPONENT_VOLATILE)
<a name="l00750"></a>00750     {
<a name="l00751"></a>00751       type = typy_lookup_type (demangled-&gt;u.s_binary.left, block);
<a name="l00752"></a>00752       <span class="keywordflow">if</span> (! type)
<a name="l00753"></a>00753         <span class="keywordflow">return</span> NULL;
<a name="l00754"></a>00754 
<a name="l00755"></a>00755       <a class="code" href="exceptions_8h.html#aef4514ee39b9305fddee27f49c7c34eb">TRY_CATCH</a> (except, <a class="code" href="exceptions_8h.html#abfa3a3b99557b11f5766baf69465fdf6ab50fde886a7de8c013bf2bd4e7c073a4">RETURN_MASK_ALL</a>)
<a name="l00756"></a>00756         {
<a name="l00757"></a>00757           <span class="comment">/* If the demangled_type matches with one of the types</span>
<a name="l00758"></a>00758 <span class="comment">             below, run the corresponding function and save the type</span>
<a name="l00759"></a>00759 <span class="comment">             to return later.  We cannot just return here as we are in</span>
<a name="l00760"></a>00760 <span class="comment">             an exception handler.  */</span>
<a name="l00761"></a>00761           <span class="keywordflow">switch</span> (demangled_type)
<a name="l00762"></a>00762             {
<a name="l00763"></a>00763             <span class="keywordflow">case</span> DEMANGLE_COMPONENT_REFERENCE:
<a name="l00764"></a>00764               rtype =  <a class="code" href="gdbtypes_8c.html#afa9bb6a94856e413a9932abea7356e22">lookup_reference_type</a> (type);
<a name="l00765"></a>00765               <span class="keywordflow">break</span>;
<a name="l00766"></a>00766             <span class="keywordflow">case</span> DEMANGLE_COMPONENT_POINTER:
<a name="l00767"></a>00767               rtype = <a class="code" href="gdbtypes_8c.html#a8edb8d75a169b1455414b420088d1887">lookup_pointer_type</a> (type);
<a name="l00768"></a>00768               <span class="keywordflow">break</span>;
<a name="l00769"></a>00769             <span class="keywordflow">case</span> DEMANGLE_COMPONENT_CONST:
<a name="l00770"></a>00770               rtype = <a class="code" href="gdbtypes_8c.html#ab5e31dbb249efdac4f48d4871290bf46">make_cv_type</a> (1, 0, type, NULL);
<a name="l00771"></a>00771               <span class="keywordflow">break</span>;
<a name="l00772"></a>00772             <span class="keywordflow">case</span> DEMANGLE_COMPONENT_VOLATILE:
<a name="l00773"></a>00773               rtype = <a class="code" href="gdbtypes_8c.html#ab5e31dbb249efdac4f48d4871290bf46">make_cv_type</a> (0, 1, type, NULL);
<a name="l00774"></a>00774               <span class="keywordflow">break</span>;
<a name="l00775"></a>00775             }
<a name="l00776"></a>00776         }
<a name="l00777"></a>00777       <a class="code" href="python-internal_8h.html#af341ab0b81fa8efcec4c816710785a56">GDB_PY_HANDLE_EXCEPTION</a> (except);
<a name="l00778"></a>00778     }
<a name="l00779"></a>00779   
<a name="l00780"></a>00780   <span class="comment">/* If we have a type from the switch statement above, just return</span>
<a name="l00781"></a>00781 <span class="comment">     that.  */</span>
<a name="l00782"></a>00782   <span class="keywordflow">if</span> (rtype)
<a name="l00783"></a>00783     <span class="keywordflow">return</span> rtype;
<a name="l00784"></a>00784   
<a name="l00785"></a>00785   <span class="comment">/* We don&#39;t have a type, so lookup the type.  */</span>
<a name="l00786"></a>00786   type_name = <a class="code" href="cp-support_8h.html#acfcf757fc9842cd18eba35eae4185096">cp_comp_to_string</a> (demangled, 10);
<a name="l00787"></a>00787   type = typy_lookup_typename (type_name, block);
<a name="l00788"></a>00788   <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (type_name);
<a name="l00789"></a>00789 
<a name="l00790"></a>00790   <span class="keywordflow">return</span> type;
<a name="l00791"></a>00791 }
<a name="l00792"></a>00792 
<a name="l00793"></a>00793 <span class="comment">/* This is a helper function for typy_template_argument that is used</span>
<a name="l00794"></a>00794 <span class="comment">   when the type does not have template symbols attached.  It works by</span>
<a name="l00795"></a>00795 <span class="comment">   parsing the type name.  This happens with compilers, like older</span>
<a name="l00796"></a>00796 <span class="comment">   versions of GCC, that do not emit DW_TAG_template_*.  */</span>
<a name="l00797"></a>00797 
<a name="l00798"></a>00798 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l00799"></a>00799 typy_legacy_template_argument (<span class="keyword">struct</span> type *type, <span class="keyword">const</span> <span class="keyword">struct</span> block *block,
<a name="l00800"></a>00800                                <span class="keywordtype">int</span> argno)
<a name="l00801"></a>00801 {
<a name="l00802"></a>00802   <span class="keywordtype">int</span> i;
<a name="l00803"></a>00803   <span class="keyword">struct </span>demangle_component *demangled;
<a name="l00804"></a>00804   <span class="keyword">struct </span><a class="code" href="structdemangle__parse__info.html">demangle_parse_info</a> *<a class="code" href="structdemangle__parse__info.html#a5fb8c7e5dccffb6e98ac9658ce0dc330">info</a> = NULL;
<a name="l00805"></a>00805   <span class="keyword">const</span> <span class="keywordtype">char</span> *err;
<a name="l00806"></a>00806   <span class="keyword">struct </span>type *argtype;
<a name="l00807"></a>00807   <span class="keyword">struct </span>cleanup *cleanup;
<a name="l00808"></a>00808   <span class="keyword">volatile</span> <span class="keyword">struct </span><a class="code" href="structgdb__exception.html">gdb_exception</a> except;
<a name="l00809"></a>00809 
<a name="l00810"></a>00810   <span class="keywordflow">if</span> (<a class="code" href="gdbtypes_8h.html#a60f6434779617e9ff9c60121ceb25015">TYPE_NAME</a> (type) == NULL)
<a name="l00811"></a>00811     {
<a name="l00812"></a>00812       PyErr_SetString (PyExc_RuntimeError, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Null type name.&quot;</span>));
<a name="l00813"></a>00813       <span class="keywordflow">return</span> NULL;
<a name="l00814"></a>00814     }
<a name="l00815"></a>00815 
<a name="l00816"></a>00816   <a class="code" href="exceptions_8h.html#aef4514ee39b9305fddee27f49c7c34eb">TRY_CATCH</a> (except, <a class="code" href="exceptions_8h.html#abfa3a3b99557b11f5766baf69465fdf6ab50fde886a7de8c013bf2bd4e7c073a4">RETURN_MASK_ALL</a>)
<a name="l00817"></a>00817     {
<a name="l00818"></a>00818       <span class="comment">/* Note -- this is not thread-safe.  */</span>
<a name="l00819"></a>00819       info = <a class="code" href="cp-support_8h.html#acd1741db1e809ee2eda9add915443492">cp_demangled_name_to_comp</a> (<a class="code" href="gdbtypes_8h.html#a60f6434779617e9ff9c60121ceb25015">TYPE_NAME</a> (type), &amp;err);
<a name="l00820"></a>00820     }
<a name="l00821"></a>00821   <a class="code" href="python-internal_8h.html#af341ab0b81fa8efcec4c816710785a56">GDB_PY_HANDLE_EXCEPTION</a> (except);
<a name="l00822"></a>00822 
<a name="l00823"></a>00823   <span class="keywordflow">if</span> (! info)
<a name="l00824"></a>00824     {
<a name="l00825"></a>00825       PyErr_SetString (PyExc_RuntimeError, err);
<a name="l00826"></a>00826       <span class="keywordflow">return</span> NULL;
<a name="l00827"></a>00827     }
<a name="l00828"></a>00828   demangled = info-&gt;<a class="code" href="structdemangle__parse__info.html#a5b5cc3882be46fff69af215b64e1e0bb">tree</a>;
<a name="l00829"></a>00829   cleanup = <a class="code" href="cp-support_8c.html#a20eb54bcb337663cdc39eb0ed8810845">make_cleanup_cp_demangled_name_parse_free</a> (info);
<a name="l00830"></a>00830 
<a name="l00831"></a>00831   <span class="comment">/* Strip off component names.  */</span>
<a name="l00832"></a>00832   <span class="keywordflow">while</span> (demangled-&gt;type == DEMANGLE_COMPONENT_QUAL_NAME
<a name="l00833"></a>00833          || demangled-&gt;type == DEMANGLE_COMPONENT_LOCAL_NAME)
<a name="l00834"></a>00834     demangled = demangled-&gt;u.s_binary.right;
<a name="l00835"></a>00835 
<a name="l00836"></a>00836   <span class="keywordflow">if</span> (demangled-&gt;type != DEMANGLE_COMPONENT_TEMPLATE)
<a name="l00837"></a>00837     {
<a name="l00838"></a>00838       <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup);
<a name="l00839"></a>00839       PyErr_SetString (PyExc_RuntimeError, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Type is not a template.&quot;</span>));
<a name="l00840"></a>00840       <span class="keywordflow">return</span> NULL;
<a name="l00841"></a>00841     }
<a name="l00842"></a>00842 
<a name="l00843"></a>00843   <span class="comment">/* Skip from the template to the arguments.  */</span>
<a name="l00844"></a>00844   demangled = demangled-&gt;u.s_binary.right;
<a name="l00845"></a>00845 
<a name="l00846"></a>00846   <span class="keywordflow">for</span> (i = 0; demangled &amp;&amp; i &lt; argno; ++i)
<a name="l00847"></a>00847     demangled = demangled-&gt;u.s_binary.right;
<a name="l00848"></a>00848 
<a name="l00849"></a>00849   if (! demangled)
<a name="l00850"></a>00850     {
<a name="l00851"></a>00851       <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup);
<a name="l00852"></a>00852       PyErr_Format (PyExc_RuntimeError, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No argument %d in template.&quot;</span>),
<a name="l00853"></a>00853                     argno);
<a name="l00854"></a>00854       <span class="keywordflow">return</span> NULL;
<a name="l00855"></a>00855     }
<a name="l00856"></a>00856 
<a name="l00857"></a>00857   argtype = typy_lookup_type (demangled-&gt;u.s_binary.left, block);
<a name="l00858"></a>00858   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup);
<a name="l00859"></a>00859   <span class="keywordflow">if</span> (! argtype)
<a name="l00860"></a>00860     <span class="keywordflow">return</span> NULL;
<a name="l00861"></a>00861 
<a name="l00862"></a>00862   <span class="keywordflow">return</span> <a class="code" href="py-type_8c.html#a81e3b010e21ee3b3fc80a056f22ff6d5">type_to_type_object</a> (argtype);
<a name="l00863"></a>00863 }
<a name="l00864"></a>00864 
<a name="l00865"></a>00865 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l00866"></a>00866 typy_template_argument (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *args)
<a name="l00867"></a>00867 {
<a name="l00868"></a>00868   <span class="keywordtype">int</span> argno;
<a name="l00869"></a>00869   <span class="keyword">struct </span>type *type = ((<a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *) <span class="keyword">self</span>)-&gt;type;
<a name="l00870"></a>00870   <span class="keyword">const</span> <span class="keyword">struct </span>block *block = NULL;
<a name="l00871"></a>00871   <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *block_obj = NULL;
<a name="l00872"></a>00872   <span class="keyword">struct </span><a class="code" href="structsymbol.html">symbol</a> *sym;
<a name="l00873"></a>00873   <span class="keyword">struct </span>value *val = NULL;
<a name="l00874"></a>00874   <span class="keyword">volatile</span> <span class="keyword">struct </span><a class="code" href="structgdb__exception.html">gdb_exception</a> except;
<a name="l00875"></a>00875 
<a name="l00876"></a>00876   <span class="keywordflow">if</span> (! PyArg_ParseTuple (args, <span class="stringliteral">&quot;i|O&quot;</span>, &amp;argno, &amp;block_obj))
<a name="l00877"></a>00877     <span class="keywordflow">return</span> NULL;
<a name="l00878"></a>00878 
<a name="l00879"></a>00879   <span class="keywordflow">if</span> (block_obj)
<a name="l00880"></a>00880     {
<a name="l00881"></a>00881       block = <a class="code" href="py-block_8c.html#ad703ff4e367170e398e186ae465ea7f4">block_object_to_block</a> (block_obj);
<a name="l00882"></a>00882       <span class="keywordflow">if</span> (! block)
<a name="l00883"></a>00883         {
<a name="l00884"></a>00884           PyErr_SetString (PyExc_RuntimeError,
<a name="l00885"></a>00885                            <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Second argument must be block.&quot;</span>));
<a name="l00886"></a>00886           <span class="keywordflow">return</span> NULL;
<a name="l00887"></a>00887         }
<a name="l00888"></a>00888     }
<a name="l00889"></a>00889 
<a name="l00890"></a>00890   <a class="code" href="exceptions_8h.html#aef4514ee39b9305fddee27f49c7c34eb">TRY_CATCH</a> (except, <a class="code" href="exceptions_8h.html#abfa3a3b99557b11f5766baf69465fdf6ab50fde886a7de8c013bf2bd4e7c073a4">RETURN_MASK_ALL</a>)
<a name="l00891"></a>00891     {
<a name="l00892"></a>00892       type = <a class="code" href="gdbtypes_8c.html#a0bf29d7521d8a8b8735b9a259e380386">check_typedef</a> (type);
<a name="l00893"></a>00893       <span class="keywordflow">if</span> (<a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (type) == <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a476430709e5a251f7e0f8e3fb48a713f">TYPE_CODE_REF</a>)
<a name="l00894"></a>00894         type = <a class="code" href="gdbtypes_8c.html#a0bf29d7521d8a8b8735b9a259e380386">check_typedef</a> (<a class="code" href="gdbtypes_8h.html#a87a33d723acd28a033e63c4297c6c916">TYPE_TARGET_TYPE</a> (type));
<a name="l00895"></a>00895     }
<a name="l00896"></a>00896   <a class="code" href="python-internal_8h.html#af341ab0b81fa8efcec4c816710785a56">GDB_PY_HANDLE_EXCEPTION</a> (except);
<a name="l00897"></a>00897 
<a name="l00898"></a>00898   <span class="comment">/* We might not have DW_TAG_template_*, so try to parse the type&#39;s</span>
<a name="l00899"></a>00899 <span class="comment">     name.  This is inefficient if we do not have a template type --</span>
<a name="l00900"></a>00900 <span class="comment">     but that is going to wind up as an error anyhow.  */</span>
<a name="l00901"></a>00901   <span class="keywordflow">if</span> (! <a class="code" href="gdbtypes_8h.html#a9bac56587d93fbab70301eed2bd4a0bd">TYPE_N_TEMPLATE_ARGUMENTS</a> (type))
<a name="l00902"></a>00902     <span class="keywordflow">return</span> typy_legacy_template_argument (type, block, argno);
<a name="l00903"></a>00903 
<a name="l00904"></a>00904   <span class="keywordflow">if</span> (argno &gt;= <a class="code" href="gdbtypes_8h.html#a9bac56587d93fbab70301eed2bd4a0bd">TYPE_N_TEMPLATE_ARGUMENTS</a> (type))
<a name="l00905"></a>00905     {
<a name="l00906"></a>00906       PyErr_Format (PyExc_RuntimeError, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No argument %d in template.&quot;</span>),
<a name="l00907"></a>00907                     argno);
<a name="l00908"></a>00908       <span class="keywordflow">return</span> NULL;
<a name="l00909"></a>00909     }
<a name="l00910"></a>00910 
<a name="l00911"></a>00911   sym = <a class="code" href="gdbtypes_8h.html#ab3ad8861abfe798cf6517cb6a889f640">TYPE_TEMPLATE_ARGUMENT</a> (type, argno);
<a name="l00912"></a>00912   <span class="keywordflow">if</span> (<a class="code" href="symtab_8h.html#a8394f2ba6c27e8026b2783db7cc0eb40">SYMBOL_CLASS</a> (sym) == <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3ac0b2498d37ddd0f48d23739bba4abca4">LOC_TYPEDEF</a>)
<a name="l00913"></a>00913     <span class="keywordflow">return</span> <a class="code" href="py-type_8c.html#a81e3b010e21ee3b3fc80a056f22ff6d5">type_to_type_object</a> (<a class="code" href="symtab_8h.html#aadfeb02c4b5fc2b6764ad32eaccf0e58">SYMBOL_TYPE</a> (sym));
<a name="l00914"></a>00914   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="symtab_8h.html#a8394f2ba6c27e8026b2783db7cc0eb40">SYMBOL_CLASS</a> (sym) == <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3aa4f37f80c900ee253911325c30b8a60f">LOC_OPTIMIZED_OUT</a>)
<a name="l00915"></a>00915     {
<a name="l00916"></a>00916       PyErr_Format (PyExc_RuntimeError,
<a name="l00917"></a>00917                     <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Template argument is optimized out&quot;</span>));
<a name="l00918"></a>00918       <span class="keywordflow">return</span> NULL;
<a name="l00919"></a>00919     }
<a name="l00920"></a>00920 
<a name="l00921"></a>00921   <a class="code" href="exceptions_8h.html#aef4514ee39b9305fddee27f49c7c34eb">TRY_CATCH</a> (except, <a class="code" href="exceptions_8h.html#abfa3a3b99557b11f5766baf69465fdf6ab50fde886a7de8c013bf2bd4e7c073a4">RETURN_MASK_ALL</a>)
<a name="l00922"></a>00922     {
<a name="l00923"></a>00923       val = <a class="code" href="valops_8c.html#a353e75e3afb5f274e886d08360d045b8">value_of_variable</a> (sym, block);
<a name="l00924"></a>00924     }
<a name="l00925"></a>00925   <a class="code" href="python-internal_8h.html#af341ab0b81fa8efcec4c816710785a56">GDB_PY_HANDLE_EXCEPTION</a> (except);
<a name="l00926"></a>00926 
<a name="l00927"></a>00927   <span class="keywordflow">return</span> <a class="code" href="python-internal_8h.html#ae5c07c92590470b1a6e921de62f3f824">value_to_value_object</a> (val);
<a name="l00928"></a>00928 }
<a name="l00929"></a>00929 
<a name="l00930"></a>00930 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l00931"></a>00931 typy_str (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>)
<a name="l00932"></a>00932 {
<a name="l00933"></a>00933   <span class="keyword">volatile</span> <span class="keyword">struct </span><a class="code" href="structgdb__exception.html">gdb_exception</a> except;
<a name="l00934"></a>00934   <span class="keywordtype">char</span> *thetype = NULL;
<a name="l00935"></a>00935   <span class="keywordtype">long</span> length = 0;
<a name="l00936"></a>00936   <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *result;
<a name="l00937"></a>00937 
<a name="l00938"></a>00938   <a class="code" href="exceptions_8h.html#aef4514ee39b9305fddee27f49c7c34eb">TRY_CATCH</a> (except, <a class="code" href="exceptions_8h.html#abfa3a3b99557b11f5766baf69465fdf6ab50fde886a7de8c013bf2bd4e7c073a4">RETURN_MASK_ALL</a>)
<a name="l00939"></a>00939     {
<a name="l00940"></a>00940       <span class="keyword">struct </span>cleanup *old_chain;
<a name="l00941"></a>00941       <span class="keyword">struct </span>ui_file *stb;
<a name="l00942"></a>00942 
<a name="l00943"></a>00943       stb = <a class="code" href="ui-file_8c.html#a340771735f105582d314e191a399a45c">mem_fileopen</a> ();
<a name="l00944"></a>00944       old_chain = <a class="code" href="utils_8c.html#a94dc56baeb57791e114136764f7763aa">make_cleanup_ui_file_delete</a> (stb);
<a name="l00945"></a>00945 
<a name="l00946"></a>00946       <a class="code" href="language_8h.html#a8fbac7443669377b16c4324c96541069">LA_PRINT_TYPE</a> (<a class="code" href="py-type_8c.html#acd77c1e08fb2bedf0501106071f609fe">type_object_to_type</a> (<span class="keyword">self</span>), <span class="stringliteral">&quot;&quot;</span>, stb, -1, 0,
<a name="l00947"></a>00947                      &amp;<a class="code" href="typeprint_8c.html#a66053927e0c2e901b62bd36fd9769296">type_print_raw_options</a>);
<a name="l00948"></a>00948 
<a name="l00949"></a>00949       thetype = <a class="code" href="ui-file_8c.html#a995485039ce5a1d994a1863cd76a5356">ui_file_xstrdup</a> (stb, &amp;length);
<a name="l00950"></a>00950       <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l00951"></a>00951     }
<a name="l00952"></a>00952   <span class="keywordflow">if</span> (except.reason &lt; 0)
<a name="l00953"></a>00953     {
<a name="l00954"></a>00954       <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (thetype);
<a name="l00955"></a>00955       <a class="code" href="python-internal_8h.html#af341ab0b81fa8efcec4c816710785a56">GDB_PY_HANDLE_EXCEPTION</a> (except);
<a name="l00956"></a>00956     }
<a name="l00957"></a>00957 
<a name="l00958"></a>00958   result = PyUnicode_Decode (thetype, length, <a class="code" href="charset_8c.html#ae8979ed1b224684a2a61a7284f03942d">host_charset</a> (), NULL);
<a name="l00959"></a>00959   <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (thetype);
<a name="l00960"></a>00960 
<a name="l00961"></a>00961   <span class="keywordflow">return</span> result;
<a name="l00962"></a>00962 }
<a name="l00963"></a>00963 
<a name="l00964"></a>00964 <span class="comment">/* An entry in the type-equality bcache.  */</span>
<a name="l00965"></a>00965 
<a name="l00966"></a>00966 <span class="keyword">typedef</span> <span class="keyword">struct </span>type_equality_entry
<a name="l00967"></a>00967 {
<a name="l00968"></a>00968   <span class="keyword">struct </span>type *type1, *type2;
<a name="l00969"></a>00969 } <a class="code" href="py-type_8c.html#a648b36f43996408c372616ee0cc87b78">type_equality_entry_d</a>;
<a name="l00970"></a>00970 
<a name="l00971"></a>00971 <a class="code" href="vec_8h.html#abc2d38563a8b5bed340654cf06060f11">DEF_VEC_O</a> (<a class="code" href="py-type_8c.html#a648b36f43996408c372616ee0cc87b78">type_equality_entry_d</a>);
<a name="l00972"></a>00972 
<a name="l00973"></a>00973 <span class="comment">/* A helper function to compare two strings.  Returns 1 if they are</span>
<a name="l00974"></a>00974 <span class="comment">   the same, 0 otherwise.  Handles NULLs properly.  */</span>
<a name="l00975"></a>00975 
<a name="l00976"></a>00976 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00977"></a>00977 compare_maybe_null_strings (<span class="keyword">const</span> <span class="keywordtype">char</span> *s, <span class="keyword">const</span> <span class="keywordtype">char</span> *t)
<a name="l00978"></a>00978 {
<a name="l00979"></a>00979   <span class="keywordflow">if</span> (s == NULL &amp;&amp; t != NULL)
<a name="l00980"></a>00980     <span class="keywordflow">return</span> 0;
<a name="l00981"></a>00981   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s != NULL &amp;&amp; t == NULL)
<a name="l00982"></a>00982     <span class="keywordflow">return</span> 0;
<a name="l00983"></a>00983   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s == NULL &amp;&amp; t== NULL)
<a name="l00984"></a>00984     <span class="keywordflow">return</span> 1;
<a name="l00985"></a>00985   <span class="keywordflow">return</span> strcmp (s, t) == 0;
<a name="l00986"></a>00986 }
<a name="l00987"></a>00987 
<a name="l00988"></a>00988 <span class="comment">/* A helper function for typy_richcompare that checks two types for</span>
<a name="l00989"></a>00989 <span class="comment">   &quot;deep&quot; equality.  Returns Py_EQ if the types are considered the</span>
<a name="l00990"></a>00990 <span class="comment">   same, Py_NE otherwise.  */</span>
<a name="l00991"></a>00991 
<a name="l00992"></a>00992 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00993"></a>00993 check_types_equal (<span class="keyword">struct</span> type *type1, <span class="keyword">struct</span> type *type2,
<a name="l00994"></a>00994                    <a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a> (<a class="code" href="py-type_8c.html#a648b36f43996408c372616ee0cc87b78">type_equality_entry_d</a>) **worklist)
<a name="l00995"></a>00995 {
<a name="l00996"></a>00996   <a class="code" href="gdbtypes_8h.html#ae2f9348c644babaa9038b4dc18bffaac">CHECK_TYPEDEF</a> (type1);
<a name="l00997"></a>00997   <a class="code" href="gdbtypes_8h.html#ae2f9348c644babaa9038b4dc18bffaac">CHECK_TYPEDEF</a> (type2);
<a name="l00998"></a>00998 
<a name="l00999"></a>00999   <span class="keywordflow">if</span> (type1 == type2)
<a name="l01000"></a>01000     <span class="keywordflow">return</span> Py_EQ;
<a name="l01001"></a>01001 
<a name="l01002"></a>01002   <span class="keywordflow">if</span> (<a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (type1) != <a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (type2)
<a name="l01003"></a>01003       || <a class="code" href="gdbtypes_8h.html#aeac33f868e763780094aec8a2dcb9a1a">TYPE_LENGTH</a> (type1) != <a class="code" href="gdbtypes_8h.html#aeac33f868e763780094aec8a2dcb9a1a">TYPE_LENGTH</a> (type2)
<a name="l01004"></a>01004       || <a class="code" href="gdbtypes_8h.html#a124c6ba3c6519f8a6ea57495d2f5f7f7">TYPE_UNSIGNED</a> (type1) != <a class="code" href="gdbtypes_8h.html#a124c6ba3c6519f8a6ea57495d2f5f7f7">TYPE_UNSIGNED</a> (type2)
<a name="l01005"></a>01005       || <a class="code" href="gdbtypes_8h.html#a072c2a4284516f56accc85be90546a30">TYPE_NOSIGN</a> (type1) != <a class="code" href="gdbtypes_8h.html#a072c2a4284516f56accc85be90546a30">TYPE_NOSIGN</a> (type2)
<a name="l01006"></a>01006       || <a class="code" href="gdbtypes_8h.html#ac64534be7706a7ed40f5b2de42df4371">TYPE_VARARGS</a> (type1) != <a class="code" href="gdbtypes_8h.html#ac64534be7706a7ed40f5b2de42df4371">TYPE_VARARGS</a> (type2)
<a name="l01007"></a>01007       || <a class="code" href="gdbtypes_8h.html#a68a23253bcb233221400208f4c21c406">TYPE_VECTOR</a> (type1) != <a class="code" href="gdbtypes_8h.html#a68a23253bcb233221400208f4c21c406">TYPE_VECTOR</a> (type2)
<a name="l01008"></a>01008       || <a class="code" href="gdbtypes_8h.html#ad14de12dcfa1f444b2af33bff0574ad6">TYPE_NOTTEXT</a> (type1) != <a class="code" href="gdbtypes_8h.html#ad14de12dcfa1f444b2af33bff0574ad6">TYPE_NOTTEXT</a> (type2)
<a name="l01009"></a>01009       || <a class="code" href="gdbtypes_8h.html#ad0ad42ffb661b51ebff620a309a26dd1">TYPE_INSTANCE_FLAGS</a> (type1) != <a class="code" href="gdbtypes_8h.html#ad0ad42ffb661b51ebff620a309a26dd1">TYPE_INSTANCE_FLAGS</a> (type2)
<a name="l01010"></a>01010       || <a class="code" href="gdbtypes_8h.html#a2872fd7f60b18f9cf1ed3227fc4441cd">TYPE_NFIELDS</a> (type1) != <a class="code" href="gdbtypes_8h.html#a2872fd7f60b18f9cf1ed3227fc4441cd">TYPE_NFIELDS</a> (type2))
<a name="l01011"></a>01011     <span class="keywordflow">return</span> Py_NE;
<a name="l01012"></a>01012 
<a name="l01013"></a>01013   <span class="keywordflow">if</span> (!compare_maybe_null_strings (<a class="code" href="gdbtypes_8h.html#acb2abdd2de64c35b3041ddfe1aa64099">TYPE_TAG_NAME</a> (type1),
<a name="l01014"></a>01014                                    <a class="code" href="gdbtypes_8h.html#acb2abdd2de64c35b3041ddfe1aa64099">TYPE_TAG_NAME</a> (type2)))
<a name="l01015"></a>01015     <span class="keywordflow">return</span> Py_NE;
<a name="l01016"></a>01016   <span class="keywordflow">if</span> (!compare_maybe_null_strings (<a class="code" href="gdbtypes_8h.html#a60f6434779617e9ff9c60121ceb25015">TYPE_NAME</a> (type1), <a class="code" href="gdbtypes_8h.html#a60f6434779617e9ff9c60121ceb25015">TYPE_NAME</a> (type2)))
<a name="l01017"></a>01017     <span class="keywordflow">return</span> Py_NE;
<a name="l01018"></a>01018 
<a name="l01019"></a>01019   <span class="keywordflow">if</span> (<a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (type1) == <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a31cf8189b076711e63dea04c1136bafe">TYPE_CODE_RANGE</a>)
<a name="l01020"></a>01020     {
<a name="l01021"></a>01021       <span class="keywordflow">if</span> (<a class="code" href="gdb__string_8h.html#a65c3e6b23d6855c86acaf147853c82cc">memcmp</a> (<a class="code" href="gdbtypes_8h.html#ae9113b911f1961005dd2e52bd6dc5d6e">TYPE_RANGE_DATA</a> (type1), <a class="code" href="gdbtypes_8h.html#ae9113b911f1961005dd2e52bd6dc5d6e">TYPE_RANGE_DATA</a> (type2),
<a name="l01022"></a>01022                   <span class="keyword">sizeof</span> (*<a class="code" href="gdbtypes_8h.html#ae9113b911f1961005dd2e52bd6dc5d6e">TYPE_RANGE_DATA</a> (type1))) != 0)
<a name="l01023"></a>01023         <span class="keywordflow">return</span> Py_NE;
<a name="l01024"></a>01024     }
<a name="l01025"></a>01025   <span class="keywordflow">else</span>
<a name="l01026"></a>01026     {
<a name="l01027"></a>01027       <span class="keywordtype">int</span> i;
<a name="l01028"></a>01028 
<a name="l01029"></a>01029       <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="gdbtypes_8h.html#a2872fd7f60b18f9cf1ed3227fc4441cd">TYPE_NFIELDS</a> (type1); ++i)
<a name="l01030"></a>01030         {
<a name="l01031"></a>01031           <span class="keyword">const</span> <span class="keyword">struct </span>field *field1 = &amp;<a class="code" href="gdbtypes_8h.html#a8beaef20f443a0d98c7b445bbcfcf031">TYPE_FIELD</a> (type1, i);
<a name="l01032"></a>01032           <span class="keyword">const</span> <span class="keyword">struct </span>field *field2 = &amp;<a class="code" href="gdbtypes_8h.html#a8beaef20f443a0d98c7b445bbcfcf031">TYPE_FIELD</a> (type2, i);
<a name="l01033"></a>01033           <span class="keyword">struct </span>type_equality_entry entry;
<a name="l01034"></a>01034 
<a name="l01035"></a>01035           <span class="keywordflow">if</span> (<a class="code" href="gdbtypes_8h.html#a5632e7a6760a5aa372c2393ea18c4975">FIELD_ARTIFICIAL</a> (*field1) != <a class="code" href="gdbtypes_8h.html#a5632e7a6760a5aa372c2393ea18c4975">FIELD_ARTIFICIAL</a> (*field2)
<a name="l01036"></a>01036               || <a class="code" href="gdbtypes_8h.html#af6b82d1dbebd01aa271ea0273efb0958">FIELD_BITSIZE</a> (*field1) != <a class="code" href="gdbtypes_8h.html#af6b82d1dbebd01aa271ea0273efb0958">FIELD_BITSIZE</a> (*field2)
<a name="l01037"></a>01037               || <a class="code" href="gdbtypes_8h.html#a4cdaf77fe6873a7a2372d378ffb60d1f">FIELD_LOC_KIND</a> (*field1) != <a class="code" href="gdbtypes_8h.html#a4cdaf77fe6873a7a2372d378ffb60d1f">FIELD_LOC_KIND</a> (*field2))
<a name="l01038"></a>01038             <span class="keywordflow">return</span> Py_NE;
<a name="l01039"></a>01039           <span class="keywordflow">if</span> (!compare_maybe_null_strings (<a class="code" href="gdbtypes_8h.html#aeaff087d79e6871070384c25cf886da7">FIELD_NAME</a> (*field1),
<a name="l01040"></a>01040                                            <a class="code" href="gdbtypes_8h.html#aeaff087d79e6871070384c25cf886da7">FIELD_NAME</a> (*field2)))
<a name="l01041"></a>01041             <span class="keywordflow">return</span> Py_NE;
<a name="l01042"></a>01042           <span class="keywordflow">switch</span> (<a class="code" href="gdbtypes_8h.html#a4cdaf77fe6873a7a2372d378ffb60d1f">FIELD_LOC_KIND</a> (*field1))
<a name="l01043"></a>01043             {
<a name="l01044"></a>01044             <span class="keywordflow">case</span> <a class="code" href="gdbtypes_8h.html#a3eb0e1253afc7850dc90da0d4ba5b487a14a13da1c64b4e4819eb2dcfb0faa110">FIELD_LOC_KIND_BITPOS</a>:
<a name="l01045"></a>01045               <span class="keywordflow">if</span> (<a class="code" href="gdbtypes_8h.html#acd937b9429ab865041b5a88eb54e183c">FIELD_BITPOS</a> (*field1) != <a class="code" href="gdbtypes_8h.html#acd937b9429ab865041b5a88eb54e183c">FIELD_BITPOS</a> (*field2))
<a name="l01046"></a>01046                 <span class="keywordflow">return</span> Py_NE;
<a name="l01047"></a>01047               <span class="keywordflow">break</span>;
<a name="l01048"></a>01048             <span class="keywordflow">case</span> <a class="code" href="gdbtypes_8h.html#a3eb0e1253afc7850dc90da0d4ba5b487a76a7756ad51dec8909eaf39d6ba14b8a">FIELD_LOC_KIND_ENUMVAL</a>:
<a name="l01049"></a>01049               <span class="keywordflow">if</span> (<a class="code" href="gdbtypes_8h.html#ad0d4ed644e19876534ff91875175931d">FIELD_ENUMVAL</a> (*field1) != <a class="code" href="gdbtypes_8h.html#ad0d4ed644e19876534ff91875175931d">FIELD_ENUMVAL</a> (*field2))
<a name="l01050"></a>01050                 <span class="keywordflow">return</span> Py_NE;
<a name="l01051"></a>01051               <span class="keywordflow">break</span>;
<a name="l01052"></a>01052             <span class="keywordflow">case</span> <a class="code" href="gdbtypes_8h.html#a3eb0e1253afc7850dc90da0d4ba5b487a95e68b1aee10e328fe3a4d66455118b3">FIELD_LOC_KIND_PHYSADDR</a>:
<a name="l01053"></a>01053               <span class="keywordflow">if</span> (<a class="code" href="gdbtypes_8h.html#a923011565252b5f3310df99b83744c68">FIELD_STATIC_PHYSADDR</a> (*field1)
<a name="l01054"></a>01054                   != <a class="code" href="gdbtypes_8h.html#a923011565252b5f3310df99b83744c68">FIELD_STATIC_PHYSADDR</a> (*field2))
<a name="l01055"></a>01055                 <span class="keywordflow">return</span> Py_NE;
<a name="l01056"></a>01056               <span class="keywordflow">break</span>;
<a name="l01057"></a>01057             <span class="keywordflow">case</span> <a class="code" href="gdbtypes_8h.html#a3eb0e1253afc7850dc90da0d4ba5b487a5f1cabbe416664df2991053364934267">FIELD_LOC_KIND_PHYSNAME</a>:
<a name="l01058"></a>01058               <span class="keywordflow">if</span> (!compare_maybe_null_strings (<a class="code" href="gdbtypes_8h.html#a14d27a113be3d69ebfad98c91da876fb">FIELD_STATIC_PHYSNAME</a> (*field1),
<a name="l01059"></a>01059                                                <a class="code" href="gdbtypes_8h.html#a14d27a113be3d69ebfad98c91da876fb">FIELD_STATIC_PHYSNAME</a> (*field2)))
<a name="l01060"></a>01060                 <span class="keywordflow">return</span> Py_NE;
<a name="l01061"></a>01061               <span class="keywordflow">break</span>;
<a name="l01062"></a>01062             <span class="keywordflow">case</span> <a class="code" href="gdbtypes_8h.html#a3eb0e1253afc7850dc90da0d4ba5b487ace3b14c3078b378f1d919ed7447b759b">FIELD_LOC_KIND_DWARF_BLOCK</a>:
<a name="l01063"></a>01063               {
<a name="l01064"></a>01064                 <span class="keyword">struct </span><a class="code" href="structdwarf2__locexpr__baton.html">dwarf2_locexpr_baton</a> *block1, *block2;
<a name="l01065"></a>01065 
<a name="l01066"></a>01066                 block1 = <a class="code" href="gdbtypes_8h.html#aceb5969b4ef73dbd54375dfc6ebd852a">FIELD_DWARF_BLOCK</a> (*field1);
<a name="l01067"></a>01067                 block2 = <a class="code" href="gdbtypes_8h.html#aceb5969b4ef73dbd54375dfc6ebd852a">FIELD_DWARF_BLOCK</a> (*field2);
<a name="l01068"></a>01068                 <span class="keywordflow">if</span> (block1-&gt;<a class="code" href="structdwarf2__locexpr__baton.html#a4f4c2fcdbde62332afde34a8a95d91fe">per_cu</a> != block2-&gt;<a class="code" href="structdwarf2__locexpr__baton.html#a4f4c2fcdbde62332afde34a8a95d91fe">per_cu</a>
<a name="l01069"></a>01069                     || block1-&gt;<a class="code" href="structdwarf2__locexpr__baton.html#aad393a9f0c112b45b23fb0d30c19df07">size</a> != block2-&gt;<a class="code" href="structdwarf2__locexpr__baton.html#aad393a9f0c112b45b23fb0d30c19df07">size</a>
<a name="l01070"></a>01070                     || <a class="code" href="gdb__string_8h.html#a65c3e6b23d6855c86acaf147853c82cc">memcmp</a> (block1-&gt;<a class="code" href="structdwarf2__locexpr__baton.html#a629a2d12a13c59e34ffc1f64953b5f01">data</a>, block2-&gt;<a class="code" href="structdwarf2__locexpr__baton.html#a629a2d12a13c59e34ffc1f64953b5f01">data</a>, block1-&gt;<a class="code" href="structdwarf2__locexpr__baton.html#aad393a9f0c112b45b23fb0d30c19df07">size</a>) != 0)
<a name="l01071"></a>01071                 <span class="keywordflow">return</span> Py_NE;
<a name="l01072"></a>01072               }
<a name="l01073"></a>01073               <span class="keywordflow">break</span>;
<a name="l01074"></a>01074             <span class="keywordflow">default</span>:
<a name="l01075"></a>01075               <a class="code" href="common-utils_8h.html#aa14285d9d3d4171016ef9cf09447e8bb">internal_error</a> (__FILE__, __LINE__, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Unsupported field kind &quot;</span>
<a name="l01076"></a>01076                                                     <span class="stringliteral">&quot;%d by check_types_equal&quot;</span>),
<a name="l01077"></a>01077                               <a class="code" href="gdbtypes_8h.html#a4cdaf77fe6873a7a2372d378ffb60d1f">FIELD_LOC_KIND</a> (*field1));
<a name="l01078"></a>01078             }
<a name="l01079"></a>01079 
<a name="l01080"></a>01080           entry.type1 = <a class="code" href="gdbtypes_8h.html#ae88bb60de05efe94bc1cbafee6fa3985">FIELD_TYPE</a> (*field1);
<a name="l01081"></a>01081           entry.type2 = <a class="code" href="gdbtypes_8h.html#ae88bb60de05efe94bc1cbafee6fa3985">FIELD_TYPE</a> (*field2);
<a name="l01082"></a>01082           <a class="code" href="vec_8h.html#a8d090c0524726d00931070e0c438ba3f">VEC_safe_push</a> (<a class="code" href="py-type_8c.html#a648b36f43996408c372616ee0cc87b78">type_equality_entry_d</a>, *worklist, &amp;entry);
<a name="l01083"></a>01083         }
<a name="l01084"></a>01084     }
<a name="l01085"></a>01085 
<a name="l01086"></a>01086   <span class="keywordflow">if</span> (<a class="code" href="gdbtypes_8h.html#a87a33d723acd28a033e63c4297c6c916">TYPE_TARGET_TYPE</a> (type1) != NULL)
<a name="l01087"></a>01087     {
<a name="l01088"></a>01088       <span class="keyword">struct </span>type_equality_entry entry;
<a name="l01089"></a>01089 
<a name="l01090"></a>01090       <span class="keywordflow">if</span> (<a class="code" href="gdbtypes_8h.html#a87a33d723acd28a033e63c4297c6c916">TYPE_TARGET_TYPE</a> (type2) == NULL)
<a name="l01091"></a>01091         <span class="keywordflow">return</span> Py_NE;
<a name="l01092"></a>01092 
<a name="l01093"></a>01093       entry.type1 = <a class="code" href="gdbtypes_8h.html#a87a33d723acd28a033e63c4297c6c916">TYPE_TARGET_TYPE</a> (type1);
<a name="l01094"></a>01094       entry.type2 = <a class="code" href="gdbtypes_8h.html#a87a33d723acd28a033e63c4297c6c916">TYPE_TARGET_TYPE</a> (type2);
<a name="l01095"></a>01095       <a class="code" href="vec_8h.html#a8d090c0524726d00931070e0c438ba3f">VEC_safe_push</a> (<a class="code" href="py-type_8c.html#a648b36f43996408c372616ee0cc87b78">type_equality_entry_d</a>, *worklist, &amp;entry);
<a name="l01096"></a>01096     }
<a name="l01097"></a>01097   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="gdbtypes_8h.html#a87a33d723acd28a033e63c4297c6c916">TYPE_TARGET_TYPE</a> (type2) != NULL)
<a name="l01098"></a>01098     <span class="keywordflow">return</span> Py_NE;
<a name="l01099"></a>01099 
<a name="l01100"></a>01100   <span class="keywordflow">return</span> Py_EQ;
<a name="l01101"></a>01101 }
<a name="l01102"></a>01102 
<a name="l01103"></a>01103 <span class="comment">/* Check types on a worklist for equality.  Returns Py_NE if any pair</span>
<a name="l01104"></a>01104 <span class="comment">   is not equal, Py_EQ if they are all considered equal.  */</span>
<a name="l01105"></a>01105 
<a name="l01106"></a>01106 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01107"></a>01107 check_types_worklist (<a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a> (<a class="code" href="py-type_8c.html#a648b36f43996408c372616ee0cc87b78">type_equality_entry_d</a>) **worklist,
<a name="l01108"></a>01108                       <span class="keyword">struct</span> <a class="code" href="bcache_8c.html#afa8fdf176cc100675ae2e506b24b9ee9">bcache</a> *cache)
<a name="l01109"></a>01109 {
<a name="l01110"></a>01110   <span class="keywordflow">while</span> (!<a class="code" href="vec_8h.html#ac9981d313a5e114db0e05b7b9cd16319">VEC_empty</a> (<a class="code" href="py-type_8c.html#a648b36f43996408c372616ee0cc87b78">type_equality_entry_d</a>, *worklist))
<a name="l01111"></a>01111     {
<a name="l01112"></a>01112       <span class="keyword">struct </span>type_equality_entry entry;
<a name="l01113"></a>01113       <span class="keywordtype">int</span> added;
<a name="l01114"></a>01114 
<a name="l01115"></a>01115       entry = *<a class="code" href="vec_8h.html#a052f53853ecb73bd3c5251a6939b6c08">VEC_last</a> (<a class="code" href="py-type_8c.html#a648b36f43996408c372616ee0cc87b78">type_equality_entry_d</a>, *worklist);
<a name="l01116"></a>01116       <a class="code" href="vec_8h.html#a0a57ad58141d88d36b1f3229dba6f0e7">VEC_pop</a> (<a class="code" href="py-type_8c.html#a648b36f43996408c372616ee0cc87b78">type_equality_entry_d</a>, *worklist);
<a name="l01117"></a>01117 
<a name="l01118"></a>01118       <span class="comment">/* If the type pair has already been visited, we know it is</span>
<a name="l01119"></a>01119 <span class="comment">         ok.  */</span>
<a name="l01120"></a>01120       <a class="code" href="bcache_8c.html#a47abebcb4beade5fead027c476961d73">bcache_full</a> (&amp;entry, <span class="keyword">sizeof</span> (entry), cache, &amp;added);
<a name="l01121"></a>01121       <span class="keywordflow">if</span> (!added)
<a name="l01122"></a>01122         <span class="keywordflow">continue</span>;
<a name="l01123"></a>01123 
<a name="l01124"></a>01124       <span class="keywordflow">if</span> (check_types_equal (entry.type1, entry.type2, worklist) == Py_NE)
<a name="l01125"></a>01125         <span class="keywordflow">return</span> Py_NE;
<a name="l01126"></a>01126     }
<a name="l01127"></a>01127 
<a name="l01128"></a>01128   <span class="keywordflow">return</span> Py_EQ;
<a name="l01129"></a>01129 }
<a name="l01130"></a>01130 
<a name="l01131"></a>01131 <span class="comment">/* Implement the richcompare method.  */</span>
<a name="l01132"></a>01132 
<a name="l01133"></a>01133 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l01134"></a>01134 typy_richcompare (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *other, <span class="keywordtype">int</span> op)
<a name="l01135"></a>01135 {
<a name="l01136"></a>01136   <span class="keywordtype">int</span> result = Py_NE;
<a name="l01137"></a>01137   <span class="keyword">struct </span>type *type1 = <a class="code" href="py-type_8c.html#acd77c1e08fb2bedf0501106071f609fe">type_object_to_type</a> (<span class="keyword">self</span>);
<a name="l01138"></a>01138   <span class="keyword">struct </span>type *type2 = <a class="code" href="py-type_8c.html#acd77c1e08fb2bedf0501106071f609fe">type_object_to_type</a> (other);
<a name="l01139"></a>01139   <span class="keyword">volatile</span> <span class="keyword">struct </span><a class="code" href="structgdb__exception.html">gdb_exception</a> except;
<a name="l01140"></a>01140 
<a name="l01141"></a>01141   <span class="comment">/* We can only compare ourselves to another Type object, and only</span>
<a name="l01142"></a>01142 <span class="comment">     for equality or inequality.  */</span>
<a name="l01143"></a>01143   <span class="keywordflow">if</span> (type2 == NULL || (op != Py_EQ &amp;&amp; op != Py_NE))
<a name="l01144"></a>01144     {
<a name="l01145"></a>01145       Py_INCREF (Py_NotImplemented);
<a name="l01146"></a>01146       <span class="keywordflow">return</span> Py_NotImplemented;
<a name="l01147"></a>01147     }
<a name="l01148"></a>01148 
<a name="l01149"></a>01149   <span class="keywordflow">if</span> (type1 == type2)
<a name="l01150"></a>01150     result = Py_EQ;
<a name="l01151"></a>01151   <span class="keywordflow">else</span>
<a name="l01152"></a>01152     {
<a name="l01153"></a>01153       <span class="keyword">struct </span><a class="code" href="bcache_8c.html#afa8fdf176cc100675ae2e506b24b9ee9">bcache</a> *cache;
<a name="l01154"></a>01154       <a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a> (<a class="code" href="py-type_8c.html#a648b36f43996408c372616ee0cc87b78">type_equality_entry_d</a>) *worklist = NULL;
<a name="l01155"></a>01155       <span class="keyword">struct </span>type_equality_entry entry;
<a name="l01156"></a>01156 
<a name="l01157"></a>01157       cache = <a class="code" href="bcache_8c.html#a37a65394e02f4fee32368807f268da8a">bcache_xmalloc</a> (NULL, NULL);
<a name="l01158"></a>01158 
<a name="l01159"></a>01159       entry.type1 = type1;
<a name="l01160"></a>01160       entry.type2 = type2;
<a name="l01161"></a>01161       <a class="code" href="vec_8h.html#a8d090c0524726d00931070e0c438ba3f">VEC_safe_push</a> (<a class="code" href="py-type_8c.html#a648b36f43996408c372616ee0cc87b78">type_equality_entry_d</a>, worklist, &amp;entry);
<a name="l01162"></a>01162 
<a name="l01163"></a>01163       <a class="code" href="exceptions_8h.html#aef4514ee39b9305fddee27f49c7c34eb">TRY_CATCH</a> (except, <a class="code" href="exceptions_8h.html#abfa3a3b99557b11f5766baf69465fdf6ab50fde886a7de8c013bf2bd4e7c073a4">RETURN_MASK_ALL</a>)
<a name="l01164"></a>01164         {
<a name="l01165"></a>01165           result = check_types_worklist (&amp;worklist, cache);
<a name="l01166"></a>01166         }
<a name="l01167"></a>01167       <span class="comment">/* check_types_worklist calls several nested Python helper</span>
<a name="l01168"></a>01168 <span class="comment">         functions, some of which can raise a GDB Exception, so we</span>
<a name="l01169"></a>01169 <span class="comment">         just check and convert here.  If there is a GDB exception, a</span>
<a name="l01170"></a>01170 <span class="comment">         comparison is not capable (or trusted), so exit.  */</span>
<a name="l01171"></a>01171       <a class="code" href="bcache_8c.html#af8aceee05a2e20e2dd76c3c512d0e2db">bcache_xfree</a> (cache);
<a name="l01172"></a>01172       <a class="code" href="vec_8h.html#af5724b2bbce65103300279f9abe7f577">VEC_free</a> (<a class="code" href="py-type_8c.html#a648b36f43996408c372616ee0cc87b78">type_equality_entry_d</a>, worklist);
<a name="l01173"></a>01173       <a class="code" href="python-internal_8h.html#af341ab0b81fa8efcec4c816710785a56">GDB_PY_HANDLE_EXCEPTION</a> (except);
<a name="l01174"></a>01174     }
<a name="l01175"></a>01175 
<a name="l01176"></a>01176   <span class="keywordflow">if</span> (op == result)
<a name="l01177"></a>01177     Py_RETURN_TRUE;
<a name="l01178"></a>01178   Py_RETURN_FALSE;
<a name="l01179"></a>01179 }
<a name="l01180"></a>01180 
<a name="l01181"></a>01181 
<a name="l01182"></a>01182 
<a name="l01183"></a>01183 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span>objfile_data *typy_objfile_data_key;
<a name="l01184"></a>01184 
<a name="l01185"></a>01185 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01186"></a>01186 save_objfile_types (<span class="keyword">struct</span> <a class="code" href="structobjfile.html">objfile</a> *<a class="code" href="structobjfile.html">objfile</a>, <span class="keywordtype">void</span> *datum)
<a name="l01187"></a>01187 {
<a name="l01188"></a>01188   <a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *obj = datum;
<a name="l01189"></a>01189   htab_t copied_types;
<a name="l01190"></a>01190   <span class="keyword">struct </span>cleanup *cleanup;
<a name="l01191"></a>01191 
<a name="l01192"></a>01192   <span class="keywordflow">if</span> (!gdb_python_initialized)
<a name="l01193"></a>01193     <span class="keywordflow">return</span>;
<a name="l01194"></a>01194 
<a name="l01195"></a>01195   <span class="comment">/* This prevents another thread from freeing the objects we&#39;re</span>
<a name="l01196"></a>01196 <span class="comment">     operating on.  */</span>
<a name="l01197"></a>01197   cleanup = <a class="code" href="python-internal_8h.html#a8994190914eb4c5664e90ffd7823b488">ensure_python_env</a> (<a class="code" href="objfiles_8c.html#a1c7101234ac2edc601fa465e48bc3463">get_objfile_arch</a> (objfile), <a class="code" href="language_8c.html#acd2505a014a95629da9c836f8914fc79">current_language</a>);
<a name="l01198"></a>01198 
<a name="l01199"></a>01199   copied_types = <a class="code" href="gdbtypes_8c.html#ae5ea276bc197accde0f748fc6df2ae6b">create_copied_types_hash</a> (objfile);
<a name="l01200"></a>01200 
<a name="l01201"></a>01201   <span class="keywordflow">while</span> (obj)
<a name="l01202"></a>01202     {
<a name="l01203"></a>01203       <a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *next = obj-&gt;next;
<a name="l01204"></a>01204 
<a name="l01205"></a>01205       htab_empty (copied_types);
<a name="l01206"></a>01206 
<a name="l01207"></a>01207       obj-&gt;type = <a class="code" href="gdbtypes_8c.html#ac557106711cd3c47cd660fff9d773edd">copy_type_recursive</a> (objfile, obj-&gt;type, copied_types);
<a name="l01208"></a>01208 
<a name="l01209"></a>01209       obj-&gt;next = NULL;
<a name="l01210"></a>01210       obj-&gt;prev = NULL;
<a name="l01211"></a>01211 
<a name="l01212"></a>01212       obj = next;
<a name="l01213"></a>01213     }
<a name="l01214"></a>01214 
<a name="l01215"></a>01215   htab_delete (copied_types);
<a name="l01216"></a>01216 
<a name="l01217"></a>01217   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup);
<a name="l01218"></a>01218 }
<a name="l01219"></a>01219 
<a name="l01220"></a>01220 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01221"></a>01221 set_type (<a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *obj, <span class="keyword">struct</span> type *type)
<a name="l01222"></a>01222 {
<a name="l01223"></a>01223   obj-&gt;type = type;
<a name="l01224"></a>01224   obj-&gt;prev = NULL;
<a name="l01225"></a>01225   <span class="keywordflow">if</span> (type &amp;&amp; <a class="code" href="gdbtypes_8h.html#aff6665865a3226d047330d04c05bcb3d">TYPE_OBJFILE</a> (type))
<a name="l01226"></a>01226     {
<a name="l01227"></a>01227       <span class="keyword">struct </span>objfile *objfile = <a class="code" href="gdbtypes_8h.html#aff6665865a3226d047330d04c05bcb3d">TYPE_OBJFILE</a> (type);
<a name="l01228"></a>01228 
<a name="l01229"></a>01229       obj-&gt;next = objfile_data (objfile, typy_objfile_data_key);
<a name="l01230"></a>01230       <span class="keywordflow">if</span> (obj-&gt;next)
<a name="l01231"></a>01231         obj-&gt;next-&gt;prev = obj;
<a name="l01232"></a>01232       set_objfile_data (objfile, typy_objfile_data_key, obj);
<a name="l01233"></a>01233     }
<a name="l01234"></a>01234   <span class="keywordflow">else</span>
<a name="l01235"></a>01235     obj-&gt;next = NULL;
<a name="l01236"></a>01236 }
<a name="l01237"></a>01237 
<a name="l01238"></a>01238 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01239"></a>01239 typy_dealloc (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *obj)
<a name="l01240"></a>01240 {
<a name="l01241"></a>01241   <a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *type = (<a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *) obj;
<a name="l01242"></a>01242 
<a name="l01243"></a>01243   <span class="keywordflow">if</span> (type-&gt;prev)
<a name="l01244"></a>01244     type-&gt;prev-&gt;next = type-&gt;next;
<a name="l01245"></a>01245   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type-&gt;type &amp;&amp; <a class="code" href="gdbtypes_8h.html#aff6665865a3226d047330d04c05bcb3d">TYPE_OBJFILE</a> (type-&gt;type))
<a name="l01246"></a>01246     {
<a name="l01247"></a>01247       <span class="comment">/* Must reset head of list.  */</span>
<a name="l01248"></a>01248       <span class="keyword">struct </span>objfile *objfile = <a class="code" href="gdbtypes_8h.html#aff6665865a3226d047330d04c05bcb3d">TYPE_OBJFILE</a> (type-&gt;type);
<a name="l01249"></a>01249 
<a name="l01250"></a>01250       <span class="keywordflow">if</span> (objfile)
<a name="l01251"></a>01251         set_objfile_data (objfile, typy_objfile_data_key, type-&gt;<a class="code" href="structobjfile.html#a3b8083e843c67911bfb6ff39029d6259">next</a>);
<a name="l01252"></a>01252     }
<a name="l01253"></a>01253   <span class="keywordflow">if</span> (type-&gt;next)
<a name="l01254"></a>01254     type-&gt;next-&gt;prev = type-&gt;prev;
<a name="l01255"></a>01255 
<a name="l01256"></a>01256   Py_TYPE (type)-&gt;tp_free (type);
<a name="l01257"></a>01257 }
<a name="l01258"></a>01258 
<a name="l01259"></a>01259 <span class="comment">/* Return number of fields (&quot;length&quot; of the field dictionary).  */</span>
<a name="l01260"></a>01260 
<a name="l01261"></a>01261 <span class="keyword">static</span> Py_ssize_t
<a name="l01262"></a>01262 typy_length (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>)
<a name="l01263"></a>01263 {
<a name="l01264"></a>01264   <span class="keyword">struct </span>type *type = ((<a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *) <span class="keyword">self</span>)-&gt;type;
<a name="l01265"></a>01265 
<a name="l01266"></a>01266   type = typy_get_composite (type);
<a name="l01267"></a>01267   <span class="keywordflow">if</span> (type == NULL)
<a name="l01268"></a>01268     <span class="keywordflow">return</span> -1;
<a name="l01269"></a>01269 
<a name="l01270"></a>01270   <span class="keywordflow">return</span> <a class="code" href="gdbtypes_8h.html#a2872fd7f60b18f9cf1ed3227fc4441cd">TYPE_NFIELDS</a> (type);
<a name="l01271"></a>01271 }
<a name="l01272"></a>01272 
<a name="l01273"></a>01273 <span class="comment">/* Implements boolean evaluation of gdb.Type.  Handle this like other</span>
<a name="l01274"></a>01274 <span class="comment">   Python objects that don&#39;t have a meaningful truth value -- all </span>
<a name="l01275"></a>01275 <span class="comment">   values are true.  */</span>
<a name="l01276"></a>01276 
<a name="l01277"></a>01277 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01278"></a>01278 typy_nonzero (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>)
<a name="l01279"></a>01279 {
<a name="l01280"></a>01280   <span class="keywordflow">return</span> 1;
<a name="l01281"></a>01281 }
<a name="l01282"></a>01282 
<a name="l01283"></a>01283 <span class="comment">/* Return a gdb.Field object for the field named by the argument.  */</span>
<a name="l01284"></a>01284 
<a name="l01285"></a>01285 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l01286"></a>01286 typy_getitem (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *key)
<a name="l01287"></a>01287 {
<a name="l01288"></a>01288   <span class="keyword">struct </span>type *type = ((<a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *) <span class="keyword">self</span>)-&gt;type;
<a name="l01289"></a>01289   <span class="keywordtype">char</span> *field;
<a name="l01290"></a>01290   <span class="keywordtype">int</span> i;
<a name="l01291"></a>01291 
<a name="l01292"></a>01292   field = <a class="code" href="py-utils_8c.html#a3572ecd3b2f37fea77c5a4ded1f193c3">python_string_to_host_string</a> (key);
<a name="l01293"></a>01293   <span class="keywordflow">if</span> (field == NULL)
<a name="l01294"></a>01294     <span class="keywordflow">return</span> NULL;
<a name="l01295"></a>01295 
<a name="l01296"></a>01296   <span class="comment">/* We want just fields of this type, not of base types, so instead of </span>
<a name="l01297"></a>01297 <span class="comment">     using lookup_struct_elt_type, portions of that function are</span>
<a name="l01298"></a>01298 <span class="comment">     copied here.  */</span>
<a name="l01299"></a>01299 
<a name="l01300"></a>01300   type = typy_get_composite (type);
<a name="l01301"></a>01301   <span class="keywordflow">if</span> (type == NULL)
<a name="l01302"></a>01302     <span class="keywordflow">return</span> NULL;
<a name="l01303"></a>01303   
<a name="l01304"></a>01304   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="gdbtypes_8h.html#a2872fd7f60b18f9cf1ed3227fc4441cd">TYPE_NFIELDS</a> (type); i++)
<a name="l01305"></a>01305     {
<a name="l01306"></a>01306       <span class="keyword">const</span> <span class="keywordtype">char</span> *t_field_name = <a class="code" href="gdbtypes_8h.html#a01947c4de3aced365e02aa6e8e6a9dc3">TYPE_FIELD_NAME</a> (type, i);
<a name="l01307"></a>01307 
<a name="l01308"></a>01308       <span class="keywordflow">if</span> (t_field_name &amp;&amp; (<a class="code" href="utils_8c.html#afe92387dbf8135978e7845a7dcf18003">strcmp_iw</a> (t_field_name, field) == 0))
<a name="l01309"></a>01309         {
<a name="l01310"></a>01310           <span class="keywordflow">return</span> convert_field (type, i);
<a name="l01311"></a>01311         }
<a name="l01312"></a>01312     }
<a name="l01313"></a>01313   PyErr_SetObject (PyExc_KeyError, key);
<a name="l01314"></a>01314   <span class="keywordflow">return</span> NULL;
<a name="l01315"></a>01315 }
<a name="l01316"></a>01316 
<a name="l01317"></a>01317 <span class="comment">/* Implement the &quot;get&quot; method on the type object.  This is the </span>
<a name="l01318"></a>01318 <span class="comment">   same as getitem if the key is present, but returns the supplied</span>
<a name="l01319"></a>01319 <span class="comment">   default value or None if the key is not found.  */</span>
<a name="l01320"></a>01320 
<a name="l01321"></a>01321 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l01322"></a>01322 typy_get (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *args)
<a name="l01323"></a>01323 {
<a name="l01324"></a>01324   <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *key, *defval = Py_None, *result;
<a name="l01325"></a>01325   
<a name="l01326"></a>01326   <span class="keywordflow">if</span> (!PyArg_UnpackTuple (args, <span class="stringliteral">&quot;get&quot;</span>, 1, 2, &amp;key, &amp;defval))
<a name="l01327"></a>01327     <span class="keywordflow">return</span> NULL;
<a name="l01328"></a>01328   
<a name="l01329"></a>01329   result = typy_getitem (<span class="keyword">self</span>, key);
<a name="l01330"></a>01330   <span class="keywordflow">if</span> (result != NULL)
<a name="l01331"></a>01331     <span class="keywordflow">return</span> result;
<a name="l01332"></a>01332   
<a name="l01333"></a>01333   <span class="comment">/* typy_getitem returned error status.  If the exception is</span>
<a name="l01334"></a>01334 <span class="comment">     KeyError, clear the exception status and return the defval</span>
<a name="l01335"></a>01335 <span class="comment">     instead.  Otherwise return the exception unchanged.  */</span>
<a name="l01336"></a>01336   <span class="keywordflow">if</span> (!PyErr_ExceptionMatches (PyExc_KeyError))
<a name="l01337"></a>01337     <span class="keywordflow">return</span> NULL;
<a name="l01338"></a>01338   
<a name="l01339"></a>01339   PyErr_Clear ();
<a name="l01340"></a>01340   Py_INCREF (defval);
<a name="l01341"></a>01341   <span class="keywordflow">return</span> defval;
<a name="l01342"></a>01342 }
<a name="l01343"></a>01343 
<a name="l01344"></a>01344 <span class="comment">/* Implement the &quot;has_key&quot; method on the type object.  */</span>
<a name="l01345"></a>01345 
<a name="l01346"></a>01346 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l01347"></a>01347 typy_has_key (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *args)
<a name="l01348"></a>01348 {
<a name="l01349"></a>01349   <span class="keyword">struct </span>type *type = ((<a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *) <span class="keyword">self</span>)-&gt;type;
<a name="l01350"></a>01350   <span class="keyword">const</span> <span class="keywordtype">char</span> *field;
<a name="l01351"></a>01351   <span class="keywordtype">int</span> i;
<a name="l01352"></a>01352 
<a name="l01353"></a>01353   <span class="keywordflow">if</span> (!PyArg_ParseTuple (args, <span class="stringliteral">&quot;s&quot;</span>, &amp;field))
<a name="l01354"></a>01354     <span class="keywordflow">return</span> NULL;
<a name="l01355"></a>01355 
<a name="l01356"></a>01356   <span class="comment">/* We want just fields of this type, not of base types, so instead of </span>
<a name="l01357"></a>01357 <span class="comment">     using lookup_struct_elt_type, portions of that function are</span>
<a name="l01358"></a>01358 <span class="comment">     copied here.  */</span>
<a name="l01359"></a>01359 
<a name="l01360"></a>01360   type = typy_get_composite (type);
<a name="l01361"></a>01361   <span class="keywordflow">if</span> (type == NULL)
<a name="l01362"></a>01362     <span class="keywordflow">return</span> NULL;
<a name="l01363"></a>01363 
<a name="l01364"></a>01364   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="gdbtypes_8h.html#a2872fd7f60b18f9cf1ed3227fc4441cd">TYPE_NFIELDS</a> (type); i++)
<a name="l01365"></a>01365     {
<a name="l01366"></a>01366       <span class="keyword">const</span> <span class="keywordtype">char</span> *t_field_name = <a class="code" href="gdbtypes_8h.html#a01947c4de3aced365e02aa6e8e6a9dc3">TYPE_FIELD_NAME</a> (type, i);
<a name="l01367"></a>01367 
<a name="l01368"></a>01368       <span class="keywordflow">if</span> (t_field_name &amp;&amp; (<a class="code" href="utils_8c.html#afe92387dbf8135978e7845a7dcf18003">strcmp_iw</a> (t_field_name, field) == 0))
<a name="l01369"></a>01369         Py_RETURN_TRUE;
<a name="l01370"></a>01370     }
<a name="l01371"></a>01371   Py_RETURN_FALSE;
<a name="l01372"></a>01372 }
<a name="l01373"></a>01373 
<a name="l01374"></a>01374 <span class="comment">/* Make an iterator object to iterate over keys, values, or items.  */</span>
<a name="l01375"></a>01375 
<a name="l01376"></a>01376 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l01377"></a>01377 typy_make_iter (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <span class="keyword">enum</span> <a class="code" href="python-internal_8h.html#a55ecc5986ea86c7a3349b18fda10852e">gdbpy_iter_kind</a> kind)
<a name="l01378"></a>01378 {
<a name="l01379"></a>01379   typy_iterator_object *typy_iter_obj;
<a name="l01380"></a>01380 
<a name="l01381"></a>01381   <span class="comment">/* Check that &quot;self&quot; is a structure or union type.  */</span>
<a name="l01382"></a>01382   <span class="keywordflow">if</span> (typy_get_composite (((<a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *) <span class="keyword">self</span>)-&gt;type) == NULL)
<a name="l01383"></a>01383     <span class="keywordflow">return</span> NULL;
<a name="l01384"></a>01384   
<a name="l01385"></a>01385   typy_iter_obj = PyObject_New (typy_iterator_object,
<a name="l01386"></a>01386                                 &amp;type_iterator_object_type);
<a name="l01387"></a>01387   <span class="keywordflow">if</span> (typy_iter_obj == NULL)
<a name="l01388"></a>01388       <span class="keywordflow">return</span> NULL;
<a name="l01389"></a>01389 
<a name="l01390"></a>01390   typy_iter_obj-&gt;field = 0;
<a name="l01391"></a>01391   typy_iter_obj-&gt;kind = kind;
<a name="l01392"></a>01392   Py_INCREF (<span class="keyword">self</span>);
<a name="l01393"></a>01393   typy_iter_obj-&gt;source = (<a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *) <span class="keyword">self</span>;
<a name="l01394"></a>01394 
<a name="l01395"></a>01395   <span class="keywordflow">return</span> (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *) typy_iter_obj;
<a name="l01396"></a>01396 }
<a name="l01397"></a>01397 
<a name="l01398"></a>01398 <span class="comment">/* iteritems() method.  */</span>
<a name="l01399"></a>01399 
<a name="l01400"></a>01400 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l01401"></a>01401 typy_iteritems (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *args)
<a name="l01402"></a>01402 {
<a name="l01403"></a>01403   <span class="keywordflow">return</span> typy_make_iter (<span class="keyword">self</span>, <a class="code" href="python-internal_8h.html#a55ecc5986ea86c7a3349b18fda10852eab88aac0d7bc7d011af3315b948a8b8ed">iter_items</a>);
<a name="l01404"></a>01404 }
<a name="l01405"></a>01405 
<a name="l01406"></a>01406 <span class="comment">/* iterkeys() method.  */</span>
<a name="l01407"></a>01407 
<a name="l01408"></a>01408 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l01409"></a>01409 typy_iterkeys (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *args)
<a name="l01410"></a>01410 {
<a name="l01411"></a>01411   <span class="keywordflow">return</span> typy_make_iter (<span class="keyword">self</span>, <a class="code" href="python-internal_8h.html#a55ecc5986ea86c7a3349b18fda10852eafa3709c282b0c168e9d64101618aa9c9">iter_keys</a>);
<a name="l01412"></a>01412 }
<a name="l01413"></a>01413 
<a name="l01414"></a>01414 <span class="comment">/* Iterating over the class, same as iterkeys except for the function</span>
<a name="l01415"></a>01415 <span class="comment">   signature.  */</span>
<a name="l01416"></a>01416 
<a name="l01417"></a>01417 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l01418"></a>01418 typy_iter (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>)
<a name="l01419"></a>01419 {
<a name="l01420"></a>01420   <span class="keywordflow">return</span> typy_make_iter (<span class="keyword">self</span>, <a class="code" href="python-internal_8h.html#a55ecc5986ea86c7a3349b18fda10852eafa3709c282b0c168e9d64101618aa9c9">iter_keys</a>);
<a name="l01421"></a>01421 }
<a name="l01422"></a>01422 
<a name="l01423"></a>01423 <span class="comment">/* itervalues() method.  */</span>
<a name="l01424"></a>01424 
<a name="l01425"></a>01425 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l01426"></a>01426 typy_itervalues (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *args)
<a name="l01427"></a>01427 {
<a name="l01428"></a>01428   <span class="keywordflow">return</span> typy_make_iter (<span class="keyword">self</span>, <a class="code" href="python-internal_8h.html#a55ecc5986ea86c7a3349b18fda10852ea3300de765d0f874bcc89cb2003644cf3">iter_values</a>);
<a name="l01429"></a>01429 }
<a name="l01430"></a>01430 
<a name="l01431"></a>01431 <span class="comment">/* Return a reference to the type iterator.  */</span>
<a name="l01432"></a>01432 
<a name="l01433"></a>01433 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l01434"></a>01434 typy_iterator_iter (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>)
<a name="l01435"></a>01435 {
<a name="l01436"></a>01436   Py_INCREF (<span class="keyword">self</span>);
<a name="l01437"></a>01437   <span class="keywordflow">return</span> <span class="keyword">self</span>;
<a name="l01438"></a>01438 }
<a name="l01439"></a>01439 
<a name="l01440"></a>01440 <span class="comment">/* Return the next field in the iteration through the list of fields</span>
<a name="l01441"></a>01441 <span class="comment">   of the type.  */</span>
<a name="l01442"></a>01442 
<a name="l01443"></a>01443 <span class="keyword">static</span> <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l01444"></a>01444 typy_iterator_iternext (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>)
<a name="l01445"></a>01445 {
<a name="l01446"></a>01446   typy_iterator_object *iter_obj = (typy_iterator_object *) <span class="keyword">self</span>;
<a name="l01447"></a>01447   <span class="keyword">struct </span>type *type = iter_obj-&gt;source-&gt;type;
<a name="l01448"></a>01448   <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *result;
<a name="l01449"></a>01449   
<a name="l01450"></a>01450   <span class="keywordflow">if</span> (iter_obj-&gt;field &lt; <a class="code" href="gdbtypes_8h.html#a2872fd7f60b18f9cf1ed3227fc4441cd">TYPE_NFIELDS</a> (type))
<a name="l01451"></a>01451     {
<a name="l01452"></a>01452       result = make_fielditem (type, iter_obj-&gt;field, iter_obj-&gt;kind);
<a name="l01453"></a>01453       <span class="keywordflow">if</span> (result != NULL)
<a name="l01454"></a>01454         iter_obj-&gt;field++;
<a name="l01455"></a>01455       <span class="keywordflow">return</span> result;
<a name="l01456"></a>01456     }
<a name="l01457"></a>01457 
<a name="l01458"></a>01458   <span class="keywordflow">return</span> NULL;
<a name="l01459"></a>01459 }
<a name="l01460"></a>01460 
<a name="l01461"></a>01461 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01462"></a>01462 typy_iterator_dealloc (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *obj)
<a name="l01463"></a>01463 {
<a name="l01464"></a>01464   typy_iterator_object *iter_obj = (typy_iterator_object *) obj;
<a name="l01465"></a>01465 
<a name="l01466"></a>01466   <a class="code" href="python-internal_8h.html#a19be7acd3e9a57b82c7be99b8594d293">Py_DECREF</a> (iter_obj-&gt;source);
<a name="l01467"></a>01467 }
<a name="l01468"></a>01468 
<a name="l01469"></a>01469 <span class="comment">/* Create a new Type referring to TYPE.  */</span>
<a name="l01470"></a>01470 <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l01471"></a><a class="code" href="python-internal_8h.html#ad5ce8b62f9b3fc22e3f3c6d17a1d4414">01471</a> <a class="code" href="py-type_8c.html#a81e3b010e21ee3b3fc80a056f22ff6d5">type_to_type_object</a> (<span class="keyword">struct</span> type *type)
<a name="l01472"></a>01472 {
<a name="l01473"></a>01473   <a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *type_obj;
<a name="l01474"></a>01474 
<a name="l01475"></a>01475   type_obj = PyObject_New (<a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a>, &amp;type_object_type);
<a name="l01476"></a>01476   <span class="keywordflow">if</span> (type_obj)
<a name="l01477"></a>01477     set_type (type_obj, type);
<a name="l01478"></a>01478 
<a name="l01479"></a>01479   <span class="keywordflow">return</span> (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *) type_obj;
<a name="l01480"></a>01480 }
<a name="l01481"></a>01481 
<a name="l01482"></a>01482 <span class="keyword">struct </span>type *
<a name="l01483"></a><a class="code" href="python-internal_8h.html#acd77c1e08fb2bedf0501106071f609fe">01483</a> <a class="code" href="py-type_8c.html#acd77c1e08fb2bedf0501106071f609fe">type_object_to_type</a> (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *obj)
<a name="l01484"></a>01484 {
<a name="l01485"></a>01485   <span class="keywordflow">if</span> (! PyObject_TypeCheck (obj, &amp;type_object_type))
<a name="l01486"></a>01486     <span class="keywordflow">return</span> NULL;
<a name="l01487"></a>01487   <span class="keywordflow">return</span> ((<a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a> *) obj)-&gt;type;
<a name="l01488"></a>01488 }
<a name="l01489"></a>01489 
<a name="l01490"></a>01490 
<a name="l01491"></a>01491 
<a name="l01492"></a>01492 <span class="comment">/* Implementation of gdb.lookup_type.  */</span>
<a name="l01493"></a>01493 <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *
<a name="l01494"></a><a class="code" href="python-internal_8h.html#a6dc2264372a0c6db239b01aa24359d9b">01494</a> <a class="code" href="py-type_8c.html#a6dc2264372a0c6db239b01aa24359d9b">gdbpy_lookup_type</a> (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *<span class="keyword">self</span>, <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *args, <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *kw)
<a name="l01495"></a>01495 {
<a name="l01496"></a>01496   <span class="keyword">static</span> <span class="keywordtype">char</span> *keywords[] = { <span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;block&quot;</span>, NULL };
<a name="l01497"></a>01497   <span class="keyword">const</span> <span class="keywordtype">char</span> *type_name = NULL;
<a name="l01498"></a>01498   <span class="keyword">struct </span>type *type = NULL;
<a name="l01499"></a>01499   <a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *block_obj = NULL;
<a name="l01500"></a>01500   <span class="keyword">const</span> <span class="keyword">struct </span>block *block = NULL;
<a name="l01501"></a>01501 
<a name="l01502"></a>01502   <span class="keywordflow">if</span> (! PyArg_ParseTupleAndKeywords (args, kw, <span class="stringliteral">&quot;s|O&quot;</span>, keywords,
<a name="l01503"></a>01503                                      &amp;type_name, &amp;block_obj))
<a name="l01504"></a>01504     <span class="keywordflow">return</span> NULL;
<a name="l01505"></a>01505 
<a name="l01506"></a>01506   <span class="keywordflow">if</span> (block_obj)
<a name="l01507"></a>01507     {
<a name="l01508"></a>01508       block = <a class="code" href="py-block_8c.html#ad703ff4e367170e398e186ae465ea7f4">block_object_to_block</a> (block_obj);
<a name="l01509"></a>01509       <span class="keywordflow">if</span> (! block)
<a name="l01510"></a>01510         {
<a name="l01511"></a>01511           PyErr_SetString (PyExc_RuntimeError,
<a name="l01512"></a>01512                            <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;&#39;block&#39; argument must be a Block.&quot;</span>));
<a name="l01513"></a>01513           <span class="keywordflow">return</span> NULL;
<a name="l01514"></a>01514         }
<a name="l01515"></a>01515     }
<a name="l01516"></a>01516 
<a name="l01517"></a>01517   type = typy_lookup_typename (type_name, block);
<a name="l01518"></a>01518   <span class="keywordflow">if</span> (! type)
<a name="l01519"></a>01519     <span class="keywordflow">return</span> NULL;
<a name="l01520"></a>01520 
<a name="l01521"></a>01521   <span class="keywordflow">return</span> (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *) <a class="code" href="py-type_8c.html#a81e3b010e21ee3b3fc80a056f22ff6d5">type_to_type_object</a> (type);
<a name="l01522"></a>01522 }
<a name="l01523"></a>01523 
<a name="l01524"></a>01524 <span class="keywordtype">int</span>
<a name="l01525"></a><a class="code" href="python-internal_8h.html#a2d4de1b195dafe5d0c377857c4c47add">01525</a> <a class="code" href="py-type_8c.html#a3716d62b13fde2a0d0fafe9dee97c39e">gdbpy_initialize_types</a> (<span class="keywordtype">void</span>)
<a name="l01526"></a>01526 {
<a name="l01527"></a>01527   <span class="keywordtype">int</span> i;
<a name="l01528"></a>01528 
<a name="l01529"></a>01529   typy_objfile_data_key
<a name="l01530"></a>01530     = register_objfile_data_with_cleanup (save_objfile_types, NULL);
<a name="l01531"></a>01531 
<a name="l01532"></a>01532   <span class="keywordflow">if</span> (PyType_Ready (&amp;type_object_type) &lt; 0)
<a name="l01533"></a>01533     <span class="keywordflow">return</span> -1;
<a name="l01534"></a>01534   <span class="keywordflow">if</span> (PyType_Ready (&amp;field_object_type) &lt; 0)
<a name="l01535"></a>01535     <span class="keywordflow">return</span> -1;
<a name="l01536"></a>01536   <span class="keywordflow">if</span> (PyType_Ready (&amp;type_iterator_object_type) &lt; 0)
<a name="l01537"></a>01537     <span class="keywordflow">return</span> -1;
<a name="l01538"></a>01538 
<a name="l01539"></a>01539   <span class="keywordflow">for</span> (i = 0; pyty_codes[i].name; ++i)
<a name="l01540"></a>01540     {
<a name="l01541"></a>01541       <span class="keywordflow">if</span> (PyModule_AddIntConstant (<a class="code" href="python-internal_8h.html#a2e05753b762f9320dab68e51d41aad85">gdb_module</a>,
<a name="l01542"></a>01542                                    <span class="comment">/* Cast needed for Python 2.4.  */</span>
<a name="l01543"></a>01543                                    (<span class="keywordtype">char</span> *) pyty_codes[i].<a class="code" href="aarch64-tdep_8c.html#acc128f98d9ceca227038c771308eff39">name</a>,
<a name="l01544"></a>01544                                    pyty_codes[i].<a class="code" href="ser-unix_8c.html#a45a5b7c00a796a23f01673cef1dbe0a9">code</a>) &lt; 0)
<a name="l01545"></a>01545         <span class="keywordflow">return</span> -1;
<a name="l01546"></a>01546     }
<a name="l01547"></a>01547 
<a name="l01548"></a>01548   <span class="keywordflow">if</span> (<a class="code" href="py-utils_8c.html#a72db06bd9d5a8010558566a904067b97">gdb_pymodule_addobject</a> (<a class="code" href="python-internal_8h.html#a2e05753b762f9320dab68e51d41aad85">gdb_module</a>, <span class="stringliteral">&quot;Type&quot;</span>,
<a name="l01549"></a>01549                               (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *) &amp;type_object_type) &lt; 0)
<a name="l01550"></a>01550     <span class="keywordflow">return</span> -1;
<a name="l01551"></a>01551 
<a name="l01552"></a>01552   <span class="keywordflow">if</span> (<a class="code" href="py-utils_8c.html#a72db06bd9d5a8010558566a904067b97">gdb_pymodule_addobject</a> (<a class="code" href="python-internal_8h.html#a2e05753b762f9320dab68e51d41aad85">gdb_module</a>, <span class="stringliteral">&quot;TypeIterator&quot;</span>,
<a name="l01553"></a>01553                               (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *) &amp;type_iterator_object_type) &lt; 0)
<a name="l01554"></a>01554     <span class="keywordflow">return</span> -1;
<a name="l01555"></a>01555 
<a name="l01556"></a>01556   <span class="keywordflow">return</span> <a class="code" href="py-utils_8c.html#a72db06bd9d5a8010558566a904067b97">gdb_pymodule_addobject</a> (<a class="code" href="python-internal_8h.html#a2e05753b762f9320dab68e51d41aad85">gdb_module</a>, <span class="stringliteral">&quot;Field&quot;</span>,
<a name="l01557"></a>01557                                  (<a class="code" href="varobj_8c.html#acf2acb6d745ed9adf8d9575f603d7a58">PyObject</a> *) &amp;field_object_type);
<a name="l01558"></a>01558 }
<a name="l01559"></a>01559 
<a name="l01560"></a>01560 
<a name="l01561"></a>01561 
<a name="l01562"></a>01562 <span class="keyword">static</span> PyGetSetDef type_object_getset[] =
<a name="l01563"></a>01563 {
<a name="l01564"></a>01564   { <span class="stringliteral">&quot;code&quot;</span>, typy_get_code, NULL,
<a name="l01565"></a>01565     <span class="stringliteral">&quot;The code for this type.&quot;</span>, NULL },
<a name="l01566"></a>01566   { <span class="stringliteral">&quot;sizeof&quot;</span>, typy_get_sizeof, NULL,
<a name="l01567"></a>01567     <span class="stringliteral">&quot;The size of this type, in bytes.&quot;</span>, NULL },
<a name="l01568"></a>01568   { <span class="stringliteral">&quot;tag&quot;</span>, typy_get_tag, NULL,
<a name="l01569"></a>01569     <span class="stringliteral">&quot;The tag name for this type, or None.&quot;</span>, NULL },
<a name="l01570"></a>01570   { NULL }
<a name="l01571"></a>01571 };
<a name="l01572"></a>01572 
<a name="l01573"></a>01573 <span class="keyword">static</span> PyMethodDef type_object_methods[] =
<a name="l01574"></a>01574 {
<a name="l01575"></a>01575   { <span class="stringliteral">&quot;array&quot;</span>, typy_array, METH_VARARGS,
<a name="l01576"></a>01576     <span class="stringliteral">&quot;array ([LOW_BOUND,] HIGH_BOUND) -&gt; Type\n\</span>
<a name="l01577"></a>01577 <span class="stringliteral">Return a type which represents an array of objects of this type.\n\</span>
<a name="l01578"></a>01578 <span class="stringliteral">The bounds of the array are [LOW_BOUND, HIGH_BOUND] inclusive.\n\</span>
<a name="l01579"></a>01579 <span class="stringliteral">If LOW_BOUND is omitted, a value of zero is used.&quot;</span> },
<a name="l01580"></a>01580   { <span class="stringliteral">&quot;vector&quot;</span>, typy_vector, METH_VARARGS,
<a name="l01581"></a>01581     <span class="stringliteral">&quot;vector ([LOW_BOUND,] HIGH_BOUND) -&gt; Type\n\</span>
<a name="l01582"></a>01582 <span class="stringliteral">Return a type which represents a vector of objects of this type.\n\</span>
<a name="l01583"></a>01583 <span class="stringliteral">The bounds of the array are [LOW_BOUND, HIGH_BOUND] inclusive.\n\</span>
<a name="l01584"></a>01584 <span class="stringliteral">If LOW_BOUND is omitted, a value of zero is used.\n\</span>
<a name="l01585"></a>01585 <span class="stringliteral">Vectors differ from arrays in that if the current language has C-style\n\</span>
<a name="l01586"></a>01586 <span class="stringliteral">arrays, vectors don&#39;t decay to a pointer to the first element.\n\</span>
<a name="l01587"></a>01587 <span class="stringliteral">They are first class values.&quot;</span> },
<a name="l01588"></a>01588    { <span class="stringliteral">&quot;__contains__&quot;</span>, typy_has_key, METH_VARARGS,
<a name="l01589"></a>01589      <span class="stringliteral">&quot;T.__contains__(k) -&gt; True if T has a field named k, else False&quot;</span> },
<a name="l01590"></a>01590   { <span class="stringliteral">&quot;const&quot;</span>, typy_const, METH_NOARGS,
<a name="l01591"></a>01591     <span class="stringliteral">&quot;const () -&gt; Type\n\</span>
<a name="l01592"></a>01592 <span class="stringliteral">Return a const variant of this type.&quot;</span> },
<a name="l01593"></a>01593   { <span class="stringliteral">&quot;fields&quot;</span>, typy_fields, METH_NOARGS,
<a name="l01594"></a>01594     <span class="stringliteral">&quot;fields () -&gt; list\n\</span>
<a name="l01595"></a>01595 <span class="stringliteral">Return a list holding all the fields of this type.\n\</span>
<a name="l01596"></a>01596 <span class="stringliteral">Each field is a gdb.Field object.&quot;</span> },
<a name="l01597"></a>01597   { <span class="stringliteral">&quot;get&quot;</span>, typy_get, METH_VARARGS,
<a name="l01598"></a>01598     <span class="stringliteral">&quot;T.get(k[,default]) -&gt; returns field named k in T, if it exists;\n\</span>
<a name="l01599"></a>01599 <span class="stringliteral">otherwise returns default, if supplied, or None if not.&quot;</span> },
<a name="l01600"></a>01600   { <span class="stringliteral">&quot;has_key&quot;</span>, typy_has_key, METH_VARARGS,
<a name="l01601"></a>01601     <span class="stringliteral">&quot;T.has_key(k) -&gt; True if T has a field named k, else False&quot;</span> },
<a name="l01602"></a>01602   { <span class="stringliteral">&quot;items&quot;</span>, typy_items, METH_NOARGS,
<a name="l01603"></a>01603     <span class="stringliteral">&quot;items () -&gt; list\n\</span>
<a name="l01604"></a>01604 <span class="stringliteral">Return a list of (name, field) pairs of this type.\n\</span>
<a name="l01605"></a>01605 <span class="stringliteral">Each field is a gdb.Field object.&quot;</span> },
<a name="l01606"></a>01606   { <span class="stringliteral">&quot;iteritems&quot;</span>, typy_iteritems, METH_NOARGS,
<a name="l01607"></a>01607     <span class="stringliteral">&quot;iteritems () -&gt; an iterator over the (name, field)\n\</span>
<a name="l01608"></a>01608 <span class="stringliteral">pairs of this type.  Each field is a gdb.Field object.&quot;</span> },
<a name="l01609"></a>01609   { <span class="stringliteral">&quot;iterkeys&quot;</span>, typy_iterkeys, METH_NOARGS,
<a name="l01610"></a>01610     <span class="stringliteral">&quot;iterkeys () -&gt; an iterator over the field names of this type.&quot;</span> },
<a name="l01611"></a>01611   { <span class="stringliteral">&quot;itervalues&quot;</span>, typy_itervalues, METH_NOARGS,
<a name="l01612"></a>01612     <span class="stringliteral">&quot;itervalues () -&gt; an iterator over the fields of this type.\n\</span>
<a name="l01613"></a>01613 <span class="stringliteral">Each field is a gdb.Field object.&quot;</span> },
<a name="l01614"></a>01614   { <span class="stringliteral">&quot;keys&quot;</span>, typy_field_names, METH_NOARGS,
<a name="l01615"></a>01615     <span class="stringliteral">&quot;keys () -&gt; list\n\</span>
<a name="l01616"></a>01616 <span class="stringliteral">Return a list holding all the fields names of this type.&quot;</span> },
<a name="l01617"></a>01617   { <span class="stringliteral">&quot;pointer&quot;</span>, typy_pointer, METH_NOARGS,
<a name="l01618"></a>01618     <span class="stringliteral">&quot;pointer () -&gt; Type\n\</span>
<a name="l01619"></a>01619 <span class="stringliteral">Return a type of pointer to this type.&quot;</span> },
<a name="l01620"></a>01620   { <span class="stringliteral">&quot;range&quot;</span>, typy_range, METH_NOARGS,
<a name="l01621"></a>01621     <span class="stringliteral">&quot;range () -&gt; tuple\n\</span>
<a name="l01622"></a>01622 <span class="stringliteral">Return a tuple containing the lower and upper range for this type.&quot;</span>},
<a name="l01623"></a>01623   { <span class="stringliteral">&quot;reference&quot;</span>, typy_reference, METH_NOARGS,
<a name="l01624"></a>01624     <span class="stringliteral">&quot;reference () -&gt; Type\n\</span>
<a name="l01625"></a>01625 <span class="stringliteral">Return a type of reference to this type.&quot;</span> },
<a name="l01626"></a>01626   { <span class="stringliteral">&quot;strip_typedefs&quot;</span>, typy_strip_typedefs, METH_NOARGS,
<a name="l01627"></a>01627     <span class="stringliteral">&quot;strip_typedefs () -&gt; Type\n\</span>
<a name="l01628"></a>01628 <span class="stringliteral">Return a type formed by stripping this type of all typedefs.&quot;</span>},
<a name="l01629"></a>01629   { <span class="stringliteral">&quot;target&quot;</span>, typy_target, METH_NOARGS,
<a name="l01630"></a>01630     <span class="stringliteral">&quot;target () -&gt; Type\n\</span>
<a name="l01631"></a>01631 <span class="stringliteral">Return the target type of this type.&quot;</span> },
<a name="l01632"></a>01632   { <span class="stringliteral">&quot;template_argument&quot;</span>, typy_template_argument, METH_VARARGS,
<a name="l01633"></a>01633     <span class="stringliteral">&quot;template_argument (arg, [block]) -&gt; Type\n\</span>
<a name="l01634"></a>01634 <span class="stringliteral">Return the type of a template argument.&quot;</span> },
<a name="l01635"></a>01635   { <span class="stringliteral">&quot;unqualified&quot;</span>, typy_unqualified, METH_NOARGS,
<a name="l01636"></a>01636     <span class="stringliteral">&quot;unqualified () -&gt; Type\n\</span>
<a name="l01637"></a>01637 <span class="stringliteral">Return a variant of this type without const or volatile attributes.&quot;</span> },
<a name="l01638"></a>01638   { <span class="stringliteral">&quot;values&quot;</span>, typy_values, METH_NOARGS,
<a name="l01639"></a>01639     <span class="stringliteral">&quot;values () -&gt; list\n\</span>
<a name="l01640"></a>01640 <span class="stringliteral">Return a list holding all the fields of this type.\n\</span>
<a name="l01641"></a>01641 <span class="stringliteral">Each field is a gdb.Field object.&quot;</span> },
<a name="l01642"></a>01642   { <span class="stringliteral">&quot;volatile&quot;</span>, typy_volatile, METH_NOARGS,
<a name="l01643"></a>01643     <span class="stringliteral">&quot;volatile () -&gt; Type\n\</span>
<a name="l01644"></a>01644 <span class="stringliteral">Return a volatile variant of this type&quot;</span> },
<a name="l01645"></a>01645   { NULL }
<a name="l01646"></a>01646 };
<a name="l01647"></a>01647 
<a name="l01648"></a>01648 <span class="keyword">static</span> PyNumberMethods type_object_as_number = {
<a name="l01649"></a>01649   NULL,                       <span class="comment">/* nb_add */</span>
<a name="l01650"></a>01650   NULL,                       <span class="comment">/* nb_subtract */</span>
<a name="l01651"></a>01651   NULL,                       <span class="comment">/* nb_multiply */</span>
<a name="l01652"></a>01652 <span class="preprocessor">#ifndef IS_PY3K</span>
<a name="l01653"></a>01653 <span class="preprocessor"></span>  NULL,                       <span class="comment">/* nb_divide */</span>
<a name="l01654"></a>01654 <span class="preprocessor">#endif</span>
<a name="l01655"></a>01655 <span class="preprocessor"></span>  NULL,                       <span class="comment">/* nb_remainder */</span>
<a name="l01656"></a>01656   NULL,                       <span class="comment">/* nb_divmod */</span>
<a name="l01657"></a>01657   NULL,                       <span class="comment">/* nb_power */</span>
<a name="l01658"></a>01658   NULL,                       <span class="comment">/* nb_negative */</span>
<a name="l01659"></a>01659   NULL,                       <span class="comment">/* nb_positive */</span>
<a name="l01660"></a>01660   NULL,                       <span class="comment">/* nb_absolute */</span>
<a name="l01661"></a>01661   typy_nonzero,               <span class="comment">/* nb_nonzero */</span>
<a name="l01662"></a>01662   NULL,                       <span class="comment">/* nb_invert */</span>
<a name="l01663"></a>01663   NULL,                       <span class="comment">/* nb_lshift */</span>
<a name="l01664"></a>01664   NULL,                       <span class="comment">/* nb_rshift */</span>
<a name="l01665"></a>01665   NULL,                       <span class="comment">/* nb_and */</span>
<a name="l01666"></a>01666   NULL,                       <span class="comment">/* nb_xor */</span>
<a name="l01667"></a>01667   NULL,                       <span class="comment">/* nb_or */</span>
<a name="l01668"></a>01668 <span class="preprocessor">#ifdef IS_PY3K</span>
<a name="l01669"></a>01669 <span class="preprocessor"></span>  NULL,                       <span class="comment">/* nb_int */</span>
<a name="l01670"></a>01670   NULL,                       <span class="comment">/* reserved */</span>
<a name="l01671"></a>01671 <span class="preprocessor">#else</span>
<a name="l01672"></a>01672 <span class="preprocessor"></span>  NULL,                       <span class="comment">/* nb_coerce */</span>
<a name="l01673"></a>01673   NULL,                       <span class="comment">/* nb_int */</span>
<a name="l01674"></a>01674   NULL,                       <span class="comment">/* nb_long */</span>
<a name="l01675"></a>01675 <span class="preprocessor">#endif</span>
<a name="l01676"></a>01676 <span class="preprocessor"></span>  NULL,                       <span class="comment">/* nb_float */</span>
<a name="l01677"></a>01677 <span class="preprocessor">#ifndef IS_PY3K</span>
<a name="l01678"></a>01678 <span class="preprocessor"></span>  NULL,                       <span class="comment">/* nb_oct */</span>
<a name="l01679"></a>01679   NULL                        <span class="comment">/* nb_hex */</span>
<a name="l01680"></a>01680 <span class="preprocessor">#endif</span>
<a name="l01681"></a>01681 <span class="preprocessor"></span>};
<a name="l01682"></a>01682 
<a name="l01683"></a>01683 <span class="keyword">static</span> PyMappingMethods typy_mapping = {
<a name="l01684"></a>01684   typy_length,
<a name="l01685"></a>01685   typy_getitem,
<a name="l01686"></a>01686   NULL                            <span class="comment">/* no &quot;set&quot; method */</span>
<a name="l01687"></a>01687 };
<a name="l01688"></a>01688 
<a name="l01689"></a>01689 <span class="keyword">static</span> PyTypeObject type_object_type =
<a name="l01690"></a>01690 {
<a name="l01691"></a>01691   PyVarObject_HEAD_INIT (NULL, 0)
<a name="l01692"></a>01692   <span class="stringliteral">&quot;gdb.Type&quot;</span>,                     <span class="comment">/*tp_name*/</span>
<a name="l01693"></a>01693   <span class="keyword">sizeof</span> (<a class="code" href="py-type_8c.html#ae78f30b4f569046b005fa08407d9fe1f">type_object</a>),           <span class="comment">/*tp_basicsize*/</span>
<a name="l01694"></a>01694   0,                              <span class="comment">/*tp_itemsize*/</span>
<a name="l01695"></a>01695   typy_dealloc,                   <span class="comment">/*tp_dealloc*/</span>
<a name="l01696"></a>01696   0,                              <span class="comment">/*tp_print*/</span>
<a name="l01697"></a>01697   0,                              <span class="comment">/*tp_getattr*/</span>
<a name="l01698"></a>01698   0,                              <span class="comment">/*tp_setattr*/</span>
<a name="l01699"></a>01699   0,                              <span class="comment">/*tp_compare*/</span>
<a name="l01700"></a>01700   0,                              <span class="comment">/*tp_repr*/</span>
<a name="l01701"></a>01701   &amp;type_object_as_number,         <span class="comment">/*tp_as_number*/</span>
<a name="l01702"></a>01702   0,                              <span class="comment">/*tp_as_sequence*/</span>
<a name="l01703"></a>01703   &amp;typy_mapping,                  <span class="comment">/*tp_as_mapping*/</span>
<a name="l01704"></a>01704   0,                              <span class="comment">/*tp_hash */</span>
<a name="l01705"></a>01705   0,                              <span class="comment">/*tp_call*/</span>
<a name="l01706"></a>01706   typy_str,                       <span class="comment">/*tp_str*/</span>
<a name="l01707"></a>01707   0,                              <span class="comment">/*tp_getattro*/</span>
<a name="l01708"></a>01708   0,                              <span class="comment">/*tp_setattro*/</span>
<a name="l01709"></a>01709   0,                              <span class="comment">/*tp_as_buffer*/</span>
<a name="l01710"></a>01710   Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_ITER,  <span class="comment">/*tp_flags*/</span>
<a name="l01711"></a>01711   <span class="stringliteral">&quot;GDB type object&quot;</span>,              <span class="comment">/* tp_doc */</span>
<a name="l01712"></a>01712   0,                              <span class="comment">/* tp_traverse */</span>
<a name="l01713"></a>01713   0,                              <span class="comment">/* tp_clear */</span>
<a name="l01714"></a>01714   typy_richcompare,               <span class="comment">/* tp_richcompare */</span>
<a name="l01715"></a>01715   0,                              <span class="comment">/* tp_weaklistoffset */</span>
<a name="l01716"></a>01716   typy_iter,                      <span class="comment">/* tp_iter */</span>
<a name="l01717"></a>01717   0,                              <span class="comment">/* tp_iternext */</span>
<a name="l01718"></a>01718   type_object_methods,            <span class="comment">/* tp_methods */</span>
<a name="l01719"></a>01719   0,                              <span class="comment">/* tp_members */</span>
<a name="l01720"></a>01720   type_object_getset,             <span class="comment">/* tp_getset */</span>
<a name="l01721"></a>01721   0,                              <span class="comment">/* tp_base */</span>
<a name="l01722"></a>01722   0,                              <span class="comment">/* tp_dict */</span>
<a name="l01723"></a>01723   0,                              <span class="comment">/* tp_descr_get */</span>
<a name="l01724"></a>01724   0,                              <span class="comment">/* tp_descr_set */</span>
<a name="l01725"></a>01725   0,                              <span class="comment">/* tp_dictoffset */</span>
<a name="l01726"></a>01726   0,                              <span class="comment">/* tp_init */</span>
<a name="l01727"></a>01727   0,                              <span class="comment">/* tp_alloc */</span>
<a name="l01728"></a>01728   0,                              <span class="comment">/* tp_new */</span>
<a name="l01729"></a>01729 };
<a name="l01730"></a>01730 
<a name="l01731"></a>01731 <span class="keyword">static</span> PyGetSetDef field_object_getset[] =
<a name="l01732"></a>01732 {
<a name="l01733"></a>01733   { <span class="stringliteral">&quot;__dict__&quot;</span>, <a class="code" href="py-utils_8c.html#ab989a2b717b8397bc4ffc95da5abb364">gdb_py_generic_dict</a>, NULL,
<a name="l01734"></a>01734     <span class="stringliteral">&quot;The __dict__ for this field.&quot;</span>, &amp;field_object_type },
<a name="l01735"></a>01735   { NULL }
<a name="l01736"></a>01736 };
<a name="l01737"></a>01737 
<a name="l01738"></a>01738 <span class="keyword">static</span> PyTypeObject field_object_type =
<a name="l01739"></a>01739 {
<a name="l01740"></a>01740   PyVarObject_HEAD_INIT (NULL, 0)
<a name="l01741"></a>01741   <span class="stringliteral">&quot;gdb.Field&quot;</span>,                    <span class="comment">/*tp_name*/</span>
<a name="l01742"></a>01742   <span class="keyword">sizeof</span> (<a class="code" href="py-type_8c.html#abc451703566d66eee2891acbc0bfd661">field_object</a>),          <span class="comment">/*tp_basicsize*/</span>
<a name="l01743"></a>01743   0,                              <span class="comment">/*tp_itemsize*/</span>
<a name="l01744"></a>01744   field_dealloc,                  <span class="comment">/*tp_dealloc*/</span>
<a name="l01745"></a>01745   0,                              <span class="comment">/*tp_print*/</span>
<a name="l01746"></a>01746   0,                              <span class="comment">/*tp_getattr*/</span>
<a name="l01747"></a>01747   0,                              <span class="comment">/*tp_setattr*/</span>
<a name="l01748"></a>01748   0,                              <span class="comment">/*tp_compare*/</span>
<a name="l01749"></a>01749   0,                              <span class="comment">/*tp_repr*/</span>
<a name="l01750"></a>01750   0,                              <span class="comment">/*tp_as_number*/</span>
<a name="l01751"></a>01751   0,                              <span class="comment">/*tp_as_sequence*/</span>
<a name="l01752"></a>01752   0,                              <span class="comment">/*tp_as_mapping*/</span>
<a name="l01753"></a>01753   0,                              <span class="comment">/*tp_hash */</span>
<a name="l01754"></a>01754   0,                              <span class="comment">/*tp_call*/</span>
<a name="l01755"></a>01755   0,                              <span class="comment">/*tp_str*/</span>
<a name="l01756"></a>01756   0,                              <span class="comment">/*tp_getattro*/</span>
<a name="l01757"></a>01757   0,                              <span class="comment">/*tp_setattro*/</span>
<a name="l01758"></a>01758   0,                              <span class="comment">/*tp_as_buffer*/</span>
<a name="l01759"></a>01759   Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_ITER,  <span class="comment">/*tp_flags*/</span>
<a name="l01760"></a>01760   <span class="stringliteral">&quot;GDB field object&quot;</span>,             <span class="comment">/* tp_doc */</span>
<a name="l01761"></a>01761   0,                              <span class="comment">/* tp_traverse */</span>
<a name="l01762"></a>01762   0,                              <span class="comment">/* tp_clear */</span>
<a name="l01763"></a>01763   0,                              <span class="comment">/* tp_richcompare */</span>
<a name="l01764"></a>01764   0,                              <span class="comment">/* tp_weaklistoffset */</span>
<a name="l01765"></a>01765   0,                              <span class="comment">/* tp_iter */</span>
<a name="l01766"></a>01766   0,                              <span class="comment">/* tp_iternext */</span>
<a name="l01767"></a>01767   0,                              <span class="comment">/* tp_methods */</span>
<a name="l01768"></a>01768   0,                              <span class="comment">/* tp_members */</span>
<a name="l01769"></a>01769   field_object_getset,            <span class="comment">/* tp_getset */</span>
<a name="l01770"></a>01770   0,                              <span class="comment">/* tp_base */</span>
<a name="l01771"></a>01771   0,                              <span class="comment">/* tp_dict */</span>
<a name="l01772"></a>01772   0,                              <span class="comment">/* tp_descr_get */</span>
<a name="l01773"></a>01773   0,                              <span class="comment">/* tp_descr_set */</span>
<a name="l01774"></a>01774   offsetof (<a class="code" href="py-type_8c.html#abc451703566d66eee2891acbc0bfd661">field_object</a>, <a class="code" href="structblock.html#afa346bb606240c28e21ea4365c4c996c">dict</a>),  <span class="comment">/* tp_dictoffset */</span>
<a name="l01775"></a>01775   0,                              <span class="comment">/* tp_init */</span>
<a name="l01776"></a>01776   0,                              <span class="comment">/* tp_alloc */</span>
<a name="l01777"></a>01777   0,                              <span class="comment">/* tp_new */</span>
<a name="l01778"></a>01778 };
<a name="l01779"></a>01779 
<a name="l01780"></a>01780 <span class="keyword">static</span> PyTypeObject type_iterator_object_type = {
<a name="l01781"></a>01781   PyVarObject_HEAD_INIT (NULL, 0)
<a name="l01782"></a>01782   <span class="stringliteral">&quot;gdb.TypeIterator&quot;</span>,             <span class="comment">/*tp_name*/</span>
<a name="l01783"></a>01783   <span class="keyword">sizeof</span> (typy_iterator_object),  <span class="comment">/*tp_basicsize*/</span>
<a name="l01784"></a>01784   0,                              <span class="comment">/*tp_itemsize*/</span>
<a name="l01785"></a>01785   typy_iterator_dealloc,          <span class="comment">/*tp_dealloc*/</span>
<a name="l01786"></a>01786   0,                              <span class="comment">/*tp_print*/</span>
<a name="l01787"></a>01787   0,                              <span class="comment">/*tp_getattr*/</span>
<a name="l01788"></a>01788   0,                              <span class="comment">/*tp_setattr*/</span>
<a name="l01789"></a>01789   0,                              <span class="comment">/*tp_compare*/</span>
<a name="l01790"></a>01790   0,                              <span class="comment">/*tp_repr*/</span>
<a name="l01791"></a>01791   0,                              <span class="comment">/*tp_as_number*/</span>
<a name="l01792"></a>01792   0,                              <span class="comment">/*tp_as_sequence*/</span>
<a name="l01793"></a>01793   0,                              <span class="comment">/*tp_as_mapping*/</span>
<a name="l01794"></a>01794   0,                              <span class="comment">/*tp_hash */</span>
<a name="l01795"></a>01795   0,                              <span class="comment">/*tp_call*/</span>
<a name="l01796"></a>01796   0,                              <span class="comment">/*tp_str*/</span>
<a name="l01797"></a>01797   0,                              <span class="comment">/*tp_getattro*/</span>
<a name="l01798"></a>01798   0,                              <span class="comment">/*tp_setattro*/</span>
<a name="l01799"></a>01799   0,                              <span class="comment">/*tp_as_buffer*/</span>
<a name="l01800"></a>01800   Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_ITER,  <span class="comment">/*tp_flags*/</span>
<a name="l01801"></a>01801   <span class="stringliteral">&quot;GDB type iterator object&quot;</span>,     <span class="comment">/*tp_doc */</span>
<a name="l01802"></a>01802   0,                              <span class="comment">/*tp_traverse */</span>
<a name="l01803"></a>01803   0,                              <span class="comment">/*tp_clear */</span>
<a name="l01804"></a>01804   0,                              <span class="comment">/*tp_richcompare */</span>
<a name="l01805"></a>01805   0,                              <span class="comment">/*tp_weaklistoffset */</span>
<a name="l01806"></a>01806   typy_iterator_iter,             <span class="comment">/*tp_iter */</span>
<a name="l01807"></a>01807   typy_iterator_iternext,         <span class="comment">/*tp_iternext */</span>
<a name="l01808"></a>01808   0                               <span class="comment">/*tp_methods */</span>
<a name="l01809"></a>01809 };
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Fri Oct 11 2013 14:12:23 for GDB (API) by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
