<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>GDB (API): /home/stan/gdb/src/gdb/top.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">GDB (API)
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">/home/stan/gdb/src/gdb/top.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="top_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* Top level stuff for GDB, the GNU debugger.</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">   Copyright (C) 1986-2013 Free Software Foundation, Inc.</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">   This file is part of GDB.</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">   This program is free software; you can redistribute it and/or modify</span>
<a name="l00008"></a>00008 <span class="comment">   it under the terms of the GNU General Public License as published by</span>
<a name="l00009"></a>00009 <span class="comment">   the Free Software Foundation; either version 3 of the License, or</span>
<a name="l00010"></a>00010 <span class="comment">   (at your option) any later version.</span>
<a name="l00011"></a>00011 <span class="comment"></span>
<a name="l00012"></a>00012 <span class="comment">   This program is distributed in the hope that it will be useful,</span>
<a name="l00013"></a>00013 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00014"></a>00014 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00015"></a>00015 <span class="comment">   GNU General Public License for more details.</span>
<a name="l00016"></a>00016 <span class="comment"></span>
<a name="l00017"></a>00017 <span class="comment">   You should have received a copy of the GNU General Public License</span>
<a name="l00018"></a>00018 <span class="comment">   along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.  */</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="defs_8h.html">defs.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="gdbcmd_8h.html">gdbcmd.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="cli-cmds_8h.html">cli/cli-cmds.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="cli-script_8h.html">cli/cli-script.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="cli-setshow_8h.html">cli/cli-setshow.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="cli-decode_8h.html">cli/cli-decode.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="symtab_8h.html">symtab.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="inferior_8h.html">inferior.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="exceptions_8h.html">exceptions.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;signal.h&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="target_8h.html">target.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="breakpoint_8h.html">breakpoint.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="gdbtypes_8h.html">gdbtypes.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="expression_8h.html">expression.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="value_8h.html">value.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="language_8h.html">language.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="terminal_8h.html">terminal.h</a>&quot;</span>           <span class="comment">/* For job_control.  */</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="annotate_8h.html">annotate.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="completer_8h.html">completer.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="top_8h.html">top.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="version_8h.html">version.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="serial_8h.html">serial.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="doublest_8h.html">doublest.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="gdb__assert_8h.html">gdb_assert.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="main_8h.html">main.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="event-loop_8h.html">event-loop.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="gdbthread_8h.html">gdbthread.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="python_8h.html">python/python.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="interps_8h.html">interps.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="observer_8h.html">observer.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="maint_8h.html">maint.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;filenames.h&quot;</span>
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="comment">/* readline include files.  */</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;readline/readline.h&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;readline/history.h&quot;</span>
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 <span class="comment">/* readline defines this.  */</span>
<a name="l00058"></a>00058 <span class="preprocessor">#undef savestring</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="event-top_8h.html">event-top.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="gdb__string_8h.html">gdb_string.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="gdb__stat_8h.html">gdb_stat.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="ui-out_8h.html">ui-out.h</a>&quot;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="cli-out_8h.html">cli-out.h</a>&quot;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="tracepoint_8h.html">tracepoint.h</a>&quot;</span>
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="top_8c.html#ab2e137e6483ebfa90e7c2998b2528045">initialize_all_files</a> (<span class="keywordtype">void</span>);
<a name="l00071"></a>00071 
<a name="l00072"></a><a class="code" href="top_8c.html#ad07ac2e1bdb66d33cd24dd0b86c2a107">00072</a> <span class="preprocessor">#define PROMPT(X) the_prompts.prompt_stack[the_prompts.top + X].prompt</span>
<a name="l00073"></a><a class="code" href="top_8c.html#a93fd6b279092ab8069dcefff818d2b90">00073</a> <span class="preprocessor"></span><span class="preprocessor">#define PREFIX(X) the_prompts.prompt_stack[the_prompts.top + X].prefix</span>
<a name="l00074"></a><a class="code" href="top_8c.html#a12a3666558ebc33fd57681a25325dc8f">00074</a> <span class="preprocessor"></span><span class="preprocessor">#define SUFFIX(X) the_prompts.prompt_stack[the_prompts.top + X].suffix</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span>
<a name="l00076"></a>00076 <span class="comment">/* Default command line prompt.  This is overriden in some configs.  */</span>
<a name="l00077"></a>00077 
<a name="l00078"></a>00078 <span class="preprocessor">#ifndef DEFAULT_PROMPT</span>
<a name="l00079"></a><a class="code" href="top_8c.html#a2b7e157b569bfc6ebc29f32ae647359b">00079</a> <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_PROMPT  &quot;(gdb) &quot;</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00081"></a>00081 <span class="preprocessor"></span>
<a name="l00082"></a>00082 <span class="comment">/* Initialization file name for gdb.  This is host-dependent.  */</span>
<a name="l00083"></a>00083 
<a name="l00084"></a><a class="code" href="top_8h.html#a88392ce9b9952e955865ac5846aa73a9">00084</a> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="top_8c.html#a88392ce9b9952e955865ac5846aa73a9">gdbinit</a>[] = <a class="code" href="config_8h.html#a7122cb3e142b127ee63a1772e34331d9">GDBINIT</a>;
<a name="l00085"></a>00085 
<a name="l00086"></a><a class="code" href="top_8h.html#a10f750f5563908f916929b236b67dc28">00086</a> <span class="keywordtype">int</span> <a class="code" href="top_8c.html#a10f750f5563908f916929b236b67dc28">inhibit_gdbinit</a> = 0;
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 <span class="comment">/* If nonzero, and GDB has been configured to be able to use windows,</span>
<a name="l00089"></a>00089 <span class="comment">   attempt to open them upon startup.  */</span>
<a name="l00090"></a>00090 
<a name="l00091"></a><a class="code" href="top_8c.html#aaf213fbf1bf0a388b80380297d49ea4e">00091</a> <span class="keywordtype">int</span> <a class="code" href="defs_8h.html#aaf213fbf1bf0a388b80380297d49ea4e">use_windows</a> = 0;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 <span class="keyword">extern</span> <span class="keywordtype">char</span> <a class="code" href="language_8c.html#a860b8de5e12667342d4b88d199c81f64">lang_frame_mismatch_warn</a>[];         <span class="comment">/* language.c */</span>
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 <span class="comment">/* Flag for whether we want to confirm potentially dangerous</span>
<a name="l00096"></a>00096 <span class="comment">   operations.  Default is yes.  */</span>
<a name="l00097"></a>00097 
<a name="l00098"></a><a class="code" href="top_8h.html#a017735088b9fcf1098ce134a77550ccf">00098</a> <span class="keywordtype">int</span> <a class="code" href="top_8c.html#a017735088b9fcf1098ce134a77550ccf">confirm</a> = 1;
<a name="l00099"></a>00099 
<a name="l00100"></a>00100 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00101"></a>00101 show_confirm (<span class="keyword">struct</span> ui_file *file, <span class="keywordtype">int</span> from_tty,
<a name="l00102"></a>00102               <span class="keyword">struct</span> <a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *value)
<a name="l00103"></a>00103 {
<a name="l00104"></a>00104   <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (file, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Whether to confirm potentially &quot;</span>
<a name="l00105"></a>00105                             <span class="stringliteral">&quot;dangerous operations is %s.\n&quot;</span>),
<a name="l00106"></a>00106                     value);
<a name="l00107"></a>00107 }
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 <span class="comment">/* stdio stream that command input is being read from.  Set to stdin</span>
<a name="l00110"></a>00110 <span class="comment">   normally.  Set by source_command to the file we are sourcing.  Set</span>
<a name="l00111"></a>00111 <span class="comment">   to NULL if we are executing a user-defined command or interacting</span>
<a name="l00112"></a>00112 <span class="comment">   via a GUI.  */</span>
<a name="l00113"></a>00113 
<a name="l00114"></a><a class="code" href="top_8h.html#a3291280191f8913361ed5602219b6022">00114</a> FILE *<a class="code" href="top_8c.html#a3291280191f8913361ed5602219b6022">instream</a>;
<a name="l00115"></a>00115 
<a name="l00116"></a>00116 <span class="comment">/* Flag to indicate whether a user defined command is currently running.  */</span>
<a name="l00117"></a>00117 
<a name="l00118"></a><a class="code" href="top_8h.html#afdbde677efc10223e5db82c8910dd08c">00118</a> <span class="keywordtype">int</span> <a class="code" href="top_8c.html#afdbde677efc10223e5db82c8910dd08c">in_user_command</a>;
<a name="l00119"></a>00119 
<a name="l00120"></a>00120 <span class="comment">/* Current working directory.  */</span>
<a name="l00121"></a>00121 
<a name="l00122"></a><a class="code" href="top_8c.html#a6dd03da55f1ccd4375343b3a93aaf421">00122</a> <span class="keywordtype">char</span> *<a class="code" href="defs_8h.html#a6dd03da55f1ccd4375343b3a93aaf421">current_directory</a>;
<a name="l00123"></a>00123 
<a name="l00124"></a>00124 <span class="comment">/* The directory name is actually stored here (usually).  */</span>
<a name="l00125"></a><a class="code" href="top_8h.html#aaacd04c5acea8e9aa7bb2eb3719dbc40">00125</a> <span class="keywordtype">char</span> <a class="code" href="top_8c.html#aaacd04c5acea8e9aa7bb2eb3719dbc40">gdb_dirbuf</a>[1024];
<a name="l00126"></a>00126 
<a name="l00127"></a>00127 <span class="comment">/* Function to call before reading a command, if nonzero.</span>
<a name="l00128"></a>00128 <span class="comment">   The function receives two args: an input stream,</span>
<a name="l00129"></a>00129 <span class="comment">   and a prompt string.  */</span>
<a name="l00130"></a>00130 
<a name="l00131"></a><a class="code" href="top_8c.html#a24f0444e515470b9d477bc5d04379c99">00131</a> void (*<a class="code" href="top_8c.html#a24f0444e515470b9d477bc5d04379c99">window_hook</a>) (FILE *, <span class="keywordtype">char</span> *);
<a name="l00132"></a>00132 
<a name="l00133"></a>00133 <span class="comment">/* Buffer used for reading command lines, and the size</span>
<a name="l00134"></a>00134 <span class="comment">   allocated for it so far.  */</span>
<a name="l00135"></a>00135 
<a name="l00136"></a><a class="code" href="top_8h.html#ac9aa2915d5f249ab83d3e0e511cca40a">00136</a> <span class="keywordtype">char</span> *<a class="code" href="top_8c.html#ac9aa2915d5f249ab83d3e0e511cca40a">saved_command_line</a>;
<a name="l00137"></a><a class="code" href="top_8h.html#a61d3a45b79c16ff5140d783f24e538d5">00137</a> <span class="keywordtype">int</span> <a class="code" href="top_8c.html#a61d3a45b79c16ff5140d783f24e538d5">saved_command_line_size</a> = 100;
<a name="l00138"></a>00138 
<a name="l00139"></a>00139 <span class="comment">/* Nonzero if the current command is modified by &quot;server &quot;.  This</span>
<a name="l00140"></a>00140 <span class="comment">   affects things like recording into the command history, commands</span>
<a name="l00141"></a>00141 <span class="comment">   repeating on RETURN, etc.  This is so a user interface (emacs, GUI,</span>
<a name="l00142"></a>00142 <span class="comment">   whatever) can issue its own commands and also send along commands</span>
<a name="l00143"></a>00143 <span class="comment">   from the user, and have the user not notice that the user interface</span>
<a name="l00144"></a>00144 <span class="comment">   is issuing commands too.  */</span>
<a name="l00145"></a><a class="code" href="top_8h.html#a696fc2ffc263949656d0a3d0e29c78b0">00145</a> <span class="keywordtype">int</span> <a class="code" href="top_8c.html#a696fc2ffc263949656d0a3d0e29c78b0">server_command</a>;
<a name="l00146"></a>00146 
<a name="l00147"></a>00147 <span class="comment">/* Timeout limit for response from target.  */</span>
<a name="l00148"></a>00148 
<a name="l00149"></a>00149 <span class="comment">/* The default value has been changed many times over the years.  It </span>
<a name="l00150"></a>00150 <span class="comment">   was originally 5 seconds.  But that was thought to be a long time </span>
<a name="l00151"></a>00151 <span class="comment">   to sit and wait, so it was changed to 2 seconds.  That was thought</span>
<a name="l00152"></a>00152 <span class="comment">   to be plenty unless the connection was going through some terminal </span>
<a name="l00153"></a>00153 <span class="comment">   server or multiplexer or other form of hairy serial connection.</span>
<a name="l00154"></a>00154 <span class="comment"></span>
<a name="l00155"></a>00155 <span class="comment">   In mid-1996, remote_timeout was moved from remote.c to top.c and </span>
<a name="l00156"></a>00156 <span class="comment">   it began being used in other remote-* targets.  It appears that the</span>
<a name="l00157"></a>00157 <span class="comment">   default was changed to 20 seconds at that time, perhaps because the</span>
<a name="l00158"></a>00158 <span class="comment">   Renesas E7000 ICE didn&#39;t always respond in a timely manner.</span>
<a name="l00159"></a>00159 <span class="comment"></span>
<a name="l00160"></a>00160 <span class="comment">   But if 5 seconds is a long time to sit and wait for retransmissions,</span>
<a name="l00161"></a>00161 <span class="comment">   20 seconds is far worse.  This demonstrates the difficulty of using </span>
<a name="l00162"></a>00162 <span class="comment">   a single variable for all protocol timeouts.</span>
<a name="l00163"></a>00163 <span class="comment"></span>
<a name="l00164"></a>00164 <span class="comment">   As remote.c is used much more than remote-e7000.c, it was changed </span>
<a name="l00165"></a>00165 <span class="comment">   back to 2 seconds in 1999.  */</span>
<a name="l00166"></a>00166 
<a name="l00167"></a><a class="code" href="top_8c.html#ac6decadce663ff98c95196919273e194">00167</a> <span class="keywordtype">int</span> <a class="code" href="target_8h.html#ac6decadce663ff98c95196919273e194">remote_timeout</a> = 2;
<a name="l00168"></a>00168 
<a name="l00169"></a>00169 <span class="comment">/* Non-zero tells remote* modules to output debugging info.  */</span>
<a name="l00170"></a>00170 
<a name="l00171"></a><a class="code" href="top_8c.html#ab222915c90ee61978f3519f8fdd922c7">00171</a> <span class="keywordtype">int</span> <a class="code" href="dsrec_8c.html#ab222915c90ee61978f3519f8fdd922c7">remote_debug</a> = 0;
<a name="l00172"></a>00172 
<a name="l00173"></a>00173 <span class="comment">/* Sbrk location on entry to main.  Used for statistics only.  */</span>
<a name="l00174"></a>00174 <span class="preprocessor">#ifdef HAVE_SBRK</span>
<a name="l00175"></a>00175 <span class="preprocessor"></span><span class="keywordtype">char</span> *<a class="code" href="top_8h.html#a47b47da3dc2c8a3af21aa5e2c89a1153">lim_at_start</a>;
<a name="l00176"></a>00176 <span class="preprocessor">#endif</span>
<a name="l00177"></a>00177 <span class="preprocessor"></span>
<a name="l00178"></a>00178 <span class="comment">/* Hooks for alternate command interfaces.  */</span>
<a name="l00179"></a>00179 
<a name="l00180"></a>00180 <span class="comment">/* Called after most modules have been initialized, but before taking</span>
<a name="l00181"></a>00181 <span class="comment">   users command file.</span>
<a name="l00182"></a>00182 <span class="comment"></span>
<a name="l00183"></a>00183 <span class="comment">   If the UI fails to initialize and it wants GDB to continue using</span>
<a name="l00184"></a>00184 <span class="comment">   the default UI, then it should clear this hook before returning.  */</span>
<a name="l00185"></a>00185 
<a name="l00186"></a><a class="code" href="top_8c.html#a3996e2ec105f1b21bf1aa74eacd55822">00186</a> void (*<a class="code" href="defs_8h.html#a3996e2ec105f1b21bf1aa74eacd55822">deprecated_init_ui_hook</a>) (<span class="keywordtype">char</span> *argv0);
<a name="l00187"></a>00187 
<a name="l00188"></a>00188 <span class="comment">/* This hook is called from within gdb&#39;s many mini-event loops which</span>
<a name="l00189"></a>00189 <span class="comment">   could steal control from a real user interface&#39;s event loop.  It</span>
<a name="l00190"></a>00190 <span class="comment">   returns non-zero if the user is requesting a detach, zero</span>
<a name="l00191"></a>00191 <span class="comment">   otherwise.  */</span>
<a name="l00192"></a>00192 
<a name="l00193"></a><a class="code" href="top_8c.html#a50c8fced23961f46efb689eba75be31c">00193</a> <a class="code" href="command_8h.html#a74f207b5aa4ba51c3a2ad59b219a423b">int</a> (*<a class="code" href="defs_8h.html#af751c24b7cb78835e79a740a3e82fdd1">deprecated_ui_loop_hook</a>) (<a class="code" href="command_8h.html#a74f207b5aa4ba51c3a2ad59b219a423b">int</a>);
<a name="l00194"></a>00194 
<a name="l00195"></a>00195 
<a name="l00196"></a>00196 <span class="comment">/* Called from print_frame_info to list the line we stopped in.  */</span>
<a name="l00197"></a>00197 
<a name="l00198"></a><a class="code" href="top_8c.html#af7a2b3434c7096d33fdaaffaf0857774">00198</a> void (*<a class="code" href="defs_8h.html#af7a2b3434c7096d33fdaaffaf0857774">deprecated_print_frame_info_listing_hook</a>) (<span class="keyword">struct </span><a class="code" href="structsymtab.html">symtab</a> * s, 
<a name="l00199"></a>00199                                                   <span class="keywordtype">int</span> <a class="code" href="symtab_8h.html#a41ebd28ef1d7c6ade45642cb6acc1039">line</a>,
<a name="l00200"></a>00200                                                   <span class="keywordtype">int</span> stopline, 
<a name="l00201"></a>00201                                                   <span class="keywordtype">int</span> noerror);
<a name="l00202"></a>00202 <span class="comment">/* Replaces most of query.  */</span>
<a name="l00203"></a>00203 
<a name="l00204"></a><a class="code" href="top_8c.html#ae49d8ae0cf07114c167e4f3d0b57477f">00204</a> <a class="code" href="command_8h.html#a74f207b5aa4ba51c3a2ad59b219a423b">int</a> (*<a class="code" href="defs_8h.html#a73e08825d49cc8ffff1e0166d7dd9c4a">deprecated_query_hook</a>) (<span class="keyword">const</span> <span class="keywordtype">char</span> *, va_list);
<a name="l00205"></a>00205 
<a name="l00206"></a>00206 <span class="comment">/* Replaces most of warning.  */</span>
<a name="l00207"></a>00207 
<a name="l00208"></a><a class="code" href="top_8c.html#acbdee0fc92a5e05a5de83ce253cdac90">00208</a> void (*<a class="code" href="defs_8h.html#aa5288a9209f0ecabb7aea8e674e90717">deprecated_warning_hook</a>) (<span class="keyword">const</span> <span class="keywordtype">char</span> *, va_list);
<a name="l00209"></a>00209 
<a name="l00210"></a>00210 <span class="comment">/* These three functions support getting lines of text from the user.</span>
<a name="l00211"></a>00211 <span class="comment">   They are used in sequence.  First deprecated_readline_begin_hook is</span>
<a name="l00212"></a>00212 <span class="comment">   called with a text string that might be (for example) a message for</span>
<a name="l00213"></a>00213 <span class="comment">   the user to type in a sequence of commands to be executed at a</span>
<a name="l00214"></a>00214 <span class="comment">   breakpoint.  If this function calls back to a GUI, it might take</span>
<a name="l00215"></a>00215 <span class="comment">   this opportunity to pop up a text interaction window with this</span>
<a name="l00216"></a>00216 <span class="comment">   message.  Next, deprecated_readline_hook is called with a prompt</span>
<a name="l00217"></a>00217 <span class="comment">   that is emitted prior to collecting the user input.  It can be</span>
<a name="l00218"></a>00218 <span class="comment">   called multiple times.  Finally, deprecated_readline_end_hook is</span>
<a name="l00219"></a>00219 <span class="comment">   called to notify the GUI that we are done with the interaction</span>
<a name="l00220"></a>00220 <span class="comment">   window and it can close it.  */</span>
<a name="l00221"></a>00221 
<a name="l00222"></a><a class="code" href="top_8c.html#ad9795fb4dd6ef67e1f5183405d655831">00222</a> void (*<a class="code" href="defs_8h.html#a67b92a0914e5210fdb6451b5905864c1">deprecated_readline_begin_hook</a>) (<span class="keywordtype">char</span> *, ...);
<a name="l00223"></a><a class="code" href="top_8c.html#a242bdd617db5ca704c67dfb91d6f1ea6">00223</a> <span class="keywordtype">char</span> *(*deprecated_readline_hook) (<span class="keywordtype">char</span> *);
<a name="l00224"></a><a class="code" href="top_8c.html#aa9abb746b8e3a6eec37974232e327e70">00224</a> void (*<a class="code" href="defs_8h.html#aa9abb746b8e3a6eec37974232e327e70">deprecated_readline_end_hook</a>) (void);
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 <span class="comment">/* Called as appropriate to notify the interface that we have attached</span>
<a name="l00227"></a>00227 <span class="comment">   to or detached from an already running process.  */</span>
<a name="l00228"></a>00228 
<a name="l00229"></a><a class="code" href="top_8c.html#a06e6bf8efdee1550eca3f3c7ba83cabd">00229</a> void (*<a class="code" href="defs_8h.html#a06e6bf8efdee1550eca3f3c7ba83cabd">deprecated_attach_hook</a>) (void);
<a name="l00230"></a><a class="code" href="top_8c.html#a630376f233a120c279b903ec2e2e5947">00230</a> void (*<a class="code" href="defs_8h.html#a630376f233a120c279b903ec2e2e5947">deprecated_detach_hook</a>) (void);
<a name="l00231"></a>00231 
<a name="l00232"></a>00232 <span class="comment">/* Called during long calculations to allow GUI to repair window</span>
<a name="l00233"></a>00233 <span class="comment">   damage, and to check for stop buttons, etc...  */</span>
<a name="l00234"></a>00234 
<a name="l00235"></a><a class="code" href="top_8c.html#a264a9acd26d141bb10f2afe5ef5609ed">00235</a> void (*<a class="code" href="defs_8h.html#a264a9acd26d141bb10f2afe5ef5609ed">deprecated_interactive_hook</a>) (void);
<a name="l00236"></a>00236 
<a name="l00237"></a>00237 <span class="comment">/* Tell the GUI someone changed the register REGNO.  -1 means</span>
<a name="l00238"></a>00238 <span class="comment">   that the caller does not know which register changed or</span>
<a name="l00239"></a>00239 <span class="comment">   that several registers have changed (see value_assign).  */</span>
<a name="l00240"></a><a class="code" href="top_8c.html#a3f2d9ce8bb47675e307ca85299bbbacc">00240</a> void (*<a class="code" href="defs_8h.html#a3f2d9ce8bb47675e307ca85299bbbacc">deprecated_register_changed_hook</a>) (<span class="keywordtype">int</span> regno);
<a name="l00241"></a>00241 
<a name="l00242"></a>00242 <span class="comment">/* Called when going to wait for the target.  Usually allows the GUI</span>
<a name="l00243"></a>00243 <span class="comment">   to run while waiting for target events.  */</span>
<a name="l00244"></a>00244 
<a name="l00245"></a><a class="code" href="top_8c.html#a465a6e1421e0bd7b62aa7d7c1c4d663a">00245</a> <a class="code" href="ptid_8h.html#aafdcd92f9f083a6e3233884cb3cc0653">ptid_t</a> (*<a class="code" href="defs_8h.html#a465a6e1421e0bd7b62aa7d7c1c4d663a">deprecated_target_wait_hook</a>) (<a class="code" href="structptid.html">ptid_t</a> <a class="code" href="structptid.html">ptid</a>,
<a name="l00246"></a>00246                                        <span class="keyword">struct </span><a class="code" href="structtarget__waitstatus.html">target_waitstatus</a> *<a class="code" href="namespaceexsummary.html#aa4a2eed06e51a1f73ff9053ec9f2591e">status</a>,
<a name="l00247"></a>00247                                        <span class="keywordtype">int</span> options);
<a name="l00248"></a>00248 
<a name="l00249"></a>00249 <span class="comment">/* Used by UI as a wrapper around command execution.  May do various</span>
<a name="l00250"></a>00250 <span class="comment">   things like enabling/disabling buttons, etc...  */</span>
<a name="l00251"></a>00251 
<a name="l00252"></a><a class="code" href="top_8c.html#ac0e4900322c7a985af27f65d1fba5cc2">00252</a> void (*<a class="code" href="defs_8h.html#ac0e4900322c7a985af27f65d1fba5cc2">deprecated_call_command_hook</a>) (<span class="keyword">struct </span><a class="code" href="structcmd__list__element.html">cmd_list_element</a> * c, 
<a name="l00253"></a>00253                                       <span class="keywordtype">char</span> *cmd, <span class="keywordtype">int</span> from_tty);
<a name="l00254"></a>00254 
<a name="l00255"></a>00255 <span class="comment">/* Called after a `set&#39; command has finished.  Is only run if the</span>
<a name="l00256"></a>00256 <span class="comment">   `set&#39; command succeeded.  */</span>
<a name="l00257"></a>00257 
<a name="l00258"></a><a class="code" href="top_8c.html#ae98b07b13d48549f709db8f7001d2e72">00258</a> void (*<a class="code" href="defs_8h.html#ae98b07b13d48549f709db8f7001d2e72">deprecated_set_hook</a>) (<span class="keyword">struct </span><a class="code" href="structcmd__list__element.html">cmd_list_element</a> * c);
<a name="l00259"></a>00259 
<a name="l00260"></a>00260 <span class="comment">/* Called when the current thread changes.  Argument is thread id.  */</span>
<a name="l00261"></a>00261 
<a name="l00262"></a><a class="code" href="top_8c.html#a1e3f3cba1ac434f992c7afd305ecdd4b">00262</a> void (*<a class="code" href="defs_8h.html#ad0d5e79abdf767c74f2cac2b25430097">deprecated_context_hook</a>) (<span class="keywordtype">int</span> id);
<a name="l00263"></a>00263 
<a name="l00264"></a>00264 <span class="comment">/* Handler for SIGHUP.  */</span>
<a name="l00265"></a>00265 
<a name="l00266"></a>00266 <span class="preprocessor">#ifdef SIGHUP</span>
<a name="l00267"></a>00267 <span class="preprocessor"></span><span class="comment">/* NOTE 1999-04-29: This function will be static again, once we modify</span>
<a name="l00268"></a>00268 <span class="comment">   gdb to use the event loop as the default command loop and we merge</span>
<a name="l00269"></a>00269 <span class="comment">   event-top.c into this file, top.c.  */</span>
<a name="l00270"></a>00270 <span class="comment">/* static */</span> <span class="keywordtype">void</span>
<a name="l00271"></a>00271 <a class="code" href="top_8h.html#a60022006270e7c8a150a2969e5c5cf35">quit_cover</a> (<span class="keywordtype">void</span>)
<a name="l00272"></a>00272 {
<a name="l00273"></a>00273   <span class="comment">/* Stop asking user for confirmation --- we&#39;re exiting.  This</span>
<a name="l00274"></a>00274 <span class="comment">     prevents asking the user dumb questions.  */</span>
<a name="l00275"></a>00275   <a class="code" href="top_8c.html#a017735088b9fcf1098ce134a77550ccf">confirm</a> = 0;
<a name="l00276"></a>00276   <a class="code" href="cli-cmds_8c.html#a10d7719cfe940012e639c67840dd3cc0">quit_command</a> ((<span class="keywordtype">char</span> *) 0, 0);
<a name="l00277"></a>00277 }
<a name="l00278"></a>00278 <span class="preprocessor">#endif </span><span class="comment">/* defined SIGHUP */</span>
<a name="l00279"></a>00279 
<a name="l00280"></a>00280 <span class="comment">/* Line number we are currently in, in a file which is being sourced.  */</span>
<a name="l00281"></a>00281 <span class="comment">/* NOTE 1999-04-29: This variable will be static again, once we modify</span>
<a name="l00282"></a>00282 <span class="comment">   gdb to use the event loop as the default command loop and we merge</span>
<a name="l00283"></a>00283 <span class="comment">   event-top.c into this file, top.c.  */</span>
<a name="l00284"></a><a class="code" href="top_8h.html#a2faf304519ad947de2587843911e7fc2">00284</a> <span class="comment">/* static */</span> <span class="keywordtype">int</span> <a class="code" href="top_8c.html#a2faf304519ad947de2587843911e7fc2">source_line_number</a>;
<a name="l00285"></a>00285 
<a name="l00286"></a>00286 <span class="comment">/* Name of the file we are sourcing.  */</span>
<a name="l00287"></a>00287 <span class="comment">/* NOTE 1999-04-29: This variable will be static again, once we modify</span>
<a name="l00288"></a>00288 <span class="comment">   gdb to use the event loop as the default command loop and we merge</span>
<a name="l00289"></a>00289 <span class="comment">   event-top.c into this file, top.c.  */</span>
<a name="l00290"></a><a class="code" href="top_8h.html#a71a2c53bb82071ba9049777b1388cd4b">00290</a> <span class="comment">/* static */</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="top_8c.html#a71a2c53bb82071ba9049777b1388cd4b">source_file_name</a>;
<a name="l00291"></a>00291 
<a name="l00292"></a>00292 <span class="comment">/* Clean up on error during a &quot;source&quot; command (or execution of a</span>
<a name="l00293"></a>00293 <span class="comment">   user-defined command).  */</span>
<a name="l00294"></a>00294 
<a name="l00295"></a>00295 <span class="keywordtype">void</span>
<a name="l00296"></a><a class="code" href="top_8h.html#afe3b77141a43277921a173e733b96ae3">00296</a> <a class="code" href="top_8c.html#afe3b77141a43277921a173e733b96ae3">do_restore_instream_cleanup</a> (<span class="keywordtype">void</span> *stream)
<a name="l00297"></a>00297 {
<a name="l00298"></a>00298   <span class="comment">/* Restore the previous input stream.  */</span>
<a name="l00299"></a>00299   <a class="code" href="top_8c.html#a3291280191f8913361ed5602219b6022">instream</a> = stream;
<a name="l00300"></a>00300 }
<a name="l00301"></a>00301 
<a name="l00302"></a>00302 <span class="comment">/* Read commands from STREAM.  */</span>
<a name="l00303"></a>00303 <span class="keywordtype">void</span>
<a name="l00304"></a><a class="code" href="top_8h.html#af6969f21efec4db1a320b8fb059cc307">00304</a> <a class="code" href="top_8c.html#a6e89b5d2abc949ed4b252d51969d90ce">read_command_file</a> (FILE *stream)
<a name="l00305"></a>00305 {
<a name="l00306"></a>00306   <span class="keyword">struct </span>cleanup *cleanups;
<a name="l00307"></a>00307 
<a name="l00308"></a>00308   cleanups = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="top_8c.html#afe3b77141a43277921a173e733b96ae3">do_restore_instream_cleanup</a>, <a class="code" href="top_8c.html#a3291280191f8913361ed5602219b6022">instream</a>);
<a name="l00309"></a>00309   <a class="code" href="top_8c.html#a3291280191f8913361ed5602219b6022">instream</a> = stream;
<a name="l00310"></a>00310   <a class="code" href="top_8c.html#a7f8a2217b49b5ebd548a1713aeafa643">command_loop</a> ();
<a name="l00311"></a>00311   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanups);
<a name="l00312"></a>00312 }
<a name="l00313"></a>00313 
<a name="l00314"></a><a class="code" href="top_8c.html#ac5d8f583190e2b41851732305ab28895">00314</a> void (*<a class="code" href="top_8c.html#ac5d8f583190e2b41851732305ab28895">pre_init_ui_hook</a>) (void);
<a name="l00315"></a>00315 
<a name="l00316"></a>00316 <span class="preprocessor">#ifdef __MSDOS__</span>
<a name="l00317"></a>00317 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00318"></a>00318 do_chdir_cleanup (<span class="keywordtype">void</span> *old_dir)
<a name="l00319"></a>00319 {
<a name="l00320"></a>00320   chdir (old_dir);
<a name="l00321"></a>00321   <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (old_dir);
<a name="l00322"></a>00322 }
<a name="l00323"></a>00323 <span class="preprocessor">#endif</span>
<a name="l00324"></a>00324 <span class="preprocessor"></span>
<a name="l00325"></a>00325 <span class="keyword">struct </span>cleanup *
<a name="l00326"></a><a class="code" href="top_8h.html#a86d6b8ddea84be908c7be8e56f5e5dcd">00326</a> <a class="code" href="top_8c.html#a86d6b8ddea84be908c7be8e56f5e5dcd">prepare_execute_command</a> (<span class="keywordtype">void</span>)
<a name="l00327"></a>00327 {
<a name="l00328"></a>00328   <span class="keyword">struct </span>value *mark;
<a name="l00329"></a>00329   <span class="keyword">struct </span>cleanup *cleanup;
<a name="l00330"></a>00330 
<a name="l00331"></a>00331   mark = <a class="code" href="value_8c.html#a427a12b0dd4d5663b103d29f07a0e1c6">value_mark</a> ();
<a name="l00332"></a>00332   cleanup = <a class="code" href="utils_8c.html#ad4e4e55026210da46efa0c6aaed74ba7">make_cleanup_value_free_to_mark</a> (mark);
<a name="l00333"></a>00333 
<a name="l00334"></a>00334   <span class="comment">/* With multiple threads running while the one we&#39;re examining is</span>
<a name="l00335"></a>00335 <span class="comment">     stopped, the dcache can get stale without us being able to detect</span>
<a name="l00336"></a>00336 <span class="comment">     it.  For the duration of the command, though, use the dcache to</span>
<a name="l00337"></a>00337 <span class="comment">     help things like backtrace.  */</span>
<a name="l00338"></a>00338   <span class="keywordflow">if</span> (<a class="code" href="inferior_8h.html#af01b8288bc30e83805793d6908408e81">non_stop</a>)
<a name="l00339"></a>00339     <a class="code" href="target_8c.html#a819a6668299ae51c85ee5971a480b410">target_dcache_invalidate</a> ();
<a name="l00340"></a>00340 
<a name="l00341"></a>00341   <span class="keywordflow">return</span> cleanup;
<a name="l00342"></a>00342 }
<a name="l00343"></a>00343 
<a name="l00344"></a>00344 <span class="comment">/* Tell the user if the language has changed (except first time) after</span>
<a name="l00345"></a>00345 <span class="comment">   executing a command.  */</span>
<a name="l00346"></a>00346 
<a name="l00347"></a>00347 <span class="keywordtype">void</span>
<a name="l00348"></a><a class="code" href="top_8h.html#ad91b696aa3c9831effde2eba2f8cb404">00348</a> <a class="code" href="top_8c.html#ad91b696aa3c9831effde2eba2f8cb404">check_frame_language_change</a> (<span class="keywordtype">void</span>)
<a name="l00349"></a>00349 {
<a name="l00350"></a>00350   <span class="keyword">static</span> <span class="keywordtype">int</span> warned = 0;
<a name="l00351"></a>00351 
<a name="l00352"></a>00352   <span class="comment">/* First make sure that a new frame has been selected, in case the</span>
<a name="l00353"></a>00353 <span class="comment">     command or the hooks changed the program state.  */</span>
<a name="l00354"></a>00354   <a class="code" href="frame_8c.html#aff8ce563cf529a6695bd2afc8b3d9833">deprecated_safe_get_selected_frame</a> ();
<a name="l00355"></a>00355   <span class="keywordflow">if</span> (<a class="code" href="language_8c.html#acd2505a014a95629da9c836f8914fc79">current_language</a> != <a class="code" href="language_8c.html#afaa4a80e24d6393a28de7669d28196c1">expected_language</a>)
<a name="l00356"></a>00356     {
<a name="l00357"></a>00357       <span class="keywordflow">if</span> (<a class="code" href="language_8h.html#ae32fb3eb29743dbdbc197316b4b83f4e">language_mode</a> == <a class="code" href="language_8h.html#ae32fb3eb29743dbdbc197316b4b83f4ea45a4096e956feff249efbb38f3be6c7e">language_mode_auto</a> &amp;&amp; <a class="code" href="defs_8h.html#a3f2f91ed92de5dfaa6d27fb82822f8d5">info_verbose</a>)
<a name="l00358"></a>00358         {
<a name="l00359"></a>00359           <a class="code" href="language_8c.html#a7c4e9fa40a927279a783c2f65a884f74">language_info</a> (1);    <span class="comment">/* Print what changed.  */</span>
<a name="l00360"></a>00360         }
<a name="l00361"></a>00361       warned = 0;
<a name="l00362"></a>00362     }
<a name="l00363"></a>00363 
<a name="l00364"></a>00364   <span class="comment">/* Warn the user if the working language does not match the language</span>
<a name="l00365"></a>00365 <span class="comment">     of the current frame.  Only warn the user if we are actually</span>
<a name="l00366"></a>00366 <span class="comment">     running the program, i.e. there is a stack.  */</span>
<a name="l00367"></a>00367   <span class="comment">/* FIXME: This should be cacheing the frame and only running when</span>
<a name="l00368"></a>00368 <span class="comment">     the frame changes.  */</span>
<a name="l00369"></a>00369 
<a name="l00370"></a>00370   <span class="keywordflow">if</span> (<a class="code" href="frame_8c.html#ad1e8bd5ac45df219a168640934f891cc">has_stack_frames</a> ())
<a name="l00371"></a>00371     {
<a name="l00372"></a>00372       <span class="keyword">enum</span> <a class="code" href="defs_8h.html#aa37aa8979934d47ac32fd96ecff32202">language</a> flang;
<a name="l00373"></a>00373 
<a name="l00374"></a>00374       flang = <a class="code" href="language_8h.html#a35b101ad261ed79c6c51d39f2da6c525">get_frame_language</a> ();
<a name="l00375"></a>00375       <span class="keywordflow">if</span> (!warned
<a name="l00376"></a>00376           &amp;&amp; flang != <a class="code" href="defs_8h.html#aa37aa8979934d47ac32fd96ecff32202a3082c2da456a8ca3aa34f721de2c3565">language_unknown</a>
<a name="l00377"></a>00377           &amp;&amp; flang != <a class="code" href="language_8c.html#acd2505a014a95629da9c836f8914fc79">current_language</a>-&gt;<a class="code" href="structlanguage__defn.html#a1395b7eb05a09e5798dc29257f30810a">la_language</a>)
<a name="l00378"></a>00378         {
<a name="l00379"></a>00379           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;%s\n&quot;</span>, <a class="code" href="language_8c.html#a860b8de5e12667342d4b88d199c81f64">lang_frame_mismatch_warn</a>);
<a name="l00380"></a>00380           warned = 1;
<a name="l00381"></a>00381         }
<a name="l00382"></a>00382     }
<a name="l00383"></a>00383 }
<a name="l00384"></a>00384 
<a name="l00385"></a>00385 <span class="comment">/* Execute the line P as a command, in the current user context.</span>
<a name="l00386"></a>00386 <span class="comment">   Pass FROM_TTY as second argument to the defining function.  */</span>
<a name="l00387"></a>00387 
<a name="l00388"></a>00388 <span class="keywordtype">void</span>
<a name="l00389"></a><a class="code" href="top_8h.html#ac4a1e7a1c71e9c45368a6c32bfe5637d">00389</a> <a class="code" href="gdbcmd_8h.html#ac4a1e7a1c71e9c45368a6c32bfe5637d">execute_command</a> (<span class="keywordtype">char</span> *p, <span class="keywordtype">int</span> from_tty)
<a name="l00390"></a>00390 {
<a name="l00391"></a>00391   <span class="keyword">struct </span>cleanup *cleanup_if_error, *cleanup;
<a name="l00392"></a>00392   <span class="keyword">struct </span><a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c;
<a name="l00393"></a>00393   <span class="keywordtype">char</span> *<a class="code" href="symtab_8h.html#a41ebd28ef1d7c6ade45642cb6acc1039">line</a>;
<a name="l00394"></a>00394 
<a name="l00395"></a>00395   cleanup_if_error = <a class="code" href="utils_8c.html#aa4e904b8234e16309bb0d5c411502125">make_bpstat_clear_actions_cleanup</a> ();
<a name="l00396"></a>00396   cleanup = <a class="code" href="top_8c.html#a86d6b8ddea84be908c7be8e56f5e5dcd">prepare_execute_command</a> ();
<a name="l00397"></a>00397 
<a name="l00398"></a>00398   <span class="comment">/* Force cleanup of any alloca areas if using C alloca instead of</span>
<a name="l00399"></a>00399 <span class="comment">     a builtin alloca.  */</span>
<a name="l00400"></a>00400   alloca (0);
<a name="l00401"></a>00401 
<a name="l00402"></a>00402   <span class="comment">/* This can happen when command_line_input hits end of file.  */</span>
<a name="l00403"></a>00403   <span class="keywordflow">if</span> (p == NULL)
<a name="l00404"></a>00404     {
<a name="l00405"></a>00405       <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup);
<a name="l00406"></a>00406       <a class="code" href="cleanups_8c.html#a5ec3987bf995edcc44def9e17ada6eba">discard_cleanups</a> (cleanup_if_error);
<a name="l00407"></a>00407       <span class="keywordflow">return</span>;
<a name="l00408"></a>00408     }
<a name="l00409"></a>00409 
<a name="l00410"></a>00410   <a class="code" href="target_8h.html#ab4547ca4a306cdcf484e863f56f8d210">target_log_command</a> (p);
<a name="l00411"></a>00411 
<a name="l00412"></a>00412   <span class="keywordflow">while</span> (*p == <span class="charliteral">&#39; &#39;</span> || *p == <span class="charliteral">&#39;\t&#39;</span>)
<a name="l00413"></a>00413     p++;
<a name="l00414"></a>00414   <span class="keywordflow">if</span> (*p)
<a name="l00415"></a>00415     {
<a name="l00416"></a>00416       <span class="keyword">const</span> <span class="keywordtype">char</span> *cmd = p;
<a name="l00417"></a>00417       <span class="keywordtype">char</span> *arg;
<a name="l00418"></a>00418       line = p;
<a name="l00419"></a>00419 
<a name="l00420"></a>00420       <span class="comment">/* If trace-commands is set then this will print this command.  */</span>
<a name="l00421"></a>00421       <a class="code" href="cli-script_8c.html#a85d6eb003c9663b8682fc3e8840deccd">print_command_trace</a> (p);
<a name="l00422"></a>00422 
<a name="l00423"></a>00423       c = <a class="code" href="cli-decode_8c.html#afbb3266bd92a5a8903072bb4e5f250cc">lookup_cmd</a> (&amp;cmd, <a class="code" href="cli-cmds_8c.html#a6b7ab0355d0fa8d6ce7d5feb83ff78e7">cmdlist</a>, <span class="stringliteral">&quot;&quot;</span>, 0, 1);
<a name="l00424"></a>00424       p = (<span class="keywordtype">char</span> *) cmd;
<a name="l00425"></a>00425 
<a name="l00426"></a>00426       <span class="comment">/* Pass null arg rather than an empty one.  */</span>
<a name="l00427"></a>00427       arg = *p ? p : 0;
<a name="l00428"></a>00428 
<a name="l00429"></a>00429       <span class="comment">/* FIXME: cagney/2002-02-02: The c-&gt;type test is pretty dodgy</span>
<a name="l00430"></a>00430 <span class="comment">         while the is_complete_command(cfunc) test is just plain</span>
<a name="l00431"></a>00431 <span class="comment">         bogus.  They should both be replaced by a test of the form</span>
<a name="l00432"></a>00432 <span class="comment">         c-&gt;strip_trailing_white_space_p.  */</span>
<a name="l00433"></a>00433       <span class="comment">/* NOTE: cagney/2002-02-02: The function.cfunc in the below</span>
<a name="l00434"></a>00434 <span class="comment">         can&#39;t be replaced with func.  This is because it is the</span>
<a name="l00435"></a>00435 <span class="comment">         cfunc, and not the func, that has the value that the</span>
<a name="l00436"></a>00436 <span class="comment">         is_complete_command hack is testing for.  */</span>
<a name="l00437"></a>00437       <span class="comment">/* Clear off trailing whitespace, except for set and complete</span>
<a name="l00438"></a>00438 <span class="comment">         command.  */</span>
<a name="l00439"></a>00439       <span class="keywordflow">if</span> (arg
<a name="l00440"></a>00440           &amp;&amp; c-&gt;<a class="code" href="structcmd__list__element.html#afee2d6ebe853b883eecf716d1a87381e">type</a> != <a class="code" href="command_8h.html#a627252e265c3f0ab2fb4080dd5137e52a9cd00a53341e1d6e0d6e43a4f1bb4eac">set_cmd</a>
<a name="l00441"></a>00441           &amp;&amp; !<a class="code" href="cli-cmds_8c.html#ac684d438020e69a21d4f1ddba3f03d19">is_complete_command</a> (c))
<a name="l00442"></a>00442         {
<a name="l00443"></a>00443           p = arg + strlen (arg) - 1;
<a name="l00444"></a>00444           <span class="keywordflow">while</span> (p &gt;= arg &amp;&amp; (*p == <span class="charliteral">&#39; &#39;</span> || *p == <span class="charliteral">&#39;\t&#39;</span>))
<a name="l00445"></a>00445             p--;
<a name="l00446"></a>00446           *(p + 1) = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00447"></a>00447         }
<a name="l00448"></a>00448 
<a name="l00449"></a>00449       <span class="comment">/* If this command has been pre-hooked, run the hook first.  */</span>
<a name="l00450"></a>00450       <a class="code" href="cli-script_8c.html#a7055e199adcc47795fb788b1ff0a835f">execute_cmd_pre_hook</a> (c);
<a name="l00451"></a>00451 
<a name="l00452"></a>00452       <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structcmd__list__element.html#aa246f17de0cd461401d6b6eb7afedc7b">flags</a> &amp; <a class="code" href="cli-decode_8h.html#a814019e09037f3ee3bba593d960de874">DEPRECATED_WARN_USER</a>)
<a name="l00453"></a>00453         <a class="code" href="cli-decode_8c.html#ad455a5de7c0fd7b056ef059596700216">deprecated_cmd_warning</a> (line);
<a name="l00454"></a>00454 
<a name="l00455"></a>00455       <span class="comment">/* c-&gt;user_commands would be NULL in the case of a python command.  */</span>
<a name="l00456"></a>00456       <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structcmd__list__element.html#a549b5f37ac0023fe6856e07454956c6f">class</a> == <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49a2ea4f42649176b0c0a3a76bec0d61555">class_user</a> &amp;&amp; c-&gt;<a class="code" href="structcmd__list__element.html#a61ae607841df24ea2109fab8f2c6b01f">user_commands</a>)
<a name="l00457"></a>00457         <a class="code" href="cli-script_8c.html#aaaf7d39b2bc8447a521b6e9f74fca85a">execute_user_command</a> (c, arg);
<a name="l00458"></a>00458       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structcmd__list__element.html#afee2d6ebe853b883eecf716d1a87381e">type</a> == <a class="code" href="command_8h.html#a627252e265c3f0ab2fb4080dd5137e52a9cd00a53341e1d6e0d6e43a4f1bb4eac">set_cmd</a>)
<a name="l00459"></a>00459         <a class="code" href="cli-setshow_8c.html#a086fbbaaf4d5ceae47b11deb859702f9">do_set_command</a> (arg, from_tty, c);
<a name="l00460"></a>00460       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c-&gt;<a class="code" href="structcmd__list__element.html#afee2d6ebe853b883eecf716d1a87381e">type</a> == <a class="code" href="command_8h.html#a627252e265c3f0ab2fb4080dd5137e52ae6dd89481cd86fccec446090004dd11b">show_cmd</a>)
<a name="l00461"></a>00461         <a class="code" href="cli-setshow_8c.html#af431dba357614c84535db5605a5cec45">do_show_command</a> (arg, from_tty, c);
<a name="l00462"></a>00462       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="cli-decode_8c.html#ad55f830bd2d31227c9aeb94b52dc6722">cmd_func_p</a> (c))
<a name="l00463"></a>00463         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;That is not a command, just a help topic.&quot;</span>));
<a name="l00464"></a>00464       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#ac0e4900322c7a985af27f65d1fba5cc2">deprecated_call_command_hook</a>)
<a name="l00465"></a>00465         <a class="code" href="defs_8h.html#ac0e4900322c7a985af27f65d1fba5cc2">deprecated_call_command_hook</a> (c, arg, from_tty);
<a name="l00466"></a>00466       <span class="keywordflow">else</span>
<a name="l00467"></a>00467         <a class="code" href="cli-decode_8c.html#a73ae96644dd22b7d4ae192f555d104ef">cmd_func</a> (c, arg, from_tty);
<a name="l00468"></a>00468 
<a name="l00469"></a>00469       <span class="comment">/* If the interpreter is in sync mode (we&#39;re running a user</span>
<a name="l00470"></a>00470 <span class="comment">         command&#39;s list, running command hooks or similars), and we</span>
<a name="l00471"></a>00471 <span class="comment">         just ran a synchronous command that started the target, wait</span>
<a name="l00472"></a>00472 <span class="comment">         for that command to end.  */</span>
<a name="l00473"></a>00473       <span class="keywordflow">if</span> (!<a class="code" href="interps_8c.html#a99d70e7e656d6a30bd5e813dbb4ea43a">interpreter_async</a> &amp;&amp; <a class="code" href="inferior_8h.html#a808bc634b7f69798d2c0c818b57c58f9">sync_execution</a>)
<a name="l00474"></a>00474         {
<a name="l00475"></a>00475           <span class="keywordflow">while</span> (<a class="code" href="event-loop_8c.html#a246ea7c47af8ab60c43fc19422438e9f">gdb_do_one_event</a> () &gt;= 0)
<a name="l00476"></a>00476             <span class="keywordflow">if</span> (!<a class="code" href="inferior_8h.html#a808bc634b7f69798d2c0c818b57c58f9">sync_execution</a>)
<a name="l00477"></a>00477               <span class="keywordflow">break</span>;
<a name="l00478"></a>00478         }
<a name="l00479"></a>00479 
<a name="l00480"></a>00480       <span class="comment">/* If this command has been post-hooked, run the hook last.  */</span>
<a name="l00481"></a>00481       <a class="code" href="cli-script_8c.html#aa4f27ddd57a5fe33013c69bd48b29c83">execute_cmd_post_hook</a> (c);
<a name="l00482"></a>00482 
<a name="l00483"></a>00483     }
<a name="l00484"></a>00484 
<a name="l00485"></a>00485   <a class="code" href="top_8c.html#ad91b696aa3c9831effde2eba2f8cb404">check_frame_language_change</a> ();
<a name="l00486"></a>00486 
<a name="l00487"></a>00487   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup);
<a name="l00488"></a>00488   <a class="code" href="cleanups_8c.html#a5ec3987bf995edcc44def9e17ada6eba">discard_cleanups</a> (cleanup_if_error);
<a name="l00489"></a>00489 }
<a name="l00490"></a>00490 
<a name="l00491"></a>00491 <span class="comment">/* Run execute_command for P and FROM_TTY.  Capture its output into the</span>
<a name="l00492"></a>00492 <span class="comment">   returned string, do not display it to the screen.  BATCH_FLAG will be</span>
<a name="l00493"></a>00493 <span class="comment">   temporarily set to true.  */</span>
<a name="l00494"></a>00494 
<a name="l00495"></a>00495 <span class="keywordtype">char</span> *
<a name="l00496"></a><a class="code" href="top_8c.html#a9815c7c24dd3c7983eb57283eb92572e">00496</a> <a class="code" href="gdbcmd_8h.html#a9815c7c24dd3c7983eb57283eb92572e">execute_command_to_string</a> (<span class="keywordtype">char</span> *p, <span class="keywordtype">int</span> from_tty)
<a name="l00497"></a>00497 {
<a name="l00498"></a>00498   <span class="keyword">struct </span>ui_file *str_file;
<a name="l00499"></a>00499   <span class="keyword">struct </span>cleanup *cleanup;
<a name="l00500"></a>00500   <span class="keywordtype">char</span> *retval;
<a name="l00501"></a>00501 
<a name="l00502"></a>00502   <span class="comment">/* GDB_STDOUT should be better already restored during these</span>
<a name="l00503"></a>00503 <span class="comment">     restoration callbacks.  */</span>
<a name="l00504"></a>00504   cleanup = <a class="code" href="utils_8c.html#a8371f8dfe1f91f128f870330f496071b">set_batch_flag_and_make_cleanup_restore_page_info</a> ();
<a name="l00505"></a>00505 
<a name="l00506"></a>00506   <a class="code" href="utils_8c.html#aa4b9e7f0b6abb5f93fc0ac366f7614c0">make_cleanup_restore_integer</a> (&amp;<a class="code" href="interps_8c.html#a99d70e7e656d6a30bd5e813dbb4ea43a">interpreter_async</a>);
<a name="l00507"></a>00507   <a class="code" href="interps_8c.html#a99d70e7e656d6a30bd5e813dbb4ea43a">interpreter_async</a> = 0;
<a name="l00508"></a>00508 
<a name="l00509"></a>00509   str_file = <a class="code" href="ui-file_8c.html#a340771735f105582d314e191a399a45c">mem_fileopen</a> ();
<a name="l00510"></a>00510 
<a name="l00511"></a>00511   <a class="code" href="utils_8c.html#a94dc56baeb57791e114136764f7763aa">make_cleanup_ui_file_delete</a> (str_file);
<a name="l00512"></a>00512   <a class="code" href="utils_8c.html#ac522aa7259fa00c324880dd1597f2a51">make_cleanup_restore_ui_file</a> (&amp;<a class="code" href="main_8c.html#a41a2b997ba5454df787d61f051dd918c">gdb_stdout</a>);
<a name="l00513"></a>00513   <a class="code" href="utils_8c.html#ac522aa7259fa00c324880dd1597f2a51">make_cleanup_restore_ui_file</a> (&amp;<a class="code" href="main_8c.html#a2a1dea1e551cadb9541353a004193a47">gdb_stderr</a>);
<a name="l00514"></a>00514   <a class="code" href="utils_8c.html#ac522aa7259fa00c324880dd1597f2a51">make_cleanup_restore_ui_file</a> (&amp;<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>);
<a name="l00515"></a>00515   <a class="code" href="utils_8c.html#ac522aa7259fa00c324880dd1597f2a51">make_cleanup_restore_ui_file</a> (&amp;<a class="code" href="main_8c.html#a88e32e1eabdc385541d2039cd1c80847">gdb_stdtarg</a>);
<a name="l00516"></a>00516   <a class="code" href="utils_8c.html#ac522aa7259fa00c324880dd1597f2a51">make_cleanup_restore_ui_file</a> (&amp;<a class="code" href="main_8c.html#a8ec7086f69c099528d82bd50a7329162">gdb_stdtargerr</a>);
<a name="l00517"></a>00517 
<a name="l00518"></a>00518   <span class="keywordflow">if</span> (<a class="code" href="ui-out_8c.html#a6ed7ee65c5533a37f6af18d8a689cd38">ui_out_redirect</a> (<a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>, str_file) &lt; 0)
<a name="l00519"></a>00519     <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Current output protocol does not support redirection&quot;</span>));
<a name="l00520"></a>00520   <span class="keywordflow">else</span>
<a name="l00521"></a>00521     <a class="code" href="utils_8c.html#a28ad2dfd153ebafa3ea39427dd6bec89">make_cleanup_ui_out_redirect_pop</a> (<a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>);
<a name="l00522"></a>00522 
<a name="l00523"></a>00523   <a class="code" href="main_8c.html#a41a2b997ba5454df787d61f051dd918c">gdb_stdout</a> = str_file;
<a name="l00524"></a>00524   <a class="code" href="main_8c.html#a2a1dea1e551cadb9541353a004193a47">gdb_stderr</a> = str_file;
<a name="l00525"></a>00525   <a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a> = str_file;
<a name="l00526"></a>00526   <a class="code" href="main_8c.html#a88e32e1eabdc385541d2039cd1c80847">gdb_stdtarg</a> = str_file;
<a name="l00527"></a>00527   <a class="code" href="main_8c.html#a8ec7086f69c099528d82bd50a7329162">gdb_stdtargerr</a> = str_file;
<a name="l00528"></a>00528 
<a name="l00529"></a>00529   <a class="code" href="gdbcmd_8h.html#ac4a1e7a1c71e9c45368a6c32bfe5637d">execute_command</a> (p, from_tty);
<a name="l00530"></a>00530 
<a name="l00531"></a>00531   retval = <a class="code" href="ui-file_8c.html#a995485039ce5a1d994a1863cd76a5356">ui_file_xstrdup</a> (str_file, NULL);
<a name="l00532"></a>00532 
<a name="l00533"></a>00533   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup);
<a name="l00534"></a>00534 
<a name="l00535"></a>00535   <span class="keywordflow">return</span> retval;
<a name="l00536"></a>00536 }
<a name="l00537"></a>00537 
<a name="l00538"></a>00538 <span class="comment">/* Read commands from `instream&#39; and execute them</span>
<a name="l00539"></a>00539 <span class="comment">   until end of file or error reading instream.  */</span>
<a name="l00540"></a>00540 
<a name="l00541"></a>00541 <span class="keywordtype">void</span>
<a name="l00542"></a><a class="code" href="top_8h.html#a7f8a2217b49b5ebd548a1713aeafa643">00542</a> <a class="code" href="top_8c.html#a7f8a2217b49b5ebd548a1713aeafa643">command_loop</a> (<span class="keywordtype">void</span>)
<a name="l00543"></a>00543 {
<a name="l00544"></a>00544   <span class="keyword">struct </span>cleanup *old_chain;
<a name="l00545"></a>00545   <span class="keywordtype">char</span> *command;
<a name="l00546"></a>00546   <span class="keywordtype">int</span> stdin_is_tty = ISATTY (stdin);
<a name="l00547"></a>00547 
<a name="l00548"></a>00548   <span class="keywordflow">while</span> (<a class="code" href="top_8c.html#a3291280191f8913361ed5602219b6022">instream</a> &amp;&amp; !feof (<a class="code" href="top_8c.html#a3291280191f8913361ed5602219b6022">instream</a>))
<a name="l00549"></a>00549     {
<a name="l00550"></a>00550       <span class="keywordflow">if</span> (<a class="code" href="top_8c.html#a24f0444e515470b9d477bc5d04379c99">window_hook</a> &amp;&amp; <a class="code" href="top_8c.html#a3291280191f8913361ed5602219b6022">instream</a> == stdin)
<a name="l00551"></a>00551         (*window_hook) (<a class="code" href="top_8c.html#a3291280191f8913361ed5602219b6022">instream</a>, <a class="code" href="top_8c.html#ab9a287aa65bc199ea4bf3b9b6d073e5a">get_prompt</a> ());
<a name="l00552"></a>00552 
<a name="l00553"></a>00553       <a class="code" href="defs_8h.html#a0ba19e7ccaf699d29ebe1c81e9601955">clear_quit_flag</a> ();
<a name="l00554"></a>00554       <span class="keywordflow">if</span> (instream == stdin &amp;&amp; stdin_is_tty)
<a name="l00555"></a>00555         <a class="code" href="utils_8c.html#a2f835956ba26653a2eb636e25cd9dfb9">reinitialize_more_filter</a> ();
<a name="l00556"></a>00556       old_chain = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="cleanups_8c.html#a1ec2a3980c2be1f31f2142103d1f7abf">null_cleanup</a>, 0);
<a name="l00557"></a>00557 
<a name="l00558"></a>00558       <span class="comment">/* Get a command-line.  This calls the readline package.  */</span>
<a name="l00559"></a>00559       command = <a class="code" href="defs_8h.html#a06b7acf2ace3fbf28f5873e57eb39376">command_line_input</a> (instream == stdin ?
<a name="l00560"></a>00560                                     <a class="code" href="top_8c.html#ab9a287aa65bc199ea4bf3b9b6d073e5a">get_prompt</a> () : (<span class="keywordtype">char</span> *) NULL,
<a name="l00561"></a>00561                                     instream == stdin, <span class="stringliteral">&quot;prompt&quot;</span>);
<a name="l00562"></a>00562       <span class="keywordflow">if</span> (command == 0)
<a name="l00563"></a>00563         {
<a name="l00564"></a>00564           <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l00565"></a>00565           <span class="keywordflow">return</span>;
<a name="l00566"></a>00566         }
<a name="l00567"></a>00567 
<a name="l00568"></a>00568       <a class="code" href="maint_8c.html#ad4a3c0ccb7295c8492ad5edb8aac7142">make_command_stats_cleanup</a> (1);
<a name="l00569"></a>00569 
<a name="l00570"></a>00570       <a class="code" href="gdbcmd_8h.html#ac4a1e7a1c71e9c45368a6c32bfe5637d">execute_command</a> (command, instream == stdin);
<a name="l00571"></a>00571 
<a name="l00572"></a>00572       <span class="comment">/* Do any commands attached to breakpoint we are stopped at.  */</span>
<a name="l00573"></a>00573       <a class="code" href="breakpoint_8c.html#a79945bcb0451d40f8a21f2d2c266e4d6">bpstat_do_actions</a> ();
<a name="l00574"></a>00574 
<a name="l00575"></a>00575       <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l00576"></a>00576     }
<a name="l00577"></a>00577 }
<a name="l00578"></a>00578 
<a name="l00579"></a>00579 <span class="comment">/* When nonzero, cause dont_repeat to do nothing.  This should only be</span>
<a name="l00580"></a>00580 <span class="comment">   set via prevent_dont_repeat.  */</span>
<a name="l00581"></a>00581 
<a name="l00582"></a>00582 <span class="keyword">static</span> <span class="keywordtype">int</span> suppress_dont_repeat = 0;
<a name="l00583"></a>00583 
<a name="l00584"></a>00584 <span class="comment">/* Commands call this if they do not want to be repeated by null lines.  */</span>
<a name="l00585"></a>00585 
<a name="l00586"></a>00586 <span class="keywordtype">void</span>
<a name="l00587"></a><a class="code" href="top_8c.html#ac7af34b03605d65b114a173d49532050">00587</a> <a class="code" href="command_8h.html#ac7af34b03605d65b114a173d49532050">dont_repeat</a> (<span class="keywordtype">void</span>)
<a name="l00588"></a>00588 {
<a name="l00589"></a>00589   <span class="keywordflow">if</span> (suppress_dont_repeat || <a class="code" href="top_8c.html#a696fc2ffc263949656d0a3d0e29c78b0">server_command</a>)
<a name="l00590"></a>00590     <span class="keywordflow">return</span>;
<a name="l00591"></a>00591 
<a name="l00592"></a>00592   <span class="comment">/* If we aren&#39;t reading from standard input, we are saving the last</span>
<a name="l00593"></a>00593 <span class="comment">     thing read from stdin in line and don&#39;t want to delete it.  Null</span>
<a name="l00594"></a>00594 <span class="comment">     lines won&#39;t repeat here in any case.  */</span>
<a name="l00595"></a>00595   <span class="keywordflow">if</span> (<a class="code" href="top_8c.html#a3291280191f8913361ed5602219b6022">instream</a> == stdin)
<a name="l00596"></a>00596     *<a class="code" href="top_8c.html#ac9aa2915d5f249ab83d3e0e511cca40a">saved_command_line</a> = 0;
<a name="l00597"></a>00597 }
<a name="l00598"></a>00598 
<a name="l00599"></a>00599 <span class="comment">/* Prevent dont_repeat from working, and return a cleanup that</span>
<a name="l00600"></a>00600 <span class="comment">   restores the previous state.  */</span>
<a name="l00601"></a>00601 
<a name="l00602"></a>00602 <span class="keyword">struct </span>cleanup *
<a name="l00603"></a><a class="code" href="top_8c.html#a19ab75cb50d31ff69c48c3e310a538be">00603</a> <a class="code" href="command_8h.html#a19ab75cb50d31ff69c48c3e310a538be">prevent_dont_repeat</a> (<span class="keywordtype">void</span>)
<a name="l00604"></a>00604 {
<a name="l00605"></a>00605   <span class="keyword">struct </span>cleanup *result = <a class="code" href="utils_8c.html#aa4b9e7f0b6abb5f93fc0ac366f7614c0">make_cleanup_restore_integer</a> (&amp;suppress_dont_repeat);
<a name="l00606"></a>00606 
<a name="l00607"></a>00607   suppress_dont_repeat = 1;
<a name="l00608"></a>00608   <span class="keywordflow">return</span> result;
<a name="l00609"></a>00609 }
<a name="l00610"></a>00610 
<a name="l00611"></a>00611 
<a name="l00612"></a>00612 <span class="comment">/* Read a line from the stream &quot;instream&quot; without command line editing.</span>
<a name="l00613"></a>00613 <span class="comment"></span>
<a name="l00614"></a>00614 <span class="comment">   It prints PROMPT_ARG once at the start.</span>
<a name="l00615"></a>00615 <span class="comment">   Action is compatible with &quot;readline&quot;, e.g. space for the result is</span>
<a name="l00616"></a>00616 <span class="comment">   malloc&#39;d and should be freed by the caller.</span>
<a name="l00617"></a>00617 <span class="comment"></span>
<a name="l00618"></a>00618 <span class="comment">   A NULL return means end of file.  */</span>
<a name="l00619"></a>00619 <span class="keywordtype">char</span> *
<a name="l00620"></a><a class="code" href="top_8c.html#a14e3af42273554b4f5eca13b314bf962">00620</a> <a class="code" href="defs_8h.html#a8d6575cb59e6302388ffe41cfa1420ac">gdb_readline</a> (<span class="keywordtype">char</span> *prompt_arg)
<a name="l00621"></a>00621 {
<a name="l00622"></a>00622   <span class="keywordtype">int</span> c;
<a name="l00623"></a>00623   <span class="keywordtype">char</span> *result;
<a name="l00624"></a>00624   <span class="keywordtype">int</span> input_index = 0;
<a name="l00625"></a>00625   <span class="keywordtype">int</span> result_size = 80;
<a name="l00626"></a>00626 
<a name="l00627"></a>00627   <span class="keywordflow">if</span> (prompt_arg)
<a name="l00628"></a>00628     {
<a name="l00629"></a>00629       <span class="comment">/* Don&#39;t use a _filtered function here.  It causes the assumed</span>
<a name="l00630"></a>00630 <span class="comment">         character position to be off, since the newline we read from</span>
<a name="l00631"></a>00631 <span class="comment">         the user is not accounted for.  */</span>
<a name="l00632"></a>00632       <a class="code" href="ui-file_8c.html#aae3b905f888b1dcdce586f77b9554153">fputs_unfiltered</a> (prompt_arg, <a class="code" href="main_8c.html#a41a2b997ba5454df787d61f051dd918c">gdb_stdout</a>);
<a name="l00633"></a>00633       <a class="code" href="ui-file_8c.html#a046f07b5ef1bcc35c28b4be983e39998">gdb_flush</a> (<a class="code" href="main_8c.html#a41a2b997ba5454df787d61f051dd918c">gdb_stdout</a>);
<a name="l00634"></a>00634     }
<a name="l00635"></a>00635 
<a name="l00636"></a>00636   result = (<span class="keywordtype">char</span> *) <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (result_size);
<a name="l00637"></a>00637 
<a name="l00638"></a>00638   <span class="keywordflow">while</span> (1)
<a name="l00639"></a>00639     {
<a name="l00640"></a>00640       <span class="comment">/* Read from stdin if we are executing a user defined command.</span>
<a name="l00641"></a>00641 <span class="comment">         This is the right thing for prompt_for_continue, at least.  */</span>
<a name="l00642"></a>00642       c = fgetc (<a class="code" href="top_8c.html#a3291280191f8913361ed5602219b6022">instream</a> ? <a class="code" href="top_8c.html#a3291280191f8913361ed5602219b6022">instream</a> : stdin);
<a name="l00643"></a>00643 
<a name="l00644"></a>00644       <span class="keywordflow">if</span> (c == EOF)
<a name="l00645"></a>00645         {
<a name="l00646"></a>00646           <span class="keywordflow">if</span> (input_index &gt; 0)
<a name="l00647"></a>00647             <span class="comment">/* The last line does not end with a newline.  Return it, and</span>
<a name="l00648"></a>00648 <span class="comment">               if we are called again fgetc will still return EOF and</span>
<a name="l00649"></a>00649 <span class="comment">               we&#39;ll return NULL then.  */</span>
<a name="l00650"></a>00650             <span class="keywordflow">break</span>;
<a name="l00651"></a>00651           <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (result);
<a name="l00652"></a>00652           <span class="keywordflow">return</span> NULL;
<a name="l00653"></a>00653         }
<a name="l00654"></a>00654 
<a name="l00655"></a>00655       <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;\n&#39;</span>)
<a name="l00656"></a>00656         {
<a name="l00657"></a>00657           <span class="keywordflow">if</span> (input_index &gt; 0 &amp;&amp; result[input_index - 1] == <span class="charliteral">&#39;\r&#39;</span>)
<a name="l00658"></a>00658             input_index--;
<a name="l00659"></a>00659           <span class="keywordflow">break</span>;
<a name="l00660"></a>00660         }
<a name="l00661"></a>00661 
<a name="l00662"></a>00662       result[input_index++] = c;
<a name="l00663"></a>00663       <span class="keywordflow">while</span> (input_index &gt;= result_size)
<a name="l00664"></a>00664         {
<a name="l00665"></a>00665           result_size *= 2;
<a name="l00666"></a>00666           result = (<span class="keywordtype">char</span> *) <a class="code" href="common-utils_8c.html#af404b7244f442ce8c3069f31af566eae">xrealloc</a> (result, result_size);
<a name="l00667"></a>00667         }
<a name="l00668"></a>00668     }
<a name="l00669"></a>00669 
<a name="l00670"></a>00670   result[input_index++] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00671"></a>00671   <span class="keywordflow">return</span> result;
<a name="l00672"></a>00672 }
<a name="l00673"></a>00673 
<a name="l00674"></a>00674 <span class="comment">/* Variables which control command line editing and history</span>
<a name="l00675"></a>00675 <span class="comment">   substitution.  These variables are given default values at the end</span>
<a name="l00676"></a>00676 <span class="comment">   of this file.  */</span>
<a name="l00677"></a>00677 <span class="keyword">static</span> <span class="keywordtype">int</span> command_editing_p;
<a name="l00678"></a>00678 
<a name="l00679"></a>00679 <span class="comment">/* NOTE 1999-04-29: This variable will be static again, once we modify</span>
<a name="l00680"></a>00680 <span class="comment">   gdb to use the event loop as the default command loop and we merge</span>
<a name="l00681"></a>00681 <span class="comment">   event-top.c into this file, top.c.  */</span>
<a name="l00682"></a>00682 
<a name="l00683"></a><a class="code" href="top_8h.html#a4fe3fae8c9591bca07f4dfc12f02212f">00683</a> <span class="comment">/* static */</span> <span class="keywordtype">int</span> <a class="code" href="top_8c.html#a4fe3fae8c9591bca07f4dfc12f02212f">history_expansion_p</a>;
<a name="l00684"></a>00684 
<a name="l00685"></a>00685 <span class="keyword">static</span> <span class="keywordtype">int</span> write_history_p;
<a name="l00686"></a>00686 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00687"></a>00687 show_write_history_p (<span class="keyword">struct</span> ui_file *file, <span class="keywordtype">int</span> from_tty,
<a name="l00688"></a>00688                       <span class="keyword">struct</span> <a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *value)
<a name="l00689"></a>00689 {
<a name="l00690"></a>00690   <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (file, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Saving of the history record on exit is %s.\n&quot;</span>),
<a name="l00691"></a>00691                     value);
<a name="l00692"></a>00692 }
<a name="l00693"></a>00693 
<a name="l00694"></a>00694 <span class="comment">/* The variable associated with the &quot;set/show history size&quot;</span>
<a name="l00695"></a>00695 <span class="comment">   command.  */</span>
<a name="l00696"></a>00696 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> history_size_setshow_var;
<a name="l00697"></a>00697 
<a name="l00698"></a>00698 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00699"></a>00699 show_history_size (<span class="keyword">struct</span> ui_file *file, <span class="keywordtype">int</span> from_tty,
<a name="l00700"></a>00700                    <span class="keyword">struct</span> <a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *value)
<a name="l00701"></a>00701 {
<a name="l00702"></a>00702   <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (file, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;The size of the command history is %s.\n&quot;</span>),
<a name="l00703"></a>00703                     value);
<a name="l00704"></a>00704 }
<a name="l00705"></a>00705 
<a name="l00706"></a>00706 <span class="keyword">static</span> <span class="keywordtype">char</span> *history_filename;
<a name="l00707"></a>00707 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00708"></a>00708 show_history_filename (<span class="keyword">struct</span> ui_file *file, <span class="keywordtype">int</span> from_tty,
<a name="l00709"></a>00709                        <span class="keyword">struct</span> <a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *value)
<a name="l00710"></a>00710 {
<a name="l00711"></a>00711   <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (file, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;The filename in which to record &quot;</span>
<a name="l00712"></a>00712                             <span class="stringliteral">&quot;the command history is \&quot;%s\&quot;.\n&quot;</span>),
<a name="l00713"></a>00713                     value);
<a name="l00714"></a>00714 }
<a name="l00715"></a>00715 
<a name="l00716"></a>00716 <span class="comment">/* This is like readline(), but it has some gdb-specific behavior.</span>
<a name="l00717"></a>00717 <span class="comment">   gdb may want readline in both the synchronous and async modes during</span>
<a name="l00718"></a>00718 <span class="comment">   a single gdb invocation.  At the ordinary top-level prompt we might</span>
<a name="l00719"></a>00719 <span class="comment">   be using the async readline.  That means we can&#39;t use</span>
<a name="l00720"></a>00720 <span class="comment">   rl_pre_input_hook, since it doesn&#39;t work properly in async mode.</span>
<a name="l00721"></a>00721 <span class="comment">   However, for a secondary prompt (&quot; &gt;&quot;, such as occurs during a</span>
<a name="l00722"></a>00722 <span class="comment">   `define&#39;), gdb wants a synchronous response.</span>
<a name="l00723"></a>00723 <span class="comment"></span>
<a name="l00724"></a>00724 <span class="comment">   We used to call readline() directly, running it in synchronous</span>
<a name="l00725"></a>00725 <span class="comment">   mode.  But mixing modes this way is not supported, and as of</span>
<a name="l00726"></a>00726 <span class="comment">   readline 5.x it no longer works; the arrow keys come unbound during</span>
<a name="l00727"></a>00727 <span class="comment">   the synchronous call.  So we make a nested call into the event</span>
<a name="l00728"></a>00728 <span class="comment">   loop.  That&#39;s what gdb_readline_wrapper is for.  */</span>
<a name="l00729"></a>00729 
<a name="l00730"></a>00730 <span class="comment">/* A flag set as soon as gdb_readline_wrapper_line is called; we can&#39;t</span>
<a name="l00731"></a>00731 <span class="comment">   rely on gdb_readline_wrapper_result, which might still be NULL if</span>
<a name="l00732"></a>00732 <span class="comment">   the user types Control-D for EOF.  */</span>
<a name="l00733"></a>00733 <span class="keyword">static</span> <span class="keywordtype">int</span> gdb_readline_wrapper_done;
<a name="l00734"></a>00734 
<a name="l00735"></a>00735 <span class="comment">/* The result of the current call to gdb_readline_wrapper, once a newline</span>
<a name="l00736"></a>00736 <span class="comment">   is seen.  */</span>
<a name="l00737"></a>00737 <span class="keyword">static</span> <span class="keywordtype">char</span> *gdb_readline_wrapper_result;
<a name="l00738"></a>00738 
<a name="l00739"></a>00739 <span class="comment">/* Any intercepted hook.  Operate-and-get-next sets this, expecting it</span>
<a name="l00740"></a>00740 <span class="comment">   to be called after the newline is processed (which will redisplay</span>
<a name="l00741"></a>00741 <span class="comment">   the prompt).  But in gdb_readline_wrapper we will not get a new</span>
<a name="l00742"></a>00742 <span class="comment">   prompt until the next call, or until we return to the event loop.</span>
<a name="l00743"></a>00743 <span class="comment">   So we disable this hook around the newline and restore it before we</span>
<a name="l00744"></a>00744 <span class="comment">   return.  */</span>
<a name="l00745"></a>00745 <span class="keyword">static</span> void (*saved_after_char_processing_hook) (void);
<a name="l00746"></a>00746 
<a name="l00747"></a>00747 <span class="comment">/* This function is called when readline has seen a complete line of</span>
<a name="l00748"></a>00748 <span class="comment">   text.  */</span>
<a name="l00749"></a>00749 
<a name="l00750"></a>00750 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00751"></a>00751 gdb_readline_wrapper_line (<span class="keywordtype">char</span> *<a class="code" href="symtab_8h.html#a41ebd28ef1d7c6ade45642cb6acc1039">line</a>)
<a name="l00752"></a>00752 {
<a name="l00753"></a>00753   <a class="code" href="gdb__assert_8h.html#aeb007d3e990858c7ef8e40a7e512c1ff">gdb_assert</a> (!gdb_readline_wrapper_done);
<a name="l00754"></a>00754   gdb_readline_wrapper_result = <a class="code" href="symtab_8h.html#a41ebd28ef1d7c6ade45642cb6acc1039">line</a>;
<a name="l00755"></a>00755   gdb_readline_wrapper_done = 1;
<a name="l00756"></a>00756 
<a name="l00757"></a>00757   <span class="comment">/* Prevent operate-and-get-next from acting too early.  */</span>
<a name="l00758"></a>00758   saved_after_char_processing_hook = <a class="code" href="event-top_8c.html#a71cfff4258a8c505a885fa62da662976">after_char_processing_hook</a>;
<a name="l00759"></a>00759   <a class="code" href="event-top_8c.html#a71cfff4258a8c505a885fa62da662976">after_char_processing_hook</a> = NULL;
<a name="l00760"></a>00760 
<a name="l00761"></a>00761   <span class="comment">/* Prevent parts of the prompt from being redisplayed if annotations</span>
<a name="l00762"></a>00762 <span class="comment">     are enabled, and readline&#39;s state getting out of sync.  */</span>
<a name="l00763"></a>00763   <span class="keywordflow">if</span> (<a class="code" href="event-top_8c.html#a0c25d96db6170286380cc620a381403e">async_command_editing_p</a>)
<a name="l00764"></a>00764     rl_callback_handler_remove ();
<a name="l00765"></a>00765 }
<a name="l00766"></a>00766 
<a name="l00767"></a>00767 <span class="keyword">struct </span>gdb_readline_wrapper_cleanup
<a name="l00768"></a>00768   {
<a name="l00769"></a>00769     void (*handler_orig) (<span class="keywordtype">char</span> *);
<a name="l00770"></a>00770     <span class="keywordtype">int</span> already_prompted_orig;
<a name="l00771"></a>00771   };
<a name="l00772"></a>00772 
<a name="l00773"></a>00773 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00774"></a>00774 gdb_readline_wrapper_cleanup (<span class="keywordtype">void</span> *arg)
<a name="l00775"></a>00775 {
<a name="l00776"></a>00776   <span class="keyword">struct </span>gdb_readline_wrapper_cleanup *cleanup = arg;
<a name="l00777"></a>00777 
<a name="l00778"></a>00778   rl_already_prompted = cleanup-&gt;already_prompted_orig;
<a name="l00779"></a>00779 
<a name="l00780"></a>00780   <a class="code" href="gdb__assert_8h.html#aeb007d3e990858c7ef8e40a7e512c1ff">gdb_assert</a> (<a class="code" href="event-top_8c.html#a8c55795caa665bb372a77f3f8ad79624">input_handler</a> == gdb_readline_wrapper_line);
<a name="l00781"></a>00781   <a class="code" href="event-top_8c.html#a8c55795caa665bb372a77f3f8ad79624">input_handler</a> = cleanup-&gt;handler_orig;
<a name="l00782"></a>00782   gdb_readline_wrapper_result = NULL;
<a name="l00783"></a>00783   gdb_readline_wrapper_done = 0;
<a name="l00784"></a>00784 
<a name="l00785"></a>00785   <a class="code" href="event-top_8c.html#a71cfff4258a8c505a885fa62da662976">after_char_processing_hook</a> = saved_after_char_processing_hook;
<a name="l00786"></a>00786   saved_after_char_processing_hook = NULL;
<a name="l00787"></a>00787 
<a name="l00788"></a>00788   <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (cleanup);
<a name="l00789"></a>00789 }
<a name="l00790"></a>00790 
<a name="l00791"></a>00791 <span class="keywordtype">char</span> *
<a name="l00792"></a><a class="code" href="top_8c.html#a47add920c8c5cb25f78bb5eec49025dc">00792</a> <a class="code" href="defs_8h.html#a3e5553c4cc2ea283ba136a4302e74d38">gdb_readline_wrapper</a> (<span class="keywordtype">char</span> *prompt)
<a name="l00793"></a>00793 {
<a name="l00794"></a>00794   <span class="keyword">struct </span>cleanup *back_to;
<a name="l00795"></a>00795   <span class="keyword">struct </span>gdb_readline_wrapper_cleanup *cleanup;
<a name="l00796"></a>00796   <span class="keywordtype">char</span> *retval;
<a name="l00797"></a>00797 
<a name="l00798"></a>00798   cleanup = <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (<span class="keyword">sizeof</span> (*cleanup));
<a name="l00799"></a>00799   cleanup-&gt;handler_orig = <a class="code" href="event-top_8c.html#a8c55795caa665bb372a77f3f8ad79624">input_handler</a>;
<a name="l00800"></a>00800   <a class="code" href="event-top_8c.html#a8c55795caa665bb372a77f3f8ad79624">input_handler</a> = gdb_readline_wrapper_line;
<a name="l00801"></a>00801 
<a name="l00802"></a>00802   cleanup-&gt;already_prompted_orig = rl_already_prompted;
<a name="l00803"></a>00803 
<a name="l00804"></a>00804   back_to = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (gdb_readline_wrapper_cleanup, cleanup);
<a name="l00805"></a>00805 
<a name="l00806"></a>00806   <span class="comment">/* Display our prompt and prevent double prompt display.  */</span>
<a name="l00807"></a>00807   <a class="code" href="event-top_8c.html#a8f178d598b6efab0c42649e5520df023">display_gdb_prompt</a> (prompt);
<a name="l00808"></a>00808   rl_already_prompted = 1;
<a name="l00809"></a>00809 
<a name="l00810"></a>00810   <span class="keywordflow">if</span> (<a class="code" href="event-top_8c.html#a71cfff4258a8c505a885fa62da662976">after_char_processing_hook</a>)
<a name="l00811"></a>00811     (*after_char_processing_hook) ();
<a name="l00812"></a>00812   <a class="code" href="gdb__assert_8h.html#aeb007d3e990858c7ef8e40a7e512c1ff">gdb_assert</a> (<a class="code" href="event-top_8c.html#a71cfff4258a8c505a885fa62da662976">after_char_processing_hook</a> == NULL);
<a name="l00813"></a>00813 
<a name="l00814"></a>00814   <span class="keywordflow">while</span> (<a class="code" href="event-loop_8c.html#a246ea7c47af8ab60c43fc19422438e9f">gdb_do_one_event</a> () &gt;= 0)
<a name="l00815"></a>00815     <span class="keywordflow">if</span> (gdb_readline_wrapper_done)
<a name="l00816"></a>00816       <span class="keywordflow">break</span>;
<a name="l00817"></a>00817 
<a name="l00818"></a>00818   retval = gdb_readline_wrapper_result;
<a name="l00819"></a>00819   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (back_to);
<a name="l00820"></a>00820   <span class="keywordflow">return</span> retval;
<a name="l00821"></a>00821 }
<a name="l00822"></a>00822 
<a name="l00823"></a>00823 
<a name="l00824"></a>00824 <span class="comment">/* The current saved history number from operate-and-get-next.</span>
<a name="l00825"></a>00825 <span class="comment">   This is -1 if not valid.  */</span>
<a name="l00826"></a>00826 <span class="keyword">static</span> <span class="keywordtype">int</span> operate_saved_history = -1;
<a name="l00827"></a>00827 
<a name="l00828"></a>00828 <span class="comment">/* This is put on the appropriate hook and helps operate-and-get-next</span>
<a name="l00829"></a>00829 <span class="comment">   do its work.  */</span>
<a name="l00830"></a>00830 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00831"></a>00831 gdb_rl_operate_and_get_next_completion (<span class="keywordtype">void</span>)
<a name="l00832"></a>00832 {
<a name="l00833"></a>00833   <span class="keywordtype">int</span> delta = where_history () - operate_saved_history;
<a name="l00834"></a>00834 
<a name="l00835"></a>00835   <span class="comment">/* The `key&#39; argument to rl_get_previous_history is ignored.  */</span>
<a name="l00836"></a>00836   rl_get_previous_history (delta, 0);
<a name="l00837"></a>00837   operate_saved_history = -1;
<a name="l00838"></a>00838 
<a name="l00839"></a>00839   <span class="comment">/* readline doesn&#39;t automatically update the display for us.  */</span>
<a name="l00840"></a>00840   rl_redisplay ();
<a name="l00841"></a>00841 
<a name="l00842"></a>00842   <a class="code" href="event-top_8c.html#a71cfff4258a8c505a885fa62da662976">after_char_processing_hook</a> = NULL;
<a name="l00843"></a>00843   rl_pre_input_hook = NULL;
<a name="l00844"></a>00844 }
<a name="l00845"></a>00845 
<a name="l00846"></a>00846 <span class="comment">/* This is a gdb-local readline command handler.  It accepts the</span>
<a name="l00847"></a>00847 <span class="comment">   current command line (like RET does) and, if this command was taken</span>
<a name="l00848"></a>00848 <span class="comment">   from the history, arranges for the next command in the history to</span>
<a name="l00849"></a>00849 <span class="comment">   appear on the command line when the prompt returns.</span>
<a name="l00850"></a>00850 <span class="comment">   We ignore the arguments.  */</span>
<a name="l00851"></a>00851 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00852"></a>00852 gdb_rl_operate_and_get_next (<span class="keywordtype">int</span> count, <span class="keywordtype">int</span> key)
<a name="l00853"></a>00853 {
<a name="l00854"></a>00854   <span class="keywordtype">int</span> where;
<a name="l00855"></a>00855 
<a name="l00856"></a>00856   <span class="comment">/* Use the async hook.  */</span>
<a name="l00857"></a>00857   <a class="code" href="event-top_8c.html#a71cfff4258a8c505a885fa62da662976">after_char_processing_hook</a> = gdb_rl_operate_and_get_next_completion;
<a name="l00858"></a>00858 
<a name="l00859"></a>00859   <span class="comment">/* Find the current line, and find the next line to use.  */</span>
<a name="l00860"></a>00860   where = where_history();
<a name="l00861"></a>00861 
<a name="l00862"></a>00862   <span class="keywordflow">if</span> ((history_is_stifled () &amp;&amp; (history_length &gt;= history_max_entries))
<a name="l00863"></a>00863       || (where &gt;= history_length - 1))
<a name="l00864"></a>00864     operate_saved_history = where;
<a name="l00865"></a>00865   <span class="keywordflow">else</span>
<a name="l00866"></a>00866     operate_saved_history = where + 1;
<a name="l00867"></a>00867 
<a name="l00868"></a>00868   <span class="keywordflow">return</span> rl_newline (1, key);
<a name="l00869"></a>00869 }
<a name="l00870"></a>00870 
<a name="l00871"></a>00871 <span class="comment">/* Read one line from the command input stream `instream&#39;</span>
<a name="l00872"></a>00872 <span class="comment">   into the local static buffer `linebuffer&#39; (whose current length</span>
<a name="l00873"></a>00873 <span class="comment">   is `linelength&#39;).</span>
<a name="l00874"></a>00874 <span class="comment">   The buffer is made bigger as necessary.</span>
<a name="l00875"></a>00875 <span class="comment">   Returns the address of the start of the line.</span>
<a name="l00876"></a>00876 <span class="comment"></span>
<a name="l00877"></a>00877 <span class="comment">   NULL is returned for end of file.</span>
<a name="l00878"></a>00878 <span class="comment"></span>
<a name="l00879"></a>00879 <span class="comment">   *If* the instream == stdin &amp; stdin is a terminal, the line read</span>
<a name="l00880"></a>00880 <span class="comment">   is copied into the file line saver (global var char *line,</span>
<a name="l00881"></a>00881 <span class="comment">   length linesize) so that it can be duplicated.</span>
<a name="l00882"></a>00882 <span class="comment"></span>
<a name="l00883"></a>00883 <span class="comment">   This routine either uses fancy command line editing or</span>
<a name="l00884"></a>00884 <span class="comment">   simple input as the user has requested.  */</span>
<a name="l00885"></a>00885 
<a name="l00886"></a>00886 <span class="keywordtype">char</span> *
<a name="l00887"></a><a class="code" href="top_8c.html#a7c58926cce16187284c6ddfa18fc01ed">00887</a> <a class="code" href="defs_8h.html#a06b7acf2ace3fbf28f5873e57eb39376">command_line_input</a> (<span class="keywordtype">char</span> *prompt_arg, <span class="keywordtype">int</span> repeat, <span class="keywordtype">char</span> *annotation_suffix)
<a name="l00888"></a>00888 {
<a name="l00889"></a>00889   <span class="keyword">static</span> <span class="keywordtype">char</span> *linebuffer = 0;
<a name="l00890"></a>00890   <span class="keyword">static</span> <span class="keywordtype">unsigned</span> linelength = 0;
<a name="l00891"></a>00891   <span class="keywordtype">char</span> *<a class="code" href="windows-nat_8c.html#ade66e4ccafbc33b117610bbc0d85feb0">p</a>;
<a name="l00892"></a>00892   <span class="keywordtype">char</span> *p1;
<a name="l00893"></a>00893   <span class="keywordtype">char</span> *rl;
<a name="l00894"></a>00894   <span class="keywordtype">char</span> *local_prompt = prompt_arg;
<a name="l00895"></a>00895   <span class="keywordtype">char</span> *nline;
<a name="l00896"></a>00896   <span class="keywordtype">char</span> got_eof = 0;
<a name="l00897"></a>00897 
<a name="l00898"></a>00898   <span class="comment">/* The annotation suffix must be non-NULL.  */</span>
<a name="l00899"></a>00899   <span class="keywordflow">if</span> (annotation_suffix == NULL)
<a name="l00900"></a>00900     annotation_suffix = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00901"></a>00901 
<a name="l00902"></a>00902   <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a8936079e8ffb68b6dec711d3b35133ca">annotation_level</a> &gt; 1 &amp;&amp; <a class="code" href="top_8c.html#a3291280191f8913361ed5602219b6022">instream</a> == stdin)
<a name="l00903"></a>00903     {
<a name="l00904"></a>00904       local_prompt = alloca ((prompt_arg == NULL ? 0 : strlen (prompt_arg))
<a name="l00905"></a>00905                              + strlen (annotation_suffix) + 40);
<a name="l00906"></a>00906       <span class="keywordflow">if</span> (prompt_arg == NULL)
<a name="l00907"></a>00907         local_prompt[0] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00908"></a>00908       <span class="keywordflow">else</span>
<a name="l00909"></a>00909         strcpy (local_prompt, prompt_arg);
<a name="l00910"></a>00910       strcat (local_prompt, <span class="stringliteral">&quot;\n\032\032&quot;</span>);
<a name="l00911"></a>00911       strcat (local_prompt, annotation_suffix);
<a name="l00912"></a>00912       strcat (local_prompt, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00913"></a>00913     }
<a name="l00914"></a>00914 
<a name="l00915"></a>00915   <span class="keywordflow">if</span> (linebuffer == 0)
<a name="l00916"></a>00916     {
<a name="l00917"></a>00917       linelength = 80;
<a name="l00918"></a>00918       linebuffer = (<span class="keywordtype">char</span> *) <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (linelength);
<a name="l00919"></a>00919     }
<a name="l00920"></a>00920 
<a name="l00921"></a>00921   p = linebuffer;
<a name="l00922"></a>00922 
<a name="l00923"></a>00923   <span class="comment">/* Control-C quits instantly if typed while in this loop</span>
<a name="l00924"></a>00924 <span class="comment">     since it should not wait until the user types a newline.  */</span>
<a name="l00925"></a>00925   <a class="code" href="defs_8h.html#a80120f85b8df679793e5269f447429c1">immediate_quit</a>++;
<a name="l00926"></a>00926   <a class="code" href="defs_8h.html#ad24e2b54375e12474e65ebf7175988fb">QUIT</a>;
<a name="l00927"></a>00927 <span class="preprocessor">#ifdef STOP_SIGNAL</span>
<a name="l00928"></a>00928 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="code" href="terminal_8h.html#a3002cbcd4a652dec2c5cef5ff3da446f">job_control</a>)
<a name="l00929"></a>00929     signal (STOP_SIGNAL, handle_stop_sig);
<a name="l00930"></a>00930 <span class="preprocessor">#endif</span>
<a name="l00931"></a>00931 <span class="preprocessor"></span>
<a name="l00932"></a>00932   <span class="keywordflow">while</span> (1)
<a name="l00933"></a>00933     {
<a name="l00934"></a>00934       <span class="comment">/* Make sure that all output has been output.  Some machines may</span>
<a name="l00935"></a>00935 <span class="comment">         let you get away with leaving out some of the gdb_flush, but</span>
<a name="l00936"></a>00936 <span class="comment">         not all.  */</span>
<a name="l00937"></a>00937       <a class="code" href="utils_8c.html#a857540a17ef1cd62fef4a33cc3b6a894">wrap_here</a> (<span class="stringliteral">&quot;&quot;</span>);
<a name="l00938"></a>00938       <a class="code" href="ui-file_8c.html#a046f07b5ef1bcc35c28b4be983e39998">gdb_flush</a> (<a class="code" href="main_8c.html#a41a2b997ba5454df787d61f051dd918c">gdb_stdout</a>);
<a name="l00939"></a>00939       <a class="code" href="ui-file_8c.html#a046f07b5ef1bcc35c28b4be983e39998">gdb_flush</a> (<a class="code" href="main_8c.html#a2a1dea1e551cadb9541353a004193a47">gdb_stderr</a>);
<a name="l00940"></a>00940 
<a name="l00941"></a>00941       <span class="keywordflow">if</span> (<a class="code" href="top_8c.html#a71a2c53bb82071ba9049777b1388cd4b">source_file_name</a> != NULL)
<a name="l00942"></a>00942         ++<a class="code" href="top_8c.html#a2faf304519ad947de2587843911e7fc2">source_line_number</a>;
<a name="l00943"></a>00943 
<a name="l00944"></a>00944       <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a8936079e8ffb68b6dec711d3b35133ca">annotation_level</a> &gt; 1 &amp;&amp; <a class="code" href="top_8c.html#a3291280191f8913361ed5602219b6022">instream</a> == stdin)
<a name="l00945"></a>00945         {
<a name="l00946"></a>00946           <a class="code" href="utils_8c.html#ae26e1e0ee2955f76539564ed45a40f9f">puts_unfiltered</a> (<span class="stringliteral">&quot;\n\032\032pre-&quot;</span>);
<a name="l00947"></a>00947           <a class="code" href="utils_8c.html#ae26e1e0ee2955f76539564ed45a40f9f">puts_unfiltered</a> (annotation_suffix);
<a name="l00948"></a>00948           <a class="code" href="utils_8c.html#ae26e1e0ee2955f76539564ed45a40f9f">puts_unfiltered</a> (<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00949"></a>00949         }
<a name="l00950"></a>00950 
<a name="l00951"></a>00951       <span class="comment">/* Don&#39;t use fancy stuff if not talking to stdin.  */</span>
<a name="l00952"></a>00952       <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a242bdd617db5ca704c67dfb91d6f1ea6">deprecated_readline_hook</a> &amp;&amp; <a class="code" href="defs_8h.html#ade104a4a98c8c4ab016f4b5a72d91dc3">input_from_terminal_p</a> ())
<a name="l00953"></a>00953         {
<a name="l00954"></a>00954           rl = (*deprecated_readline_hook) (local_prompt);
<a name="l00955"></a>00955         }
<a name="l00956"></a>00956       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command_editing_p &amp;&amp; <a class="code" href="defs_8h.html#ade104a4a98c8c4ab016f4b5a72d91dc3">input_from_terminal_p</a> ())
<a name="l00957"></a>00957         {
<a name="l00958"></a>00958           rl = <a class="code" href="defs_8h.html#a3e5553c4cc2ea283ba136a4302e74d38">gdb_readline_wrapper</a> (local_prompt);
<a name="l00959"></a>00959         }
<a name="l00960"></a>00960       <span class="keywordflow">else</span>
<a name="l00961"></a>00961         {
<a name="l00962"></a>00962           rl = <a class="code" href="defs_8h.html#a8d6575cb59e6302388ffe41cfa1420ac">gdb_readline</a> (local_prompt);
<a name="l00963"></a>00963         }
<a name="l00964"></a>00964 
<a name="l00965"></a>00965       <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a8936079e8ffb68b6dec711d3b35133ca">annotation_level</a> &gt; 1 &amp;&amp; <a class="code" href="top_8c.html#a3291280191f8913361ed5602219b6022">instream</a> == stdin)
<a name="l00966"></a>00966         {
<a name="l00967"></a>00967           <a class="code" href="utils_8c.html#ae26e1e0ee2955f76539564ed45a40f9f">puts_unfiltered</a> (<span class="stringliteral">&quot;\n\032\032post-&quot;</span>);
<a name="l00968"></a>00968           <a class="code" href="utils_8c.html#ae26e1e0ee2955f76539564ed45a40f9f">puts_unfiltered</a> (annotation_suffix);
<a name="l00969"></a>00969           <a class="code" href="utils_8c.html#ae26e1e0ee2955f76539564ed45a40f9f">puts_unfiltered</a> (<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00970"></a>00970         }
<a name="l00971"></a>00971 
<a name="l00972"></a>00972       <span class="keywordflow">if</span> (!rl || rl == (<span class="keywordtype">char</span> *) EOF)
<a name="l00973"></a>00973         {
<a name="l00974"></a>00974           got_eof = 1;
<a name="l00975"></a>00975           <span class="keywordflow">break</span>;
<a name="l00976"></a>00976         }
<a name="l00977"></a>00977       <span class="keywordflow">if</span> (strlen (rl) + 1 + (p - linebuffer) &gt; linelength)
<a name="l00978"></a>00978         {
<a name="l00979"></a>00979           linelength = strlen (rl) + 1 + (p - linebuffer);
<a name="l00980"></a>00980           nline = (<span class="keywordtype">char</span> *) <a class="code" href="common-utils_8c.html#af404b7244f442ce8c3069f31af566eae">xrealloc</a> (linebuffer, linelength);
<a name="l00981"></a>00981           p += nline - linebuffer;
<a name="l00982"></a>00982           linebuffer = nline;
<a name="l00983"></a>00983         }
<a name="l00984"></a>00984       p1 = rl;
<a name="l00985"></a>00985       <span class="comment">/* Copy line.  Don&#39;t copy null at end.  (Leaves line alone</span>
<a name="l00986"></a>00986 <span class="comment">         if this was just a newline).  */</span>
<a name="l00987"></a>00987       <span class="keywordflow">while</span> (*p1)
<a name="l00988"></a>00988         *p++ = *p1++;
<a name="l00989"></a>00989 
<a name="l00990"></a>00990       <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (rl);               <span class="comment">/* Allocated in readline.  */</span>
<a name="l00991"></a>00991 
<a name="l00992"></a>00992       <span class="keywordflow">if</span> (p == linebuffer || *(p - 1) != <span class="charliteral">&#39;\\&#39;</span>)
<a name="l00993"></a>00993         <span class="keywordflow">break</span>;
<a name="l00994"></a>00994 
<a name="l00995"></a>00995       p--;                      <span class="comment">/* Put on top of &#39;\&#39;.  */</span>
<a name="l00996"></a>00996       local_prompt = (<span class="keywordtype">char</span> *) 0;
<a name="l00997"></a>00997     }
<a name="l00998"></a>00998 
<a name="l00999"></a>00999 <span class="preprocessor">#ifdef STOP_SIGNAL</span>
<a name="l01000"></a>01000 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="code" href="terminal_8h.html#a3002cbcd4a652dec2c5cef5ff3da446f">job_control</a>)
<a name="l01001"></a>01001     signal (STOP_SIGNAL, SIG_DFL);
<a name="l01002"></a>01002 <span class="preprocessor">#endif</span>
<a name="l01003"></a>01003 <span class="preprocessor"></span>  <a class="code" href="defs_8h.html#a80120f85b8df679793e5269f447429c1">immediate_quit</a>--;
<a name="l01004"></a>01004 
<a name="l01005"></a>01005   <span class="keywordflow">if</span> (got_eof)
<a name="l01006"></a>01006     <span class="keywordflow">return</span> NULL;
<a name="l01007"></a>01007 
<a name="l01008"></a>01008 <span class="preprocessor">#define SERVER_COMMAND_LENGTH 7</span>
<a name="l01009"></a>01009 <span class="preprocessor"></span>  <a class="code" href="top_8c.html#a696fc2ffc263949656d0a3d0e29c78b0">server_command</a> =
<a name="l01010"></a>01010     (p - linebuffer &gt; <a class="code" href="event-top_8c.html#a6c1d479f1d126f6a1d5fd15f77d02b55">SERVER_COMMAND_LENGTH</a>)
<a name="l01011"></a>01011     &amp;&amp; strncmp (linebuffer, <span class="stringliteral">&quot;server &quot;</span>, <a class="code" href="event-top_8c.html#a6c1d479f1d126f6a1d5fd15f77d02b55">SERVER_COMMAND_LENGTH</a>) == 0;
<a name="l01012"></a>01012   <span class="keywordflow">if</span> (<a class="code" href="top_8c.html#a696fc2ffc263949656d0a3d0e29c78b0">server_command</a>)
<a name="l01013"></a>01013     {
<a name="l01014"></a>01014       <span class="comment">/* Note that we don&#39;t set `line&#39;.  Between this and the check in</span>
<a name="l01015"></a>01015 <span class="comment">         dont_repeat, this insures that repeating will still do the</span>
<a name="l01016"></a>01016 <span class="comment">         right thing.  */</span>
<a name="l01017"></a>01017       *p = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01018"></a>01018       <span class="keywordflow">return</span> linebuffer + <a class="code" href="event-top_8c.html#a6c1d479f1d126f6a1d5fd15f77d02b55">SERVER_COMMAND_LENGTH</a>;
<a name="l01019"></a>01019     }
<a name="l01020"></a>01020 
<a name="l01021"></a>01021   <span class="comment">/* Do history expansion if that is wished.  */</span>
<a name="l01022"></a>01022   <span class="keywordflow">if</span> (<a class="code" href="top_8c.html#a4fe3fae8c9591bca07f4dfc12f02212f">history_expansion_p</a> &amp;&amp; <a class="code" href="top_8c.html#a3291280191f8913361ed5602219b6022">instream</a> == stdin
<a name="l01023"></a>01023       &amp;&amp; ISATTY (<a class="code" href="top_8c.html#a3291280191f8913361ed5602219b6022">instream</a>))
<a name="l01024"></a>01024     {
<a name="l01025"></a>01025       <span class="keywordtype">char</span> *history_value;
<a name="l01026"></a>01026       <span class="keywordtype">int</span> expanded;
<a name="l01027"></a>01027 
<a name="l01028"></a>01028       *p = <span class="charliteral">&#39;\0&#39;</span>;                <span class="comment">/* Insert null now.  */</span>
<a name="l01029"></a>01029       expanded = history_expand (linebuffer, &amp;history_value);
<a name="l01030"></a>01030       <span class="keywordflow">if</span> (expanded)
<a name="l01031"></a>01031         {
<a name="l01032"></a>01032           <span class="comment">/* Print the changes.  */</span>
<a name="l01033"></a>01033           <a class="code" href="utils_8c.html#ad57145632bbcb0361dc1dfa134b1efd0">printf_unfiltered</a> (<span class="stringliteral">&quot;%s\n&quot;</span>, history_value);
<a name="l01034"></a>01034 
<a name="l01035"></a>01035           <span class="comment">/* If there was an error, call this function again.  */</span>
<a name="l01036"></a>01036           <span class="keywordflow">if</span> (expanded &lt; 0)
<a name="l01037"></a>01037             {
<a name="l01038"></a>01038               <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (history_value);
<a name="l01039"></a>01039               <span class="keywordflow">return</span> <a class="code" href="defs_8h.html#a06b7acf2ace3fbf28f5873e57eb39376">command_line_input</a> (prompt_arg, repeat,
<a name="l01040"></a>01040                                          annotation_suffix);
<a name="l01041"></a>01041             }
<a name="l01042"></a>01042           <span class="keywordflow">if</span> (strlen (history_value) &gt; linelength)
<a name="l01043"></a>01043             {
<a name="l01044"></a>01044               linelength = strlen (history_value) + 1;
<a name="l01045"></a>01045               linebuffer = (<span class="keywordtype">char</span> *) <a class="code" href="common-utils_8c.html#af404b7244f442ce8c3069f31af566eae">xrealloc</a> (linebuffer, linelength);
<a name="l01046"></a>01046             }
<a name="l01047"></a>01047           strcpy (linebuffer, history_value);
<a name="l01048"></a>01048           p = linebuffer + strlen (linebuffer);
<a name="l01049"></a>01049         }
<a name="l01050"></a>01050       <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (history_value);
<a name="l01051"></a>01051     }
<a name="l01052"></a>01052 
<a name="l01053"></a>01053   <span class="comment">/* If we just got an empty line, and that is supposed to repeat the</span>
<a name="l01054"></a>01054 <span class="comment">     previous command, return the value in the global buffer.  */</span>
<a name="l01055"></a>01055   <span class="keywordflow">if</span> (repeat &amp;&amp; p == linebuffer)
<a name="l01056"></a>01056     <span class="keywordflow">return</span> <a class="code" href="top_8c.html#ac9aa2915d5f249ab83d3e0e511cca40a">saved_command_line</a>;
<a name="l01057"></a>01057   <span class="keywordflow">for</span> (p1 = linebuffer; *p1 == <span class="charliteral">&#39; &#39;</span> || *p1 == <span class="charliteral">&#39;\t&#39;</span>; p1++);
<a name="l01058"></a>01058   <span class="keywordflow">if</span> (repeat &amp;&amp; !*p1)
<a name="l01059"></a>01059     <span class="keywordflow">return</span> <a class="code" href="top_8c.html#ac9aa2915d5f249ab83d3e0e511cca40a">saved_command_line</a>;
<a name="l01060"></a>01060 
<a name="l01061"></a>01061   *p = 0;
<a name="l01062"></a>01062 
<a name="l01063"></a>01063   <span class="comment">/* Add line to history if appropriate.  */</span>
<a name="l01064"></a>01064   <span class="keywordflow">if</span> (<a class="code" href="top_8c.html#a3291280191f8913361ed5602219b6022">instream</a> == stdin
<a name="l01065"></a>01065       &amp;&amp; ISATTY (stdin) &amp;&amp; *linebuffer)
<a name="l01066"></a>01066     add_history (linebuffer);
<a name="l01067"></a>01067 
<a name="l01068"></a>01068   <span class="comment">/* Note: lines consisting solely of comments are added to the command</span>
<a name="l01069"></a>01069 <span class="comment">     history.  This is useful when you type a command, and then</span>
<a name="l01070"></a>01070 <span class="comment">     realize you don&#39;t want to execute it quite yet.  You can comment</span>
<a name="l01071"></a>01071 <span class="comment">     out the command and then later fetch it from the value history</span>
<a name="l01072"></a>01072 <span class="comment">     and remove the &#39;#&#39;.  The kill ring is probably better, but some</span>
<a name="l01073"></a>01073 <span class="comment">     people are in the habit of commenting things out.  */</span>
<a name="l01074"></a>01074   <span class="keywordflow">if</span> (*p1 == <span class="charliteral">&#39;#&#39;</span>)
<a name="l01075"></a>01075     *p1 = <span class="charliteral">&#39;\0&#39;</span>;                 <span class="comment">/* Found a comment.  */</span>
<a name="l01076"></a>01076 
<a name="l01077"></a>01077   <span class="comment">/* Save into global buffer if appropriate.  */</span>
<a name="l01078"></a>01078   <span class="keywordflow">if</span> (repeat)
<a name="l01079"></a>01079     {
<a name="l01080"></a>01080       <span class="keywordflow">if</span> (linelength &gt; <a class="code" href="top_8c.html#a61d3a45b79c16ff5140d783f24e538d5">saved_command_line_size</a>)
<a name="l01081"></a>01081         {
<a name="l01082"></a>01082           <a class="code" href="top_8c.html#ac9aa2915d5f249ab83d3e0e511cca40a">saved_command_line</a> = <a class="code" href="common-utils_8c.html#af404b7244f442ce8c3069f31af566eae">xrealloc</a> (<a class="code" href="top_8c.html#ac9aa2915d5f249ab83d3e0e511cca40a">saved_command_line</a>, linelength);
<a name="l01083"></a>01083           <a class="code" href="top_8c.html#a61d3a45b79c16ff5140d783f24e538d5">saved_command_line_size</a> = linelength;
<a name="l01084"></a>01084         }
<a name="l01085"></a>01085       strcpy (<a class="code" href="top_8c.html#ac9aa2915d5f249ab83d3e0e511cca40a">saved_command_line</a>, linebuffer);
<a name="l01086"></a>01086       <span class="keywordflow">return</span> <a class="code" href="top_8c.html#ac9aa2915d5f249ab83d3e0e511cca40a">saved_command_line</a>;
<a name="l01087"></a>01087     }
<a name="l01088"></a>01088 
<a name="l01089"></a>01089   <span class="keywordflow">return</span> linebuffer;
<a name="l01090"></a>01090 }
<a name="l01091"></a>01091 
<a name="l01092"></a>01092 <span class="comment">/* Print the GDB banner.  */</span>
<a name="l01093"></a>01093 <span class="keywordtype">void</span>
<a name="l01094"></a><a class="code" href="top_8h.html#aefe700cf7af579cb05bdbc4c8c379e59">01094</a> <a class="code" href="top_8c.html#a0ff0b294f84855bb3f3dc839a07e8c7b">print_gdb_version</a> (<span class="keyword">struct</span> ui_file *stream)
<a name="l01095"></a>01095 {
<a name="l01096"></a>01096   <span class="comment">/* From GNU coding standards, first line is meant to be easy for a</span>
<a name="l01097"></a>01097 <span class="comment">     program to parse, and is just canonical program name and version</span>
<a name="l01098"></a>01098 <span class="comment">     number, which starts after last space.  */</span>
<a name="l01099"></a>01099 
<a name="l01100"></a>01100   <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <span class="stringliteral">&quot;GNU gdb %s%s\n&quot;</span>, <a class="code" href="config_8h.html#afacf527299fd05613c476e65230446e5">PKGVERSION</a>, <a class="code" href="version_8h.html#ac91cf940e10a61b95cabc3258a06186b">version</a>);
<a name="l01101"></a>01101 
<a name="l01102"></a>01102   <span class="comment">/* Second line is a copyright notice.  */</span>
<a name="l01103"></a>01103 
<a name="l01104"></a>01104   <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream,
<a name="l01105"></a>01105                     <span class="stringliteral">&quot;Copyright (C) 2013 Free Software Foundation, Inc.\n&quot;</span>);
<a name="l01106"></a>01106 
<a name="l01107"></a>01107   <span class="comment">/* Following the copyright is a brief statement that the program is</span>
<a name="l01108"></a>01108 <span class="comment">     free software, that users are free to copy and change it on</span>
<a name="l01109"></a>01109 <span class="comment">     certain conditions, that it is covered by the GNU GPL, and that</span>
<a name="l01110"></a>01110 <span class="comment">     there is no warranty.  */</span>
<a name="l01111"></a>01111 
<a name="l01112"></a>01112   <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <span class="stringliteral">&quot;\</span>
<a name="l01113"></a>01113 <span class="stringliteral">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;\</span>
<a name="l01114"></a>01114 <span class="stringliteral">\nThis is free software: you are free to change and redistribute it.\n\</span>
<a name="l01115"></a>01115 <span class="stringliteral">There is NO WARRANTY, to the extent permitted by law.  Type \&quot;show copying\&quot;\n\</span>
<a name="l01116"></a>01116 <span class="stringliteral">and \&quot;show warranty\&quot; for details.\n&quot;</span>);
<a name="l01117"></a>01117 
<a name="l01118"></a>01118   <span class="comment">/* After the required info we print the configuration information.  */</span>
<a name="l01119"></a>01119 
<a name="l01120"></a>01120   <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <span class="stringliteral">&quot;This GDB was configured as \&quot;&quot;</span>);
<a name="l01121"></a>01121   <span class="keywordflow">if</span> (strcmp (<a class="code" href="version_8h.html#a2accf98da9cc5b744d1333ed14fcaa45">host_name</a>, <a class="code" href="version_8h.html#af50a56fcd2740b76fa19ce6fd8df24bc">target_name</a>) != 0)
<a name="l01122"></a>01122     {
<a name="l01123"></a>01123       <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <span class="stringliteral">&quot;--host=%s --target=%s&quot;</span>,
<a name="l01124"></a>01124                         <a class="code" href="version_8h.html#a2accf98da9cc5b744d1333ed14fcaa45">host_name</a>, <a class="code" href="version_8h.html#af50a56fcd2740b76fa19ce6fd8df24bc">target_name</a>);
<a name="l01125"></a>01125     }
<a name="l01126"></a>01126   <span class="keywordflow">else</span>
<a name="l01127"></a>01127     {
<a name="l01128"></a>01128       <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="version_8h.html#a2accf98da9cc5b744d1333ed14fcaa45">host_name</a>);
<a name="l01129"></a>01129     }
<a name="l01130"></a>01130   <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <span class="stringliteral">&quot;\&quot;.\n\</span>
<a name="l01131"></a>01131 <span class="stringliteral">Type \&quot;show configuration\&quot; for configuration details.&quot;</span>);
<a name="l01132"></a>01132 
<a name="l01133"></a>01133   <span class="keywordflow">if</span> (<a class="code" href="config_8h.html#a7c46140cb87c1d60b98a907dbbebeebe">REPORT_BUGS_TO</a>[0])
<a name="l01134"></a>01134     {
<a name="l01135"></a>01135       <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream,
<a name="l01136"></a>01136                         <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\nFor bug reporting instructions, please see:\n&quot;</span>));
<a name="l01137"></a>01137       <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <span class="stringliteral">&quot;%s.\n&quot;</span>, <a class="code" href="config_8h.html#a7c46140cb87c1d60b98a907dbbebeebe">REPORT_BUGS_TO</a>);
<a name="l01138"></a>01138     }
<a name="l01139"></a>01139   <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream,
<a name="l01140"></a>01140                     <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Find the GDB manual and other documentation \</span>
<a name="l01141"></a>01141 <span class="stringliteral">resources online at:\n&lt;http://www.gnu.org/software/gdb/documentation/&gt;.\n&quot;</span>));
<a name="l01142"></a>01142   <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;For help, type \&quot;help\&quot;.\n&quot;</span>));
<a name="l01143"></a>01143   <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Type \&quot;apropos word\&quot; to search for \</span>
<a name="l01144"></a>01144 <span class="stringliteral">commands related to \&quot;word\&quot;.&quot;</span>));
<a name="l01145"></a>01145 }
<a name="l01146"></a>01146 
<a name="l01147"></a>01147 <span class="comment">/* Print the details of GDB build-time configuration.  */</span>
<a name="l01148"></a>01148 <span class="keywordtype">void</span>
<a name="l01149"></a><a class="code" href="top_8h.html#a262c4f172596a50eb2c9dec1d34c0e59">01149</a> <a class="code" href="top_8c.html#a3cb23e872e66688d7e1d55e178ad3b2d">print_gdb_configuration</a> (<span class="keyword">struct</span> ui_file *stream)
<a name="l01150"></a>01150 {
<a name="l01151"></a>01151   <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01152"></a>01152 <span class="stringliteral">This GDB was configured as follows:\n\</span>
<a name="l01153"></a>01153 <span class="stringliteral">   configure --host=%s --target=%s\n\</span>
<a name="l01154"></a>01154 <span class="stringliteral">&quot;</span>), <a class="code" href="version_8h.html#a2accf98da9cc5b744d1333ed14fcaa45">host_name</a>, <a class="code" href="version_8h.html#af50a56fcd2740b76fa19ce6fd8df24bc">target_name</a>);
<a name="l01155"></a>01155   <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01156"></a>01156 <span class="stringliteral">             --with-auto-load-dir=%s\n\</span>
<a name="l01157"></a>01157 <span class="stringliteral">             --with-auto-load-safe-path=%s\n\</span>
<a name="l01158"></a>01158 <span class="stringliteral">&quot;</span>), <a class="code" href="config_8h.html#a16a68a602e5c5e004a5b00f77d3bbd92">AUTO_LOAD_DIR</a>, <a class="code" href="config_8h.html#abc8b13b5b87d7b770865f17247216403">AUTO_LOAD_SAFE_PATH</a>);
<a name="l01159"></a>01159 <span class="preprocessor">#if HAVE_LIBEXPAT</span>
<a name="l01160"></a>01160 <span class="preprocessor"></span>  <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01161"></a>01161 <span class="stringliteral">             --with-expat\n\</span>
<a name="l01162"></a>01162 <span class="stringliteral">&quot;</span>));
<a name="l01163"></a>01163 <span class="preprocessor">#else</span>
<a name="l01164"></a>01164 <span class="preprocessor"></span>  <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01165"></a>01165 <span class="stringliteral">             --without-expat\n\</span>
<a name="l01166"></a>01166 <span class="stringliteral">&quot;</span>));
<a name="l01167"></a>01167 <span class="preprocessor">#endif</span>
<a name="l01168"></a>01168 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="code" href="config_8h.html#a766761c2e8d7f8154079fb190cc158b7">GDB_DATADIR</a>[0])
<a name="l01169"></a>01169     <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01170"></a>01170 <span class="stringliteral">             --with-gdb-datadir=%s%s\n\</span>
<a name="l01171"></a>01171 <span class="stringliteral">&quot;</span>), <a class="code" href="config_8h.html#a766761c2e8d7f8154079fb190cc158b7">GDB_DATADIR</a>, <a class="code" href="config_8h.html#aa36a7e8dcda3fe7150d6549d42ae9b1d">GDB_DATADIR_RELOCATABLE</a> ? <span class="stringliteral">&quot; (relocatable)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l01172"></a>01172 <span class="preprocessor">#ifdef ICONV_BIN</span>
<a name="l01173"></a>01173 <span class="preprocessor"></span>  <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01174"></a>01174 <span class="stringliteral">             --with-iconv-bin=%s%s\n\</span>
<a name="l01175"></a>01175 <span class="stringliteral">&quot;</span>), ICONV_BIN, ICONV_BIN_RELOCATABLE ? <span class="stringliteral">&quot; (relocatable)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l01176"></a>01176 <span class="preprocessor">#endif</span>
<a name="l01177"></a>01177 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="code" href="config_8h.html#a3f6dc3a6869775a67e1933c4d8ac4572">JIT_READER_DIR</a>[0])
<a name="l01178"></a>01178     <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01179"></a>01179 <span class="stringliteral">             --with-jit-reader-dir=%s%s\n\</span>
<a name="l01180"></a>01180 <span class="stringliteral">&quot;</span>), <a class="code" href="config_8h.html#a3f6dc3a6869775a67e1933c4d8ac4572">JIT_READER_DIR</a>, <a class="code" href="config_8h.html#a3f1539a33bf3b73ee2cf40832c3dd263">JIT_READER_DIR_RELOCATABLE</a> ? <span class="stringliteral">&quot; (relocatable)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l01181"></a>01181 <span class="preprocessor">#if HAVE_LIBUNWIND_IA64_H</span>
<a name="l01182"></a>01182 <span class="preprocessor"></span>  <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01183"></a>01183 <span class="stringliteral">             --with-libunwind-ia64\n\</span>
<a name="l01184"></a>01184 <span class="stringliteral">&quot;</span>));
<a name="l01185"></a>01185 <span class="preprocessor">#else</span>
<a name="l01186"></a>01186 <span class="preprocessor"></span>  <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01187"></a>01187 <span class="stringliteral">             --without-libunwind-ia64\n\</span>
<a name="l01188"></a>01188 <span class="stringliteral">&quot;</span>));
<a name="l01189"></a>01189 <span class="preprocessor">#endif</span>
<a name="l01190"></a>01190 <span class="preprocessor"></span><span class="preprocessor">#if HAVE_LIBLZMA</span>
<a name="l01191"></a>01191 <span class="preprocessor"></span>  <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01192"></a>01192 <span class="stringliteral">             --with-lzma\n\</span>
<a name="l01193"></a>01193 <span class="stringliteral">&quot;</span>));
<a name="l01194"></a>01194 <span class="preprocessor">#else</span>
<a name="l01195"></a>01195 <span class="preprocessor"></span>  <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01196"></a>01196 <span class="stringliteral">             --without-lzma\n\</span>
<a name="l01197"></a>01197 <span class="stringliteral">&quot;</span>));
<a name="l01198"></a>01198 <span class="preprocessor">#endif</span>
<a name="l01199"></a>01199 <span class="preprocessor"></span><span class="preprocessor">#ifdef WITH_PYTHON_PATH</span>
<a name="l01200"></a>01200 <span class="preprocessor"></span>  <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01201"></a>01201 <span class="stringliteral">             --with-python=%s%s\n\</span>
<a name="l01202"></a>01202 <span class="stringliteral">&quot;</span>), WITH_PYTHON_PATH, PYTHON_PATH_RELOCATABLE ? <span class="stringliteral">&quot; (relocatable)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l01203"></a>01203 <span class="preprocessor">#endif</span>
<a name="l01204"></a>01204 <span class="preprocessor"></span><span class="preprocessor">#ifdef RELOC_SRCDIR</span>
<a name="l01205"></a>01205 <span class="preprocessor"></span>  <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01206"></a>01206 <span class="stringliteral">             --with-relocated-sources=%s\n\</span>
<a name="l01207"></a>01207 <span class="stringliteral">&quot;</span>), RELOC_SRCDIR);
<a name="l01208"></a>01208 <span class="preprocessor">#endif</span>
<a name="l01209"></a>01209 <span class="preprocessor"></span>  <span class="keywordflow">if</span> (<a class="code" href="config_8h.html#ac80ecdd9b304116ea70073d7ea49d62c">DEBUGDIR</a>[0])
<a name="l01210"></a>01210     <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01211"></a>01211 <span class="stringliteral">             --with-separate-debug-dir=%s%s\n\</span>
<a name="l01212"></a>01212 <span class="stringliteral">&quot;</span>), <a class="code" href="config_8h.html#ac80ecdd9b304116ea70073d7ea49d62c">DEBUGDIR</a>, <a class="code" href="config_8h.html#aae93a088b78231f46e60ed81288a32ee">DEBUGDIR_RELOCATABLE</a> ? <span class="stringliteral">&quot; (relocatable)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l01213"></a>01213   <span class="keywordflow">if</span> (<a class="code" href="config_8h.html#aa54d2655c12ff6fbfea7b10247035e76">TARGET_SYSTEM_ROOT</a>[0])
<a name="l01214"></a>01214     <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01215"></a>01215 <span class="stringliteral">             --with-sysroot=%s%s\n\</span>
<a name="l01216"></a>01216 <span class="stringliteral">&quot;</span>), <a class="code" href="config_8h.html#aa54d2655c12ff6fbfea7b10247035e76">TARGET_SYSTEM_ROOT</a>, <a class="code" href="config_8h.html#a564d58af6fc0183990225aeb8c43787e">TARGET_SYSTEM_ROOT_RELOCATABLE</a> ? <span class="stringliteral">&quot; (relocatable)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l01217"></a>01217   <span class="keywordflow">if</span> (<a class="code" href="config_8h.html#a9f607bbc3da8179d1ecd4531e6abc290">SYSTEM_GDBINIT</a>[0])
<a name="l01218"></a>01218     <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01219"></a>01219 <span class="stringliteral">             --with-system-gdbinit=%s%s\n\</span>
<a name="l01220"></a>01220 <span class="stringliteral">&quot;</span>), <a class="code" href="config_8h.html#a9f607bbc3da8179d1ecd4531e6abc290">SYSTEM_GDBINIT</a>, <a class="code" href="config_8h.html#a498cb2575b192c14590d6d57ce893f7b">SYSTEM_GDBINIT_RELOCATABLE</a> ? <span class="stringliteral">&quot; (relocatable)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l01221"></a>01221 <span class="preprocessor">#if HAVE_ZLIB_H</span>
<a name="l01222"></a>01222 <span class="preprocessor"></span>  <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01223"></a>01223 <span class="stringliteral">             --with-zlib\n\</span>
<a name="l01224"></a>01224 <span class="stringliteral">&quot;</span>));
<a name="l01225"></a>01225 <span class="preprocessor">#else</span>
<a name="l01226"></a>01226 <span class="preprocessor"></span>  <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01227"></a>01227 <span class="stringliteral">             --without-zlib\n\</span>
<a name="l01228"></a>01228 <span class="stringliteral">&quot;</span>));
<a name="l01229"></a>01229 <span class="preprocessor">#endif</span>
<a name="l01230"></a>01230 <span class="preprocessor"></span><span class="preprocessor">#if HAVE_LIBBABELTRACE</span>
<a name="l01231"></a>01231 <span class="preprocessor"></span>    <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01232"></a>01232 <span class="stringliteral">             --with-babeltrace\n\</span>
<a name="l01233"></a>01233 <span class="stringliteral">&quot;</span>));
<a name="l01234"></a>01234 <span class="preprocessor">#else</span>
<a name="l01235"></a>01235 <span class="preprocessor"></span>    <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01236"></a>01236 <span class="stringliteral">             --without-babeltrace\n\</span>
<a name="l01237"></a>01237 <span class="stringliteral">&quot;</span>));
<a name="l01238"></a>01238 <span class="preprocessor">#endif</span>
<a name="l01239"></a>01239 <span class="preprocessor"></span>    <span class="comment">/* We assume &quot;relocatable&quot; will be printed at least once, thus we always</span>
<a name="l01240"></a>01240 <span class="comment">       print this text.  It&#39;s a reasonably safe assumption for now.  */</span>
<a name="l01241"></a>01241     <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stream, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\n\</span>
<a name="l01242"></a>01242 <span class="stringliteral">(\&quot;Relocatable\&quot; means the directory can be moved with the GDB installation\n\</span>
<a name="l01243"></a>01243 <span class="stringliteral">tree, and GDB will still find it.)\n\</span>
<a name="l01244"></a>01244 <span class="stringliteral">&quot;</span>));
<a name="l01245"></a>01245 }
<a name="l01246"></a>01246 
<a name="l01247"></a>01247 
<a name="l01248"></a>01248 <span class="comment">/* The current top level prompt, settable with &quot;set prompt&quot;, and/or</span>
<a name="l01249"></a>01249 <span class="comment">   with the python `gdb.prompt_hook&#39; hook.  */</span>
<a name="l01250"></a>01250 <span class="keyword">static</span> <span class="keywordtype">char</span> *top_prompt;
<a name="l01251"></a>01251 
<a name="l01252"></a>01252 <span class="comment">/* Access method for the GDB prompt string.  */</span>
<a name="l01253"></a>01253 
<a name="l01254"></a>01254 <span class="keywordtype">char</span> *
<a name="l01255"></a><a class="code" href="top_8h.html#ab9a287aa65bc199ea4bf3b9b6d073e5a">01255</a> <a class="code" href="top_8c.html#ab9a287aa65bc199ea4bf3b9b6d073e5a">get_prompt</a> (<span class="keywordtype">void</span>)
<a name="l01256"></a>01256 {
<a name="l01257"></a>01257   <span class="keywordflow">return</span> top_prompt;
<a name="l01258"></a>01258 }
<a name="l01259"></a>01259 
<a name="l01260"></a>01260 <span class="comment">/* Set method for the GDB prompt string.  */</span>
<a name="l01261"></a>01261 
<a name="l01262"></a>01262 <span class="keywordtype">void</span>
<a name="l01263"></a><a class="code" href="top_8h.html#a546828df2782f075b5a93e3001f58ec5">01263</a> <a class="code" href="top_8c.html#a546828df2782f075b5a93e3001f58ec5">set_prompt</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *s)
<a name="l01264"></a>01264 {
<a name="l01265"></a>01265   <span class="keywordtype">char</span> *<a class="code" href="windows-nat_8c.html#ade66e4ccafbc33b117610bbc0d85feb0">p</a> = xstrdup (s);
<a name="l01266"></a>01266 
<a name="l01267"></a>01267   <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (top_prompt);
<a name="l01268"></a>01268   top_prompt = p;
<a name="l01269"></a>01269 }
<a name="l01270"></a>01270 
<a name="l01271"></a>01271 
<a name="l01272"></a>01272 <span class="keyword">struct </span>qt_args
<a name="l01273"></a>01273 {
<a name="l01274"></a>01274   <span class="keywordtype">char</span> *args;
<a name="l01275"></a>01275   <span class="keywordtype">int</span> from_tty;
<a name="l01276"></a>01276 };
<a name="l01277"></a>01277 
<a name="l01278"></a>01278 <span class="comment">/* Callback for iterate_over_inferiors.  Kills or detaches the given</span>
<a name="l01279"></a>01279 <span class="comment">   inferior, depending on how we originally gained control of it.  */</span>
<a name="l01280"></a>01280 
<a name="l01281"></a>01281 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01282"></a>01282 kill_or_detach (<span class="keyword">struct</span> <a class="code" href="structinferior.html">inferior</a> *<a class="code" href="namespacearm-linux.html#aaf6bae53545ee96f24d7ba560ed0a205">inf</a>, <span class="keywordtype">void</span> *args)
<a name="l01283"></a>01283 {
<a name="l01284"></a>01284   <span class="keyword">struct </span>qt_args *qt = args;
<a name="l01285"></a>01285   <span class="keyword">struct </span><a class="code" href="structthread__info.html">thread_info</a> *thread;
<a name="l01286"></a>01286 
<a name="l01287"></a>01287   <span class="keywordflow">if</span> (inf-&gt;<a class="code" href="structinferior.html#a1be87f581dbb6c893dbe1f2ff701636a">pid</a> == 0)
<a name="l01288"></a>01288     <span class="keywordflow">return</span> 0;
<a name="l01289"></a>01289 
<a name="l01290"></a>01290   thread = <a class="code" href="gdbthread_8h.html#a5be9dac86c4806d929f3e3d8f9c37ffc">any_thread_of_process</a> (inf-&gt;<a class="code" href="structinferior.html#a1be87f581dbb6c893dbe1f2ff701636a">pid</a>);
<a name="l01291"></a>01291   <span class="keywordflow">if</span> (thread != NULL)
<a name="l01292"></a>01292     {
<a name="l01293"></a>01293       <a class="code" href="gdbthread_8h.html#aee26ee8d9825599b321b73d2ecb5ac54">switch_to_thread</a> (thread-&gt;<a class="code" href="structthread__info.html#a533aa3979b60affd446e9fbff93fdd2c">ptid</a>);
<a name="l01294"></a>01294 
<a name="l01295"></a>01295       <span class="comment">/* Leave core files alone.  */</span>
<a name="l01296"></a>01296       <span class="keywordflow">if</span> (<a class="code" href="target_8h.html#a85885df22f7c1304269eaba1e1d618b7">target_has_execution</a>)
<a name="l01297"></a>01297         {
<a name="l01298"></a>01298           <span class="keywordflow">if</span> (inf-&gt;<a class="code" href="structinferior.html#a2a806ec9d3ad6bda987e716e653a1980">attach_flag</a>)
<a name="l01299"></a>01299             <a class="code" href="target_8c.html#af9461c4f474acfaf3d139ffb68adc0ec">target_detach</a> (qt-&gt;args, qt-&gt;from_tty);
<a name="l01300"></a>01300           <span class="keywordflow">else</span>
<a name="l01301"></a>01301             <a class="code" href="target_8c.html#a637ca4b8e71c3f9696c1e744c7ee0978">target_kill</a> ();
<a name="l01302"></a>01302         }
<a name="l01303"></a>01303     }
<a name="l01304"></a>01304 
<a name="l01305"></a>01305   <span class="keywordflow">return</span> 0;
<a name="l01306"></a>01306 }
<a name="l01307"></a>01307 
<a name="l01308"></a>01308 <span class="comment">/* Callback for iterate_over_inferiors.  Prints info about what GDB</span>
<a name="l01309"></a>01309 <span class="comment">   will do to each inferior on a &quot;quit&quot;.  ARG points to a struct</span>
<a name="l01310"></a>01310 <span class="comment">   ui_out where output is to be collected.  */</span>
<a name="l01311"></a>01311 
<a name="l01312"></a>01312 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01313"></a>01313 print_inferior_quit_action (<span class="keyword">struct</span> <a class="code" href="structinferior.html">inferior</a> *inf, <span class="keywordtype">void</span> *arg)
<a name="l01314"></a>01314 {
<a name="l01315"></a>01315   <span class="keyword">struct </span>ui_file *stb = arg;
<a name="l01316"></a>01316 
<a name="l01317"></a>01317   <span class="keywordflow">if</span> (inf-&gt;<a class="code" href="structinferior.html#a1be87f581dbb6c893dbe1f2ff701636a">pid</a> == 0)
<a name="l01318"></a>01318     <span class="keywordflow">return</span> 0;
<a name="l01319"></a>01319 
<a name="l01320"></a>01320   <span class="keywordflow">if</span> (inf-&gt;<a class="code" href="structinferior.html#a2a806ec9d3ad6bda987e716e653a1980">attach_flag</a>)
<a name="l01321"></a>01321     <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stb,
<a name="l01322"></a>01322                       <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\tInferior %d [%s] will be detached.\n&quot;</span>), inf-&gt;<a class="code" href="structinferior.html#af9e2350a56bd124ce14020ccc0c93f9e">num</a>,
<a name="l01323"></a>01323                       <a class="code" href="target_8c.html#a25ebd5fbc0b84bf9b914f7a21bfa6f7b">target_pid_to_str</a> (<a class="code" href="ptid_8c.html#a41fa537798e02ba25c7980a7c1e46272">pid_to_ptid</a> (inf-&gt;<a class="code" href="structinferior.html#a1be87f581dbb6c893dbe1f2ff701636a">pid</a>)));
<a name="l01324"></a>01324   <span class="keywordflow">else</span>
<a name="l01325"></a>01325     <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stb,
<a name="l01326"></a>01326                       <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\tInferior %d [%s] will be killed.\n&quot;</span>), inf-&gt;<a class="code" href="structinferior.html#af9e2350a56bd124ce14020ccc0c93f9e">num</a>,
<a name="l01327"></a>01327                       <a class="code" href="target_8c.html#a25ebd5fbc0b84bf9b914f7a21bfa6f7b">target_pid_to_str</a> (<a class="code" href="ptid_8c.html#a41fa537798e02ba25c7980a7c1e46272">pid_to_ptid</a> (inf-&gt;<a class="code" href="structinferior.html#a1be87f581dbb6c893dbe1f2ff701636a">pid</a>)));
<a name="l01328"></a>01328 
<a name="l01329"></a>01329   <span class="keywordflow">return</span> 0;
<a name="l01330"></a>01330 }
<a name="l01331"></a>01331 
<a name="l01332"></a>01332 <span class="comment">/* If necessary, make the user confirm that we should quit.  Return</span>
<a name="l01333"></a>01333 <span class="comment">   non-zero if we should quit, zero if we shouldn&#39;t.  */</span>
<a name="l01334"></a>01334 
<a name="l01335"></a>01335 <span class="keywordtype">int</span>
<a name="l01336"></a><a class="code" href="top_8h.html#a736e41c0d2ef663f3dd36969d50b5f2d">01336</a> <a class="code" href="top_8c.html#a736e41c0d2ef663f3dd36969d50b5f2d">quit_confirm</a> (<span class="keywordtype">void</span>)
<a name="l01337"></a>01337 {
<a name="l01338"></a>01338   <span class="keyword">struct </span>ui_file *stb;
<a name="l01339"></a>01339   <span class="keyword">struct </span>cleanup *old_chain;
<a name="l01340"></a>01340   <span class="keywordtype">char</span> *str;
<a name="l01341"></a>01341   <span class="keywordtype">int</span> qr;
<a name="l01342"></a>01342 
<a name="l01343"></a>01343   <span class="comment">/* Don&#39;t even ask if we&#39;re only debugging a core file inferior.  */</span>
<a name="l01344"></a>01344   <span class="keywordflow">if</span> (!<a class="code" href="inferior_8c.html#a943840f890b2cbf5b971cd8b9b30cd9a">have_live_inferiors</a> ())
<a name="l01345"></a>01345     <span class="keywordflow">return</span> 1;
<a name="l01346"></a>01346 
<a name="l01347"></a>01347   <span class="comment">/* Build the query string as a single string.  */</span>
<a name="l01348"></a>01348   stb = <a class="code" href="ui-file_8c.html#a340771735f105582d314e191a399a45c">mem_fileopen</a> ();
<a name="l01349"></a>01349   old_chain = <a class="code" href="utils_8c.html#a94dc56baeb57791e114136764f7763aa">make_cleanup_ui_file_delete</a> (stb);
<a name="l01350"></a>01350 
<a name="l01351"></a>01351   <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stb, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;A debugging session is active.\n\n&quot;</span>));
<a name="l01352"></a>01352   <a class="code" href="inferior_8c.html#afcb3f43a2669a8ad733c575dc07d3a80">iterate_over_inferiors</a> (print_inferior_quit_action, stb);
<a name="l01353"></a>01353   <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (stb, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\nQuit anyway? &quot;</span>));
<a name="l01354"></a>01354 
<a name="l01355"></a>01355   str = <a class="code" href="ui-file_8c.html#a995485039ce5a1d994a1863cd76a5356">ui_file_xstrdup</a> (stb, NULL);
<a name="l01356"></a>01356   <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, str);
<a name="l01357"></a>01357 
<a name="l01358"></a>01358   qr = <a class="code" href="utils_8c.html#a4b369431cd1ce5d26bccf6b79a44c085">query</a> (<span class="stringliteral">&quot;%s&quot;</span>, str);
<a name="l01359"></a>01359   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l01360"></a>01360   <span class="keywordflow">return</span> qr;
<a name="l01361"></a>01361 }
<a name="l01362"></a>01362 
<a name="l01363"></a>01363 <span class="comment">/* Quit without asking for confirmation.  */</span>
<a name="l01364"></a>01364 
<a name="l01365"></a>01365 <span class="keywordtype">void</span>
<a name="l01366"></a><a class="code" href="top_8h.html#acf6e6ad84b47a55bbfae989fedb45bdb">01366</a> <a class="code" href="top_8c.html#a9b81bdd279e1b463def08b40b70853bb">quit_force</a> (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l01367"></a>01367 {
<a name="l01368"></a>01368   <span class="keywordtype">int</span> exit_code = 0;
<a name="l01369"></a>01369   <span class="keyword">struct </span>qt_args qt;
<a name="l01370"></a>01370   <span class="keyword">volatile</span> <span class="keyword">struct </span><a class="code" href="structgdb__exception.html">gdb_exception</a> ex;
<a name="l01371"></a>01371 
<a name="l01372"></a>01372   <span class="comment">/* An optional expression may be used to cause gdb to terminate with the </span>
<a name="l01373"></a>01373 <span class="comment">     value of that expression.  */</span>
<a name="l01374"></a>01374   <span class="keywordflow">if</span> (args)
<a name="l01375"></a>01375     {
<a name="l01376"></a>01376       <span class="keyword">struct </span>value *val = <a class="code" href="eval_8c.html#a4e744c8c383f947f6e3da4112541c2f7">parse_and_eval</a> (args);
<a name="l01377"></a>01377 
<a name="l01378"></a>01378       exit_code = (<a class="code" href="command_8h.html#a74f207b5aa4ba51c3a2ad59b219a423b">int</a>) <a class="code" href="value_8c.html#aa95e2692a6e5338edb5db75909064bc1">value_as_long</a> (val);
<a name="l01379"></a>01379     }
<a name="l01380"></a>01380   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="main_8c.html#ab1e203434851a443691da485fbc0b64b">return_child_result</a>)
<a name="l01381"></a>01381     exit_code = <a class="code" href="main_8c.html#a38af2af2d56c7f677c84afbd3e526058">return_child_result_value</a>;
<a name="l01382"></a>01382 
<a name="l01383"></a>01383   qt.args = args;
<a name="l01384"></a>01384   qt.from_tty = from_tty;
<a name="l01385"></a>01385 
<a name="l01386"></a>01386   <span class="comment">/* Wrappers to make the code below a bit more readable.  */</span>
<a name="l01387"></a>01387 <span class="preprocessor">#define DO_TRY \</span>
<a name="l01388"></a>01388 <span class="preprocessor">  TRY_CATCH (ex, RETURN_MASK_ALL)</span>
<a name="l01389"></a>01389 <span class="preprocessor"></span>
<a name="l01390"></a>01390 <span class="preprocessor">#define DO_PRINT_EX \</span>
<a name="l01391"></a>01391 <span class="preprocessor">  if (ex.reason &lt; 0) \</span>
<a name="l01392"></a>01392 <span class="preprocessor">    exception_print (gdb_stderr, ex)</span>
<a name="l01393"></a>01393 <span class="preprocessor"></span>
<a name="l01394"></a>01394   <span class="comment">/* We want to handle any quit errors and exit regardless.  */</span>
<a name="l01395"></a>01395 
<a name="l01396"></a>01396   <span class="comment">/* Get out of tfind mode, and kill or detach all inferiors.  */</span>
<a name="l01397"></a>01397   <a class="code" href="top_8c.html#a074f6bc2e89e6d7671c2eff2d5e3085b">DO_TRY</a>
<a name="l01398"></a>01398     {
<a name="l01399"></a>01399       <a class="code" href="tracepoint_8c.html#a28a9ab414b4ccd724589fe388363531f">disconnect_tracing</a> ();
<a name="l01400"></a>01400       <a class="code" href="inferior_8c.html#afcb3f43a2669a8ad733c575dc07d3a80">iterate_over_inferiors</a> (kill_or_detach, &amp;qt);
<a name="l01401"></a>01401     }
<a name="l01402"></a>01402   <a class="code" href="top_8c.html#a69d330d5f80eec4fad9b67c1a7a02487">DO_PRINT_EX</a>;
<a name="l01403"></a>01403 
<a name="l01404"></a>01404   <span class="comment">/* Give all pushed targets a chance to do minimal cleanup, and pop</span>
<a name="l01405"></a>01405 <span class="comment">     them all out.  */</span>
<a name="l01406"></a>01406   <a class="code" href="top_8c.html#a074f6bc2e89e6d7671c2eff2d5e3085b">DO_TRY</a>
<a name="l01407"></a>01407     {
<a name="l01408"></a>01408       <a class="code" href="target_8c.html#a2541fbf3f0f67c7b931ed4643bf99d27">pop_all_targets</a> ();
<a name="l01409"></a>01409     }
<a name="l01410"></a>01410   <a class="code" href="top_8c.html#a69d330d5f80eec4fad9b67c1a7a02487">DO_PRINT_EX</a>;
<a name="l01411"></a>01411 
<a name="l01412"></a>01412   <span class="comment">/* Save the history information if it is appropriate to do so.  */</span>
<a name="l01413"></a>01413   <a class="code" href="top_8c.html#a074f6bc2e89e6d7671c2eff2d5e3085b">DO_TRY</a>
<a name="l01414"></a>01414     {
<a name="l01415"></a>01415       <span class="keywordflow">if</span> (write_history_p &amp;&amp; history_filename
<a name="l01416"></a>01416           &amp;&amp; <a class="code" href="defs_8h.html#ade104a4a98c8c4ab016f4b5a72d91dc3">input_from_terminal_p</a> ())
<a name="l01417"></a>01417         write_history (history_filename);
<a name="l01418"></a>01418     }
<a name="l01419"></a>01419   <a class="code" href="top_8c.html#a69d330d5f80eec4fad9b67c1a7a02487">DO_PRINT_EX</a>;
<a name="l01420"></a>01420 
<a name="l01421"></a>01421   <span class="comment">/* Do any final cleanups before exiting.  */</span>
<a name="l01422"></a>01422   <a class="code" href="top_8c.html#a074f6bc2e89e6d7671c2eff2d5e3085b">DO_TRY</a>
<a name="l01423"></a>01423     {
<a name="l01424"></a>01424       <a class="code" href="cleanups_8c.html#a38228e9f81394daa7413b483091aca4f">do_final_cleanups</a> (<a class="code" href="cleanups_8c.html#a125d335ea866e3abcc1a7fb305e2f965">all_cleanups</a> ());
<a name="l01425"></a>01425     }
<a name="l01426"></a>01426   <a class="code" href="top_8c.html#a69d330d5f80eec4fad9b67c1a7a02487">DO_PRINT_EX</a>;
<a name="l01427"></a>01427 
<a name="l01428"></a>01428   exit (exit_code);
<a name="l01429"></a>01429 }
<a name="l01430"></a>01430 
<a name="l01431"></a>01431 <span class="comment">/* Returns whether GDB is running on a terminal and input is</span>
<a name="l01432"></a>01432 <span class="comment">   currently coming from that terminal.  */</span>
<a name="l01433"></a>01433 
<a name="l01434"></a>01434 <span class="keywordtype">int</span>
<a name="l01435"></a><a class="code" href="top_8c.html#ade104a4a98c8c4ab016f4b5a72d91dc3">01435</a> <a class="code" href="defs_8h.html#ade104a4a98c8c4ab016f4b5a72d91dc3">input_from_terminal_p</a> (<span class="keywordtype">void</span>)
<a name="l01436"></a>01436 {
<a name="l01437"></a>01437   <span class="keywordflow">if</span> (<a class="code" href="main_8c.html#aec2e65ca00c82aabff661575da9ac346">batch_flag</a>)
<a name="l01438"></a>01438     <span class="keywordflow">return</span> 0;
<a name="l01439"></a>01439 
<a name="l01440"></a>01440   <span class="keywordflow">if</span> (<a class="code" href="inflow_8c.html#a844b58a7c15125b971065d5eac04bdb8">gdb_has_a_terminal</a> () &amp;&amp; <a class="code" href="top_8c.html#a3291280191f8913361ed5602219b6022">instream</a> == stdin)
<a name="l01441"></a>01441     <span class="keywordflow">return</span> 1;
<a name="l01442"></a>01442 
<a name="l01443"></a>01443   <span class="comment">/* If INSTREAM is unset, and we are not in a user command, we</span>
<a name="l01444"></a>01444 <span class="comment">     must be in Insight.  That&#39;s like having a terminal, for our</span>
<a name="l01445"></a>01445 <span class="comment">     purposes.  */</span>
<a name="l01446"></a>01446   <span class="keywordflow">if</span> (<a class="code" href="top_8c.html#a3291280191f8913361ed5602219b6022">instream</a> == NULL &amp;&amp; !<a class="code" href="top_8c.html#afdbde677efc10223e5db82c8910dd08c">in_user_command</a>)
<a name="l01447"></a>01447     <span class="keywordflow">return</span> 1;
<a name="l01448"></a>01448 
<a name="l01449"></a>01449   <span class="keywordflow">return</span> 0;
<a name="l01450"></a>01450 }
<a name="l01451"></a>01451 
<a name="l01452"></a>01452 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01453"></a>01453 dont_repeat_command (<span class="keywordtype">char</span> *ignored, <span class="keywordtype">int</span> from_tty)
<a name="l01454"></a>01454 {
<a name="l01455"></a>01455   <span class="comment">/* Can&#39;t call dont_repeat here because we&#39;re not necessarily reading</span>
<a name="l01456"></a>01456 <span class="comment">     from stdin.  */</span>
<a name="l01457"></a>01457   *<a class="code" href="top_8c.html#ac9aa2915d5f249ab83d3e0e511cca40a">saved_command_line</a> = 0;
<a name="l01458"></a>01458 }
<a name="l01459"></a>01459 
<a name="l01460"></a>01460 <span class="comment">/* Functions to manipulate command line editing control variables.  */</span>
<a name="l01461"></a>01461 
<a name="l01462"></a>01462 <span class="comment">/* Number of commands to print in each call to show_commands.  */</span>
<a name="l01463"></a><a class="code" href="top_8c.html#a1de67dc59a67dfc608f43a2155c88660">01463</a> <span class="preprocessor">#define Hist_print 10</span>
<a name="l01464"></a>01464 <span class="preprocessor"></span><span class="keywordtype">void</span>
<a name="l01465"></a><a class="code" href="top_8h.html#a703f227adc2d67dd05e39f98f1c52a7b">01465</a> <a class="code" href="top_8c.html#a703f227adc2d67dd05e39f98f1c52a7b">show_commands</a> (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l01466"></a>01466 {
<a name="l01467"></a>01467   <span class="comment">/* Index for history commands.  Relative to history_base.  */</span>
<a name="l01468"></a>01468   <span class="keywordtype">int</span> <a class="code" href="common_2agent_8c.html#aed7ea92f45bd273dde380a45ddced592">offset</a>;
<a name="l01469"></a>01469 
<a name="l01470"></a>01470   <span class="comment">/* Number of the history entry which we are planning to display next.</span>
<a name="l01471"></a>01471 <span class="comment">     Relative to history_base.  */</span>
<a name="l01472"></a>01472   <span class="keyword">static</span> <span class="keywordtype">int</span> num = 0;
<a name="l01473"></a>01473 
<a name="l01474"></a>01474   <span class="comment">/* Print out some of the commands from the command history.  */</span>
<a name="l01475"></a>01475 
<a name="l01476"></a>01476   <span class="keywordflow">if</span> (args)
<a name="l01477"></a>01477     {
<a name="l01478"></a>01478       <span class="keywordflow">if</span> (args[0] == <span class="charliteral">&#39;+&#39;</span> &amp;&amp; args[1] == <span class="charliteral">&#39;\0&#39;</span>)
<a name="l01479"></a>01479         <span class="comment">/* &quot;info editing +&quot; should print from the stored position.  */</span>
<a name="l01480"></a>01480         ;
<a name="l01481"></a>01481       <span class="keywordflow">else</span>
<a name="l01482"></a>01482         <span class="comment">/* &quot;info editing &lt;exp&gt;&quot; should print around command number &lt;exp&gt;.  */</span>
<a name="l01483"></a>01483         num = (<a class="code" href="eval_8c.html#a8c10c34c4f91482249243e53ab7d16b7">parse_and_eval_long</a> (args) - history_base) - <a class="code" href="top_8c.html#a1de67dc59a67dfc608f43a2155c88660">Hist_print</a> / 2;
<a name="l01484"></a>01484     }
<a name="l01485"></a>01485   <span class="comment">/* &quot;show commands&quot; means print the last Hist_print commands.  */</span>
<a name="l01486"></a>01486   <span class="keywordflow">else</span>
<a name="l01487"></a>01487     {
<a name="l01488"></a>01488       num = history_length - <a class="code" href="top_8c.html#a1de67dc59a67dfc608f43a2155c88660">Hist_print</a>;
<a name="l01489"></a>01489     }
<a name="l01490"></a>01490 
<a name="l01491"></a>01491   <span class="keywordflow">if</span> (num &lt; 0)
<a name="l01492"></a>01492     num = 0;
<a name="l01493"></a>01493 
<a name="l01494"></a>01494   <span class="comment">/* If there are at least Hist_print commands, we want to display the last</span>
<a name="l01495"></a>01495 <span class="comment">     Hist_print rather than, say, the last 6.  */</span>
<a name="l01496"></a>01496   <span class="keywordflow">if</span> (history_length - num &lt; <a class="code" href="top_8c.html#a1de67dc59a67dfc608f43a2155c88660">Hist_print</a>)
<a name="l01497"></a>01497     {
<a name="l01498"></a>01498       num = history_length - <a class="code" href="top_8c.html#a1de67dc59a67dfc608f43a2155c88660">Hist_print</a>;
<a name="l01499"></a>01499       <span class="keywordflow">if</span> (num &lt; 0)
<a name="l01500"></a>01500         num = 0;
<a name="l01501"></a>01501     }
<a name="l01502"></a>01502 
<a name="l01503"></a>01503   <span class="keywordflow">for</span> (offset = num;
<a name="l01504"></a>01504        offset &lt; num + <a class="code" href="top_8c.html#a1de67dc59a67dfc608f43a2155c88660">Hist_print</a> &amp;&amp; offset &lt; history_length;
<a name="l01505"></a>01505        offset++)
<a name="l01506"></a>01506     {
<a name="l01507"></a>01507       <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;%5d  %s\n&quot;</span>, history_base + offset,
<a name="l01508"></a>01508                        (history_get (history_base + offset))-&gt;line);
<a name="l01509"></a>01509     }
<a name="l01510"></a>01510 
<a name="l01511"></a>01511   <span class="comment">/* The next command we want to display is the next one that we haven&#39;t</span>
<a name="l01512"></a>01512 <span class="comment">     displayed yet.  */</span>
<a name="l01513"></a>01513   num += <a class="code" href="top_8c.html#a1de67dc59a67dfc608f43a2155c88660">Hist_print</a>;
<a name="l01514"></a>01514 
<a name="l01515"></a>01515   <span class="comment">/* If the user repeats this command with return, it should do what</span>
<a name="l01516"></a>01516 <span class="comment">     &quot;show commands +&quot; does.  This is unnecessary if arg is null,</span>
<a name="l01517"></a>01517 <span class="comment">     because &quot;show commands +&quot; is not useful after &quot;show commands&quot;.  */</span>
<a name="l01518"></a>01518   <span class="keywordflow">if</span> (from_tty &amp;&amp; args)
<a name="l01519"></a>01519     {
<a name="l01520"></a>01520       args[0] = <span class="charliteral">&#39;+&#39;</span>;
<a name="l01521"></a>01521       args[1] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l01522"></a>01522     }
<a name="l01523"></a>01523 }
<a name="l01524"></a>01524 
<a name="l01525"></a>01525 <span class="comment">/* Called by do_setshow_command.  */</span>
<a name="l01526"></a>01526 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01527"></a>01527 set_history_size_command (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty, <span class="keyword">struct</span> <a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c)
<a name="l01528"></a>01528 {
<a name="l01529"></a>01529   <span class="comment">/* Readline&#39;s history interface works with &#39;int&#39;, so it can only</span>
<a name="l01530"></a>01530 <span class="comment">     handle history sizes up to INT_MAX.  The command itself is</span>
<a name="l01531"></a>01531 <span class="comment">     uinteger, so UINT_MAX means &quot;unlimited&quot;, but we only get that if</span>
<a name="l01532"></a>01532 <span class="comment">     the user does &quot;set history size 0&quot; -- &quot;set history size &lt;UINT_MAX&gt;&quot;</span>
<a name="l01533"></a>01533 <span class="comment">     throws out-of-range.  */</span>
<a name="l01534"></a>01534   <span class="keywordflow">if</span> (history_size_setshow_var &gt; INT_MAX
<a name="l01535"></a>01535       &amp;&amp; history_size_setshow_var != UINT_MAX)
<a name="l01536"></a>01536     {
<a name="l01537"></a>01537       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> new_value = history_size_setshow_var;
<a name="l01538"></a>01538 
<a name="l01539"></a>01539       <span class="comment">/* Restore previous value before throwing.  */</span>
<a name="l01540"></a>01540       <span class="keywordflow">if</span> (history_is_stifled ())
<a name="l01541"></a>01541         history_size_setshow_var = history_max_entries;
<a name="l01542"></a>01542       <span class="keywordflow">else</span>
<a name="l01543"></a>01543         history_size_setshow_var = UINT_MAX;
<a name="l01544"></a>01544 
<a name="l01545"></a>01545       <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;integer %u out of range&quot;</span>), new_value);
<a name="l01546"></a>01546     }
<a name="l01547"></a>01547 
<a name="l01548"></a>01548   <span class="comment">/* Commit the new value to readline&#39;s history.  */</span>
<a name="l01549"></a>01549   <span class="keywordflow">if</span> (history_size_setshow_var == UINT_MAX)
<a name="l01550"></a>01550     unstifle_history ();
<a name="l01551"></a>01551   <span class="keywordflow">else</span>
<a name="l01552"></a>01552     stifle_history (history_size_setshow_var);
<a name="l01553"></a>01553 }
<a name="l01554"></a>01554 
<a name="l01555"></a>01555 <span class="keywordtype">void</span>
<a name="l01556"></a><a class="code" href="top_8h.html#a9896b08d0f036dba5f46a7a14f82824e">01556</a> <a class="code" href="top_8c.html#a4ec25352752824a09cccb0e165eab993">set_history</a> (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l01557"></a>01557 {
<a name="l01558"></a>01558   <a class="code" href="utils_8c.html#ad57145632bbcb0361dc1dfa134b1efd0">printf_unfiltered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\&quot;set history\&quot; must be followed &quot;</span>
<a name="l01559"></a>01559                        <span class="stringliteral">&quot;by the name of a history subcommand.\n&quot;</span>));
<a name="l01560"></a>01560   <a class="code" href="cli-decode_8c.html#a2ae762f5189f3597666852868defc038">help_list</a> (<a class="code" href="cli-cmds_8c.html#aec7c1254bd96f2090e5c79fb2607009c">sethistlist</a>, <span class="stringliteral">&quot;set history &quot;</span>, -1, <a class="code" href="main_8c.html#a41a2b997ba5454df787d61f051dd918c">gdb_stdout</a>);
<a name="l01561"></a>01561 }
<a name="l01562"></a>01562 
<a name="l01563"></a>01563 <span class="keywordtype">void</span>
<a name="l01564"></a><a class="code" href="top_8h.html#a265f577320177f1feb2fcd9e5ad2a64a">01564</a> <a class="code" href="top_8c.html#a99fa369f9f58c352bdfdb0a84dfd214d">show_history</a> (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l01565"></a>01565 {
<a name="l01566"></a>01566   <a class="code" href="cli-setshow_8c.html#acad906a9e078be9cde70874ab62b1b1e">cmd_show_list</a> (<a class="code" href="cli-cmds_8c.html#a3bf679af2d914f56370af7d3176f4f88">showhistlist</a>, from_tty, <span class="stringliteral">&quot;&quot;</span>);
<a name="l01567"></a>01567 }
<a name="l01568"></a>01568 
<a name="l01569"></a><a class="code" href="top_8c.html#a3f2f91ed92de5dfaa6d27fb82822f8d5">01569</a> <span class="keywordtype">int</span> <a class="code" href="defs_8h.html#a3f2f91ed92de5dfaa6d27fb82822f8d5">info_verbose</a> = 0;           <span class="comment">/* Default verbose msgs off.  */</span>
<a name="l01570"></a>01570 
<a name="l01571"></a>01571 <span class="comment">/* Called by do_setshow_command.  An elaborate joke.  */</span>
<a name="l01572"></a>01572 <span class="keywordtype">void</span>
<a name="l01573"></a><a class="code" href="top_8h.html#a821e8fa56e5bb72887cc746b876e7592">01573</a> <a class="code" href="top_8c.html#a48449c446d059ebb524a3164a4b83835">set_verbose</a> (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty, <span class="keyword">struct</span> <a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c)
<a name="l01574"></a>01574 {
<a name="l01575"></a>01575   <span class="keyword">const</span> <span class="keywordtype">char</span> *cmdname = <span class="stringliteral">&quot;verbose&quot;</span>;
<a name="l01576"></a>01576   <span class="keyword">struct </span><a class="code" href="structcmd__list__element.html">cmd_list_element</a> *showcmd;
<a name="l01577"></a>01577 
<a name="l01578"></a>01578   showcmd = <a class="code" href="cli-decode_8c.html#abb9e35f53f984a80ea24929b6cd7feb5">lookup_cmd_1</a> (&amp;cmdname, <a class="code" href="cli-cmds_8c.html#a003932aa76fd3f41763ecc6bee5e2ca8">showlist</a>, NULL, 1);
<a name="l01579"></a>01579   <a class="code" href="gdb__assert_8h.html#aeb007d3e990858c7ef8e40a7e512c1ff">gdb_assert</a> (showcmd != NULL &amp;&amp; showcmd != <a class="code" href="command_8h.html#a0da83a8853d5339d738a1123593dd318">CMD_LIST_AMBIGUOUS</a>);
<a name="l01580"></a>01580 
<a name="l01581"></a>01581   <span class="keywordflow">if</span> (info_verbose)
<a name="l01582"></a>01582     {
<a name="l01583"></a>01583       c-&gt;<a class="code" href="structcmd__list__element.html#ab4ceb7dfadb276296bbc274106595e2b">doc</a> = <span class="stringliteral">&quot;Set verbose printing of informational messages.&quot;</span>;
<a name="l01584"></a>01584       showcmd-&gt;<a class="code" href="structcmd__list__element.html#ab4ceb7dfadb276296bbc274106595e2b">doc</a> = <span class="stringliteral">&quot;Show verbose printing of informational messages.&quot;</span>;
<a name="l01585"></a>01585     }
<a name="l01586"></a>01586   <span class="keywordflow">else</span>
<a name="l01587"></a>01587     {
<a name="l01588"></a>01588       c-&gt;<a class="code" href="structcmd__list__element.html#ab4ceb7dfadb276296bbc274106595e2b">doc</a> = <span class="stringliteral">&quot;Set verbosity.&quot;</span>;
<a name="l01589"></a>01589       showcmd-&gt;<a class="code" href="structcmd__list__element.html#ab4ceb7dfadb276296bbc274106595e2b">doc</a> = <span class="stringliteral">&quot;Show verbosity.&quot;</span>;
<a name="l01590"></a>01590     }
<a name="l01591"></a>01591 }
<a name="l01592"></a>01592 
<a name="l01593"></a>01593 <span class="comment">/* Init the history buffer.  Note that we are called after the init file(s)</span>
<a name="l01594"></a>01594 <span class="comment">   have been read so that the user can change the history file via his</span>
<a name="l01595"></a>01595 <span class="comment">   .gdbinit file (for instance).  The GDBHISTFILE environment variable</span>
<a name="l01596"></a>01596 <span class="comment">   overrides all of this.  */</span>
<a name="l01597"></a>01597 
<a name="l01598"></a>01598 <span class="keywordtype">void</span>
<a name="l01599"></a><a class="code" href="top_8h.html#a3b9830ecbd98de7ce0be571922d58286">01599</a> <a class="code" href="top_8c.html#a3b9830ecbd98de7ce0be571922d58286">init_history</a> (<span class="keywordtype">void</span>)
<a name="l01600"></a>01600 {
<a name="l01601"></a>01601   <span class="keywordtype">char</span> *tmpenv;
<a name="l01602"></a>01602 
<a name="l01603"></a>01603   tmpenv = getenv (<span class="stringliteral">&quot;HISTSIZE&quot;</span>);
<a name="l01604"></a>01604   <span class="keywordflow">if</span> (tmpenv)
<a name="l01605"></a>01605     {
<a name="l01606"></a>01606       <span class="keywordtype">int</span> <a class="code" href="structcmd__list__element.html#ab137cc1bd6cb6d0de468b85ce5ee62d7">var</a>;
<a name="l01607"></a>01607 
<a name="l01608"></a>01608       var = atoi (tmpenv);
<a name="l01609"></a>01609       <span class="keywordflow">if</span> (var &lt; 0)
<a name="l01610"></a>01610         {
<a name="l01611"></a>01611           <span class="comment">/* Prefer ending up with no history rather than overflowing</span>
<a name="l01612"></a>01612 <span class="comment">             readline&#39;s history interface, which uses signed &#39;int&#39;</span>
<a name="l01613"></a>01613 <span class="comment">             everywhere.  */</span>
<a name="l01614"></a>01614           var = 0;
<a name="l01615"></a>01615         }
<a name="l01616"></a>01616 
<a name="l01617"></a>01617       history_size_setshow_var = <a class="code" href="structcmd__list__element.html#ab137cc1bd6cb6d0de468b85ce5ee62d7">var</a>;
<a name="l01618"></a>01618     }
<a name="l01619"></a>01619   <span class="comment">/* If the init file hasn&#39;t set a size yet, pick the default.  */</span>
<a name="l01620"></a>01620   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (history_size_setshow_var == 0)
<a name="l01621"></a>01621     history_size_setshow_var = 256;
<a name="l01622"></a>01622 
<a name="l01623"></a>01623   <span class="comment">/* Note that unlike &quot;set history size 0&quot;, &quot;HISTSIZE=0&quot; really sets</span>
<a name="l01624"></a>01624 <span class="comment">     the history size to 0...  */</span>
<a name="l01625"></a>01625   stifle_history (history_size_setshow_var);
<a name="l01626"></a>01626 
<a name="l01627"></a>01627   tmpenv = getenv (<span class="stringliteral">&quot;GDBHISTFILE&quot;</span>);
<a name="l01628"></a>01628   <span class="keywordflow">if</span> (tmpenv)
<a name="l01629"></a>01629     history_filename = xstrdup (tmpenv);
<a name="l01630"></a>01630   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!history_filename)
<a name="l01631"></a>01631     {
<a name="l01632"></a>01632       <span class="comment">/* We include the current directory so that if the user changes</span>
<a name="l01633"></a>01633 <span class="comment">         directories the file written will be the same as the one</span>
<a name="l01634"></a>01634 <span class="comment">         that was read.  */</span>
<a name="l01635"></a>01635 <span class="preprocessor">#ifdef __MSDOS__</span>
<a name="l01636"></a>01636 <span class="preprocessor"></span>      <span class="comment">/* No leading dots in file names are allowed on MSDOS.  */</span>
<a name="l01637"></a>01637       history_filename = concat (<a class="code" href="defs_8h.html#a6dd03da55f1ccd4375343b3a93aaf421">current_directory</a>, <span class="stringliteral">&quot;/_gdb_history&quot;</span>,
<a name="l01638"></a>01638                                  (<span class="keywordtype">char</span> *)NULL);
<a name="l01639"></a>01639 <span class="preprocessor">#else</span>
<a name="l01640"></a>01640 <span class="preprocessor"></span>      history_filename = concat (<a class="code" href="defs_8h.html#a6dd03da55f1ccd4375343b3a93aaf421">current_directory</a>, <span class="stringliteral">&quot;/.gdb_history&quot;</span>,
<a name="l01641"></a>01641                                  (<span class="keywordtype">char</span> *)NULL);
<a name="l01642"></a>01642 <span class="preprocessor">#endif</span>
<a name="l01643"></a>01643 <span class="preprocessor"></span>    }
<a name="l01644"></a>01644   read_history (history_filename);
<a name="l01645"></a>01645 }
<a name="l01646"></a>01646 
<a name="l01647"></a>01647 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01648"></a>01648 show_prompt (<span class="keyword">struct</span> ui_file *file, <span class="keywordtype">int</span> from_tty,
<a name="l01649"></a>01649              <span class="keyword">struct</span> <a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *value)
<a name="l01650"></a>01650 {
<a name="l01651"></a>01651   <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (file, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Gdb&#39;s prompt is \&quot;%s\&quot;.\n&quot;</span>), value);
<a name="l01652"></a>01652 }
<a name="l01653"></a>01653 
<a name="l01654"></a>01654 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01655"></a>01655 show_async_command_editing_p (<span class="keyword">struct</span> ui_file *file, <span class="keywordtype">int</span> from_tty,
<a name="l01656"></a>01656                               <span class="keyword">struct</span> <a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *value)
<a name="l01657"></a>01657 {
<a name="l01658"></a>01658   <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (file, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Editing of command lines as &quot;</span>
<a name="l01659"></a>01659                             <span class="stringliteral">&quot;they are typed is %s.\n&quot;</span>),
<a name="l01660"></a>01660                     value);
<a name="l01661"></a>01661 }
<a name="l01662"></a>01662 
<a name="l01663"></a>01663 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01664"></a>01664 show_annotation_level (<span class="keyword">struct</span> ui_file *file, <span class="keywordtype">int</span> from_tty,
<a name="l01665"></a>01665                        <span class="keyword">struct</span> <a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *value)
<a name="l01666"></a>01666 {
<a name="l01667"></a>01667   <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (file, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Annotation_level is %s.\n&quot;</span>), value);
<a name="l01668"></a>01668 }
<a name="l01669"></a>01669 
<a name="l01670"></a>01670 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01671"></a>01671 show_exec_done_display_p (<span class="keyword">struct</span> ui_file *file, <span class="keywordtype">int</span> from_tty,
<a name="l01672"></a>01672                           <span class="keyword">struct</span> <a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *value)
<a name="l01673"></a>01673 {
<a name="l01674"></a>01674   <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (file, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Notification of completion for &quot;</span>
<a name="l01675"></a>01675                             <span class="stringliteral">&quot;asynchronous execution commands is %s.\n&quot;</span>),
<a name="l01676"></a>01676                     value);
<a name="l01677"></a>01677 }
<a name="l01678"></a>01678 
<a name="l01679"></a>01679 <span class="comment">/* &quot;set&quot; command for the gdb_datadir configuration variable.  */</span>
<a name="l01680"></a>01680 
<a name="l01681"></a>01681 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01682"></a>01682 set_gdb_datadir (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty, <span class="keyword">struct</span> <a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c)
<a name="l01683"></a>01683 {
<a name="l01684"></a>01684   <a class="code" href="observer_8h.html#a0d5d504880cbe593c503eb4bf8915416">observer_notify_gdb_datadir_changed</a> ();
<a name="l01685"></a>01685 }
<a name="l01686"></a>01686 
<a name="l01687"></a>01687 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01688"></a>01688 set_history_filename (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty, <span class="keyword">struct</span> <a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c)
<a name="l01689"></a>01689 {
<a name="l01690"></a>01690   <span class="comment">/* We include the current directory so that if the user changes</span>
<a name="l01691"></a>01691 <span class="comment">     directories the file written will be the same as the one</span>
<a name="l01692"></a>01692 <span class="comment">     that was read.  */</span>
<a name="l01693"></a>01693   <span class="keywordflow">if</span> (!IS_ABSOLUTE_PATH (history_filename))
<a name="l01694"></a>01694     history_filename = reconcat (history_filename, <a class="code" href="defs_8h.html#a6dd03da55f1ccd4375343b3a93aaf421">current_directory</a>, <span class="stringliteral">&quot;/&quot;</span>, 
<a name="l01695"></a>01695                                  history_filename, (<span class="keywordtype">char</span> *) NULL);
<a name="l01696"></a>01696 }
<a name="l01697"></a>01697 
<a name="l01698"></a>01698 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01699"></a>01699 init_main (<span class="keywordtype">void</span>)
<a name="l01700"></a>01700 {
<a name="l01701"></a>01701   <span class="comment">/* Initialize the prompt to a simple &quot;(gdb) &quot; prompt or to whatever</span>
<a name="l01702"></a>01702 <span class="comment">     the DEFAULT_PROMPT is.  */</span>
<a name="l01703"></a>01703   <a class="code" href="top_8c.html#a546828df2782f075b5a93e3001f58ec5">set_prompt</a> (<a class="code" href="top_8c.html#a2b7e157b569bfc6ebc29f32ae647359b">DEFAULT_PROMPT</a>);
<a name="l01704"></a>01704 
<a name="l01705"></a>01705   <span class="comment">/* Set things up for annotation_level &gt; 1, if the user ever decides</span>
<a name="l01706"></a>01706 <span class="comment">     to use it.  */</span>
<a name="l01707"></a>01707   <a class="code" href="event-top_8c.html#a680cb7faf1df40d68ea5ac4f954ba7b1">async_annotation_suffix</a> = <span class="stringliteral">&quot;prompt&quot;</span>;
<a name="l01708"></a>01708 
<a name="l01709"></a>01709   <span class="comment">/* Set the important stuff up for command editing.  */</span>
<a name="l01710"></a>01710   command_editing_p = 1;
<a name="l01711"></a>01711   <a class="code" href="top_8c.html#a4fe3fae8c9591bca07f4dfc12f02212f">history_expansion_p</a> = 0;
<a name="l01712"></a>01712   write_history_p = 0;
<a name="l01713"></a>01713 
<a name="l01714"></a>01714   <span class="comment">/* Setup important stuff for command line editing.  */</span>
<a name="l01715"></a>01715   rl_completion_word_break_hook = <a class="code" href="completer_8c.html#a09393d04d6413de6bbd0814a1c180b1f">gdb_completion_word_break_characters</a>;
<a name="l01716"></a>01716   rl_completion_entry_function = <a class="code" href="completer_8c.html#a798c58433049dcbd3ddd15914d487b92">readline_line_completion_function</a>;
<a name="l01717"></a>01717   rl_completer_word_break_characters = <a class="code" href="language_8c.html#a4faef03d5ddb629c5ca5e8d075665a9a">default_word_break_characters</a> ();
<a name="l01718"></a>01718   rl_completer_quote_characters = <a class="code" href="completer_8c.html#a7eddbabfc8c0007f7b926057e53c0a3a">get_gdb_completer_quote_characters</a> ();
<a name="l01719"></a>01719   rl_readline_name = <span class="stringliteral">&quot;gdb&quot;</span>;
<a name="l01720"></a>01720   rl_terminal_name = getenv (<span class="stringliteral">&quot;TERM&quot;</span>);
<a name="l01721"></a>01721 
<a name="l01722"></a>01722   <span class="comment">/* The name for this defun comes from Bash, where it originated.</span>
<a name="l01723"></a>01723 <span class="comment">     15 is Control-o, the same binding this function has in Bash.  */</span>
<a name="l01724"></a>01724   rl_add_defun (<span class="stringliteral">&quot;operate-and-get-next&quot;</span>, gdb_rl_operate_and_get_next, 15);
<a name="l01725"></a>01725 
<a name="l01726"></a>01726   <a class="code" href="cli-decode_8c.html#ae1abcdc8b2f24a182f5ba065cf50c81b">add_setshow_string_cmd</a> (<span class="stringliteral">&quot;prompt&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49a92be6efbab6bd9647a6f7a2862712d9b">class_support</a>,
<a name="l01727"></a>01727                           &amp;top_prompt,
<a name="l01728"></a>01728                           <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Set gdb&#39;s prompt&quot;</span>),
<a name="l01729"></a>01729                           <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Show gdb&#39;s prompt&quot;</span>),
<a name="l01730"></a>01730                           NULL, NULL,
<a name="l01731"></a>01731                           show_prompt,
<a name="l01732"></a>01732                           &amp;<a class="code" href="cli-cmds_8c.html#a723e0174d833cba0aa82fb936a56c8fa">setlist</a>, &amp;<a class="code" href="cli-cmds_8c.html#a003932aa76fd3f41763ecc6bee5e2ca8">showlist</a>);
<a name="l01733"></a>01733 
<a name="l01734"></a>01734   <a class="code" href="cli-decode_8c.html#a0df0ca36d9acd96440e24407cbef593c">add_com</a> (<span class="stringliteral">&quot;dont-repeat&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49a92be6efbab6bd9647a6f7a2862712d9b">class_support</a>, dont_repeat_command, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01735"></a>01735 <span class="stringliteral">Don&#39;t repeat this command.\nPrimarily \</span>
<a name="l01736"></a>01736 <span class="stringliteral">used inside of user-defined commands that should not be repeated when\n\</span>
<a name="l01737"></a>01737 <span class="stringliteral">hitting return.&quot;</span>));
<a name="l01738"></a>01738 
<a name="l01739"></a>01739   <a class="code" href="cli-decode_8c.html#ad86a0f135b6c546ae7ffbb41fd72e14f">add_setshow_boolean_cmd</a> (<span class="stringliteral">&quot;editing&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49a92be6efbab6bd9647a6f7a2862712d9b">class_support</a>,
<a name="l01740"></a>01740                            &amp;<a class="code" href="event-top_8c.html#a0c25d96db6170286380cc620a381403e">async_command_editing_p</a>, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01741"></a>01741 <span class="stringliteral">Set editing of command lines as they are typed.&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01742"></a>01742 <span class="stringliteral">Show editing of command lines as they are typed.&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01743"></a>01743 <span class="stringliteral">Use \&quot;on\&quot; to enable the editing, and \&quot;off\&quot; to disable it.\n\</span>
<a name="l01744"></a>01744 <span class="stringliteral">Without an argument, command line editing is enabled.  To edit, use\n\</span>
<a name="l01745"></a>01745 <span class="stringliteral">EMACS-like or VI-like commands like control-P or ESC.&quot;</span>),
<a name="l01746"></a>01746                            <a class="code" href="event-top_8c.html#a256c0051ddbbffcada3bf2d1e6b3a57a">set_async_editing_command</a>,
<a name="l01747"></a>01747                            show_async_command_editing_p,
<a name="l01748"></a>01748                            &amp;<a class="code" href="cli-cmds_8c.html#a723e0174d833cba0aa82fb936a56c8fa">setlist</a>, &amp;<a class="code" href="cli-cmds_8c.html#a003932aa76fd3f41763ecc6bee5e2ca8">showlist</a>);
<a name="l01749"></a>01749 
<a name="l01750"></a>01750   <a class="code" href="cli-decode_8c.html#ad86a0f135b6c546ae7ffbb41fd72e14f">add_setshow_boolean_cmd</a> (<span class="stringliteral">&quot;save&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49afbf489a4abce7e8770b178aa54f0908b">no_class</a>, &amp;write_history_p, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01751"></a>01751 <span class="stringliteral">Set saving of the history record on exit.&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01752"></a>01752 <span class="stringliteral">Show saving of the history record on exit.&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01753"></a>01753 <span class="stringliteral">Use \&quot;on\&quot; to enable the saving, and \&quot;off\&quot; to disable it.\n\</span>
<a name="l01754"></a>01754 <span class="stringliteral">Without an argument, saving is enabled.&quot;</span>),
<a name="l01755"></a>01755                            NULL,
<a name="l01756"></a>01756                            show_write_history_p,
<a name="l01757"></a>01757                            &amp;<a class="code" href="cli-cmds_8c.html#aec7c1254bd96f2090e5c79fb2607009c">sethistlist</a>, &amp;<a class="code" href="cli-cmds_8c.html#a3bf679af2d914f56370af7d3176f4f88">showhistlist</a>);
<a name="l01758"></a>01758 
<a name="l01759"></a>01759   <a class="code" href="cli-decode_8c.html#a150c74d82f9429f06992c8831dcdd8b3">add_setshow_uinteger_cmd</a> (<span class="stringliteral">&quot;size&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49afbf489a4abce7e8770b178aa54f0908b">no_class</a>, &amp;history_size_setshow_var, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01760"></a>01760 <span class="stringliteral">Set the size of the command history,&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01761"></a>01761 <span class="stringliteral">Show the size of the command history,&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01762"></a>01762 <span class="stringliteral">ie. the number of previous commands to keep a record of.\n\</span>
<a name="l01763"></a>01763 <span class="stringliteral">If set to \&quot;unlimited\&quot;, the number of commands kept in the history\n\</span>
<a name="l01764"></a>01764 <span class="stringliteral">list is unlimited.  This defaults to the value of the environment\n\</span>
<a name="l01765"></a>01765 <span class="stringliteral">variable \&quot;HISTSIZE\&quot;, or to 256 if this variable is not set.&quot;</span>),
<a name="l01766"></a>01766                             set_history_size_command,
<a name="l01767"></a>01767                             show_history_size,
<a name="l01768"></a>01768                             &amp;<a class="code" href="cli-cmds_8c.html#aec7c1254bd96f2090e5c79fb2607009c">sethistlist</a>, &amp;<a class="code" href="cli-cmds_8c.html#a3bf679af2d914f56370af7d3176f4f88">showhistlist</a>);
<a name="l01769"></a>01769 
<a name="l01770"></a>01770   <a class="code" href="cli-decode_8c.html#a3f510a36ebb350d94e3f1d39f1a32da5">add_setshow_filename_cmd</a> (<span class="stringliteral">&quot;filename&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49afbf489a4abce7e8770b178aa54f0908b">no_class</a>, &amp;history_filename, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01771"></a>01771 <span class="stringliteral">Set the filename in which to record the command history&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01772"></a>01772 <span class="stringliteral">Show the filename in which to record the command history&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01773"></a>01773 <span class="stringliteral">(the list of previous commands of which a record is kept).&quot;</span>),
<a name="l01774"></a>01774                             set_history_filename,
<a name="l01775"></a>01775                             show_history_filename,
<a name="l01776"></a>01776                             &amp;<a class="code" href="cli-cmds_8c.html#aec7c1254bd96f2090e5c79fb2607009c">sethistlist</a>, &amp;<a class="code" href="cli-cmds_8c.html#a3bf679af2d914f56370af7d3176f4f88">showhistlist</a>);
<a name="l01777"></a>01777 
<a name="l01778"></a>01778   <a class="code" href="cli-decode_8c.html#ad86a0f135b6c546ae7ffbb41fd72e14f">add_setshow_boolean_cmd</a> (<span class="stringliteral">&quot;confirm&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49a92be6efbab6bd9647a6f7a2862712d9b">class_support</a>, &amp;<a class="code" href="top_8c.html#a017735088b9fcf1098ce134a77550ccf">confirm</a>, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01779"></a>01779 <span class="stringliteral">Set whether to confirm potentially dangerous operations.&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01780"></a>01780 <span class="stringliteral">Show whether to confirm potentially dangerous operations.&quot;</span>), NULL,
<a name="l01781"></a>01781                            NULL,
<a name="l01782"></a>01782                            show_confirm,
<a name="l01783"></a>01783                            &amp;<a class="code" href="cli-cmds_8c.html#a723e0174d833cba0aa82fb936a56c8fa">setlist</a>, &amp;<a class="code" href="cli-cmds_8c.html#a003932aa76fd3f41763ecc6bee5e2ca8">showlist</a>);
<a name="l01784"></a>01784 
<a name="l01785"></a>01785   <a class="code" href="cli-decode_8c.html#abe99e440fc306f22620b97664e584cff">add_setshow_zinteger_cmd</a> (<span class="stringliteral">&quot;annotate&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49a4994a96ac693a93b56bf997637605172">class_obscure</a>, &amp;<a class="code" href="defs_8h.html#a8936079e8ffb68b6dec711d3b35133ca">annotation_level</a>, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01786"></a>01786 <span class="stringliteral">Set annotation_level.&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01787"></a>01787 <span class="stringliteral">Show annotation_level.&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01788"></a>01788 <span class="stringliteral">0 == normal;     1 == fullname (for use when running under emacs)\n\</span>
<a name="l01789"></a>01789 <span class="stringliteral">2 == output annotated suitably for use by programs that control GDB.&quot;</span>),
<a name="l01790"></a>01790                             NULL,
<a name="l01791"></a>01791                             show_annotation_level,
<a name="l01792"></a>01792                             &amp;<a class="code" href="cli-cmds_8c.html#a723e0174d833cba0aa82fb936a56c8fa">setlist</a>, &amp;<a class="code" href="cli-cmds_8c.html#a003932aa76fd3f41763ecc6bee5e2ca8">showlist</a>);
<a name="l01793"></a>01793 
<a name="l01794"></a>01794   <a class="code" href="cli-decode_8c.html#ad86a0f135b6c546ae7ffbb41fd72e14f">add_setshow_boolean_cmd</a> (<span class="stringliteral">&quot;exec-done-display&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49a92be6efbab6bd9647a6f7a2862712d9b">class_support</a>,
<a name="l01795"></a>01795                            &amp;<a class="code" href="event-top_8c.html#a9a536d49f1c9d687a352e5c88c04d1ef">exec_done_display_p</a>, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01796"></a>01796 <span class="stringliteral">Set notification of completion for asynchronous execution commands.&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01797"></a>01797 <span class="stringliteral">Show notification of completion for asynchronous execution commands.&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01798"></a>01798 <span class="stringliteral">Use \&quot;on\&quot; to enable the notification, and \&quot;off\&quot; to disable it.&quot;</span>),
<a name="l01799"></a>01799                            NULL,
<a name="l01800"></a>01800                            show_exec_done_display_p,
<a name="l01801"></a>01801                            &amp;<a class="code" href="cli-cmds_8c.html#a723e0174d833cba0aa82fb936a56c8fa">setlist</a>, &amp;<a class="code" href="cli-cmds_8c.html#a003932aa76fd3f41763ecc6bee5e2ca8">showlist</a>);
<a name="l01802"></a>01802 
<a name="l01803"></a>01803   <a class="code" href="cli-decode_8c.html#a3f510a36ebb350d94e3f1d39f1a32da5">add_setshow_filename_cmd</a> (<span class="stringliteral">&quot;data-directory&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49a502c7b57c7172ac88ef735f68070bb59">class_maintenance</a>,
<a name="l01804"></a>01804                            &amp;<a class="code" href="defs_8h.html#a2a68e0f3434c752e89acdd14622b7751">gdb_datadir</a>, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Set GDB&#39;s data directory.&quot;</span>),
<a name="l01805"></a>01805                            <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Show GDB&#39;s data directory.&quot;</span>),
<a name="l01806"></a>01806                            <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01807"></a>01807 <span class="stringliteral">When set, GDB uses the specified path to search for data files.&quot;</span>),
<a name="l01808"></a>01808                            set_gdb_datadir, NULL,
<a name="l01809"></a>01809                            &amp;<a class="code" href="cli-cmds_8c.html#a723e0174d833cba0aa82fb936a56c8fa">setlist</a>,
<a name="l01810"></a>01810                            &amp;<a class="code" href="cli-cmds_8c.html#a003932aa76fd3f41763ecc6bee5e2ca8">showlist</a>);
<a name="l01811"></a>01811 }
<a name="l01812"></a>01812 
<a name="l01813"></a>01813 <span class="keywordtype">void</span>
<a name="l01814"></a><a class="code" href="top_8h.html#a5248dc63d4f3f1d79294ccacd9499481">01814</a> <a class="code" href="top_8c.html#a56d7665bc92c922b3148d639c1d8d430">gdb_init</a> (<span class="keywordtype">char</span> *argv0)
<a name="l01815"></a>01815 {
<a name="l01816"></a>01816   <span class="keywordflow">if</span> (<a class="code" href="top_8c.html#ac5d8f583190e2b41851732305ab28895">pre_init_ui_hook</a>)
<a name="l01817"></a>01817     <a class="code" href="top_8c.html#ac5d8f583190e2b41851732305ab28895">pre_init_ui_hook</a> ();
<a name="l01818"></a>01818 
<a name="l01819"></a>01819   <span class="comment">/* Run the init function of each source file.  */</span>
<a name="l01820"></a>01820 
<a name="l01821"></a>01821 <span class="preprocessor">#ifdef __MSDOS__</span>
<a name="l01822"></a>01822 <span class="preprocessor"></span>  <span class="comment">/* Make sure we return to the original directory upon exit, come</span>
<a name="l01823"></a>01823 <span class="comment">     what may, since the OS doesn&#39;t do that for us.  */</span>
<a name="l01824"></a>01824   <a class="code" href="cleanups_8c.html#a39fd22ed25eaf1c214d121729c39633a">make_final_cleanup</a> (do_chdir_cleanup, xstrdup (<a class="code" href="defs_8h.html#a6dd03da55f1ccd4375343b3a93aaf421">current_directory</a>));
<a name="l01825"></a>01825 <span class="preprocessor">#endif</span>
<a name="l01826"></a>01826 <span class="preprocessor"></span>
<a name="l01827"></a>01827   <a class="code" href="cli-cmds_8c.html#a6e140cd305500f149c12eec72753160b">init_cmd_lists</a> ();        <span class="comment">/* This needs to be done first.  */</span>
<a name="l01828"></a>01828   <a class="code" href="target_8c.html#ab8db364b1065076629008c145d7dc62c">initialize_targets</a> ();    <span class="comment">/* Setup target_terminal macros for utils.c.  */</span>
<a name="l01829"></a>01829   <a class="code" href="utils_8c.html#a7480d7111c0039262208a4249667d67b">initialize_utils</a> ();      <span class="comment">/* Make errors and warnings possible.  */</span>
<a name="l01830"></a>01830 
<a name="l01831"></a>01831   <span class="comment">/* Here is where we call all the _initialize_foo routines.  */</span>
<a name="l01832"></a>01832   <a class="code" href="top_8c.html#ab2e137e6483ebfa90e7c2998b2528045">initialize_all_files</a> ();
<a name="l01833"></a>01833 
<a name="l01834"></a>01834   <span class="comment">/* This creates the current_program_space.  Do this after all the</span>
<a name="l01835"></a>01835 <span class="comment">     _initialize_foo routines have had a chance to install their</span>
<a name="l01836"></a>01836 <span class="comment">     per-sspace data keys.  Also do this before</span>
<a name="l01837"></a>01837 <span class="comment">     initialize_current_architecture is called, because it accesses</span>
<a name="l01838"></a>01838 <span class="comment">     exec_bfd of the current program space.  */</span>
<a name="l01839"></a>01839   <a class="code" href="defs_8h.html#a79102ca2f4191f5b89409dfac4000401">initialize_progspace</a> ();
<a name="l01840"></a>01840   <a class="code" href="defs_8h.html#a189092f8f19d33cb4404875b4c3d0f1c">initialize_inferiors</a> ();
<a name="l01841"></a>01841   <a class="code" href="arch-utils_8c.html#a72b61a73aa959b14a8d8002073a63ebb">initialize_current_architecture</a> ();
<a name="l01842"></a>01842   <a class="code" href="cli-cmds_8c.html#a506094a4892b513418e7d766bea24a81">init_cli_cmds</a>();
<a name="l01843"></a>01843   <a class="code" href="event-loop_8c.html#a20272a491d23df122665d44c1e2845cc">initialize_event_loop</a> ();
<a name="l01844"></a>01844   init_main ();                 <span class="comment">/* But that omits this file!  Do it now.  */</span>
<a name="l01845"></a>01845 
<a name="l01846"></a>01846   <a class="code" href="inflow_8c.html#a2fa5cfaed881f1a87bb0dbcf57986c2a">initialize_stdin_serial</a> ();
<a name="l01847"></a>01847 
<a name="l01848"></a>01848   <a class="code" href="event-top_8c.html#a3a3e6200b45c4f51365d498577231a6a">async_init_signals</a> ();
<a name="l01849"></a>01849 
<a name="l01850"></a>01850   <span class="comment">/* We need a default language for parsing expressions, so simple</span>
<a name="l01851"></a>01851 <span class="comment">     things like &quot;set width 0&quot; won&#39;t fail if no language is explicitly</span>
<a name="l01852"></a>01852 <span class="comment">     set in a config file or implicitly set by reading an executable</span>
<a name="l01853"></a>01853 <span class="comment">     during startup.  */</span>
<a name="l01854"></a>01854   <a class="code" href="language_8c.html#a87176c846a3ec717ada5e5622fe18550">set_language</a> (<a class="code" href="defs_8h.html#aa37aa8979934d47ac32fd96ecff32202ad300f80a4c96edb04defba2280620a49">language_c</a>);
<a name="l01855"></a>01855   <a class="code" href="language_8c.html#afaa4a80e24d6393a28de7669d28196c1">expected_language</a> = <a class="code" href="language_8c.html#acd2505a014a95629da9c836f8914fc79">current_language</a>; <span class="comment">/* Don&#39;t warn about the change.  */</span>
<a name="l01856"></a>01856 
<a name="l01857"></a>01857   <span class="comment">/* Allow another UI to initialize.  If the UI fails to initialize,</span>
<a name="l01858"></a>01858 <span class="comment">     and it wants GDB to revert to the CLI, it should clear</span>
<a name="l01859"></a>01859 <span class="comment">     deprecated_init_ui_hook.  */</span>
<a name="l01860"></a>01860   <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a3996e2ec105f1b21bf1aa74eacd55822">deprecated_init_ui_hook</a>)
<a name="l01861"></a>01861     <a class="code" href="defs_8h.html#a3996e2ec105f1b21bf1aa74eacd55822">deprecated_init_ui_hook</a> (argv0);
<a name="l01862"></a>01862 
<a name="l01863"></a>01863 <span class="preprocessor">#ifdef HAVE_PYTHON</span>
<a name="l01864"></a>01864 <span class="preprocessor"></span>  <span class="comment">/* Python initialization can require various commands to be</span>
<a name="l01865"></a>01865 <span class="comment">     installed.  For example &quot;info pretty-printer&quot; needs the &quot;info&quot;</span>
<a name="l01866"></a>01866 <span class="comment">     prefix to be installed.  Keep things simple and just do final</span>
<a name="l01867"></a>01867 <span class="comment">     python initialization here.  */</span>
<a name="l01868"></a>01868   <a class="code" href="python_8h.html#aeff2665f871b33ae69ee1cf0b8095733">finish_python_initialization</a> ();
<a name="l01869"></a>01869 <span class="preprocessor">#endif</span>
<a name="l01870"></a>01870 <span class="preprocessor"></span>}
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Fri Oct 11 2013 14:12:27 for GDB (API) by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
