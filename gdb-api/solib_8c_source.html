<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>GDB (API): /home/stan/gdb/src/gdb/solib.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">GDB (API)
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">/home/stan/gdb/src/gdb/solib.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="solib_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* Handle shared libraries for GDB, the GNU Debugger.</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">   Copyright (C) 1990-2013 Free Software Foundation, Inc.</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">   This file is part of GDB.</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">   This program is free software; you can redistribute it and/or modify</span>
<a name="l00008"></a>00008 <span class="comment">   it under the terms of the GNU General Public License as published by</span>
<a name="l00009"></a>00009 <span class="comment">   the Free Software Foundation; either version 3 of the License, or</span>
<a name="l00010"></a>00010 <span class="comment">   (at your option) any later version.</span>
<a name="l00011"></a>00011 <span class="comment"></span>
<a name="l00012"></a>00012 <span class="comment">   This program is distributed in the hope that it will be useful,</span>
<a name="l00013"></a>00013 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00014"></a>00014 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00015"></a>00015 <span class="comment">   GNU General Public License for more details.</span>
<a name="l00016"></a>00016 <span class="comment"></span>
<a name="l00017"></a>00017 <span class="comment">   You should have received a copy of the GNU General Public License</span>
<a name="l00018"></a>00018 <span class="comment">   along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.  */</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="defs_8h.html">defs.h</a>&quot;</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="gdb__string_8h.html">gdb_string.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="symtab_8h.html">symtab.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;bfd.h&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="symfile_8h.html">symfile.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="objfiles_8h.html">objfiles.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="exceptions_8h.html">exceptions.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="gdbcore_8h.html">gdbcore.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="command_8h.html">command.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="target_8h.html">target.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="frame_8h.html">frame.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="gdb__regex_8h.html">gdb_regex.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="inferior_8h.html">inferior.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="environ_8h.html">environ.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="language_8h.html">language.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="gdbcmd_8h.html">gdbcmd.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="completer_8h.html">completer.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;filenames.h&quot;</span>          <span class="comment">/* for DOSish file names */</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="exec_8h.html">exec.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="solist_8h.html">solist.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="observer_8h.html">observer.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;readline/readline.h&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="remote_8h.html">remote.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="solib_8h.html">solib.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="interps_8h.html">interps.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="filesystem_8h.html">filesystem.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="gdb__bfd_8h.html">gdb_bfd.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="filestuff_8h.html">filestuff.h</a>&quot;</span>
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="comment">/* Architecture-specific operations.  */</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="comment">/* Per-architecture data key.  */</span>
<a name="l00055"></a>00055 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="gdbarch_8c.html#af5b48a62893f4f5f453c3c27ad3b44f7">gdbarch_data</a> *solib_data;
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 <span class="keyword">static</span> <span class="keywordtype">void</span> *
<a name="l00058"></a>00058 solib_init (<span class="keyword">struct</span> obstack *obstack)
<a name="l00059"></a>00059 {
<a name="l00060"></a>00060   <span class="keyword">struct </span><a class="code" href="structtarget__so__ops.html">target_so_ops</a> **ops;
<a name="l00061"></a>00061 
<a name="l00062"></a>00062   ops = <a class="code" href="gdb__obstack_8h.html#a3852d9feffb1b3682384631c1356ad3e">OBSTACK_ZALLOC</a> (obstack, <span class="keyword">struct</span> <a class="code" href="structtarget__so__ops.html">target_so_ops</a> *);
<a name="l00063"></a>00063   *ops = <a class="code" href="solib_8c.html#a60ff5a15995af3c0b8a7f05f4036da77">current_target_so_ops</a>;
<a name="l00064"></a>00064   <span class="keywordflow">return</span> ops;
<a name="l00065"></a>00065 }
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtarget__so__ops.html">target_so_ops</a> *
<a name="l00068"></a>00068 solib_ops (<span class="keyword">struct</span> gdbarch *gdbarch)
<a name="l00069"></a>00069 {
<a name="l00070"></a>00070   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtarget__so__ops.html">target_so_ops</a> **ops = <a class="code" href="gdbarch_8c.html#af5b48a62893f4f5f453c3c27ad3b44f7">gdbarch_data</a> (gdbarch, solib_data);
<a name="l00071"></a>00071 
<a name="l00072"></a>00072   <span class="keywordflow">return</span> *ops;
<a name="l00073"></a>00073 }
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <span class="comment">/* Set the solib operations for GDBARCH to NEW_OPS.  */</span>
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 <span class="keywordtype">void</span>
<a name="l00078"></a><a class="code" href="solib_8h.html#a17e243f2c7b22e10ef981fb7defc8b52">00078</a> <a class="code" href="solib_8c.html#a17e243f2c7b22e10ef981fb7defc8b52">set_solib_ops</a> (<span class="keyword">struct</span> gdbarch *gdbarch, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structtarget__so__ops.html">target_so_ops</a> *new_ops)
<a name="l00079"></a>00079 {
<a name="l00080"></a>00080   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtarget__so__ops.html">target_so_ops</a> **ops = <a class="code" href="gdbarch_8c.html#af5b48a62893f4f5f453c3c27ad3b44f7">gdbarch_data</a> (gdbarch, solib_data);
<a name="l00081"></a>00081 
<a name="l00082"></a>00082   *ops = new_ops;
<a name="l00083"></a>00083 }
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 <span class="comment">/* external data declarations */</span>
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 <span class="comment">/* FIXME: gdbarch needs to control this variable, or else every</span>
<a name="l00089"></a>00089 <span class="comment">   configuration needs to call set_solib_ops.  */</span>
<a name="l00090"></a><a class="code" href="solist_8h.html#a60ff5a15995af3c0b8a7f05f4036da77">00090</a> <span class="keyword">struct </span><a class="code" href="structtarget__so__ops.html">target_so_ops</a> *<a class="code" href="solib_8c.html#a60ff5a15995af3c0b8a7f05f4036da77">current_target_so_ops</a>;
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <span class="comment">/* List of known shared objects */</span>
<a name="l00093"></a><a class="code" href="solib_8c.html#ab94f6b7dba8e4f80e8895695f826278d">00093</a> <span class="preprocessor">#define so_list_head current_program_space-&gt;so_list</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span>
<a name="l00095"></a>00095 <span class="comment">/* Local function prototypes */</span>
<a name="l00096"></a>00096 
<a name="l00097"></a>00097 <span class="comment">/* If non-empty, this is a search path for loading non-absolute shared library</span>
<a name="l00098"></a>00098 <span class="comment">   symbol files.  This takes precedence over the environment variables PATH</span>
<a name="l00099"></a>00099 <span class="comment">   and LD_LIBRARY_PATH.  */</span>
<a name="l00100"></a>00100 <span class="keyword">static</span> <span class="keywordtype">char</span> *solib_search_path = NULL;
<a name="l00101"></a>00101 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00102"></a>00102 show_solib_search_path (<span class="keyword">struct</span> ui_file *file, <span class="keywordtype">int</span> from_tty,
<a name="l00103"></a>00103                         <span class="keyword">struct</span> <a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *value)
<a name="l00104"></a>00104 {
<a name="l00105"></a>00105   <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (file, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;The search path for loading non-absolute &quot;</span>
<a name="l00106"></a>00106                             <span class="stringliteral">&quot;shared library symbol files is %s.\n&quot;</span>),
<a name="l00107"></a>00107                     value);
<a name="l00108"></a>00108 }
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 <span class="comment">/* Same as HAVE_DOS_BASED_FILE_SYSTEM, but useable as an rvalue.  */</span>
<a name="l00111"></a>00111 <span class="preprocessor">#if (HAVE_DOS_BASED_FILE_SYSTEM)</span>
<a name="l00112"></a>00112 <span class="preprocessor"></span><span class="preprocessor">#  define DOS_BASED_FILE_SYSTEM 1</span>
<a name="l00113"></a>00113 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00114"></a><a class="code" href="solib_8c.html#a5aaebbae1acbb763d4cc30a21b41c2c1">00114</a> <span class="preprocessor"></span><span class="preprocessor">#  define DOS_BASED_FILE_SYSTEM 0</span>
<a name="l00115"></a>00115 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00116"></a>00116 <span class="preprocessor"></span>
<a name="l00117"></a>00117 <span class="comment">/* Returns the full pathname of the shared library file, or NULL if</span>
<a name="l00118"></a>00118 <span class="comment">   not found.  (The pathname is malloc&#39;ed; it needs to be freed by the</span>
<a name="l00119"></a>00119 <span class="comment">   caller.)  *FD is set to either -1 or an open file handle for the</span>
<a name="l00120"></a>00120 <span class="comment">   library.</span>
<a name="l00121"></a>00121 <span class="comment"></span>
<a name="l00122"></a>00122 <span class="comment">   Global variable GDB_SYSROOT is used as a prefix directory</span>
<a name="l00123"></a>00123 <span class="comment">   to search for shared libraries if they have an absolute path.</span>
<a name="l00124"></a>00124 <span class="comment"></span>
<a name="l00125"></a>00125 <span class="comment">   Global variable SOLIB_SEARCH_PATH is used as a prefix directory</span>
<a name="l00126"></a>00126 <span class="comment">   (or set of directories, as in LD_LIBRARY_PATH) to search for all</span>
<a name="l00127"></a>00127 <span class="comment">   shared libraries if not found in GDB_SYSROOT.</span>
<a name="l00128"></a>00128 <span class="comment"></span>
<a name="l00129"></a>00129 <span class="comment">   Search algorithm:</span>
<a name="l00130"></a>00130 <span class="comment">   * If there is a gdb_sysroot and path is absolute:</span>
<a name="l00131"></a>00131 <span class="comment">   *   Search for gdb_sysroot/path.</span>
<a name="l00132"></a>00132 <span class="comment">   * else</span>
<a name="l00133"></a>00133 <span class="comment">   *   Look for it literally (unmodified).</span>
<a name="l00134"></a>00134 <span class="comment">   * Look in SOLIB_SEARCH_PATH.</span>
<a name="l00135"></a>00135 <span class="comment">   * If available, use target defined search function.</span>
<a name="l00136"></a>00136 <span class="comment">   * If gdb_sysroot is NOT set, perform the following two searches:</span>
<a name="l00137"></a>00137 <span class="comment">   *   Look in inferior&#39;s $PATH.</span>
<a name="l00138"></a>00138 <span class="comment">   *   Look in inferior&#39;s $LD_LIBRARY_PATH.</span>
<a name="l00139"></a>00139 <span class="comment">   *</span>
<a name="l00140"></a>00140 <span class="comment">   * The last check avoids doing this search when targetting remote</span>
<a name="l00141"></a>00141 <span class="comment">   * machines since gdb_sysroot will almost always be set.</span>
<a name="l00142"></a>00142 <span class="comment">*/</span>
<a name="l00143"></a>00143 
<a name="l00144"></a>00144 <span class="keywordtype">char</span> *
<a name="l00145"></a><a class="code" href="solist_8h.html#a941fccccb29fcd280cf83b1e08f60435">00145</a> <a class="code" href="solib_8c.html#a941fccccb29fcd280cf83b1e08f60435">solib_find</a> (<span class="keywordtype">char</span> *in_pathname, <span class="keywordtype">int</span> *fd)
<a name="l00146"></a>00146 {
<a name="l00147"></a>00147   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtarget__so__ops.html">target_so_ops</a> *ops = solib_ops (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ());
<a name="l00148"></a>00148   <span class="keywordtype">int</span> found_file = -1;
<a name="l00149"></a>00149   <span class="keywordtype">char</span> *temp_pathname = NULL;
<a name="l00150"></a>00150   <span class="keywordtype">int</span> gdb_sysroot_is_empty;
<a name="l00151"></a>00151   <span class="keyword">const</span> <span class="keywordtype">char</span> *solib_symbols_extension
<a name="l00152"></a>00152     = <a class="code" href="gdbarch_8c.html#aa769d65ff241b92c6e2d6069a278c2d6">gdbarch_solib_symbols_extension</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ());
<a name="l00153"></a>00153   <span class="keyword">const</span> <span class="keywordtype">char</span> *fskind = <a class="code" href="filesystem_8c.html#a2ec4f72694e54016cb09f9eec523593c">effective_target_file_system_kind</a> ();
<a name="l00154"></a>00154   <span class="keyword">struct </span>cleanup *old_chain = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="cleanups_8c.html#a1ec2a3980c2be1f31f2142103d1f7abf">null_cleanup</a>, NULL);
<a name="l00155"></a>00155   <span class="keywordtype">char</span> *sysroot = NULL;
<a name="l00156"></a>00156 
<a name="l00157"></a>00157   <span class="comment">/* If solib_symbols_extension is set, replace the file&#39;s</span>
<a name="l00158"></a>00158 <span class="comment">     extension.  */</span>
<a name="l00159"></a>00159   <span class="keywordflow">if</span> (solib_symbols_extension)
<a name="l00160"></a>00160     {
<a name="l00161"></a>00161       <span class="keywordtype">char</span> *<a class="code" href="windows-nat_8c.html#ade66e4ccafbc33b117610bbc0d85feb0">p</a> = in_pathname + strlen (in_pathname);
<a name="l00162"></a>00162 
<a name="l00163"></a>00163       <span class="keywordflow">while</span> (p &gt; in_pathname &amp;&amp; *p != <span class="charliteral">&#39;.&#39;</span>)
<a name="l00164"></a>00164         p--;
<a name="l00165"></a>00165 
<a name="l00166"></a>00166       <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;.&#39;</span>)
<a name="l00167"></a>00167         {
<a name="l00168"></a>00168           <span class="keywordtype">char</span> *new_pathname;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170           new_pathname = alloca (p - in_pathname + 1
<a name="l00171"></a>00171                                  + strlen (solib_symbols_extension) + 1);
<a name="l00172"></a>00172           <a class="code" href="gdb__string_8h.html#a39ebe6a4e122707997e78b549a1e8c5e">memcpy</a> (new_pathname, in_pathname, p - in_pathname + 1);
<a name="l00173"></a>00173           strcpy (new_pathname + (p - in_pathname) + 1,
<a name="l00174"></a>00174                   solib_symbols_extension);
<a name="l00175"></a>00175 
<a name="l00176"></a>00176           in_pathname = new_pathname;
<a name="l00177"></a>00177         }
<a name="l00178"></a>00178     }
<a name="l00179"></a>00179 
<a name="l00180"></a>00180   gdb_sysroot_is_empty = (<a class="code" href="defs_8h.html#ac0f15758d6e7079c77d69b95ea5c6bf4">gdb_sysroot</a> == NULL || *<a class="code" href="defs_8h.html#ac0f15758d6e7079c77d69b95ea5c6bf4">gdb_sysroot</a> == 0);
<a name="l00181"></a>00181 
<a name="l00182"></a>00182   <span class="keywordflow">if</span> (!gdb_sysroot_is_empty)
<a name="l00183"></a>00183     {
<a name="l00184"></a>00184       <span class="keywordtype">int</span> prefix_len = strlen (<a class="code" href="defs_8h.html#ac0f15758d6e7079c77d69b95ea5c6bf4">gdb_sysroot</a>);
<a name="l00185"></a>00185 
<a name="l00186"></a>00186       <span class="comment">/* Remove trailing slashes from absolute prefix.  */</span>
<a name="l00187"></a>00187       <span class="keywordflow">while</span> (prefix_len &gt; 0
<a name="l00188"></a>00188              &amp;&amp; IS_DIR_SEPARATOR (<a class="code" href="defs_8h.html#ac0f15758d6e7079c77d69b95ea5c6bf4">gdb_sysroot</a>[prefix_len - 1]))
<a name="l00189"></a>00189         prefix_len--;
<a name="l00190"></a>00190 
<a name="l00191"></a>00191       sysroot = <a class="code" href="common-utils_8c.html#a5f388f89054b57d850779d7d71bc4d1c">savestring</a> (<a class="code" href="defs_8h.html#ac0f15758d6e7079c77d69b95ea5c6bf4">gdb_sysroot</a>, prefix_len);
<a name="l00192"></a>00192       <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, sysroot);
<a name="l00193"></a>00193     }
<a name="l00194"></a>00194 
<a name="l00195"></a>00195   <span class="comment">/* If we&#39;re on a non-DOS-based system, backslashes won&#39;t be</span>
<a name="l00196"></a>00196 <span class="comment">     understood as directory separator, so, convert them to forward</span>
<a name="l00197"></a>00197 <span class="comment">     slashes, iff we&#39;re supposed to handle DOS-based file system</span>
<a name="l00198"></a>00198 <span class="comment">     semantics for target paths.  */</span>
<a name="l00199"></a>00199   <span class="keywordflow">if</span> (!<a class="code" href="solib_8c.html#a5aaebbae1acbb763d4cc30a21b41c2c1">DOS_BASED_FILE_SYSTEM</a> &amp;&amp; fskind == <a class="code" href="filesystem_8c.html#a8a6537bd3d86c9301ff8cdc8b24e2e9d">file_system_kind_dos_based</a>)
<a name="l00200"></a>00200     {
<a name="l00201"></a>00201       <span class="keywordtype">char</span> *<a class="code" href="windows-nat_8c.html#ade66e4ccafbc33b117610bbc0d85feb0">p</a>;
<a name="l00202"></a>00202 
<a name="l00203"></a>00203       <span class="comment">/* Avoid clobbering our input.  */</span>
<a name="l00204"></a>00204       p = alloca (strlen (in_pathname) + 1);
<a name="l00205"></a>00205       strcpy (p, in_pathname);
<a name="l00206"></a>00206       in_pathname = p;
<a name="l00207"></a>00207 
<a name="l00208"></a>00208       <span class="keywordflow">for</span> (; *p; p++)
<a name="l00209"></a>00209         {
<a name="l00210"></a>00210           <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;\\&#39;</span>)
<a name="l00211"></a>00211             *p = <span class="charliteral">&#39;/&#39;</span>;
<a name="l00212"></a>00212         }
<a name="l00213"></a>00213     }
<a name="l00214"></a>00214 
<a name="l00215"></a>00215   <span class="comment">/* Note, we&#39;re interested in IS_TARGET_ABSOLUTE_PATH, not</span>
<a name="l00216"></a>00216 <span class="comment">     IS_ABSOLUTE_PATH.  The latter is for host paths only, while</span>
<a name="l00217"></a>00217 <span class="comment">     IN_PATHNAME is a target path.  For example, if we&#39;re supposed to</span>
<a name="l00218"></a>00218 <span class="comment">     be handling DOS-like semantics we want to consider a</span>
<a name="l00219"></a>00219 <span class="comment">     &#39;c:/foo/bar.dll&#39; path as an absolute path, even on a Unix box.</span>
<a name="l00220"></a>00220 <span class="comment">     With such a path, before giving up on the sysroot, we&#39;ll try:</span>
<a name="l00221"></a>00221 <span class="comment"></span>
<a name="l00222"></a>00222 <span class="comment">       1st attempt, c:/foo/bar.dll ==&gt; /sysroot/c:/foo/bar.dll</span>
<a name="l00223"></a>00223 <span class="comment">       2nd attempt, c:/foo/bar.dll ==&gt; /sysroot/c/foo/bar.dll</span>
<a name="l00224"></a>00224 <span class="comment">       3rd attempt, c:/foo/bar.dll ==&gt; /sysroot/foo/bar.dll</span>
<a name="l00225"></a>00225 <span class="comment">  */</span>
<a name="l00226"></a>00226 
<a name="l00227"></a>00227   <span class="keywordflow">if</span> (!<a class="code" href="filesystem_8h.html#a30ee0e77d251290bfd44e2ff9be61bc6">IS_TARGET_ABSOLUTE_PATH</a> (fskind, in_pathname) || gdb_sysroot_is_empty)
<a name="l00228"></a>00228     temp_pathname = xstrdup (in_pathname);
<a name="l00229"></a>00229   <span class="keywordflow">else</span>
<a name="l00230"></a>00230     {
<a name="l00231"></a>00231       <span class="keywordtype">int</span> need_dir_separator;
<a name="l00232"></a>00232 
<a name="l00233"></a>00233       <span class="comment">/* Concatenate the sysroot and the target reported filename.  We</span>
<a name="l00234"></a>00234 <span class="comment">         may need to glue them with a directory separator.  Cases to</span>
<a name="l00235"></a>00235 <span class="comment">         consider:</span>
<a name="l00236"></a>00236 <span class="comment"></span>
<a name="l00237"></a>00237 <span class="comment">        | sysroot         | separator | in_pathname    |</span>
<a name="l00238"></a>00238 <span class="comment">        |-----------------+-----------+----------------|</span>
<a name="l00239"></a>00239 <span class="comment">        | /some/dir       | /         | c:/foo/bar.dll |</span>
<a name="l00240"></a>00240 <span class="comment">        | /some/dir       |           | /foo/bar.dll   |</span>
<a name="l00241"></a>00241 <span class="comment">        | remote:         |           | c:/foo/bar.dll |</span>
<a name="l00242"></a>00242 <span class="comment">        | remote:         |           | /foo/bar.dll   |</span>
<a name="l00243"></a>00243 <span class="comment">        | remote:some/dir | /         | c:/foo/bar.dll |</span>
<a name="l00244"></a>00244 <span class="comment">        | remote:some/dir |           | /foo/bar.dll   |</span>
<a name="l00245"></a>00245 <span class="comment"></span>
<a name="l00246"></a>00246 <span class="comment">        IOW, we don&#39;t need to add a separator if IN_PATHNAME already</span>
<a name="l00247"></a>00247 <span class="comment">        has one, or when the the sysroot is exactly &quot;remote:&quot;.</span>
<a name="l00248"></a>00248 <span class="comment">        There&#39;s no need to check for drive spec explicitly, as we only</span>
<a name="l00249"></a>00249 <span class="comment">        get here if IN_PATHNAME is considered an absolute path.  */</span>
<a name="l00250"></a>00250       need_dir_separator = !(IS_DIR_SEPARATOR (in_pathname[0])
<a name="l00251"></a>00251                              || strcmp (<a class="code" href="remote_8h.html#aae45f416fafb37038cfe19715bbbd8fd">REMOTE_SYSROOT_PREFIX</a>, sysroot) == 0);
<a name="l00252"></a>00252 
<a name="l00253"></a>00253       <span class="comment">/* Cat the prefixed pathname together.  */</span>
<a name="l00254"></a>00254       temp_pathname = concat (sysroot,
<a name="l00255"></a>00255                               need_dir_separator ? SLASH_STRING : <span class="stringliteral">&quot;&quot;</span>,
<a name="l00256"></a>00256                               in_pathname, (<span class="keywordtype">char</span> *) NULL);
<a name="l00257"></a>00257     }
<a name="l00258"></a>00258 
<a name="l00259"></a>00259   <span class="comment">/* Handle remote files.  */</span>
<a name="l00260"></a>00260   <span class="keywordflow">if</span> (<a class="code" href="remote_8c.html#ab3344d665d71ca12c6a92c2e4f1c6a6e">remote_filename_p</a> (temp_pathname))
<a name="l00261"></a>00261     {
<a name="l00262"></a>00262       *fd = -1;
<a name="l00263"></a>00263       <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l00264"></a>00264       <span class="keywordflow">return</span> temp_pathname;
<a name="l00265"></a>00265     }
<a name="l00266"></a>00266 
<a name="l00267"></a>00267   <span class="comment">/* Now see if we can open it.  */</span>
<a name="l00268"></a>00268   found_file = <a class="code" href="filestuff_8c.html#adf94e72f9c914500c8b9b5d1e66de811">gdb_open_cloexec</a> (temp_pathname, O_RDONLY | O_BINARY, 0);
<a name="l00269"></a>00269   <span class="keywordflow">if</span> (found_file &lt; 0)
<a name="l00270"></a>00270     <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (temp_pathname);
<a name="l00271"></a>00271 
<a name="l00272"></a>00272   <span class="comment">/* If the search in gdb_sysroot failed, and the path name has a</span>
<a name="l00273"></a>00273 <span class="comment">     drive spec (e.g, c:/foo), try stripping &#39;:&#39; from the drive spec,</span>
<a name="l00274"></a>00274 <span class="comment">     and retrying in the sysroot:</span>
<a name="l00275"></a>00275 <span class="comment">       c:/foo/bar.dll ==&gt; /sysroot/c/foo/bar.dll.  */</span>
<a name="l00276"></a>00276 
<a name="l00277"></a>00277   <span class="keywordflow">if</span> (found_file &lt; 0
<a name="l00278"></a>00278       &amp;&amp; !gdb_sysroot_is_empty
<a name="l00279"></a>00279       &amp;&amp; <a class="code" href="filesystem_8h.html#a8fc92dffc1a66bb739ed86c38ff98380">HAS_TARGET_DRIVE_SPEC</a> (fskind, in_pathname))
<a name="l00280"></a>00280     {
<a name="l00281"></a>00281       <span class="keywordtype">int</span> need_dir_separator = !IS_DIR_SEPARATOR (in_pathname[2]);
<a name="l00282"></a>00282       <span class="keywordtype">char</span> *drive = <a class="code" href="common-utils_8c.html#a5f388f89054b57d850779d7d71bc4d1c">savestring</a> (in_pathname, 1);
<a name="l00283"></a>00283 
<a name="l00284"></a>00284       temp_pathname = concat (sysroot,
<a name="l00285"></a>00285                               SLASH_STRING,
<a name="l00286"></a>00286                               drive,
<a name="l00287"></a>00287                               need_dir_separator ? SLASH_STRING : <span class="stringliteral">&quot;&quot;</span>,
<a name="l00288"></a>00288                               in_pathname + 2, (<span class="keywordtype">char</span> *) NULL);
<a name="l00289"></a>00289       <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (drive);
<a name="l00290"></a>00290 
<a name="l00291"></a>00291       found_file = <a class="code" href="filestuff_8c.html#adf94e72f9c914500c8b9b5d1e66de811">gdb_open_cloexec</a> (temp_pathname, O_RDONLY | O_BINARY, 0);
<a name="l00292"></a>00292       <span class="keywordflow">if</span> (found_file &lt; 0)
<a name="l00293"></a>00293         {
<a name="l00294"></a>00294           <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (temp_pathname);
<a name="l00295"></a>00295 
<a name="l00296"></a>00296           <span class="comment">/* If the search in gdb_sysroot still failed, try fully</span>
<a name="l00297"></a>00297 <span class="comment">             stripping the drive spec, and trying once more in the</span>
<a name="l00298"></a>00298 <span class="comment">             sysroot before giving up.</span>
<a name="l00299"></a>00299 <span class="comment"></span>
<a name="l00300"></a>00300 <span class="comment">             c:/foo/bar.dll ==&gt; /sysroot/foo/bar.dll.  */</span>
<a name="l00301"></a>00301 
<a name="l00302"></a>00302           temp_pathname = concat (sysroot,
<a name="l00303"></a>00303                                   need_dir_separator ? SLASH_STRING : <span class="stringliteral">&quot;&quot;</span>,
<a name="l00304"></a>00304                                   in_pathname + 2, (<span class="keywordtype">char</span> *) NULL);
<a name="l00305"></a>00305 
<a name="l00306"></a>00306           found_file = <a class="code" href="filestuff_8c.html#adf94e72f9c914500c8b9b5d1e66de811">gdb_open_cloexec</a> (temp_pathname, O_RDONLY | O_BINARY, 0);
<a name="l00307"></a>00307           <span class="keywordflow">if</span> (found_file &lt; 0)
<a name="l00308"></a>00308             <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (temp_pathname);
<a name="l00309"></a>00309         }
<a name="l00310"></a>00310     }
<a name="l00311"></a>00311 
<a name="l00312"></a>00312   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l00313"></a>00313 
<a name="l00314"></a>00314   <span class="comment">/* We try to find the library in various ways.  After each attempt,</span>
<a name="l00315"></a>00315 <span class="comment">     either found_file &gt;= 0 and temp_pathname is a malloc&#39;d string, or</span>
<a name="l00316"></a>00316 <span class="comment">     found_file &lt; 0 and temp_pathname does not point to storage that</span>
<a name="l00317"></a>00317 <span class="comment">     needs to be freed.  */</span>
<a name="l00318"></a>00318 
<a name="l00319"></a>00319   <span class="keywordflow">if</span> (found_file &lt; 0)
<a name="l00320"></a>00320     temp_pathname = NULL;
<a name="l00321"></a>00321 
<a name="l00322"></a>00322   <span class="comment">/* If the search in gdb_sysroot failed, and the path name is</span>
<a name="l00323"></a>00323 <span class="comment">     absolute at this point, make it relative.  (openp will try and open the</span>
<a name="l00324"></a>00324 <span class="comment">     file according to its absolute path otherwise, which is not what we want.)</span>
<a name="l00325"></a>00325 <span class="comment">     Affects subsequent searches for this solib.  */</span>
<a name="l00326"></a>00326   <span class="keywordflow">if</span> (found_file &lt; 0 &amp;&amp; <a class="code" href="filesystem_8h.html#a30ee0e77d251290bfd44e2ff9be61bc6">IS_TARGET_ABSOLUTE_PATH</a> (fskind, in_pathname))
<a name="l00327"></a>00327     {
<a name="l00328"></a>00328       <span class="comment">/* First, get rid of any drive letters etc.  */</span>
<a name="l00329"></a>00329       <span class="keywordflow">while</span> (!<a class="code" href="filesystem_8h.html#aa1b1d9596fac47c2588a51ec9e7d3869">IS_TARGET_DIR_SEPARATOR</a> (fskind, *in_pathname))
<a name="l00330"></a>00330         in_pathname++;
<a name="l00331"></a>00331 
<a name="l00332"></a>00332       <span class="comment">/* Next, get rid of all leading dir separators.  */</span>
<a name="l00333"></a>00333       <span class="keywordflow">while</span> (<a class="code" href="filesystem_8h.html#aa1b1d9596fac47c2588a51ec9e7d3869">IS_TARGET_DIR_SEPARATOR</a> (fskind, *in_pathname))
<a name="l00334"></a>00334         in_pathname++;
<a name="l00335"></a>00335     }
<a name="l00336"></a>00336 
<a name="l00337"></a>00337   <span class="comment">/* If not found, search the solib_search_path (if any).  */</span>
<a name="l00338"></a>00338   <span class="keywordflow">if</span> (found_file &lt; 0 &amp;&amp; solib_search_path != NULL)
<a name="l00339"></a>00339     found_file = <a class="code" href="defs_8h.html#ad1c5ec0f63e79e6293a00ca1a30de767">openp</a> (solib_search_path,
<a name="l00340"></a>00340                         <a class="code" href="defs_8h.html#acfe2ebd7990c064286b8551ae1fd042f">OPF_TRY_CWD_FIRST</a> | <a class="code" href="defs_8h.html#aa669554d54e1c74b6654a123f95205ff">OPF_RETURN_REALPATH</a>,
<a name="l00341"></a>00341                         in_pathname, O_RDONLY | O_BINARY, &amp;temp_pathname);
<a name="l00342"></a>00342 
<a name="l00343"></a>00343   <span class="comment">/* If not found, next search the solib_search_path (if any) for the basename</span>
<a name="l00344"></a>00344 <span class="comment">     only (ignoring the path).  This is to allow reading solibs from a path</span>
<a name="l00345"></a>00345 <span class="comment">     that differs from the opened path.  */</span>
<a name="l00346"></a>00346   <span class="keywordflow">if</span> (found_file &lt; 0 &amp;&amp; solib_search_path != NULL)
<a name="l00347"></a>00347     found_file = <a class="code" href="defs_8h.html#ad1c5ec0f63e79e6293a00ca1a30de767">openp</a> (solib_search_path,
<a name="l00348"></a>00348                         <a class="code" href="defs_8h.html#acfe2ebd7990c064286b8551ae1fd042f">OPF_TRY_CWD_FIRST</a> | <a class="code" href="defs_8h.html#aa669554d54e1c74b6654a123f95205ff">OPF_RETURN_REALPATH</a>,
<a name="l00349"></a>00349                         <a class="code" href="filesystem_8c.html#ab48550c2e96d90689005e96f011cc27f">target_lbasename</a> (fskind, in_pathname),
<a name="l00350"></a>00350                         O_RDONLY | O_BINARY, &amp;temp_pathname);
<a name="l00351"></a>00351 
<a name="l00352"></a>00352   <span class="comment">/* If not found, try to use target supplied solib search method.  */</span>
<a name="l00353"></a>00353   <span class="keywordflow">if</span> (found_file &lt; 0 &amp;&amp; ops-&gt;find_and_open_solib)
<a name="l00354"></a>00354     found_file = ops-&gt;<a class="code" href="structtarget__so__ops.html#a18287e2915fb1c85400fee218793c081">find_and_open_solib</a> (in_pathname, O_RDONLY | O_BINARY,
<a name="l00355"></a>00355                                            &amp;temp_pathname);
<a name="l00356"></a>00356 
<a name="l00357"></a>00357   <span class="comment">/* If not found, next search the inferior&#39;s $PATH environment variable.  */</span>
<a name="l00358"></a>00358   <span class="keywordflow">if</span> (found_file &lt; 0 &amp;&amp; gdb_sysroot_is_empty)
<a name="l00359"></a>00359     found_file = <a class="code" href="defs_8h.html#ad1c5ec0f63e79e6293a00ca1a30de767">openp</a> (<a class="code" href="environ_8c.html#af9307a232ff712ae0cb4929db855b61b">get_in_environ</a> (<a class="code" href="inferior_8c.html#a9e592c83e7c0c1f89f1a4a392bd1a277">current_inferior</a> ()-&gt;environment,
<a name="l00360"></a>00360                                         <span class="stringliteral">&quot;PATH&quot;</span>),
<a name="l00361"></a>00361                         <a class="code" href="defs_8h.html#acfe2ebd7990c064286b8551ae1fd042f">OPF_TRY_CWD_FIRST</a> | <a class="code" href="defs_8h.html#aa669554d54e1c74b6654a123f95205ff">OPF_RETURN_REALPATH</a>, in_pathname,
<a name="l00362"></a>00362                         O_RDONLY | O_BINARY, &amp;temp_pathname);
<a name="l00363"></a>00363 
<a name="l00364"></a>00364   <span class="comment">/* If not found, next search the inferior&#39;s $LD_LIBRARY_PATH</span>
<a name="l00365"></a>00365 <span class="comment">     environment variable.  */</span>
<a name="l00366"></a>00366   <span class="keywordflow">if</span> (found_file &lt; 0 &amp;&amp; gdb_sysroot_is_empty)
<a name="l00367"></a>00367     found_file = <a class="code" href="defs_8h.html#ad1c5ec0f63e79e6293a00ca1a30de767">openp</a> (<a class="code" href="environ_8c.html#af9307a232ff712ae0cb4929db855b61b">get_in_environ</a> (<a class="code" href="inferior_8c.html#a9e592c83e7c0c1f89f1a4a392bd1a277">current_inferior</a> ()-&gt;environment,
<a name="l00368"></a>00368                                         <span class="stringliteral">&quot;LD_LIBRARY_PATH&quot;</span>),
<a name="l00369"></a>00369                         <a class="code" href="defs_8h.html#acfe2ebd7990c064286b8551ae1fd042f">OPF_TRY_CWD_FIRST</a> | <a class="code" href="defs_8h.html#aa669554d54e1c74b6654a123f95205ff">OPF_RETURN_REALPATH</a>, in_pathname,
<a name="l00370"></a>00370                         O_RDONLY | O_BINARY, &amp;temp_pathname);
<a name="l00371"></a>00371 
<a name="l00372"></a>00372   *fd = found_file;
<a name="l00373"></a>00373   <span class="keywordflow">return</span> temp_pathname;
<a name="l00374"></a>00374 }
<a name="l00375"></a>00375 
<a name="l00376"></a>00376 <span class="comment">/* Open and return a BFD for the shared library PATHNAME.  If FD is not -1,</span>
<a name="l00377"></a>00377 <span class="comment">   it is used as file handle to open the file.  Throws an error if the file</span>
<a name="l00378"></a>00378 <span class="comment">   could not be opened.  Handles both local and remote file access.</span>
<a name="l00379"></a>00379 <span class="comment"></span>
<a name="l00380"></a>00380 <span class="comment">   PATHNAME must be malloc&#39;ed by the caller.  It will be freed by this</span>
<a name="l00381"></a>00381 <span class="comment">   function.  If unsuccessful, the FD will be closed (unless FD was</span>
<a name="l00382"></a>00382 <span class="comment">   -1).  */</span>
<a name="l00383"></a>00383 
<a name="l00384"></a>00384 bfd *
<a name="l00385"></a><a class="code" href="solist_8h.html#ad58623753ea41f70d2e9bf485f6ff9a4">00385</a> <a class="code" href="solib_8c.html#ad58623753ea41f70d2e9bf485f6ff9a4">solib_bfd_fopen</a> (<span class="keywordtype">char</span> *pathname, <span class="keywordtype">int</span> fd)
<a name="l00386"></a>00386 {
<a name="l00387"></a>00387   bfd *abfd;
<a name="l00388"></a>00388 
<a name="l00389"></a>00389   <span class="keywordflow">if</span> (<a class="code" href="remote_8c.html#ab3344d665d71ca12c6a92c2e4f1c6a6e">remote_filename_p</a> (pathname))
<a name="l00390"></a>00390     {
<a name="l00391"></a>00391       <a class="code" href="gdb__assert_8h.html#aeb007d3e990858c7ef8e40a7e512c1ff">gdb_assert</a> (fd == -1);
<a name="l00392"></a>00392       abfd = <a class="code" href="remote_8c.html#a12f668fd095ae0b4ec1b24060e469ff6">remote_bfd_open</a> (pathname, <a class="code" href="corefile_8c.html#aa6db5afe2b3bfa2cec356b9e68eea21d">gnutarget</a>);
<a name="l00393"></a>00393     }
<a name="l00394"></a>00394   <span class="keywordflow">else</span>
<a name="l00395"></a>00395     {
<a name="l00396"></a>00396       abfd = <a class="code" href="gdb__bfd_8c.html#a5ba645a00a78462b46b2d0c3445eb988">gdb_bfd_open</a> (pathname, <a class="code" href="corefile_8c.html#aa6db5afe2b3bfa2cec356b9e68eea21d">gnutarget</a>, fd);
<a name="l00397"></a>00397 
<a name="l00398"></a>00398       <span class="keywordflow">if</span> (abfd)
<a name="l00399"></a>00399         bfd_set_cacheable (abfd, 1);
<a name="l00400"></a>00400     }
<a name="l00401"></a>00401 
<a name="l00402"></a>00402   <span class="keywordflow">if</span> (!abfd)
<a name="l00403"></a>00403     {
<a name="l00404"></a>00404       <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, pathname);
<a name="l00405"></a>00405       <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Could not open `%s&#39; as an executable file: %s&quot;</span>),
<a name="l00406"></a>00406              pathname, bfd_errmsg (bfd_get_error ()));
<a name="l00407"></a>00407     }
<a name="l00408"></a>00408 
<a name="l00409"></a>00409   <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (pathname);
<a name="l00410"></a>00410 
<a name="l00411"></a>00411   <span class="keywordflow">return</span> abfd;
<a name="l00412"></a>00412 }
<a name="l00413"></a>00413 
<a name="l00414"></a>00414 <span class="comment">/* Find shared library PATHNAME and open a BFD for it.  */</span>
<a name="l00415"></a>00415 
<a name="l00416"></a>00416 bfd *
<a name="l00417"></a><a class="code" href="solist_8h.html#ae151ae08123203a06d009309052ef336">00417</a> <a class="code" href="solib_8c.html#aa95e8070f3d946cfbfa2b84ceb45d32f">solib_bfd_open</a> (<span class="keywordtype">char</span> *pathname)
<a name="l00418"></a>00418 {
<a name="l00419"></a>00419   <span class="keywordtype">char</span> *found_pathname;
<a name="l00420"></a>00420   <span class="keywordtype">int</span> found_file;
<a name="l00421"></a>00421   bfd *abfd;
<a name="l00422"></a>00422   <span class="keyword">const</span> <span class="keyword">struct </span>bfd_arch_info *b;
<a name="l00423"></a>00423 
<a name="l00424"></a>00424   <span class="comment">/* Search for shared library file.  */</span>
<a name="l00425"></a>00425   found_pathname = <a class="code" href="solib_8c.html#a941fccccb29fcd280cf83b1e08f60435">solib_find</a> (pathname, &amp;found_file);
<a name="l00426"></a>00426   <span class="keywordflow">if</span> (found_pathname == NULL)
<a name="l00427"></a>00427     {
<a name="l00428"></a>00428       <span class="comment">/* Return failure if the file could not be found, so that we can</span>
<a name="l00429"></a>00429 <span class="comment">         accumulate messages about missing libraries.  */</span>
<a name="l00430"></a>00430       <span class="keywordflow">if</span> (errno == ENOENT)
<a name="l00431"></a>00431         <span class="keywordflow">return</span> NULL;
<a name="l00432"></a>00432 
<a name="l00433"></a>00433       <a class="code" href="utils_8c.html#a14801ceb45147833b8ce111c89ea0d5f">perror_with_name</a> (pathname);
<a name="l00434"></a>00434     }
<a name="l00435"></a>00435 
<a name="l00436"></a>00436   <span class="comment">/* Open bfd for shared library.  */</span>
<a name="l00437"></a>00437   abfd = <a class="code" href="solib_8c.html#ad58623753ea41f70d2e9bf485f6ff9a4">solib_bfd_fopen</a> (found_pathname, found_file);
<a name="l00438"></a>00438 
<a name="l00439"></a>00439   <span class="comment">/* Check bfd format.  */</span>
<a name="l00440"></a>00440   <span class="keywordflow">if</span> (!bfd_check_format (abfd, bfd_object))
<a name="l00441"></a>00441     {
<a name="l00442"></a>00442       <a class="code" href="utils_8c.html#aefcbd004e34c553d07ce2a6b4a196852">make_cleanup_bfd_unref</a> (abfd);
<a name="l00443"></a>00443       <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;`%s&#39;: not in executable format: %s&quot;</span>),
<a name="l00444"></a>00444              bfd_get_filename (abfd), bfd_errmsg (bfd_get_error ()));
<a name="l00445"></a>00445     }
<a name="l00446"></a>00446 
<a name="l00447"></a>00447   <span class="comment">/* Check bfd arch.  */</span>
<a name="l00448"></a>00448   b = <a class="code" href="gdbarch_8c.html#a305465885963fbf0fb5a7543594a7bff">gdbarch_bfd_arch_info</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ());
<a name="l00449"></a>00449   <span class="keywordflow">if</span> (!b-&gt;compatible (b, bfd_get_arch_info (abfd)))
<a name="l00450"></a>00450     <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;`%s&#39;: Shared library architecture %s is not compatible &quot;</span>
<a name="l00451"></a>00451                <span class="stringliteral">&quot;with target architecture %s.&quot;</span>), bfd_get_filename (abfd),
<a name="l00452"></a>00452              bfd_get_arch_info (abfd)-&gt;printable_name, b-&gt;printable_name);
<a name="l00453"></a>00453 
<a name="l00454"></a>00454   <span class="keywordflow">return</span> abfd;
<a name="l00455"></a>00455 }
<a name="l00456"></a>00456 
<a name="l00457"></a>00457 <span class="comment">/* Given a pointer to one of the shared objects in our list of mapped</span>
<a name="l00458"></a>00458 <span class="comment">   objects, use the recorded name to open a bfd descriptor for the</span>
<a name="l00459"></a>00459 <span class="comment">   object, build a section table, relocate all the section addresses</span>
<a name="l00460"></a>00460 <span class="comment">   by the base address at which the shared object was mapped, and then</span>
<a name="l00461"></a>00461 <span class="comment">   add the sections to the target&#39;s section table.</span>
<a name="l00462"></a>00462 <span class="comment"></span>
<a name="l00463"></a>00463 <span class="comment">   FIXME: In most (all?) cases the shared object file name recorded in</span>
<a name="l00464"></a>00464 <span class="comment">   the dynamic linkage tables will be a fully qualified pathname.  For</span>
<a name="l00465"></a>00465 <span class="comment">   cases where it isn&#39;t, do we really mimic the systems search</span>
<a name="l00466"></a>00466 <span class="comment">   mechanism correctly in the below code (particularly the tilde</span>
<a name="l00467"></a>00467 <span class="comment">   expansion stuff?).  */</span>
<a name="l00468"></a>00468 
<a name="l00469"></a>00469 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00470"></a>00470 solib_map_sections (<span class="keyword">struct</span> <a class="code" href="structso__list.html">so_list</a> *so)
<a name="l00471"></a>00471 {
<a name="l00472"></a>00472   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtarget__so__ops.html">target_so_ops</a> *ops = solib_ops (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ());
<a name="l00473"></a>00473   <span class="keywordtype">char</span> *filename;
<a name="l00474"></a>00474   <span class="keyword">struct </span><a class="code" href="structtarget__section.html">target_section</a> *<a class="code" href="windows-nat_8c.html#ade66e4ccafbc33b117610bbc0d85feb0">p</a>;
<a name="l00475"></a>00475   <span class="keyword">struct </span>cleanup *old_chain;
<a name="l00476"></a>00476   bfd *abfd;
<a name="l00477"></a>00477 
<a name="l00478"></a>00478   filename = tilde_expand (so-&gt;<a class="code" href="structso__list.html#a140beac8c60259f8debd88cd693b8fb4">so_name</a>);
<a name="l00479"></a>00479   old_chain = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, filename);
<a name="l00480"></a>00480   abfd = ops-&gt;<a class="code" href="structtarget__so__ops.html#a1a430ce429c2c8efbe6f87bea6bf6cf6">bfd_open</a> (filename);
<a name="l00481"></a>00481   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l00482"></a>00482 
<a name="l00483"></a>00483   <span class="keywordflow">if</span> (abfd == NULL)
<a name="l00484"></a>00484     <span class="keywordflow">return</span> 0;
<a name="l00485"></a>00485 
<a name="l00486"></a>00486   <span class="comment">/* Leave bfd open, core_xfer_memory and &quot;info files&quot; need it.  */</span>
<a name="l00487"></a>00487   so-&gt;<a class="code" href="structso__list.html#a085f5e5f0ed4f1517849da60cff8001d">abfd</a> = abfd;
<a name="l00488"></a>00488 
<a name="l00489"></a>00489   <span class="keywordflow">if</span> (<a class="code" href="exec_8c.html#a33b1b8978bf5d84e0deefd30e3006ce5">build_section_table</a> (abfd, &amp;so-&gt;<a class="code" href="structso__list.html#a2f4ffed0b41b6e9e67bb797acad339f0">sections</a>, &amp;so-&gt;<a class="code" href="structso__list.html#ae112a389240355d52f6fcac2fbec069f">sections_end</a>))
<a name="l00490"></a>00490     {
<a name="l00491"></a>00491       <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Can&#39;t find the file sections in `%s&#39;: %s&quot;</span>),
<a name="l00492"></a>00492              bfd_get_filename (abfd), bfd_errmsg (bfd_get_error ()));
<a name="l00493"></a>00493     }
<a name="l00494"></a>00494 
<a name="l00495"></a>00495   <span class="keywordflow">for</span> (p = so-&gt;<a class="code" href="structso__list.html#a2f4ffed0b41b6e9e67bb797acad339f0">sections</a>; p &lt; so-&gt;<a class="code" href="exec_8h.html#aeefd9f755c6fe225ce504a5cc6074e8e">sections_end</a>; p++)
<a name="l00496"></a>00496     {
<a name="l00497"></a>00497       <span class="comment">/* Relocate the section binding addresses as recorded in the shared</span>
<a name="l00498"></a>00498 <span class="comment">         object&#39;s file by the base address to which the object was actually</span>
<a name="l00499"></a>00499 <span class="comment">         mapped.  */</span>
<a name="l00500"></a>00500       ops-&gt;<a class="code" href="structtarget__so__ops.html#a2ecaeca7f25e93824463cbf97f288fd8">relocate_section_addresses</a> (so, p);
<a name="l00501"></a>00501 
<a name="l00502"></a>00502       <span class="comment">/* If the target didn&#39;t provide information about the address</span>
<a name="l00503"></a>00503 <span class="comment">         range of the shared object, assume we want the location of</span>
<a name="l00504"></a>00504 <span class="comment">         the .text section.  */</span>
<a name="l00505"></a>00505       <span class="keywordflow">if</span> (so-&gt;<a class="code" href="structso__list.html#afb4c2609ac1d34a1f0501ed51f4ce262">addr_low</a> == 0 &amp;&amp; so-&gt;<a class="code" href="structso__list.html#a368c10a6a2b60168d577b19cb9444958">addr_high</a> == 0
<a name="l00506"></a>00506           &amp;&amp; strcmp (p-&gt;<a class="code" href="structtarget__section.html#a3eeadf384747cb6a6e8cbb07db089723">the_bfd_section</a>-&gt;name, <span class="stringliteral">&quot;.text&quot;</span>) == 0)
<a name="l00507"></a>00507         {
<a name="l00508"></a>00508           so-&gt;<a class="code" href="structso__list.html#afb4c2609ac1d34a1f0501ed51f4ce262">addr_low</a> = p-&gt;<a class="code" href="structtarget__section.html#a3e4564d6ceb39f962f70bb7afdd3b260">addr</a>;
<a name="l00509"></a>00509           so-&gt;<a class="code" href="structso__list.html#a368c10a6a2b60168d577b19cb9444958">addr_high</a> = p-&gt;<a class="code" href="structtarget__section.html#a2c1890ede65bfce986a3e16682e76072">endaddr</a>;
<a name="l00510"></a>00510         }
<a name="l00511"></a>00511     }
<a name="l00512"></a>00512 
<a name="l00513"></a>00513   <span class="comment">/* Add the shared object&#39;s sections to the current set of file</span>
<a name="l00514"></a>00514 <span class="comment">     section tables.  Do this immediately after mapping the object so</span>
<a name="l00515"></a>00515 <span class="comment">     that later nodes in the list can query this object, as is needed</span>
<a name="l00516"></a>00516 <span class="comment">     in solib-osf.c.  */</span>
<a name="l00517"></a>00517   <a class="code" href="exec_8c.html#a0c3048802bb59770c990344079babbd2">add_target_sections</a> (so, so-&gt;<a class="code" href="structso__list.html#a2f4ffed0b41b6e9e67bb797acad339f0">sections</a>, so-&gt;<a class="code" href="structso__list.html#ae112a389240355d52f6fcac2fbec069f">sections_end</a>);
<a name="l00518"></a>00518 
<a name="l00519"></a>00519   <span class="keywordflow">return</span> 1;
<a name="l00520"></a>00520 }
<a name="l00521"></a>00521 
<a name="l00522"></a>00522 <span class="comment">/* Free symbol-file related contents of SO and reset for possible reloading</span>
<a name="l00523"></a>00523 <span class="comment">   of SO.  If we have opened a BFD for SO, close it.  If we have placed SO&#39;s</span>
<a name="l00524"></a>00524 <span class="comment">   sections in some target&#39;s section table, the caller is responsible for</span>
<a name="l00525"></a>00525 <span class="comment">   removing them.</span>
<a name="l00526"></a>00526 <span class="comment"></span>
<a name="l00527"></a>00527 <span class="comment">   This function doesn&#39;t mess with objfiles at all.  If there is an</span>
<a name="l00528"></a>00528 <span class="comment">   objfile associated with SO that needs to be removed, the caller is</span>
<a name="l00529"></a>00529 <span class="comment">   responsible for taking care of that.  */</span>
<a name="l00530"></a>00530 
<a name="l00531"></a>00531 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00532"></a>00532 clear_so (<span class="keyword">struct</span> <a class="code" href="structso__list.html">so_list</a> *so)
<a name="l00533"></a>00533 {
<a name="l00534"></a>00534   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtarget__so__ops.html">target_so_ops</a> *ops = solib_ops (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ());
<a name="l00535"></a>00535 
<a name="l00536"></a>00536   <span class="keywordflow">if</span> (so-&gt;<a class="code" href="structso__list.html#a2f4ffed0b41b6e9e67bb797acad339f0">sections</a>)
<a name="l00537"></a>00537     {
<a name="l00538"></a>00538       <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (so-&gt;<a class="code" href="structso__list.html#a2f4ffed0b41b6e9e67bb797acad339f0">sections</a>);
<a name="l00539"></a>00539       so-&gt;<a class="code" href="structso__list.html#a2f4ffed0b41b6e9e67bb797acad339f0">sections</a> = so-&gt;<a class="code" href="structso__list.html#ae112a389240355d52f6fcac2fbec069f">sections_end</a> = NULL;
<a name="l00540"></a>00540     }
<a name="l00541"></a>00541 
<a name="l00542"></a>00542   <a class="code" href="gdb__bfd_8c.html#a1027b59a8494f937b5760901040dc125">gdb_bfd_unref</a> (so-&gt;<a class="code" href="structso__list.html#a085f5e5f0ed4f1517849da60cff8001d">abfd</a>);
<a name="l00543"></a>00543   so-&gt;<a class="code" href="structso__list.html#a085f5e5f0ed4f1517849da60cff8001d">abfd</a> = NULL;
<a name="l00544"></a>00544 
<a name="l00545"></a>00545   <span class="comment">/* Our caller closed the objfile, possibly via objfile_purge_solibs.  */</span>
<a name="l00546"></a>00546   so-&gt;<a class="code" href="structso__list.html#ae46552b89ed2c4c286e9e15717a93537">symbols_loaded</a> = 0;
<a name="l00547"></a>00547   so-&gt;<a class="code" href="structso__list.html#ada33ba2c171b3b53b3414f616b680b8e">objfile</a> = NULL;
<a name="l00548"></a>00548 
<a name="l00549"></a>00549   so-&gt;<a class="code" href="structso__list.html#afb4c2609ac1d34a1f0501ed51f4ce262">addr_low</a> = so-&gt;<a class="code" href="structso__list.html#a368c10a6a2b60168d577b19cb9444958">addr_high</a> = 0;
<a name="l00550"></a>00550 
<a name="l00551"></a>00551   <span class="comment">/* Restore the target-supplied file name.  SO_NAME may be the path</span>
<a name="l00552"></a>00552 <span class="comment">     of the symbol file.  */</span>
<a name="l00553"></a>00553   strcpy (so-&gt;<a class="code" href="structso__list.html#a140beac8c60259f8debd88cd693b8fb4">so_name</a>, so-&gt;<a class="code" href="structso__list.html#acaf1629339fc6d9e734dcc6b9ce02bbf">so_original_name</a>);
<a name="l00554"></a>00554 
<a name="l00555"></a>00555   <span class="comment">/* Do the same for target-specific data.  */</span>
<a name="l00556"></a>00556   <span class="keywordflow">if</span> (ops-&gt;<a class="code" href="structtarget__so__ops.html#a9b7cb871da59275996e9e5aebc70bf00">clear_so</a> != NULL)
<a name="l00557"></a>00557     ops-&gt;<a class="code" href="structtarget__so__ops.html#a9b7cb871da59275996e9e5aebc70bf00">clear_so</a> (so);
<a name="l00558"></a>00558 }
<a name="l00559"></a>00559 
<a name="l00560"></a>00560 <span class="comment">/* Free the storage associated with the `struct so_list&#39; object SO.</span>
<a name="l00561"></a>00561 <span class="comment">   If we have opened a BFD for SO, close it.</span>
<a name="l00562"></a>00562 <span class="comment"></span>
<a name="l00563"></a>00563 <span class="comment">   The caller is responsible for removing SO from whatever list it is</span>
<a name="l00564"></a>00564 <span class="comment">   a member of.  If we have placed SO&#39;s sections in some target&#39;s</span>
<a name="l00565"></a>00565 <span class="comment">   section table, the caller is responsible for removing them.</span>
<a name="l00566"></a>00566 <span class="comment"></span>
<a name="l00567"></a>00567 <span class="comment">   This function doesn&#39;t mess with objfiles at all.  If there is an</span>
<a name="l00568"></a>00568 <span class="comment">   objfile associated with SO that needs to be removed, the caller is</span>
<a name="l00569"></a>00569 <span class="comment">   responsible for taking care of that.  */</span>
<a name="l00570"></a>00570 
<a name="l00571"></a>00571 <span class="keywordtype">void</span>
<a name="l00572"></a><a class="code" href="solist_8h.html#a3fdb0779b9680743df73f5fbd2163e8f">00572</a> <a class="code" href="solib_8c.html#a3fdb0779b9680743df73f5fbd2163e8f">free_so</a> (<span class="keyword">struct</span> <a class="code" href="structso__list.html">so_list</a> *so)
<a name="l00573"></a>00573 {
<a name="l00574"></a>00574   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtarget__so__ops.html">target_so_ops</a> *ops = solib_ops (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ());
<a name="l00575"></a>00575 
<a name="l00576"></a>00576   <a class="code" href="structtarget__so__ops.html#a9b7cb871da59275996e9e5aebc70bf00">clear_so</a> (so);
<a name="l00577"></a>00577   ops-&gt;<a class="code" href="structtarget__so__ops.html#a7f1d1b450ebd9724199b09575f9b2841">free_so</a> (so);
<a name="l00578"></a>00578 
<a name="l00579"></a>00579   <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (so);
<a name="l00580"></a>00580 }
<a name="l00581"></a>00581 
<a name="l00582"></a>00582 
<a name="l00583"></a>00583 <span class="comment">/* Return address of first so_list entry in master shared object list.  */</span>
<a name="l00584"></a>00584 <span class="keyword">struct </span><a class="code" href="structso__list.html">so_list</a> *
<a name="l00585"></a><a class="code" href="solist_8h.html#a5488621c1e7370ffc6eb4f50c97e9484">00585</a> <a class="code" href="solib_8c.html#a5488621c1e7370ffc6eb4f50c97e9484">master_so_list</a> (<span class="keywordtype">void</span>)
<a name="l00586"></a>00586 {
<a name="l00587"></a>00587   <span class="keywordflow">return</span> <a class="code" href="solib_8c.html#ab94f6b7dba8e4f80e8895695f826278d">so_list_head</a>;
<a name="l00588"></a>00588 }
<a name="l00589"></a>00589 
<a name="l00590"></a>00590 <span class="comment">/* Read in symbols for shared object SO.  If SYMFILE_VERBOSE is set in FLAGS,</span>
<a name="l00591"></a>00591 <span class="comment">   be chatty about it.  Return non-zero if any symbols were actually</span>
<a name="l00592"></a>00592 <span class="comment">   loaded.  */</span>
<a name="l00593"></a>00593 
<a name="l00594"></a>00594 <span class="keywordtype">int</span>
<a name="l00595"></a><a class="code" href="solib_8h.html#a7dc858746f9f0bc5b5eb2e352964782e">00595</a> <a class="code" href="solib_8c.html#ab84a2ead489326d22cfac6d2752a177d">solib_read_symbols</a> (<span class="keyword">struct</span> <a class="code" href="structso__list.html">so_list</a> *so, <span class="keywordtype">int</span> <a class="code" href="solib-som_8c.html#a555096840020c318e34b205419e98cca">flags</a>)
<a name="l00596"></a>00596 {
<a name="l00597"></a>00597   <span class="keyword">const</span> <span class="keywordtype">int</span> from_tty = flags &amp; <a class="code" href="symfile_8h.html#a5c7691860be0cad5cf5b695b6b40997ba9ffe555bbe5c64b8ef5ea46c282644d1">SYMFILE_VERBOSE</a>;
<a name="l00598"></a>00598 
<a name="l00599"></a>00599   <span class="keywordflow">if</span> (so-&gt;<a class="code" href="structso__list.html#ae46552b89ed2c4c286e9e15717a93537">symbols_loaded</a>)
<a name="l00600"></a>00600     {
<a name="l00601"></a>00601       <span class="comment">/* If needed, we&#39;ve already warned in our caller.  */</span>
<a name="l00602"></a>00602     }
<a name="l00603"></a>00603   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (so-&gt;<a class="code" href="structso__list.html#a085f5e5f0ed4f1517849da60cff8001d">abfd</a> == NULL)
<a name="l00604"></a>00604     {
<a name="l00605"></a>00605       <span class="comment">/* We&#39;ve already warned about this library, when trying to open</span>
<a name="l00606"></a>00606 <span class="comment">         it.  */</span>
<a name="l00607"></a>00607     }
<a name="l00608"></a>00608   <span class="keywordflow">else</span>
<a name="l00609"></a>00609     {
<a name="l00610"></a>00610       <span class="keyword">volatile</span> <span class="keyword">struct </span><a class="code" href="structgdb__exception.html">gdb_exception</a> e;
<a name="l00611"></a>00611 
<a name="l00612"></a>00612       flags |= <a class="code" href="inferior_8c.html#a9e592c83e7c0c1f89f1a4a392bd1a277">current_inferior</a> ()-&gt;<a class="code" href="structinferior.html#a0534c564bfd4242ae45d81215ca56faf">symfile_flags</a>;
<a name="l00613"></a>00613 
<a name="l00614"></a>00614       <a class="code" href="exceptions_8h.html#aef4514ee39b9305fddee27f49c7c34eb">TRY_CATCH</a> (e, <a class="code" href="exceptions_8h.html#abfa3a3b99557b11f5766baf69465fdf6a44de51845416ac49ab08438792b908f0">RETURN_MASK_ERROR</a>)
<a name="l00615"></a>00615         {
<a name="l00616"></a>00616           <span class="keyword">struct </span><a class="code" href="structsection__addr__info.html">section_addr_info</a> *sap;
<a name="l00617"></a>00617 
<a name="l00618"></a>00618           <span class="comment">/* Have we already loaded this shared object?  */</span>
<a name="l00619"></a>00619           <a class="code" href="objfiles_8h.html#a8efee3b85a322006131a6056d45058b3">ALL_OBJFILES</a> (so-&gt;<a class="code" href="structso__list.html#ada33ba2c171b3b53b3414f616b680b8e">objfile</a>)
<a name="l00620"></a>00620             {
<a name="l00621"></a>00621               <span class="keywordflow">if</span> (filename_cmp (<a class="code" href="objfiles_8c.html#a33e548a19b86b293435d3c2d6daaaec6">objfile_name</a> (so-&gt;<a class="code" href="structso__list.html#ada33ba2c171b3b53b3414f616b680b8e">objfile</a>), so-&gt;<a class="code" href="structso__list.html#a140beac8c60259f8debd88cd693b8fb4">so_name</a>) == 0
<a name="l00622"></a>00622                   &amp;&amp; so-&gt;<a class="code" href="structso__list.html#ada33ba2c171b3b53b3414f616b680b8e">objfile</a>-&gt;<a class="code" href="structobjfile.html#a57fb6afa162329408c276dd5acf41fa5">addr_low</a> == so-&gt;<a class="code" href="structso__list.html#afb4c2609ac1d34a1f0501ed51f4ce262">addr_low</a>)
<a name="l00623"></a>00623                 <span class="keywordflow">break</span>;
<a name="l00624"></a>00624             }
<a name="l00625"></a>00625           <span class="keywordflow">if</span> (so-&gt;<a class="code" href="structso__list.html#ada33ba2c171b3b53b3414f616b680b8e">objfile</a> != NULL)
<a name="l00626"></a>00626             <span class="keywordflow">break</span>;
<a name="l00627"></a>00627 
<a name="l00628"></a>00628           sap = <a class="code" href="symfile_8c.html#a59804ba6ee15da4d55e771cfbba588b2">build_section_addr_info_from_section_table</a> (so-&gt;<a class="code" href="structso__list.html#a2f4ffed0b41b6e9e67bb797acad339f0">sections</a>,
<a name="l00629"></a>00629                                                             so-&gt;<a class="code" href="structso__list.html#ae112a389240355d52f6fcac2fbec069f">sections_end</a>);
<a name="l00630"></a>00630           so-&gt;<a class="code" href="structso__list.html#ada33ba2c171b3b53b3414f616b680b8e">objfile</a> = <a class="code" href="symfile_8c.html#a3e387e8ae6107a4d23f541fff40c2824">symbol_file_add_from_bfd</a> (so-&gt;<a class="code" href="structso__list.html#a085f5e5f0ed4f1517849da60cff8001d">abfd</a>, so-&gt;<a class="code" href="structso__list.html#a140beac8c60259f8debd88cd693b8fb4">so_name</a>,
<a name="l00631"></a>00631                                                   flags, sap, <a class="code" href="objfiles_8h.html#a02a85dec7472a89888cd3c7575f88009">OBJF_SHARED</a>,
<a name="l00632"></a>00632                                                   NULL);
<a name="l00633"></a>00633           so-&gt;<a class="code" href="structso__list.html#ada33ba2c171b3b53b3414f616b680b8e">objfile</a>-&gt;<a class="code" href="structobjfile.html#a57fb6afa162329408c276dd5acf41fa5">addr_low</a> = so-&gt;<a class="code" href="structso__list.html#afb4c2609ac1d34a1f0501ed51f4ce262">addr_low</a>;
<a name="l00634"></a>00634           <a class="code" href="symfile_8c.html#aa7fda611083fad0e8d1f0929d24b1765">free_section_addr_info</a> (sap);
<a name="l00635"></a>00635         }
<a name="l00636"></a>00636 
<a name="l00637"></a>00637       <span class="keywordflow">if</span> (e.<a class="code" href="structgdb__exception.html#ae0e14189c63f830024865d557c1122cc">reason</a> &lt; 0)
<a name="l00638"></a>00638         <a class="code" href="exceptions_8c.html#ae1dffc77e3a96d17e813da7d2165b16d">exception_fprintf</a> (<a class="code" href="main_8c.html#a2a1dea1e551cadb9541353a004193a47">gdb_stderr</a>, e, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Error while reading shared&quot;</span>
<a name="l00639"></a>00639                                             <span class="stringliteral">&quot; library symbols for %s:\n&quot;</span>),
<a name="l00640"></a>00640                            so-&gt;<a class="code" href="structso__list.html#a140beac8c60259f8debd88cd693b8fb4">so_name</a>);
<a name="l00641"></a>00641       <span class="keywordflow">else</span>
<a name="l00642"></a>00642         {
<a name="l00643"></a>00643           <span class="keywordflow">if</span> (from_tty || <a class="code" href="defs_8h.html#a3f2f91ed92de5dfaa6d27fb82822f8d5">info_verbose</a>)
<a name="l00644"></a>00644             <a class="code" href="utils_8c.html#ad57145632bbcb0361dc1dfa134b1efd0">printf_unfiltered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Loaded symbols for %s\n&quot;</span>), so-&gt;<a class="code" href="structso__list.html#a140beac8c60259f8debd88cd693b8fb4">so_name</a>);
<a name="l00645"></a>00645           so-&gt;<a class="code" href="structso__list.html#ae46552b89ed2c4c286e9e15717a93537">symbols_loaded</a> = 1;
<a name="l00646"></a>00646         }
<a name="l00647"></a>00647       <span class="keywordflow">return</span> 1;
<a name="l00648"></a>00648     }
<a name="l00649"></a>00649 
<a name="l00650"></a>00650   <span class="keywordflow">return</span> 0;
<a name="l00651"></a>00651 }
<a name="l00652"></a>00652 
<a name="l00653"></a>00653 <span class="comment">/* Return 1 if KNOWN-&gt;objfile is used by any other so_list object in the</span>
<a name="l00654"></a>00654 <span class="comment">   SO_LIST_HEAD list.  Return 0 otherwise.  */</span>
<a name="l00655"></a>00655 
<a name="l00656"></a>00656 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00657"></a>00657 solib_used (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structso__list.html">so_list</a> *<span class="keyword">const</span> known)
<a name="l00658"></a>00658 {
<a name="l00659"></a>00659   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structso__list.html">so_list</a> *pivot;
<a name="l00660"></a>00660 
<a name="l00661"></a>00661   <span class="keywordflow">for</span> (pivot = <a class="code" href="solib_8c.html#ab94f6b7dba8e4f80e8895695f826278d">so_list_head</a>; pivot != NULL; pivot = pivot-&gt;<a class="code" href="structso__list.html#abd46cbdf1660c79a104e6af57af31df9">next</a>)
<a name="l00662"></a>00662     <span class="keywordflow">if</span> (pivot != known &amp;&amp; pivot-&gt;<a class="code" href="structso__list.html#ada33ba2c171b3b53b3414f616b680b8e">objfile</a> == known-&gt;<a class="code" href="structso__list.html#ada33ba2c171b3b53b3414f616b680b8e">objfile</a>)
<a name="l00663"></a>00663       <span class="keywordflow">return</span> 1;
<a name="l00664"></a>00664   <span class="keywordflow">return</span> 0;
<a name="l00665"></a>00665 }
<a name="l00666"></a>00666 
<a name="l00667"></a>00667 <span class="comment">/* Synchronize GDB&#39;s shared object list with inferior&#39;s.</span>
<a name="l00668"></a>00668 <span class="comment"></span>
<a name="l00669"></a>00669 <span class="comment">   Extract the list of currently loaded shared objects from the</span>
<a name="l00670"></a>00670 <span class="comment">   inferior, and compare it with the list of shared objects currently</span>
<a name="l00671"></a>00671 <span class="comment">   in GDB&#39;s so_list_head list.  Edit so_list_head to bring it in sync</span>
<a name="l00672"></a>00672 <span class="comment">   with the inferior&#39;s new list.</span>
<a name="l00673"></a>00673 <span class="comment"></span>
<a name="l00674"></a>00674 <span class="comment">   If we notice that the inferior has unloaded some shared objects,</span>
<a name="l00675"></a>00675 <span class="comment">   free any symbolic info GDB had read about those shared objects.</span>
<a name="l00676"></a>00676 <span class="comment"></span>
<a name="l00677"></a>00677 <span class="comment">   Don&#39;t load symbolic info for any new shared objects; just add them</span>
<a name="l00678"></a>00678 <span class="comment">   to the list, and leave their symbols_loaded flag clear.</span>
<a name="l00679"></a>00679 <span class="comment"></span>
<a name="l00680"></a>00680 <span class="comment">   If FROM_TTY is non-null, feel free to print messages about what</span>
<a name="l00681"></a>00681 <span class="comment">   we&#39;re doing.</span>
<a name="l00682"></a>00682 <span class="comment"></span>
<a name="l00683"></a>00683 <span class="comment">   If TARGET is non-null, add the sections of all new shared objects</span>
<a name="l00684"></a>00684 <span class="comment">   to TARGET&#39;s section table.  Note that this doesn&#39;t remove any</span>
<a name="l00685"></a>00685 <span class="comment">   sections for shared objects that have been unloaded, and it</span>
<a name="l00686"></a>00686 <span class="comment">   doesn&#39;t check to see if the new shared objects are already present in</span>
<a name="l00687"></a>00687 <span class="comment">   the section table.  But we only use this for core files and</span>
<a name="l00688"></a>00688 <span class="comment">   processes we&#39;ve just attached to, so that&#39;s okay.  */</span>
<a name="l00689"></a>00689 
<a name="l00690"></a>00690 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00691"></a>00691 update_solib_list (<span class="keywordtype">int</span> from_tty, <span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *target)
<a name="l00692"></a>00692 {
<a name="l00693"></a>00693   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtarget__so__ops.html">target_so_ops</a> *ops = solib_ops (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ());
<a name="l00694"></a>00694   <span class="keyword">struct </span><a class="code" href="structso__list.html">so_list</a> *<a class="code" href="structinferior.html">inferior</a> = ops-&gt;<a class="code" href="structtarget__so__ops.html#a05f7d4465c729343bac0446a25a77b1d">current_sos</a>();
<a name="l00695"></a>00695   <span class="keyword">struct </span><a class="code" href="structso__list.html">so_list</a> *gdb, **gdb_link;
<a name="l00696"></a>00696 
<a name="l00697"></a>00697   <span class="comment">/* We can reach here due to changing solib-search-path or the</span>
<a name="l00698"></a>00698 <span class="comment">     sysroot, before having any inferior.  */</span>
<a name="l00699"></a>00699   <span class="keywordflow">if</span> (<a class="code" href="target_8h.html#a85885df22f7c1304269eaba1e1d618b7">target_has_execution</a> &amp;&amp; !<a class="code" href="ptid_8c.html#a0df58c8db2620a2cec647934b4f77266">ptid_equal</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>, <a class="code" href="ptid_8c.html#acba69c857786546b204883bbcc90a64e">null_ptid</a>))
<a name="l00700"></a>00700     {
<a name="l00701"></a>00701       <span class="keyword">struct </span>inferior *<a class="code" href="namespacearm-linux.html#aaf6bae53545ee96f24d7ba560ed0a205">inf</a> = <a class="code" href="inferior_8c.html#a9e592c83e7c0c1f89f1a4a392bd1a277">current_inferior</a> ();
<a name="l00702"></a>00702 
<a name="l00703"></a>00703       <span class="comment">/* If we are attaching to a running process for which we</span>
<a name="l00704"></a>00704 <span class="comment">         have not opened a symbol file, we may be able to get its</span>
<a name="l00705"></a>00705 <span class="comment">         symbols now!  */</span>
<a name="l00706"></a>00706       <span class="keywordflow">if</span> (inf-&gt;<a class="code" href="structinferior.html#a2a806ec9d3ad6bda987e716e653a1980">attach_flag</a> &amp;&amp; <a class="code" href="progspace_8h.html#a4e703bd0d59c70e069bed3b4d9e1936b">symfile_objfile</a> == NULL)
<a name="l00707"></a>00707         <a class="code" href="exceptions_8c.html#ad6275ae3cd191f69dd2fe540f138cb2d">catch_errors</a> (ops-&gt;<a class="code" href="structtarget__so__ops.html#acdab1c9ae53d64aefdc1227b33159983">open_symbol_file_object</a>, &amp;from_tty,
<a name="l00708"></a>00708                       <span class="stringliteral">&quot;Error reading attached process&#39;s symbol file.\n&quot;</span>,
<a name="l00709"></a>00709                       <a class="code" href="exceptions_8h.html#abfa3a3b99557b11f5766baf69465fdf6ab50fde886a7de8c013bf2bd4e7c073a4">RETURN_MASK_ALL</a>);
<a name="l00710"></a>00710     }
<a name="l00711"></a>00711 
<a name="l00712"></a>00712   <span class="comment">/* GDB and the inferior&#39;s dynamic linker each maintain their own</span>
<a name="l00713"></a>00713 <span class="comment">     list of currently loaded shared objects; we want to bring the</span>
<a name="l00714"></a>00714 <span class="comment">     former in sync with the latter.  Scan both lists, seeing which</span>
<a name="l00715"></a>00715 <span class="comment">     shared objects appear where.  There are three cases:</span>
<a name="l00716"></a>00716 <span class="comment"></span>
<a name="l00717"></a>00717 <span class="comment">     - A shared object appears on both lists.  This means that GDB</span>
<a name="l00718"></a>00718 <span class="comment">     knows about it already, and it&#39;s still loaded in the inferior.</span>
<a name="l00719"></a>00719 <span class="comment">     Nothing needs to happen.</span>
<a name="l00720"></a>00720 <span class="comment"></span>
<a name="l00721"></a>00721 <span class="comment">     - A shared object appears only on GDB&#39;s list.  This means that</span>
<a name="l00722"></a>00722 <span class="comment">     the inferior has unloaded it.  We should remove the shared</span>
<a name="l00723"></a>00723 <span class="comment">     object from GDB&#39;s tables.</span>
<a name="l00724"></a>00724 <span class="comment"></span>
<a name="l00725"></a>00725 <span class="comment">     - A shared object appears only on the inferior&#39;s list.  This</span>
<a name="l00726"></a>00726 <span class="comment">     means that it&#39;s just been loaded.  We should add it to GDB&#39;s</span>
<a name="l00727"></a>00727 <span class="comment">     tables.</span>
<a name="l00728"></a>00728 <span class="comment"></span>
<a name="l00729"></a>00729 <span class="comment">     So we walk GDB&#39;s list, checking each entry to see if it appears</span>
<a name="l00730"></a>00730 <span class="comment">     in the inferior&#39;s list too.  If it does, no action is needed, and</span>
<a name="l00731"></a>00731 <span class="comment">     we remove it from the inferior&#39;s list.  If it doesn&#39;t, the</span>
<a name="l00732"></a>00732 <span class="comment">     inferior has unloaded it, and we remove it from GDB&#39;s list.  By</span>
<a name="l00733"></a>00733 <span class="comment">     the time we&#39;re done walking GDB&#39;s list, the inferior&#39;s list</span>
<a name="l00734"></a>00734 <span class="comment">     contains only the new shared objects, which we then add.  */</span>
<a name="l00735"></a>00735 
<a name="l00736"></a>00736   gdb = <a class="code" href="solib_8c.html#ab94f6b7dba8e4f80e8895695f826278d">so_list_head</a>;
<a name="l00737"></a>00737   gdb_link = &amp;<a class="code" href="solib_8c.html#ab94f6b7dba8e4f80e8895695f826278d">so_list_head</a>;
<a name="l00738"></a>00738   <span class="keywordflow">while</span> (gdb)
<a name="l00739"></a>00739     {
<a name="l00740"></a>00740       <span class="keyword">struct </span><a class="code" href="structso__list.html">so_list</a> *i = inferior;
<a name="l00741"></a>00741       <span class="keyword">struct </span><a class="code" href="structso__list.html">so_list</a> **i_link = &amp;inferior;
<a name="l00742"></a>00742 
<a name="l00743"></a>00743       <span class="comment">/* Check to see whether the shared object *gdb also appears in</span>
<a name="l00744"></a>00744 <span class="comment">         the inferior&#39;s current list.  */</span>
<a name="l00745"></a>00745       <span class="keywordflow">while</span> (i)
<a name="l00746"></a>00746         {
<a name="l00747"></a>00747           <span class="keywordflow">if</span> (ops-&gt;<a class="code" href="structtarget__so__ops.html#aca107d4b97e19787308e46c198e6537e">same</a>)
<a name="l00748"></a>00748             {
<a name="l00749"></a>00749               <span class="keywordflow">if</span> (ops-&gt;<a class="code" href="structtarget__so__ops.html#aca107d4b97e19787308e46c198e6537e">same</a> (gdb, i))
<a name="l00750"></a>00750                 <span class="keywordflow">break</span>;
<a name="l00751"></a>00751             }
<a name="l00752"></a>00752           <span class="keywordflow">else</span>
<a name="l00753"></a>00753             {
<a name="l00754"></a>00754               <span class="keywordflow">if</span> (! filename_cmp (gdb-&gt;<a class="code" href="structso__list.html#acaf1629339fc6d9e734dcc6b9ce02bbf">so_original_name</a>, i-&gt;<a class="code" href="structso__list.html#acaf1629339fc6d9e734dcc6b9ce02bbf">so_original_name</a>))
<a name="l00755"></a>00755                 <span class="keywordflow">break</span>;        
<a name="l00756"></a>00756             }
<a name="l00757"></a>00757 
<a name="l00758"></a>00758           i_link = &amp;i-&gt;<a class="code" href="structso__list.html#abd46cbdf1660c79a104e6af57af31df9">next</a>;
<a name="l00759"></a>00759           i = *i_link;
<a name="l00760"></a>00760         }
<a name="l00761"></a>00761 
<a name="l00762"></a>00762       <span class="comment">/* If the shared object appears on the inferior&#39;s list too, then</span>
<a name="l00763"></a>00763 <span class="comment">         it&#39;s still loaded, so we don&#39;t need to do anything.  Delete</span>
<a name="l00764"></a>00764 <span class="comment">         it from the inferior&#39;s list, and leave it on GDB&#39;s list.  */</span>
<a name="l00765"></a>00765       <span class="keywordflow">if</span> (i)
<a name="l00766"></a>00766         {
<a name="l00767"></a>00767           *i_link = i-&gt;<a class="code" href="structso__list.html#abd46cbdf1660c79a104e6af57af31df9">next</a>;
<a name="l00768"></a>00768           <a class="code" href="solib_8c.html#a3fdb0779b9680743df73f5fbd2163e8f">free_so</a> (i);
<a name="l00769"></a>00769           gdb_link = &amp;gdb-&gt;<a class="code" href="structso__list.html#abd46cbdf1660c79a104e6af57af31df9">next</a>;
<a name="l00770"></a>00770           gdb = *gdb_link;
<a name="l00771"></a>00771         }
<a name="l00772"></a>00772 
<a name="l00773"></a>00773       <span class="comment">/* If it&#39;s not on the inferior&#39;s list, remove it from GDB&#39;s tables.  */</span>
<a name="l00774"></a>00774       <span class="keywordflow">else</span>
<a name="l00775"></a>00775         {
<a name="l00776"></a>00776           <span class="comment">/* Notify any observer that the shared object has been</span>
<a name="l00777"></a>00777 <span class="comment">             unloaded before we remove it from GDB&#39;s tables.  */</span>
<a name="l00778"></a>00778           <a class="code" href="observer_8h.html#aa52867c532fe4106eb7952255260923c">observer_notify_solib_unloaded</a> (gdb);
<a name="l00779"></a>00779 
<a name="l00780"></a>00780           <a class="code" href="vec_8h.html#a8d090c0524726d00931070e0c438ba3f">VEC_safe_push</a> (<a class="code" href="gdb__vecs_8h.html#a5ea7d3fefa2144d9bddaf2053c9691a1">char_ptr</a>, <a class="code" href="progspace_8c.html#a07722ff15a98814c086dda44f93380c9">current_program_space</a>-&gt;deleted_solibs,
<a name="l00781"></a>00781                          xstrdup (gdb-&gt;<a class="code" href="structso__list.html#a140beac8c60259f8debd88cd693b8fb4">so_name</a>));
<a name="l00782"></a>00782 
<a name="l00783"></a>00783           *gdb_link = gdb-&gt;<a class="code" href="structso__list.html#abd46cbdf1660c79a104e6af57af31df9">next</a>;
<a name="l00784"></a>00784 
<a name="l00785"></a>00785           <span class="comment">/* Unless the user loaded it explicitly, free SO&#39;s objfile.  */</span>
<a name="l00786"></a>00786           <span class="keywordflow">if</span> (gdb-&gt;<a class="code" href="structso__list.html#ada33ba2c171b3b53b3414f616b680b8e">objfile</a> &amp;&amp; ! (gdb-&gt;<a class="code" href="structso__list.html#ada33ba2c171b3b53b3414f616b680b8e">objfile</a>-&gt;<a class="code" href="structobjfile.html#a07578e542db3b2a277e146b24adf007e">flags</a> &amp; <a class="code" href="objfiles_8h.html#a83dcbdaa349319071b86d581ed72b557">OBJF_USERLOADED</a>)
<a name="l00787"></a>00787               &amp;&amp; !solib_used (gdb))
<a name="l00788"></a>00788             <a class="code" href="objfiles_8c.html#abaf0cc9c95a939f0411ab167e17acdca">free_objfile</a> (gdb-&gt;<a class="code" href="structso__list.html#ada33ba2c171b3b53b3414f616b680b8e">objfile</a>);
<a name="l00789"></a>00789 
<a name="l00790"></a>00790           <span class="comment">/* Some targets&#39; section tables might be referring to</span>
<a name="l00791"></a>00791 <span class="comment">             sections from so-&gt;abfd; remove them.  */</span>
<a name="l00792"></a>00792           <a class="code" href="exec_8c.html#a2ff3e379a4940b551777815d9671351f">remove_target_sections</a> (gdb);
<a name="l00793"></a>00793 
<a name="l00794"></a>00794           <a class="code" href="solib_8c.html#a3fdb0779b9680743df73f5fbd2163e8f">free_so</a> (gdb);
<a name="l00795"></a>00795           gdb = *gdb_link;
<a name="l00796"></a>00796         }
<a name="l00797"></a>00797     }
<a name="l00798"></a>00798 
<a name="l00799"></a>00799   <span class="comment">/* Now the inferior&#39;s list contains only shared objects that don&#39;t</span>
<a name="l00800"></a>00800 <span class="comment">     appear in GDB&#39;s list --- those that are newly loaded.  Add them</span>
<a name="l00801"></a>00801 <span class="comment">     to GDB&#39;s shared object list.  */</span>
<a name="l00802"></a>00802   <span class="keywordflow">if</span> (inferior)
<a name="l00803"></a>00803     {
<a name="l00804"></a>00804       <span class="keywordtype">int</span> not_found = 0;
<a name="l00805"></a>00805       <span class="keyword">const</span> <span class="keywordtype">char</span> *not_found_filename = NULL;
<a name="l00806"></a>00806 
<a name="l00807"></a>00807       <span class="keyword">struct </span><a class="code" href="structso__list.html">so_list</a> *i;
<a name="l00808"></a>00808 
<a name="l00809"></a>00809       <span class="comment">/* Add the new shared objects to GDB&#39;s list.  */</span>
<a name="l00810"></a>00810       *gdb_link = inferior;
<a name="l00811"></a>00811 
<a name="l00812"></a>00812       <span class="comment">/* Fill in the rest of each of the `struct so_list&#39; nodes.  */</span>
<a name="l00813"></a>00813       <span class="keywordflow">for</span> (i = inferior; i; i = i-&gt;<a class="code" href="structso__list.html#abd46cbdf1660c79a104e6af57af31df9">next</a>)
<a name="l00814"></a>00814         {
<a name="l00815"></a>00815           <span class="keyword">volatile</span> <span class="keyword">struct </span><a class="code" href="structgdb__exception.html">gdb_exception</a> e;
<a name="l00816"></a>00816 
<a name="l00817"></a>00817           i-&gt;<a class="code" href="structso__list.html#a6d29f4fcfead22ec0a7a184a0e31a455">pspace</a> = <a class="code" href="progspace_8c.html#a07722ff15a98814c086dda44f93380c9">current_program_space</a>;
<a name="l00818"></a>00818           <a class="code" href="vec_8h.html#a8d090c0524726d00931070e0c438ba3f">VEC_safe_push</a> (<a class="code" href="structso__list.html">so_list_ptr</a>, <a class="code" href="progspace_8c.html#a07722ff15a98814c086dda44f93380c9">current_program_space</a>-&gt;added_solibs, i);
<a name="l00819"></a>00819 
<a name="l00820"></a>00820           <a class="code" href="exceptions_8h.html#aef4514ee39b9305fddee27f49c7c34eb">TRY_CATCH</a> (e, <a class="code" href="exceptions_8h.html#abfa3a3b99557b11f5766baf69465fdf6a44de51845416ac49ab08438792b908f0">RETURN_MASK_ERROR</a>)
<a name="l00821"></a>00821             {
<a name="l00822"></a>00822               <span class="comment">/* Fill in the rest of the `struct so_list&#39; node.  */</span>
<a name="l00823"></a>00823               <span class="keywordflow">if</span> (!solib_map_sections (i))
<a name="l00824"></a>00824                 {
<a name="l00825"></a>00825                   not_found++;
<a name="l00826"></a>00826                   <span class="keywordflow">if</span> (not_found_filename == NULL)
<a name="l00827"></a>00827                     not_found_filename = i-&gt;<a class="code" href="structso__list.html#acaf1629339fc6d9e734dcc6b9ce02bbf">so_original_name</a>;
<a name="l00828"></a>00828                 }
<a name="l00829"></a>00829             }
<a name="l00830"></a>00830 
<a name="l00831"></a>00831           <span class="keywordflow">if</span> (e.reason &lt; 0)
<a name="l00832"></a>00832             <a class="code" href="exceptions_8c.html#ae1dffc77e3a96d17e813da7d2165b16d">exception_fprintf</a> (<a class="code" href="main_8c.html#a2a1dea1e551cadb9541353a004193a47">gdb_stderr</a>, e,
<a name="l00833"></a>00833                                <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Error while mapping shared &quot;</span>
<a name="l00834"></a>00834                                  <span class="stringliteral">&quot;library sections:\n&quot;</span>));
<a name="l00835"></a>00835 
<a name="l00836"></a>00836           <span class="comment">/* Notify any observer that the shared object has been</span>
<a name="l00837"></a>00837 <span class="comment">             loaded now that we&#39;ve added it to GDB&#39;s tables.  */</span>
<a name="l00838"></a>00838           <a class="code" href="observer_8h.html#aac8a4732aff49a74d8de0e94d965264b">observer_notify_solib_loaded</a> (i);
<a name="l00839"></a>00839         }
<a name="l00840"></a>00840 
<a name="l00841"></a>00841       <span class="comment">/* If a library was not found, issue an appropriate warning</span>
<a name="l00842"></a>00842 <span class="comment">         message.  We have to use a single call to warning in case the</span>
<a name="l00843"></a>00843 <span class="comment">         front end does something special with warnings, e.g., pop up</span>
<a name="l00844"></a>00844 <span class="comment">         a dialog box.  It Would Be Nice if we could get a &quot;warning: &quot;</span>
<a name="l00845"></a>00845 <span class="comment">         prefix on each line in the CLI front end, though - it doesn&#39;t</span>
<a name="l00846"></a>00846 <span class="comment">         stand out well.  */</span>
<a name="l00847"></a>00847 
<a name="l00848"></a>00848       <span class="keywordflow">if</span> (not_found == 1)
<a name="l00849"></a>00849         <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Could not load shared library symbols for %s.\n&quot;</span>
<a name="l00850"></a>00850                    <span class="stringliteral">&quot;Do you need \&quot;set solib-search-path\&quot; &quot;</span>
<a name="l00851"></a>00851                    <span class="stringliteral">&quot;or \&quot;set sysroot\&quot;?&quot;</span>),
<a name="l00852"></a>00852                  not_found_filename);
<a name="l00853"></a>00853       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (not_found &gt; 1)
<a name="l00854"></a>00854         <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l00855"></a>00855 <span class="stringliteral">Could not load shared library symbols for %d libraries, e.g. %s.\n\</span>
<a name="l00856"></a>00856 <span class="stringliteral">Use the \&quot;info sharedlibrary\&quot; command to see the complete listing.\n\</span>
<a name="l00857"></a>00857 <span class="stringliteral">Do you need \&quot;set solib-search-path\&quot; or \&quot;set sysroot\&quot;?&quot;</span>),
<a name="l00858"></a>00858                  not_found, not_found_filename);
<a name="l00859"></a>00859     }
<a name="l00860"></a>00860 }
<a name="l00861"></a>00861 
<a name="l00862"></a>00862 
<a name="l00863"></a>00863 <span class="comment">/* Return non-zero if NAME is the libpthread shared library.</span>
<a name="l00864"></a>00864 <span class="comment"></span>
<a name="l00865"></a>00865 <span class="comment">   Uses a fairly simplistic heuristic approach where we check</span>
<a name="l00866"></a>00866 <span class="comment">   the file name against &quot;/libpthread&quot;.  This can lead to false</span>
<a name="l00867"></a>00867 <span class="comment">   positives, but this should be good enough in practice.  */</span>
<a name="l00868"></a>00868 
<a name="l00869"></a>00869 <span class="keywordtype">int</span>
<a name="l00870"></a><a class="code" href="solib_8h.html#a730831d780c97d26ddb786cd05f6052a">00870</a> <a class="code" href="solib_8c.html#a730831d780c97d26ddb786cd05f6052a">libpthread_name_p</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="aarch64-tdep_8c.html#acc128f98d9ceca227038c771308eff39">name</a>)
<a name="l00871"></a>00871 {
<a name="l00872"></a>00872   <span class="keywordflow">return</span> (<a class="code" href="gdb__string_8h.html#a55c8e1e0e5f3578988a2feb0d417ad1c">strstr</a> (name, <span class="stringliteral">&quot;/libpthread&quot;</span>) != NULL);
<a name="l00873"></a>00873 }
<a name="l00874"></a>00874 
<a name="l00875"></a>00875 <span class="comment">/* Return non-zero if SO is the libpthread shared library.  */</span>
<a name="l00876"></a>00876 
<a name="l00877"></a>00877 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00878"></a>00878 libpthread_solib_p (<span class="keyword">struct</span> <a class="code" href="structso__list.html">so_list</a> *so)
<a name="l00879"></a>00879 {
<a name="l00880"></a>00880   <span class="keywordflow">return</span> <a class="code" href="solib_8c.html#a730831d780c97d26ddb786cd05f6052a">libpthread_name_p</a> (so-&gt;<a class="code" href="structso__list.html#a140beac8c60259f8debd88cd693b8fb4">so_name</a>);
<a name="l00881"></a>00881 }
<a name="l00882"></a>00882 
<a name="l00883"></a>00883 <span class="comment">/* Read in symbolic information for any shared objects whose names</span>
<a name="l00884"></a>00884 <span class="comment">   match PATTERN.  (If we&#39;ve already read a shared object&#39;s symbol</span>
<a name="l00885"></a>00885 <span class="comment">   info, leave it alone.)  If PATTERN is zero, read them all.</span>
<a name="l00886"></a>00886 <span class="comment"></span>
<a name="l00887"></a>00887 <span class="comment">   If READSYMS is 0, defer reading symbolic information until later</span>
<a name="l00888"></a>00888 <span class="comment">   but still do any needed low level processing.</span>
<a name="l00889"></a>00889 <span class="comment"></span>
<a name="l00890"></a>00890 <span class="comment">   FROM_TTY and TARGET are as described for update_solib_list, above.  */</span>
<a name="l00891"></a>00891 
<a name="l00892"></a>00892 <span class="keywordtype">void</span>
<a name="l00893"></a><a class="code" href="solib_8h.html#abd09fa9e6c2dcc93e387ff6db5ff78fd">00893</a> <a class="code" href="solib_8c.html#a719646b8c356bae54efdd071cd3d7186">solib_add</a> (<span class="keywordtype">char</span> *pattern, <span class="keywordtype">int</span> from_tty,
<a name="l00894"></a>00894            <span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *target, <span class="keywordtype">int</span> readsyms)
<a name="l00895"></a>00895 {
<a name="l00896"></a>00896   <span class="keyword">struct </span><a class="code" href="structso__list.html">so_list</a> *gdb;
<a name="l00897"></a>00897 
<a name="l00898"></a>00898   <a class="code" href="progspace_8c.html#a07722ff15a98814c086dda44f93380c9">current_program_space</a>-&gt;<a class="code" href="structprogram__space.html#a1671f7600c8324ddd095c530d9d6c107">solib_add_generation</a>++;
<a name="l00899"></a>00899 
<a name="l00900"></a>00900   <span class="keywordflow">if</span> (pattern)
<a name="l00901"></a>00901     {
<a name="l00902"></a>00902       <span class="keywordtype">char</span> *re_err = <a class="code" href="defs_8h.html#ad321e1eefeb38442e0c40b1279f41ca0">re_comp</a> (pattern);
<a name="l00903"></a>00903 
<a name="l00904"></a>00904       <span class="keywordflow">if</span> (re_err)
<a name="l00905"></a>00905         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Invalid regexp: %s&quot;</span>), re_err);
<a name="l00906"></a>00906     }
<a name="l00907"></a>00907 
<a name="l00908"></a>00908   update_solib_list (from_tty, target);
<a name="l00909"></a>00909 
<a name="l00910"></a>00910   <span class="comment">/* Walk the list of currently loaded shared libraries, and read</span>
<a name="l00911"></a>00911 <span class="comment">     symbols for any that match the pattern --- or any whose symbols</span>
<a name="l00912"></a>00912 <span class="comment">     aren&#39;t already loaded, if no pattern was given.  */</span>
<a name="l00913"></a>00913   {
<a name="l00914"></a>00914     <span class="keywordtype">int</span> any_matches = 0;
<a name="l00915"></a>00915     <span class="keywordtype">int</span> loaded_any_symbols = 0;
<a name="l00916"></a>00916     <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="solib-som_8c.html#a555096840020c318e34b205419e98cca">flags</a> =
<a name="l00917"></a>00917         <a class="code" href="symfile_8h.html#a5c7691860be0cad5cf5b695b6b40997baddec766cccdace139d8ac616501972e9">SYMFILE_DEFER_BP_RESET</a> | (from_tty ? <a class="code" href="symfile_8h.html#a5c7691860be0cad5cf5b695b6b40997ba9ffe555bbe5c64b8ef5ea46c282644d1">SYMFILE_VERBOSE</a> : 0);
<a name="l00918"></a>00918 
<a name="l00919"></a>00919     <span class="keywordflow">for</span> (gdb = <a class="code" href="solib_8c.html#ab94f6b7dba8e4f80e8895695f826278d">so_list_head</a>; gdb; gdb = gdb-&gt;<a class="code" href="structso__list.html#abd46cbdf1660c79a104e6af57af31df9">next</a>)
<a name="l00920"></a>00920       <span class="keywordflow">if</span> (! pattern || re_exec (gdb-&gt;<a class="code" href="structso__list.html#a140beac8c60259f8debd88cd693b8fb4">so_name</a>))
<a name="l00921"></a>00921         {
<a name="l00922"></a>00922           <span class="comment">/* Normally, we would read the symbols from that library</span>
<a name="l00923"></a>00923 <span class="comment">             only if READSYMS is set.  However, we&#39;re making a small</span>
<a name="l00924"></a>00924 <span class="comment">             exception for the pthread library, because we sometimes</span>
<a name="l00925"></a>00925 <span class="comment">             need the library symbols to be loaded in order to provide</span>
<a name="l00926"></a>00926 <span class="comment">             thread support (x86-linux for instance).  */</span>
<a name="l00927"></a>00927           <span class="keyword">const</span> <span class="keywordtype">int</span> add_this_solib =
<a name="l00928"></a>00928             (readsyms || libpthread_solib_p (gdb));
<a name="l00929"></a>00929 
<a name="l00930"></a>00930           any_matches = 1;
<a name="l00931"></a>00931           <span class="keywordflow">if</span> (add_this_solib)
<a name="l00932"></a>00932             {
<a name="l00933"></a>00933               <span class="keywordflow">if</span> (gdb-&gt;<a class="code" href="structso__list.html#ae46552b89ed2c4c286e9e15717a93537">symbols_loaded</a>)
<a name="l00934"></a>00934                 {
<a name="l00935"></a>00935                   <span class="comment">/* If no pattern was given, be quiet for shared</span>
<a name="l00936"></a>00936 <span class="comment">                     libraries we have already loaded.  */</span>
<a name="l00937"></a>00937                   <span class="keywordflow">if</span> (pattern &amp;&amp; (from_tty || <a class="code" href="defs_8h.html#a3f2f91ed92de5dfaa6d27fb82822f8d5">info_verbose</a>))
<a name="l00938"></a>00938                     <a class="code" href="utils_8c.html#ad57145632bbcb0361dc1dfa134b1efd0">printf_unfiltered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Symbols already loaded for %s\n&quot;</span>),
<a name="l00939"></a>00939                                        gdb-&gt;<a class="code" href="structso__list.html#a140beac8c60259f8debd88cd693b8fb4">so_name</a>);
<a name="l00940"></a>00940                 }
<a name="l00941"></a>00941               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="solib_8c.html#ab84a2ead489326d22cfac6d2752a177d">solib_read_symbols</a> (gdb, flags))
<a name="l00942"></a>00942                 loaded_any_symbols = 1;
<a name="l00943"></a>00943             }
<a name="l00944"></a>00944         }
<a name="l00945"></a>00945 
<a name="l00946"></a>00946     <span class="keywordflow">if</span> (loaded_any_symbols)
<a name="l00947"></a>00947       <a class="code" href="breakpoint_8c.html#a04a0dfc2bda60f172d9e76df4fe6187f">breakpoint_re_set</a> ();
<a name="l00948"></a>00948 
<a name="l00949"></a>00949     <span class="keywordflow">if</span> (from_tty &amp;&amp; pattern &amp;&amp; ! any_matches)
<a name="l00950"></a>00950       <a class="code" href="utils_8c.html#ad57145632bbcb0361dc1dfa134b1efd0">printf_unfiltered</a>
<a name="l00951"></a>00951         (<span class="stringliteral">&quot;No loaded shared libraries match the pattern `%s&#39;.\n&quot;</span>, pattern);
<a name="l00952"></a>00952 
<a name="l00953"></a>00953     <span class="keywordflow">if</span> (loaded_any_symbols)
<a name="l00954"></a>00954       {
<a name="l00955"></a>00955         <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtarget__so__ops.html">target_so_ops</a> *ops = solib_ops (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ());
<a name="l00956"></a>00956 
<a name="l00957"></a>00957         <span class="comment">/* Getting new symbols may change our opinion about what is</span>
<a name="l00958"></a>00958 <span class="comment">           frameless.  */</span>
<a name="l00959"></a>00959         <a class="code" href="frame_8c.html#a4d98033420f1cd189e1cd764cd87fe98">reinit_frame_cache</a> ();
<a name="l00960"></a>00960 
<a name="l00961"></a>00961         ops-&gt;<a class="code" href="structtarget__so__ops.html#aecd50fa410ab64d76e8b6584133bf6fc">special_symbol_handling</a> ();
<a name="l00962"></a>00962       }
<a name="l00963"></a>00963   }
<a name="l00964"></a>00964 }
<a name="l00965"></a>00965 
<a name="l00966"></a>00966 <span class="comment">/* Implement the &quot;info sharedlibrary&quot; command.  Walk through the</span>
<a name="l00967"></a>00967 <span class="comment">   shared library list and print information about each attached</span>
<a name="l00968"></a>00968 <span class="comment">   library matching PATTERN.  If PATTERN is elided, print them</span>
<a name="l00969"></a>00969 <span class="comment">   all.  */</span>
<a name="l00970"></a>00970 
<a name="l00971"></a>00971 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00972"></a>00972 info_sharedlibrary_command (<span class="keywordtype">char</span> *pattern, <span class="keywordtype">int</span> from_tty)
<a name="l00973"></a>00973 {
<a name="l00974"></a>00974   <span class="keyword">struct </span><a class="code" href="structso__list.html">so_list</a> *so = NULL;    <span class="comment">/* link map state variable */</span>
<a name="l00975"></a>00975   <span class="keywordtype">int</span> so_missing_debug_info = 0;
<a name="l00976"></a>00976   <span class="keywordtype">int</span> addr_width;
<a name="l00977"></a>00977   <span class="keywordtype">int</span> nr_libs;
<a name="l00978"></a>00978   <span class="keyword">struct </span>cleanup *table_cleanup;
<a name="l00979"></a>00979   <span class="keyword">struct </span>gdbarch *gdbarch = <a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ();
<a name="l00980"></a>00980   <span class="keyword">struct </span>ui_out *uiout = <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>;
<a name="l00981"></a>00981 
<a name="l00982"></a>00982   <span class="keywordflow">if</span> (pattern)
<a name="l00983"></a>00983     {
<a name="l00984"></a>00984       <span class="keywordtype">char</span> *re_err = <a class="code" href="defs_8h.html#ad321e1eefeb38442e0c40b1279f41ca0">re_comp</a> (pattern);
<a name="l00985"></a>00985 
<a name="l00986"></a>00986       <span class="keywordflow">if</span> (re_err)
<a name="l00987"></a>00987         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Invalid regexp: %s&quot;</span>), re_err);
<a name="l00988"></a>00988     }
<a name="l00989"></a>00989 
<a name="l00990"></a>00990   <span class="comment">/* &quot;0x&quot;, a little whitespace, and two hex digits per byte of pointers.  */</span>
<a name="l00991"></a>00991   addr_width = 4 + (<a class="code" href="gdbarch_8c.html#ae356193e481873e4377ff922d984f13f">gdbarch_ptr_bit</a> (gdbarch) / 4);
<a name="l00992"></a>00992 
<a name="l00993"></a>00993   update_solib_list (from_tty, 0);
<a name="l00994"></a>00994 
<a name="l00995"></a>00995   <span class="comment">/* make_cleanup_ui_out_table_begin_end needs to know the number of</span>
<a name="l00996"></a>00996 <span class="comment">     rows, so we need to make two passes over the libs.  */</span>
<a name="l00997"></a>00997 
<a name="l00998"></a>00998   <span class="keywordflow">for</span> (nr_libs = 0, so = <a class="code" href="solib_8c.html#ab94f6b7dba8e4f80e8895695f826278d">so_list_head</a>; so; so = so-&gt;<a class="code" href="structso__list.html#abd46cbdf1660c79a104e6af57af31df9">next</a>)
<a name="l00999"></a>00999     {
<a name="l01000"></a>01000       <span class="keywordflow">if</span> (so-&gt;<a class="code" href="structso__list.html#a140beac8c60259f8debd88cd693b8fb4">so_name</a>[0])
<a name="l01001"></a>01001         {
<a name="l01002"></a>01002           <span class="keywordflow">if</span> (pattern &amp;&amp; ! re_exec (so-&gt;<a class="code" href="structso__list.html#a140beac8c60259f8debd88cd693b8fb4">so_name</a>))
<a name="l01003"></a>01003             <span class="keywordflow">continue</span>;
<a name="l01004"></a>01004           ++nr_libs;
<a name="l01005"></a>01005         }
<a name="l01006"></a>01006     }
<a name="l01007"></a>01007 
<a name="l01008"></a>01008   table_cleanup =
<a name="l01009"></a>01009     <a class="code" href="ui-out_8c.html#a9675e3968a06325a214ffe2fbb10bdc8">make_cleanup_ui_out_table_begin_end</a> (uiout, 4, nr_libs,
<a name="l01010"></a>01010                                          <span class="stringliteral">&quot;SharedLibraryTable&quot;</span>);
<a name="l01011"></a>01011 
<a name="l01012"></a>01012   <span class="comment">/* The &quot;- 1&quot; is because ui_out adds one space between columns.  */</span>
<a name="l01013"></a>01013   <a class="code" href="ui-out_8c.html#a6a85ff75fa4ac345725a2fd58498173f">ui_out_table_header</a> (uiout, addr_width - 1, <a class="code" href="ui-out_8h.html#ac5d0187f97768dc203458ddf644e0c7aac8a02f1b44706ba412f42aa3fc249695">ui_left</a>, <span class="stringliteral">&quot;from&quot;</span>, <span class="stringliteral">&quot;From&quot;</span>);
<a name="l01014"></a>01014   <a class="code" href="ui-out_8c.html#a6a85ff75fa4ac345725a2fd58498173f">ui_out_table_header</a> (uiout, addr_width - 1, <a class="code" href="ui-out_8h.html#ac5d0187f97768dc203458ddf644e0c7aac8a02f1b44706ba412f42aa3fc249695">ui_left</a>, <span class="stringliteral">&quot;to&quot;</span>, <span class="stringliteral">&quot;To&quot;</span>);
<a name="l01015"></a>01015   <a class="code" href="ui-out_8c.html#a6a85ff75fa4ac345725a2fd58498173f">ui_out_table_header</a> (uiout, 12 - 1, <a class="code" href="ui-out_8h.html#ac5d0187f97768dc203458ddf644e0c7aac8a02f1b44706ba412f42aa3fc249695">ui_left</a>, <span class="stringliteral">&quot;syms-read&quot;</span>, <span class="stringliteral">&quot;Syms Read&quot;</span>);
<a name="l01016"></a>01016   <a class="code" href="ui-out_8c.html#a6a85ff75fa4ac345725a2fd58498173f">ui_out_table_header</a> (uiout, 0, <a class="code" href="ui-out_8h.html#ac5d0187f97768dc203458ddf644e0c7aa0483b30a9b89be72a51d076fcd02be30">ui_noalign</a>,
<a name="l01017"></a>01017                        <span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;Shared Object Library&quot;</span>);
<a name="l01018"></a>01018 
<a name="l01019"></a>01019   <a class="code" href="ui-out_8c.html#a07042144a117bc974f5c41761b68975e">ui_out_table_body</a> (uiout);
<a name="l01020"></a>01020 
<a name="l01021"></a>01021   <span class="keywordflow">for</span> (so = <a class="code" href="solib_8c.html#ab94f6b7dba8e4f80e8895695f826278d">so_list_head</a>; so; so = so-&gt;<a class="code" href="structso__list.html#abd46cbdf1660c79a104e6af57af31df9">next</a>)
<a name="l01022"></a>01022     {
<a name="l01023"></a>01023       <span class="keyword">struct </span>cleanup *lib_cleanup;
<a name="l01024"></a>01024 
<a name="l01025"></a>01025       <span class="keywordflow">if</span> (! so-&gt;<a class="code" href="structso__list.html#a140beac8c60259f8debd88cd693b8fb4">so_name</a>[0])
<a name="l01026"></a>01026         <span class="keywordflow">continue</span>;
<a name="l01027"></a>01027       <span class="keywordflow">if</span> (pattern &amp;&amp; ! re_exec (so-&gt;<a class="code" href="structso__list.html#a140beac8c60259f8debd88cd693b8fb4">so_name</a>))
<a name="l01028"></a>01028         <span class="keywordflow">continue</span>;
<a name="l01029"></a>01029 
<a name="l01030"></a>01030       lib_cleanup = <a class="code" href="ui-out_8c.html#aaf5a0c991d74ad2e486f420d5c2ff058">make_cleanup_ui_out_tuple_begin_end</a> (uiout, <span class="stringliteral">&quot;lib&quot;</span>);
<a name="l01031"></a>01031 
<a name="l01032"></a>01032       <span class="keywordflow">if</span> (so-&gt;<a class="code" href="structso__list.html#a368c10a6a2b60168d577b19cb9444958">addr_high</a> != 0)
<a name="l01033"></a>01033         {
<a name="l01034"></a>01034           <a class="code" href="ui-out_8c.html#ada85ed653fecf3c2a80027de6f71ef71">ui_out_field_core_addr</a> (uiout, <span class="stringliteral">&quot;from&quot;</span>, gdbarch, so-&gt;<a class="code" href="structso__list.html#afb4c2609ac1d34a1f0501ed51f4ce262">addr_low</a>);
<a name="l01035"></a>01035           <a class="code" href="ui-out_8c.html#ada85ed653fecf3c2a80027de6f71ef71">ui_out_field_core_addr</a> (uiout, <span class="stringliteral">&quot;to&quot;</span>, gdbarch, so-&gt;<a class="code" href="structso__list.html#a368c10a6a2b60168d577b19cb9444958">addr_high</a>);
<a name="l01036"></a>01036         }
<a name="l01037"></a>01037       <span class="keywordflow">else</span>
<a name="l01038"></a>01038         {
<a name="l01039"></a>01039           <a class="code" href="ui-out_8c.html#a5366a822858ecedafef54625bec57442">ui_out_field_skip</a> (uiout, <span class="stringliteral">&quot;from&quot;</span>);
<a name="l01040"></a>01040           <a class="code" href="ui-out_8c.html#a5366a822858ecedafef54625bec57442">ui_out_field_skip</a> (uiout, <span class="stringliteral">&quot;to&quot;</span>);
<a name="l01041"></a>01041         }
<a name="l01042"></a>01042 
<a name="l01043"></a>01043       <span class="keywordflow">if</span> (! <a class="code" href="ui-out_8c.html#a473db54efcfbc60feeb5a4f54f27af46">ui_out_is_mi_like_p</a> (<a class="code" href="interps_8c.html#a8e9dd8dc026ec4b76ae0c0a27a97383d">interp_ui_out</a> (<a class="code" href="interps_8c.html#a55d2f9afbe93d6b241b23fdffb5f17a4">top_level_interpreter</a> ()))
<a name="l01044"></a>01044           &amp;&amp; so-&gt;<a class="code" href="structso__list.html#ae46552b89ed2c4c286e9e15717a93537">symbols_loaded</a>
<a name="l01045"></a>01045           &amp;&amp; !<a class="code" href="objfiles_8c.html#a4ce59bee0b77fe55f4e326c7ecad3f6a">objfile_has_symbols</a> (so-&gt;<a class="code" href="structso__list.html#ada33ba2c171b3b53b3414f616b680b8e">objfile</a>))
<a name="l01046"></a>01046         {
<a name="l01047"></a>01047           so_missing_debug_info = 1;
<a name="l01048"></a>01048           <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;syms-read&quot;</span>, <span class="stringliteral">&quot;Yes (*)&quot;</span>);
<a name="l01049"></a>01049         }
<a name="l01050"></a>01050       <span class="keywordflow">else</span>
<a name="l01051"></a>01051         <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;syms-read&quot;</span>, 
<a name="l01052"></a>01052                              so-&gt;<a class="code" href="structso__list.html#ae46552b89ed2c4c286e9e15717a93537">symbols_loaded</a> ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>);
<a name="l01053"></a>01053 
<a name="l01054"></a>01054       <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;name&quot;</span>, so-&gt;<a class="code" href="structso__list.html#a140beac8c60259f8debd88cd693b8fb4">so_name</a>);
<a name="l01055"></a>01055 
<a name="l01056"></a>01056       <a class="code" href="ui-out_8c.html#a6a23596295dce32ba2a5bd2fd2d309f8">ui_out_text</a> (uiout, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01057"></a>01057 
<a name="l01058"></a>01058       <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (lib_cleanup);
<a name="l01059"></a>01059     }
<a name="l01060"></a>01060 
<a name="l01061"></a>01061   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (table_cleanup);
<a name="l01062"></a>01062 
<a name="l01063"></a>01063   <span class="keywordflow">if</span> (nr_libs == 0)
<a name="l01064"></a>01064     {
<a name="l01065"></a>01065       <span class="keywordflow">if</span> (pattern)
<a name="l01066"></a>01066         <a class="code" href="ui-out_8c.html#a65967c27cd058d2739afdbc5a51f377e">ui_out_message</a> (uiout, 0,
<a name="l01067"></a>01067                         <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No shared libraries matched.\n&quot;</span>));
<a name="l01068"></a>01068       <span class="keywordflow">else</span>
<a name="l01069"></a>01069         <a class="code" href="ui-out_8c.html#a65967c27cd058d2739afdbc5a51f377e">ui_out_message</a> (uiout, 0,
<a name="l01070"></a>01070                         <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No shared libraries loaded at this time.\n&quot;</span>));
<a name="l01071"></a>01071     }
<a name="l01072"></a>01072   <span class="keywordflow">else</span>
<a name="l01073"></a>01073     {
<a name="l01074"></a>01074       <span class="keywordflow">if</span> (so_missing_debug_info)
<a name="l01075"></a>01075         <a class="code" href="ui-out_8c.html#a65967c27cd058d2739afdbc5a51f377e">ui_out_message</a> (uiout, 0,
<a name="l01076"></a>01076                         <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;(*): Shared library is missing &quot;</span>
<a name="l01077"></a>01077                           <span class="stringliteral">&quot;debugging information.\n&quot;</span>));
<a name="l01078"></a>01078     }
<a name="l01079"></a>01079 }
<a name="l01080"></a>01080 
<a name="l01081"></a>01081 <span class="comment">/* Return 1 if ADDRESS lies within SOLIB.  */</span>
<a name="l01082"></a>01082 
<a name="l01083"></a>01083 <span class="keywordtype">int</span>
<a name="l01084"></a><a class="code" href="solib_8h.html#af5ac306088d44b6bbbbc0436e6dcc792">01084</a> <a class="code" href="solib_8c.html#adf1869b9204c01a98a37df618376e588">solib_contains_address_p</a> (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structso__list.html">so_list</a> *<span class="keyword">const</span> solib,
<a name="l01085"></a>01085                           <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> address)
<a name="l01086"></a>01086 {
<a name="l01087"></a>01087   <span class="keyword">struct </span><a class="code" href="structtarget__section.html">target_section</a> *p;
<a name="l01088"></a>01088 
<a name="l01089"></a>01089   <span class="keywordflow">for</span> (p = solib-&gt;<a class="code" href="structso__list.html#a2f4ffed0b41b6e9e67bb797acad339f0">sections</a>; p &lt; solib-&gt;<a class="code" href="exec_8h.html#aeefd9f755c6fe225ce504a5cc6074e8e">sections_end</a>; p++)
<a name="l01090"></a>01090     <span class="keywordflow">if</span> (p-&gt;<a class="code" href="structtarget__section.html#a3e4564d6ceb39f962f70bb7afdd3b260">addr</a> &lt;= address &amp;&amp; address &lt; p-&gt;<a class="code" href="structtarget__section.html#a2c1890ede65bfce986a3e16682e76072">endaddr</a>)
<a name="l01091"></a>01091       <span class="keywordflow">return</span> 1;
<a name="l01092"></a>01092 
<a name="l01093"></a>01093   <span class="keywordflow">return</span> 0;
<a name="l01094"></a>01094 }
<a name="l01095"></a>01095 
<a name="l01096"></a>01096 <span class="comment">/* If ADDRESS is in a shared lib in program space PSPACE, return its</span>
<a name="l01097"></a>01097 <span class="comment">   name.</span>
<a name="l01098"></a>01098 <span class="comment"></span>
<a name="l01099"></a>01099 <span class="comment">   Provides a hook for other gdb routines to discover whether or not a</span>
<a name="l01100"></a>01100 <span class="comment">   particular address is within the mapped address space of a shared</span>
<a name="l01101"></a>01101 <span class="comment">   library.</span>
<a name="l01102"></a>01102 <span class="comment"></span>
<a name="l01103"></a>01103 <span class="comment">   For example, this routine is called at one point to disable</span>
<a name="l01104"></a>01104 <span class="comment">   breakpoints which are in shared libraries that are not currently</span>
<a name="l01105"></a>01105 <span class="comment">   mapped in.  */</span>
<a name="l01106"></a>01106 
<a name="l01107"></a>01107 <span class="keywordtype">char</span> *
<a name="l01108"></a><a class="code" href="solib_8h.html#a3c07c593f047c0a14b05c32ba6407816">01108</a> <a class="code" href="solib_8c.html#aeb7eeab1d9375e787425078df3a08b9d">solib_name_from_address</a> (<span class="keyword">struct</span> <a class="code" href="structprogram__space.html">program_space</a> *pspace, <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> address)
<a name="l01109"></a>01109 {
<a name="l01110"></a>01110   <span class="keyword">struct </span><a class="code" href="structso__list.html">so_list</a> *so = NULL;
<a name="l01111"></a>01111 
<a name="l01112"></a>01112   <span class="keywordflow">for</span> (so = pspace-&gt;<a class="code" href="structprogram__space.html#af751ea3165b5f81d02dfbe17ccf8576e">so_list</a>; so; so = so-&gt;<a class="code" href="structso__list.html#abd46cbdf1660c79a104e6af57af31df9">next</a>)
<a name="l01113"></a>01113     <span class="keywordflow">if</span> (<a class="code" href="solib_8c.html#adf1869b9204c01a98a37df618376e588">solib_contains_address_p</a> (so, address))
<a name="l01114"></a>01114       <span class="keywordflow">return</span> (so-&gt;<a class="code" href="structso__list.html#a140beac8c60259f8debd88cd693b8fb4">so_name</a>);
<a name="l01115"></a>01115 
<a name="l01116"></a>01116   <span class="keywordflow">return</span> (0);
<a name="l01117"></a>01117 }
<a name="l01118"></a>01118 
<a name="l01119"></a>01119 <span class="comment">/* Return whether the data starting at VADDR, size SIZE, must be kept</span>
<a name="l01120"></a>01120 <span class="comment">   in a core file for shared libraries loaded before &quot;gcore&quot; is used</span>
<a name="l01121"></a>01121 <span class="comment">   to be handled correctly when the core file is loaded.  This only</span>
<a name="l01122"></a>01122 <span class="comment">   applies when the section would otherwise not be kept in the core</span>
<a name="l01123"></a>01123 <span class="comment">   file (in particular, for readonly sections).  */</span>
<a name="l01124"></a>01124 
<a name="l01125"></a>01125 <span class="keywordtype">int</span>
<a name="l01126"></a><a class="code" href="solib_8h.html#a3b6cb9b6cf696a82807fe8a2f1318b5a">01126</a> <a class="code" href="solib_8c.html#a3b6cb9b6cf696a82807fe8a2f1318b5a">solib_keep_data_in_core</a> (<a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> vaddr, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="go32-nat_8c.html#a854352f53b148adc24983a58a1866d66">size</a>)
<a name="l01127"></a>01127 {
<a name="l01128"></a>01128   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtarget__so__ops.html">target_so_ops</a> *ops = solib_ops (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ());
<a name="l01129"></a>01129 
<a name="l01130"></a>01130   <span class="keywordflow">if</span> (ops-&gt;<a class="code" href="structtarget__so__ops.html#a8c998c83ff8d80cdb50045a8edca3deb">keep_data_in_core</a>)
<a name="l01131"></a>01131     <span class="keywordflow">return</span> ops-&gt;<a class="code" href="structtarget__so__ops.html#a8c998c83ff8d80cdb50045a8edca3deb">keep_data_in_core</a> (vaddr, size);
<a name="l01132"></a>01132   <span class="keywordflow">else</span>
<a name="l01133"></a>01133     <span class="keywordflow">return</span> 0;
<a name="l01134"></a>01134 }
<a name="l01135"></a>01135 
<a name="l01136"></a>01136 <span class="comment">/* Called by free_all_symtabs */</span>
<a name="l01137"></a>01137 
<a name="l01138"></a>01138 <span class="keywordtype">void</span>
<a name="l01139"></a><a class="code" href="symtab_8h.html#a471268865936823d85aafa4c60db2d84">01139</a> <a class="code" href="solib_8c.html#a471268865936823d85aafa4c60db2d84">clear_solib</a> (<span class="keywordtype">void</span>)
<a name="l01140"></a>01140 {
<a name="l01141"></a>01141   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtarget__so__ops.html">target_so_ops</a> *ops = solib_ops (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ());
<a name="l01142"></a>01142 
<a name="l01143"></a>01143   <span class="comment">/* This function is expected to handle ELF shared libraries.  It is</span>
<a name="l01144"></a>01144 <span class="comment">     also used on Solaris, which can run either ELF or a.out binaries</span>
<a name="l01145"></a>01145 <span class="comment">     (for compatibility with SunOS 4), both of which can use shared</span>
<a name="l01146"></a>01146 <span class="comment">     libraries.  So we don&#39;t know whether we have an ELF executable or</span>
<a name="l01147"></a>01147 <span class="comment">     an a.out executable until the user chooses an executable file.</span>
<a name="l01148"></a>01148 <span class="comment"></span>
<a name="l01149"></a>01149 <span class="comment">     ELF shared libraries don&#39;t get mapped into the address space</span>
<a name="l01150"></a>01150 <span class="comment">     until after the program starts, so we&#39;d better not try to insert</span>
<a name="l01151"></a>01151 <span class="comment">     breakpoints in them immediately.  We have to wait until the</span>
<a name="l01152"></a>01152 <span class="comment">     dynamic linker has loaded them; we&#39;ll hit a bp_shlib_event</span>
<a name="l01153"></a>01153 <span class="comment">     breakpoint (look for calls to create_solib_event_breakpoint) when</span>
<a name="l01154"></a>01154 <span class="comment">     it&#39;s ready.</span>
<a name="l01155"></a>01155 <span class="comment"></span>
<a name="l01156"></a>01156 <span class="comment">     SunOS shared libraries seem to be different --- they&#39;re present</span>
<a name="l01157"></a>01157 <span class="comment">     as soon as the process begins execution, so there&#39;s no need to</span>
<a name="l01158"></a>01158 <span class="comment">     put off inserting breakpoints.  There&#39;s also nowhere to put a</span>
<a name="l01159"></a>01159 <span class="comment">     bp_shlib_event breakpoint, so if we put it off, we&#39;ll never get</span>
<a name="l01160"></a>01160 <span class="comment">     around to it.</span>
<a name="l01161"></a>01161 <span class="comment"></span>
<a name="l01162"></a>01162 <span class="comment">     So: disable breakpoints only if we&#39;re using ELF shared libs.  */</span>
<a name="l01163"></a>01163   <span class="keywordflow">if</span> (<a class="code" href="exec_8h.html#ac2e2e739fca42163e235e8521b9fbbab">exec_bfd</a> != NULL
<a name="l01164"></a>01164       &amp;&amp; bfd_get_flavour (<a class="code" href="exec_8h.html#ac2e2e739fca42163e235e8521b9fbbab">exec_bfd</a>) != bfd_target_aout_flavour)
<a name="l01165"></a>01165     <a class="code" href="breakpoint_8c.html#aced0980dfe19a7123cfbc26a8540b754">disable_breakpoints_in_shlibs</a> ();
<a name="l01166"></a>01166 
<a name="l01167"></a>01167   <span class="keywordflow">while</span> (<a class="code" href="solib_8c.html#ab94f6b7dba8e4f80e8895695f826278d">so_list_head</a>)
<a name="l01168"></a>01168     {
<a name="l01169"></a>01169       <span class="keyword">struct </span><a class="code" href="structso__list.html">so_list</a> *so = <a class="code" href="solib_8c.html#ab94f6b7dba8e4f80e8895695f826278d">so_list_head</a>;
<a name="l01170"></a>01170 
<a name="l01171"></a>01171       <a class="code" href="solib_8c.html#ab94f6b7dba8e4f80e8895695f826278d">so_list_head</a> = so-&gt;<a class="code" href="structso__list.html#abd46cbdf1660c79a104e6af57af31df9">next</a>;
<a name="l01172"></a>01172       <a class="code" href="observer_8h.html#aa52867c532fe4106eb7952255260923c">observer_notify_solib_unloaded</a> (so);
<a name="l01173"></a>01173       <a class="code" href="exec_8c.html#a2ff3e379a4940b551777815d9671351f">remove_target_sections</a> (so);
<a name="l01174"></a>01174       <a class="code" href="solib_8c.html#a3fdb0779b9680743df73f5fbd2163e8f">free_so</a> (so);
<a name="l01175"></a>01175     }
<a name="l01176"></a>01176 
<a name="l01177"></a>01177   ops-&gt;<a class="code" href="structtarget__so__ops.html#a2511b006e5727e3363cc51f6d5bd096b">clear_solib</a> ();
<a name="l01178"></a>01178 }
<a name="l01179"></a>01179 
<a name="l01180"></a>01180 <span class="comment">/* Shared library startup support.  When GDB starts up the inferior,</span>
<a name="l01181"></a>01181 <span class="comment">   it nurses it along (through the shell) until it is ready to execute</span>
<a name="l01182"></a>01182 <span class="comment">   its first instruction.  At this point, this function gets</span>
<a name="l01183"></a>01183 <span class="comment">   called.  */</span>
<a name="l01184"></a>01184 
<a name="l01185"></a>01185 <span class="keywordtype">void</span>
<a name="l01186"></a><a class="code" href="solib_8h.html#a2ce38fbf9665afc74ffe9b07d8932453">01186</a> <a class="code" href="solib_8c.html#a2ce38fbf9665afc74ffe9b07d8932453">solib_create_inferior_hook</a> (<span class="keywordtype">int</span> from_tty)
<a name="l01187"></a>01187 {
<a name="l01188"></a>01188   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtarget__so__ops.html">target_so_ops</a> *ops = solib_ops (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ());
<a name="l01189"></a>01189 
<a name="l01190"></a>01190   ops-&gt;<a class="code" href="structtarget__so__ops.html#add929a52c64b345eabcb62350b23c44f">solib_create_inferior_hook</a> (from_tty);
<a name="l01191"></a>01191 }
<a name="l01192"></a>01192 
<a name="l01193"></a>01193 <span class="comment">/* Check to see if an address is in the dynamic loader&#39;s dynamic</span>
<a name="l01194"></a>01194 <span class="comment">   symbol resolution code.  Return 1 if so, 0 otherwise.  */</span>
<a name="l01195"></a>01195 
<a name="l01196"></a>01196 <span class="keywordtype">int</span>
<a name="l01197"></a><a class="code" href="solib_8h.html#ac6cd8f2c51c66300baab08dfe1c00eab">01197</a> <a class="code" href="solib_8c.html#a63b7da294bc5cd2a79a241250fb1606b">in_solib_dynsym_resolve_code</a> (<a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> pc)
<a name="l01198"></a>01198 {
<a name="l01199"></a>01199   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtarget__so__ops.html">target_so_ops</a> *ops = solib_ops (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ());
<a name="l01200"></a>01200 
<a name="l01201"></a>01201   <span class="keywordflow">return</span> ops-&gt;<a class="code" href="structtarget__so__ops.html#abffc72bc9b22df15bb37a351e80f6c39">in_dynsym_resolve_code</a> (pc);
<a name="l01202"></a>01202 }
<a name="l01203"></a>01203 
<a name="l01204"></a>01204 <span class="comment">/* Implements the &quot;sharedlibrary&quot; command.  */</span>
<a name="l01205"></a>01205 
<a name="l01206"></a>01206 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01207"></a>01207 sharedlibrary_command (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l01208"></a>01208 {
<a name="l01209"></a>01209   <a class="code" href="command_8h.html#ac7af34b03605d65b114a173d49532050">dont_repeat</a> ();
<a name="l01210"></a>01210   <a class="code" href="solib_8c.html#a719646b8c356bae54efdd071cd3d7186">solib_add</a> (args, from_tty, (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *) 0, 1);
<a name="l01211"></a>01211 }
<a name="l01212"></a>01212 
<a name="l01213"></a>01213 <span class="comment">/* Implements the command &quot;nosharedlibrary&quot;, which discards symbols</span>
<a name="l01214"></a>01214 <span class="comment">   that have been auto-loaded from shared libraries.  Symbols from</span>
<a name="l01215"></a>01215 <span class="comment">   shared libraries that were added by explicit request of the user</span>
<a name="l01216"></a>01216 <span class="comment">   are not discarded.  Also called from remote.c.  */</span>
<a name="l01217"></a>01217 
<a name="l01218"></a>01218 <span class="keywordtype">void</span>
<a name="l01219"></a><a class="code" href="solib_8h.html#aa4c24d50468807449d5cca1566e2c7c0">01219</a> <a class="code" href="solib_8c.html#aa4c24d50468807449d5cca1566e2c7c0">no_shared_libraries</a> (<span class="keywordtype">char</span> *ignored, <span class="keywordtype">int</span> from_tty)
<a name="l01220"></a>01220 {
<a name="l01221"></a>01221   <span class="comment">/* The order of the two routines below is important: clear_solib notifies</span>
<a name="l01222"></a>01222 <span class="comment">     the solib_unloaded observers, and some of these observers might need</span>
<a name="l01223"></a>01223 <span class="comment">     access to their associated objfiles.  Therefore, we can not purge the</span>
<a name="l01224"></a>01224 <span class="comment">     solibs&#39; objfiles before clear_solib has been called.  */</span>
<a name="l01225"></a>01225 
<a name="l01226"></a>01226   <a class="code" href="solib_8c.html#a471268865936823d85aafa4c60db2d84">clear_solib</a> ();
<a name="l01227"></a>01227   <a class="code" href="objfiles_8c.html#a4ea3ea4604b0a1557e6354e195b7a638">objfile_purge_solibs</a> ();
<a name="l01228"></a>01228 }
<a name="l01229"></a>01229 
<a name="l01230"></a>01230 <span class="comment">/* See solib.h.  */</span>
<a name="l01231"></a>01231 
<a name="l01232"></a>01232 <span class="keywordtype">void</span>
<a name="l01233"></a><a class="code" href="solib_8h.html#aa615b0b68ec2f75032baa5c1d24ab902">01233</a> <a class="code" href="solib_8c.html#aa615b0b68ec2f75032baa5c1d24ab902">update_solib_breakpoints</a> (<span class="keywordtype">void</span>)
<a name="l01234"></a>01234 {
<a name="l01235"></a>01235   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtarget__so__ops.html">target_so_ops</a> *ops = solib_ops (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ());
<a name="l01236"></a>01236 
<a name="l01237"></a>01237   <span class="keywordflow">if</span> (ops-&gt;<a class="code" href="structtarget__so__ops.html#aa1a72bcfbad339ffe9fc74f06e5d4648">update_breakpoints</a> != NULL)
<a name="l01238"></a>01238     ops-&gt;<a class="code" href="structtarget__so__ops.html#aa1a72bcfbad339ffe9fc74f06e5d4648">update_breakpoints</a> ();
<a name="l01239"></a>01239 }
<a name="l01240"></a>01240 
<a name="l01241"></a>01241 <span class="comment">/* See solib.h.  */</span>
<a name="l01242"></a>01242 
<a name="l01243"></a>01243 <span class="keywordtype">void</span>
<a name="l01244"></a><a class="code" href="solib_8h.html#ad287e541d33b61f51058be4a592f5d14">01244</a> <a class="code" href="solib_8c.html#ad287e541d33b61f51058be4a592f5d14">handle_solib_event</a> (<span class="keywordtype">void</span>)
<a name="l01245"></a>01245 {
<a name="l01246"></a>01246   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtarget__so__ops.html">target_so_ops</a> *ops = solib_ops (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ());
<a name="l01247"></a>01247 
<a name="l01248"></a>01248   <span class="keywordflow">if</span> (ops-&gt;<a class="code" href="structtarget__so__ops.html#ac745d551cddc3754129ddb82f83a2a28">handle_event</a> != NULL)
<a name="l01249"></a>01249     ops-&gt;<a class="code" href="structtarget__so__ops.html#ac745d551cddc3754129ddb82f83a2a28">handle_event</a> ();
<a name="l01250"></a>01250 
<a name="l01251"></a>01251   <a class="code" href="progspace_8c.html#a52f232c91e5cda4df378eea8e97c69c5">clear_program_space_solib_cache</a> (<a class="code" href="inferior_8c.html#a9e592c83e7c0c1f89f1a4a392bd1a277">current_inferior</a> ()-&gt;pspace);
<a name="l01252"></a>01252 
<a name="l01253"></a>01253   <span class="comment">/* Check for any newly added shared libraries if we&#39;re supposed to</span>
<a name="l01254"></a>01254 <span class="comment">     be adding them automatically.  Switch terminal for any messages</span>
<a name="l01255"></a>01255 <span class="comment">     produced by breakpoint_re_set.  */</span>
<a name="l01256"></a>01256   <a class="code" href="target_8h.html#a7369fcccf2537d98bda58de2a655e1d2">target_terminal_ours_for_output</a> ();
<a name="l01257"></a>01257   <a class="code" href="solib_8c.html#a719646b8c356bae54efdd071cd3d7186">solib_add</a> (NULL, 0, &amp;<a class="code" href="target_8h.html#a2d8640b030266b58d3821eb5cfd112b9">current_target</a>, <a class="code" href="symfile_8h.html#a039a97d840ec2d6a8471b6b665ea2a29">auto_solib_add</a>);
<a name="l01258"></a>01258   <a class="code" href="target_8c.html#aab397975a1893898dcd07c8ed9aca04c">target_terminal_inferior</a> ();
<a name="l01259"></a>01259 }
<a name="l01260"></a>01260 
<a name="l01261"></a>01261 <span class="comment">/* Reload shared libraries, but avoid reloading the same symbol file</span>
<a name="l01262"></a>01262 <span class="comment">   we already have loaded.  */</span>
<a name="l01263"></a>01263 
<a name="l01264"></a>01264 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01265"></a>01265 reload_shared_libraries_1 (<span class="keywordtype">int</span> from_tty)
<a name="l01266"></a>01266 {
<a name="l01267"></a>01267   <span class="keyword">struct </span><a class="code" href="structso__list.html">so_list</a> *so;
<a name="l01268"></a>01268   <span class="keyword">struct </span>cleanup *old_chain = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="cleanups_8c.html#a1ec2a3980c2be1f31f2142103d1f7abf">null_cleanup</a>, NULL);
<a name="l01269"></a>01269 
<a name="l01270"></a>01270   <span class="keywordflow">for</span> (so = <a class="code" href="solib_8c.html#ab94f6b7dba8e4f80e8895695f826278d">so_list_head</a>; so != NULL; so = so-&gt;<a class="code" href="structso__list.html#abd46cbdf1660c79a104e6af57af31df9">next</a>)
<a name="l01271"></a>01271     {
<a name="l01272"></a>01272       <span class="keywordtype">char</span> *filename, *found_pathname = NULL;
<a name="l01273"></a>01273       bfd *abfd;
<a name="l01274"></a>01274       <span class="keywordtype">int</span> was_loaded = so-&gt;<a class="code" href="structso__list.html#ae46552b89ed2c4c286e9e15717a93537">symbols_loaded</a>;
<a name="l01275"></a>01275       <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="solib-som_8c.html#a555096840020c318e34b205419e98cca">flags</a> =
<a name="l01276"></a>01276         <a class="code" href="symfile_8h.html#a5c7691860be0cad5cf5b695b6b40997baddec766cccdace139d8ac616501972e9">SYMFILE_DEFER_BP_RESET</a> | (from_tty ? <a class="code" href="symfile_8h.html#a5c7691860be0cad5cf5b695b6b40997ba9ffe555bbe5c64b8ef5ea46c282644d1">SYMFILE_VERBOSE</a> : 0);
<a name="l01277"></a>01277 
<a name="l01278"></a>01278       filename = tilde_expand (so-&gt;<a class="code" href="structso__list.html#acaf1629339fc6d9e734dcc6b9ce02bbf">so_original_name</a>);
<a name="l01279"></a>01279       <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, filename);
<a name="l01280"></a>01280       abfd = <a class="code" href="solib_8c.html#aa95e8070f3d946cfbfa2b84ceb45d32f">solib_bfd_open</a> (filename);
<a name="l01281"></a>01281       <span class="keywordflow">if</span> (abfd != NULL)
<a name="l01282"></a>01282         {
<a name="l01283"></a>01283           found_pathname = xstrdup (bfd_get_filename (abfd));
<a name="l01284"></a>01284           <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, found_pathname);
<a name="l01285"></a>01285           <a class="code" href="gdb__bfd_8c.html#a1027b59a8494f937b5760901040dc125">gdb_bfd_unref</a> (abfd);
<a name="l01286"></a>01286         }
<a name="l01287"></a>01287 
<a name="l01288"></a>01288       <span class="comment">/* If this shared library is no longer associated with its previous</span>
<a name="l01289"></a>01289 <span class="comment">         symbol file, close that.  */</span>
<a name="l01290"></a>01290       <span class="keywordflow">if</span> ((found_pathname == NULL &amp;&amp; was_loaded)
<a name="l01291"></a>01291           || (found_pathname != NULL
<a name="l01292"></a>01292               &amp;&amp; filename_cmp (found_pathname, so-&gt;<a class="code" href="structso__list.html#a140beac8c60259f8debd88cd693b8fb4">so_name</a>) != 0))
<a name="l01293"></a>01293         {
<a name="l01294"></a>01294           <span class="keywordflow">if</span> (so-&gt;<a class="code" href="structso__list.html#ada33ba2c171b3b53b3414f616b680b8e">objfile</a> &amp;&amp; ! (so-&gt;<a class="code" href="structso__list.html#ada33ba2c171b3b53b3414f616b680b8e">objfile</a>-&gt;<a class="code" href="structobjfile.html#a07578e542db3b2a277e146b24adf007e">flags</a> &amp; <a class="code" href="objfiles_8h.html#a83dcbdaa349319071b86d581ed72b557">OBJF_USERLOADED</a>)
<a name="l01295"></a>01295               &amp;&amp; !solib_used (so))
<a name="l01296"></a>01296             <a class="code" href="objfiles_8c.html#abaf0cc9c95a939f0411ab167e17acdca">free_objfile</a> (so-&gt;<a class="code" href="structso__list.html#ada33ba2c171b3b53b3414f616b680b8e">objfile</a>);
<a name="l01297"></a>01297           <a class="code" href="exec_8c.html#a2ff3e379a4940b551777815d9671351f">remove_target_sections</a> (so);
<a name="l01298"></a>01298           clear_so (so);
<a name="l01299"></a>01299         }
<a name="l01300"></a>01300 
<a name="l01301"></a>01301       <span class="comment">/* If this shared library is now associated with a new symbol</span>
<a name="l01302"></a>01302 <span class="comment">         file, open it.  */</span>
<a name="l01303"></a>01303       <span class="keywordflow">if</span> (found_pathname != NULL
<a name="l01304"></a>01304           &amp;&amp; (!was_loaded
<a name="l01305"></a>01305               || filename_cmp (found_pathname, so-&gt;<a class="code" href="structso__list.html#a140beac8c60259f8debd88cd693b8fb4">so_name</a>) != 0))
<a name="l01306"></a>01306         {
<a name="l01307"></a>01307           <span class="keyword">volatile</span> <span class="keyword">struct </span><a class="code" href="structgdb__exception.html">gdb_exception</a> e;
<a name="l01308"></a>01308 
<a name="l01309"></a>01309           <a class="code" href="exceptions_8h.html#aef4514ee39b9305fddee27f49c7c34eb">TRY_CATCH</a> (e, <a class="code" href="exceptions_8h.html#abfa3a3b99557b11f5766baf69465fdf6a44de51845416ac49ab08438792b908f0">RETURN_MASK_ERROR</a>)
<a name="l01310"></a>01310             solib_map_sections (so);
<a name="l01311"></a>01311 
<a name="l01312"></a>01312           if (e.<a class="code" href="structgdb__exception.html#ae0e14189c63f830024865d557c1122cc">reason</a> &lt; 0)
<a name="l01313"></a>01313             <a class="code" href="exceptions_8c.html#ae1dffc77e3a96d17e813da7d2165b16d">exception_fprintf</a> (<a class="code" href="main_8c.html#a2a1dea1e551cadb9541353a004193a47">gdb_stderr</a>, e,
<a name="l01314"></a>01314                                <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(&quot;Error while mapping &quot;
<a name="l01315"></a>01315                                  &quot;shared library <a class="code" href="exec_8h.html#a3e0e53a8d37c80fda131b2b35cb2a10f">sections</a>:\n&quot;));
<a name="l01316"></a>01316           else if (auto_solib_add || was_loaded || libpthread_solib_p (so))
<a name="l01317"></a>01317             <a class="code" href="solib_8c.html#ab84a2ead489326d22cfac6d2752a177d">solib_read_symbols</a> (so, flags);
<a name="l01318"></a>01318         }
<a name="l01319"></a>01319     }
<a name="l01320"></a>01320 
<a name="l01321"></a>01321   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l01322"></a>01322 }
<a name="l01323"></a>01323 
<a name="l01324"></a>01324 static <span class="keywordtype">void</span>
<a name="l01325"></a>01325 reload_shared_libraries (<span class="keywordtype">char</span> *ignored, <span class="keywordtype">int</span> from_tty,
<a name="l01326"></a>01326                          struct <a class="code" href="structcmd__list__element.html">cmd_list_element</a> *e)
<a name="l01327"></a>01327 {
<a name="l01328"></a>01328   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtarget__so__ops.html">target_so_ops</a> *ops;
<a name="l01329"></a>01329 
<a name="l01330"></a>01330   reload_shared_libraries_1 (from_tty);
<a name="l01331"></a>01331 
<a name="l01332"></a>01332   ops = solib_ops (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ());
<a name="l01333"></a>01333 
<a name="l01334"></a>01334   <span class="comment">/* Creating inferior hooks here has two purposes.  First, if we reload </span>
<a name="l01335"></a>01335 <span class="comment">     shared libraries then the address of solib breakpoint we&#39;ve computed</span>
<a name="l01336"></a>01336 <span class="comment">     previously might be no longer valid.  For example, if we forgot to set</span>
<a name="l01337"></a>01337 <span class="comment">     solib-absolute-prefix and are setting it right now, then the previous</span>
<a name="l01338"></a>01338 <span class="comment">     breakpoint address is plain wrong.  Second, installing solib hooks</span>
<a name="l01339"></a>01339 <span class="comment">     also implicitly figures were ld.so is and loads symbols for it.</span>
<a name="l01340"></a>01340 <span class="comment">     Absent this call, if we&#39;ve just connected to a target and set </span>
<a name="l01341"></a>01341 <span class="comment">     solib-absolute-prefix or solib-search-path, we&#39;ll lose all information</span>
<a name="l01342"></a>01342 <span class="comment">     about ld.so.  */</span>
<a name="l01343"></a>01343   <span class="keywordflow">if</span> (<a class="code" href="target_8h.html#a85885df22f7c1304269eaba1e1d618b7">target_has_execution</a>)
<a name="l01344"></a>01344     {
<a name="l01345"></a>01345       <span class="comment">/* Reset or free private data structures not associated with</span>
<a name="l01346"></a>01346 <span class="comment">         so_list entries.  */</span>
<a name="l01347"></a>01347       ops-&gt;<a class="code" href="structtarget__so__ops.html#a2511b006e5727e3363cc51f6d5bd096b">clear_solib</a> ();
<a name="l01348"></a>01348 
<a name="l01349"></a>01349       <span class="comment">/* Remove any previous solib event breakpoint.  This is usually</span>
<a name="l01350"></a>01350 <span class="comment">         done in common code, at breakpoint_init_inferior time, but</span>
<a name="l01351"></a>01351 <span class="comment">         we&#39;re not really starting up the inferior here.  */</span>
<a name="l01352"></a>01352       <a class="code" href="breakpoint_8c.html#a840c1cf382a3ee5129b261e8cd09f186">remove_solib_event_breakpoints</a> ();
<a name="l01353"></a>01353 
<a name="l01354"></a>01354       <a class="code" href="solib_8c.html#a2ce38fbf9665afc74ffe9b07d8932453">solib_create_inferior_hook</a> (from_tty);
<a name="l01355"></a>01355     }
<a name="l01356"></a>01356 
<a name="l01357"></a>01357   <span class="comment">/* Sometimes the platform-specific hook loads initial shared</span>
<a name="l01358"></a>01358 <span class="comment">     libraries, and sometimes it doesn&#39;t.  If it doesn&#39;t FROM_TTY will be</span>
<a name="l01359"></a>01359 <span class="comment">     incorrectly 0 but such solib targets should be fixed anyway.  If we</span>
<a name="l01360"></a>01360 <span class="comment">     made all the inferior hook methods consistent, this call could be</span>
<a name="l01361"></a>01361 <span class="comment">     removed.  Call it only after the solib target has been initialized by</span>
<a name="l01362"></a>01362 <span class="comment">     solib_create_inferior_hook.  */</span>
<a name="l01363"></a>01363 
<a name="l01364"></a>01364   <a class="code" href="solib_8c.html#a719646b8c356bae54efdd071cd3d7186">solib_add</a> (NULL, 0, NULL, auto_solib_add);
<a name="l01365"></a>01365 
<a name="l01366"></a>01366   <a class="code" href="breakpoint_8c.html#a04a0dfc2bda60f172d9e76df4fe6187f">breakpoint_re_set</a> ();
<a name="l01367"></a>01367 
<a name="l01368"></a>01368   <span class="comment">/* We may have loaded or unloaded debug info for some (or all)</span>
<a name="l01369"></a>01369 <span class="comment">     shared libraries.  However, frames may still reference them.  For</span>
<a name="l01370"></a>01370 <span class="comment">     example, a frame&#39;s unwinder might still point at DWARF FDE</span>
<a name="l01371"></a>01371 <span class="comment">     structures that are now freed.  Also, getting new symbols may</span>
<a name="l01372"></a>01372 <span class="comment">     change our opinion about what is frameless.  */</span>
<a name="l01373"></a>01373   <a class="code" href="frame_8c.html#a4d98033420f1cd189e1cd764cd87fe98">reinit_frame_cache</a> ();
<a name="l01374"></a>01374 
<a name="l01375"></a>01375   ops-&gt;<a class="code" href="structtarget__so__ops.html#aecd50fa410ab64d76e8b6584133bf6fc">special_symbol_handling</a> ();
<a name="l01376"></a>01376 }
<a name="l01377"></a>01377 
<a name="l01378"></a>01378 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01379"></a>01379 show_auto_solib_add (<span class="keyword">struct</span> ui_file *file, <span class="keywordtype">int</span> from_tty,
<a name="l01380"></a>01380                      <span class="keyword">struct</span> <a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c, <span class="keyword">const</span> <span class="keywordtype">char</span> *value)
<a name="l01381"></a>01381 {
<a name="l01382"></a>01382   <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (file, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Autoloading of shared library symbols is %s.\n&quot;</span>),
<a name="l01383"></a>01383                     value);
<a name="l01384"></a>01384 }
<a name="l01385"></a>01385 
<a name="l01386"></a>01386 
<a name="l01387"></a>01387 <span class="comment">/* Handler for library-specific lookup of global symbol NAME in OBJFILE.  Call</span>
<a name="l01388"></a>01388 <span class="comment">   the library-specific handler if it is installed for the current target.  */</span>
<a name="l01389"></a>01389 
<a name="l01390"></a>01390 <span class="keyword">struct </span><a class="code" href="structsymbol.html">symbol</a> *
<a name="l01391"></a><a class="code" href="solist_8h.html#a66c5d8267ebae941b21282421e6ecc35">01391</a> <a class="code" href="solib_8c.html#a66c5d8267ebae941b21282421e6ecc35">solib_global_lookup</a> (<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structobjfile.html">objfile</a> *<a class="code" href="structobjfile.html">objfile</a>,
<a name="l01392"></a>01392                      <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="aarch64-tdep_8c.html#acc128f98d9ceca227038c771308eff39">name</a>,
<a name="l01393"></a>01393                      <span class="keyword">const</span> <a class="code" href="symtab_8h.html#abbcd14557de81830c9e96ea4bdfc14aa">domain_enum</a> domain)
<a name="l01394"></a>01394 {
<a name="l01395"></a>01395   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtarget__so__ops.html">target_so_ops</a> *ops = solib_ops (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ());
<a name="l01396"></a>01396 
<a name="l01397"></a>01397   <span class="keywordflow">if</span> (ops-&gt;<a class="code" href="structtarget__so__ops.html#a72d8dfaa55af85f4eb3d5ebcefb26864">lookup_lib_global_symbol</a> != NULL)
<a name="l01398"></a>01398     <span class="keywordflow">return</span> ops-&gt;<a class="code" href="structtarget__so__ops.html#a72d8dfaa55af85f4eb3d5ebcefb26864">lookup_lib_global_symbol</a> (objfile, name, domain);
<a name="l01399"></a>01399   <span class="keywordflow">return</span> NULL;
<a name="l01400"></a>01400 }
<a name="l01401"></a>01401 
<a name="l01402"></a>01402 <span class="comment">/* Lookup the value for a specific symbol from dynamic symbol table.  Look</span>
<a name="l01403"></a>01403 <span class="comment">   up symbol from ABFD.  MATCH_SYM is a callback function to determine</span>
<a name="l01404"></a>01404 <span class="comment">   whether to pick up a symbol.  DATA is the input of this callback</span>
<a name="l01405"></a>01405 <span class="comment">   function.  Return NULL if symbol is not found.  */</span>
<a name="l01406"></a>01406 
<a name="l01407"></a>01407 <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a>
<a name="l01408"></a><a class="code" href="solib_8h.html#ab4b4aae11e66a2f340fadcb7fd7ee303">01408</a> <a class="code" href="solib_8c.html#ab4b4aae11e66a2f340fadcb7fd7ee303">gdb_bfd_lookup_symbol_from_symtab</a> (bfd *abfd,
<a name="l01409"></a>01409                                    <span class="keywordtype">int</span> (*match_sym) (asymbol *, <span class="keywordtype">void</span> *),
<a name="l01410"></a>01410                                    <span class="keywordtype">void</span> *data)
<a name="l01411"></a>01411 {
<a name="l01412"></a>01412   <span class="keywordtype">long</span> storage_needed = bfd_get_symtab_upper_bound (abfd);
<a name="l01413"></a>01413   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> symaddr = 0;
<a name="l01414"></a>01414 
<a name="l01415"></a>01415   <span class="keywordflow">if</span> (storage_needed &gt; 0)
<a name="l01416"></a>01416     {
<a name="l01417"></a>01417       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
<a name="l01418"></a>01418 
<a name="l01419"></a>01419       asymbol **symbol_table = (asymbol **) <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (storage_needed);
<a name="l01420"></a>01420       <span class="keyword">struct </span>cleanup *back_to = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, symbol_table);
<a name="l01421"></a>01421       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> number_of_symbols =
<a name="l01422"></a>01422         bfd_canonicalize_symtab (abfd, symbol_table);
<a name="l01423"></a>01423 
<a name="l01424"></a>01424       <span class="keywordflow">for</span> (i = 0; i &lt; number_of_symbols; i++)
<a name="l01425"></a>01425         {
<a name="l01426"></a>01426           asymbol *sym  = *symbol_table++;
<a name="l01427"></a>01427 
<a name="l01428"></a>01428           <span class="keywordflow">if</span> (match_sym (sym, data))
<a name="l01429"></a>01429             {
<a name="l01430"></a>01430               <span class="comment">/* BFD symbols are section relative.  */</span>
<a name="l01431"></a>01431               symaddr = sym-&gt;value + sym-&gt;section-&gt;vma;
<a name="l01432"></a>01432               <span class="keywordflow">break</span>;
<a name="l01433"></a>01433             }
<a name="l01434"></a>01434         }
<a name="l01435"></a>01435       <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (back_to);
<a name="l01436"></a>01436     }
<a name="l01437"></a>01437 
<a name="l01438"></a>01438   <span class="keywordflow">return</span> symaddr;
<a name="l01439"></a>01439 }
<a name="l01440"></a>01440 
<a name="l01441"></a>01441 <span class="comment">/* Lookup the value for a specific symbol from symbol table.  Look up symbol</span>
<a name="l01442"></a>01442 <span class="comment">   from ABFD.  MATCH_SYM is a callback function to determine whether to pick</span>
<a name="l01443"></a>01443 <span class="comment">   up a symbol.  DATA is the input of this callback function.  Return NULL</span>
<a name="l01444"></a>01444 <span class="comment">   if symbol is not found.  */</span>
<a name="l01445"></a>01445 
<a name="l01446"></a>01446 <span class="keyword">static</span> <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a>
<a name="l01447"></a>01447 bfd_lookup_symbol_from_dyn_symtab (bfd *abfd,
<a name="l01448"></a>01448                                    <span class="keywordtype">int</span> (*match_sym) (asymbol *, <span class="keywordtype">void</span> *),
<a name="l01449"></a>01449                                    <span class="keywordtype">void</span> *data)
<a name="l01450"></a>01450 {
<a name="l01451"></a>01451   <span class="keywordtype">long</span> storage_needed = bfd_get_dynamic_symtab_upper_bound (abfd);
<a name="l01452"></a>01452   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> symaddr = 0;
<a name="l01453"></a>01453 
<a name="l01454"></a>01454   <span class="keywordflow">if</span> (storage_needed &gt; 0)
<a name="l01455"></a>01455     {
<a name="l01456"></a>01456       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i;
<a name="l01457"></a>01457       asymbol **symbol_table = (asymbol **) <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (storage_needed);
<a name="l01458"></a>01458       <span class="keyword">struct </span>cleanup *back_to = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, symbol_table);
<a name="l01459"></a>01459       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> number_of_symbols =
<a name="l01460"></a>01460         bfd_canonicalize_dynamic_symtab (abfd, symbol_table);
<a name="l01461"></a>01461 
<a name="l01462"></a>01462       <span class="keywordflow">for</span> (i = 0; i &lt; number_of_symbols; i++)
<a name="l01463"></a>01463         {
<a name="l01464"></a>01464           asymbol *sym = *symbol_table++;
<a name="l01465"></a>01465 
<a name="l01466"></a>01466           <span class="keywordflow">if</span> (match_sym (sym, data))
<a name="l01467"></a>01467             {
<a name="l01468"></a>01468               <span class="comment">/* BFD symbols are section relative.  */</span>
<a name="l01469"></a>01469               symaddr = sym-&gt;value + sym-&gt;section-&gt;vma;
<a name="l01470"></a>01470               <span class="keywordflow">break</span>;
<a name="l01471"></a>01471             }
<a name="l01472"></a>01472         }
<a name="l01473"></a>01473       <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (back_to);
<a name="l01474"></a>01474     }
<a name="l01475"></a>01475   <span class="keywordflow">return</span> symaddr;
<a name="l01476"></a>01476 }
<a name="l01477"></a>01477 
<a name="l01478"></a>01478 <span class="comment">/* Lookup the value for a specific symbol from symbol table and dynamic</span>
<a name="l01479"></a>01479 <span class="comment">   symbol table.  Look up symbol from ABFD.  MATCH_SYM is a callback</span>
<a name="l01480"></a>01480 <span class="comment">   function to determine whether to pick up a symbol.  DATA is the</span>
<a name="l01481"></a>01481 <span class="comment">   input of this callback function.  Return NULL if symbol is not</span>
<a name="l01482"></a>01482 <span class="comment">   found.  */</span>
<a name="l01483"></a>01483 
<a name="l01484"></a>01484 <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a>
<a name="l01485"></a><a class="code" href="solib_8h.html#ad4eb37677daad8f13f6428c4b7cfa319">01485</a> <a class="code" href="solib_8c.html#ad4eb37677daad8f13f6428c4b7cfa319">gdb_bfd_lookup_symbol</a> (bfd *abfd,
<a name="l01486"></a>01486                        <span class="keywordtype">int</span> (*match_sym) (asymbol *, <span class="keywordtype">void</span> *),
<a name="l01487"></a>01487                        <span class="keywordtype">void</span> *data)
<a name="l01488"></a>01488 {
<a name="l01489"></a>01489   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> symaddr = <a class="code" href="solib_8c.html#ab4b4aae11e66a2f340fadcb7fd7ee303">gdb_bfd_lookup_symbol_from_symtab</a> (abfd, match_sym, data);
<a name="l01490"></a>01490 
<a name="l01491"></a>01491   <span class="comment">/* On FreeBSD, the dynamic linker is stripped by default.  So we&#39;ll</span>
<a name="l01492"></a>01492 <span class="comment">     have to check the dynamic string table too.  */</span>
<a name="l01493"></a>01493   <span class="keywordflow">if</span> (symaddr == 0)
<a name="l01494"></a>01494     symaddr = bfd_lookup_symbol_from_dyn_symtab (abfd, match_sym, data);
<a name="l01495"></a>01495 
<a name="l01496"></a>01496   <span class="keywordflow">return</span> symaddr;
<a name="l01497"></a>01497 }
<a name="l01498"></a>01498 
<a name="l01499"></a>01499 <span class="keyword">extern</span> <a class="code" href="defs_8h.html#a686ed07d4fdcdc366f2bc677216ca08d">initialize_file_ftype</a> <a class="code" href="solib_8c.html#a17c6d8767251ad3dff0ae35257fe9eb7">_initialize_solib</a>; <span class="comment">/* -Wmissing-prototypes */</span>
<a name="l01500"></a>01500 
<a name="l01501"></a>01501 <span class="keywordtype">void</span>
<a name="l01502"></a><a class="code" href="solib_8c.html#afa9778b1c0435bb058bc33797b676e36">01502</a> _initialize_solib (<span class="keywordtype">void</span>)
<a name="l01503"></a>01503 {
<a name="l01504"></a>01504   solib_data = <a class="code" href="gdbarch_8c.html#a7686a7d0e7858e65b89babc67ee775cb">gdbarch_data_register_pre_init</a> (solib_init);
<a name="l01505"></a>01505 
<a name="l01506"></a>01506   <a class="code" href="cli-decode_8c.html#a0df0ca36d9acd96440e24407cbef593c">add_com</a> (<span class="stringliteral">&quot;sharedlibrary&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49aea9c092d047271fd884ae32149463054">class_files</a>, sharedlibrary_command,
<a name="l01507"></a>01507            <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Load shared object library symbols for files matching REGEXP.&quot;</span>));
<a name="l01508"></a>01508   <a class="code" href="cli-decode_8c.html#a9f6cd2f7798c32a7a27cab617e71cf6a">add_info</a> (<span class="stringliteral">&quot;sharedlibrary&quot;</span>, info_sharedlibrary_command,
<a name="l01509"></a>01509             <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Status of loaded shared object libraries.&quot;</span>));
<a name="l01510"></a>01510   <a class="code" href="cli-decode_8c.html#a0df0ca36d9acd96440e24407cbef593c">add_com</a> (<span class="stringliteral">&quot;nosharedlibrary&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49aea9c092d047271fd884ae32149463054">class_files</a>, <a class="code" href="solib_8c.html#aa4c24d50468807449d5cca1566e2c7c0">no_shared_libraries</a>,
<a name="l01511"></a>01511            <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Unload all shared object library symbols.&quot;</span>));
<a name="l01512"></a>01512 
<a name="l01513"></a>01513   <a class="code" href="cli-decode_8c.html#ad86a0f135b6c546ae7ffbb41fd72e14f">add_setshow_boolean_cmd</a> (<span class="stringliteral">&quot;auto-solib-add&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49a92be6efbab6bd9647a6f7a2862712d9b">class_support</a>,
<a name="l01514"></a>01514                            &amp;<a class="code" href="symfile_8h.html#a039a97d840ec2d6a8471b6b665ea2a29">auto_solib_add</a>, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01515"></a>01515 <span class="stringliteral">Set autoloading of shared library symbols.&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01516"></a>01516 <span class="stringliteral">Show autoloading of shared library symbols.&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01517"></a>01517 <span class="stringliteral">If \&quot;on\&quot;, symbols from all shared object libraries will be loaded\n\</span>
<a name="l01518"></a>01518 <span class="stringliteral">automatically when the inferior begins execution, when the dynamic linker\n\</span>
<a name="l01519"></a>01519 <span class="stringliteral">informs gdb that a new library has been loaded, or when attaching to the\n\</span>
<a name="l01520"></a>01520 <span class="stringliteral">inferior.  Otherwise, symbols must be loaded manually, using \</span>
<a name="l01521"></a>01521 <span class="stringliteral">`sharedlibrary&#39;.&quot;</span>),
<a name="l01522"></a>01522                            NULL,
<a name="l01523"></a>01523                            show_auto_solib_add,
<a name="l01524"></a>01524                            &amp;<a class="code" href="cli-cmds_8c.html#a723e0174d833cba0aa82fb936a56c8fa">setlist</a>, &amp;<a class="code" href="cli-cmds_8c.html#a003932aa76fd3f41763ecc6bee5e2ca8">showlist</a>);
<a name="l01525"></a>01525 
<a name="l01526"></a>01526   <a class="code" href="cli-decode_8c.html#a3f510a36ebb350d94e3f1d39f1a32da5">add_setshow_filename_cmd</a> (<span class="stringliteral">&quot;sysroot&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49a92be6efbab6bd9647a6f7a2862712d9b">class_support</a>,
<a name="l01527"></a>01527                             &amp;<a class="code" href="defs_8h.html#ac0f15758d6e7079c77d69b95ea5c6bf4">gdb_sysroot</a>, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01528"></a>01528 <span class="stringliteral">Set an alternate system root.&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01529"></a>01529 <span class="stringliteral">Show the current system root.&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01530"></a>01530 <span class="stringliteral">The system root is used to load absolute shared library symbol files.\n\</span>
<a name="l01531"></a>01531 <span class="stringliteral">For other (relative) files, you can add directories using\n\</span>
<a name="l01532"></a>01532 <span class="stringliteral">`set solib-search-path&#39;.&quot;</span>),
<a name="l01533"></a>01533                             reload_shared_libraries,
<a name="l01534"></a>01534                             NULL,
<a name="l01535"></a>01535                             &amp;<a class="code" href="cli-cmds_8c.html#a723e0174d833cba0aa82fb936a56c8fa">setlist</a>, &amp;<a class="code" href="cli-cmds_8c.html#a003932aa76fd3f41763ecc6bee5e2ca8">showlist</a>);
<a name="l01536"></a>01536 
<a name="l01537"></a>01537   <a class="code" href="cli-decode_8c.html#a81a250b03b0a6626b31d35be82961c38">add_alias_cmd</a> (<span class="stringliteral">&quot;solib-absolute-prefix&quot;</span>, <span class="stringliteral">&quot;sysroot&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49a92be6efbab6bd9647a6f7a2862712d9b">class_support</a>, 0,
<a name="l01538"></a>01538                  &amp;<a class="code" href="cli-cmds_8c.html#a723e0174d833cba0aa82fb936a56c8fa">setlist</a>);
<a name="l01539"></a>01539   <a class="code" href="cli-decode_8c.html#a81a250b03b0a6626b31d35be82961c38">add_alias_cmd</a> (<span class="stringliteral">&quot;solib-absolute-prefix&quot;</span>, <span class="stringliteral">&quot;sysroot&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49a92be6efbab6bd9647a6f7a2862712d9b">class_support</a>, 0,
<a name="l01540"></a>01540                  &amp;<a class="code" href="cli-cmds_8c.html#a003932aa76fd3f41763ecc6bee5e2ca8">showlist</a>);
<a name="l01541"></a>01541 
<a name="l01542"></a>01542   <a class="code" href="cli-decode_8c.html#a47cdf41908a640a5cc5cbd4a00491595">add_setshow_optional_filename_cmd</a> (<span class="stringliteral">&quot;solib-search-path&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49a92be6efbab6bd9647a6f7a2862712d9b">class_support</a>,
<a name="l01543"></a>01543                                      &amp;solib_search_path, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01544"></a>01544 <span class="stringliteral">Set the search path for loading non-absolute shared library symbol files.&quot;</span>),
<a name="l01545"></a>01545                                      <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01546"></a>01546 <span class="stringliteral">Show the search path for loading non-absolute shared library symbol files.&quot;</span>),
<a name="l01547"></a>01547                                      <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l01548"></a>01548 <span class="stringliteral">This takes precedence over the environment variables \</span>
<a name="l01549"></a>01549 <span class="stringliteral">PATH and LD_LIBRARY_PATH.&quot;</span>),
<a name="l01550"></a>01550                                      reload_shared_libraries,
<a name="l01551"></a>01551                                      show_solib_search_path,
<a name="l01552"></a>01552                                      &amp;<a class="code" href="cli-cmds_8c.html#a723e0174d833cba0aa82fb936a56c8fa">setlist</a>, &amp;<a class="code" href="cli-cmds_8c.html#a003932aa76fd3f41763ecc6bee5e2ca8">showlist</a>);
<a name="l01553"></a>01553 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Fri Oct 11 2013 14:12:25 for GDB (API) by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
