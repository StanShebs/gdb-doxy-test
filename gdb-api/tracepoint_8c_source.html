<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>GDB (API): /home/stan/gdb/src/gdb/tracepoint.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">GDB (API)
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">/home/stan/gdb/src/gdb/tracepoint.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="tracepoint_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* Tracing functionality for remote targets in custom GDB protocol</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">   Copyright (C) 1997-2013 Free Software Foundation, Inc.</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">   This file is part of GDB.</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">   This program is free software; you can redistribute it and/or modify</span>
<a name="l00008"></a>00008 <span class="comment">   it under the terms of the GNU General Public License as published by</span>
<a name="l00009"></a>00009 <span class="comment">   the Free Software Foundation; either version 3 of the License, or</span>
<a name="l00010"></a>00010 <span class="comment">   (at your option) any later version.</span>
<a name="l00011"></a>00011 <span class="comment"></span>
<a name="l00012"></a>00012 <span class="comment">   This program is distributed in the hope that it will be useful,</span>
<a name="l00013"></a>00013 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00014"></a>00014 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00015"></a>00015 <span class="comment">   GNU General Public License for more details.</span>
<a name="l00016"></a>00016 <span class="comment"></span>
<a name="l00017"></a>00017 <span class="comment">   You should have received a copy of the GNU General Public License</span>
<a name="l00018"></a>00018 <span class="comment">   along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.  */</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="defs_8h.html">defs.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="arch-utils_8h.html">arch-utils.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="symtab_8h.html">symtab.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="frame_8h.html">frame.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="gdbtypes_8h.html">gdbtypes.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="expression_8h.html">expression.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="gdbcmd_8h.html">gdbcmd.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="value_8h.html">value.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="target_8h.html">target.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="language_8h.html">language.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="gdb__string_8h.html">gdb_string.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="inferior_8h.html">inferior.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="breakpoint_8h.html">breakpoint.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="tracepoint_8h.html">tracepoint.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="linespec_8h.html">linespec.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="regcache_8h.html">regcache.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="completer_8h.html">completer.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="block_8h.html">block.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="dictionary_8h.html">dictionary.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="observer_8h.html">observer.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="user-regs_8h.html">user-regs.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="valprint_8h.html">valprint.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="gdbcore_8h.html">gdbcore.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="objfiles_8h.html">objfiles.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;filenames.h&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="gdbthread_8h.html">gdbthread.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="stack_8h.html">stack.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="gdbcore_8h.html">gdbcore.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="remote_8h.html">remote.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="source_8h.html">source.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="ax_8h.html">ax.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="ax-gdb_8h.html">ax-gdb.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="memrange_8h.html">memrange.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="exceptions_8h.html">exceptions.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="cli-utils_8h.html">cli/cli-utils.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="probe_8h.html">probe.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="ctf_8h.html">ctf.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="completer_8h.html">completer.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="filestuff_8h.html">filestuff.h</a>&quot;</span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="comment">/* readline include files */</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;readline/readline.h&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;readline/history.h&quot;</span>
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="comment">/* readline defines this.  */</span>
<a name="l00065"></a>00065 <span class="preprocessor">#undef savestring</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="preprocessor">#ifndef O_LARGEFILE</span>
<a name="l00070"></a><a class="code" href="tracepoint_8c.html#a1126309aa58e7c99553c7f6be1bc7348">00070</a> <span class="preprocessor"></span><span class="preprocessor">#define O_LARGEFILE 0</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span>
<a name="l00073"></a>00073 <span class="comment">/* Maximum length of an agent aexpression.</span>
<a name="l00074"></a>00074 <span class="comment">   This accounts for the fact that packets are limited to 400 bytes</span>
<a name="l00075"></a>00075 <span class="comment">   (which includes everything -- including the checksum), and assumes</span>
<a name="l00076"></a>00076 <span class="comment">   the worst case of maximum length for each of the pieces of a</span>
<a name="l00077"></a>00077 <span class="comment">   continuation packet.</span>
<a name="l00078"></a>00078 <span class="comment"></span>
<a name="l00079"></a>00079 <span class="comment">   NOTE: expressions get mem2hex&#39;ed otherwise this would be twice as</span>
<a name="l00080"></a>00080 <span class="comment">   large.  (400 - 31)/2 == 184 */</span>
<a name="l00081"></a><a class="code" href="tracepoint_8c.html#acf5177f8e0c8de5667b3aaa539373e4c">00081</a> <span class="preprocessor">#define MAX_AGENT_EXPR_LEN      184</span>
<a name="l00082"></a>00082 <span class="preprocessor"></span>
<a name="l00083"></a>00083 <span class="comment">/* A hook used to notify the UI of tracepoint operations.  */</span>
<a name="l00084"></a>00084 
<a name="l00085"></a><a class="code" href="tracepoint_8h.html#a157928d41caa1a2d0b32139ab9e0b9f9">00085</a> void (*<a class="code" href="tracepoint_8c.html#a157928d41caa1a2d0b32139ab9e0b9f9">deprecated_trace_find_hook</a>) (<span class="keywordtype">char</span> *arg, <span class="keywordtype">int</span> from_tty);
<a name="l00086"></a><a class="code" href="tracepoint_8h.html#a86cfdf16c974e849a62da1a9bbbe88d1">00086</a> void (*<a class="code" href="tracepoint_8c.html#a86cfdf16c974e849a62da1a9bbbe88d1">deprecated_trace_start_stop_hook</a>) (<span class="keywordtype">int</span> start, <span class="keywordtype">int</span> from_tty);
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 <span class="comment">/* </span>
<a name="l00089"></a>00089 <span class="comment">   Tracepoint.c:</span>
<a name="l00090"></a>00090 <span class="comment"></span>
<a name="l00091"></a>00091 <span class="comment">   This module defines the following debugger commands:</span>
<a name="l00092"></a>00092 <span class="comment">   trace            : set a tracepoint on a function, line, or address.</span>
<a name="l00093"></a>00093 <span class="comment">   info trace       : list all debugger-defined tracepoints.</span>
<a name="l00094"></a>00094 <span class="comment">   delete trace     : delete one or more tracepoints.</span>
<a name="l00095"></a>00095 <span class="comment">   enable trace     : enable one or more tracepoints.</span>
<a name="l00096"></a>00096 <span class="comment">   disable trace    : disable one or more tracepoints.</span>
<a name="l00097"></a>00097 <span class="comment">   actions          : specify actions to be taken at a tracepoint.</span>
<a name="l00098"></a>00098 <span class="comment">   passcount        : specify a pass count for a tracepoint.</span>
<a name="l00099"></a>00099 <span class="comment">   tstart           : start a trace experiment.</span>
<a name="l00100"></a>00100 <span class="comment">   tstop            : stop a trace experiment.</span>
<a name="l00101"></a>00101 <span class="comment">   tstatus          : query the status of a trace experiment.</span>
<a name="l00102"></a>00102 <span class="comment">   tfind            : find a trace frame in the trace buffer.</span>
<a name="l00103"></a>00103 <span class="comment">   tdump            : print everything collected at the current tracepoint.</span>
<a name="l00104"></a>00104 <span class="comment">   save-tracepoints : write tracepoint setup into a file.</span>
<a name="l00105"></a>00105 <span class="comment"></span>
<a name="l00106"></a>00106 <span class="comment">   This module defines the following user-visible debugger variables:</span>
<a name="l00107"></a>00107 <span class="comment">   $trace_frame : sequence number of trace frame currently being debugged.</span>
<a name="l00108"></a>00108 <span class="comment">   $trace_line  : source line of trace frame currently being debugged.</span>
<a name="l00109"></a>00109 <span class="comment">   $trace_file  : source file of trace frame currently being debugged.</span>
<a name="l00110"></a>00110 <span class="comment">   $tracepoint  : tracepoint number of trace frame currently being debugged.</span>
<a name="l00111"></a>00111 <span class="comment"> */</span>
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 <span class="comment">/* ======= Important global variables: ======= */</span>
<a name="l00115"></a>00115 
<a name="l00116"></a>00116 <span class="comment">/* The list of all trace state variables.  We don&#39;t retain pointers to</span>
<a name="l00117"></a>00117 <span class="comment">   any of these for any reason - API is by name or number only - so it</span>
<a name="l00118"></a>00118 <span class="comment">   works to have a vector of objects.  */</span>
<a name="l00119"></a>00119 
<a name="l00120"></a><a class="code" href="tracepoint_8c.html#a59dd37959435389422d3e443953e8090">00120</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structtrace__state__variable.html">trace_state_variable</a> <a class="code" href="structtrace__state__variable.html">tsv_s</a>;
<a name="l00121"></a>00121 <a class="code" href="vec_8h.html#abc2d38563a8b5bed340654cf06060f11">DEF_VEC_O</a>(<a class="code" href="structtrace__state__variable.html">tsv_s</a>);
<a name="l00122"></a>00122 
<a name="l00123"></a>00123 <span class="keyword">static</span> <a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a>(<a class="code" href="structtrace__state__variable.html">tsv_s</a>) *tvariables;
<a name="l00124"></a>00124 
<a name="l00125"></a>00125 <span class="comment">/* The next integer to assign to a variable.  */</span>
<a name="l00126"></a>00126 
<a name="l00127"></a>00127 <span class="keyword">static</span> <span class="keywordtype">int</span> next_tsv_number = 1;
<a name="l00128"></a>00128 
<a name="l00129"></a>00129 <span class="comment">/* Number of last traceframe collected.  */</span>
<a name="l00130"></a>00130 <span class="keyword">static</span> <span class="keywordtype">int</span> traceframe_number;
<a name="l00131"></a>00131 
<a name="l00132"></a>00132 <span class="comment">/* Tracepoint for last traceframe collected.  */</span>
<a name="l00133"></a>00133 <span class="keyword">static</span> <span class="keywordtype">int</span> tracepoint_number;
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 <span class="comment">/* Symbol for function for last traceframe collected.  */</span>
<a name="l00136"></a>00136 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structsymbol.html">symbol</a> *traceframe_fun;
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 <span class="comment">/* Symtab and line for last traceframe collected.  */</span>
<a name="l00139"></a>00139 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structsymtab__and__line.html">symtab_and_line</a> traceframe_sal;
<a name="l00140"></a>00140 
<a name="l00141"></a>00141 <span class="comment">/* The traceframe info of the current traceframe.  NULL if we haven&#39;t</span>
<a name="l00142"></a>00142 <span class="comment">   yet attempted to fetch it, or if the target does not support</span>
<a name="l00143"></a>00143 <span class="comment">   fetching this object, or if we&#39;re not inspecting a traceframe</span>
<a name="l00144"></a>00144 <span class="comment">   presently.  */</span>
<a name="l00145"></a>00145 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structtraceframe__info.html">traceframe_info</a> *<a class="code" href="structtraceframe__info.html">traceframe_info</a>;
<a name="l00146"></a>00146 
<a name="l00147"></a>00147 <span class="comment">/* Tracing command lists.  */</span>
<a name="l00148"></a>00148 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structcmd__list__element.html">cmd_list_element</a> *tfindlist;
<a name="l00149"></a>00149 
<a name="l00150"></a>00150 <span class="comment">/* List of expressions to collect by default at each tracepoint hit.  */</span>
<a name="l00151"></a>00151 <span class="keywordtype">char</span> *<a class="code" href="tracepoint_8h.html#a60e1b54e67c4c56da92593798803789e">default_collect</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00152"></a>00152 
<a name="l00153"></a>00153 <span class="keyword">static</span> <span class="keywordtype">int</span> disconnected_tracing;
<a name="l00154"></a>00154 
<a name="l00155"></a>00155 <span class="comment">/* This variable controls whether we ask the target for a linear or</span>
<a name="l00156"></a>00156 <span class="comment">   circular trace buffer.  */</span>
<a name="l00157"></a>00157 
<a name="l00158"></a>00158 <span class="keyword">static</span> <span class="keywordtype">int</span> circular_trace_buffer;
<a name="l00159"></a>00159 
<a name="l00160"></a>00160 <span class="comment">/* This variable is the requested trace buffer size, or -1 to indicate</span>
<a name="l00161"></a>00161 <span class="comment">   that we don&#39;t care and leave it up to the target to set a size.  */</span>
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 <span class="keyword">static</span> <span class="keywordtype">int</span> trace_buffer_size = -1;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 <span class="comment">/* Textual notes applying to the current and/or future trace runs.  */</span>
<a name="l00166"></a>00166 
<a name="l00167"></a>00167 <span class="keywordtype">char</span> *trace_user = NULL;
<a name="l00168"></a>00168 
<a name="l00169"></a>00169 <span class="comment">/* Textual notes applying to the current and/or future trace runs.  */</span>
<a name="l00170"></a>00170 
<a name="l00171"></a>00171 <span class="keywordtype">char</span> *trace_notes = NULL;
<a name="l00172"></a>00172 
<a name="l00173"></a>00173 <span class="comment">/* Textual notes applying to the stopping of a trace.  */</span>
<a name="l00174"></a>00174 
<a name="l00175"></a>00175 <span class="keywordtype">char</span> *trace_stop_notes = NULL;
<a name="l00176"></a>00176 
<a name="l00177"></a>00177 <span class="comment">/* ======= Important command functions: ======= */</span>
<a name="l00178"></a>00178 <span class="keyword">static</span> <span class="keywordtype">void</span> trace_actions_command (<span class="keywordtype">char</span> *, <span class="keywordtype">int</span>);
<a name="l00179"></a>00179 <span class="keyword">static</span> <span class="keywordtype">void</span> trace_start_command (<span class="keywordtype">char</span> *, <span class="keywordtype">int</span>);
<a name="l00180"></a>00180 <span class="keyword">static</span> <span class="keywordtype">void</span> trace_stop_command (<span class="keywordtype">char</span> *, <span class="keywordtype">int</span>);
<a name="l00181"></a>00181 <span class="keyword">static</span> <span class="keywordtype">void</span> trace_status_command (<span class="keywordtype">char</span> *, <span class="keywordtype">int</span>);
<a name="l00182"></a>00182 <span class="keyword">static</span> <span class="keywordtype">void</span> trace_find_command (<span class="keywordtype">char</span> *, <span class="keywordtype">int</span>);
<a name="l00183"></a>00183 <span class="keyword">static</span> <span class="keywordtype">void</span> trace_find_pc_command (<span class="keywordtype">char</span> *, <span class="keywordtype">int</span>);
<a name="l00184"></a>00184 <span class="keyword">static</span> <span class="keywordtype">void</span> trace_find_tracepoint_command (<span class="keywordtype">char</span> *, <span class="keywordtype">int</span>);
<a name="l00185"></a>00185 <span class="keyword">static</span> <span class="keywordtype">void</span> trace_find_line_command (<span class="keywordtype">char</span> *, <span class="keywordtype">int</span>);
<a name="l00186"></a>00186 <span class="keyword">static</span> <span class="keywordtype">void</span> trace_find_range_command (<span class="keywordtype">char</span> *, <span class="keywordtype">int</span>);
<a name="l00187"></a>00187 <span class="keyword">static</span> <span class="keywordtype">void</span> trace_find_outside_command (<span class="keywordtype">char</span> *, <span class="keywordtype">int</span>);
<a name="l00188"></a>00188 <span class="keyword">static</span> <span class="keywordtype">void</span> trace_dump_command (<span class="keywordtype">char</span> *, <span class="keywordtype">int</span>);
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 <span class="comment">/* support routines */</span>
<a name="l00191"></a>00191 
<a name="l00192"></a>00192 <span class="keyword">struct </span><a class="code" href="structcollection__list.html">collection_list</a>;
<a name="l00193"></a>00193 <span class="keyword">static</span> <span class="keywordtype">void</span> add_aexpr (<span class="keyword">struct</span> <a class="code" href="structcollection__list.html">collection_list</a> *, <span class="keyword">struct</span> <a class="code" href="structagent__expr.html">agent_expr</a> *);
<a name="l00194"></a>00194 <span class="keyword">static</span> <span class="keywordtype">char</span> *mem2hex (<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *, <span class="keywordtype">char</span> *, <span class="keywordtype">int</span>);
<a name="l00195"></a>00195 <span class="keyword">static</span> <span class="keywordtype">void</span> add_register (<span class="keyword">struct</span> <a class="code" href="structcollection__list.html">collection_list</a> *collection,
<a name="l00196"></a>00196                           <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> regno);
<a name="l00197"></a>00197 
<a name="l00198"></a>00198 <span class="keyword">static</span> <span class="keywordtype">void</span> free_uploaded_tps (<span class="keyword">struct</span> <a class="code" href="structuploaded__tp.html">uploaded_tp</a> **utpp);
<a name="l00199"></a>00199 <span class="keyword">static</span> <span class="keywordtype">void</span> free_uploaded_tsvs (<span class="keyword">struct</span> <a class="code" href="structuploaded__tsv.html">uploaded_tsv</a> **utsvp);
<a name="l00200"></a>00200 
<a name="l00201"></a>00201 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structcommand__line.html">command_line</a> *
<a name="l00202"></a>00202   all_tracepoint_actions_and_cleanup (<span class="keyword">struct</span> <a class="code" href="structbreakpoint.html">breakpoint</a> *t);
<a name="l00203"></a>00203 
<a name="l00204"></a>00204 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="init_8c.html#acf96db222e05df15fa3504e873004299">_initialize_tracepoint</a> (<span class="keywordtype">void</span>);
<a name="l00205"></a>00205 
<a name="l00206"></a>00206 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structtrace__status.html">trace_status</a> <a class="code" href="structtrace__status.html">trace_status</a>;
<a name="l00207"></a>00207 
<a name="l00208"></a>00208 <span class="keywordtype">char</span> *stop_reason_names[] = {
<a name="l00209"></a>00209   <span class="stringliteral">&quot;tunknown&quot;</span>,
<a name="l00210"></a>00210   <span class="stringliteral">&quot;tnotrun&quot;</span>,
<a name="l00211"></a>00211   <span class="stringliteral">&quot;tstop&quot;</span>,
<a name="l00212"></a>00212   <span class="stringliteral">&quot;tfull&quot;</span>,
<a name="l00213"></a>00213   <span class="stringliteral">&quot;tdisconnected&quot;</span>,
<a name="l00214"></a>00214   <span class="stringliteral">&quot;tpasscount&quot;</span>,
<a name="l00215"></a>00215   <span class="stringliteral">&quot;terror&quot;</span>
<a name="l00216"></a>00216 };
<a name="l00217"></a>00217 
<a name="l00218"></a>00218 <span class="keyword">struct </span><a class="code" href="structtrace__status.html">trace_status</a> *
<a name="l00219"></a><a class="code" href="tracepoint_8h.html#af4041987a9ba21b88378bb6a3873baca">00219</a> <a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> (<span class="keywordtype">void</span>)
<a name="l00220"></a>00220 {
<a name="l00221"></a>00221   <span class="keywordflow">return</span> &amp;<a class="code" href="structtrace__status.html">trace_status</a>;
<a name="l00222"></a>00222 }
<a name="l00223"></a>00223 
<a name="l00224"></a>00224 <span class="comment">/* Destroy INFO.  */</span>
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00227"></a>00227 free_traceframe_info (<span class="keyword">struct</span> traceframe_info *info)
<a name="l00228"></a>00228 {
<a name="l00229"></a>00229   <span class="keywordflow">if</span> (info != NULL)
<a name="l00230"></a>00230     {
<a name="l00231"></a>00231       <a class="code" href="vec_8h.html#af5724b2bbce65103300279f9abe7f577">VEC_free</a> (<a class="code" href="structmem__range.html">mem_range_s</a>, info-&gt;memory);
<a name="l00232"></a>00232       <a class="code" href="vec_8h.html#af5724b2bbce65103300279f9abe7f577">VEC_free</a> (<span class="keywordtype">int</span>, info-&gt;tvars);
<a name="l00233"></a>00233 
<a name="l00234"></a>00234       <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (info);
<a name="l00235"></a>00235     }
<a name="l00236"></a>00236 }
<a name="l00237"></a>00237 
<a name="l00238"></a>00238 <span class="comment">/* Free and clear the traceframe info cache of the current</span>
<a name="l00239"></a>00239 <span class="comment">   traceframe.  */</span>
<a name="l00240"></a>00240 
<a name="l00241"></a>00241 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00242"></a>00242 clear_traceframe_info (<span class="keywordtype">void</span>)
<a name="l00243"></a>00243 {
<a name="l00244"></a>00244   free_traceframe_info (traceframe_info);
<a name="l00245"></a>00245   traceframe_info = NULL;
<a name="l00246"></a>00246 }
<a name="l00247"></a>00247 
<a name="l00248"></a>00248 <span class="comment">/* Set traceframe number to NUM.  */</span>
<a name="l00249"></a>00249 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00250"></a>00250 set_traceframe_num (<span class="keywordtype">int</span> num)
<a name="l00251"></a>00251 {
<a name="l00252"></a>00252   traceframe_number = num;
<a name="l00253"></a>00253   <a class="code" href="value_8c.html#ac0d9f889423ba9ff189ea48da13204a3">set_internalvar_integer</a> (<a class="code" href="value_8c.html#ac96b41b37d2b8eeb44137ec148ca5c7c">lookup_internalvar</a> (<span class="stringliteral">&quot;trace_frame&quot;</span>), num);
<a name="l00254"></a>00254 }
<a name="l00255"></a>00255 
<a name="l00256"></a>00256 <span class="comment">/* Set tracepoint number to NUM.  */</span>
<a name="l00257"></a>00257 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00258"></a>00258 set_tracepoint_num (<span class="keywordtype">int</span> num)
<a name="l00259"></a>00259 {
<a name="l00260"></a>00260   tracepoint_number = num;
<a name="l00261"></a>00261   <a class="code" href="value_8c.html#ac0d9f889423ba9ff189ea48da13204a3">set_internalvar_integer</a> (<a class="code" href="value_8c.html#ac96b41b37d2b8eeb44137ec148ca5c7c">lookup_internalvar</a> (<span class="stringliteral">&quot;tracepoint&quot;</span>), num);
<a name="l00262"></a>00262 }
<a name="l00263"></a>00263 
<a name="l00264"></a>00264 <span class="comment">/* Set externally visible debug variables for querying/printing</span>
<a name="l00265"></a>00265 <span class="comment">   the traceframe context (line, function, file).  */</span>
<a name="l00266"></a>00266 
<a name="l00267"></a>00267 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00268"></a>00268 set_traceframe_context (<span class="keyword">struct</span> frame_info *trace_frame)
<a name="l00269"></a>00269 {
<a name="l00270"></a>00270   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> trace_pc;
<a name="l00271"></a>00271 
<a name="l00272"></a>00272   <span class="comment">/* Save as globals for internal use.  */</span>
<a name="l00273"></a>00273   <span class="keywordflow">if</span> (trace_frame != NULL
<a name="l00274"></a>00274       &amp;&amp; <a class="code" href="frame_8c.html#af87888489ef191ac98c292350017e84e">get_frame_pc_if_available</a> (trace_frame, &amp;trace_pc))
<a name="l00275"></a>00275     {
<a name="l00276"></a>00276       traceframe_sal = <a class="code" href="symtab_8c.html#ad9bbd85700e3d7fa50e7ba0e32f37846">find_pc_line</a> (trace_pc, 0);
<a name="l00277"></a>00277       traceframe_fun = <a class="code" href="blockframe_8c.html#aecbc16d6802ea96b08b298a445481306">find_pc_function</a> (trace_pc);
<a name="l00278"></a>00278 
<a name="l00279"></a>00279       <span class="comment">/* Save linenumber as &quot;$trace_line&quot;, a debugger variable visible to</span>
<a name="l00280"></a>00280 <span class="comment">         users.  */</span>
<a name="l00281"></a>00281       <a class="code" href="value_8c.html#ac0d9f889423ba9ff189ea48da13204a3">set_internalvar_integer</a> (<a class="code" href="value_8c.html#ac96b41b37d2b8eeb44137ec148ca5c7c">lookup_internalvar</a> (<span class="stringliteral">&quot;trace_line&quot;</span>),
<a name="l00282"></a>00282                                traceframe_sal.line);
<a name="l00283"></a>00283     }
<a name="l00284"></a>00284   <span class="keywordflow">else</span>
<a name="l00285"></a>00285     {
<a name="l00286"></a>00286       <a class="code" href="symtab_8c.html#aca3a01a4f0e1a09f99e8308faecc9028">init_sal</a> (&amp;traceframe_sal);
<a name="l00287"></a>00287       traceframe_fun = NULL;
<a name="l00288"></a>00288       <a class="code" href="value_8c.html#ac0d9f889423ba9ff189ea48da13204a3">set_internalvar_integer</a> (<a class="code" href="value_8c.html#ac96b41b37d2b8eeb44137ec148ca5c7c">lookup_internalvar</a> (<span class="stringliteral">&quot;trace_line&quot;</span>), -1);
<a name="l00289"></a>00289     }
<a name="l00290"></a>00290 
<a name="l00291"></a>00291   <span class="comment">/* Save func name as &quot;$trace_func&quot;, a debugger variable visible to</span>
<a name="l00292"></a>00292 <span class="comment">     users.  */</span>
<a name="l00293"></a>00293   <span class="keywordflow">if</span> (traceframe_fun == NULL
<a name="l00294"></a>00294       || <a class="code" href="symtab_8h.html#a956b56288511a18b855d8a263d60e87f">SYMBOL_LINKAGE_NAME</a> (traceframe_fun) == NULL)
<a name="l00295"></a>00295     <a class="code" href="value_8c.html#a2276a7b2cff4903ca0e4818627a39ad0">clear_internalvar</a> (<a class="code" href="value_8c.html#ac96b41b37d2b8eeb44137ec148ca5c7c">lookup_internalvar</a> (<span class="stringliteral">&quot;trace_func&quot;</span>));
<a name="l00296"></a>00296   <span class="keywordflow">else</span>
<a name="l00297"></a>00297     <a class="code" href="value_8c.html#a084c5484c0b407d57d1bb5bb118428ae">set_internalvar_string</a> (<a class="code" href="value_8c.html#ac96b41b37d2b8eeb44137ec148ca5c7c">lookup_internalvar</a> (<span class="stringliteral">&quot;trace_func&quot;</span>),
<a name="l00298"></a>00298                             <a class="code" href="symtab_8h.html#a956b56288511a18b855d8a263d60e87f">SYMBOL_LINKAGE_NAME</a> (traceframe_fun));
<a name="l00299"></a>00299 
<a name="l00300"></a>00300   <span class="comment">/* Save file name as &quot;$trace_file&quot;, a debugger variable visible to</span>
<a name="l00301"></a>00301 <span class="comment">     users.  */</span>
<a name="l00302"></a>00302   <span class="keywordflow">if</span> (traceframe_sal.symtab == NULL)
<a name="l00303"></a>00303     <a class="code" href="value_8c.html#a2276a7b2cff4903ca0e4818627a39ad0">clear_internalvar</a> (<a class="code" href="value_8c.html#ac96b41b37d2b8eeb44137ec148ca5c7c">lookup_internalvar</a> (<span class="stringliteral">&quot;trace_file&quot;</span>));
<a name="l00304"></a>00304   <span class="keywordflow">else</span>
<a name="l00305"></a>00305     <a class="code" href="value_8c.html#a084c5484c0b407d57d1bb5bb118428ae">set_internalvar_string</a> (<a class="code" href="value_8c.html#ac96b41b37d2b8eeb44137ec148ca5c7c">lookup_internalvar</a> (<span class="stringliteral">&quot;trace_file&quot;</span>),
<a name="l00306"></a>00306                         <a class="code" href="source_8c.html#ae251616cab166301d5fed95cbdd31232">symtab_to_filename_for_display</a> (traceframe_sal.symtab));
<a name="l00307"></a>00307 }
<a name="l00308"></a>00308 
<a name="l00309"></a>00309 <span class="comment">/* Create a new trace state variable with the given name.  */</span>
<a name="l00310"></a>00310 
<a name="l00311"></a>00311 <span class="keyword">struct </span><a class="code" href="structtrace__state__variable.html">trace_state_variable</a> *
<a name="l00312"></a><a class="code" href="tracepoint_8h.html#aa40dd0d7217222beaf2aefa3065c356f">00312</a> <a class="code" href="tracepoint_8c.html#aa40dd0d7217222beaf2aefa3065c356f">create_trace_state_variable</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="aarch64-tdep_8c.html#acc128f98d9ceca227038c771308eff39">name</a>)
<a name="l00313"></a>00313 {
<a name="l00314"></a>00314   <span class="keyword">struct </span><a class="code" href="structtrace__state__variable.html">trace_state_variable</a> tsv;
<a name="l00315"></a>00315 
<a name="l00316"></a>00316   <a class="code" href="gdb__string_8h.html#adb03df3679ce1445e801310614624ccb">memset</a> (&amp;tsv, 0, <span class="keyword">sizeof</span> (tsv));
<a name="l00317"></a>00317   tsv.<a class="code" href="structtrace__state__variable.html#ac86438487a7fe60738afe3ba2699b09f">name</a> = xstrdup (name);
<a name="l00318"></a>00318   tsv.<a class="code" href="structtrace__state__variable.html#a6bb7d975f2080b6b52d3d3c49c7fe767">number</a> = next_tsv_number++;
<a name="l00319"></a>00319   <span class="keywordflow">return</span> <a class="code" href="vec_8h.html#a8d090c0524726d00931070e0c438ba3f">VEC_safe_push</a> (<a class="code" href="structtrace__state__variable.html">tsv_s</a>, tvariables, &amp;tsv);
<a name="l00320"></a>00320 }
<a name="l00321"></a>00321 
<a name="l00322"></a>00322 <span class="comment">/* Look for a trace state variable of the given name.  */</span>
<a name="l00323"></a>00323 
<a name="l00324"></a>00324 <span class="keyword">struct </span><a class="code" href="structtrace__state__variable.html">trace_state_variable</a> *
<a name="l00325"></a><a class="code" href="tracepoint_8h.html#aa1473f9341eceb0b7988d4c459b99da1">00325</a> <a class="code" href="tracepoint_8c.html#aa1473f9341eceb0b7988d4c459b99da1">find_trace_state_variable</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="aarch64-tdep_8c.html#acc128f98d9ceca227038c771308eff39">name</a>)
<a name="l00326"></a>00326 {
<a name="l00327"></a>00327   <span class="keyword">struct </span><a class="code" href="structtrace__state__variable.html">trace_state_variable</a> *tsv;
<a name="l00328"></a>00328   <span class="keywordtype">int</span> ix;
<a name="l00329"></a>00329 
<a name="l00330"></a>00330   <span class="keywordflow">for</span> (ix = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="structtrace__state__variable.html">tsv_s</a>, tvariables, ix, tsv); ++ix)
<a name="l00331"></a>00331     <span class="keywordflow">if</span> (strcmp (name, tsv-&gt;<a class="code" href="structtrace__state__variable.html#ac86438487a7fe60738afe3ba2699b09f">name</a>) == 0)
<a name="l00332"></a>00332       <span class="keywordflow">return</span> tsv;
<a name="l00333"></a>00333 
<a name="l00334"></a>00334   <span class="keywordflow">return</span> NULL;
<a name="l00335"></a>00335 }
<a name="l00336"></a>00336 
<a name="l00337"></a>00337 <span class="comment">/* Look for a trace state variable of the given number.  Return NULL if</span>
<a name="l00338"></a>00338 <span class="comment">   not found.  */</span>
<a name="l00339"></a>00339 
<a name="l00340"></a>00340 <span class="keyword">struct </span><a class="code" href="structtrace__state__variable.html">trace_state_variable</a> *
<a name="l00341"></a><a class="code" href="tracepoint_8h.html#a2fe5dc5cafe81a044b1ba70d5db5b597">00341</a> <a class="code" href="tracepoint_8c.html#a2fe5dc5cafe81a044b1ba70d5db5b597">find_trace_state_variable_by_number</a> (<span class="keywordtype">int</span> <a class="code" href="structtrace__state__variable.html#a6bb7d975f2080b6b52d3d3c49c7fe767">number</a>)
<a name="l00342"></a>00342 {
<a name="l00343"></a>00343   <span class="keyword">struct </span><a class="code" href="structtrace__state__variable.html">trace_state_variable</a> *tsv;
<a name="l00344"></a>00344   <span class="keywordtype">int</span> ix;
<a name="l00345"></a>00345 
<a name="l00346"></a>00346   <span class="keywordflow">for</span> (ix = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="structtrace__state__variable.html">tsv_s</a>, tvariables, ix, tsv); ++ix)
<a name="l00347"></a>00347     <span class="keywordflow">if</span> (tsv-&gt;<a class="code" href="structtrace__state__variable.html#a6bb7d975f2080b6b52d3d3c49c7fe767">number</a> == number)
<a name="l00348"></a>00348       <span class="keywordflow">return</span> tsv;
<a name="l00349"></a>00349 
<a name="l00350"></a>00350   <span class="keywordflow">return</span> NULL;
<a name="l00351"></a>00351 }
<a name="l00352"></a>00352 
<a name="l00353"></a>00353 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00354"></a>00354 delete_trace_state_variable (<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="aarch64-tdep_8c.html#acc128f98d9ceca227038c771308eff39">name</a>)
<a name="l00355"></a>00355 {
<a name="l00356"></a>00356   <span class="keyword">struct </span><a class="code" href="structtrace__state__variable.html">trace_state_variable</a> *tsv;
<a name="l00357"></a>00357   <span class="keywordtype">int</span> ix;
<a name="l00358"></a>00358 
<a name="l00359"></a>00359   <span class="keywordflow">for</span> (ix = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="structtrace__state__variable.html">tsv_s</a>, tvariables, ix, tsv); ++ix)
<a name="l00360"></a>00360     <span class="keywordflow">if</span> (strcmp (name, tsv-&gt;<a class="code" href="structtrace__state__variable.html#ac86438487a7fe60738afe3ba2699b09f">name</a>) == 0)
<a name="l00361"></a>00361       {
<a name="l00362"></a>00362         <a class="code" href="observer_8h.html#a8b1f732dc4a6b5b8f233e252e277a5c2">observer_notify_tsv_deleted</a> (tsv);
<a name="l00363"></a>00363 
<a name="l00364"></a>00364         <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> ((<span class="keywordtype">void</span> *)tsv-&gt;<a class="code" href="structtrace__state__variable.html#ac86438487a7fe60738afe3ba2699b09f">name</a>);
<a name="l00365"></a>00365         <a class="code" href="vec_8h.html#a9b8030a97476b5742a90e8d29e2e9dac">VEC_unordered_remove</a> (<a class="code" href="structtrace__state__variable.html">tsv_s</a>, tvariables, ix);
<a name="l00366"></a>00366 
<a name="l00367"></a>00367         <span class="keywordflow">return</span>;
<a name="l00368"></a>00368       }
<a name="l00369"></a>00369 
<a name="l00370"></a>00370   <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No trace variable named \&quot;$%s\&quot;, not deleting&quot;</span>), name);
<a name="l00371"></a>00371 }
<a name="l00372"></a>00372 
<a name="l00373"></a>00373 <span class="comment">/* Throws an error if NAME is not valid syntax for a trace state</span>
<a name="l00374"></a>00374 <span class="comment">   variable&#39;s name.  */</span>
<a name="l00375"></a>00375 
<a name="l00376"></a>00376 <span class="keywordtype">void</span>
<a name="l00377"></a><a class="code" href="tracepoint_8h.html#a5d6e5deeec055c5e4af55b20e3128cee">00377</a> <a class="code" href="tracepoint_8c.html#a5d6e5deeec055c5e4af55b20e3128cee">validate_trace_state_variable_name</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *name)
<a name="l00378"></a>00378 {
<a name="l00379"></a>00379   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="windows-nat_8c.html#ade66e4ccafbc33b117610bbc0d85feb0">p</a>;
<a name="l00380"></a>00380 
<a name="l00381"></a>00381   <span class="keywordflow">if</span> (*name == <span class="charliteral">&#39;\0&#39;</span>)
<a name="l00382"></a>00382     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Must supply a non-empty variable name&quot;</span>));
<a name="l00383"></a>00383 
<a name="l00384"></a>00384   <span class="comment">/* All digits in the name is reserved for value history</span>
<a name="l00385"></a>00385 <span class="comment">     references.  */</span>
<a name="l00386"></a>00386   <span class="keywordflow">for</span> (p = name; isdigit (*p); p++)
<a name="l00387"></a>00387     ;
<a name="l00388"></a>00388   <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;\0&#39;</span>)
<a name="l00389"></a>00389     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;$%s is not a valid trace state variable name&quot;</span>), name);
<a name="l00390"></a>00390 
<a name="l00391"></a>00391   <span class="keywordflow">for</span> (p = name; isalnum (*p) || *p == <span class="charliteral">&#39;_&#39;</span>; p++)
<a name="l00392"></a>00392     ;
<a name="l00393"></a>00393   <span class="keywordflow">if</span> (*p != <span class="charliteral">&#39;\0&#39;</span>)
<a name="l00394"></a>00394     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;$%s is not a valid trace state variable name&quot;</span>), name);
<a name="l00395"></a>00395 }
<a name="l00396"></a>00396 
<a name="l00397"></a>00397 <span class="comment">/* The &#39;tvariable&#39; command collects a name and optional expression to</span>
<a name="l00398"></a>00398 <span class="comment">   evaluate into an initial value.  */</span>
<a name="l00399"></a>00399 
<a name="l00400"></a>00400 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00401"></a>00401 trace_variable_command (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l00402"></a>00402 {
<a name="l00403"></a>00403   <span class="keyword">struct </span>cleanup *old_chain;
<a name="l00404"></a>00404   <a class="code" href="defs_8h.html#ac7647a3f71533007c9e128f3ddda1987">LONGEST</a> initval = 0;
<a name="l00405"></a>00405   <span class="keyword">struct </span><a class="code" href="structtrace__state__variable.html">trace_state_variable</a> *tsv;
<a name="l00406"></a>00406   <span class="keywordtype">char</span> *<a class="code" href="aarch64-tdep_8c.html#acc128f98d9ceca227038c771308eff39">name</a>, *<a class="code" href="windows-nat_8c.html#ade66e4ccafbc33b117610bbc0d85feb0">p</a>;
<a name="l00407"></a>00407 
<a name="l00408"></a>00408   <span class="keywordflow">if</span> (!args || !*args)
<a name="l00409"></a>00409     <a class="code" href="cli-cmds_8c.html#a68aef78cdf72abc9df2495a4618842c3">error_no_arg</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Syntax is $NAME [ = EXPR ]&quot;</span>));
<a name="l00410"></a>00410 
<a name="l00411"></a>00411   <span class="comment">/* Only allow two syntaxes; &quot;$name&quot; and &quot;$name=value&quot;.  */</span>
<a name="l00412"></a>00412   p = <a class="code" href="cli-utils_8c.html#afa70bcaee54d487b4412d2a7a5a0c8fa">skip_spaces</a> (args);
<a name="l00413"></a>00413 
<a name="l00414"></a>00414   <span class="keywordflow">if</span> (*p++ != <span class="charliteral">&#39;$&#39;</span>)
<a name="l00415"></a>00415     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Name of trace variable should start with &#39;$&#39;&quot;</span>));
<a name="l00416"></a>00416 
<a name="l00417"></a>00417   name = p;
<a name="l00418"></a>00418   <span class="keywordflow">while</span> (isalnum (*p) || *p == <span class="charliteral">&#39;_&#39;</span>)
<a name="l00419"></a>00419     p++;
<a name="l00420"></a>00420   name = <a class="code" href="common-utils_8c.html#a5f388f89054b57d850779d7d71bc4d1c">savestring</a> (name, p - name);
<a name="l00421"></a>00421   old_chain = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, name);
<a name="l00422"></a>00422 
<a name="l00423"></a>00423   p = <a class="code" href="cli-utils_8c.html#afa70bcaee54d487b4412d2a7a5a0c8fa">skip_spaces</a> (p);
<a name="l00424"></a>00424   <span class="keywordflow">if</span> (*p != <span class="charliteral">&#39;=&#39;</span> &amp;&amp; *p != <span class="charliteral">&#39;\0&#39;</span>)
<a name="l00425"></a>00425     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Syntax must be $NAME [ = EXPR ]&quot;</span>));
<a name="l00426"></a>00426 
<a name="l00427"></a>00427   <a class="code" href="tracepoint_8c.html#a5d6e5deeec055c5e4af55b20e3128cee">validate_trace_state_variable_name</a> (name);
<a name="l00428"></a>00428 
<a name="l00429"></a>00429   <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;=&#39;</span>)
<a name="l00430"></a>00430     initval = <a class="code" href="value_8c.html#aa95e2692a6e5338edb5db75909064bc1">value_as_long</a> (<a class="code" href="eval_8c.html#a4e744c8c383f947f6e3da4112541c2f7">parse_and_eval</a> (++p));
<a name="l00431"></a>00431 
<a name="l00432"></a>00432   <span class="comment">/* If the variable already exists, just change its initial value.  */</span>
<a name="l00433"></a>00433   tsv = <a class="code" href="tracepoint_8c.html#aa1473f9341eceb0b7988d4c459b99da1">find_trace_state_variable</a> (name);
<a name="l00434"></a>00434   <span class="keywordflow">if</span> (tsv)
<a name="l00435"></a>00435     {
<a name="l00436"></a>00436       <span class="keywordflow">if</span> (tsv-&gt;<a class="code" href="structtrace__state__variable.html#aa0332c05c03fbfd925ec6b83c7ec21de">initial_value</a> != initval)
<a name="l00437"></a>00437         {
<a name="l00438"></a>00438           tsv-&gt;<a class="code" href="structtrace__state__variable.html#aa0332c05c03fbfd925ec6b83c7ec21de">initial_value</a> = initval;
<a name="l00439"></a>00439           <a class="code" href="observer_8h.html#a9b5cef555f9e45fc5778b77a46ed3f51">observer_notify_tsv_modified</a> (tsv);
<a name="l00440"></a>00440         }
<a name="l00441"></a>00441       <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace state variable $%s &quot;</span>
<a name="l00442"></a>00442                          <span class="stringliteral">&quot;now has initial value %s.\n&quot;</span>),
<a name="l00443"></a>00443                        tsv-&gt;<a class="code" href="structtrace__state__variable.html#ac86438487a7fe60738afe3ba2699b09f">name</a>, <a class="code" href="utils_8c.html#a707b1023c85049b17b9d1ca01c58768a">plongest</a> (tsv-&gt;<a class="code" href="structtrace__state__variable.html#aa0332c05c03fbfd925ec6b83c7ec21de">initial_value</a>));
<a name="l00444"></a>00444       <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l00445"></a>00445       <span class="keywordflow">return</span>;
<a name="l00446"></a>00446     }
<a name="l00447"></a>00447 
<a name="l00448"></a>00448   <span class="comment">/* Create a new variable.  */</span>
<a name="l00449"></a>00449   tsv = <a class="code" href="tracepoint_8c.html#aa40dd0d7217222beaf2aefa3065c356f">create_trace_state_variable</a> (name);
<a name="l00450"></a>00450   tsv-&gt;<a class="code" href="structtrace__state__variable.html#aa0332c05c03fbfd925ec6b83c7ec21de">initial_value</a> = initval;
<a name="l00451"></a>00451 
<a name="l00452"></a>00452   <a class="code" href="observer_8h.html#ad33543e05d0035a88e5d6eeb7ae7a76e">observer_notify_tsv_created</a> (tsv);
<a name="l00453"></a>00453 
<a name="l00454"></a>00454   <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace state variable $%s &quot;</span>
<a name="l00455"></a>00455                      <span class="stringliteral">&quot;created, with initial value %s.\n&quot;</span>),
<a name="l00456"></a>00456                    tsv-&gt;<a class="code" href="structtrace__state__variable.html#ac86438487a7fe60738afe3ba2699b09f">name</a>, <a class="code" href="utils_8c.html#a707b1023c85049b17b9d1ca01c58768a">plongest</a> (tsv-&gt;<a class="code" href="structtrace__state__variable.html#aa0332c05c03fbfd925ec6b83c7ec21de">initial_value</a>));
<a name="l00457"></a>00457 
<a name="l00458"></a>00458   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l00459"></a>00459 }
<a name="l00460"></a>00460 
<a name="l00461"></a>00461 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00462"></a>00462 delete_trace_variable_command (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l00463"></a>00463 {
<a name="l00464"></a>00464   <span class="keywordtype">int</span> ix;
<a name="l00465"></a>00465   <span class="keywordtype">char</span> **argv;
<a name="l00466"></a>00466   <span class="keyword">struct </span>cleanup *back_to;
<a name="l00467"></a>00467 
<a name="l00468"></a>00468   <span class="keywordflow">if</span> (args == NULL)
<a name="l00469"></a>00469     {
<a name="l00470"></a>00470       <span class="keywordflow">if</span> (<a class="code" href="utils_8c.html#a4b369431cd1ce5d26bccf6b79a44c085">query</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Delete all trace state variables? &quot;</span>)))
<a name="l00471"></a>00471         <a class="code" href="vec_8h.html#af5724b2bbce65103300279f9abe7f577">VEC_free</a> (<a class="code" href="structtrace__state__variable.html">tsv_s</a>, tvariables);
<a name="l00472"></a>00472       <a class="code" href="command_8h.html#ac7af34b03605d65b114a173d49532050">dont_repeat</a> ();
<a name="l00473"></a>00473       <a class="code" href="observer_8h.html#a8b1f732dc4a6b5b8f233e252e277a5c2">observer_notify_tsv_deleted</a> (NULL);
<a name="l00474"></a>00474       <span class="keywordflow">return</span>;
<a name="l00475"></a>00475     }
<a name="l00476"></a>00476 
<a name="l00477"></a>00477   argv = <a class="code" href="utils_8c.html#a146bf06d6062174a10a36700c40fdae4">gdb_buildargv</a> (args);
<a name="l00478"></a>00478   back_to = <a class="code" href="utils_8c.html#aad1e14fe73668592441775f7346f558e">make_cleanup_freeargv</a> (argv);
<a name="l00479"></a>00479 
<a name="l00480"></a>00480   <span class="keywordflow">for</span> (ix = 0; argv[ix] != NULL; ix++)
<a name="l00481"></a>00481     {
<a name="l00482"></a>00482       <span class="keywordflow">if</span> (*argv[ix] == <span class="charliteral">&#39;$&#39;</span>)
<a name="l00483"></a>00483         delete_trace_state_variable (argv[ix] + 1);
<a name="l00484"></a>00484       <span class="keywordflow">else</span>
<a name="l00485"></a>00485         <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Name \&quot;%s\&quot; not prefixed with &#39;$&#39;, ignoring&quot;</span>), argv[ix]);
<a name="l00486"></a>00486     }
<a name="l00487"></a>00487 
<a name="l00488"></a>00488   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (back_to);
<a name="l00489"></a>00489 
<a name="l00490"></a>00490   <a class="code" href="command_8h.html#ac7af34b03605d65b114a173d49532050">dont_repeat</a> ();
<a name="l00491"></a>00491 }
<a name="l00492"></a>00492 
<a name="l00493"></a>00493 <span class="keywordtype">void</span>
<a name="l00494"></a><a class="code" href="tracepoint_8h.html#aa69fcc3d057f311d9838f62b65afd4c8">00494</a> <a class="code" href="tracepoint_8c.html#aa69fcc3d057f311d9838f62b65afd4c8">tvariables_info_1</a> (<span class="keywordtype">void</span>)
<a name="l00495"></a>00495 {
<a name="l00496"></a>00496   <span class="keyword">struct </span><a class="code" href="structtrace__state__variable.html">trace_state_variable</a> *tsv;
<a name="l00497"></a>00497   <span class="keywordtype">int</span> ix;
<a name="l00498"></a>00498   <span class="keywordtype">int</span> count = 0;
<a name="l00499"></a>00499   <span class="keyword">struct </span>cleanup *back_to;
<a name="l00500"></a>00500   <span class="keyword">struct </span>ui_out *uiout = <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>;
<a name="l00501"></a>00501 
<a name="l00502"></a>00502   <span class="keywordflow">if</span> (<a class="code" href="vec_8h.html#a844523bba6d0565ef73a0f4a63e48d19">VEC_length</a> (<a class="code" href="structtrace__state__variable.html">tsv_s</a>, tvariables) == 0 &amp;&amp; !<a class="code" href="ui-out_8c.html#a473db54efcfbc60feeb5a4f54f27af46">ui_out_is_mi_like_p</a> (uiout))
<a name="l00503"></a>00503     {
<a name="l00504"></a>00504       <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No trace state variables.\n&quot;</span>));
<a name="l00505"></a>00505       <span class="keywordflow">return</span>;
<a name="l00506"></a>00506     }
<a name="l00507"></a>00507 
<a name="l00508"></a>00508   <span class="comment">/* Try to acquire values from the target.  */</span>
<a name="l00509"></a>00509   <span class="keywordflow">for</span> (ix = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="structtrace__state__variable.html">tsv_s</a>, tvariables, ix, tsv); ++ix, ++count)
<a name="l00510"></a>00510     tsv-&gt;<a class="code" href="structtrace__state__variable.html#a477de2307634454e6eba5730e76f71ce">value_known</a> = <a class="code" href="target_8h.html#a8628c39fd21979c3a0382fa374343872">target_get_trace_state_variable_value</a> (tsv-&gt;<a class="code" href="structtrace__state__variable.html#a6bb7d975f2080b6b52d3d3c49c7fe767">number</a>,
<a name="l00511"></a>00511                                                               &amp;(tsv-&gt;<a class="code" href="structtrace__state__variable.html#af724d35de7189b31747e0e39d51e3719">value</a>));
<a name="l00512"></a>00512 
<a name="l00513"></a>00513   back_to = <a class="code" href="ui-out_8c.html#a9675e3968a06325a214ffe2fbb10bdc8">make_cleanup_ui_out_table_begin_end</a> (uiout, 3,
<a name="l00514"></a>00514                                                  count, <span class="stringliteral">&quot;trace-variables&quot;</span>);
<a name="l00515"></a>00515   <a class="code" href="ui-out_8c.html#a6a85ff75fa4ac345725a2fd58498173f">ui_out_table_header</a> (uiout, 15, <a class="code" href="ui-out_8h.html#ac5d0187f97768dc203458ddf644e0c7aac8a02f1b44706ba412f42aa3fc249695">ui_left</a>, <span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;Name&quot;</span>);
<a name="l00516"></a>00516   <a class="code" href="ui-out_8c.html#a6a85ff75fa4ac345725a2fd58498173f">ui_out_table_header</a> (uiout, 11, <a class="code" href="ui-out_8h.html#ac5d0187f97768dc203458ddf644e0c7aac8a02f1b44706ba412f42aa3fc249695">ui_left</a>, <span class="stringliteral">&quot;initial&quot;</span>, <span class="stringliteral">&quot;Initial&quot;</span>);
<a name="l00517"></a>00517   <a class="code" href="ui-out_8c.html#a6a85ff75fa4ac345725a2fd58498173f">ui_out_table_header</a> (uiout, 11, <a class="code" href="ui-out_8h.html#ac5d0187f97768dc203458ddf644e0c7aac8a02f1b44706ba412f42aa3fc249695">ui_left</a>, <span class="stringliteral">&quot;current&quot;</span>, <span class="stringliteral">&quot;Current&quot;</span>);
<a name="l00518"></a>00518 
<a name="l00519"></a>00519   <a class="code" href="ui-out_8c.html#a07042144a117bc974f5c41761b68975e">ui_out_table_body</a> (uiout);
<a name="l00520"></a>00520 
<a name="l00521"></a>00521   <span class="keywordflow">for</span> (ix = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="structtrace__state__variable.html">tsv_s</a>, tvariables, ix, tsv); ++ix)
<a name="l00522"></a>00522     {
<a name="l00523"></a>00523       <span class="keyword">struct </span>cleanup *back_to2;
<a name="l00524"></a>00524       <span class="keywordtype">char</span> *c;
<a name="l00525"></a>00525       <span class="keywordtype">char</span> *<a class="code" href="aarch64-tdep_8c.html#acc128f98d9ceca227038c771308eff39">name</a>;
<a name="l00526"></a>00526 
<a name="l00527"></a>00527       back_to2 = <a class="code" href="ui-out_8c.html#aaf5a0c991d74ad2e486f420d5c2ff058">make_cleanup_ui_out_tuple_begin_end</a> (uiout, <span class="stringliteral">&quot;variable&quot;</span>);
<a name="l00528"></a>00528 
<a name="l00529"></a>00529       name = concat (<span class="stringliteral">&quot;$&quot;</span>, tsv-&gt;<a class="code" href="structtrace__state__variable.html#ac86438487a7fe60738afe3ba2699b09f">name</a>, (<span class="keywordtype">char</span> *) NULL);
<a name="l00530"></a>00530       <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, name);
<a name="l00531"></a>00531       <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;name&quot;</span>, name);
<a name="l00532"></a>00532       <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;initial&quot;</span>, <a class="code" href="utils_8c.html#a707b1023c85049b17b9d1ca01c58768a">plongest</a> (tsv-&gt;<a class="code" href="structtrace__state__variable.html#aa0332c05c03fbfd925ec6b83c7ec21de">initial_value</a>));
<a name="l00533"></a>00533 
<a name="l00534"></a>00534       <span class="keywordflow">if</span> (tsv-&gt;<a class="code" href="structtrace__state__variable.html#a477de2307634454e6eba5730e76f71ce">value_known</a>)
<a name="l00535"></a>00535         c = <a class="code" href="utils_8c.html#a707b1023c85049b17b9d1ca01c58768a">plongest</a> (tsv-&gt;<a class="code" href="structtrace__state__variable.html#af724d35de7189b31747e0e39d51e3719">value</a>);
<a name="l00536"></a>00536       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="ui-out_8c.html#a473db54efcfbc60feeb5a4f54f27af46">ui_out_is_mi_like_p</a> (uiout))
<a name="l00537"></a>00537         <span class="comment">/* For MI, we prefer not to use magic string constants, but rather</span>
<a name="l00538"></a>00538 <span class="comment">           omit the field completely.  The difference between unknown and</span>
<a name="l00539"></a>00539 <span class="comment">           undefined does not seem important enough to represent.  */</span>
<a name="l00540"></a>00540         c = NULL;
<a name="l00541"></a>00541       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> ()-&gt;running || traceframe_number &gt;= 0)
<a name="l00542"></a>00542         <span class="comment">/* The value is/was defined, but we don&#39;t have it.  */</span>
<a name="l00543"></a>00543         c = <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>;
<a name="l00544"></a>00544       <span class="keywordflow">else</span>
<a name="l00545"></a>00545         <span class="comment">/* It is not meaningful to ask about the value.  */</span>
<a name="l00546"></a>00546         c = <span class="stringliteral">&quot;&lt;undefined&gt;&quot;</span>;
<a name="l00547"></a>00547       <span class="keywordflow">if</span> (c)
<a name="l00548"></a>00548         <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;current&quot;</span>, c);
<a name="l00549"></a>00549       <a class="code" href="ui-out_8c.html#a6a23596295dce32ba2a5bd2fd2d309f8">ui_out_text</a> (uiout, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00550"></a>00550 
<a name="l00551"></a>00551       <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (back_to2);
<a name="l00552"></a>00552     }
<a name="l00553"></a>00553 
<a name="l00554"></a>00554   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (back_to);
<a name="l00555"></a>00555 }
<a name="l00556"></a>00556 
<a name="l00557"></a>00557 <span class="comment">/* List all the trace state variables.  */</span>
<a name="l00558"></a>00558 
<a name="l00559"></a>00559 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00560"></a>00560 tvariables_info (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l00561"></a>00561 {
<a name="l00562"></a>00562   <a class="code" href="tracepoint_8c.html#aa69fcc3d057f311d9838f62b65afd4c8">tvariables_info_1</a> ();
<a name="l00563"></a>00563 }
<a name="l00564"></a>00564 
<a name="l00565"></a>00565 <span class="comment">/* Stash definitions of tsvs into the given file.  */</span>
<a name="l00566"></a>00566 
<a name="l00567"></a>00567 <span class="keywordtype">void</span>
<a name="l00568"></a><a class="code" href="tracepoint_8h.html#a3fc00a1b3f396cc0633c9eda84195002">00568</a> <a class="code" href="tracepoint_8c.html#a3fc00a1b3f396cc0633c9eda84195002">save_trace_state_variables</a> (<span class="keyword">struct</span> ui_file *fp)
<a name="l00569"></a>00569 {
<a name="l00570"></a>00570   <span class="keyword">struct </span><a class="code" href="structtrace__state__variable.html">trace_state_variable</a> *tsv;
<a name="l00571"></a>00571   <span class="keywordtype">int</span> ix;
<a name="l00572"></a>00572 
<a name="l00573"></a>00573   <span class="keywordflow">for</span> (ix = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="structtrace__state__variable.html">tsv_s</a>, tvariables, ix, tsv); ++ix)
<a name="l00574"></a>00574     {
<a name="l00575"></a>00575       <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (fp, <span class="stringliteral">&quot;tvariable $%s&quot;</span>, tsv-&gt;<a class="code" href="structtrace__state__variable.html#ac86438487a7fe60738afe3ba2699b09f">name</a>);
<a name="l00576"></a>00576       <span class="keywordflow">if</span> (tsv-&gt;<a class="code" href="structtrace__state__variable.html#aa0332c05c03fbfd925ec6b83c7ec21de">initial_value</a>)
<a name="l00577"></a>00577         <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (fp, <span class="stringliteral">&quot; = %s&quot;</span>, <a class="code" href="utils_8c.html#a707b1023c85049b17b9d1ca01c58768a">plongest</a> (tsv-&gt;<a class="code" href="structtrace__state__variable.html#aa0332c05c03fbfd925ec6b83c7ec21de">initial_value</a>));
<a name="l00578"></a>00578       <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (fp, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00579"></a>00579     }
<a name="l00580"></a>00580 }
<a name="l00581"></a>00581 
<a name="l00582"></a>00582 <span class="comment">/* ACTIONS functions: */</span>
<a name="l00583"></a>00583 
<a name="l00584"></a>00584 <span class="comment">/* The three functions:</span>
<a name="l00585"></a>00585 <span class="comment">   collect_pseudocommand, </span>
<a name="l00586"></a>00586 <span class="comment">   while_stepping_pseudocommand, and </span>
<a name="l00587"></a>00587 <span class="comment">   end_actions_pseudocommand</span>
<a name="l00588"></a>00588 <span class="comment">   are placeholders for &quot;commands&quot; that are actually ONLY to be used</span>
<a name="l00589"></a>00589 <span class="comment">   within a tracepoint action list.  If the actual function is ever called,</span>
<a name="l00590"></a>00590 <span class="comment">   it means that somebody issued the &quot;command&quot; at the top level,</span>
<a name="l00591"></a>00591 <span class="comment">   which is always an error.  */</span>
<a name="l00592"></a>00592 
<a name="l00593"></a>00593 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00594"></a>00594 end_actions_pseudocommand (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l00595"></a>00595 {
<a name="l00596"></a>00596   <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;This command cannot be used at the top level.&quot;</span>));
<a name="l00597"></a>00597 }
<a name="l00598"></a>00598 
<a name="l00599"></a>00599 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00600"></a>00600 while_stepping_pseudocommand (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l00601"></a>00601 {
<a name="l00602"></a>00602   <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;This command can only be used in a tracepoint actions list.&quot;</span>));
<a name="l00603"></a>00603 }
<a name="l00604"></a>00604 
<a name="l00605"></a>00605 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00606"></a>00606 collect_pseudocommand (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l00607"></a>00607 {
<a name="l00608"></a>00608   <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;This command can only be used in a tracepoint actions list.&quot;</span>));
<a name="l00609"></a>00609 }
<a name="l00610"></a>00610 
<a name="l00611"></a>00611 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00612"></a>00612 teval_pseudocommand (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l00613"></a>00613 {
<a name="l00614"></a>00614   <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;This command can only be used in a tracepoint actions list.&quot;</span>));
<a name="l00615"></a>00615 }
<a name="l00616"></a>00616 
<a name="l00617"></a>00617 <span class="comment">/* Parse any collection options, such as /s for strings.  */</span>
<a name="l00618"></a>00618 
<a name="l00619"></a>00619 <span class="keyword">const</span> <span class="keywordtype">char</span> *
<a name="l00620"></a><a class="code" href="tracepoint_8h.html#ab33a6fe626f9fa9e84c68df03ab25e63">00620</a> <a class="code" href="tracepoint_8c.html#ab33a6fe626f9fa9e84c68df03ab25e63">decode_agent_options</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *exp, <span class="keywordtype">int</span> *trace_string)
<a name="l00621"></a>00621 {
<a name="l00622"></a>00622   <span class="keyword">struct </span><a class="code" href="structvalue__print__options.html">value_print_options</a> opts;
<a name="l00623"></a>00623 
<a name="l00624"></a>00624   *trace_string = 0;
<a name="l00625"></a>00625 
<a name="l00626"></a>00626   <span class="keywordflow">if</span> (*exp != <span class="charliteral">&#39;/&#39;</span>)
<a name="l00627"></a>00627     <span class="keywordflow">return</span> exp;
<a name="l00628"></a>00628 
<a name="l00629"></a>00629   <span class="comment">/* Call this to borrow the print elements default for collection</span>
<a name="l00630"></a>00630 <span class="comment">     size.  */</span>
<a name="l00631"></a>00631   <a class="code" href="valprint_8c.html#aa2d4dfe4b11841ccafc4d0c0d410095d">get_user_print_options</a> (&amp;opts);
<a name="l00632"></a>00632 
<a name="l00633"></a>00633   exp++;
<a name="l00634"></a>00634   <span class="keywordflow">if</span> (*exp == <span class="charliteral">&#39;s&#39;</span>)
<a name="l00635"></a>00635     {
<a name="l00636"></a>00636       <span class="keywordflow">if</span> (<a class="code" href="target_8h.html#adc9a80e2e8bac1505844111ab9d2cb58">target_supports_string_tracing</a> ())
<a name="l00637"></a>00637         {
<a name="l00638"></a>00638           <span class="comment">/* Allow an optional decimal number giving an explicit maximum</span>
<a name="l00639"></a>00639 <span class="comment">             string length, defaulting it to the &quot;print elements&quot; value;</span>
<a name="l00640"></a>00640 <span class="comment">             so &quot;collect/s80 mystr&quot; gets at most 80 bytes of string.  */</span>
<a name="l00641"></a>00641           *trace_string = opts.<a class="code" href="structvalue__print__options.html#a305ef62e19b5a653482017b06dcc7d72">print_max</a>;
<a name="l00642"></a>00642           exp++;
<a name="l00643"></a>00643           <span class="keywordflow">if</span> (*exp &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; *exp &lt;= <span class="charliteral">&#39;9&#39;</span>)
<a name="l00644"></a>00644             *trace_string = atoi (exp);
<a name="l00645"></a>00645           <span class="keywordflow">while</span> (*exp &gt;= <span class="charliteral">&#39;0&#39;</span> &amp;&amp; *exp &lt;= <span class="charliteral">&#39;9&#39;</span>)
<a name="l00646"></a>00646             exp++;
<a name="l00647"></a>00647         }
<a name="l00648"></a>00648       <span class="keywordflow">else</span>
<a name="l00649"></a>00649         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Target does not support \&quot;/s\&quot; option for string tracing.&quot;</span>));
<a name="l00650"></a>00650     }
<a name="l00651"></a>00651   <span class="keywordflow">else</span>
<a name="l00652"></a>00652     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Undefined collection format \&quot;%c\&quot;.&quot;</span>), *exp);
<a name="l00653"></a>00653 
<a name="l00654"></a>00654   exp = <a class="code" href="cli-utils_8c.html#aad7df612354d99c740a7ea12eccd3848">skip_spaces_const</a> (exp);
<a name="l00655"></a>00655 
<a name="l00656"></a>00656   <span class="keywordflow">return</span> exp;
<a name="l00657"></a>00657 }
<a name="l00658"></a>00658 
<a name="l00659"></a>00659 <span class="comment">/* Enter a list of actions for a tracepoint.  */</span>
<a name="l00660"></a>00660 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00661"></a>00661 trace_actions_command (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l00662"></a>00662 {
<a name="l00663"></a>00663   <span class="keyword">struct </span><a class="code" href="structtracepoint.html">tracepoint</a> *t;
<a name="l00664"></a>00664   <span class="keyword">struct </span><a class="code" href="structcommand__line.html">command_line</a> *l;
<a name="l00665"></a>00665 
<a name="l00666"></a>00666   t = <a class="code" href="breakpoint_8c.html#a637d18c918c6a205f28b22b1e024d3b4">get_tracepoint_by_number</a> (&amp;args, NULL, 1);
<a name="l00667"></a>00667   <span class="keywordflow">if</span> (t)
<a name="l00668"></a>00668     {
<a name="l00669"></a>00669       <span class="keywordtype">char</span> *tmpbuf =
<a name="l00670"></a>00670         <a class="code" href="common-utils_8c.html#ab9bf7e1b4e68bdd0078e9e1e55c62cec">xstrprintf</a> (<span class="stringliteral">&quot;Enter actions for tracepoint %d, one per line.&quot;</span>,
<a name="l00671"></a>00671                     t-&gt;<a class="code" href="structtracepoint.html#a881af30b18b555e6ff11113da6b01a02">base</a>.<a class="code" href="structbreakpoint.html#aa46a2ab4a5f2ae1e42412c412997871b">number</a>);
<a name="l00672"></a>00672       <span class="keyword">struct </span>cleanup *cleanups = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, tmpbuf);
<a name="l00673"></a>00673 
<a name="l00674"></a>00674       l = <a class="code" href="cli-script_8c.html#a23f6f7584a163a2b29e4a9d2ce469832">read_command_lines</a> (tmpbuf, from_tty, 1,
<a name="l00675"></a>00675                               <a class="code" href="breakpoint_8c.html#ac150d03b018dda5d60dbf71a30d5b80a">check_tracepoint_command</a>, t);
<a name="l00676"></a>00676       <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanups);
<a name="l00677"></a>00677       <a class="code" href="breakpoint_8c.html#af44da744b723fb36892418db535ed855">breakpoint_set_commands</a> (&amp;t-&gt;<a class="code" href="structtracepoint.html#a881af30b18b555e6ff11113da6b01a02">base</a>, l);
<a name="l00678"></a>00678     }
<a name="l00679"></a>00679   <span class="comment">/* else just return */</span>
<a name="l00680"></a>00680 }
<a name="l00681"></a>00681 
<a name="l00682"></a>00682 <span class="comment">/* Report the results of checking the agent expression, as errors or</span>
<a name="l00683"></a>00683 <span class="comment">   internal errors.  */</span>
<a name="l00684"></a>00684 
<a name="l00685"></a>00685 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00686"></a>00686 report_agent_reqs_errors (<span class="keyword">struct</span> <a class="code" href="structagent__expr.html">agent_expr</a> *aexpr)
<a name="l00687"></a>00687 {
<a name="l00688"></a>00688   <span class="comment">/* All of the &quot;flaws&quot; are serious bytecode generation issues that</span>
<a name="l00689"></a>00689 <span class="comment">     should never occur.  */</span>
<a name="l00690"></a>00690   <span class="keywordflow">if</span> (aexpr-&gt;<a class="code" href="structagent__expr.html#a07d4119a2dfe52d39310af05da738b77">flaw</a> != <a class="code" href="ax_8h.html#aa821bb7b486021b7d85d3088f0a086aaaa9921c95d006be78fc728360b0ab0e51">agent_flaw_none</a>)
<a name="l00691"></a>00691     <a class="code" href="common-utils_8h.html#aa14285d9d3d4171016ef9cf09447e8bb">internal_error</a> (__FILE__, __LINE__, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;expression is malformed&quot;</span>));
<a name="l00692"></a>00692 
<a name="l00693"></a>00693   <span class="comment">/* If analysis shows a stack underflow, GDB must have done something</span>
<a name="l00694"></a>00694 <span class="comment">     badly wrong in its bytecode generation.  */</span>
<a name="l00695"></a>00695   <span class="keywordflow">if</span> (aexpr-&gt;<a class="code" href="structagent__expr.html#acae901231f6b30c39b0da7024bbe40bd">min_height</a> &lt; 0)
<a name="l00696"></a>00696     <a class="code" href="common-utils_8h.html#aa14285d9d3d4171016ef9cf09447e8bb">internal_error</a> (__FILE__, __LINE__,
<a name="l00697"></a>00697                     <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;expression has min height &lt; 0&quot;</span>));
<a name="l00698"></a>00698 
<a name="l00699"></a>00699   <span class="comment">/* Issue this error if the stack is predicted to get too deep.  The</span>
<a name="l00700"></a>00700 <span class="comment">     limit is rather arbitrary; a better scheme might be for the</span>
<a name="l00701"></a>00701 <span class="comment">     target to report how much stack it will have available.  The</span>
<a name="l00702"></a>00702 <span class="comment">     depth roughly corresponds to parenthesization, so a limit of 20</span>
<a name="l00703"></a>00703 <span class="comment">     amounts to 20 levels of expression nesting, which is actually</span>
<a name="l00704"></a>00704 <span class="comment">     a pretty big hairy expression.  */</span>
<a name="l00705"></a>00705   <span class="keywordflow">if</span> (aexpr-&gt;<a class="code" href="structagent__expr.html#a9c4532a9f33b501117edf0bdb080ceaa">max_height</a> &gt; 20)
<a name="l00706"></a>00706     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Expression is too complicated.&quot;</span>));
<a name="l00707"></a>00707 }
<a name="l00708"></a>00708 
<a name="l00709"></a>00709 <span class="comment">/* worker function */</span>
<a name="l00710"></a>00710 <span class="keywordtype">void</span>
<a name="l00711"></a><a class="code" href="tracepoint_8h.html#a214d14941b2abfbc97e5f89f11084fce">00711</a> <a class="code" href="tracepoint_8c.html#ae9b04bda0e4d8d4de77644aa0da39154">validate_actionline</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="symtab_8h.html#a41ebd28ef1d7c6ade45642cb6acc1039">line</a>, <span class="keyword">struct</span> <a class="code" href="structbreakpoint.html">breakpoint</a> *b)
<a name="l00712"></a>00712 {
<a name="l00713"></a>00713   <span class="keyword">struct </span><a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c;
<a name="l00714"></a>00714   <span class="keyword">struct </span><a class="code" href="structexpression.html">expression</a> *exp = NULL;
<a name="l00715"></a>00715   <span class="keyword">struct </span>cleanup *old_chain = NULL;
<a name="l00716"></a>00716   <span class="keyword">const</span> <span class="keywordtype">char</span> *tmp_p;
<a name="l00717"></a>00717   <span class="keyword">const</span> <span class="keywordtype">char</span> *p;
<a name="l00718"></a>00718   <span class="keyword">struct </span><a class="code" href="structbp__location.html">bp_location</a> *loc;
<a name="l00719"></a>00719   <span class="keyword">struct </span><a class="code" href="structagent__expr.html">agent_expr</a> *aexpr;
<a name="l00720"></a>00720   <span class="keyword">struct </span><a class="code" href="structtracepoint.html">tracepoint</a> *t = (<span class="keyword">struct </span><a class="code" href="structtracepoint.html">tracepoint</a> *) b;
<a name="l00721"></a>00721 
<a name="l00722"></a>00722   <span class="comment">/* If EOF is typed, *line is NULL.  */</span>
<a name="l00723"></a>00723   <span class="keywordflow">if</span> (line == NULL)
<a name="l00724"></a>00724     <span class="keywordflow">return</span>;
<a name="l00725"></a>00725 
<a name="l00726"></a>00726   p = <a class="code" href="cli-utils_8c.html#aad7df612354d99c740a7ea12eccd3848">skip_spaces_const</a> (line);
<a name="l00727"></a>00727 
<a name="l00728"></a>00728   <span class="comment">/* Symbol lookup etc.  */</span>
<a name="l00729"></a>00729   <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;\0&#39;</span>)       <span class="comment">/* empty line: just prompt for another line.  */</span>
<a name="l00730"></a>00730     <span class="keywordflow">return</span>;
<a name="l00731"></a>00731 
<a name="l00732"></a>00732   <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;#&#39;</span>)                <span class="comment">/* comment line */</span>
<a name="l00733"></a>00733     <span class="keywordflow">return</span>;
<a name="l00734"></a>00734 
<a name="l00735"></a>00735   c = <a class="code" href="cli-decode_8c.html#afbb3266bd92a5a8903072bb4e5f250cc">lookup_cmd</a> (&amp;p, <a class="code" href="cli-cmds_8c.html#a6b7ab0355d0fa8d6ce7d5feb83ff78e7">cmdlist</a>, <span class="stringliteral">&quot;&quot;</span>, -1, 1);
<a name="l00736"></a>00736   <span class="keywordflow">if</span> (c == 0)
<a name="l00737"></a>00737     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;`%s&#39; is not a tracepoint action, or is ambiguous.&quot;</span>), p);
<a name="l00738"></a>00738 
<a name="l00739"></a>00739   <span class="keywordflow">if</span> (<a class="code" href="cli-decode_8c.html#a5335d4a46d04e07d54f850cc468dcb3d">cmd_cfunc_eq</a> (c, collect_pseudocommand))
<a name="l00740"></a>00740     {
<a name="l00741"></a>00741       <span class="keywordtype">int</span> trace_string = 0;
<a name="l00742"></a>00742 
<a name="l00743"></a>00743       <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;/&#39;</span>)
<a name="l00744"></a>00744         p = <a class="code" href="tracepoint_8c.html#ab33a6fe626f9fa9e84c68df03ab25e63">decode_agent_options</a> (p, &amp;trace_string);
<a name="l00745"></a>00745 
<a name="l00746"></a>00746       <span class="keywordflow">do</span>
<a name="l00747"></a>00747         {                       <span class="comment">/* Repeat over a comma-separated list.  */</span>
<a name="l00748"></a>00748           <a class="code" href="defs_8h.html#ad24e2b54375e12474e65ebf7175988fb">QUIT</a>;                 <span class="comment">/* Allow user to bail out with ^C.  */</span>
<a name="l00749"></a>00749           p = <a class="code" href="cli-utils_8c.html#aad7df612354d99c740a7ea12eccd3848">skip_spaces_const</a> (p);
<a name="l00750"></a>00750 
<a name="l00751"></a>00751           <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;$&#39;</span>)        <span class="comment">/* Look for special pseudo-symbols.  */</span>
<a name="l00752"></a>00752             {
<a name="l00753"></a>00753               <span class="keywordflow">if</span> (0 == strncasecmp (<span class="stringliteral">&quot;reg&quot;</span>, p + 1, 3)
<a name="l00754"></a>00754                   || 0 == strncasecmp (<span class="stringliteral">&quot;arg&quot;</span>, p + 1, 3)
<a name="l00755"></a>00755                   || 0 == strncasecmp (<span class="stringliteral">&quot;loc&quot;</span>, p + 1, 3)
<a name="l00756"></a>00756                   || 0 == strncasecmp (<span class="stringliteral">&quot;_ret&quot;</span>, p + 1, 4)
<a name="l00757"></a>00757                   || 0 == strncasecmp (<span class="stringliteral">&quot;_sdata&quot;</span>, p + 1, 6))
<a name="l00758"></a>00758                 {
<a name="l00759"></a>00759                   p = <a class="code" href="gdb__string_8h.html#adf46aa8f2e08cfb505868bbfc88b5fd4">strchr</a> (p, <span class="charliteral">&#39;,&#39;</span>);
<a name="l00760"></a>00760                   <span class="keywordflow">continue</span>;
<a name="l00761"></a>00761                 }
<a name="l00762"></a>00762               <span class="comment">/* else fall thru, treat p as an expression and parse it!  */</span>
<a name="l00763"></a>00763             }
<a name="l00764"></a>00764           tmp_p = p;
<a name="l00765"></a>00765           <span class="keywordflow">for</span> (loc = t-&gt;<a class="code" href="structtracepoint.html#a881af30b18b555e6ff11113da6b01a02">base</a>.<a class="code" href="structbreakpoint.html#aa869260f7e4c94204275861d820bb1a9">loc</a>; loc; loc = loc-&gt;<a class="code" href="structbp__location.html#ab193cb38f87fea89105db96d94191541">next</a>)
<a name="l00766"></a>00766             {
<a name="l00767"></a>00767               p = tmp_p;
<a name="l00768"></a>00768               exp = <a class="code" href="expression_8h.html#abdad295cc4b5351f6e6ec024ab665475">parse_exp_1</a> (&amp;p, loc-&gt;<a class="code" href="structbp__location.html#a6b6cd8b8a488e632200f323309d23823">address</a>,
<a name="l00769"></a>00769                                  <a class="code" href="block_8c.html#a35aadf82f92cb4a47ec068dba0e1b36c">block_for_pc</a> (loc-&gt;<a class="code" href="structbp__location.html#a6b6cd8b8a488e632200f323309d23823">address</a>), 1);
<a name="l00770"></a>00770               old_chain = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="utils_8c.html#a6d8c21606d3f67a431a7bfbb1f47d12e">free_current_contents</a>, &amp;exp);
<a name="l00771"></a>00771 
<a name="l00772"></a>00772               <span class="keywordflow">if</span> (exp-&gt;<a class="code" href="structexpression.html#a121cbb7647db0430c9e217dbcd27021f">elts</a>[0].<a class="code" href="unionexp__element.html#a732546b7148c98393e390e52d954bc83">opcode</a> == OP_VAR_VALUE)
<a name="l00773"></a>00773                 {
<a name="l00774"></a>00774                   <span class="keywordflow">if</span> (<a class="code" href="symtab_8h.html#a8394f2ba6c27e8026b2783db7cc0eb40">SYMBOL_CLASS</a> (exp-&gt;<a class="code" href="structexpression.html#a121cbb7647db0430c9e217dbcd27021f">elts</a>[2].<a class="code" href="unionexp__element.html#aaa2c043e08e05f37c03379ca80dcc124">symbol</a>) == <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3a5268309778a6727d08106ff9f2966e54">LOC_CONST</a>)
<a name="l00775"></a>00775                     {
<a name="l00776"></a>00776                       <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;constant `%s&#39; (value %s) &quot;</span>
<a name="l00777"></a>00777                                <span class="stringliteral">&quot;will not be collected.&quot;</span>),
<a name="l00778"></a>00778                              <a class="code" href="symtab_8h.html#ac7f4cb1648125545fbd0e4f13b0c572c">SYMBOL_PRINT_NAME</a> (exp-&gt;<a class="code" href="structexpression.html#a121cbb7647db0430c9e217dbcd27021f">elts</a>[2].<a class="code" href="unionexp__element.html#aaa2c043e08e05f37c03379ca80dcc124">symbol</a>),
<a name="l00779"></a>00779                              <a class="code" href="utils_8c.html#a707b1023c85049b17b9d1ca01c58768a">plongest</a> (<a class="code" href="symtab_8h.html#a31840856d8e3eed18cbe9ca90cd2bf39">SYMBOL_VALUE</a> (exp-&gt;<a class="code" href="structexpression.html#a121cbb7647db0430c9e217dbcd27021f">elts</a>[2].<a class="code" href="unionexp__element.html#aaa2c043e08e05f37c03379ca80dcc124">symbol</a>)));
<a name="l00780"></a>00780                     }
<a name="l00781"></a>00781                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="symtab_8h.html#a8394f2ba6c27e8026b2783db7cc0eb40">SYMBOL_CLASS</a> (exp-&gt;<a class="code" href="structexpression.html#a121cbb7647db0430c9e217dbcd27021f">elts</a>[2].<a class="code" href="unionexp__element.html#aaa2c043e08e05f37c03379ca80dcc124">symbol</a>)
<a name="l00782"></a>00782                            == <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3aa4f37f80c900ee253911325c30b8a60f">LOC_OPTIMIZED_OUT</a>)
<a name="l00783"></a>00783                     {
<a name="l00784"></a>00784                       <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;`%s&#39; is optimized away &quot;</span>
<a name="l00785"></a>00785                                <span class="stringliteral">&quot;and cannot be collected.&quot;</span>),
<a name="l00786"></a>00786                              <a class="code" href="symtab_8h.html#ac7f4cb1648125545fbd0e4f13b0c572c">SYMBOL_PRINT_NAME</a> (exp-&gt;<a class="code" href="structexpression.html#a121cbb7647db0430c9e217dbcd27021f">elts</a>[2].<a class="code" href="unionexp__element.html#aaa2c043e08e05f37c03379ca80dcc124">symbol</a>));
<a name="l00787"></a>00787                     }
<a name="l00788"></a>00788                 }
<a name="l00789"></a>00789 
<a name="l00790"></a>00790               <span class="comment">/* We have something to collect, make sure that the expr to</span>
<a name="l00791"></a>00791 <span class="comment">                 bytecode translator can handle it and that it&#39;s not too</span>
<a name="l00792"></a>00792 <span class="comment">                 long.  */</span>
<a name="l00793"></a>00793               aexpr = <a class="code" href="ax-gdb_8c.html#a5fd5f5325dabcf1cc401c00dc4e7bbc7">gen_trace_for_expr</a> (loc-&gt;<a class="code" href="structbp__location.html#a6b6cd8b8a488e632200f323309d23823">address</a>, exp, trace_string);
<a name="l00794"></a>00794               <a class="code" href="ax-general_8c.html#a2cf2dd0ae1eb22eb70a968683d272624">make_cleanup_free_agent_expr</a> (aexpr);
<a name="l00795"></a>00795 
<a name="l00796"></a>00796               <span class="keywordflow">if</span> (aexpr-&gt;<a class="code" href="structagent__expr.html#af6a2128d2dba09337f21cd20b09571da">len</a> &gt; <a class="code" href="tracepoint_8c.html#acf5177f8e0c8de5667b3aaa539373e4c">MAX_AGENT_EXPR_LEN</a>)
<a name="l00797"></a>00797                 <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Expression is too complicated.&quot;</span>));
<a name="l00798"></a>00798 
<a name="l00799"></a>00799               <a class="code" href="ax-general_8c.html#a2ef11cd336a163ef64356b65550324b1">ax_reqs</a> (aexpr);
<a name="l00800"></a>00800 
<a name="l00801"></a>00801               report_agent_reqs_errors (aexpr);
<a name="l00802"></a>00802 
<a name="l00803"></a>00803               <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l00804"></a>00804             }
<a name="l00805"></a>00805         }
<a name="l00806"></a>00806       <span class="keywordflow">while</span> (p &amp;&amp; *p++ == <span class="charliteral">&#39;,&#39;</span>);
<a name="l00807"></a>00807     }
<a name="l00808"></a>00808 
<a name="l00809"></a>00809   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="cli-decode_8c.html#a5335d4a46d04e07d54f850cc468dcb3d">cmd_cfunc_eq</a> (c, teval_pseudocommand))
<a name="l00810"></a>00810     {
<a name="l00811"></a>00811       <span class="keywordflow">do</span>
<a name="l00812"></a>00812         {                       <span class="comment">/* Repeat over a comma-separated list.  */</span>
<a name="l00813"></a>00813           <a class="code" href="defs_8h.html#ad24e2b54375e12474e65ebf7175988fb">QUIT</a>;                 <span class="comment">/* Allow user to bail out with ^C.  */</span>
<a name="l00814"></a>00814           p = <a class="code" href="cli-utils_8c.html#aad7df612354d99c740a7ea12eccd3848">skip_spaces_const</a> (p);
<a name="l00815"></a>00815 
<a name="l00816"></a>00816           tmp_p = p;
<a name="l00817"></a>00817           <span class="keywordflow">for</span> (loc = t-&gt;<a class="code" href="structtracepoint.html#a881af30b18b555e6ff11113da6b01a02">base</a>.<a class="code" href="structbreakpoint.html#aa869260f7e4c94204275861d820bb1a9">loc</a>; loc; loc = loc-&gt;<a class="code" href="structbp__location.html#ab193cb38f87fea89105db96d94191541">next</a>)
<a name="l00818"></a>00818             {
<a name="l00819"></a>00819               p = tmp_p;
<a name="l00820"></a>00820 
<a name="l00821"></a>00821               <span class="comment">/* Only expressions are allowed for this action.  */</span>
<a name="l00822"></a>00822               exp = <a class="code" href="expression_8h.html#abdad295cc4b5351f6e6ec024ab665475">parse_exp_1</a> (&amp;p, loc-&gt;<a class="code" href="structbp__location.html#a6b6cd8b8a488e632200f323309d23823">address</a>,
<a name="l00823"></a>00823                                  <a class="code" href="block_8c.html#a35aadf82f92cb4a47ec068dba0e1b36c">block_for_pc</a> (loc-&gt;<a class="code" href="structbp__location.html#a6b6cd8b8a488e632200f323309d23823">address</a>), 1);
<a name="l00824"></a>00824               old_chain = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="utils_8c.html#a6d8c21606d3f67a431a7bfbb1f47d12e">free_current_contents</a>, &amp;exp);
<a name="l00825"></a>00825 
<a name="l00826"></a>00826               <span class="comment">/* We have something to evaluate, make sure that the expr to</span>
<a name="l00827"></a>00827 <span class="comment">                 bytecode translator can handle it and that it&#39;s not too</span>
<a name="l00828"></a>00828 <span class="comment">                 long.  */</span>
<a name="l00829"></a>00829               aexpr = <a class="code" href="ax-gdb_8c.html#aa9b3b3364a9fd201c6c0f9a99a57da44">gen_eval_for_expr</a> (loc-&gt;<a class="code" href="structbp__location.html#a6b6cd8b8a488e632200f323309d23823">address</a>, exp);
<a name="l00830"></a>00830               <a class="code" href="ax-general_8c.html#a2cf2dd0ae1eb22eb70a968683d272624">make_cleanup_free_agent_expr</a> (aexpr);
<a name="l00831"></a>00831 
<a name="l00832"></a>00832               <span class="keywordflow">if</span> (aexpr-&gt;<a class="code" href="structagent__expr.html#af6a2128d2dba09337f21cd20b09571da">len</a> &gt; <a class="code" href="tracepoint_8c.html#acf5177f8e0c8de5667b3aaa539373e4c">MAX_AGENT_EXPR_LEN</a>)
<a name="l00833"></a>00833                 <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Expression is too complicated.&quot;</span>));
<a name="l00834"></a>00834 
<a name="l00835"></a>00835               <a class="code" href="ax-general_8c.html#a2ef11cd336a163ef64356b65550324b1">ax_reqs</a> (aexpr);
<a name="l00836"></a>00836               report_agent_reqs_errors (aexpr);
<a name="l00837"></a>00837 
<a name="l00838"></a>00838               <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l00839"></a>00839             }
<a name="l00840"></a>00840         }
<a name="l00841"></a>00841       <span class="keywordflow">while</span> (p &amp;&amp; *p++ == <span class="charliteral">&#39;,&#39;</span>);
<a name="l00842"></a>00842     }
<a name="l00843"></a>00843 
<a name="l00844"></a>00844   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="cli-decode_8c.html#a5335d4a46d04e07d54f850cc468dcb3d">cmd_cfunc_eq</a> (c, while_stepping_pseudocommand))
<a name="l00845"></a>00845     {
<a name="l00846"></a>00846       <span class="keywordtype">char</span> *endp;
<a name="l00847"></a>00847 
<a name="l00848"></a>00848       p = <a class="code" href="cli-utils_8c.html#aad7df612354d99c740a7ea12eccd3848">skip_spaces_const</a> (p);
<a name="l00849"></a>00849       t-&gt;<a class="code" href="structtracepoint.html#a23f952627bff1b293662478997684f30">step_count</a> = strtol (p, &amp;endp, 0);
<a name="l00850"></a>00850       <span class="keywordflow">if</span> (endp == p || t-&gt;<a class="code" href="structtracepoint.html#a23f952627bff1b293662478997684f30">step_count</a> == 0)
<a name="l00851"></a>00851         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;while-stepping step count `%s&#39; is malformed.&quot;</span>), line);
<a name="l00852"></a>00852       p = endp;
<a name="l00853"></a>00853     }
<a name="l00854"></a>00854 
<a name="l00855"></a>00855   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="cli-decode_8c.html#a5335d4a46d04e07d54f850cc468dcb3d">cmd_cfunc_eq</a> (c, end_actions_pseudocommand))
<a name="l00856"></a>00856     ;
<a name="l00857"></a>00857 
<a name="l00858"></a>00858   <span class="keywordflow">else</span>
<a name="l00859"></a>00859     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;`%s&#39; is not a supported tracepoint action.&quot;</span>), line);
<a name="l00860"></a>00860 }
<a name="l00861"></a>00861 
<a name="l00862"></a>00862 <span class="keyword">enum</span> {
<a name="l00863"></a><a class="code" href="tracepoint_8c.html#a85c7862086c1f92e4fb4108e176d8140a7a9e899080df0ea62d51c3dd27365865">00863</a>   <a class="code" href="tracepoint_8c.html#a85c7862086c1f92e4fb4108e176d8140a7a9e899080df0ea62d51c3dd27365865">memrange_absolute</a> = -1
<a name="l00864"></a>00864 };
<a name="l00865"></a>00865 
<a name="l00866"></a>00866 <span class="comment">/* MEMRANGE functions: */</span>
<a name="l00867"></a>00867 
<a name="l00868"></a>00868 <span class="keyword">static</span> <span class="keywordtype">int</span> memrange_cmp (<span class="keyword">const</span> <span class="keywordtype">void</span> *, <span class="keyword">const</span> <span class="keywordtype">void</span> *);
<a name="l00869"></a>00869 
<a name="l00870"></a>00870 <span class="comment">/* Compare memranges for qsort.  */</span>
<a name="l00871"></a>00871 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00872"></a>00872 memrange_cmp (<span class="keyword">const</span> <span class="keywordtype">void</span> *va, <span class="keyword">const</span> <span class="keywordtype">void</span> *vb)
<a name="l00873"></a>00873 {
<a name="l00874"></a>00874   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structmemrange.html">memrange</a> *a = va, *b = vb;
<a name="l00875"></a>00875 
<a name="l00876"></a>00876   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structmemrange.html#acaecdd7e2c0f680a6ea9306249acd488">type</a> &lt; b-&gt;type)
<a name="l00877"></a>00877     <span class="keywordflow">return</span> -1;
<a name="l00878"></a>00878   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structmemrange.html#acaecdd7e2c0f680a6ea9306249acd488">type</a> &gt; b-&gt;type)
<a name="l00879"></a>00879     <span class="keywordflow">return</span> 1;
<a name="l00880"></a>00880   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structmemrange.html#acaecdd7e2c0f680a6ea9306249acd488">type</a> == <a class="code" href="tracepoint_8c.html#a85c7862086c1f92e4fb4108e176d8140a7a9e899080df0ea62d51c3dd27365865">memrange_absolute</a>)
<a name="l00881"></a>00881     {
<a name="l00882"></a>00882       <span class="keywordflow">if</span> ((bfd_vma) a-&gt;<a class="code" href="structmemrange.html#ab49addc5247b1d10d204e1246ad78cdc">start</a> &lt; (bfd_vma) b-&gt;start)
<a name="l00883"></a>00883         <span class="keywordflow">return</span> -1;
<a name="l00884"></a>00884       <span class="keywordflow">if</span> ((bfd_vma) a-&gt;<a class="code" href="structmemrange.html#ab49addc5247b1d10d204e1246ad78cdc">start</a> &gt; (bfd_vma) b-&gt;start)
<a name="l00885"></a>00885         <span class="keywordflow">return</span> 1;
<a name="l00886"></a>00886     }
<a name="l00887"></a>00887   <span class="keywordflow">else</span>
<a name="l00888"></a>00888     {
<a name="l00889"></a>00889       <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structmemrange.html#ab49addc5247b1d10d204e1246ad78cdc">start</a> &lt; b-&gt;start)
<a name="l00890"></a>00890         <span class="keywordflow">return</span> -1;
<a name="l00891"></a>00891       <span class="keywordflow">if</span> (a-&gt;<a class="code" href="structmemrange.html#ab49addc5247b1d10d204e1246ad78cdc">start</a> &gt; b-&gt;start)
<a name="l00892"></a>00892         <span class="keywordflow">return</span> 1;
<a name="l00893"></a>00893     }
<a name="l00894"></a>00894   <span class="keywordflow">return</span> 0;
<a name="l00895"></a>00895 }
<a name="l00896"></a>00896 
<a name="l00897"></a>00897 <span class="comment">/* Sort the memrange list using qsort, and merge adjacent memranges.  */</span>
<a name="l00898"></a>00898 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00899"></a>00899 memrange_sortmerge (<span class="keyword">struct</span> <a class="code" href="structcollection__list.html">collection_list</a> *memranges)
<a name="l00900"></a>00900 {
<a name="l00901"></a>00901   <span class="keywordtype">int</span> a, b;
<a name="l00902"></a>00902 
<a name="l00903"></a>00903   <a class="code" href="ada-exp_8c.html#a849e2297facde4d3c80dc4f45f8abbdb">qsort</a> (memranges-&gt;<a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a>, memranges-&gt;<a class="code" href="structcollection__list.html#a720c32335aad94c3727ca92eef9988da">next_memrange</a>,
<a name="l00904"></a>00904          sizeof (<span class="keyword">struct</span> <a class="code" href="structmemrange.html">memrange</a>), memrange_cmp);
<a name="l00905"></a>00905   <span class="keywordflow">if</span> (memranges-&gt;<a class="code" href="structcollection__list.html#a720c32335aad94c3727ca92eef9988da">next_memrange</a> &gt; 0)
<a name="l00906"></a>00906     {
<a name="l00907"></a>00907       <span class="keywordflow">for</span> (a = 0, b = 1; b &lt; memranges-&gt;<a class="code" href="structcollection__list.html#a720c32335aad94c3727ca92eef9988da">next_memrange</a>; b++)
<a name="l00908"></a>00908         {
<a name="l00909"></a>00909           <span class="comment">/* If memrange b overlaps or is adjacent to memrange a,</span>
<a name="l00910"></a>00910 <span class="comment">             merge them.  */</span>
<a name="l00911"></a>00911           <span class="keywordflow">if</span> (memranges-&gt;<a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a>[a].<a class="code" href="structmemrange.html#acaecdd7e2c0f680a6ea9306249acd488">type</a> == memranges-&gt;<a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a>[b].<a class="code" href="structmemrange.html#acaecdd7e2c0f680a6ea9306249acd488">type</a>
<a name="l00912"></a>00912               &amp;&amp; memranges-&gt;<a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a>[b].<a class="code" href="structmemrange.html#ab49addc5247b1d10d204e1246ad78cdc">start</a> &lt;= memranges-&gt;<a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a>[a].<a class="code" href="structmemrange.html#aa178709d97e905b15468e30f62684edb">end</a>)
<a name="l00913"></a>00913             {
<a name="l00914"></a>00914               <span class="keywordflow">if</span> (memranges-&gt;<a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a>[b].<a class="code" href="structmemrange.html#aa178709d97e905b15468e30f62684edb">end</a> &gt; memranges-&gt;<a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a>[a].<a class="code" href="structmemrange.html#aa178709d97e905b15468e30f62684edb">end</a>)
<a name="l00915"></a>00915                 memranges-&gt;<a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a>[a].<a class="code" href="structmemrange.html#aa178709d97e905b15468e30f62684edb">end</a> = memranges-&gt;<a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a>[b].<a class="code" href="structmemrange.html#aa178709d97e905b15468e30f62684edb">end</a>;
<a name="l00916"></a>00916               <span class="keywordflow">continue</span>;         <span class="comment">/* next b, same a */</span>
<a name="l00917"></a>00917             }
<a name="l00918"></a>00918           a++;                  <span class="comment">/* next a */</span>
<a name="l00919"></a>00919           <span class="keywordflow">if</span> (a != b)
<a name="l00920"></a>00920             <a class="code" href="gdb__string_8h.html#a39ebe6a4e122707997e78b549a1e8c5e">memcpy</a> (&amp;memranges-&gt;<a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a>[a], &amp;memranges-&gt;<a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a>[b],
<a name="l00921"></a>00921                     sizeof (<span class="keyword">struct</span> <a class="code" href="structmemrange.html">memrange</a>));
<a name="l00922"></a>00922         }
<a name="l00923"></a>00923       memranges-&gt;<a class="code" href="structcollection__list.html#a720c32335aad94c3727ca92eef9988da">next_memrange</a> = a + 1;
<a name="l00924"></a>00924     }
<a name="l00925"></a>00925 }
<a name="l00926"></a>00926 
<a name="l00927"></a>00927 <span class="comment">/* Add a register to a collection list.  */</span>
<a name="l00928"></a>00928 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00929"></a>00929 add_register (<span class="keyword">struct</span> <a class="code" href="structcollection__list.html">collection_list</a> *collection, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> regno)
<a name="l00930"></a>00930 {
<a name="l00931"></a>00931   <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a3f2f91ed92de5dfaa6d27fb82822f8d5">info_verbose</a>)
<a name="l00932"></a>00932     <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;collect register %d\n&quot;</span>, regno);
<a name="l00933"></a>00933   <span class="keywordflow">if</span> (regno &gt;= (8 * <span class="keyword">sizeof</span> (collection-&gt;<a class="code" href="structcollection__list.html#af703b3c6497023d7e6f7e81dbb5d9943">regs_mask</a>)))
<a name="l00934"></a>00934     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Internal: register number %d too large for tracepoint&quot;</span>),
<a name="l00935"></a>00935            regno);
<a name="l00936"></a>00936   collection-&gt;<a class="code" href="structcollection__list.html#af703b3c6497023d7e6f7e81dbb5d9943">regs_mask</a>[regno / 8] |= 1 &lt;&lt; (regno % 8);
<a name="l00937"></a>00937 }
<a name="l00938"></a>00938 
<a name="l00939"></a>00939 <span class="comment">/* Add a memrange to a collection list.  */</span>
<a name="l00940"></a>00940 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00941"></a>00941 add_memrange (<span class="keyword">struct</span> <a class="code" href="structcollection__list.html">collection_list</a> *memranges, 
<a name="l00942"></a>00942               <span class="keywordtype">int</span> <a class="code" href="structtype.html">type</a>, bfd_signed_vma base,
<a name="l00943"></a>00943               <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>)
<a name="l00944"></a>00944 {
<a name="l00945"></a>00945   <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a3f2f91ed92de5dfaa6d27fb82822f8d5">info_verbose</a>)
<a name="l00946"></a>00946     {
<a name="l00947"></a>00947       <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;(%d,&quot;</span>, type);
<a name="l00948"></a>00948       printf_vma (base);
<a name="l00949"></a>00949       <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;,%ld)\n&quot;</span>, len);
<a name="l00950"></a>00950     }
<a name="l00951"></a>00951 
<a name="l00952"></a>00952   <span class="comment">/* type: memrange_absolute == memory, other n == basereg */</span>
<a name="l00953"></a>00953   memranges-&gt;<a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a>[memranges-&gt;<a class="code" href="structcollection__list.html#a720c32335aad94c3727ca92eef9988da">next_memrange</a>].<a class="code" href="structmemrange.html#acaecdd7e2c0f680a6ea9306249acd488">type</a> = <a class="code" href="structmemrange.html#acaecdd7e2c0f680a6ea9306249acd488">type</a>;
<a name="l00954"></a>00954   <span class="comment">/* base: addr if memory, offset if reg relative.  */</span>
<a name="l00955"></a>00955   memranges-&gt;<a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a>[memranges-&gt;<a class="code" href="structcollection__list.html#a720c32335aad94c3727ca92eef9988da">next_memrange</a>].<a class="code" href="structmemrange.html#ab49addc5247b1d10d204e1246ad78cdc">start</a> = base;
<a name="l00956"></a>00956   <span class="comment">/* len: we actually save end (base + len) for convenience */</span>
<a name="l00957"></a>00957   memranges-&gt;<a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a>[memranges-&gt;<a class="code" href="structcollection__list.html#a720c32335aad94c3727ca92eef9988da">next_memrange</a>].<a class="code" href="structmemrange.html#aa178709d97e905b15468e30f62684edb">end</a> = base + <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>;
<a name="l00958"></a>00958   memranges-&gt;<a class="code" href="structcollection__list.html#a720c32335aad94c3727ca92eef9988da">next_memrange</a>++;
<a name="l00959"></a>00959   <span class="keywordflow">if</span> (memranges-&gt;<a class="code" href="structcollection__list.html#a720c32335aad94c3727ca92eef9988da">next_memrange</a> &gt;= memranges-&gt;<a class="code" href="structcollection__list.html#a6aeef96138cc7ff537aefd8b3698546d">listsize</a>)
<a name="l00960"></a>00960     {
<a name="l00961"></a>00961       memranges-&gt;<a class="code" href="structcollection__list.html#a6aeef96138cc7ff537aefd8b3698546d">listsize</a> *= 2;
<a name="l00962"></a>00962       memranges-&gt;<a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a> = <a class="code" href="common-utils_8c.html#af404b7244f442ce8c3069f31af566eae">xrealloc</a> (memranges-&gt;<a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a>,
<a name="l00963"></a>00963                                   memranges-&gt;<a class="code" href="structcollection__list.html#a6aeef96138cc7ff537aefd8b3698546d">listsize</a>);
<a name="l00964"></a>00964     }
<a name="l00965"></a>00965 
<a name="l00966"></a>00966   <span class="keywordflow">if</span> (type != <a class="code" href="tracepoint_8c.html#a85c7862086c1f92e4fb4108e176d8140a7a9e899080df0ea62d51c3dd27365865">memrange_absolute</a>)    <span class="comment">/* Better collect the base register!  */</span>
<a name="l00967"></a>00967     add_register (memranges, type);
<a name="l00968"></a>00968 }
<a name="l00969"></a>00969 
<a name="l00970"></a>00970 <span class="comment">/* Add a symbol to a collection list.  */</span>
<a name="l00971"></a>00971 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00972"></a>00972 collect_symbol (<span class="keyword">struct</span> <a class="code" href="structcollection__list.html">collection_list</a> *collect, 
<a name="l00973"></a>00973                 <span class="keyword">struct</span> <a class="code" href="structsymbol.html">symbol</a> *sym,
<a name="l00974"></a>00974                 <span class="keyword">struct</span> gdbarch *gdbarch,
<a name="l00975"></a>00975                 <span class="keywordtype">long</span> frame_regno, <span class="keywordtype">long</span> frame_offset,
<a name="l00976"></a>00976                 <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> scope,
<a name="l00977"></a>00977                 <span class="keywordtype">int</span> trace_string)
<a name="l00978"></a>00978 {
<a name="l00979"></a>00979   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>;
<a name="l00980"></a>00980   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="structreg.html">reg</a>;
<a name="l00981"></a>00981   bfd_signed_vma <a class="code" href="common_2agent_8c.html#aed7ea92f45bd273dde380a45ddced592">offset</a>;
<a name="l00982"></a>00982   <span class="keywordtype">int</span> treat_as_expr = 0;
<a name="l00983"></a>00983 
<a name="l00984"></a>00984   len = <a class="code" href="gdbtypes_8h.html#aeac33f868e763780094aec8a2dcb9a1a">TYPE_LENGTH</a> (<a class="code" href="gdbtypes_8c.html#a0bf29d7521d8a8b8735b9a259e380386">check_typedef</a> (<a class="code" href="symtab_8h.html#aadfeb02c4b5fc2b6764ad32eaccf0e58">SYMBOL_TYPE</a> (sym)));
<a name="l00985"></a>00985   <span class="keywordflow">switch</span> (<a class="code" href="symtab_8h.html#a8394f2ba6c27e8026b2783db7cc0eb40">SYMBOL_CLASS</a> (sym))
<a name="l00986"></a>00986     {
<a name="l00987"></a>00987     <span class="keywordflow">default</span>:
<a name="l00988"></a>00988       <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;%s: don&#39;t know symbol class %d\n&quot;</span>,
<a name="l00989"></a>00989                        <a class="code" href="symtab_8h.html#ac7f4cb1648125545fbd0e4f13b0c572c">SYMBOL_PRINT_NAME</a> (sym),
<a name="l00990"></a>00990                        <a class="code" href="symtab_8h.html#a8394f2ba6c27e8026b2783db7cc0eb40">SYMBOL_CLASS</a> (sym));
<a name="l00991"></a>00991       <span class="keywordflow">break</span>;
<a name="l00992"></a>00992     <span class="keywordflow">case</span> <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3a5268309778a6727d08106ff9f2966e54">LOC_CONST</a>:
<a name="l00993"></a>00993       <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;constant %s (value %s) will not be collected.\n&quot;</span>,
<a name="l00994"></a>00994                        <a class="code" href="symtab_8h.html#ac7f4cb1648125545fbd0e4f13b0c572c">SYMBOL_PRINT_NAME</a> (sym), <a class="code" href="utils_8c.html#a707b1023c85049b17b9d1ca01c58768a">plongest</a> (<a class="code" href="symtab_8h.html#a31840856d8e3eed18cbe9ca90cd2bf39">SYMBOL_VALUE</a> (sym)));
<a name="l00995"></a>00995       <span class="keywordflow">break</span>;
<a name="l00996"></a>00996     <span class="keywordflow">case</span> <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3a154b256439f7acd7ec7f6257d5881a0f">LOC_STATIC</a>:
<a name="l00997"></a>00997       offset = <a class="code" href="symtab_8h.html#abee697b9e3bb4f4d164ad920a87ab854">SYMBOL_VALUE_ADDRESS</a> (sym);
<a name="l00998"></a>00998       <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a3f2f91ed92de5dfaa6d27fb82822f8d5">info_verbose</a>)
<a name="l00999"></a>00999         {
<a name="l01000"></a>01000           <span class="keywordtype">char</span> tmp[40];
<a name="l01001"></a>01001 
<a name="l01002"></a>01002           sprintf_vma (tmp, offset);
<a name="l01003"></a>01003           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;LOC_STATIC %s: collect %ld bytes at %s.\n&quot;</span>,
<a name="l01004"></a>01004                            <a class="code" href="symtab_8h.html#ac7f4cb1648125545fbd0e4f13b0c572c">SYMBOL_PRINT_NAME</a> (sym), len,
<a name="l01005"></a>01005                            tmp <span class="comment">/* address */</span>);
<a name="l01006"></a>01006         }
<a name="l01007"></a>01007       <span class="comment">/* A struct may be a C++ class with static fields, go to general</span>
<a name="l01008"></a>01008 <span class="comment">         expression handling.  */</span>
<a name="l01009"></a>01009       <span class="keywordflow">if</span> (<a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (<a class="code" href="symtab_8h.html#aadfeb02c4b5fc2b6764ad32eaccf0e58">SYMBOL_TYPE</a> (sym)) == <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462af3b3fc76f66c95e12946c0ef84409365">TYPE_CODE_STRUCT</a>)
<a name="l01010"></a>01010         treat_as_expr = 1;
<a name="l01011"></a>01011       <span class="keywordflow">else</span>
<a name="l01012"></a>01012         add_memrange (collect, <a class="code" href="tracepoint_8c.html#a85c7862086c1f92e4fb4108e176d8140a7a9e899080df0ea62d51c3dd27365865">memrange_absolute</a>, offset, len);
<a name="l01013"></a>01013       <span class="keywordflow">break</span>;
<a name="l01014"></a>01014     <span class="keywordflow">case</span> <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3a2a9bcb7d8487d7ccb3858184340712e7">LOC_REGISTER</a>:
<a name="l01015"></a>01015       reg = <a class="code" href="symtab_8h.html#ac3bc5f478a60882fbe5c60f3d09a0d6e">SYMBOL_REGISTER_OPS</a> (sym)-&gt;register_number (sym, gdbarch);
<a name="l01016"></a>01016       <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a3f2f91ed92de5dfaa6d27fb82822f8d5">info_verbose</a>)
<a name="l01017"></a>01017         <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;LOC_REG[parm] %s: &quot;</span>, 
<a name="l01018"></a>01018                          <a class="code" href="symtab_8h.html#ac7f4cb1648125545fbd0e4f13b0c572c">SYMBOL_PRINT_NAME</a> (sym));
<a name="l01019"></a>01019       add_register (collect, reg);
<a name="l01020"></a>01020       <span class="comment">/* Check for doubles stored in two registers.  */</span>
<a name="l01021"></a>01021       <span class="comment">/* FIXME: how about larger types stored in 3 or more regs?  */</span>
<a name="l01022"></a>01022       <span class="keywordflow">if</span> (<a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (<a class="code" href="symtab_8h.html#aadfeb02c4b5fc2b6764ad32eaccf0e58">SYMBOL_TYPE</a> (sym)) == <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a98f3aa25f923ee0cd1d009e77b0a551a">TYPE_CODE_FLT</a> &amp;&amp;
<a name="l01023"></a>01023           len &gt; <a class="code" href="regcache_8c.html#a4c51fa25edb9ce25451b9dc7bd127aac">register_size</a> (gdbarch, reg))
<a name="l01024"></a>01024         add_register (collect, reg + 1);
<a name="l01025"></a>01025       <span class="keywordflow">break</span>;
<a name="l01026"></a>01026     <span class="keywordflow">case</span> <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3a3c444a41d837bee346e19072ca35f8d3">LOC_REF_ARG</a>:
<a name="l01027"></a>01027       <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;Sorry, don&#39;t know how to do LOC_REF_ARG yet.\n&quot;</span>);
<a name="l01028"></a>01028       <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;       (will not collect %s)\n&quot;</span>,
<a name="l01029"></a>01029                        <a class="code" href="symtab_8h.html#ac7f4cb1648125545fbd0e4f13b0c572c">SYMBOL_PRINT_NAME</a> (sym));
<a name="l01030"></a>01030       <span class="keywordflow">break</span>;
<a name="l01031"></a>01031     <span class="keywordflow">case</span> <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3affc89e823125f8ae758aee5fb913b308">LOC_ARG</a>:
<a name="l01032"></a>01032       reg = frame_regno;
<a name="l01033"></a>01033       offset = frame_offset + <a class="code" href="symtab_8h.html#a31840856d8e3eed18cbe9ca90cd2bf39">SYMBOL_VALUE</a> (sym);
<a name="l01034"></a>01034       <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a3f2f91ed92de5dfaa6d27fb82822f8d5">info_verbose</a>)
<a name="l01035"></a>01035         {
<a name="l01036"></a>01036           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;LOC_LOCAL %s: Collect %ld bytes at offset &quot;</span>,
<a name="l01037"></a>01037                            <a class="code" href="symtab_8h.html#ac7f4cb1648125545fbd0e4f13b0c572c">SYMBOL_PRINT_NAME</a> (sym), len);
<a name="l01038"></a>01038           printf_vma (offset);
<a name="l01039"></a>01039           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot; from frame ptr reg %d\n&quot;</span>, reg);
<a name="l01040"></a>01040         }
<a name="l01041"></a>01041       add_memrange (collect, reg, offset, len);
<a name="l01042"></a>01042       <span class="keywordflow">break</span>;
<a name="l01043"></a>01043     <span class="keywordflow">case</span> <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3ad9b13677899a4fbbd0f44f39726416e7">LOC_REGPARM_ADDR</a>:
<a name="l01044"></a>01044       reg = <a class="code" href="symtab_8h.html#a31840856d8e3eed18cbe9ca90cd2bf39">SYMBOL_VALUE</a> (sym);
<a name="l01045"></a>01045       offset = 0;
<a name="l01046"></a>01046       <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a3f2f91ed92de5dfaa6d27fb82822f8d5">info_verbose</a>)
<a name="l01047"></a>01047         {
<a name="l01048"></a>01048           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;LOC_REGPARM_ADDR %s: Collect %ld bytes at offset &quot;</span>,
<a name="l01049"></a>01049                            <a class="code" href="symtab_8h.html#ac7f4cb1648125545fbd0e4f13b0c572c">SYMBOL_PRINT_NAME</a> (sym), len);
<a name="l01050"></a>01050           printf_vma (offset);
<a name="l01051"></a>01051           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot; from reg %d\n&quot;</span>, reg);
<a name="l01052"></a>01052         }
<a name="l01053"></a>01053       add_memrange (collect, reg, offset, len);
<a name="l01054"></a>01054       <span class="keywordflow">break</span>;
<a name="l01055"></a>01055     <span class="keywordflow">case</span> <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3a495b83fa459ac0722b15a3e94afadbce">LOC_LOCAL</a>:
<a name="l01056"></a>01056       reg = frame_regno;
<a name="l01057"></a>01057       offset = frame_offset + <a class="code" href="symtab_8h.html#a31840856d8e3eed18cbe9ca90cd2bf39">SYMBOL_VALUE</a> (sym);
<a name="l01058"></a>01058       <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a3f2f91ed92de5dfaa6d27fb82822f8d5">info_verbose</a>)
<a name="l01059"></a>01059         {
<a name="l01060"></a>01060           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;LOC_LOCAL %s: Collect %ld bytes at offset &quot;</span>,
<a name="l01061"></a>01061                            <a class="code" href="symtab_8h.html#ac7f4cb1648125545fbd0e4f13b0c572c">SYMBOL_PRINT_NAME</a> (sym), len);
<a name="l01062"></a>01062           printf_vma (offset);
<a name="l01063"></a>01063           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot; from frame ptr reg %d\n&quot;</span>, reg);
<a name="l01064"></a>01064         }
<a name="l01065"></a>01065       add_memrange (collect, reg, offset, len);
<a name="l01066"></a>01066       <span class="keywordflow">break</span>;
<a name="l01067"></a>01067 
<a name="l01068"></a>01068     <span class="keywordflow">case</span> <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3a3d61e7ad56c95328fba05416abc73f7a">LOC_UNRESOLVED</a>:
<a name="l01069"></a>01069       treat_as_expr = 1;
<a name="l01070"></a>01070       <span class="keywordflow">break</span>;
<a name="l01071"></a>01071 
<a name="l01072"></a>01072     <span class="keywordflow">case</span> <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3aa4f37f80c900ee253911325c30b8a60f">LOC_OPTIMIZED_OUT</a>:
<a name="l01073"></a>01073       <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;%s has been optimized out of existence.\n&quot;</span>,
<a name="l01074"></a>01074                        <a class="code" href="symtab_8h.html#ac7f4cb1648125545fbd0e4f13b0c572c">SYMBOL_PRINT_NAME</a> (sym));
<a name="l01075"></a>01075       <span class="keywordflow">break</span>;
<a name="l01076"></a>01076 
<a name="l01077"></a>01077     <span class="keywordflow">case</span> <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3afd4303a25cda7805900ce8212c67ed45">LOC_COMPUTED</a>:
<a name="l01078"></a>01078       treat_as_expr = 1;
<a name="l01079"></a>01079       <span class="keywordflow">break</span>;
<a name="l01080"></a>01080     }
<a name="l01081"></a>01081 
<a name="l01082"></a>01082   <span class="comment">/* Expressions are the most general case.  */</span>
<a name="l01083"></a>01083   <span class="keywordflow">if</span> (treat_as_expr)
<a name="l01084"></a>01084     {
<a name="l01085"></a>01085       <span class="keyword">struct </span><a class="code" href="structagent__expr.html">agent_expr</a> *aexpr;
<a name="l01086"></a>01086       <span class="keyword">struct </span>cleanup *old_chain1 = NULL;
<a name="l01087"></a>01087 
<a name="l01088"></a>01088       aexpr = <a class="code" href="ax-gdb_8c.html#ab4b50cfc36d04665b05d8e804aea40f0">gen_trace_for_var</a> (scope, gdbarch, sym, trace_string);
<a name="l01089"></a>01089 
<a name="l01090"></a>01090       <span class="comment">/* It can happen that the symbol is recorded as a computed</span>
<a name="l01091"></a>01091 <span class="comment">         location, but it&#39;s been optimized away and doesn&#39;t actually</span>
<a name="l01092"></a>01092 <span class="comment">         have a location expression.  */</span>
<a name="l01093"></a>01093       <span class="keywordflow">if</span> (!aexpr)
<a name="l01094"></a>01094         {
<a name="l01095"></a>01095           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;%s has been optimized out of existence.\n&quot;</span>,
<a name="l01096"></a>01096                            <a class="code" href="symtab_8h.html#ac7f4cb1648125545fbd0e4f13b0c572c">SYMBOL_PRINT_NAME</a> (sym));
<a name="l01097"></a>01097           <span class="keywordflow">return</span>;
<a name="l01098"></a>01098         }
<a name="l01099"></a>01099 
<a name="l01100"></a>01100       old_chain1 = <a class="code" href="ax-general_8c.html#a2cf2dd0ae1eb22eb70a968683d272624">make_cleanup_free_agent_expr</a> (aexpr);
<a name="l01101"></a>01101 
<a name="l01102"></a>01102       <a class="code" href="ax-general_8c.html#a2ef11cd336a163ef64356b65550324b1">ax_reqs</a> (aexpr);
<a name="l01103"></a>01103 
<a name="l01104"></a>01104       report_agent_reqs_errors (aexpr);
<a name="l01105"></a>01105 
<a name="l01106"></a>01106       <a class="code" href="cleanups_8c.html#a5ec3987bf995edcc44def9e17ada6eba">discard_cleanups</a> (old_chain1);
<a name="l01107"></a>01107       add_aexpr (collect, aexpr);
<a name="l01108"></a>01108 
<a name="l01109"></a>01109       <span class="comment">/* Take care of the registers.  */</span>
<a name="l01110"></a>01110       <span class="keywordflow">if</span> (aexpr-&gt;<a class="code" href="structagent__expr.html#ab46c966a53bb27d58770e8e27f34665f">reg_mask_len</a> &gt; 0)
<a name="l01111"></a>01111         {
<a name="l01112"></a>01112           <span class="keywordtype">int</span> ndx1, ndx2;
<a name="l01113"></a>01113 
<a name="l01114"></a>01114           <span class="keywordflow">for</span> (ndx1 = 0; ndx1 &lt; aexpr-&gt;<a class="code" href="structagent__expr.html#ab46c966a53bb27d58770e8e27f34665f">reg_mask_len</a>; ndx1++)
<a name="l01115"></a>01115             {
<a name="l01116"></a>01116               <a class="code" href="defs_8h.html#ad24e2b54375e12474e65ebf7175988fb">QUIT</a>;     <span class="comment">/* Allow user to bail out with ^C.  */</span>
<a name="l01117"></a>01117               <span class="keywordflow">if</span> (aexpr-&gt;<a class="code" href="structagent__expr.html#a7ad4afed8f827080a5e063e45f888038">reg_mask</a>[ndx1] != 0)
<a name="l01118"></a>01118                 {
<a name="l01119"></a>01119                   <span class="comment">/* Assume chars have 8 bits.  */</span>
<a name="l01120"></a>01120                   <span class="keywordflow">for</span> (ndx2 = 0; ndx2 &lt; 8; ndx2++)
<a name="l01121"></a>01121                     <span class="keywordflow">if</span> (aexpr-&gt;<a class="code" href="structagent__expr.html#a7ad4afed8f827080a5e063e45f888038">reg_mask</a>[ndx1] &amp; (1 &lt;&lt; ndx2))
<a name="l01122"></a>01122                       <span class="comment">/* It&#39;s used -- record it.  */</span>
<a name="l01123"></a>01123                       add_register (collect, ndx1 * 8 + ndx2);
<a name="l01124"></a>01124                 }
<a name="l01125"></a>01125             }
<a name="l01126"></a>01126         }
<a name="l01127"></a>01127     }
<a name="l01128"></a>01128 }
<a name="l01129"></a>01129 
<a name="l01130"></a>01130 <span class="comment">/* Data to be passed around in the calls to the locals and args</span>
<a name="l01131"></a>01131 <span class="comment">   iterators.  */</span>
<a name="l01132"></a>01132 
<a name="l01133"></a>01133 <span class="keyword">struct </span>add_local_symbols_data
<a name="l01134"></a>01134 {
<a name="l01135"></a>01135   <span class="keyword">struct </span><a class="code" href="structcollection__list.html">collection_list</a> *collect;
<a name="l01136"></a>01136   <span class="keyword">struct </span>gdbarch *gdbarch;
<a name="l01137"></a>01137   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> pc;
<a name="l01138"></a>01138   <span class="keywordtype">long</span> frame_regno;
<a name="l01139"></a>01139   <span class="keywordtype">long</span> frame_offset;
<a name="l01140"></a>01140   <span class="keywordtype">int</span> count;
<a name="l01141"></a>01141   <span class="keywordtype">int</span> trace_string;
<a name="l01142"></a>01142 };
<a name="l01143"></a>01143 
<a name="l01144"></a>01144 <span class="comment">/* The callback for the locals and args iterators.  */</span>
<a name="l01145"></a>01145 
<a name="l01146"></a>01146 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01147"></a>01147 do_collect_symbol (<span class="keyword">const</span> <span class="keywordtype">char</span> *print_name,
<a name="l01148"></a>01148                    <span class="keyword">struct</span> <a class="code" href="structsymbol.html">symbol</a> *sym,
<a name="l01149"></a>01149                    <span class="keywordtype">void</span> *cb_data)
<a name="l01150"></a>01150 {
<a name="l01151"></a>01151   <span class="keyword">struct </span>add_local_symbols_data *p = cb_data;
<a name="l01152"></a>01152 
<a name="l01153"></a>01153   collect_symbol (p-&gt;collect, sym, p-&gt;gdbarch, p-&gt;frame_regno,
<a name="l01154"></a>01154                   p-&gt;frame_offset, p-&gt;pc, p-&gt;trace_string);
<a name="l01155"></a>01155   p-&gt;count++;
<a name="l01156"></a>01156 
<a name="l01157"></a>01157   <a class="code" href="vec_8h.html#a8d090c0524726d00931070e0c438ba3f">VEC_safe_push</a> (<a class="code" href="gdb__vecs_8h.html#a5ea7d3fefa2144d9bddaf2053c9691a1">char_ptr</a>, p-&gt;collect-&gt;wholly_collected,
<a name="l01158"></a>01158                  xstrdup (print_name));
<a name="l01159"></a>01159 }
<a name="l01160"></a>01160 
<a name="l01161"></a>01161 <span class="comment">/* Add all locals (or args) symbols to collection list.  */</span>
<a name="l01162"></a>01162 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01163"></a>01163 add_local_symbols (<span class="keyword">struct</span> <a class="code" href="structcollection__list.html">collection_list</a> *collect,
<a name="l01164"></a>01164                    <span class="keyword">struct</span> gdbarch *gdbarch, <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> pc,
<a name="l01165"></a>01165                    <span class="keywordtype">long</span> frame_regno, <span class="keywordtype">long</span> frame_offset, <span class="keywordtype">int</span> type,
<a name="l01166"></a>01166                    <span class="keywordtype">int</span> trace_string)
<a name="l01167"></a>01167 {
<a name="l01168"></a>01168   <span class="keyword">struct </span><a class="code" href="structblock.html">block</a> *<a class="code" href="structblock.html">block</a>;
<a name="l01169"></a>01169   <span class="keyword">struct </span>add_local_symbols_data cb_data;
<a name="l01170"></a>01170 
<a name="l01171"></a>01171   cb_data.collect = collect;
<a name="l01172"></a>01172   cb_data.gdbarch = gdbarch;
<a name="l01173"></a>01173   cb_data.pc = pc;
<a name="l01174"></a>01174   cb_data.frame_regno = frame_regno;
<a name="l01175"></a>01175   cb_data.frame_offset = frame_offset;
<a name="l01176"></a>01176   cb_data.count = 0;
<a name="l01177"></a>01177   cb_data.trace_string = trace_string;
<a name="l01178"></a>01178 
<a name="l01179"></a>01179   <span class="keywordflow">if</span> (type == <span class="charliteral">&#39;L&#39;</span>)
<a name="l01180"></a>01180     {
<a name="l01181"></a>01181       block = <a class="code" href="block_8c.html#a35aadf82f92cb4a47ec068dba0e1b36c">block_for_pc</a> (pc);
<a name="l01182"></a>01182       <span class="keywordflow">if</span> (block == NULL)
<a name="l01183"></a>01183         {
<a name="l01184"></a>01184           <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Can&#39;t collect locals; &quot;</span>
<a name="l01185"></a>01185                      <span class="stringliteral">&quot;no symbol table info available.\n&quot;</span>));
<a name="l01186"></a>01186           <span class="keywordflow">return</span>;
<a name="l01187"></a>01187         }
<a name="l01188"></a>01188 
<a name="l01189"></a>01189       <a class="code" href="stack_8c.html#aa9d8f435229d0ef264cb672657d46db5">iterate_over_block_local_vars</a> (block, do_collect_symbol, &amp;cb_data);
<a name="l01190"></a>01190       <span class="keywordflow">if</span> (cb_data.count == 0)
<a name="l01191"></a>01191         <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No locals found in scope.&quot;</span>));
<a name="l01192"></a>01192     }
<a name="l01193"></a>01193   <span class="keywordflow">else</span>
<a name="l01194"></a>01194     {
<a name="l01195"></a>01195       pc = <a class="code" href="blockframe_8c.html#a5f755befa096231f25bf9c0f7ce5a7c2">get_pc_function_start</a> (pc);
<a name="l01196"></a>01196       block = <a class="code" href="block_8c.html#a35aadf82f92cb4a47ec068dba0e1b36c">block_for_pc</a> (pc);
<a name="l01197"></a>01197       <span class="keywordflow">if</span> (block == NULL)
<a name="l01198"></a>01198         {
<a name="l01199"></a>01199           <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Can&#39;t collect args; no symbol table info available.&quot;</span>));
<a name="l01200"></a>01200           <span class="keywordflow">return</span>;
<a name="l01201"></a>01201         }
<a name="l01202"></a>01202 
<a name="l01203"></a>01203       <a class="code" href="stack_8c.html#a0dbcc369048c01fee5b2c916e751a2ad">iterate_over_block_arg_vars</a> (block, do_collect_symbol, &amp;cb_data);
<a name="l01204"></a>01204       <span class="keywordflow">if</span> (cb_data.count == 0)
<a name="l01205"></a>01205         <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No args found in scope.&quot;</span>));
<a name="l01206"></a>01206     }
<a name="l01207"></a>01207 }
<a name="l01208"></a>01208 
<a name="l01209"></a>01209 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01210"></a>01210 add_static_trace_data (<span class="keyword">struct</span> <a class="code" href="structcollection__list.html">collection_list</a> *collection)
<a name="l01211"></a>01211 {
<a name="l01212"></a>01212   <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a3f2f91ed92de5dfaa6d27fb82822f8d5">info_verbose</a>)
<a name="l01213"></a>01213     <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;collect static trace data\n&quot;</span>);
<a name="l01214"></a>01214   collection-&gt;<a class="code" href="structcollection__list.html#ad6a2639b007dfb0bad703dd1566e148c">strace_data</a> = 1;
<a name="l01215"></a>01215 }
<a name="l01216"></a>01216 
<a name="l01217"></a>01217 <span class="comment">/* worker function */</span>
<a name="l01218"></a>01218 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01219"></a>01219 clear_collection_list (<span class="keyword">struct</span> <a class="code" href="structcollection__list.html">collection_list</a> *list)
<a name="l01220"></a>01220 {
<a name="l01221"></a>01221   <span class="keywordtype">int</span> ndx;
<a name="l01222"></a>01222 
<a name="l01223"></a>01223   list-&gt;<a class="code" href="structcollection__list.html#a720c32335aad94c3727ca92eef9988da">next_memrange</a> = 0;
<a name="l01224"></a>01224   <span class="keywordflow">for</span> (ndx = 0; ndx &lt; list-&gt;<a class="code" href="structcollection__list.html#a5f9c0ec40e11e47a8b62c9b8cdb70d73">next_aexpr_elt</a>; ndx++)
<a name="l01225"></a>01225     {
<a name="l01226"></a>01226       <a class="code" href="ax-general_8c.html#a212888d48dd043f9a37823fb799cd8e4">free_agent_expr</a> (list-&gt;<a class="code" href="structcollection__list.html#a02fd38610fd4357ec9856bd4c816a541">aexpr_list</a>[ndx]);
<a name="l01227"></a>01227       list-&gt;<a class="code" href="structcollection__list.html#a02fd38610fd4357ec9856bd4c816a541">aexpr_list</a>[ndx] = NULL;
<a name="l01228"></a>01228     }
<a name="l01229"></a>01229   list-&gt;<a class="code" href="structcollection__list.html#a5f9c0ec40e11e47a8b62c9b8cdb70d73">next_aexpr_elt</a> = 0;
<a name="l01230"></a>01230   <a class="code" href="gdb__string_8h.html#adb03df3679ce1445e801310614624ccb">memset</a> (list-&gt;<a class="code" href="structcollection__list.html#af703b3c6497023d7e6f7e81dbb5d9943">regs_mask</a>, 0, sizeof (list-&gt;<a class="code" href="structcollection__list.html#af703b3c6497023d7e6f7e81dbb5d9943">regs_mask</a>));
<a name="l01231"></a>01231   list-&gt;<a class="code" href="structcollection__list.html#ad6a2639b007dfb0bad703dd1566e148c">strace_data</a> = 0;
<a name="l01232"></a>01232 
<a name="l01233"></a>01233   <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (list-&gt;<a class="code" href="structcollection__list.html#a02fd38610fd4357ec9856bd4c816a541">aexpr_list</a>);
<a name="l01234"></a>01234   <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (list-&gt;<a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a>);
<a name="l01235"></a>01235 
<a name="l01236"></a>01236   <a class="code" href="vec_8h.html#af5724b2bbce65103300279f9abe7f577">VEC_free</a> (<a class="code" href="gdb__vecs_8h.html#a5ea7d3fefa2144d9bddaf2053c9691a1">char_ptr</a>, list-&gt;wholly_collected);
<a name="l01237"></a>01237   <a class="code" href="vec_8h.html#af5724b2bbce65103300279f9abe7f577">VEC_free</a> (<a class="code" href="gdb__vecs_8h.html#a5ea7d3fefa2144d9bddaf2053c9691a1">char_ptr</a>, list-&gt;computed);
<a name="l01238"></a>01238 }
<a name="l01239"></a>01239 
<a name="l01240"></a>01240 <span class="comment">/* A cleanup wrapper for function clear_collection_list.  */</span>
<a name="l01241"></a>01241 
<a name="l01242"></a>01242 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01243"></a>01243 do_clear_collection_list (<span class="keywordtype">void</span> *list)
<a name="l01244"></a>01244 {
<a name="l01245"></a>01245   <span class="keyword">struct </span><a class="code" href="structcollection__list.html">collection_list</a> *l = <a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a>;
<a name="l01246"></a>01246 
<a name="l01247"></a>01247   clear_collection_list (l);
<a name="l01248"></a>01248 }
<a name="l01249"></a>01249 
<a name="l01250"></a>01250 <span class="comment">/* Initialize collection_list CLIST.  */</span>
<a name="l01251"></a>01251 
<a name="l01252"></a>01252 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01253"></a>01253 init_collection_list (<span class="keyword">struct</span> <a class="code" href="structcollection__list.html">collection_list</a> *clist)
<a name="l01254"></a>01254 {
<a name="l01255"></a>01255   <a class="code" href="gdb__string_8h.html#adb03df3679ce1445e801310614624ccb">memset</a> (clist, 0, <span class="keyword">sizeof</span> *clist);
<a name="l01256"></a>01256 
<a name="l01257"></a>01257   clist-&gt;<a class="code" href="structcollection__list.html#a6aeef96138cc7ff537aefd8b3698546d">listsize</a> = 128;
<a name="l01258"></a>01258   clist-&gt;<a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a> = <a class="code" href="common-utils_8c.html#a05a0a3435b91a07d6cc1a0b4c8788a4d">xcalloc</a> (clist-&gt;<a class="code" href="structcollection__list.html#a6aeef96138cc7ff537aefd8b3698546d">listsize</a>,
<a name="l01259"></a>01259                          sizeof (<span class="keyword">struct</span> <a class="code" href="structmemrange.html">memrange</a>));
<a name="l01260"></a>01260 
<a name="l01261"></a>01261   clist-&gt;<a class="code" href="structcollection__list.html#a86fe1ff3522827ed3ef2187f5f763622">aexpr_listsize</a> = 128;
<a name="l01262"></a>01262   clist-&gt;<a class="code" href="structcollection__list.html#a02fd38610fd4357ec9856bd4c816a541">aexpr_list</a> = <a class="code" href="common-utils_8c.html#a05a0a3435b91a07d6cc1a0b4c8788a4d">xcalloc</a> (clist-&gt;<a class="code" href="structcollection__list.html#a86fe1ff3522827ed3ef2187f5f763622">aexpr_listsize</a>,
<a name="l01263"></a>01263                                sizeof (<span class="keyword">struct</span> <a class="code" href="structagent__expr.html">agent_expr</a> *));
<a name="l01264"></a>01264 }
<a name="l01265"></a>01265 
<a name="l01266"></a>01266 <span class="comment">/* Reduce a collection list to string form (for gdb protocol).  */</span>
<a name="l01267"></a>01267 <span class="keyword">static</span> <span class="keywordtype">char</span> **
<a name="l01268"></a>01268 stringify_collection_list (<span class="keyword">struct</span> <a class="code" href="structcollection__list.html">collection_list</a> *list)
<a name="l01269"></a>01269 {
<a name="l01270"></a>01270   <span class="keywordtype">char</span> temp_buf[2048];
<a name="l01271"></a>01271   <span class="keywordtype">char</span> tmp2[40];
<a name="l01272"></a>01272   <span class="keywordtype">int</span> count;
<a name="l01273"></a>01273   <span class="keywordtype">int</span> ndx = 0;
<a name="l01274"></a>01274   <span class="keywordtype">char</span> *(*str_list)[];
<a name="l01275"></a>01275   <span class="keywordtype">char</span> *end;
<a name="l01276"></a>01276   <span class="keywordtype">long</span> i;
<a name="l01277"></a>01277 
<a name="l01278"></a>01278   count = 1 + 1 + list-&gt;<a class="code" href="structcollection__list.html#a720c32335aad94c3727ca92eef9988da">next_memrange</a> + list-&gt;<a class="code" href="structcollection__list.html#a5f9c0ec40e11e47a8b62c9b8cdb70d73">next_aexpr_elt</a> + 1;
<a name="l01279"></a>01279   str_list = (<span class="keywordtype">char</span> *(*)[]) <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (count * <span class="keyword">sizeof</span> (<span class="keywordtype">char</span> *));
<a name="l01280"></a>01280 
<a name="l01281"></a>01281   <span class="keywordflow">if</span> (list-&gt;<a class="code" href="structcollection__list.html#ad6a2639b007dfb0bad703dd1566e148c">strace_data</a>)
<a name="l01282"></a>01282     {
<a name="l01283"></a>01283       <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a3f2f91ed92de5dfaa6d27fb82822f8d5">info_verbose</a>)
<a name="l01284"></a>01284         <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;\nCollecting static trace data\n&quot;</span>);
<a name="l01285"></a>01285       end = temp_buf;
<a name="l01286"></a>01286       *end++ = <span class="charliteral">&#39;L&#39;</span>;
<a name="l01287"></a>01287       (*str_list)[ndx] = <a class="code" href="common-utils_8c.html#a5f388f89054b57d850779d7d71bc4d1c">savestring</a> (temp_buf, end - temp_buf);
<a name="l01288"></a>01288       ndx++;
<a name="l01289"></a>01289     }
<a name="l01290"></a>01290 
<a name="l01291"></a>01291   <span class="keywordflow">for</span> (i = <span class="keyword">sizeof</span> (list-&gt;<a class="code" href="structcollection__list.html#af703b3c6497023d7e6f7e81dbb5d9943">regs_mask</a>) - 1; i &gt; 0; i--)
<a name="l01292"></a>01292     <span class="keywordflow">if</span> (list-&gt;<a class="code" href="structcollection__list.html#af703b3c6497023d7e6f7e81dbb5d9943">regs_mask</a>[i] != 0)    <span class="comment">/* Skip leading zeroes in regs_mask.  */</span>
<a name="l01293"></a>01293       <span class="keywordflow">break</span>;
<a name="l01294"></a>01294   <span class="keywordflow">if</span> (list-&gt;<a class="code" href="structcollection__list.html#af703b3c6497023d7e6f7e81dbb5d9943">regs_mask</a>[i] != 0)  <span class="comment">/* Prepare to send regs_mask to the stub.  */</span>
<a name="l01295"></a>01295     {
<a name="l01296"></a>01296       <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a3f2f91ed92de5dfaa6d27fb82822f8d5">info_verbose</a>)
<a name="l01297"></a>01297         <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;\nCollecting registers (mask): 0x&quot;</span>);
<a name="l01298"></a>01298       end = temp_buf;
<a name="l01299"></a>01299       *end++ = <span class="charliteral">&#39;R&#39;</span>;
<a name="l01300"></a>01300       <span class="keywordflow">for</span> (; i &gt;= 0; i--)
<a name="l01301"></a>01301         {
<a name="l01302"></a>01302           <a class="code" href="defs_8h.html#ad24e2b54375e12474e65ebf7175988fb">QUIT</a>;                 <span class="comment">/* Allow user to bail out with ^C.  */</span>
<a name="l01303"></a>01303           <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a3f2f91ed92de5dfaa6d27fb82822f8d5">info_verbose</a>)
<a name="l01304"></a>01304             <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;%02X&quot;</span>, list-&gt;<a class="code" href="structcollection__list.html#af703b3c6497023d7e6f7e81dbb5d9943">regs_mask</a>[i]);
<a name="l01305"></a>01305           sprintf (end, <span class="stringliteral">&quot;%02X&quot;</span>, list-&gt;<a class="code" href="structcollection__list.html#af703b3c6497023d7e6f7e81dbb5d9943">regs_mask</a>[i]);
<a name="l01306"></a>01306           end += 2;
<a name="l01307"></a>01307         }
<a name="l01308"></a>01308       (*str_list)[ndx] = xstrdup (temp_buf);
<a name="l01309"></a>01309       ndx++;
<a name="l01310"></a>01310     }
<a name="l01311"></a>01311   <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a3f2f91ed92de5dfaa6d27fb82822f8d5">info_verbose</a>)
<a name="l01312"></a>01312     <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l01313"></a>01313   <span class="keywordflow">if</span> (list-&gt;<a class="code" href="structcollection__list.html#a720c32335aad94c3727ca92eef9988da">next_memrange</a> &gt; 0 &amp;&amp; <a class="code" href="defs_8h.html#a3f2f91ed92de5dfaa6d27fb82822f8d5">info_verbose</a>)
<a name="l01314"></a>01314     <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;Collecting memranges: \n&quot;</span>);
<a name="l01315"></a>01315   <span class="keywordflow">for</span> (i = 0, count = 0, end = temp_buf; i &lt; list-&gt;<a class="code" href="structcollection__list.html#a720c32335aad94c3727ca92eef9988da">next_memrange</a>; i++)
<a name="l01316"></a>01316     {
<a name="l01317"></a>01317       <a class="code" href="defs_8h.html#ad24e2b54375e12474e65ebf7175988fb">QUIT</a>;                     <span class="comment">/* Allow user to bail out with ^C.  */</span>
<a name="l01318"></a>01318       sprintf_vma (tmp2, list-&gt;<a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a>[i].<a class="code" href="structmemrange.html#ab49addc5247b1d10d204e1246ad78cdc">start</a>);
<a name="l01319"></a>01319       <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a3f2f91ed92de5dfaa6d27fb82822f8d5">info_verbose</a>)
<a name="l01320"></a>01320         {
<a name="l01321"></a>01321           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;(%d, %s, %ld)\n&quot;</span>, 
<a name="l01322"></a>01322                            list-&gt;<a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a>[i].<a class="code" href="structmemrange.html#acaecdd7e2c0f680a6ea9306249acd488">type</a>, 
<a name="l01323"></a>01323                            tmp2, 
<a name="l01324"></a>01324                            (<span class="keywordtype">long</span>) (list-&gt;<a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a>[i].<a class="code" href="structmemrange.html#aa178709d97e905b15468e30f62684edb">end</a> - list-&gt;<a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a>[i].<a class="code" href="structmemrange.html#ab49addc5247b1d10d204e1246ad78cdc">start</a>));
<a name="l01325"></a>01325         }
<a name="l01326"></a>01326       <span class="keywordflow">if</span> (count + 27 &gt; <a class="code" href="tracepoint_8c.html#acf5177f8e0c8de5667b3aaa539373e4c">MAX_AGENT_EXPR_LEN</a>)
<a name="l01327"></a>01327         {
<a name="l01328"></a>01328           (*str_list)[ndx] = <a class="code" href="common-utils_8c.html#a5f388f89054b57d850779d7d71bc4d1c">savestring</a> (temp_buf, count);
<a name="l01329"></a>01329           ndx++;
<a name="l01330"></a>01330           count = 0;
<a name="l01331"></a>01331           end = temp_buf;
<a name="l01332"></a>01332         }
<a name="l01333"></a>01333 
<a name="l01334"></a>01334       {
<a name="l01335"></a>01335         bfd_signed_vma length = list-&gt;<a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a>[i].<a class="code" href="structmemrange.html#aa178709d97e905b15468e30f62684edb">end</a> - list-&gt;<a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a>[i].<a class="code" href="structmemrange.html#ab49addc5247b1d10d204e1246ad78cdc">start</a>;
<a name="l01336"></a>01336 
<a name="l01337"></a>01337         <span class="comment">/* The &quot;%X&quot; conversion specifier expects an unsigned argument,</span>
<a name="l01338"></a>01338 <span class="comment">           so passing -1 (memrange_absolute) to it directly gives you</span>
<a name="l01339"></a>01339 <span class="comment">           &quot;FFFFFFFF&quot; (or more, depending on sizeof (unsigned)).</span>
<a name="l01340"></a>01340 <span class="comment">           Special-case it.  */</span>
<a name="l01341"></a>01341         <span class="keywordflow">if</span> (list-&gt;<a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a>[i].<a class="code" href="structmemrange.html#acaecdd7e2c0f680a6ea9306249acd488">type</a> == <a class="code" href="tracepoint_8c.html#a85c7862086c1f92e4fb4108e176d8140a7a9e899080df0ea62d51c3dd27365865">memrange_absolute</a>)
<a name="l01342"></a>01342           sprintf (end, <span class="stringliteral">&quot;M-1,%s,%lX&quot;</span>, tmp2, (<span class="keywordtype">long</span>) length);
<a name="l01343"></a>01343         <span class="keywordflow">else</span>
<a name="l01344"></a>01344           sprintf (end, <span class="stringliteral">&quot;M%X,%s,%lX&quot;</span>, list-&gt;<a class="code" href="structcollection__list.html#a6328b6644851c31100f24c56d15a795b">list</a>[i].<a class="code" href="structmemrange.html#acaecdd7e2c0f680a6ea9306249acd488">type</a>, tmp2, (<span class="keywordtype">long</span>) length);
<a name="l01345"></a>01345       }
<a name="l01346"></a>01346 
<a name="l01347"></a>01347       count += strlen (end);
<a name="l01348"></a>01348       end = temp_buf + count;
<a name="l01349"></a>01349     }
<a name="l01350"></a>01350 
<a name="l01351"></a>01351   <span class="keywordflow">for</span> (i = 0; i &lt; list-&gt;<a class="code" href="structcollection__list.html#a5f9c0ec40e11e47a8b62c9b8cdb70d73">next_aexpr_elt</a>; i++)
<a name="l01352"></a>01352     {
<a name="l01353"></a>01353       <a class="code" href="defs_8h.html#ad24e2b54375e12474e65ebf7175988fb">QUIT</a>;                     <span class="comment">/* Allow user to bail out with ^C.  */</span>
<a name="l01354"></a>01354       <span class="keywordflow">if</span> ((count + 10 + 2 * list-&gt;<a class="code" href="structcollection__list.html#a02fd38610fd4357ec9856bd4c816a541">aexpr_list</a>[i]-&gt;<a class="code" href="structagent__expr.html#af6a2128d2dba09337f21cd20b09571da">len</a>) &gt; <a class="code" href="tracepoint_8c.html#acf5177f8e0c8de5667b3aaa539373e4c">MAX_AGENT_EXPR_LEN</a>)
<a name="l01355"></a>01355         {
<a name="l01356"></a>01356           (*str_list)[ndx] = <a class="code" href="common-utils_8c.html#a5f388f89054b57d850779d7d71bc4d1c">savestring</a> (temp_buf, count);
<a name="l01357"></a>01357           ndx++;
<a name="l01358"></a>01358           count = 0;
<a name="l01359"></a>01359           end = temp_buf;
<a name="l01360"></a>01360         }
<a name="l01361"></a>01361       sprintf (end, <span class="stringliteral">&quot;X%08X,&quot;</span>, list-&gt;<a class="code" href="structcollection__list.html#a02fd38610fd4357ec9856bd4c816a541">aexpr_list</a>[i]-&gt;<a class="code" href="structagent__expr.html#af6a2128d2dba09337f21cd20b09571da">len</a>);
<a name="l01362"></a>01362       end += 10;                <span class="comment">/* &#39;X&#39; + 8 hex digits + &#39;,&#39; */</span>
<a name="l01363"></a>01363       count += 10;
<a name="l01364"></a>01364 
<a name="l01365"></a>01365       end = mem2hex (list-&gt;<a class="code" href="structcollection__list.html#a02fd38610fd4357ec9856bd4c816a541">aexpr_list</a>[i]-&gt;<a class="code" href="structagent__expr.html#a50e2d1e60382446b6bbd043e7de95c86">buf</a>, 
<a name="l01366"></a>01366                      end, list-&gt;<a class="code" href="structcollection__list.html#a02fd38610fd4357ec9856bd4c816a541">aexpr_list</a>[i]-&gt;<a class="code" href="structagent__expr.html#af6a2128d2dba09337f21cd20b09571da">len</a>);
<a name="l01367"></a>01367       count += 2 * list-&gt;<a class="code" href="structcollection__list.html#a02fd38610fd4357ec9856bd4c816a541">aexpr_list</a>[i]-&gt;<a class="code" href="structagent__expr.html#af6a2128d2dba09337f21cd20b09571da">len</a>;
<a name="l01368"></a>01368     }
<a name="l01369"></a>01369 
<a name="l01370"></a>01370   <span class="keywordflow">if</span> (count != 0)
<a name="l01371"></a>01371     {
<a name="l01372"></a>01372       (*str_list)[ndx] = <a class="code" href="common-utils_8c.html#a5f388f89054b57d850779d7d71bc4d1c">savestring</a> (temp_buf, count);
<a name="l01373"></a>01373       ndx++;
<a name="l01374"></a>01374       count = 0;
<a name="l01375"></a>01375       end = temp_buf;
<a name="l01376"></a>01376     }
<a name="l01377"></a>01377   (*str_list)[ndx] = NULL;
<a name="l01378"></a>01378 
<a name="l01379"></a>01379   <span class="keywordflow">if</span> (ndx == 0)
<a name="l01380"></a>01380     {
<a name="l01381"></a>01381       <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (str_list);
<a name="l01382"></a>01382       <span class="keywordflow">return</span> NULL;
<a name="l01383"></a>01383     }
<a name="l01384"></a>01384   <span class="keywordflow">else</span>
<a name="l01385"></a>01385     <span class="keywordflow">return</span> *str_list;
<a name="l01386"></a>01386 }
<a name="l01387"></a>01387 
<a name="l01388"></a>01388 <span class="comment">/* Add the printed expression EXP to *LIST.  */</span>
<a name="l01389"></a>01389 
<a name="l01390"></a>01390 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01391"></a>01391 append_exp (<span class="keyword">struct</span> <a class="code" href="structexpression.html">expression</a> *exp, <a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a>(<a class="code" href="gdb__vecs_8h.html#a5ea7d3fefa2144d9bddaf2053c9691a1">char_ptr</a>) **list)
<a name="l01392"></a>01392 {
<a name="l01393"></a>01393   <span class="keyword">struct </span>ui_file *tmp_stream = <a class="code" href="ui-file_8c.html#a340771735f105582d314e191a399a45c">mem_fileopen</a> ();
<a name="l01394"></a>01394   <span class="keywordtype">char</span> *text;
<a name="l01395"></a>01395 
<a name="l01396"></a>01396   <a class="code" href="expprint_8c.html#a21bbf2917d79d588fb9057b031aeb484">print_expression</a> (exp, tmp_stream);
<a name="l01397"></a>01397 
<a name="l01398"></a>01398   text = <a class="code" href="ui-file_8c.html#a995485039ce5a1d994a1863cd76a5356">ui_file_xstrdup</a> (tmp_stream, NULL);
<a name="l01399"></a>01399 
<a name="l01400"></a>01400   <a class="code" href="vec_8h.html#a8d090c0524726d00931070e0c438ba3f">VEC_safe_push</a> (<a class="code" href="gdb__vecs_8h.html#a5ea7d3fefa2144d9bddaf2053c9691a1">char_ptr</a>, *list, text);
<a name="l01401"></a>01401   <a class="code" href="ui-file_8c.html#a17fda20af14c0187cbda770d4eb2777b">ui_file_delete</a> (tmp_stream);
<a name="l01402"></a>01402 }
<a name="l01403"></a>01403 
<a name="l01404"></a>01404 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01405"></a>01405 encode_actions_1 (<span class="keyword">struct</span> <a class="code" href="structcommand__line.html">command_line</a> *action,
<a name="l01406"></a>01406                   <span class="keyword">struct</span> <a class="code" href="structbp__location.html">bp_location</a> *tloc,
<a name="l01407"></a>01407                   <span class="keywordtype">int</span> frame_reg,
<a name="l01408"></a>01408                   <a class="code" href="defs_8h.html#ac7647a3f71533007c9e128f3ddda1987">LONGEST</a> frame_offset,
<a name="l01409"></a>01409                   <span class="keyword">struct</span> <a class="code" href="structcollection__list.html">collection_list</a> *collect,
<a name="l01410"></a>01410                   <span class="keyword">struct</span> <a class="code" href="structcollection__list.html">collection_list</a> *stepping_list)
<a name="l01411"></a>01411 {
<a name="l01412"></a>01412   <span class="keyword">const</span> <span class="keywordtype">char</span> *action_exp;
<a name="l01413"></a>01413   <span class="keyword">struct </span><a class="code" href="structexpression.html">expression</a> *exp = NULL;
<a name="l01414"></a>01414   <span class="keywordtype">int</span> i;
<a name="l01415"></a>01415   <span class="keyword">struct </span>value *tempval;
<a name="l01416"></a>01416   <span class="keyword">struct </span><a class="code" href="structcmd__list__element.html">cmd_list_element</a> *cmd;
<a name="l01417"></a>01417   <span class="keyword">struct </span><a class="code" href="structagent__expr.html">agent_expr</a> *aexpr;
<a name="l01418"></a>01418 
<a name="l01419"></a>01419   <span class="keywordflow">for</span> (; action; action = action-&gt;<a class="code" href="structcommand__line.html#aa3aea4183824359fc95edf1bf4e5291c">next</a>)
<a name="l01420"></a>01420     {
<a name="l01421"></a>01421       <a class="code" href="defs_8h.html#ad24e2b54375e12474e65ebf7175988fb">QUIT</a>;                     <span class="comment">/* Allow user to bail out with ^C.  */</span>
<a name="l01422"></a>01422       action_exp = action-&gt;<a class="code" href="structcommand__line.html#ac3bdd932f280976d7751ee96783a2c71">line</a>;
<a name="l01423"></a>01423       action_exp = <a class="code" href="cli-utils_8c.html#aad7df612354d99c740a7ea12eccd3848">skip_spaces_const</a> (action_exp);
<a name="l01424"></a>01424 
<a name="l01425"></a>01425       cmd = <a class="code" href="cli-decode_8c.html#afbb3266bd92a5a8903072bb4e5f250cc">lookup_cmd</a> (&amp;action_exp, <a class="code" href="cli-cmds_8c.html#a6b7ab0355d0fa8d6ce7d5feb83ff78e7">cmdlist</a>, <span class="stringliteral">&quot;&quot;</span>, -1, 1);
<a name="l01426"></a>01426       <span class="keywordflow">if</span> (cmd == 0)
<a name="l01427"></a>01427         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Bad action list item: %s&quot;</span>), action_exp);
<a name="l01428"></a>01428 
<a name="l01429"></a>01429       <span class="keywordflow">if</span> (<a class="code" href="cli-decode_8c.html#a5335d4a46d04e07d54f850cc468dcb3d">cmd_cfunc_eq</a> (cmd, collect_pseudocommand))
<a name="l01430"></a>01430         {
<a name="l01431"></a>01431           <span class="keywordtype">int</span> trace_string = 0;
<a name="l01432"></a>01432 
<a name="l01433"></a>01433           <span class="keywordflow">if</span> (*action_exp == <span class="charliteral">&#39;/&#39;</span>)
<a name="l01434"></a>01434             action_exp = <a class="code" href="tracepoint_8c.html#ab33a6fe626f9fa9e84c68df03ab25e63">decode_agent_options</a> (action_exp, &amp;trace_string);
<a name="l01435"></a>01435 
<a name="l01436"></a>01436           <span class="keywordflow">do</span>
<a name="l01437"></a>01437             {                   <span class="comment">/* Repeat over a comma-separated list.  */</span>
<a name="l01438"></a>01438               <a class="code" href="defs_8h.html#ad24e2b54375e12474e65ebf7175988fb">QUIT</a>;             <span class="comment">/* Allow user to bail out with ^C.  */</span>
<a name="l01439"></a>01439               action_exp = <a class="code" href="cli-utils_8c.html#aad7df612354d99c740a7ea12eccd3848">skip_spaces_const</a> (action_exp);
<a name="l01440"></a>01440 
<a name="l01441"></a>01441               <span class="keywordflow">if</span> (0 == strncasecmp (<span class="stringliteral">&quot;$reg&quot;</span>, action_exp, 4))
<a name="l01442"></a>01442                 {
<a name="l01443"></a>01443                   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="gdbarch_8c.html#a69069435754d0b434c7043a21d247325">gdbarch_num_regs</a> (tloc-&gt;<a class="code" href="structbp__location.html#a55f3ff99d536775f5095f11e5f5c3f3e">gdbarch</a>); i++)
<a name="l01444"></a>01444                     add_register (collect, i);
<a name="l01445"></a>01445                   action_exp = <a class="code" href="gdb__string_8h.html#adf46aa8f2e08cfb505868bbfc88b5fd4">strchr</a> (action_exp, <span class="charliteral">&#39;,&#39;</span>);        <span class="comment">/* more? */</span>
<a name="l01446"></a>01446                 }
<a name="l01447"></a>01447               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == strncasecmp (<span class="stringliteral">&quot;$arg&quot;</span>, action_exp, 4))
<a name="l01448"></a>01448                 {
<a name="l01449"></a>01449                   add_local_symbols (collect,
<a name="l01450"></a>01450                                      tloc-&gt;<a class="code" href="structbp__location.html#a55f3ff99d536775f5095f11e5f5c3f3e">gdbarch</a>,
<a name="l01451"></a>01451                                      tloc-&gt;<a class="code" href="structbp__location.html#a6b6cd8b8a488e632200f323309d23823">address</a>,
<a name="l01452"></a>01452                                      frame_reg,
<a name="l01453"></a>01453                                      frame_offset,
<a name="l01454"></a>01454                                      <span class="charliteral">&#39;A&#39;</span>,
<a name="l01455"></a>01455                                      trace_string);
<a name="l01456"></a>01456                   action_exp = <a class="code" href="gdb__string_8h.html#adf46aa8f2e08cfb505868bbfc88b5fd4">strchr</a> (action_exp, <span class="charliteral">&#39;,&#39;</span>);        <span class="comment">/* more? */</span>
<a name="l01457"></a>01457                 }
<a name="l01458"></a>01458               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == strncasecmp (<span class="stringliteral">&quot;$loc&quot;</span>, action_exp, 4))
<a name="l01459"></a>01459                 {
<a name="l01460"></a>01460                   add_local_symbols (collect,
<a name="l01461"></a>01461                                      tloc-&gt;<a class="code" href="structbp__location.html#a55f3ff99d536775f5095f11e5f5c3f3e">gdbarch</a>,
<a name="l01462"></a>01462                                      tloc-&gt;<a class="code" href="structbp__location.html#a6b6cd8b8a488e632200f323309d23823">address</a>,
<a name="l01463"></a>01463                                      frame_reg,
<a name="l01464"></a>01464                                      frame_offset,
<a name="l01465"></a>01465                                      <span class="charliteral">&#39;L&#39;</span>,
<a name="l01466"></a>01466                                      trace_string);
<a name="l01467"></a>01467                   action_exp = <a class="code" href="gdb__string_8h.html#adf46aa8f2e08cfb505868bbfc88b5fd4">strchr</a> (action_exp, <span class="charliteral">&#39;,&#39;</span>);        <span class="comment">/* more? */</span>
<a name="l01468"></a>01468                 }
<a name="l01469"></a>01469               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == strncasecmp (<span class="stringliteral">&quot;$_ret&quot;</span>, action_exp, 5))
<a name="l01470"></a>01470                 {
<a name="l01471"></a>01471                   <span class="keyword">struct </span>cleanup *old_chain1 = NULL;
<a name="l01472"></a>01472 
<a name="l01473"></a>01473                   aexpr = <a class="code" href="ax-gdb_8c.html#a496cf0401d0203d95f0616c465a7e88a">gen_trace_for_return_address</a> (tloc-&gt;<a class="code" href="structbp__location.html#a6b6cd8b8a488e632200f323309d23823">address</a>,
<a name="l01474"></a>01474                                                         tloc-&gt;<a class="code" href="structbp__location.html#a55f3ff99d536775f5095f11e5f5c3f3e">gdbarch</a>,
<a name="l01475"></a>01475                                                         trace_string);
<a name="l01476"></a>01476 
<a name="l01477"></a>01477                   old_chain1 = <a class="code" href="ax-general_8c.html#a2cf2dd0ae1eb22eb70a968683d272624">make_cleanup_free_agent_expr</a> (aexpr);
<a name="l01478"></a>01478 
<a name="l01479"></a>01479                   <a class="code" href="ax-general_8c.html#a2ef11cd336a163ef64356b65550324b1">ax_reqs</a> (aexpr);
<a name="l01480"></a>01480                   report_agent_reqs_errors (aexpr);
<a name="l01481"></a>01481 
<a name="l01482"></a>01482                   <a class="code" href="cleanups_8c.html#a5ec3987bf995edcc44def9e17ada6eba">discard_cleanups</a> (old_chain1);
<a name="l01483"></a>01483                   add_aexpr (collect, aexpr);
<a name="l01484"></a>01484 
<a name="l01485"></a>01485                   <span class="comment">/* take care of the registers */</span>
<a name="l01486"></a>01486                   <span class="keywordflow">if</span> (aexpr-&gt;<a class="code" href="structagent__expr.html#ab46c966a53bb27d58770e8e27f34665f">reg_mask_len</a> &gt; 0)
<a name="l01487"></a>01487                     {
<a name="l01488"></a>01488                       <span class="keywordtype">int</span> ndx1, ndx2;
<a name="l01489"></a>01489 
<a name="l01490"></a>01490                       <span class="keywordflow">for</span> (ndx1 = 0; ndx1 &lt; aexpr-&gt;<a class="code" href="structagent__expr.html#ab46c966a53bb27d58770e8e27f34665f">reg_mask_len</a>; ndx1++)
<a name="l01491"></a>01491                         {
<a name="l01492"></a>01492                           <a class="code" href="defs_8h.html#ad24e2b54375e12474e65ebf7175988fb">QUIT</a>; <span class="comment">/* allow user to bail out with ^C */</span>
<a name="l01493"></a>01493                           <span class="keywordflow">if</span> (aexpr-&gt;<a class="code" href="structagent__expr.html#a7ad4afed8f827080a5e063e45f888038">reg_mask</a>[ndx1] != 0)
<a name="l01494"></a>01494                             {
<a name="l01495"></a>01495                               <span class="comment">/* assume chars have 8 bits */</span>
<a name="l01496"></a>01496                               <span class="keywordflow">for</span> (ndx2 = 0; ndx2 &lt; 8; ndx2++)
<a name="l01497"></a>01497                                 <span class="keywordflow">if</span> (aexpr-&gt;<a class="code" href="structagent__expr.html#a7ad4afed8f827080a5e063e45f888038">reg_mask</a>[ndx1] &amp; (1 &lt;&lt; ndx2))
<a name="l01498"></a>01498                                   <span class="comment">/* it&#39;s used -- record it */</span>
<a name="l01499"></a>01499                                   add_register (collect, 
<a name="l01500"></a>01500                                                 ndx1 * 8 + ndx2);
<a name="l01501"></a>01501                             }
<a name="l01502"></a>01502                         }
<a name="l01503"></a>01503                     }
<a name="l01504"></a>01504 
<a name="l01505"></a>01505                   action_exp = <a class="code" href="gdb__string_8h.html#adf46aa8f2e08cfb505868bbfc88b5fd4">strchr</a> (action_exp, <span class="charliteral">&#39;,&#39;</span>);        <span class="comment">/* more? */</span>
<a name="l01506"></a>01506                 }
<a name="l01507"></a>01507               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == strncasecmp (<span class="stringliteral">&quot;$_sdata&quot;</span>, action_exp, 7))
<a name="l01508"></a>01508                 {
<a name="l01509"></a>01509                   add_static_trace_data (collect);
<a name="l01510"></a>01510                   action_exp = <a class="code" href="gdb__string_8h.html#adf46aa8f2e08cfb505868bbfc88b5fd4">strchr</a> (action_exp, <span class="charliteral">&#39;,&#39;</span>);        <span class="comment">/* more? */</span>
<a name="l01511"></a>01511                 }
<a name="l01512"></a>01512               <span class="keywordflow">else</span>
<a name="l01513"></a>01513                 {
<a name="l01514"></a>01514                   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> addr;
<a name="l01515"></a>01515                   <span class="keyword">struct </span>cleanup *old_chain = NULL;
<a name="l01516"></a>01516                   <span class="keyword">struct </span>cleanup *old_chain1 = NULL;
<a name="l01517"></a>01517 
<a name="l01518"></a>01518                   exp = <a class="code" href="expression_8h.html#abdad295cc4b5351f6e6ec024ab665475">parse_exp_1</a> (&amp;action_exp, tloc-&gt;<a class="code" href="structbp__location.html#a6b6cd8b8a488e632200f323309d23823">address</a>,
<a name="l01519"></a>01519                                      <a class="code" href="block_8c.html#a35aadf82f92cb4a47ec068dba0e1b36c">block_for_pc</a> (tloc-&gt;<a class="code" href="structbp__location.html#a6b6cd8b8a488e632200f323309d23823">address</a>), 1);
<a name="l01520"></a>01520                   old_chain = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="utils_8c.html#a6d8c21606d3f67a431a7bfbb1f47d12e">free_current_contents</a>, &amp;exp);
<a name="l01521"></a>01521 
<a name="l01522"></a>01522                   <span class="keywordflow">switch</span> (exp-&gt;<a class="code" href="structexpression.html#a121cbb7647db0430c9e217dbcd27021f">elts</a>[0].<a class="code" href="unionexp__element.html#a732546b7148c98393e390e52d954bc83">opcode</a>)
<a name="l01523"></a>01523                     {
<a name="l01524"></a>01524                     <span class="keywordflow">case</span> OP_REGISTER:
<a name="l01525"></a>01525                       {
<a name="l01526"></a>01526                         <span class="keyword">const</span> <span class="keywordtype">char</span> *name = &amp;exp-&gt;<a class="code" href="structexpression.html#a121cbb7647db0430c9e217dbcd27021f">elts</a>[2].<a class="code" href="unionexp__element.html#abeeb3252199a524869642283bccda167">string</a>;
<a name="l01527"></a>01527 
<a name="l01528"></a>01528                         i = <a class="code" href="user-regs_8c.html#a73129d16744501cecc45fb94c573c277">user_reg_map_name_to_regnum</a> (tloc-&gt;<a class="code" href="structbp__location.html#a55f3ff99d536775f5095f11e5f5c3f3e">gdbarch</a>,
<a name="l01529"></a>01529                                                          name, strlen (name));
<a name="l01530"></a>01530                         <span class="keywordflow">if</span> (i == -1)
<a name="l01531"></a>01531                           <a class="code" href="common-utils_8h.html#aa14285d9d3d4171016ef9cf09447e8bb">internal_error</a> (__FILE__, __LINE__,
<a name="l01532"></a>01532                                           <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Register $%s not available&quot;</span>),
<a name="l01533"></a>01533                                           name);
<a name="l01534"></a>01534                         <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a3f2f91ed92de5dfaa6d27fb82822f8d5">info_verbose</a>)
<a name="l01535"></a>01535                           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;OP_REGISTER: &quot;</span>);
<a name="l01536"></a>01536                         add_register (collect, i);
<a name="l01537"></a>01537                         <span class="keywordflow">break</span>;
<a name="l01538"></a>01538                       }
<a name="l01539"></a>01539 
<a name="l01540"></a>01540                     <span class="keywordflow">case</span> UNOP_MEMVAL:
<a name="l01541"></a>01541                       <span class="comment">/* Safe because we know it&#39;s a simple expression.  */</span>
<a name="l01542"></a>01542                       tempval = <a class="code" href="eval_8c.html#ab50151ccba3ea3184c114121d6bed422">evaluate_expression</a> (exp);
<a name="l01543"></a>01543                       addr = <a class="code" href="value_8c.html#a64c795fa1a8854682b3b727025d0d31d">value_address</a> (tempval);
<a name="l01544"></a>01544                       <span class="comment">/* Initialize the TYPE_LENGTH if it is a typedef.  */</span>
<a name="l01545"></a>01545                       <a class="code" href="gdbtypes_8c.html#a0bf29d7521d8a8b8735b9a259e380386">check_typedef</a> (exp-&gt;<a class="code" href="structexpression.html#a121cbb7647db0430c9e217dbcd27021f">elts</a>[1].<a class="code" href="unionexp__element.html#a5465f279ce78cd1036b1f0cefb1f78e2">type</a>);
<a name="l01546"></a>01546                       add_memrange (collect, <a class="code" href="tracepoint_8c.html#a85c7862086c1f92e4fb4108e176d8140a7a9e899080df0ea62d51c3dd27365865">memrange_absolute</a>, addr,
<a name="l01547"></a>01547                                     <a class="code" href="gdbtypes_8h.html#aeac33f868e763780094aec8a2dcb9a1a">TYPE_LENGTH</a> (exp-&gt;<a class="code" href="structexpression.html#a121cbb7647db0430c9e217dbcd27021f">elts</a>[1].<a class="code" href="unionexp__element.html#a5465f279ce78cd1036b1f0cefb1f78e2">type</a>));
<a name="l01548"></a>01548                       append_exp (exp, &amp;collect-&gt;computed);
<a name="l01549"></a>01549                       <span class="keywordflow">break</span>;
<a name="l01550"></a>01550 
<a name="l01551"></a>01551                     <span class="keywordflow">case</span> OP_VAR_VALUE:
<a name="l01552"></a>01552                       {
<a name="l01553"></a>01553                         <span class="keyword">struct </span><a class="code" href="structsymbol.html">symbol</a> *sym = exp-&gt;<a class="code" href="structexpression.html#a121cbb7647db0430c9e217dbcd27021f">elts</a>[2].<a class="code" href="unionexp__element.html#aaa2c043e08e05f37c03379ca80dcc124">symbol</a>;
<a name="l01554"></a>01554                         <a class="code" href="gdb__vecs_8h.html#a5ea7d3fefa2144d9bddaf2053c9691a1">char_ptr</a> name = (<a class="code" href="gdb__vecs_8h.html#a5ea7d3fefa2144d9bddaf2053c9691a1">char_ptr</a>) <a class="code" href="symtab_8h.html#a243e66afa96ff58a851b38f428bb3394">SYMBOL_NATURAL_NAME</a> (sym);
<a name="l01555"></a>01555 
<a name="l01556"></a>01556                         collect_symbol (collect,
<a name="l01557"></a>01557                                         exp-&gt;<a class="code" href="structexpression.html#a121cbb7647db0430c9e217dbcd27021f">elts</a>[2].<a class="code" href="unionexp__element.html#aaa2c043e08e05f37c03379ca80dcc124">symbol</a>,
<a name="l01558"></a>01558                                         tloc-&gt;<a class="code" href="structbp__location.html#a55f3ff99d536775f5095f11e5f5c3f3e">gdbarch</a>,
<a name="l01559"></a>01559                                         frame_reg,
<a name="l01560"></a>01560                                         frame_offset,
<a name="l01561"></a>01561                                         tloc-&gt;<a class="code" href="structbp__location.html#a6b6cd8b8a488e632200f323309d23823">address</a>,
<a name="l01562"></a>01562                                         trace_string);
<a name="l01563"></a>01563                         <a class="code" href="vec_8h.html#a8d090c0524726d00931070e0c438ba3f">VEC_safe_push</a> (<a class="code" href="gdb__vecs_8h.html#a5ea7d3fefa2144d9bddaf2053c9691a1">char_ptr</a>,
<a name="l01564"></a>01564                                        collect-&gt;wholly_collected,
<a name="l01565"></a>01565                                        name);
<a name="l01566"></a>01566                       }
<a name="l01567"></a>01567                       <span class="keywordflow">break</span>;
<a name="l01568"></a>01568 
<a name="l01569"></a>01569                     <span class="keywordflow">default</span>:    <span class="comment">/* Full-fledged expression.  */</span>
<a name="l01570"></a>01570                       aexpr = <a class="code" href="ax-gdb_8c.html#a5fd5f5325dabcf1cc401c00dc4e7bbc7">gen_trace_for_expr</a> (tloc-&gt;<a class="code" href="structbp__location.html#a6b6cd8b8a488e632200f323309d23823">address</a>, exp,
<a name="l01571"></a>01571                                                   trace_string);
<a name="l01572"></a>01572 
<a name="l01573"></a>01573                       old_chain1 = <a class="code" href="ax-general_8c.html#a2cf2dd0ae1eb22eb70a968683d272624">make_cleanup_free_agent_expr</a> (aexpr);
<a name="l01574"></a>01574 
<a name="l01575"></a>01575                       <a class="code" href="ax-general_8c.html#a2ef11cd336a163ef64356b65550324b1">ax_reqs</a> (aexpr);
<a name="l01576"></a>01576 
<a name="l01577"></a>01577                       report_agent_reqs_errors (aexpr);
<a name="l01578"></a>01578 
<a name="l01579"></a>01579                       <a class="code" href="cleanups_8c.html#a5ec3987bf995edcc44def9e17ada6eba">discard_cleanups</a> (old_chain1);
<a name="l01580"></a>01580                       add_aexpr (collect, aexpr);
<a name="l01581"></a>01581 
<a name="l01582"></a>01582                       <span class="comment">/* Take care of the registers.  */</span>
<a name="l01583"></a>01583                       <span class="keywordflow">if</span> (aexpr-&gt;<a class="code" href="structagent__expr.html#ab46c966a53bb27d58770e8e27f34665f">reg_mask_len</a> &gt; 0)
<a name="l01584"></a>01584                         {
<a name="l01585"></a>01585                           <span class="keywordtype">int</span> ndx1;
<a name="l01586"></a>01586                           <span class="keywordtype">int</span> ndx2;
<a name="l01587"></a>01587 
<a name="l01588"></a>01588                           <span class="keywordflow">for</span> (ndx1 = 0; ndx1 &lt; aexpr-&gt;<a class="code" href="structagent__expr.html#ab46c966a53bb27d58770e8e27f34665f">reg_mask_len</a>; ndx1++)
<a name="l01589"></a>01589                             {
<a name="l01590"></a>01590                               <a class="code" href="defs_8h.html#ad24e2b54375e12474e65ebf7175988fb">QUIT</a>;     <span class="comment">/* Allow user to bail out with ^C.  */</span>
<a name="l01591"></a>01591                               <span class="keywordflow">if</span> (aexpr-&gt;<a class="code" href="structagent__expr.html#a7ad4afed8f827080a5e063e45f888038">reg_mask</a>[ndx1] != 0)
<a name="l01592"></a>01592                                 {
<a name="l01593"></a>01593                                   <span class="comment">/* Assume chars have 8 bits.  */</span>
<a name="l01594"></a>01594                                   <span class="keywordflow">for</span> (ndx2 = 0; ndx2 &lt; 8; ndx2++)
<a name="l01595"></a>01595                                     <span class="keywordflow">if</span> (aexpr-&gt;<a class="code" href="structagent__expr.html#a7ad4afed8f827080a5e063e45f888038">reg_mask</a>[ndx1] &amp; (1 &lt;&lt; ndx2))
<a name="l01596"></a>01596                                       <span class="comment">/* It&#39;s used -- record it.  */</span>
<a name="l01597"></a>01597                                       add_register (collect, 
<a name="l01598"></a>01598                                                     ndx1 * 8 + ndx2);
<a name="l01599"></a>01599                                 }
<a name="l01600"></a>01600                             }
<a name="l01601"></a>01601                         }
<a name="l01602"></a>01602 
<a name="l01603"></a>01603                       append_exp (exp, &amp;collect-&gt;computed);
<a name="l01604"></a>01604                       <span class="keywordflow">break</span>;
<a name="l01605"></a>01605                     }           <span class="comment">/* switch */</span>
<a name="l01606"></a>01606                   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l01607"></a>01607                 }               <span class="comment">/* do */</span>
<a name="l01608"></a>01608             }
<a name="l01609"></a>01609           <span class="keywordflow">while</span> (action_exp &amp;&amp; *action_exp++ == <span class="charliteral">&#39;,&#39;</span>);
<a name="l01610"></a>01610         }                       <span class="comment">/* if */</span>
<a name="l01611"></a>01611       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="cli-decode_8c.html#a5335d4a46d04e07d54f850cc468dcb3d">cmd_cfunc_eq</a> (cmd, teval_pseudocommand))
<a name="l01612"></a>01612         {
<a name="l01613"></a>01613           <span class="keywordflow">do</span>
<a name="l01614"></a>01614             {                   <span class="comment">/* Repeat over a comma-separated list.  */</span>
<a name="l01615"></a>01615               <a class="code" href="defs_8h.html#ad24e2b54375e12474e65ebf7175988fb">QUIT</a>;             <span class="comment">/* Allow user to bail out with ^C.  */</span>
<a name="l01616"></a>01616               action_exp = <a class="code" href="cli-utils_8c.html#aad7df612354d99c740a7ea12eccd3848">skip_spaces_const</a> (action_exp);
<a name="l01617"></a>01617 
<a name="l01618"></a>01618                 {
<a name="l01619"></a>01619                   <span class="keyword">struct </span>cleanup *old_chain = NULL;
<a name="l01620"></a>01620                   <span class="keyword">struct </span>cleanup *old_chain1 = NULL;
<a name="l01621"></a>01621 
<a name="l01622"></a>01622                   exp = <a class="code" href="expression_8h.html#abdad295cc4b5351f6e6ec024ab665475">parse_exp_1</a> (&amp;action_exp, tloc-&gt;<a class="code" href="structbp__location.html#a6b6cd8b8a488e632200f323309d23823">address</a>,
<a name="l01623"></a>01623                                      <a class="code" href="block_8c.html#a35aadf82f92cb4a47ec068dba0e1b36c">block_for_pc</a> (tloc-&gt;<a class="code" href="structbp__location.html#a6b6cd8b8a488e632200f323309d23823">address</a>), 1);
<a name="l01624"></a>01624                   old_chain = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="utils_8c.html#a6d8c21606d3f67a431a7bfbb1f47d12e">free_current_contents</a>, &amp;exp);
<a name="l01625"></a>01625 
<a name="l01626"></a>01626                   aexpr = <a class="code" href="ax-gdb_8c.html#aa9b3b3364a9fd201c6c0f9a99a57da44">gen_eval_for_expr</a> (tloc-&gt;<a class="code" href="structbp__location.html#a6b6cd8b8a488e632200f323309d23823">address</a>, exp);
<a name="l01627"></a>01627                   old_chain1 = <a class="code" href="ax-general_8c.html#a2cf2dd0ae1eb22eb70a968683d272624">make_cleanup_free_agent_expr</a> (aexpr);
<a name="l01628"></a>01628 
<a name="l01629"></a>01629                   <a class="code" href="ax-general_8c.html#a2ef11cd336a163ef64356b65550324b1">ax_reqs</a> (aexpr);
<a name="l01630"></a>01630                   report_agent_reqs_errors (aexpr);
<a name="l01631"></a>01631 
<a name="l01632"></a>01632                   <a class="code" href="cleanups_8c.html#a5ec3987bf995edcc44def9e17ada6eba">discard_cleanups</a> (old_chain1);
<a name="l01633"></a>01633                   <span class="comment">/* Even though we&#39;re not officially collecting, add</span>
<a name="l01634"></a>01634 <span class="comment">                     to the collect list anyway.  */</span>
<a name="l01635"></a>01635                   add_aexpr (collect, aexpr);
<a name="l01636"></a>01636 
<a name="l01637"></a>01637                   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l01638"></a>01638                 }               <span class="comment">/* do */</span>
<a name="l01639"></a>01639             }
<a name="l01640"></a>01640           <span class="keywordflow">while</span> (action_exp &amp;&amp; *action_exp++ == <span class="charliteral">&#39;,&#39;</span>);
<a name="l01641"></a>01641         }                       <span class="comment">/* if */</span>
<a name="l01642"></a>01642       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="cli-decode_8c.html#a5335d4a46d04e07d54f850cc468dcb3d">cmd_cfunc_eq</a> (cmd, while_stepping_pseudocommand))
<a name="l01643"></a>01643         {
<a name="l01644"></a>01644           <span class="comment">/* We check against nested while-stepping when setting</span>
<a name="l01645"></a>01645 <span class="comment">             breakpoint action, so no way to run into nested</span>
<a name="l01646"></a>01646 <span class="comment">             here.  */</span>
<a name="l01647"></a>01647           <a class="code" href="gdb__assert_8h.html#aeb007d3e990858c7ef8e40a7e512c1ff">gdb_assert</a> (stepping_list);
<a name="l01648"></a>01648 
<a name="l01649"></a>01649           encode_actions_1 (action-&gt;<a class="code" href="structcommand__line.html#ab44cb6b34417ec8a326a4ed5b3316e20">body_list</a>[0], tloc, frame_reg,
<a name="l01650"></a>01650                             frame_offset, stepping_list, NULL);
<a name="l01651"></a>01651         }
<a name="l01652"></a>01652       <span class="keywordflow">else</span>
<a name="l01653"></a>01653         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Invalid tracepoint command &#39;%s&#39;&quot;</span>), action-&gt;<a class="code" href="structcommand__line.html#ac3bdd932f280976d7751ee96783a2c71">line</a>);
<a name="l01654"></a>01654     }                           <span class="comment">/* for */</span>
<a name="l01655"></a>01655 }
<a name="l01656"></a>01656 
<a name="l01657"></a>01657 <span class="comment">/* Encode actions of tracepoint TLOC-&gt;owner and fill TRACEPOINT_LIST</span>
<a name="l01658"></a>01658 <span class="comment">   and STEPPING_LIST.  Return a cleanup pointer to clean up both</span>
<a name="l01659"></a>01659 <span class="comment">   TRACEPOINT_LIST and STEPPING_LIST.  */</span>
<a name="l01660"></a>01660 
<a name="l01661"></a>01661 <span class="keyword">struct </span>cleanup *
<a name="l01662"></a><a class="code" href="tracepoint_8h.html#ace750d67a6f8504b71c126d7238a84a4">01662</a> <a class="code" href="tracepoint_8c.html#ace750d67a6f8504b71c126d7238a84a4">encode_actions_and_make_cleanup</a> (<span class="keyword">struct</span> <a class="code" href="structbp__location.html">bp_location</a> *tloc,
<a name="l01663"></a>01663                                  <span class="keyword">struct</span> <a class="code" href="structcollection__list.html">collection_list</a> *tracepoint_list,
<a name="l01664"></a>01664                                  <span class="keyword">struct</span> <a class="code" href="structcollection__list.html">collection_list</a> *stepping_list)
<a name="l01665"></a>01665 {
<a name="l01666"></a>01666   <span class="keywordtype">char</span> *default_collect_line = NULL;
<a name="l01667"></a>01667   <span class="keyword">struct </span><a class="code" href="structcommand__line.html">command_line</a> *actions;
<a name="l01668"></a>01668   <span class="keyword">struct </span><a class="code" href="structcommand__line.html">command_line</a> *default_collect_action = NULL;
<a name="l01669"></a>01669   <span class="keywordtype">int</span> frame_reg;
<a name="l01670"></a>01670   <a class="code" href="defs_8h.html#ac7647a3f71533007c9e128f3ddda1987">LONGEST</a> frame_offset;
<a name="l01671"></a>01671   <span class="keyword">struct </span>cleanup *back_to, *return_chain;
<a name="l01672"></a>01672 
<a name="l01673"></a>01673   return_chain = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="cleanups_8c.html#a1ec2a3980c2be1f31f2142103d1f7abf">null_cleanup</a>, NULL);
<a name="l01674"></a>01674   init_collection_list (tracepoint_list);
<a name="l01675"></a>01675   init_collection_list (stepping_list);
<a name="l01676"></a>01676 
<a name="l01677"></a>01677   <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (do_clear_collection_list, tracepoint_list);
<a name="l01678"></a>01678   <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (do_clear_collection_list, stepping_list);
<a name="l01679"></a>01679 
<a name="l01680"></a>01680   back_to = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="cleanups_8c.html#a1ec2a3980c2be1f31f2142103d1f7abf">null_cleanup</a>, NULL);
<a name="l01681"></a>01681   <a class="code" href="gdbarch_8c.html#aafebaf81c3859c9c59c933fd8db62833">gdbarch_virtual_frame_pointer</a> (tloc-&gt;<a class="code" href="structbp__location.html#a55f3ff99d536775f5095f11e5f5c3f3e">gdbarch</a>,
<a name="l01682"></a>01682                                  tloc-&gt;<a class="code" href="structbp__location.html#a6b6cd8b8a488e632200f323309d23823">address</a>, &amp;frame_reg, &amp;frame_offset);
<a name="l01683"></a>01683 
<a name="l01684"></a>01684   actions = all_tracepoint_actions_and_cleanup (tloc-&gt;<a class="code" href="structbp__location.html#ade5cd870d1e7255c36ac84c2c6f1c4c2">owner</a>);
<a name="l01685"></a>01685 
<a name="l01686"></a>01686   encode_actions_1 (actions, tloc, frame_reg, frame_offset,
<a name="l01687"></a>01687                     tracepoint_list, stepping_list);
<a name="l01688"></a>01688 
<a name="l01689"></a>01689   memrange_sortmerge (tracepoint_list);
<a name="l01690"></a>01690   memrange_sortmerge (stepping_list);
<a name="l01691"></a>01691 
<a name="l01692"></a>01692   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (back_to);
<a name="l01693"></a>01693   <span class="keywordflow">return</span> return_chain;
<a name="l01694"></a>01694 }
<a name="l01695"></a>01695 
<a name="l01696"></a>01696 <span class="comment">/* Render all actions into gdb protocol.  */</span>
<a name="l01697"></a>01697 
<a name="l01698"></a>01698 <span class="keywordtype">void</span>
<a name="l01699"></a><a class="code" href="tracepoint_8h.html#a564f3cb1a799e49aa5197bd65da262f6">01699</a> <a class="code" href="tracepoint_8c.html#a564f3cb1a799e49aa5197bd65da262f6">encode_actions_rsp</a> (<span class="keyword">struct</span> <a class="code" href="structbp__location.html">bp_location</a> *tloc, <span class="keywordtype">char</span> ***tdp_actions,
<a name="l01700"></a>01700                     <span class="keywordtype">char</span> ***stepping_actions)
<a name="l01701"></a>01701 {
<a name="l01702"></a>01702   <span class="keyword">struct </span><a class="code" href="structcollection__list.html">collection_list</a> tracepoint_list, stepping_list;
<a name="l01703"></a>01703   <span class="keyword">struct </span>cleanup *cleanup;
<a name="l01704"></a>01704 
<a name="l01705"></a>01705   *tdp_actions = NULL;
<a name="l01706"></a>01706   *stepping_actions = NULL;
<a name="l01707"></a>01707 
<a name="l01708"></a>01708   cleanup = <a class="code" href="tracepoint_8c.html#ace750d67a6f8504b71c126d7238a84a4">encode_actions_and_make_cleanup</a> (tloc, &amp;tracepoint_list,
<a name="l01709"></a>01709                                              &amp;stepping_list);
<a name="l01710"></a>01710 
<a name="l01711"></a>01711   *tdp_actions = stringify_collection_list (&amp;tracepoint_list);
<a name="l01712"></a>01712   *stepping_actions = stringify_collection_list (&amp;stepping_list);
<a name="l01713"></a>01713 
<a name="l01714"></a>01714   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup);
<a name="l01715"></a>01715 }
<a name="l01716"></a>01716 
<a name="l01717"></a>01717 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01718"></a>01718 add_aexpr (<span class="keyword">struct</span> <a class="code" href="structcollection__list.html">collection_list</a> *collect, <span class="keyword">struct</span> <a class="code" href="structagent__expr.html">agent_expr</a> *aexpr)
<a name="l01719"></a>01719 {
<a name="l01720"></a>01720   <span class="keywordflow">if</span> (collect-&gt;<a class="code" href="structcollection__list.html#a5f9c0ec40e11e47a8b62c9b8cdb70d73">next_aexpr_elt</a> &gt;= collect-&gt;<a class="code" href="structcollection__list.html#a86fe1ff3522827ed3ef2187f5f763622">aexpr_listsize</a>)
<a name="l01721"></a>01721     {
<a name="l01722"></a>01722       collect-&gt;<a class="code" href="structcollection__list.html#a02fd38610fd4357ec9856bd4c816a541">aexpr_list</a> =
<a name="l01723"></a>01723         <a class="code" href="common-utils_8c.html#af404b7244f442ce8c3069f31af566eae">xrealloc</a> (collect-&gt;<a class="code" href="structcollection__list.html#a02fd38610fd4357ec9856bd4c816a541">aexpr_list</a>,
<a name="l01724"></a>01724                   2 * collect-&gt;<a class="code" href="structcollection__list.html#a86fe1ff3522827ed3ef2187f5f763622">aexpr_listsize</a> * sizeof (<span class="keyword">struct</span> <a class="code" href="structagent__expr.html">agent_expr</a> *));
<a name="l01725"></a>01725       collect-&gt;<a class="code" href="structcollection__list.html#a86fe1ff3522827ed3ef2187f5f763622">aexpr_listsize</a> *= 2;
<a name="l01726"></a>01726     }
<a name="l01727"></a>01727   collect-&gt;<a class="code" href="structcollection__list.html#a02fd38610fd4357ec9856bd4c816a541">aexpr_list</a>[collect-&gt;<a class="code" href="structcollection__list.html#a5f9c0ec40e11e47a8b62c9b8cdb70d73">next_aexpr_elt</a>] = aexpr;
<a name="l01728"></a>01728   collect-&gt;<a class="code" href="structcollection__list.html#a5f9c0ec40e11e47a8b62c9b8cdb70d73">next_aexpr_elt</a>++;
<a name="l01729"></a>01729 }
<a name="l01730"></a>01730 
<a name="l01731"></a>01731 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01732"></a>01732 process_tracepoint_on_disconnect (<span class="keywordtype">void</span>)
<a name="l01733"></a>01733 {
<a name="l01734"></a>01734   <a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a>(<a class="code" href="structbreakpoint.html">breakpoint_p</a>) *tp_vec = NULL;
<a name="l01735"></a>01735   <span class="keywordtype">int</span> ix;
<a name="l01736"></a>01736   <span class="keyword">struct </span><a class="code" href="structbreakpoint.html">breakpoint</a> *b;
<a name="l01737"></a>01737   <span class="keywordtype">int</span> has_pending_p = 0;
<a name="l01738"></a>01738 
<a name="l01739"></a>01739   <span class="comment">/* Check whether we still have pending tracepoint.  If we have, warn the</span>
<a name="l01740"></a>01740 <span class="comment">     user that pending tracepoint will no longer work.  */</span>
<a name="l01741"></a>01741   tp_vec = all_tracepoints ();
<a name="l01742"></a>01742   <span class="keywordflow">for</span> (ix = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="structbreakpoint.html">breakpoint_p</a>, tp_vec, ix, b); ix++)
<a name="l01743"></a>01743     {
<a name="l01744"></a>01744       <span class="keywordflow">if</span> (b-&gt;<a class="code" href="structbreakpoint.html#aa869260f7e4c94204275861d820bb1a9">loc</a> == NULL)
<a name="l01745"></a>01745         {
<a name="l01746"></a>01746           has_pending_p = 1;
<a name="l01747"></a>01747           <span class="keywordflow">break</span>;
<a name="l01748"></a>01748         }
<a name="l01749"></a>01749       <span class="keywordflow">else</span>
<a name="l01750"></a>01750         {
<a name="l01751"></a>01751           <span class="keyword">struct </span><a class="code" href="structbp__location.html">bp_location</a> *loc1;
<a name="l01752"></a>01752 
<a name="l01753"></a>01753           <span class="keywordflow">for</span> (loc1 = b-&gt;<a class="code" href="structbreakpoint.html#aa869260f7e4c94204275861d820bb1a9">loc</a>; loc1; loc1 = loc1-&gt;<a class="code" href="structbp__location.html#ab193cb38f87fea89105db96d94191541">next</a>)
<a name="l01754"></a>01754             {
<a name="l01755"></a>01755               <span class="keywordflow">if</span> (loc1-&gt;<a class="code" href="structbp__location.html#a3732b41958ed311106bffd202cbfe4ff">shlib_disabled</a>)
<a name="l01756"></a>01756                 {
<a name="l01757"></a>01757                   has_pending_p = 1;
<a name="l01758"></a>01758                   <span class="keywordflow">break</span>;
<a name="l01759"></a>01759                 }
<a name="l01760"></a>01760             }
<a name="l01761"></a>01761 
<a name="l01762"></a>01762           <span class="keywordflow">if</span> (has_pending_p)
<a name="l01763"></a>01763             <span class="keywordflow">break</span>;
<a name="l01764"></a>01764         }
<a name="l01765"></a>01765     }
<a name="l01766"></a>01766   <a class="code" href="vec_8h.html#af5724b2bbce65103300279f9abe7f577">VEC_free</a> (<a class="code" href="structbreakpoint.html">breakpoint_p</a>, tp_vec);
<a name="l01767"></a>01767 
<a name="l01768"></a>01768   <span class="keywordflow">if</span> (has_pending_p)
<a name="l01769"></a>01769     <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Pending tracepoints will not be resolved while&quot;</span>
<a name="l01770"></a>01770                <span class="stringliteral">&quot; GDB is disconnected\n&quot;</span>));
<a name="l01771"></a>01771 }
<a name="l01772"></a>01772 
<a name="l01773"></a>01773 <span class="comment">/* Reset local state of tracing.  */</span>
<a name="l01774"></a>01774 
<a name="l01775"></a>01775 <span class="keywordtype">void</span>
<a name="l01776"></a><a class="code" href="tracepoint_8h.html#a8ab20f1eb477238f562e37831e9f6038">01776</a> <a class="code" href="tracepoint_8c.html#a8ab20f1eb477238f562e37831e9f6038">trace_reset_local_state</a> (<span class="keywordtype">void</span>)
<a name="l01777"></a>01777 {
<a name="l01778"></a>01778   set_traceframe_num (-1);
<a name="l01779"></a>01779   set_tracepoint_num (-1);
<a name="l01780"></a>01780   set_traceframe_context (NULL);
<a name="l01781"></a>01781   clear_traceframe_info ();
<a name="l01782"></a>01782 }
<a name="l01783"></a>01783 
<a name="l01784"></a>01784 <span class="keywordtype">void</span>
<a name="l01785"></a><a class="code" href="tracepoint_8h.html#a8bc87fc32433bb5c4df5a2774c2dc2cc">01785</a> <a class="code" href="tracepoint_8c.html#a8bc87fc32433bb5c4df5a2774c2dc2cc">start_tracing</a> (<span class="keywordtype">char</span> *notes)
<a name="l01786"></a>01786 {
<a name="l01787"></a>01787   <a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a>(<a class="code" href="structbreakpoint.html">breakpoint_p</a>) *tp_vec = NULL;
<a name="l01788"></a>01788   <span class="keywordtype">int</span> ix;
<a name="l01789"></a>01789   <span class="keyword">struct </span><a class="code" href="structbreakpoint.html">breakpoint</a> *b;
<a name="l01790"></a>01790   <span class="keyword">struct </span><a class="code" href="structtrace__state__variable.html">trace_state_variable</a> *tsv;
<a name="l01791"></a>01791   <span class="keywordtype">int</span> any_enabled = 0, num_to_download = 0;
<a name="l01792"></a>01792   <span class="keywordtype">int</span> ret;
<a name="l01793"></a>01793 
<a name="l01794"></a>01794   tp_vec = all_tracepoints ();
<a name="l01795"></a>01795 
<a name="l01796"></a>01796   <span class="comment">/* No point in tracing without any tracepoints...  */</span>
<a name="l01797"></a>01797   <span class="keywordflow">if</span> (<a class="code" href="vec_8h.html#a844523bba6d0565ef73a0f4a63e48d19">VEC_length</a> (<a class="code" href="structbreakpoint.html">breakpoint_p</a>, tp_vec) == 0)
<a name="l01798"></a>01798     {
<a name="l01799"></a>01799       <a class="code" href="vec_8h.html#af5724b2bbce65103300279f9abe7f577">VEC_free</a> (<a class="code" href="structbreakpoint.html">breakpoint_p</a>, tp_vec);
<a name="l01800"></a>01800       <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No tracepoints defined, not starting trace&quot;</span>));
<a name="l01801"></a>01801     }
<a name="l01802"></a>01802 
<a name="l01803"></a>01803   <span class="keywordflow">for</span> (ix = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="structbreakpoint.html">breakpoint_p</a>, tp_vec, ix, b); ix++)
<a name="l01804"></a>01804     {
<a name="l01805"></a>01805       <span class="keyword">struct </span><a class="code" href="structtracepoint.html">tracepoint</a> *t = (<span class="keyword">struct </span><a class="code" href="structtracepoint.html">tracepoint</a> *) b;
<a name="l01806"></a>01806       <span class="keyword">struct </span><a class="code" href="structbp__location.html">bp_location</a> *loc;
<a name="l01807"></a>01807 
<a name="l01808"></a>01808       <span class="keywordflow">if</span> (b-&gt;<a class="code" href="structbreakpoint.html#acb53352fd35aaad37054508fabc0f3bf">enable_state</a> == <a class="code" href="breakpoint_8h.html#ad50d69fd76a14436ad8f4db078baa577a72f1fa981d13a62d05324c1de974b44b">bp_enabled</a>)
<a name="l01809"></a>01809         any_enabled = 1;
<a name="l01810"></a>01810 
<a name="l01811"></a>01811       <span class="keywordflow">if</span> ((b-&gt;<a class="code" href="structbreakpoint.html#aefce6e7d22540b3fffaecd1264a0f73f">type</a> == <a class="code" href="breakpoint_8h.html#a67735d134567a4ba184d011f1db556cfa563d27bd02a1303a86081828b40002db">bp_fast_tracepoint</a>
<a name="l01812"></a>01812            ? <a class="code" href="target_8h.html#a9a0a5ff66e8504d629581b1915ba8ee5">may_insert_fast_tracepoints</a>
<a name="l01813"></a>01813            : <a class="code" href="target_8h.html#ad0f1e9e3a624ba3be95ab9321d042a4b">may_insert_tracepoints</a>))
<a name="l01814"></a>01814         ++num_to_download;
<a name="l01815"></a>01815       <span class="keywordflow">else</span>
<a name="l01816"></a>01816         <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;May not insert %stracepoints, skipping tracepoint %d&quot;</span>),
<a name="l01817"></a>01817                  (b-&gt;<a class="code" href="structbreakpoint.html#aefce6e7d22540b3fffaecd1264a0f73f">type</a> == <a class="code" href="breakpoint_8h.html#a67735d134567a4ba184d011f1db556cfa563d27bd02a1303a86081828b40002db">bp_fast_tracepoint</a> ? <span class="stringliteral">&quot;fast &quot;</span> : <span class="stringliteral">&quot;&quot;</span>), b-&gt;<a class="code" href="structbreakpoint.html#aa46a2ab4a5f2ae1e42412c412997871b">number</a>);
<a name="l01818"></a>01818     }
<a name="l01819"></a>01819 
<a name="l01820"></a>01820   <span class="keywordflow">if</span> (!any_enabled)
<a name="l01821"></a>01821     {
<a name="l01822"></a>01822       <span class="keywordflow">if</span> (<a class="code" href="target_8h.html#ab7943bd804233ce9d742037eb6398579">target_supports_enable_disable_tracepoint</a> ())
<a name="l01823"></a>01823         <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No tracepoints enabled&quot;</span>));
<a name="l01824"></a>01824       <span class="keywordflow">else</span>
<a name="l01825"></a>01825         {
<a name="l01826"></a>01826           <span class="comment">/* No point in tracing with only disabled tracepoints that</span>
<a name="l01827"></a>01827 <span class="comment">             cannot be re-enabled.  */</span>
<a name="l01828"></a>01828           <a class="code" href="vec_8h.html#af5724b2bbce65103300279f9abe7f577">VEC_free</a> (<a class="code" href="structbreakpoint.html">breakpoint_p</a>, tp_vec);
<a name="l01829"></a>01829           <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No tracepoints enabled, not starting trace&quot;</span>));
<a name="l01830"></a>01830         }
<a name="l01831"></a>01831     }
<a name="l01832"></a>01832 
<a name="l01833"></a>01833   <span class="keywordflow">if</span> (num_to_download &lt;= 0)
<a name="l01834"></a>01834     {
<a name="l01835"></a>01835       <a class="code" href="vec_8h.html#af5724b2bbce65103300279f9abe7f577">VEC_free</a> (<a class="code" href="structbreakpoint.html">breakpoint_p</a>, tp_vec);
<a name="l01836"></a>01836       <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No tracepoints that may be downloaded, not starting trace&quot;</span>));
<a name="l01837"></a>01837     }
<a name="l01838"></a>01838 
<a name="l01839"></a>01839   <a class="code" href="target_8h.html#a67dd9a54140003e478b853beaff9d3b7">target_trace_init</a> ();
<a name="l01840"></a>01840 
<a name="l01841"></a>01841   <span class="keywordflow">for</span> (ix = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="structbreakpoint.html">breakpoint_p</a>, tp_vec, ix, b); ix++)
<a name="l01842"></a>01842     {
<a name="l01843"></a>01843       <span class="keyword">struct </span><a class="code" href="structtracepoint.html">tracepoint</a> *t = (<span class="keyword">struct </span><a class="code" href="structtracepoint.html">tracepoint</a> *) b;
<a name="l01844"></a>01844       <span class="keyword">struct </span><a class="code" href="structbp__location.html">bp_location</a> *loc;
<a name="l01845"></a>01845       <span class="keywordtype">int</span> bp_location_downloaded = 0;
<a name="l01846"></a>01846 
<a name="l01847"></a>01847       <span class="comment">/* Clear `inserted&#39; flag.  */</span>
<a name="l01848"></a>01848       <span class="keywordflow">for</span> (loc = b-&gt;<a class="code" href="structbreakpoint.html#aa869260f7e4c94204275861d820bb1a9">loc</a>; loc; loc = loc-&gt;<a class="code" href="structbp__location.html#ab193cb38f87fea89105db96d94191541">next</a>)
<a name="l01849"></a>01849         loc-&gt;<a class="code" href="structbp__location.html#acb0b475579bbe5dabeb8ed4504527105">inserted</a> = 0;
<a name="l01850"></a>01850 
<a name="l01851"></a>01851       <span class="keywordflow">if</span> ((b-&gt;<a class="code" href="structbreakpoint.html#aefce6e7d22540b3fffaecd1264a0f73f">type</a> == <a class="code" href="breakpoint_8h.html#a67735d134567a4ba184d011f1db556cfa563d27bd02a1303a86081828b40002db">bp_fast_tracepoint</a>
<a name="l01852"></a>01852            ? !<a class="code" href="target_8h.html#a9a0a5ff66e8504d629581b1915ba8ee5">may_insert_fast_tracepoints</a>
<a name="l01853"></a>01853            : !<a class="code" href="target_8h.html#ad0f1e9e3a624ba3be95ab9321d042a4b">may_insert_tracepoints</a>))
<a name="l01854"></a>01854         <span class="keywordflow">continue</span>;
<a name="l01855"></a>01855 
<a name="l01856"></a>01856       t-&gt;<a class="code" href="structtracepoint.html#a32f485dd859434fab98013e1738187d7">number_on_target</a> = 0;
<a name="l01857"></a>01857 
<a name="l01858"></a>01858       <span class="keywordflow">for</span> (loc = b-&gt;<a class="code" href="structbreakpoint.html#aa869260f7e4c94204275861d820bb1a9">loc</a>; loc; loc = loc-&gt;<a class="code" href="structbp__location.html#ab193cb38f87fea89105db96d94191541">next</a>)
<a name="l01859"></a>01859         {
<a name="l01860"></a>01860           <span class="comment">/* Since tracepoint locations are never duplicated, `inserted&#39;</span>
<a name="l01861"></a>01861 <span class="comment">             flag should be zero.  */</span>
<a name="l01862"></a>01862           <a class="code" href="gdb__assert_8h.html#aeb007d3e990858c7ef8e40a7e512c1ff">gdb_assert</a> (!loc-&gt;<a class="code" href="structbp__location.html#acb0b475579bbe5dabeb8ed4504527105">inserted</a>);
<a name="l01863"></a>01863 
<a name="l01864"></a>01864           <a class="code" href="target_8h.html#a7fd80fa7dbdf49fbf15e93f98e9480ef">target_download_tracepoint</a> (loc);
<a name="l01865"></a>01865 
<a name="l01866"></a>01866           loc-&gt;<a class="code" href="structbp__location.html#acb0b475579bbe5dabeb8ed4504527105">inserted</a> = 1;
<a name="l01867"></a>01867           bp_location_downloaded = 1;
<a name="l01868"></a>01868         }
<a name="l01869"></a>01869 
<a name="l01870"></a>01870       t-&gt;<a class="code" href="structtracepoint.html#a32f485dd859434fab98013e1738187d7">number_on_target</a> = b-&gt;<a class="code" href="structbreakpoint.html#aa46a2ab4a5f2ae1e42412c412997871b">number</a>;
<a name="l01871"></a>01871 
<a name="l01872"></a>01872       <span class="keywordflow">for</span> (loc = b-&gt;<a class="code" href="structbreakpoint.html#aa869260f7e4c94204275861d820bb1a9">loc</a>; loc; loc = loc-&gt;<a class="code" href="structbp__location.html#ab193cb38f87fea89105db96d94191541">next</a>)
<a name="l01873"></a>01873         <span class="keywordflow">if</span> (loc-&gt;<a class="code" href="structbp__location.html#a848151cbedd05ac5a77d211aea60a013">probe</a> != NULL)
<a name="l01874"></a>01874           loc-&gt;<a class="code" href="structbp__location.html#a848151cbedd05ac5a77d211aea60a013">probe</a>-&gt;<a class="code" href="structprobe.html#a3dccc3dce7fb807c3638af97192bbb1c">pops</a>-&gt;<a class="code" href="structprobe__ops.html#ae0abc1f99919ca0a5874232e16998d41">set_semaphore</a> (loc-&gt;<a class="code" href="structbp__location.html#a848151cbedd05ac5a77d211aea60a013">probe</a>, loc-&gt;<a class="code" href="structbp__location.html#a55f3ff99d536775f5095f11e5f5c3f3e">gdbarch</a>);
<a name="l01875"></a>01875 
<a name="l01876"></a>01876       <span class="keywordflow">if</span> (bp_location_downloaded)
<a name="l01877"></a>01877         <a class="code" href="observer_8h.html#a3edacfe44ac49f71646caded92072cad">observer_notify_breakpoint_modified</a> (b);
<a name="l01878"></a>01878     }
<a name="l01879"></a>01879   <a class="code" href="vec_8h.html#af5724b2bbce65103300279f9abe7f577">VEC_free</a> (<a class="code" href="structbreakpoint.html">breakpoint_p</a>, tp_vec);
<a name="l01880"></a>01880 
<a name="l01881"></a>01881   <span class="comment">/* Send down all the trace state variables too.  */</span>
<a name="l01882"></a>01882   <span class="keywordflow">for</span> (ix = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="structtrace__state__variable.html">tsv_s</a>, tvariables, ix, tsv); ++ix)
<a name="l01883"></a>01883     {
<a name="l01884"></a>01884       <a class="code" href="target_8h.html#a3dc571d0a43cede3920ba48cc9be4609">target_download_trace_state_variable</a> (tsv);
<a name="l01885"></a>01885     }
<a name="l01886"></a>01886   
<a name="l01887"></a>01887   <span class="comment">/* Tell target to treat text-like sections as transparent.  */</span>
<a name="l01888"></a>01888   <a class="code" href="target_8h.html#abe4f81251ab45522b4cb64938e06d3a8">target_trace_set_readonly_regions</a> ();
<a name="l01889"></a>01889   <span class="comment">/* Set some mode flags.  */</span>
<a name="l01890"></a>01890   <a class="code" href="target_8h.html#afdb0a947ae5efc979edeea4585bd09ad">target_set_disconnected_tracing</a> (disconnected_tracing);
<a name="l01891"></a>01891   <a class="code" href="target_8h.html#ad01c945e577448f4295956185ae7efba">target_set_circular_trace_buffer</a> (circular_trace_buffer);
<a name="l01892"></a>01892   <a class="code" href="target_8h.html#a384639dc9b25a1caed3311bf193f7274">target_set_trace_buffer_size</a> (trace_buffer_size);
<a name="l01893"></a>01893 
<a name="l01894"></a>01894   <span class="keywordflow">if</span> (!notes)
<a name="l01895"></a>01895     notes = trace_notes;
<a name="l01896"></a>01896   ret = <a class="code" href="target_8h.html#ad4847e47bef87ffacdd66828f2596439">target_set_trace_notes</a> (trace_user, notes, NULL);
<a name="l01897"></a>01897 
<a name="l01898"></a>01898   <span class="keywordflow">if</span> (!ret &amp;&amp; (trace_user || notes))
<a name="l01899"></a>01899     <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Target does not support trace user/notes, info ignored&quot;</span>));
<a name="l01900"></a>01900 
<a name="l01901"></a>01901   <span class="comment">/* Now insert traps and begin collecting data.  */</span>
<a name="l01902"></a>01902   <a class="code" href="target_8h.html#af6ee06798069a51157d94d519ba240ed">target_trace_start</a> ();
<a name="l01903"></a>01903 
<a name="l01904"></a>01904   <span class="comment">/* Reset our local state.  */</span>
<a name="l01905"></a>01905   <a class="code" href="tracepoint_8c.html#a8ab20f1eb477238f562e37831e9f6038">trace_reset_local_state</a> ();
<a name="l01906"></a>01906   <a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a>()-&gt;<a class="code" href="structtrace__status.html#af1d922d381deda9d03faa4406c0a36de">running</a> = 1;
<a name="l01907"></a>01907 }
<a name="l01908"></a>01908 
<a name="l01909"></a>01909 <span class="comment">/* The tstart command requests the target to start a new trace run.</span>
<a name="l01910"></a>01910 <span class="comment">   The command passes any arguments it has to the target verbatim, as</span>
<a name="l01911"></a>01911 <span class="comment">   an optional &quot;trace note&quot;.  This is useful as for instance a warning</span>
<a name="l01912"></a>01912 <span class="comment">   to other users if the trace runs disconnected, and you don&#39;t want</span>
<a name="l01913"></a>01913 <span class="comment">   anybody else messing with the target.  */</span>
<a name="l01914"></a>01914 
<a name="l01915"></a>01915 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01916"></a>01916 trace_start_command (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l01917"></a>01917 {
<a name="l01918"></a>01918   <a class="code" href="command_8h.html#ac7af34b03605d65b114a173d49532050">dont_repeat</a> ();       <span class="comment">/* Like &quot;run&quot;, dangerous to repeat accidentally.  */</span>
<a name="l01919"></a>01919 
<a name="l01920"></a>01920   <span class="keywordflow">if</span> (<a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> ()-&gt;running)
<a name="l01921"></a>01921     {
<a name="l01922"></a>01922       <span class="keywordflow">if</span> (from_tty
<a name="l01923"></a>01923           &amp;&amp; !<a class="code" href="utils_8c.html#a4b369431cd1ce5d26bccf6b79a44c085">query</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;A trace is running already.  Start a new run? &quot;</span>)))
<a name="l01924"></a>01924         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;New trace run not started.&quot;</span>));
<a name="l01925"></a>01925     }
<a name="l01926"></a>01926 
<a name="l01927"></a>01927   <a class="code" href="tracepoint_8c.html#a8bc87fc32433bb5c4df5a2774c2dc2cc">start_tracing</a> (args);
<a name="l01928"></a>01928 }
<a name="l01929"></a>01929 
<a name="l01930"></a>01930 <span class="comment">/* The tstop command stops the tracing run.  The command passes any</span>
<a name="l01931"></a>01931 <span class="comment">   supplied arguments to the target verbatim as a &quot;stop note&quot;; if the</span>
<a name="l01932"></a>01932 <span class="comment">   target supports trace notes, then it will be reported back as part</span>
<a name="l01933"></a>01933 <span class="comment">   of the trace run&#39;s status.  */</span>
<a name="l01934"></a>01934 
<a name="l01935"></a>01935 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01936"></a>01936 trace_stop_command (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l01937"></a>01937 {
<a name="l01938"></a>01938   <span class="keywordflow">if</span> (!<a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> ()-&gt;running)
<a name="l01939"></a>01939     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace is not running.&quot;</span>));
<a name="l01940"></a>01940 
<a name="l01941"></a>01941   <a class="code" href="tracepoint_8c.html#a26bc954d51daa144c78d9649e02c2091">stop_tracing</a> (args);
<a name="l01942"></a>01942 }
<a name="l01943"></a>01943 
<a name="l01944"></a>01944 <span class="keywordtype">void</span>
<a name="l01945"></a><a class="code" href="tracepoint_8h.html#a0b216d99c1f1c533a641ebbfb339fd19">01945</a> <a class="code" href="tracepoint_8c.html#a26bc954d51daa144c78d9649e02c2091">stop_tracing</a> (<span class="keywordtype">char</span> *note)
<a name="l01946"></a>01946 {
<a name="l01947"></a>01947   <span class="keywordtype">int</span> ret;
<a name="l01948"></a>01948   <a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a>(<a class="code" href="structbreakpoint.html">breakpoint_p</a>) *tp_vec = NULL;
<a name="l01949"></a>01949   <span class="keywordtype">int</span> ix;
<a name="l01950"></a>01950   <span class="keyword">struct </span><a class="code" href="structbreakpoint.html">breakpoint</a> *t;
<a name="l01951"></a>01951 
<a name="l01952"></a>01952   <a class="code" href="target_8h.html#aa7ed1d64f4d32b9c0ed2683fa1b48186">target_trace_stop</a> ();
<a name="l01953"></a>01953 
<a name="l01954"></a>01954   tp_vec = all_tracepoints ();
<a name="l01955"></a>01955   <span class="keywordflow">for</span> (ix = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="structbreakpoint.html">breakpoint_p</a>, tp_vec, ix, t); ix++)
<a name="l01956"></a>01956     {
<a name="l01957"></a>01957       <span class="keyword">struct </span><a class="code" href="structbp__location.html">bp_location</a> *loc;
<a name="l01958"></a>01958 
<a name="l01959"></a>01959       <span class="keywordflow">if</span> ((t-&gt;<a class="code" href="structbreakpoint.html#aefce6e7d22540b3fffaecd1264a0f73f">type</a> == <a class="code" href="breakpoint_8h.html#a67735d134567a4ba184d011f1db556cfa563d27bd02a1303a86081828b40002db">bp_fast_tracepoint</a>
<a name="l01960"></a>01960            ? !<a class="code" href="target_8h.html#a9a0a5ff66e8504d629581b1915ba8ee5">may_insert_fast_tracepoints</a>
<a name="l01961"></a>01961            : !<a class="code" href="target_8h.html#ad0f1e9e3a624ba3be95ab9321d042a4b">may_insert_tracepoints</a>))
<a name="l01962"></a>01962         <span class="keywordflow">continue</span>;
<a name="l01963"></a>01963 
<a name="l01964"></a>01964       <span class="keywordflow">for</span> (loc = t-&gt;<a class="code" href="structbreakpoint.html#aa869260f7e4c94204275861d820bb1a9">loc</a>; loc; loc = loc-&gt;<a class="code" href="structbp__location.html#ab193cb38f87fea89105db96d94191541">next</a>)
<a name="l01965"></a>01965         {
<a name="l01966"></a>01966           <span class="comment">/* GDB can be totally absent in some disconnected trace scenarios,</span>
<a name="l01967"></a>01967 <span class="comment">             but we don&#39;t really care if this semaphore goes out of sync.</span>
<a name="l01968"></a>01968 <span class="comment">             That&#39;s why we are decrementing it here, but not taking care</span>
<a name="l01969"></a>01969 <span class="comment">             in other places.  */</span>
<a name="l01970"></a>01970           <span class="keywordflow">if</span> (loc-&gt;<a class="code" href="structbp__location.html#a848151cbedd05ac5a77d211aea60a013">probe</a> != NULL)
<a name="l01971"></a>01971             loc-&gt;<a class="code" href="structbp__location.html#a848151cbedd05ac5a77d211aea60a013">probe</a>-&gt;<a class="code" href="structprobe.html#a3dccc3dce7fb807c3638af97192bbb1c">pops</a>-&gt;<a class="code" href="structprobe__ops.html#a73b95a91aebe6d1a4379a0e995bb1c66">clear_semaphore</a> (loc-&gt;<a class="code" href="structbp__location.html#a848151cbedd05ac5a77d211aea60a013">probe</a>, loc-&gt;<a class="code" href="structbp__location.html#a55f3ff99d536775f5095f11e5f5c3f3e">gdbarch</a>);
<a name="l01972"></a>01972         }
<a name="l01973"></a>01973     }
<a name="l01974"></a>01974 
<a name="l01975"></a>01975   <a class="code" href="vec_8h.html#af5724b2bbce65103300279f9abe7f577">VEC_free</a> (<a class="code" href="structbreakpoint.html">breakpoint_p</a>, tp_vec);
<a name="l01976"></a>01976 
<a name="l01977"></a>01977   <span class="keywordflow">if</span> (!note)
<a name="l01978"></a>01978     note = trace_stop_notes;
<a name="l01979"></a>01979   ret = <a class="code" href="target_8h.html#ad4847e47bef87ffacdd66828f2596439">target_set_trace_notes</a> (NULL, NULL, note);
<a name="l01980"></a>01980 
<a name="l01981"></a>01981   <span class="keywordflow">if</span> (!ret &amp;&amp; note)
<a name="l01982"></a>01982     <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Target does not support trace notes, note ignored&quot;</span>));
<a name="l01983"></a>01983 
<a name="l01984"></a>01984   <span class="comment">/* Should change in response to reply?  */</span>
<a name="l01985"></a>01985   <a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> ()-&gt;<a class="code" href="structtrace__status.html#af1d922d381deda9d03faa4406c0a36de">running</a> = 0;
<a name="l01986"></a>01986 }
<a name="l01987"></a>01987 
<a name="l01988"></a>01988 <span class="comment">/* tstatus command */</span>
<a name="l01989"></a>01989 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01990"></a>01990 trace_status_command (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l01991"></a>01991 {
<a name="l01992"></a>01992   <span class="keyword">struct </span><a class="code" href="structtrace__status.html">trace_status</a> *ts = <a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> ();
<a name="l01993"></a>01993   <span class="keywordtype">int</span> <a class="code" href="namespaceexsummary.html#aa4a2eed06e51a1f73ff9053ec9f2591e">status</a>, ix;
<a name="l01994"></a>01994   <a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a>(<a class="code" href="structbreakpoint.html">breakpoint_p</a>) *tp_vec = NULL;
<a name="l01995"></a>01995   <span class="keyword">struct </span><a class="code" href="structbreakpoint.html">breakpoint</a> *t;
<a name="l01996"></a>01996   
<a name="l01997"></a>01997   status = <a class="code" href="target_8h.html#ad3a877c0f56ac304d3ddb3b8a19fc4d3">target_get_trace_status</a> (ts);
<a name="l01998"></a>01998 
<a name="l01999"></a>01999   <span class="keywordflow">if</span> (status == -1)
<a name="l02000"></a>02000     {
<a name="l02001"></a>02001       <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#af3f61c2f2d9622d13b58138c9a38bdbd">filename</a> != NULL)
<a name="l02002"></a>02002         <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Using a trace file.\n&quot;</span>));
<a name="l02003"></a>02003       <span class="keywordflow">else</span>
<a name="l02004"></a>02004         {
<a name="l02005"></a>02005           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace can not be run on this target.\n&quot;</span>));
<a name="l02006"></a>02006           <span class="keywordflow">return</span>;
<a name="l02007"></a>02007         }
<a name="l02008"></a>02008     }
<a name="l02009"></a>02009 
<a name="l02010"></a>02010   <span class="keywordflow">if</span> (!ts-&gt;<a class="code" href="structtrace__status.html#a22da5a4e4555b5b86e8b2aeaf80763d2">running_known</a>)
<a name="l02011"></a>02011     {
<a name="l02012"></a>02012       <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Run/stop status is unknown.\n&quot;</span>));
<a name="l02013"></a>02013     }
<a name="l02014"></a>02014   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#af1d922d381deda9d03faa4406c0a36de">running</a>)
<a name="l02015"></a>02015     {
<a name="l02016"></a>02016       <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace is running on the target.\n&quot;</span>));
<a name="l02017"></a>02017     }
<a name="l02018"></a>02018   <span class="keywordflow">else</span>
<a name="l02019"></a>02019     {
<a name="l02020"></a>02020       <span class="keywordflow">switch</span> (ts-&gt;<a class="code" href="structtrace__status.html#af5d4f9904d71961dd065b57fed099644">stop_reason</a>)
<a name="l02021"></a>02021         {
<a name="l02022"></a>02022         <span class="keywordflow">case</span> <a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77ad90bfa1c8b065d0f315d52c00991d313">trace_never_run</a>:
<a name="l02023"></a>02023           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No trace has been run on the target.\n&quot;</span>));
<a name="l02024"></a>02024           <span class="keywordflow">break</span>;
<a name="l02025"></a>02025         <span class="keywordflow">case</span> <a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77a058a54e86734f1069cf989782b9b9f22">tstop_command</a>:
<a name="l02026"></a>02026           <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#a4d5e182f56e3793df49d65abb8e8c456">stop_desc</a>)
<a name="l02027"></a>02027             <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace stopped by a tstop command (%s).\n&quot;</span>),
<a name="l02028"></a>02028                              ts-&gt;<a class="code" href="structtrace__status.html#a4d5e182f56e3793df49d65abb8e8c456">stop_desc</a>);
<a name="l02029"></a>02029           <span class="keywordflow">else</span>
<a name="l02030"></a>02030             <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace stopped by a tstop command.\n&quot;</span>));
<a name="l02031"></a>02031           <span class="keywordflow">break</span>;
<a name="l02032"></a>02032         <span class="keywordflow">case</span> <a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77a058f3c6aa59a1d63de69842e78774620">trace_buffer_full</a>:
<a name="l02033"></a>02033           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace stopped because the buffer was full.\n&quot;</span>));
<a name="l02034"></a>02034           <span class="keywordflow">break</span>;
<a name="l02035"></a>02035         <span class="keywordflow">case</span> <a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77ad1f9afda06631fe6c07ac32cac341f27">trace_disconnected</a>:
<a name="l02036"></a>02036           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace stopped because of disconnection.\n&quot;</span>));
<a name="l02037"></a>02037           <span class="keywordflow">break</span>;
<a name="l02038"></a>02038         <span class="keywordflow">case</span> <a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77ad5383255900f5832f492c7b0937ea741">tracepoint_passcount</a>:
<a name="l02039"></a>02039           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace stopped by tracepoint %d.\n&quot;</span>),
<a name="l02040"></a>02040                            ts-&gt;<a class="code" href="structtrace__status.html#ad22500bfd24188778985319a545c42d1">stopping_tracepoint</a>);
<a name="l02041"></a>02041           <span class="keywordflow">break</span>;
<a name="l02042"></a>02042         <span class="keywordflow">case</span> <a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77a4a52d08e789e2e817131f822384872c3">tracepoint_error</a>:
<a name="l02043"></a>02043           <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#ad22500bfd24188778985319a545c42d1">stopping_tracepoint</a>)
<a name="l02044"></a>02044             <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace stopped by an &quot;</span>
<a name="l02045"></a>02045                                <span class="stringliteral">&quot;error (%s, tracepoint %d).\n&quot;</span>),
<a name="l02046"></a>02046                              ts-&gt;<a class="code" href="structtrace__status.html#a4d5e182f56e3793df49d65abb8e8c456">stop_desc</a>, ts-&gt;<a class="code" href="structtrace__status.html#ad22500bfd24188778985319a545c42d1">stopping_tracepoint</a>);
<a name="l02047"></a>02047           <span class="keywordflow">else</span>
<a name="l02048"></a>02048             <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace stopped by an error (%s).\n&quot;</span>),
<a name="l02049"></a>02049                              ts-&gt;<a class="code" href="structtrace__status.html#a4d5e182f56e3793df49d65abb8e8c456">stop_desc</a>);
<a name="l02050"></a>02050           <span class="keywordflow">break</span>;
<a name="l02051"></a>02051         <span class="keywordflow">case</span> <a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77aeac56e2eee7510675fa2c3fd1306b67d">trace_stop_reason_unknown</a>:
<a name="l02052"></a>02052           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace stopped for an unknown reason.\n&quot;</span>));
<a name="l02053"></a>02053           <span class="keywordflow">break</span>;
<a name="l02054"></a>02054         <span class="keywordflow">default</span>:
<a name="l02055"></a>02055           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace stopped for some other reason (%d).\n&quot;</span>),
<a name="l02056"></a>02056                            ts-&gt;<a class="code" href="structtrace__status.html#af5d4f9904d71961dd065b57fed099644">stop_reason</a>);
<a name="l02057"></a>02057           <span class="keywordflow">break</span>;
<a name="l02058"></a>02058         }
<a name="l02059"></a>02059     }
<a name="l02060"></a>02060 
<a name="l02061"></a>02061   <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#a96ec1749e52d1943618c0df3ee457979">traceframes_created</a> &gt;= 0
<a name="l02062"></a>02062       &amp;&amp; ts-&gt;<a class="code" href="structtrace__status.html#aebfcf3df70568e7ae65480c1f4efe0f6">traceframe_count</a> != ts-&gt;<a class="code" href="structtrace__status.html#a96ec1749e52d1943618c0df3ee457979">traceframes_created</a>)
<a name="l02063"></a>02063     {
<a name="l02064"></a>02064       <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Buffer contains %d trace &quot;</span>
<a name="l02065"></a>02065                          <span class="stringliteral">&quot;frames (of %d created total).\n&quot;</span>),
<a name="l02066"></a>02066                        ts-&gt;<a class="code" href="structtrace__status.html#aebfcf3df70568e7ae65480c1f4efe0f6">traceframe_count</a>, ts-&gt;<a class="code" href="structtrace__status.html#a96ec1749e52d1943618c0df3ee457979">traceframes_created</a>);
<a name="l02067"></a>02067     }
<a name="l02068"></a>02068   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#aebfcf3df70568e7ae65480c1f4efe0f6">traceframe_count</a> &gt;= 0)
<a name="l02069"></a>02069     {
<a name="l02070"></a>02070       <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Collected %d trace frames.\n&quot;</span>),
<a name="l02071"></a>02071                        ts-&gt;<a class="code" href="structtrace__status.html#aebfcf3df70568e7ae65480c1f4efe0f6">traceframe_count</a>);
<a name="l02072"></a>02072     }
<a name="l02073"></a>02073 
<a name="l02074"></a>02074   <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#ac6f0b3903e2ab671c95dec8bf674f15b">buffer_free</a> &gt;= 0)
<a name="l02075"></a>02075     {
<a name="l02076"></a>02076       <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#a409141fb583ccaef669f996dd68a2fe0">buffer_size</a> &gt;= 0)
<a name="l02077"></a>02077         {
<a name="l02078"></a>02078           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace buffer has %d bytes of %d bytes free&quot;</span>),
<a name="l02079"></a>02079                            ts-&gt;<a class="code" href="structtrace__status.html#ac6f0b3903e2ab671c95dec8bf674f15b">buffer_free</a>, ts-&gt;<a class="code" href="structtrace__status.html#a409141fb583ccaef669f996dd68a2fe0">buffer_size</a>);
<a name="l02080"></a>02080           <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#a409141fb583ccaef669f996dd68a2fe0">buffer_size</a> &gt; 0)
<a name="l02081"></a>02081             <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot; (%d%% full)&quot;</span>),
<a name="l02082"></a>02082                              ((<span class="keywordtype">int</span>) ((((<span class="keywordtype">long</span> <span class="keywordtype">long</span>) (ts-&gt;<a class="code" href="structtrace__status.html#a409141fb583ccaef669f996dd68a2fe0">buffer_size</a>
<a name="l02083"></a>02083                                                     - ts-&gt;<a class="code" href="structtrace__status.html#ac6f0b3903e2ab671c95dec8bf674f15b">buffer_free</a>)) * 100)
<a name="l02084"></a>02084                                      / ts-&gt;<a class="code" href="structtrace__status.html#a409141fb583ccaef669f996dd68a2fe0">buffer_size</a>)));
<a name="l02085"></a>02085           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;.\n&quot;</span>));
<a name="l02086"></a>02086         }
<a name="l02087"></a>02087       <span class="keywordflow">else</span>
<a name="l02088"></a>02088         <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace buffer has %d bytes free.\n&quot;</span>),
<a name="l02089"></a>02089                          ts-&gt;<a class="code" href="structtrace__status.html#ac6f0b3903e2ab671c95dec8bf674f15b">buffer_free</a>);
<a name="l02090"></a>02090     }
<a name="l02091"></a>02091 
<a name="l02092"></a>02092   <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#a11a975b86259c84816c3341d32e2fca7">disconnected_tracing</a>)
<a name="l02093"></a>02093     <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace will continue if GDB disconnects.\n&quot;</span>));
<a name="l02094"></a>02094   <span class="keywordflow">else</span>
<a name="l02095"></a>02095     <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace will stop if GDB disconnects.\n&quot;</span>));
<a name="l02096"></a>02096 
<a name="l02097"></a>02097   <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#ad6afd6f38f37406b22b83ea67dd2b027">circular_buffer</a>)
<a name="l02098"></a>02098     <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace buffer is circular.\n&quot;</span>));
<a name="l02099"></a>02099 
<a name="l02100"></a>02100   <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#ae84456b65c09a38fcf8f63ed58a78f04">user_name</a> &amp;&amp; strlen (ts-&gt;<a class="code" href="structtrace__status.html#ae84456b65c09a38fcf8f63ed58a78f04">user_name</a>) &gt; 0)
<a name="l02101"></a>02101     <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace user is %s.\n&quot;</span>), ts-&gt;<a class="code" href="structtrace__status.html#ae84456b65c09a38fcf8f63ed58a78f04">user_name</a>);
<a name="l02102"></a>02102 
<a name="l02103"></a>02103   <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#a114142bb0c3aa89b765bce9e26bd399c">notes</a> &amp;&amp; strlen (ts-&gt;<a class="code" href="structtrace__status.html#a114142bb0c3aa89b765bce9e26bd399c">notes</a>) &gt; 0)
<a name="l02104"></a>02104     <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace notes: %s.\n&quot;</span>), ts-&gt;<a class="code" href="structtrace__status.html#a114142bb0c3aa89b765bce9e26bd399c">notes</a>);
<a name="l02105"></a>02105 
<a name="l02106"></a>02106   <span class="comment">/* Now report on what we&#39;re doing with tfind.  */</span>
<a name="l02107"></a>02107   <span class="keywordflow">if</span> (traceframe_number &gt;= 0)
<a name="l02108"></a>02108     <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Looking at trace frame %d, tracepoint %d.\n&quot;</span>),
<a name="l02109"></a>02109                      traceframe_number, tracepoint_number);
<a name="l02110"></a>02110   <span class="keywordflow">else</span>
<a name="l02111"></a>02111     <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Not looking at any trace frame.\n&quot;</span>));
<a name="l02112"></a>02112 
<a name="l02113"></a>02113   <span class="comment">/* Report start/stop times if supplied.  */</span>
<a name="l02114"></a>02114   <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#acaf0437f240f26a40362a34707353e7c">start_time</a>)
<a name="l02115"></a>02115     {
<a name="l02116"></a>02116       <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#a996a6a416f9e35c599215973dc2c6928">stop_time</a>)
<a name="l02117"></a>02117         {
<a name="l02118"></a>02118           <a class="code" href="defs_8h.html#ac7647a3f71533007c9e128f3ddda1987">LONGEST</a> run_time = ts-&gt;<a class="code" href="structtrace__status.html#a996a6a416f9e35c599215973dc2c6928">stop_time</a> - ts-&gt;<a class="code" href="structtrace__status.html#acaf0437f240f26a40362a34707353e7c">start_time</a>;
<a name="l02119"></a>02119 
<a name="l02120"></a>02120           <span class="comment">/* Reporting a run time is more readable than two long numbers.  */</span>
<a name="l02121"></a>02121           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace started at %ld.%06ld secs, stopped %ld.%06ld secs later.\n&quot;</span>),
<a name="l02122"></a>02122                            (<span class="keywordtype">long</span> <span class="keywordtype">int</span>) (ts-&gt;<a class="code" href="structtrace__status.html#acaf0437f240f26a40362a34707353e7c">start_time</a> / 1000000),
<a name="l02123"></a>02123                            (<span class="keywordtype">long</span> <span class="keywordtype">int</span>) (ts-&gt;<a class="code" href="structtrace__status.html#acaf0437f240f26a40362a34707353e7c">start_time</a> % 1000000),
<a name="l02124"></a>02124                            (<span class="keywordtype">long</span> <span class="keywordtype">int</span>) (run_time / 1000000),
<a name="l02125"></a>02125                            (<span class="keywordtype">long</span> <span class="keywordtype">int</span>) (run_time % 1000000));
<a name="l02126"></a>02126         }
<a name="l02127"></a>02127       <span class="keywordflow">else</span>
<a name="l02128"></a>02128         <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace started at %ld.%06ld secs.\n&quot;</span>),
<a name="l02129"></a>02129                          (<span class="keywordtype">long</span> <span class="keywordtype">int</span>) (ts-&gt;<a class="code" href="structtrace__status.html#acaf0437f240f26a40362a34707353e7c">start_time</a> / 1000000),
<a name="l02130"></a>02130                          (<span class="keywordtype">long</span> <span class="keywordtype">int</span>) (ts-&gt;<a class="code" href="structtrace__status.html#acaf0437f240f26a40362a34707353e7c">start_time</a> % 1000000));
<a name="l02131"></a>02131     }
<a name="l02132"></a>02132   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#a996a6a416f9e35c599215973dc2c6928">stop_time</a>)
<a name="l02133"></a>02133     <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace stopped at %ld.%06ld secs.\n&quot;</span>),
<a name="l02134"></a>02134                      (<span class="keywordtype">long</span> <span class="keywordtype">int</span>) (ts-&gt;<a class="code" href="structtrace__status.html#a996a6a416f9e35c599215973dc2c6928">stop_time</a> / 1000000),
<a name="l02135"></a>02135                      (<span class="keywordtype">long</span> <span class="keywordtype">int</span>) (ts-&gt;<a class="code" href="structtrace__status.html#a996a6a416f9e35c599215973dc2c6928">stop_time</a> % 1000000));
<a name="l02136"></a>02136 
<a name="l02137"></a>02137   <span class="comment">/* Now report any per-tracepoint status available.  */</span>
<a name="l02138"></a>02138   tp_vec = all_tracepoints ();
<a name="l02139"></a>02139 
<a name="l02140"></a>02140   <span class="keywordflow">for</span> (ix = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="structbreakpoint.html">breakpoint_p</a>, tp_vec, ix, t); ix++)
<a name="l02141"></a>02141     <a class="code" href="target_8h.html#a4e32144454bcabb9bf5911a6d6e67a10">target_get_tracepoint_status</a> (t, NULL);
<a name="l02142"></a>02142 
<a name="l02143"></a>02143   <a class="code" href="vec_8h.html#af5724b2bbce65103300279f9abe7f577">VEC_free</a> (<a class="code" href="structbreakpoint.html">breakpoint_p</a>, tp_vec);
<a name="l02144"></a>02144 }
<a name="l02145"></a>02145 
<a name="l02146"></a>02146 <span class="comment">/* Report the trace status to uiout, in a way suitable for MI, and not</span>
<a name="l02147"></a>02147 <span class="comment">   suitable for CLI.  If ON_STOP is true, suppress a few fields that</span>
<a name="l02148"></a>02148 <span class="comment">   are not meaningful in the -trace-stop response.</span>
<a name="l02149"></a>02149 <span class="comment"></span>
<a name="l02150"></a>02150 <span class="comment">   The implementation is essentially parallel to trace_status_command, but</span>
<a name="l02151"></a>02151 <span class="comment">   merging them will result in unreadable code.  */</span>
<a name="l02152"></a>02152 <span class="keywordtype">void</span>
<a name="l02153"></a><a class="code" href="tracepoint_8h.html#ab313b62472b352ee3bb0abd5cf2a190d">02153</a> <a class="code" href="tracepoint_8c.html#ab313b62472b352ee3bb0abd5cf2a190d">trace_status_mi</a> (<span class="keywordtype">int</span> on_stop)
<a name="l02154"></a>02154 {
<a name="l02155"></a>02155   <span class="keyword">struct </span>ui_out *uiout = <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>;
<a name="l02156"></a>02156   <span class="keyword">struct </span><a class="code" href="structtrace__status.html">trace_status</a> *ts = <a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> ();
<a name="l02157"></a>02157   <span class="keywordtype">int</span> <a class="code" href="namespaceexsummary.html#aa4a2eed06e51a1f73ff9053ec9f2591e">status</a>;
<a name="l02158"></a>02158 
<a name="l02159"></a>02159   status = <a class="code" href="target_8h.html#ad3a877c0f56ac304d3ddb3b8a19fc4d3">target_get_trace_status</a> (ts);
<a name="l02160"></a>02160 
<a name="l02161"></a>02161   <span class="keywordflow">if</span> (status == -1 &amp;&amp; ts-&gt;<a class="code" href="structtrace__status.html#af3f61c2f2d9622d13b58138c9a38bdbd">filename</a> == NULL)
<a name="l02162"></a>02162     {
<a name="l02163"></a>02163       <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;supported&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>);
<a name="l02164"></a>02164       <span class="keywordflow">return</span>;
<a name="l02165"></a>02165     }
<a name="l02166"></a>02166 
<a name="l02167"></a>02167   <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#af3f61c2f2d9622d13b58138c9a38bdbd">filename</a> != NULL)
<a name="l02168"></a>02168     <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;supported&quot;</span>, <span class="stringliteral">&quot;file&quot;</span>);
<a name="l02169"></a>02169   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!on_stop)
<a name="l02170"></a>02170     <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;supported&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>);
<a name="l02171"></a>02171 
<a name="l02172"></a>02172   <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#af3f61c2f2d9622d13b58138c9a38bdbd">filename</a> != NULL)
<a name="l02173"></a>02173     <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;trace-file&quot;</span>, ts-&gt;<a class="code" href="structtrace__status.html#af3f61c2f2d9622d13b58138c9a38bdbd">filename</a>);
<a name="l02174"></a>02174 
<a name="l02175"></a>02175   <a class="code" href="gdb__assert_8h.html#aeb007d3e990858c7ef8e40a7e512c1ff">gdb_assert</a> (ts-&gt;<a class="code" href="structtrace__status.html#a22da5a4e4555b5b86e8b2aeaf80763d2">running_known</a>);
<a name="l02176"></a>02176 
<a name="l02177"></a>02177   <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#af1d922d381deda9d03faa4406c0a36de">running</a>)
<a name="l02178"></a>02178     {
<a name="l02179"></a>02179       <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;running&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>);
<a name="l02180"></a>02180 
<a name="l02181"></a>02181       <span class="comment">/* Unlike CLI, do not show the state of &#39;disconnected-tracing&#39; variable.</span>
<a name="l02182"></a>02182 <span class="comment">         Given that the frontend gets the status either on -trace-stop, or from</span>
<a name="l02183"></a>02183 <span class="comment">         -trace-status after re-connection, it does not seem like this</span>
<a name="l02184"></a>02184 <span class="comment">         information is necessary for anything.  It is not necessary for either</span>
<a name="l02185"></a>02185 <span class="comment">         figuring the vital state of the target nor for navigation of trace</span>
<a name="l02186"></a>02186 <span class="comment">         frames.  If the frontend wants to show the current state is some</span>
<a name="l02187"></a>02187 <span class="comment">         configure dialog, it can request the value when such dialog is</span>
<a name="l02188"></a>02188 <span class="comment">         invoked by the user.  */</span>
<a name="l02189"></a>02189     }
<a name="l02190"></a>02190   <span class="keywordflow">else</span>
<a name="l02191"></a>02191     {
<a name="l02192"></a>02192       <span class="keywordtype">char</span> *<a class="code" href="structtrace__status.html#af5d4f9904d71961dd065b57fed099644">stop_reason</a> = NULL;
<a name="l02193"></a>02193       <span class="keywordtype">int</span> <a class="code" href="structtrace__status.html#ad22500bfd24188778985319a545c42d1">stopping_tracepoint</a> = -1;
<a name="l02194"></a>02194 
<a name="l02195"></a>02195       <span class="keywordflow">if</span> (!on_stop)
<a name="l02196"></a>02196         <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;running&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>);
<a name="l02197"></a>02197 
<a name="l02198"></a>02198       <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#af5d4f9904d71961dd065b57fed099644">stop_reason</a> != <a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77aeac56e2eee7510675fa2c3fd1306b67d">trace_stop_reason_unknown</a>)
<a name="l02199"></a>02199         {
<a name="l02200"></a>02200           <span class="keywordflow">switch</span> (ts-&gt;<a class="code" href="structtrace__status.html#af5d4f9904d71961dd065b57fed099644">stop_reason</a>)
<a name="l02201"></a>02201             {
<a name="l02202"></a>02202             <span class="keywordflow">case</span> <a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77a058a54e86734f1069cf989782b9b9f22">tstop_command</a>:
<a name="l02203"></a>02203               stop_reason = <span class="stringliteral">&quot;request&quot;</span>;
<a name="l02204"></a>02204               <span class="keywordflow">break</span>;
<a name="l02205"></a>02205             <span class="keywordflow">case</span> <a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77a058f3c6aa59a1d63de69842e78774620">trace_buffer_full</a>:
<a name="l02206"></a>02206               stop_reason = <span class="stringliteral">&quot;overflow&quot;</span>;
<a name="l02207"></a>02207               <span class="keywordflow">break</span>;
<a name="l02208"></a>02208             <span class="keywordflow">case</span> <a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77ad1f9afda06631fe6c07ac32cac341f27">trace_disconnected</a>:
<a name="l02209"></a>02209               stop_reason = <span class="stringliteral">&quot;disconnection&quot;</span>;
<a name="l02210"></a>02210               <span class="keywordflow">break</span>;
<a name="l02211"></a>02211             <span class="keywordflow">case</span> <a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77ad5383255900f5832f492c7b0937ea741">tracepoint_passcount</a>:
<a name="l02212"></a>02212               stop_reason = <span class="stringliteral">&quot;passcount&quot;</span>;
<a name="l02213"></a>02213               stopping_tracepoint = ts-&gt;<a class="code" href="structtrace__status.html#ad22500bfd24188778985319a545c42d1">stopping_tracepoint</a>;
<a name="l02214"></a>02214               <span class="keywordflow">break</span>;
<a name="l02215"></a>02215             <span class="keywordflow">case</span> <a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77a4a52d08e789e2e817131f822384872c3">tracepoint_error</a>:
<a name="l02216"></a>02216               stop_reason = <span class="stringliteral">&quot;error&quot;</span>;
<a name="l02217"></a>02217               stopping_tracepoint = ts-&gt;<a class="code" href="structtrace__status.html#ad22500bfd24188778985319a545c42d1">stopping_tracepoint</a>;
<a name="l02218"></a>02218               <span class="keywordflow">break</span>;
<a name="l02219"></a>02219             }
<a name="l02220"></a>02220           
<a name="l02221"></a>02221           <span class="keywordflow">if</span> (stop_reason)
<a name="l02222"></a>02222             {
<a name="l02223"></a>02223               <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;stop-reason&quot;</span>, stop_reason);
<a name="l02224"></a>02224               <span class="keywordflow">if</span> (stopping_tracepoint != -1)
<a name="l02225"></a>02225                 <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, <span class="stringliteral">&quot;stopping-tracepoint&quot;</span>,
<a name="l02226"></a>02226                                   stopping_tracepoint);
<a name="l02227"></a>02227               <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#af5d4f9904d71961dd065b57fed099644">stop_reason</a> == <a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77a4a52d08e789e2e817131f822384872c3">tracepoint_error</a>)
<a name="l02228"></a>02228                 <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;error-description&quot;</span>,
<a name="l02229"></a>02229                                      ts-&gt;<a class="code" href="structtrace__status.html#a4d5e182f56e3793df49d65abb8e8c456">stop_desc</a>);
<a name="l02230"></a>02230             }
<a name="l02231"></a>02231         }
<a name="l02232"></a>02232     }
<a name="l02233"></a>02233 
<a name="l02234"></a>02234   <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#aebfcf3df70568e7ae65480c1f4efe0f6">traceframe_count</a> != -1)
<a name="l02235"></a>02235     <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, <span class="stringliteral">&quot;frames&quot;</span>, ts-&gt;<a class="code" href="structtrace__status.html#aebfcf3df70568e7ae65480c1f4efe0f6">traceframe_count</a>);
<a name="l02236"></a>02236   <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#a96ec1749e52d1943618c0df3ee457979">traceframes_created</a> != -1)
<a name="l02237"></a>02237     <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, <span class="stringliteral">&quot;frames-created&quot;</span>, ts-&gt;<a class="code" href="structtrace__status.html#a96ec1749e52d1943618c0df3ee457979">traceframes_created</a>);
<a name="l02238"></a>02238   <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#a409141fb583ccaef669f996dd68a2fe0">buffer_size</a> != -1)
<a name="l02239"></a>02239     <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, <span class="stringliteral">&quot;buffer-size&quot;</span>, ts-&gt;<a class="code" href="structtrace__status.html#a409141fb583ccaef669f996dd68a2fe0">buffer_size</a>);
<a name="l02240"></a>02240   <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#ac6f0b3903e2ab671c95dec8bf674f15b">buffer_free</a> != -1)
<a name="l02241"></a>02241     <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, <span class="stringliteral">&quot;buffer-free&quot;</span>, ts-&gt;<a class="code" href="structtrace__status.html#ac6f0b3903e2ab671c95dec8bf674f15b">buffer_free</a>);
<a name="l02242"></a>02242 
<a name="l02243"></a>02243   <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, <span class="stringliteral">&quot;disconnected&quot;</span>,  ts-&gt;<a class="code" href="structtrace__status.html#a11a975b86259c84816c3341d32e2fca7">disconnected_tracing</a>);
<a name="l02244"></a>02244   <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, <span class="stringliteral">&quot;circular&quot;</span>,  ts-&gt;<a class="code" href="structtrace__status.html#ad6afd6f38f37406b22b83ea67dd2b027">circular_buffer</a>);
<a name="l02245"></a>02245 
<a name="l02246"></a>02246   <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;user-name&quot;</span>, ts-&gt;<a class="code" href="structtrace__status.html#ae84456b65c09a38fcf8f63ed58a78f04">user_name</a>);
<a name="l02247"></a>02247   <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;notes&quot;</span>, ts-&gt;<a class="code" href="structtrace__status.html#a114142bb0c3aa89b765bce9e26bd399c">notes</a>);
<a name="l02248"></a>02248 
<a name="l02249"></a>02249   {
<a name="l02250"></a>02250     <span class="keywordtype">char</span> buf[100];
<a name="l02251"></a>02251 
<a name="l02252"></a>02252     <a class="code" href="common-utils_8c.html#ad9940337ec98983dae9951c947879fc8">xsnprintf</a> (buf, <span class="keyword">sizeof</span> buf, <span class="stringliteral">&quot;%ld.%06ld&quot;</span>,
<a name="l02253"></a>02253                (<span class="keywordtype">long</span> <span class="keywordtype">int</span>) (ts-&gt;<a class="code" href="structtrace__status.html#acaf0437f240f26a40362a34707353e7c">start_time</a> / 1000000),
<a name="l02254"></a>02254                (<span class="keywordtype">long</span> <span class="keywordtype">int</span>) (ts-&gt;<a class="code" href="structtrace__status.html#acaf0437f240f26a40362a34707353e7c">start_time</a> % 1000000));
<a name="l02255"></a>02255     <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;start-time&quot;</span>, buf);
<a name="l02256"></a>02256     <a class="code" href="common-utils_8c.html#ad9940337ec98983dae9951c947879fc8">xsnprintf</a> (buf, <span class="keyword">sizeof</span> buf, <span class="stringliteral">&quot;%ld.%06ld&quot;</span>,
<a name="l02257"></a>02257                (<span class="keywordtype">long</span> <span class="keywordtype">int</span>) (ts-&gt;<a class="code" href="structtrace__status.html#a996a6a416f9e35c599215973dc2c6928">stop_time</a> / 1000000),
<a name="l02258"></a>02258                (<span class="keywordtype">long</span> <span class="keywordtype">int</span>) (ts-&gt;<a class="code" href="structtrace__status.html#a996a6a416f9e35c599215973dc2c6928">stop_time</a> % 1000000));
<a name="l02259"></a>02259     <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;stop-time&quot;</span>, buf);
<a name="l02260"></a>02260   }
<a name="l02261"></a>02261 }
<a name="l02262"></a>02262 
<a name="l02263"></a>02263 <span class="comment">/* Check if a trace run is ongoing.  If so, and FROM_TTY, query the</span>
<a name="l02264"></a>02264 <span class="comment">   user if she really wants to detach.  */</span>
<a name="l02265"></a>02265 
<a name="l02266"></a>02266 <span class="keywordtype">void</span>
<a name="l02267"></a><a class="code" href="tracepoint_8h.html#a544ae92e6be59f2dfa918ba4f371475c">02267</a> <a class="code" href="tracepoint_8c.html#a544ae92e6be59f2dfa918ba4f371475c">query_if_trace_running</a> (<span class="keywordtype">int</span> from_tty)
<a name="l02268"></a>02268 {
<a name="l02269"></a>02269   <span class="keywordflow">if</span> (!from_tty)
<a name="l02270"></a>02270     <span class="keywordflow">return</span>;
<a name="l02271"></a>02271 
<a name="l02272"></a>02272   <span class="comment">/* It can happen that the target that was tracing went away on its</span>
<a name="l02273"></a>02273 <span class="comment">     own, and we didn&#39;t notice.  Get a status update, and if the</span>
<a name="l02274"></a>02274 <span class="comment">     current target doesn&#39;t even do tracing, then assume it&#39;s not</span>
<a name="l02275"></a>02275 <span class="comment">     running anymore.  */</span>
<a name="l02276"></a>02276   <span class="keywordflow">if</span> (<a class="code" href="target_8h.html#ad3a877c0f56ac304d3ddb3b8a19fc4d3">target_get_trace_status</a> (<a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> ()) &lt; 0)
<a name="l02277"></a>02277     <a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> ()-&gt;<a class="code" href="structtrace__status.html#af1d922d381deda9d03faa4406c0a36de">running</a> = 0;
<a name="l02278"></a>02278 
<a name="l02279"></a>02279   <span class="comment">/* If running interactively, give the user the option to cancel and</span>
<a name="l02280"></a>02280 <span class="comment">     then decide what to do differently with the run.  Scripts are</span>
<a name="l02281"></a>02281 <span class="comment">     just going to disconnect and let the target deal with it,</span>
<a name="l02282"></a>02282 <span class="comment">     according to how it&#39;s been instructed previously via</span>
<a name="l02283"></a>02283 <span class="comment">     disconnected-tracing.  */</span>
<a name="l02284"></a>02284   <span class="keywordflow">if</span> (<a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> ()-&gt;<a class="code" href="structtrace__status.html#af1d922d381deda9d03faa4406c0a36de">running</a>)
<a name="l02285"></a>02285     {
<a name="l02286"></a>02286       process_tracepoint_on_disconnect ();
<a name="l02287"></a>02287 
<a name="l02288"></a>02288       <span class="keywordflow">if</span> (<a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> ()-&gt;<a class="code" href="structtrace__status.html#a11a975b86259c84816c3341d32e2fca7">disconnected_tracing</a>)
<a name="l02289"></a>02289         {
<a name="l02290"></a>02290           <span class="keywordflow">if</span> (!<a class="code" href="utils_8c.html#a4b369431cd1ce5d26bccf6b79a44c085">query</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace is running and will &quot;</span>
<a name="l02291"></a>02291                         <span class="stringliteral">&quot;continue after detach; detach anyway? &quot;</span>)))
<a name="l02292"></a>02292             <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Not confirmed.&quot;</span>));
<a name="l02293"></a>02293         }
<a name="l02294"></a>02294       <span class="keywordflow">else</span>
<a name="l02295"></a>02295         {
<a name="l02296"></a>02296           <span class="keywordflow">if</span> (!<a class="code" href="utils_8c.html#a4b369431cd1ce5d26bccf6b79a44c085">query</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace is running but will &quot;</span>
<a name="l02297"></a>02297                         <span class="stringliteral">&quot;stop on detach; detach anyway? &quot;</span>)))
<a name="l02298"></a>02298             <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Not confirmed.&quot;</span>));
<a name="l02299"></a>02299         }
<a name="l02300"></a>02300     }
<a name="l02301"></a>02301 }
<a name="l02302"></a>02302 
<a name="l02303"></a>02303 <span class="comment">/* This function handles the details of what to do about an ongoing</span>
<a name="l02304"></a>02304 <span class="comment">   tracing run if the user has asked to detach or otherwise disconnect</span>
<a name="l02305"></a>02305 <span class="comment">   from the target.  */</span>
<a name="l02306"></a>02306 
<a name="l02307"></a>02307 <span class="keywordtype">void</span>
<a name="l02308"></a><a class="code" href="tracepoint_8h.html#a28a9ab414b4ccd724589fe388363531f">02308</a> <a class="code" href="tracepoint_8c.html#a28a9ab414b4ccd724589fe388363531f">disconnect_tracing</a> (<span class="keywordtype">void</span>)
<a name="l02309"></a>02309 {
<a name="l02310"></a>02310   <span class="comment">/* Also we want to be out of tfind mode, otherwise things can get</span>
<a name="l02311"></a>02311 <span class="comment">     confusing upon reconnection.  Just use these calls instead of</span>
<a name="l02312"></a>02312 <span class="comment">     full tfind_1 behavior because we&#39;re in the middle of detaching,</span>
<a name="l02313"></a>02313 <span class="comment">     and there&#39;s no point to updating current stack frame etc.  */</span>
<a name="l02314"></a>02314   <a class="code" href="tracepoint_8c.html#a8ab20f1eb477238f562e37831e9f6038">trace_reset_local_state</a> ();
<a name="l02315"></a>02315 }
<a name="l02316"></a>02316 
<a name="l02317"></a>02317 <span class="comment">/* Worker function for the various flavors of the tfind command.  */</span>
<a name="l02318"></a>02318 <span class="keywordtype">void</span>
<a name="l02319"></a><a class="code" href="tracepoint_8h.html#a7a8ae2744aacb4e032507bcf90263e5f">02319</a> <a class="code" href="tracepoint_8c.html#a7a8ae2744aacb4e032507bcf90263e5f">tfind_1</a> (<span class="keyword">enum</span> <a class="code" href="target_8h.html#a78f5afcdc128cdd336383668a0f296d7">trace_find_type</a> type, <span class="keywordtype">int</span> num,
<a name="l02320"></a>02320          <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> addr1, <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> addr2,
<a name="l02321"></a>02321          <span class="keywordtype">int</span> from_tty)
<a name="l02322"></a>02322 {
<a name="l02323"></a>02323   <span class="keywordtype">int</span> target_frameno = -1, target_tracept = -1;
<a name="l02324"></a>02324   <span class="keyword">struct </span><a class="code" href="structframe__id.html">frame_id</a> old_frame_id = <a class="code" href="frame_8c.html#a0e92fecdd3b01549ccdc07795de2afee">null_frame_id</a>;
<a name="l02325"></a>02325   <span class="keyword">struct </span><a class="code" href="structtracepoint.html">tracepoint</a> *tp;
<a name="l02326"></a>02326   <span class="keyword">struct </span>ui_out *uiout = <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>;
<a name="l02327"></a>02327 
<a name="l02328"></a>02328   <span class="comment">/* Only try to get the current stack frame if we have a chance of</span>
<a name="l02329"></a>02329 <span class="comment">     succeeding.  In particular, if we&#39;re trying to get a first trace</span>
<a name="l02330"></a>02330 <span class="comment">     frame while all threads are running, it&#39;s not going to succeed,</span>
<a name="l02331"></a>02331 <span class="comment">     so leave it with a default value and let the frame comparison</span>
<a name="l02332"></a>02332 <span class="comment">     below (correctly) decide to print out the source location of the</span>
<a name="l02333"></a>02333 <span class="comment">     trace frame.  */</span>
<a name="l02334"></a>02334   <span class="keywordflow">if</span> (!(type == <a class="code" href="target_8h.html#a78f5afcdc128cdd336383668a0f296d7a6c059c3daad01c8165dc1a73498408e7">tfind_number</a> &amp;&amp; num == -1)
<a name="l02335"></a>02335       &amp;&amp; (<a class="code" href="frame_8c.html#ad1e8bd5ac45df219a168640934f891cc">has_stack_frames</a> () || traceframe_number &gt;= 0))
<a name="l02336"></a>02336     old_frame_id = <a class="code" href="frame_8c.html#a4d69effe10c03fa7c702d490081012bf">get_frame_id</a> (<a class="code" href="frame_8c.html#a5ab254510728049878a232ed1b889820">get_current_frame</a> ());
<a name="l02337"></a>02337 
<a name="l02338"></a>02338   target_frameno = <a class="code" href="target_8h.html#a9f5b31eeb53ce0049febf03485540f46">target_trace_find</a> (type, num, addr1, addr2,
<a name="l02339"></a>02339                                       &amp;target_tracept);
<a name="l02340"></a>02340   
<a name="l02341"></a>02341   <span class="keywordflow">if</span> (type == <a class="code" href="target_8h.html#a78f5afcdc128cdd336383668a0f296d7a6c059c3daad01c8165dc1a73498408e7">tfind_number</a>
<a name="l02342"></a>02342       &amp;&amp; num == -1
<a name="l02343"></a>02343       &amp;&amp; target_frameno == -1)
<a name="l02344"></a>02344     {
<a name="l02345"></a>02345       <span class="comment">/* We told the target to get out of tfind mode, and it did.  */</span>
<a name="l02346"></a>02346     }
<a name="l02347"></a>02347   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (target_frameno == -1)
<a name="l02348"></a>02348     {
<a name="l02349"></a>02349       <span class="comment">/* A request for a non-existent trace frame has failed.</span>
<a name="l02350"></a>02350 <span class="comment">         Our response will be different, depending on FROM_TTY:</span>
<a name="l02351"></a>02351 <span class="comment"></span>
<a name="l02352"></a>02352 <span class="comment">         If FROM_TTY is true, meaning that this command was </span>
<a name="l02353"></a>02353 <span class="comment">         typed interactively by the user, then give an error</span>
<a name="l02354"></a>02354 <span class="comment">         and DO NOT change the state of traceframe_number etc.</span>
<a name="l02355"></a>02355 <span class="comment"></span>
<a name="l02356"></a>02356 <span class="comment">         However if FROM_TTY is false, meaning that we&#39;re either</span>
<a name="l02357"></a>02357 <span class="comment">         in a script, a loop, or a user-defined command, then </span>
<a name="l02358"></a>02358 <span class="comment">         DON&#39;T give an error, but DO change the state of</span>
<a name="l02359"></a>02359 <span class="comment">         traceframe_number etc. to invalid.</span>
<a name="l02360"></a>02360 <span class="comment"></span>
<a name="l02361"></a>02361 <span class="comment">         The rationalle is that if you typed the command, you</span>
<a name="l02362"></a>02362 <span class="comment">         might just have committed a typo or something, and you&#39;d</span>
<a name="l02363"></a>02363 <span class="comment">         like to NOT lose your current debugging state.  However</span>
<a name="l02364"></a>02364 <span class="comment">         if you&#39;re in a user-defined command or especially in a</span>
<a name="l02365"></a>02365 <span class="comment">         loop, then you need a way to detect that the command</span>
<a name="l02366"></a>02366 <span class="comment">         failed WITHOUT aborting.  This allows you to write</span>
<a name="l02367"></a>02367 <span class="comment">         scripts that search thru the trace buffer until the end,</span>
<a name="l02368"></a>02368 <span class="comment">         and then continue on to do something else.  */</span>
<a name="l02369"></a>02369   
<a name="l02370"></a>02370       <span class="keywordflow">if</span> (from_tty)
<a name="l02371"></a>02371         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Target failed to find requested trace frame.&quot;</span>));
<a name="l02372"></a>02372       <span class="keywordflow">else</span>
<a name="l02373"></a>02373         {
<a name="l02374"></a>02374           <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a3f2f91ed92de5dfaa6d27fb82822f8d5">info_verbose</a>)
<a name="l02375"></a>02375             <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;End of trace buffer.\n&quot;</span>);
<a name="l02376"></a>02376 <span class="preprocessor">#if 0 </span><span class="comment">/* dubious now?  */</span>
<a name="l02377"></a>02377           <span class="comment">/* The following will not recurse, since it&#39;s</span>
<a name="l02378"></a>02378 <span class="comment">             special-cased.  */</span>
<a name="l02379"></a>02379           trace_find_command (<span class="stringliteral">&quot;-1&quot;</span>, from_tty);
<a name="l02380"></a>02380 <span class="preprocessor">#endif</span>
<a name="l02381"></a>02381 <span class="preprocessor"></span>        }
<a name="l02382"></a>02382     }
<a name="l02383"></a>02383   
<a name="l02384"></a>02384   tp = <a class="code" href="breakpoint_8c.html#ac6160629aa4fcd8afc53503d861f7f90">get_tracepoint_by_number_on_target</a> (target_tracept);
<a name="l02385"></a>02385 
<a name="l02386"></a>02386   <a class="code" href="frame_8c.html#a4d98033420f1cd189e1cd764cd87fe98">reinit_frame_cache</a> ();
<a name="l02387"></a>02387   <a class="code" href="target_8c.html#a819a6668299ae51c85ee5971a480b410">target_dcache_invalidate</a> ();
<a name="l02388"></a>02388 
<a name="l02389"></a>02389   set_tracepoint_num (tp ? tp-&gt;<a class="code" href="structtracepoint.html#a881af30b18b555e6ff11113da6b01a02">base</a>.<a class="code" href="structbreakpoint.html#aa46a2ab4a5f2ae1e42412c412997871b">number</a> : target_tracept);
<a name="l02390"></a>02390 
<a name="l02391"></a>02391   <span class="keywordflow">if</span> (target_frameno != <a class="code" href="tracepoint_8c.html#a3bee6ac8afec52230f5314e1f3025511">get_traceframe_number</a> ())
<a name="l02392"></a>02392     <a class="code" href="observer_8h.html#a849f472e977e62fa9fa358f1c2319061">observer_notify_traceframe_changed</a> (target_frameno, tracepoint_number);
<a name="l02393"></a>02393 
<a name="l02394"></a>02394   <a class="code" href="tracepoint_8c.html#ad8bfea40c0a91f07e0683fe176a16e79">set_current_traceframe</a> (target_frameno);
<a name="l02395"></a>02395 
<a name="l02396"></a>02396   <span class="keywordflow">if</span> (target_frameno == -1)
<a name="l02397"></a>02397     set_traceframe_context (NULL);
<a name="l02398"></a>02398   <span class="keywordflow">else</span>
<a name="l02399"></a>02399     set_traceframe_context (<a class="code" href="frame_8c.html#a5ab254510728049878a232ed1b889820">get_current_frame</a> ());
<a name="l02400"></a>02400 
<a name="l02401"></a>02401   <span class="keywordflow">if</span> (traceframe_number &gt;= 0)
<a name="l02402"></a>02402     {
<a name="l02403"></a>02403       <span class="comment">/* Use different branches for MI and CLI to make CLI messages</span>
<a name="l02404"></a>02404 <span class="comment">         i18n-eable.  */</span>
<a name="l02405"></a>02405       <span class="keywordflow">if</span> (<a class="code" href="ui-out_8c.html#a473db54efcfbc60feeb5a4f54f27af46">ui_out_is_mi_like_p</a> (uiout))
<a name="l02406"></a>02406         {
<a name="l02407"></a>02407           <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;found&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>);
<a name="l02408"></a>02408           <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, <span class="stringliteral">&quot;tracepoint&quot;</span>, tracepoint_number);
<a name="l02409"></a>02409           <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, <span class="stringliteral">&quot;traceframe&quot;</span>, traceframe_number);
<a name="l02410"></a>02410         }
<a name="l02411"></a>02411       <span class="keywordflow">else</span>
<a name="l02412"></a>02412         {
<a name="l02413"></a>02413           <a class="code" href="utils_8c.html#ad57145632bbcb0361dc1dfa134b1efd0">printf_unfiltered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Found trace frame %d, tracepoint %d\n&quot;</span>),
<a name="l02414"></a>02414                              traceframe_number, tracepoint_number);
<a name="l02415"></a>02415         }
<a name="l02416"></a>02416     }
<a name="l02417"></a>02417   <span class="keywordflow">else</span>
<a name="l02418"></a>02418     {
<a name="l02419"></a>02419       <span class="keywordflow">if</span> (<a class="code" href="ui-out_8c.html#a473db54efcfbc60feeb5a4f54f27af46">ui_out_is_mi_like_p</a> (uiout))
<a name="l02420"></a>02420         <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;found&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>);
<a name="l02421"></a>02421       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <a class="code" href="target_8h.html#a78f5afcdc128cdd336383668a0f296d7a6c059c3daad01c8165dc1a73498408e7">tfind_number</a> &amp;&amp; num == -1)
<a name="l02422"></a>02422         <a class="code" href="utils_8c.html#ad57145632bbcb0361dc1dfa134b1efd0">printf_unfiltered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No longer looking at any trace frame\n&quot;</span>));
<a name="l02423"></a>02423       <span class="keywordflow">else</span> <span class="comment">/* This case may never occur, check.  */</span>
<a name="l02424"></a>02424         <a class="code" href="utils_8c.html#ad57145632bbcb0361dc1dfa134b1efd0">printf_unfiltered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No trace frame found\n&quot;</span>));
<a name="l02425"></a>02425     }
<a name="l02426"></a>02426 
<a name="l02427"></a>02427   <span class="comment">/* If we&#39;re in nonstop mode and getting out of looking at trace</span>
<a name="l02428"></a>02428 <span class="comment">     frames, there won&#39;t be any current frame to go back to and</span>
<a name="l02429"></a>02429 <span class="comment">     display.  */</span>
<a name="l02430"></a>02430   <span class="keywordflow">if</span> (from_tty
<a name="l02431"></a>02431       &amp;&amp; (<a class="code" href="frame_8c.html#ad1e8bd5ac45df219a168640934f891cc">has_stack_frames</a> () || traceframe_number &gt;= 0))
<a name="l02432"></a>02432     {
<a name="l02433"></a>02433       <span class="keyword">enum</span> <a class="code" href="frame_8h.html#a2431f51963af6773c12937f24f7525a4">print_what</a> <a class="code" href="frame_8h.html#a2431f51963af6773c12937f24f7525a4">print_what</a>;
<a name="l02434"></a>02434 
<a name="l02435"></a>02435       <span class="comment">/* NOTE: in imitation of the step command, try to determine</span>
<a name="l02436"></a>02436 <span class="comment">         whether we have made a transition from one function to</span>
<a name="l02437"></a>02437 <span class="comment">         another.  If so, we&#39;ll print the &quot;stack frame&quot; (ie. the new</span>
<a name="l02438"></a>02438 <span class="comment">         function and it&#39;s arguments) -- otherwise we&#39;ll just show the</span>
<a name="l02439"></a>02439 <span class="comment">         new source line.  */</span>
<a name="l02440"></a>02440 
<a name="l02441"></a>02441       <span class="keywordflow">if</span> (<a class="code" href="frame_8c.html#a1948b73cbb94aef2e2f11a48b0f4b74c">frame_id_eq</a> (old_frame_id,
<a name="l02442"></a>02442                        <a class="code" href="frame_8c.html#a4d69effe10c03fa7c702d490081012bf">get_frame_id</a> (<a class="code" href="frame_8c.html#a5ab254510728049878a232ed1b889820">get_current_frame</a> ())))
<a name="l02443"></a>02443         print_what = <a class="code" href="frame_8h.html#a2431f51963af6773c12937f24f7525a4ac3894bab13e59fc69fb20fe1d532b6e6">SRC_LINE</a>;
<a name="l02444"></a>02444       <span class="keywordflow">else</span>
<a name="l02445"></a>02445         print_what = <a class="code" href="frame_8h.html#a2431f51963af6773c12937f24f7525a4a706a5abb481e7684ba3944582daf6727">SRC_AND_LOC</a>;
<a name="l02446"></a>02446 
<a name="l02447"></a>02447       <a class="code" href="frame_8h.html#a849748a17da39e76cc4648e83c64c344">print_stack_frame</a> (<a class="code" href="frame_8c.html#a8b714a78478670e14a297eba8d1a9915">get_selected_frame</a> (NULL), 1, print_what, 1);
<a name="l02448"></a>02448       <a class="code" href="breakpoint_8h.html#adee48b85cffb58177a89bd1b83ad5242">do_displays</a> ();
<a name="l02449"></a>02449     }
<a name="l02450"></a>02450 }
<a name="l02451"></a>02451 
<a name="l02452"></a>02452 <span class="comment">/* trace_find_command takes a trace frame number n, </span>
<a name="l02453"></a>02453 <span class="comment">   sends &quot;QTFrame:&lt;n&gt;&quot; to the target, </span>
<a name="l02454"></a>02454 <span class="comment">   and accepts a reply that may contain several optional pieces</span>
<a name="l02455"></a>02455 <span class="comment">   of information: a frame number, a tracepoint number, and an</span>
<a name="l02456"></a>02456 <span class="comment">   indication of whether this is a trap frame or a stepping frame.</span>
<a name="l02457"></a>02457 <span class="comment"></span>
<a name="l02458"></a>02458 <span class="comment">   The minimal response is just &quot;OK&quot; (which indicates that the </span>
<a name="l02459"></a>02459 <span class="comment">   target does not give us a frame number or a tracepoint number).</span>
<a name="l02460"></a>02460 <span class="comment">   Instead of that, the target may send us a string containing</span>
<a name="l02461"></a>02461 <span class="comment">   any combination of:</span>
<a name="l02462"></a>02462 <span class="comment">   F&lt;hexnum&gt;    (gives the selected frame number)</span>
<a name="l02463"></a>02463 <span class="comment">   T&lt;hexnum&gt;    (gives the selected tracepoint number)</span>
<a name="l02464"></a>02464 <span class="comment"> */</span>
<a name="l02465"></a>02465 
<a name="l02466"></a>02466 <span class="comment">/* tfind command */</span>
<a name="l02467"></a>02467 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02468"></a>02468 trace_find_command (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l02469"></a>02469 { <span class="comment">/* This should only be called with a numeric argument.  */</span>
<a name="l02470"></a>02470   <span class="keywordtype">int</span> frameno = -1;
<a name="l02471"></a>02471 
<a name="l02472"></a>02472   <span class="keywordflow">if</span> (<a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> ()-&gt;running
<a name="l02473"></a>02473       &amp;&amp; <a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> ()-&gt;filename == NULL)
<a name="l02474"></a>02474     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;May not look at trace frames while trace is running.&quot;</span>));
<a name="l02475"></a>02475   
<a name="l02476"></a>02476   <span class="keywordflow">if</span> (args == 0 || *args == 0)
<a name="l02477"></a>02477     { <span class="comment">/* TFIND with no args means find NEXT trace frame.  */</span>
<a name="l02478"></a>02478       <span class="keywordflow">if</span> (traceframe_number == -1)
<a name="l02479"></a>02479         frameno = 0;    <span class="comment">/* &quot;next&quot; is first one.  */</span>
<a name="l02480"></a>02480         <span class="keywordflow">else</span>
<a name="l02481"></a>02481         frameno = traceframe_number + 1;
<a name="l02482"></a>02482     }
<a name="l02483"></a>02483   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == strcmp (args, <span class="stringliteral">&quot;-&quot;</span>))
<a name="l02484"></a>02484     {
<a name="l02485"></a>02485       <span class="keywordflow">if</span> (traceframe_number == -1)
<a name="l02486"></a>02486         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;not debugging trace buffer&quot;</span>));
<a name="l02487"></a>02487       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (from_tty &amp;&amp; traceframe_number == 0)
<a name="l02488"></a>02488         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;already at start of trace buffer&quot;</span>));
<a name="l02489"></a>02489       
<a name="l02490"></a>02490       frameno = traceframe_number - 1;
<a name="l02491"></a>02491       }
<a name="l02492"></a>02492   <span class="comment">/* A hack to work around eval&#39;s need for fp to have been collected.  */</span>
<a name="l02493"></a>02493   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == strcmp (args, <span class="stringliteral">&quot;-1&quot;</span>))
<a name="l02494"></a>02494     frameno = -1;
<a name="l02495"></a>02495   <span class="keywordflow">else</span>
<a name="l02496"></a>02496     frameno = <a class="code" href="eval_8c.html#a8c10c34c4f91482249243e53ab7d16b7">parse_and_eval_long</a> (args);
<a name="l02497"></a>02497 
<a name="l02498"></a>02498   <span class="keywordflow">if</span> (frameno &lt; -1)
<a name="l02499"></a>02499     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;invalid input (%d is less than zero)&quot;</span>), frameno);
<a name="l02500"></a>02500 
<a name="l02501"></a>02501   <a class="code" href="tracepoint_8c.html#a7a8ae2744aacb4e032507bcf90263e5f">tfind_1</a> (<a class="code" href="target_8h.html#a78f5afcdc128cdd336383668a0f296d7a6c059c3daad01c8165dc1a73498408e7">tfind_number</a>, frameno, 0, 0, from_tty);
<a name="l02502"></a>02502 }
<a name="l02503"></a>02503 
<a name="l02504"></a>02504 <span class="comment">/* tfind end */</span>
<a name="l02505"></a>02505 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02506"></a>02506 trace_find_end_command (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l02507"></a>02507 {
<a name="l02508"></a>02508   trace_find_command (<span class="stringliteral">&quot;-1&quot;</span>, from_tty);
<a name="l02509"></a>02509 }
<a name="l02510"></a>02510 
<a name="l02511"></a>02511 <span class="comment">/* tfind start */</span>
<a name="l02512"></a>02512 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02513"></a>02513 trace_find_start_command (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l02514"></a>02514 {
<a name="l02515"></a>02515   trace_find_command (<span class="stringliteral">&quot;0&quot;</span>, from_tty);
<a name="l02516"></a>02516 }
<a name="l02517"></a>02517 
<a name="l02518"></a>02518 <span class="comment">/* tfind pc command */</span>
<a name="l02519"></a>02519 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02520"></a>02520 trace_find_pc_command (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l02521"></a>02521 {
<a name="l02522"></a>02522   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> pc;
<a name="l02523"></a>02523 
<a name="l02524"></a>02524   <span class="keywordflow">if</span> (<a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> ()-&gt;running
<a name="l02525"></a>02525       &amp;&amp; <a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> ()-&gt;filename == NULL)
<a name="l02526"></a>02526     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;May not look at trace frames while trace is running.&quot;</span>));
<a name="l02527"></a>02527 
<a name="l02528"></a>02528   <span class="keywordflow">if</span> (args == 0 || *args == 0)
<a name="l02529"></a>02529     pc = <a class="code" href="regcache_8c.html#a01b72bb2ee2d14e0097af17241cee731">regcache_read_pc</a> (<a class="code" href="regcache_8c.html#a09a386286dc22d882378f639630fecef">get_current_regcache</a> ());
<a name="l02530"></a>02530   <span class="keywordflow">else</span>
<a name="l02531"></a>02531     pc = <a class="code" href="eval_8c.html#adc1b596b06e274a83197cdeaa0c2809c">parse_and_eval_address</a> (args);
<a name="l02532"></a>02532 
<a name="l02533"></a>02533   <a class="code" href="tracepoint_8c.html#a7a8ae2744aacb4e032507bcf90263e5f">tfind_1</a> (<a class="code" href="target_8h.html#a78f5afcdc128cdd336383668a0f296d7a4bb077c323c7395699b412e2c73b9855">tfind_pc</a>, 0, pc, 0, from_tty);
<a name="l02534"></a>02534 }
<a name="l02535"></a>02535 
<a name="l02536"></a>02536 <span class="comment">/* tfind tracepoint command */</span>
<a name="l02537"></a>02537 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02538"></a>02538 trace_find_tracepoint_command (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l02539"></a>02539 {
<a name="l02540"></a>02540   <span class="keywordtype">int</span> tdp;
<a name="l02541"></a>02541   <span class="keyword">struct </span><a class="code" href="structtracepoint.html">tracepoint</a> *tp;
<a name="l02542"></a>02542 
<a name="l02543"></a>02543   <span class="keywordflow">if</span> (<a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> ()-&gt;running
<a name="l02544"></a>02544       &amp;&amp; <a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> ()-&gt;filename == NULL)
<a name="l02545"></a>02545     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;May not look at trace frames while trace is running.&quot;</span>));
<a name="l02546"></a>02546 
<a name="l02547"></a>02547   <span class="keywordflow">if</span> (args == 0 || *args == 0)
<a name="l02548"></a>02548     {
<a name="l02549"></a>02549       <span class="keywordflow">if</span> (tracepoint_number == -1)
<a name="l02550"></a>02550         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No current tracepoint -- please supply an argument.&quot;</span>));
<a name="l02551"></a>02551       <span class="keywordflow">else</span>
<a name="l02552"></a>02552         tdp = tracepoint_number;        <span class="comment">/* Default is current TDP.  */</span>
<a name="l02553"></a>02553     }
<a name="l02554"></a>02554   <span class="keywordflow">else</span>
<a name="l02555"></a>02555     tdp = <a class="code" href="eval_8c.html#a8c10c34c4f91482249243e53ab7d16b7">parse_and_eval_long</a> (args);
<a name="l02556"></a>02556 
<a name="l02557"></a>02557   <span class="comment">/* If we have the tracepoint on hand, use the number that the</span>
<a name="l02558"></a>02558 <span class="comment">     target knows about (which may be different if we disconnected</span>
<a name="l02559"></a>02559 <span class="comment">     and reconnected).  */</span>
<a name="l02560"></a>02560   tp = <a class="code" href="breakpoint_8c.html#a8a2d0403a74a7a2edf8131dc2462df62">get_tracepoint</a> (tdp);
<a name="l02561"></a>02561   <span class="keywordflow">if</span> (tp)
<a name="l02562"></a>02562     tdp = tp-&gt;<a class="code" href="structtracepoint.html#a32f485dd859434fab98013e1738187d7">number_on_target</a>;
<a name="l02563"></a>02563 
<a name="l02564"></a>02564   <a class="code" href="tracepoint_8c.html#a7a8ae2744aacb4e032507bcf90263e5f">tfind_1</a> (<a class="code" href="target_8h.html#a78f5afcdc128cdd336383668a0f296d7adec7c45210c9adaf5b4bff37cf713de2">tfind_tp</a>, tdp, 0, 0, from_tty);
<a name="l02565"></a>02565 }
<a name="l02566"></a>02566 
<a name="l02567"></a>02567 <span class="comment">/* TFIND LINE command:</span>
<a name="l02568"></a>02568 <span class="comment"></span>
<a name="l02569"></a>02569 <span class="comment">   This command will take a sourceline for argument, just like BREAK</span>
<a name="l02570"></a>02570 <span class="comment">   or TRACE (ie. anything that &quot;decode_line_1&quot; can handle).</span>
<a name="l02571"></a>02571 <span class="comment"></span>
<a name="l02572"></a>02572 <span class="comment">   With no argument, this command will find the next trace frame </span>
<a name="l02573"></a>02573 <span class="comment">   corresponding to a source line OTHER THAN THE CURRENT ONE.  */</span>
<a name="l02574"></a>02574 
<a name="l02575"></a>02575 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02576"></a>02576 trace_find_line_command (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l02577"></a>02577 {
<a name="l02578"></a>02578   <span class="keyword">static</span> <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> start_pc, end_pc;
<a name="l02579"></a>02579   <span class="keyword">struct </span><a class="code" href="structsymtabs__and__lines.html">symtabs_and_lines</a> <a class="code" href="structsymtabs__and__lines.html#ab601f48fdf29c3b190ba068f57983df4">sals</a>;
<a name="l02580"></a>02580   <span class="keyword">struct </span><a class="code" href="structsymtab__and__line.html">symtab_and_line</a> sal;
<a name="l02581"></a>02581   <span class="keyword">struct </span>cleanup *old_chain;
<a name="l02582"></a>02582 
<a name="l02583"></a>02583   <span class="keywordflow">if</span> (<a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> ()-&gt;running
<a name="l02584"></a>02584       &amp;&amp; <a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> ()-&gt;filename == NULL)
<a name="l02585"></a>02585     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;May not look at trace frames while trace is running.&quot;</span>));
<a name="l02586"></a>02586 
<a name="l02587"></a>02587   <span class="keywordflow">if</span> (args == 0 || *args == 0)
<a name="l02588"></a>02588     {
<a name="l02589"></a>02589       sal = <a class="code" href="symtab_8c.html#ad9bbd85700e3d7fa50e7ba0e32f37846">find_pc_line</a> (<a class="code" href="frame_8c.html#a27aafb00e05cba145dfba0e4bc7b1d70">get_frame_pc</a> (<a class="code" href="frame_8c.html#a5ab254510728049878a232ed1b889820">get_current_frame</a> ()), 0);
<a name="l02590"></a>02590       sals.nelts = 1;
<a name="l02591"></a>02591       sals.sals = (<span class="keyword">struct </span><a class="code" href="structsymtab__and__line.html">symtab_and_line</a> *)
<a name="l02592"></a>02592         <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (<span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structsymtab__and__line.html">symtab_and_line</a>));
<a name="l02593"></a>02593       sals.sals[0] = sal;
<a name="l02594"></a>02594     }
<a name="l02595"></a>02595   <span class="keywordflow">else</span>
<a name="l02596"></a>02596     {
<a name="l02597"></a>02597       sals = <a class="code" href="linespec_8c.html#a99c1ec5e07db5d8ffc64de454d190650">decode_line_with_current_source</a> (args, <a class="code" href="linespec_8h.html#a66db0c56cdf6b7d07a996c374a0572caadb5b3965c89f02bfa79f8871fde72588">DECODE_LINE_FUNFIRSTLINE</a>);
<a name="l02598"></a>02598       sal = sals.sals[0];
<a name="l02599"></a>02599     }
<a name="l02600"></a>02600   
<a name="l02601"></a>02601   old_chain = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, sals.sals);
<a name="l02602"></a>02602   <span class="keywordflow">if</span> (sal.symtab == 0)
<a name="l02603"></a>02603     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No line number information available.&quot;</span>));
<a name="l02604"></a>02604 
<a name="l02605"></a>02605   <span class="keywordflow">if</span> (sal.line &gt; 0 &amp;&amp; <a class="code" href="symtab_8c.html#ad7abbdf5f7a0d49ce1b12200beda7d96">find_line_pc_range</a> (sal, &amp;start_pc, &amp;end_pc))
<a name="l02606"></a>02606     {
<a name="l02607"></a>02607       <span class="keywordflow">if</span> (start_pc == end_pc)
<a name="l02608"></a>02608         {
<a name="l02609"></a>02609           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;Line %d of \&quot;%s\&quot;&quot;</span>,
<a name="l02610"></a>02610                            sal.line,
<a name="l02611"></a>02611                            <a class="code" href="source_8c.html#ae251616cab166301d5fed95cbdd31232">symtab_to_filename_for_display</a> (sal.symtab));
<a name="l02612"></a>02612           <a class="code" href="utils_8c.html#a857540a17ef1cd62fef4a33cc3b6a894">wrap_here</a> (<span class="stringliteral">&quot;  &quot;</span>);
<a name="l02613"></a>02613           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot; is at address &quot;</span>);
<a name="l02614"></a>02614           <a class="code" href="defs_8h.html#ac859be6d454d5718fb6faf3bd34fc27e">print_address</a> (<a class="code" href="arch-utils_8c.html#a0fe1e68475f442e5d6dda589e0c62454">get_current_arch</a> (), start_pc, <a class="code" href="main_8c.html#a41a2b997ba5454df787d61f051dd918c">gdb_stdout</a>);
<a name="l02615"></a>02615           <a class="code" href="utils_8c.html#a857540a17ef1cd62fef4a33cc3b6a894">wrap_here</a> (<span class="stringliteral">&quot;  &quot;</span>);
<a name="l02616"></a>02616           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot; but contains no code.\n&quot;</span>);
<a name="l02617"></a>02617           sal = <a class="code" href="symtab_8c.html#ad9bbd85700e3d7fa50e7ba0e32f37846">find_pc_line</a> (start_pc, 0);
<a name="l02618"></a>02618           <span class="keywordflow">if</span> (sal.line &gt; 0
<a name="l02619"></a>02619               &amp;&amp; <a class="code" href="symtab_8c.html#ad7abbdf5f7a0d49ce1b12200beda7d96">find_line_pc_range</a> (sal, &amp;start_pc, &amp;end_pc)
<a name="l02620"></a>02620               &amp;&amp; start_pc != end_pc)
<a name="l02621"></a>02621             <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;Attempting to find line %d instead.\n&quot;</span>,
<a name="l02622"></a>02622                              sal.line);
<a name="l02623"></a>02623           <span class="keywordflow">else</span>
<a name="l02624"></a>02624             <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Cannot find a good line.&quot;</span>));
<a name="l02625"></a>02625         }
<a name="l02626"></a>02626       }
<a name="l02627"></a>02627     <span class="keywordflow">else</span>
<a name="l02628"></a>02628     <span class="comment">/* Is there any case in which we get here, and have an address</span>
<a name="l02629"></a>02629 <span class="comment">       which the user would want to see?  If we have debugging</span>
<a name="l02630"></a>02630 <span class="comment">       symbols and no line numbers?  */</span>
<a name="l02631"></a>02631     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Line number %d is out of range for \&quot;%s\&quot;.&quot;</span>),
<a name="l02632"></a>02632            sal.line, <a class="code" href="source_8c.html#ae251616cab166301d5fed95cbdd31232">symtab_to_filename_for_display</a> (sal.symtab));
<a name="l02633"></a>02633 
<a name="l02634"></a>02634   <span class="comment">/* Find within range of stated line.  */</span>
<a name="l02635"></a>02635   <span class="keywordflow">if</span> (args &amp;&amp; *args)
<a name="l02636"></a>02636     <a class="code" href="tracepoint_8c.html#a7a8ae2744aacb4e032507bcf90263e5f">tfind_1</a> (<a class="code" href="target_8h.html#a78f5afcdc128cdd336383668a0f296d7a8bb5fb54065004f1abad4a8278288c6d">tfind_range</a>, 0, start_pc, end_pc - 1, from_tty);
<a name="l02637"></a>02637   <span class="keywordflow">else</span>
<a name="l02638"></a>02638     <a class="code" href="tracepoint_8c.html#a7a8ae2744aacb4e032507bcf90263e5f">tfind_1</a> (<a class="code" href="target_8h.html#a78f5afcdc128cdd336383668a0f296d7a173984a815b231ae8aff2e0d5c3374d2">tfind_outside</a>, 0, start_pc, end_pc - 1, from_tty);
<a name="l02639"></a>02639   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l02640"></a>02640 }
<a name="l02641"></a>02641 
<a name="l02642"></a>02642 <span class="comment">/* tfind range command */</span>
<a name="l02643"></a>02643 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02644"></a>02644 trace_find_range_command (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l02645"></a>02645 {
<a name="l02646"></a>02646   <span class="keyword">static</span> <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> start, stop;
<a name="l02647"></a>02647   <span class="keywordtype">char</span> *tmp;
<a name="l02648"></a>02648 
<a name="l02649"></a>02649   <span class="keywordflow">if</span> (<a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> ()-&gt;running
<a name="l02650"></a>02650       &amp;&amp; <a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> ()-&gt;filename == NULL)
<a name="l02651"></a>02651     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;May not look at trace frames while trace is running.&quot;</span>));
<a name="l02652"></a>02652 
<a name="l02653"></a>02653   <span class="keywordflow">if</span> (args == 0 || *args == 0)
<a name="l02654"></a>02654     { <span class="comment">/* XXX FIXME: what should default behavior be?  */</span>
<a name="l02655"></a>02655       <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;Usage: tfind range &lt;startaddr&gt;,&lt;endaddr&gt;\n&quot;</span>);
<a name="l02656"></a>02656       <span class="keywordflow">return</span>;
<a name="l02657"></a>02657     }
<a name="l02658"></a>02658 
<a name="l02659"></a>02659   <span class="keywordflow">if</span> (0 != (tmp = <a class="code" href="gdb__string_8h.html#adf46aa8f2e08cfb505868bbfc88b5fd4">strchr</a> (args, <span class="charliteral">&#39;,&#39;</span>)))
<a name="l02660"></a>02660     {
<a name="l02661"></a>02661       *tmp++ = <span class="charliteral">&#39;\0&#39;</span>;    <span class="comment">/* Terminate start address.  */</span>
<a name="l02662"></a>02662       tmp = <a class="code" href="cli-utils_8c.html#afa70bcaee54d487b4412d2a7a5a0c8fa">skip_spaces</a> (tmp);
<a name="l02663"></a>02663       start = <a class="code" href="eval_8c.html#adc1b596b06e274a83197cdeaa0c2809c">parse_and_eval_address</a> (args);
<a name="l02664"></a>02664       stop = <a class="code" href="eval_8c.html#adc1b596b06e274a83197cdeaa0c2809c">parse_and_eval_address</a> (tmp);
<a name="l02665"></a>02665     }
<a name="l02666"></a>02666   <span class="keywordflow">else</span>
<a name="l02667"></a>02667     {                   <span class="comment">/* No explicit end address?  */</span>
<a name="l02668"></a>02668       start = <a class="code" href="eval_8c.html#adc1b596b06e274a83197cdeaa0c2809c">parse_and_eval_address</a> (args);
<a name="l02669"></a>02669       stop = start + 1; <span class="comment">/* ??? */</span>
<a name="l02670"></a>02670     }
<a name="l02671"></a>02671 
<a name="l02672"></a>02672   <a class="code" href="tracepoint_8c.html#a7a8ae2744aacb4e032507bcf90263e5f">tfind_1</a> (<a class="code" href="target_8h.html#a78f5afcdc128cdd336383668a0f296d7a8bb5fb54065004f1abad4a8278288c6d">tfind_range</a>, 0, start, stop, from_tty);
<a name="l02673"></a>02673 }
<a name="l02674"></a>02674 
<a name="l02675"></a>02675 <span class="comment">/* tfind outside command */</span>
<a name="l02676"></a>02676 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02677"></a>02677 trace_find_outside_command (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l02678"></a>02678 {
<a name="l02679"></a>02679   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> start, stop;
<a name="l02680"></a>02680   <span class="keywordtype">char</span> *tmp;
<a name="l02681"></a>02681 
<a name="l02682"></a>02682   <span class="keywordflow">if</span> (<a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> ()-&gt;running
<a name="l02683"></a>02683       &amp;&amp; <a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> ()-&gt;filename == NULL)
<a name="l02684"></a>02684     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;May not look at trace frames while trace is running.&quot;</span>));
<a name="l02685"></a>02685 
<a name="l02686"></a>02686   <span class="keywordflow">if</span> (args == 0 || *args == 0)
<a name="l02687"></a>02687     { <span class="comment">/* XXX FIXME: what should default behavior be?  */</span>
<a name="l02688"></a>02688       <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;Usage: tfind outside &lt;startaddr&gt;,&lt;endaddr&gt;\n&quot;</span>);
<a name="l02689"></a>02689       <span class="keywordflow">return</span>;
<a name="l02690"></a>02690     }
<a name="l02691"></a>02691 
<a name="l02692"></a>02692   <span class="keywordflow">if</span> (0 != (tmp = <a class="code" href="gdb__string_8h.html#adf46aa8f2e08cfb505868bbfc88b5fd4">strchr</a> (args, <span class="charliteral">&#39;,&#39;</span>)))
<a name="l02693"></a>02693     {
<a name="l02694"></a>02694       *tmp++ = <span class="charliteral">&#39;\0&#39;</span>;    <span class="comment">/* Terminate start address.  */</span>
<a name="l02695"></a>02695       tmp = <a class="code" href="cli-utils_8c.html#afa70bcaee54d487b4412d2a7a5a0c8fa">skip_spaces</a> (tmp);
<a name="l02696"></a>02696       start = <a class="code" href="eval_8c.html#adc1b596b06e274a83197cdeaa0c2809c">parse_and_eval_address</a> (args);
<a name="l02697"></a>02697       stop = <a class="code" href="eval_8c.html#adc1b596b06e274a83197cdeaa0c2809c">parse_and_eval_address</a> (tmp);
<a name="l02698"></a>02698     }
<a name="l02699"></a>02699   <span class="keywordflow">else</span>
<a name="l02700"></a>02700     {                   <span class="comment">/* No explicit end address?  */</span>
<a name="l02701"></a>02701       start = <a class="code" href="eval_8c.html#adc1b596b06e274a83197cdeaa0c2809c">parse_and_eval_address</a> (args);
<a name="l02702"></a>02702       stop = start + 1; <span class="comment">/* ??? */</span>
<a name="l02703"></a>02703     }
<a name="l02704"></a>02704 
<a name="l02705"></a>02705   <a class="code" href="tracepoint_8c.html#a7a8ae2744aacb4e032507bcf90263e5f">tfind_1</a> (<a class="code" href="target_8h.html#a78f5afcdc128cdd336383668a0f296d7a173984a815b231ae8aff2e0d5c3374d2">tfind_outside</a>, 0, start, stop, from_tty);
<a name="l02706"></a>02706 }
<a name="l02707"></a>02707 
<a name="l02708"></a>02708 <span class="comment">/* info scope command: list the locals for a scope.  */</span>
<a name="l02709"></a>02709 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02710"></a>02710 scope_info (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l02711"></a>02711 {
<a name="l02712"></a>02712   <span class="keyword">struct </span><a class="code" href="structsymtabs__and__lines.html">symtabs_and_lines</a> <a class="code" href="structsymtabs__and__lines.html#ab601f48fdf29c3b190ba068f57983df4">sals</a>;
<a name="l02713"></a>02713   <span class="keyword">struct </span><a class="code" href="structsymbol.html">symbol</a> *sym;
<a name="l02714"></a>02714   <span class="keyword">struct </span><a class="code" href="structminimal__symbol.html">minimal_symbol</a> *msym;
<a name="l02715"></a>02715   <span class="keyword">struct </span>block *block;
<a name="l02716"></a>02716   <span class="keyword">const</span> <span class="keywordtype">char</span> *symname;
<a name="l02717"></a>02717   <span class="keywordtype">char</span> *save_args = args;
<a name="l02718"></a>02718   <span class="keyword">struct </span><a class="code" href="structblock__iterator.html">block_iterator</a> iter;
<a name="l02719"></a>02719   <span class="keywordtype">int</span> j, count = 0;
<a name="l02720"></a>02720   <span class="keyword">struct </span>gdbarch *gdbarch;
<a name="l02721"></a>02721   <span class="keywordtype">int</span> regno;
<a name="l02722"></a>02722 
<a name="l02723"></a>02723   <span class="keywordflow">if</span> (args == 0 || *args == 0)
<a name="l02724"></a>02724     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;requires an argument (function, &quot;</span>
<a name="l02725"></a>02725              <span class="stringliteral">&quot;line or *addr) to define a scope&quot;</span>));
<a name="l02726"></a>02726 
<a name="l02727"></a>02727   sals = <a class="code" href="linespec_8c.html#ad8b0e76089f41873cf0fb2c14cd2d569">decode_line_1</a> (&amp;args, <a class="code" href="linespec_8h.html#a66db0c56cdf6b7d07a996c374a0572caadb5b3965c89f02bfa79f8871fde72588">DECODE_LINE_FUNFIRSTLINE</a>, NULL, 0);
<a name="l02728"></a>02728   <span class="keywordflow">if</span> (sals.nelts == 0)
<a name="l02729"></a>02729     <span class="keywordflow">return</span>;             <span class="comment">/* Presumably decode_line_1 has already warned.  */</span>
<a name="l02730"></a>02730 
<a name="l02731"></a>02731   <span class="comment">/* Resolve line numbers to PC.  */</span>
<a name="l02732"></a>02732   <a class="code" href="breakpoint_8c.html#a4ca5af087eb50f4017f1eac8be554088">resolve_sal_pc</a> (&amp;sals.sals[0]);
<a name="l02733"></a>02733   block = <a class="code" href="block_8c.html#a35aadf82f92cb4a47ec068dba0e1b36c">block_for_pc</a> (sals.sals[0].pc);
<a name="l02734"></a>02734 
<a name="l02735"></a>02735   <span class="keywordflow">while</span> (block != 0)
<a name="l02736"></a>02736     {
<a name="l02737"></a>02737       <a class="code" href="defs_8h.html#ad24e2b54375e12474e65ebf7175988fb">QUIT</a>;                     <span class="comment">/* Allow user to bail out with ^C.  */</span>
<a name="l02738"></a>02738       <a class="code" href="block_8h.html#a0ffb1db4f5e3a6fd58700861fce48c2b">ALL_BLOCK_SYMBOLS</a> (block, iter, sym)
<a name="l02739"></a>02739         {
<a name="l02740"></a>02740           <a class="code" href="defs_8h.html#ad24e2b54375e12474e65ebf7175988fb">QUIT</a>;                 <span class="comment">/* Allow user to bail out with ^C.  */</span>
<a name="l02741"></a>02741           <span class="keywordflow">if</span> (count == 0)
<a name="l02742"></a>02742             <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;Scope for %s:\n&quot;</span>, save_args);
<a name="l02743"></a>02743           count++;
<a name="l02744"></a>02744 
<a name="l02745"></a>02745           symname = <a class="code" href="symtab_8h.html#ac7f4cb1648125545fbd0e4f13b0c572c">SYMBOL_PRINT_NAME</a> (sym);
<a name="l02746"></a>02746           <span class="keywordflow">if</span> (symname == NULL || *symname == <span class="charliteral">&#39;\0&#39;</span>)
<a name="l02747"></a>02747             <span class="keywordflow">continue</span>;           <span class="comment">/* Probably botched, certainly useless.  */</span>
<a name="l02748"></a>02748 
<a name="l02749"></a>02749           gdbarch = <a class="code" href="objfiles_8c.html#a1c7101234ac2edc601fa465e48bc3463">get_objfile_arch</a> (<a class="code" href="symtab_8h.html#ae86281e4645c9471cb9cb496d7a5ee21">SYMBOL_SYMTAB</a> (sym)-&gt;<a class="code" href="structobjfile.html">objfile</a>);
<a name="l02750"></a>02750 
<a name="l02751"></a>02751           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;Symbol %s is &quot;</span>, symname);
<a name="l02752"></a>02752 
<a name="l02753"></a>02753           <span class="keywordflow">if</span> (<a class="code" href="symtab_8h.html#a9d6910f7fd67567d273e8ee619e0ef4e">SYMBOL_COMPUTED_OPS</a> (sym) != NULL)
<a name="l02754"></a>02754             <a class="code" href="symtab_8h.html#a9d6910f7fd67567d273e8ee619e0ef4e">SYMBOL_COMPUTED_OPS</a> (sym)-&gt;describe_location (sym,
<a name="l02755"></a>02755                                                           <a class="code" href="block_8h.html#a08fdff319bcd75e92b61c79139592af6">BLOCK_START</a> (block),
<a name="l02756"></a>02756                                                           <a class="code" href="main_8c.html#a41a2b997ba5454df787d61f051dd918c">gdb_stdout</a>);
<a name="l02757"></a>02757           <span class="keywordflow">else</span>
<a name="l02758"></a>02758             {
<a name="l02759"></a>02759               <span class="keywordflow">switch</span> (<a class="code" href="symtab_8h.html#a8394f2ba6c27e8026b2783db7cc0eb40">SYMBOL_CLASS</a> (sym))
<a name="l02760"></a>02760                 {
<a name="l02761"></a>02761                 <span class="keywordflow">default</span>:
<a name="l02762"></a>02762                 <span class="keywordflow">case</span> <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3a8f175362d642a65c7ee6e944ffd59a3d">LOC_UNDEF</a>: <span class="comment">/* Messed up symbol?  */</span>
<a name="l02763"></a>02763                   <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;a bogus symbol, class %d.\n&quot;</span>,
<a name="l02764"></a>02764                                    <a class="code" href="symtab_8h.html#a8394f2ba6c27e8026b2783db7cc0eb40">SYMBOL_CLASS</a> (sym));
<a name="l02765"></a>02765                   count--;              <span class="comment">/* Don&#39;t count this one.  */</span>
<a name="l02766"></a>02766                   <span class="keywordflow">continue</span>;
<a name="l02767"></a>02767                 <span class="keywordflow">case</span> <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3a5268309778a6727d08106ff9f2966e54">LOC_CONST</a>:
<a name="l02768"></a>02768                   <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;a constant with value %s (%s)&quot;</span>,
<a name="l02769"></a>02769                                    <a class="code" href="utils_8c.html#a707b1023c85049b17b9d1ca01c58768a">plongest</a> (<a class="code" href="symtab_8h.html#a31840856d8e3eed18cbe9ca90cd2bf39">SYMBOL_VALUE</a> (sym)),
<a name="l02770"></a>02770                                    <a class="code" href="utils_8c.html#a4178635f8faef38f4f9af755a8b16edb">hex_string</a> (<a class="code" href="symtab_8h.html#a31840856d8e3eed18cbe9ca90cd2bf39">SYMBOL_VALUE</a> (sym)));
<a name="l02771"></a>02771                   <span class="keywordflow">break</span>;
<a name="l02772"></a>02772                 <span class="keywordflow">case</span> <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3a74c269ff88b13d3497422a9ebfd98b2d">LOC_CONST_BYTES</a>:
<a name="l02773"></a>02773                   <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;constant bytes: &quot;</span>);
<a name="l02774"></a>02774                   <span class="keywordflow">if</span> (<a class="code" href="symtab_8h.html#aadfeb02c4b5fc2b6764ad32eaccf0e58">SYMBOL_TYPE</a> (sym))
<a name="l02775"></a>02775                     <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="gdbtypes_8h.html#aeac33f868e763780094aec8a2dcb9a1a">TYPE_LENGTH</a> (<a class="code" href="symtab_8h.html#aadfeb02c4b5fc2b6764ad32eaccf0e58">SYMBOL_TYPE</a> (sym)); j++)
<a name="l02776"></a>02776                       <a class="code" href="utils_8c.html#aaa819b1a6c0b6c4090bdc0b027eaf64b">fprintf_filtered</a> (<a class="code" href="main_8c.html#a41a2b997ba5454df787d61f051dd918c">gdb_stdout</a>, <span class="stringliteral">&quot; %02x&quot;</span>,
<a name="l02777"></a>02777                                         (<span class="keywordtype">unsigned</span>) <a class="code" href="symtab_8h.html#aee6737494aece52ad5bdc0516f2a14a9">SYMBOL_VALUE_BYTES</a> (sym)[j]);
<a name="l02778"></a>02778                   <span class="keywordflow">break</span>;
<a name="l02779"></a>02779                 <span class="keywordflow">case</span> <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3a154b256439f7acd7ec7f6257d5881a0f">LOC_STATIC</a>:
<a name="l02780"></a>02780                   <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;in static storage at address &quot;</span>);
<a name="l02781"></a>02781                   <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="utils_8c.html#ab5c76d72090f01d3848b63dda4e37d1c">paddress</a> (gdbarch,
<a name="l02782"></a>02782                                                    <a class="code" href="symtab_8h.html#abee697b9e3bb4f4d164ad920a87ab854">SYMBOL_VALUE_ADDRESS</a> (sym)));
<a name="l02783"></a>02783                   <span class="keywordflow">break</span>;
<a name="l02784"></a>02784                 <span class="keywordflow">case</span> <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3a2a9bcb7d8487d7ccb3858184340712e7">LOC_REGISTER</a>:
<a name="l02785"></a>02785                   <span class="comment">/* GDBARCH is the architecture associated with the objfile</span>
<a name="l02786"></a>02786 <span class="comment">                     the symbol is defined in; the target architecture may be</span>
<a name="l02787"></a>02787 <span class="comment">                     different, and may provide additional registers.  However,</span>
<a name="l02788"></a>02788 <span class="comment">                     we do not know the target architecture at this point.</span>
<a name="l02789"></a>02789 <span class="comment">                     We assume the objfile architecture will contain all the</span>
<a name="l02790"></a>02790 <span class="comment">                     standard registers that occur in debug info in that</span>
<a name="l02791"></a>02791 <span class="comment">                     objfile.  */</span>
<a name="l02792"></a>02792                   regno = <a class="code" href="symtab_8h.html#ac3bc5f478a60882fbe5c60f3d09a0d6e">SYMBOL_REGISTER_OPS</a> (sym)-&gt;register_number (sym,
<a name="l02793"></a>02793                                                                       gdbarch);
<a name="l02794"></a>02794 
<a name="l02795"></a>02795                   <span class="keywordflow">if</span> (<a class="code" href="symtab_8h.html#ab3de6f2d8c380d3ca8bef520b1b4dfb9">SYMBOL_IS_ARGUMENT</a> (sym))
<a name="l02796"></a>02796                     <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;an argument in register $%s&quot;</span>,
<a name="l02797"></a>02797                                      <a class="code" href="gdbarch_8c.html#a86c0cf41eb88c54e943cd80e79af36e5">gdbarch_register_name</a> (gdbarch, regno));
<a name="l02798"></a>02798                   <span class="keywordflow">else</span>
<a name="l02799"></a>02799                     <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;a local variable in register $%s&quot;</span>,
<a name="l02800"></a>02800                                      <a class="code" href="gdbarch_8c.html#a86c0cf41eb88c54e943cd80e79af36e5">gdbarch_register_name</a> (gdbarch, regno));
<a name="l02801"></a>02801                   <span class="keywordflow">break</span>;
<a name="l02802"></a>02802                 <span class="keywordflow">case</span> <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3affc89e823125f8ae758aee5fb913b308">LOC_ARG</a>:
<a name="l02803"></a>02803                   <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;an argument at stack/frame offset %s&quot;</span>,
<a name="l02804"></a>02804                                    <a class="code" href="utils_8c.html#a707b1023c85049b17b9d1ca01c58768a">plongest</a> (<a class="code" href="symtab_8h.html#a31840856d8e3eed18cbe9ca90cd2bf39">SYMBOL_VALUE</a> (sym)));
<a name="l02805"></a>02805                   <span class="keywordflow">break</span>;
<a name="l02806"></a>02806                 <span class="keywordflow">case</span> <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3a495b83fa459ac0722b15a3e94afadbce">LOC_LOCAL</a>:
<a name="l02807"></a>02807                   <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;a local variable at frame offset %s&quot;</span>,
<a name="l02808"></a>02808                                    <a class="code" href="utils_8c.html#a707b1023c85049b17b9d1ca01c58768a">plongest</a> (<a class="code" href="symtab_8h.html#a31840856d8e3eed18cbe9ca90cd2bf39">SYMBOL_VALUE</a> (sym)));
<a name="l02809"></a>02809                   <span class="keywordflow">break</span>;
<a name="l02810"></a>02810                 <span class="keywordflow">case</span> <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3a3c444a41d837bee346e19072ca35f8d3">LOC_REF_ARG</a>:
<a name="l02811"></a>02811                   <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;a reference argument at offset %s&quot;</span>,
<a name="l02812"></a>02812                                    <a class="code" href="utils_8c.html#a707b1023c85049b17b9d1ca01c58768a">plongest</a> (<a class="code" href="symtab_8h.html#a31840856d8e3eed18cbe9ca90cd2bf39">SYMBOL_VALUE</a> (sym)));
<a name="l02813"></a>02813                   <span class="keywordflow">break</span>;
<a name="l02814"></a>02814                 <span class="keywordflow">case</span> <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3ad9b13677899a4fbbd0f44f39726416e7">LOC_REGPARM_ADDR</a>:
<a name="l02815"></a>02815                   <span class="comment">/* Note comment at LOC_REGISTER.  */</span>
<a name="l02816"></a>02816                   regno = <a class="code" href="symtab_8h.html#ac3bc5f478a60882fbe5c60f3d09a0d6e">SYMBOL_REGISTER_OPS</a> (sym)-&gt;register_number (sym,
<a name="l02817"></a>02817                                                                       gdbarch);
<a name="l02818"></a>02818                   <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;the address of an argument, in register $%s&quot;</span>,
<a name="l02819"></a>02819                                    <a class="code" href="gdbarch_8c.html#a86c0cf41eb88c54e943cd80e79af36e5">gdbarch_register_name</a> (gdbarch, regno));
<a name="l02820"></a>02820                   <span class="keywordflow">break</span>;
<a name="l02821"></a>02821                 <span class="keywordflow">case</span> <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3ac0b2498d37ddd0f48d23739bba4abca4">LOC_TYPEDEF</a>:
<a name="l02822"></a>02822                   <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;a typedef.\n&quot;</span>);
<a name="l02823"></a>02823                   <span class="keywordflow">continue</span>;
<a name="l02824"></a>02824                 <span class="keywordflow">case</span> <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3a246b44ddd9acee8dac2a7d9d2c5d7c6e">LOC_LABEL</a>:
<a name="l02825"></a>02825                   <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;a label at address &quot;</span>);
<a name="l02826"></a>02826                   <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="utils_8c.html#ab5c76d72090f01d3848b63dda4e37d1c">paddress</a> (gdbarch,
<a name="l02827"></a>02827                                                    <a class="code" href="symtab_8h.html#abee697b9e3bb4f4d164ad920a87ab854">SYMBOL_VALUE_ADDRESS</a> (sym)));
<a name="l02828"></a>02828                   <span class="keywordflow">break</span>;
<a name="l02829"></a>02829                 <span class="keywordflow">case</span> <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3a1f1e8d54397f35889104cd7766fcec2b">LOC_BLOCK</a>:
<a name="l02830"></a>02830                   <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;a function at address &quot;</span>);
<a name="l02831"></a>02831                   <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;%s&quot;</span>,
<a name="l02832"></a>02832                                    <a class="code" href="utils_8c.html#ab5c76d72090f01d3848b63dda4e37d1c">paddress</a> (gdbarch, <a class="code" href="block_8h.html#a08fdff319bcd75e92b61c79139592af6">BLOCK_START</a> (<a class="code" href="symtab_8h.html#a2c83ea82b28e9a9d8f9b655c2d502593">SYMBOL_BLOCK_VALUE</a> (sym))));
<a name="l02833"></a>02833                   <span class="keywordflow">break</span>;
<a name="l02834"></a>02834                 <span class="keywordflow">case</span> <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3a3d61e7ad56c95328fba05416abc73f7a">LOC_UNRESOLVED</a>:
<a name="l02835"></a>02835                   msym = <a class="code" href="minsyms_8c.html#af87f7a894386515074ddd71365bc09b8">lookup_minimal_symbol</a> (<a class="code" href="symtab_8h.html#a956b56288511a18b855d8a263d60e87f">SYMBOL_LINKAGE_NAME</a> (sym),
<a name="l02836"></a>02836                                                 NULL, NULL);
<a name="l02837"></a>02837                   <span class="keywordflow">if</span> (msym == NULL)
<a name="l02838"></a>02838                     <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;Unresolved Static&quot;</span>);
<a name="l02839"></a>02839                   <span class="keywordflow">else</span>
<a name="l02840"></a>02840                     {
<a name="l02841"></a>02841                       <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;static storage at address &quot;</span>);
<a name="l02842"></a>02842                       <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;%s&quot;</span>,
<a name="l02843"></a>02843                                        <a class="code" href="utils_8c.html#ab5c76d72090f01d3848b63dda4e37d1c">paddress</a> (gdbarch,
<a name="l02844"></a>02844                                                  <a class="code" href="symtab_8h.html#abee697b9e3bb4f4d164ad920a87ab854">SYMBOL_VALUE_ADDRESS</a> (msym)));
<a name="l02845"></a>02845                     }
<a name="l02846"></a>02846                   <span class="keywordflow">break</span>;
<a name="l02847"></a>02847                 <span class="keywordflow">case</span> <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3aa4f37f80c900ee253911325c30b8a60f">LOC_OPTIMIZED_OUT</a>:
<a name="l02848"></a>02848                   <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;optimized out.\n&quot;</span>);
<a name="l02849"></a>02849                   <span class="keywordflow">continue</span>;
<a name="l02850"></a>02850                 <span class="keywordflow">case</span> <a class="code" href="symtab_8h.html#a40bca6cf3ed5cfa15b1275e6750cdda3afd4303a25cda7805900ce8212c67ed45">LOC_COMPUTED</a>:
<a name="l02851"></a>02851                   <a class="code" href="gdb__assert_8h.html#aa0526ecd768317edecf0b46c981cbcc0">gdb_assert_not_reached</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;LOC_COMPUTED variable missing a method&quot;</span>));
<a name="l02852"></a>02852                 }
<a name="l02853"></a>02853             }
<a name="l02854"></a>02854           <span class="keywordflow">if</span> (<a class="code" href="symtab_8h.html#aadfeb02c4b5fc2b6764ad32eaccf0e58">SYMBOL_TYPE</a> (sym))
<a name="l02855"></a>02855             <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;, length %d.\n&quot;</span>,
<a name="l02856"></a>02856                              <a class="code" href="gdbtypes_8h.html#aeac33f868e763780094aec8a2dcb9a1a">TYPE_LENGTH</a> (<a class="code" href="gdbtypes_8c.html#a0bf29d7521d8a8b8735b9a259e380386">check_typedef</a> (<a class="code" href="symtab_8h.html#aadfeb02c4b5fc2b6764ad32eaccf0e58">SYMBOL_TYPE</a> (sym))));
<a name="l02857"></a>02857         }
<a name="l02858"></a>02858       <span class="keywordflow">if</span> (<a class="code" href="block_8h.html#aeea4a00e65c2be0c8674106f38d8ab65">BLOCK_FUNCTION</a> (block))
<a name="l02859"></a>02859         <span class="keywordflow">break</span>;
<a name="l02860"></a>02860       <span class="keywordflow">else</span>
<a name="l02861"></a>02861         block = <a class="code" href="block_8h.html#a8b7633ab6d6feadf9b2ee58e10ad8397">BLOCK_SUPERBLOCK</a> (block);
<a name="l02862"></a>02862     }
<a name="l02863"></a>02863   <span class="keywordflow">if</span> (count &lt;= 0)
<a name="l02864"></a>02864     <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;Scope for %s contains no locals or arguments.\n&quot;</span>,
<a name="l02865"></a>02865                      save_args);
<a name="l02866"></a>02866 }
<a name="l02867"></a>02867 
<a name="l02868"></a>02868 <span class="comment">/* Helper for trace_dump_command.  Dump the action list starting at</span>
<a name="l02869"></a>02869 <span class="comment">   ACTION.  STEPPING_ACTIONS is true if we&#39;re iterating over the</span>
<a name="l02870"></a>02870 <span class="comment">   actions of the body of a while-stepping action.  STEPPING_FRAME is</span>
<a name="l02871"></a>02871 <span class="comment">   set if the current traceframe was determined to be a while-stepping</span>
<a name="l02872"></a>02872 <span class="comment">   traceframe.  */</span>
<a name="l02873"></a>02873 
<a name="l02874"></a>02874 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02875"></a>02875 trace_dump_actions (<span class="keyword">struct</span> <a class="code" href="structcommand__line.html">command_line</a> *action,
<a name="l02876"></a>02876                     <span class="keywordtype">int</span> stepping_actions, <span class="keywordtype">int</span> stepping_frame,
<a name="l02877"></a>02877                     <span class="keywordtype">int</span> from_tty)
<a name="l02878"></a>02878 {
<a name="l02879"></a>02879   <span class="keyword">const</span> <span class="keywordtype">char</span> *action_exp, *next_comma;
<a name="l02880"></a>02880 
<a name="l02881"></a>02881   <span class="keywordflow">for</span> (; action != NULL; action = action-&gt;<a class="code" href="structcommand__line.html#aa3aea4183824359fc95edf1bf4e5291c">next</a>)
<a name="l02882"></a>02882     {
<a name="l02883"></a>02883       <span class="keyword">struct </span><a class="code" href="structcmd__list__element.html">cmd_list_element</a> *cmd;
<a name="l02884"></a>02884 
<a name="l02885"></a>02885       <a class="code" href="defs_8h.html#ad24e2b54375e12474e65ebf7175988fb">QUIT</a>;                     <span class="comment">/* Allow user to bail out with ^C.  */</span>
<a name="l02886"></a>02886       action_exp = action-&gt;<a class="code" href="structcommand__line.html#ac3bdd932f280976d7751ee96783a2c71">line</a>;
<a name="l02887"></a>02887       action_exp = <a class="code" href="cli-utils_8c.html#aad7df612354d99c740a7ea12eccd3848">skip_spaces_const</a> (action_exp);
<a name="l02888"></a>02888 
<a name="l02889"></a>02889       <span class="comment">/* The collection actions to be done while stepping are</span>
<a name="l02890"></a>02890 <span class="comment">         bracketed by the commands &quot;while-stepping&quot; and &quot;end&quot;.  */</span>
<a name="l02891"></a>02891 
<a name="l02892"></a>02892       <span class="keywordflow">if</span> (*action_exp == <span class="charliteral">&#39;#&#39;</span>)   <span class="comment">/* comment line */</span>
<a name="l02893"></a>02893         <span class="keywordflow">continue</span>;
<a name="l02894"></a>02894 
<a name="l02895"></a>02895       cmd = <a class="code" href="cli-decode_8c.html#afbb3266bd92a5a8903072bb4e5f250cc">lookup_cmd</a> (&amp;action_exp, <a class="code" href="cli-cmds_8c.html#a6b7ab0355d0fa8d6ce7d5feb83ff78e7">cmdlist</a>, <span class="stringliteral">&quot;&quot;</span>, -1, 1);
<a name="l02896"></a>02896       <span class="keywordflow">if</span> (cmd == 0)
<a name="l02897"></a>02897         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Bad action list item: %s&quot;</span>), action_exp);
<a name="l02898"></a>02898 
<a name="l02899"></a>02899       <span class="keywordflow">if</span> (<a class="code" href="cli-decode_8c.html#a5335d4a46d04e07d54f850cc468dcb3d">cmd_cfunc_eq</a> (cmd, while_stepping_pseudocommand))
<a name="l02900"></a>02900         {
<a name="l02901"></a>02901           <span class="keywordtype">int</span> i;
<a name="l02902"></a>02902 
<a name="l02903"></a>02903           <span class="keywordflow">for</span> (i = 0; i &lt; action-&gt;<a class="code" href="structcommand__line.html#aeb5463cf08c771552fb0a9b579edd592">body_count</a>; ++i)
<a name="l02904"></a>02904             trace_dump_actions (action-&gt;<a class="code" href="structcommand__line.html#ab44cb6b34417ec8a326a4ed5b3316e20">body_list</a>[i],
<a name="l02905"></a>02905                                 1, stepping_frame, from_tty);
<a name="l02906"></a>02906         }
<a name="l02907"></a>02907       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="cli-decode_8c.html#a5335d4a46d04e07d54f850cc468dcb3d">cmd_cfunc_eq</a> (cmd, collect_pseudocommand))
<a name="l02908"></a>02908         {
<a name="l02909"></a>02909           <span class="comment">/* Display the collected data.</span>
<a name="l02910"></a>02910 <span class="comment">             For the trap frame, display only what was collected at</span>
<a name="l02911"></a>02911 <span class="comment">             the trap.  Likewise for stepping frames, display only</span>
<a name="l02912"></a>02912 <span class="comment">             what was collected while stepping.  This means that the</span>
<a name="l02913"></a>02913 <span class="comment">             two boolean variables, STEPPING_FRAME and</span>
<a name="l02914"></a>02914 <span class="comment">             STEPPING_ACTIONS should be equal.  */</span>
<a name="l02915"></a>02915           <span class="keywordflow">if</span> (stepping_frame == stepping_actions)
<a name="l02916"></a>02916             {
<a name="l02917"></a>02917               <span class="keywordtype">char</span> *cmd = NULL;
<a name="l02918"></a>02918               <span class="keyword">struct </span>cleanup *old_chain
<a name="l02919"></a>02919                 = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="utils_8c.html#a6d8c21606d3f67a431a7bfbb1f47d12e">free_current_contents</a>, &amp;cmd);
<a name="l02920"></a>02920               <span class="keywordtype">int</span> trace_string = 0;
<a name="l02921"></a>02921 
<a name="l02922"></a>02922               <span class="keywordflow">if</span> (*action_exp == <span class="charliteral">&#39;/&#39;</span>)
<a name="l02923"></a>02923                 action_exp = <a class="code" href="tracepoint_8c.html#ab33a6fe626f9fa9e84c68df03ab25e63">decode_agent_options</a> (action_exp, &amp;trace_string);
<a name="l02924"></a>02924 
<a name="l02925"></a>02925               <span class="keywordflow">do</span>
<a name="l02926"></a>02926                 {               <span class="comment">/* Repeat over a comma-separated list.  */</span>
<a name="l02927"></a>02927                   <a class="code" href="defs_8h.html#ad24e2b54375e12474e65ebf7175988fb">QUIT</a>;         <span class="comment">/* Allow user to bail out with ^C.  */</span>
<a name="l02928"></a>02928                   <span class="keywordflow">if</span> (*action_exp == <span class="charliteral">&#39;,&#39;</span>)
<a name="l02929"></a>02929                     action_exp++;
<a name="l02930"></a>02930                   action_exp = <a class="code" href="cli-utils_8c.html#aad7df612354d99c740a7ea12eccd3848">skip_spaces_const</a> (action_exp);
<a name="l02931"></a>02931 
<a name="l02932"></a>02932                   next_comma = <a class="code" href="gdb__string_8h.html#adf46aa8f2e08cfb505868bbfc88b5fd4">strchr</a> (action_exp, <span class="charliteral">&#39;,&#39;</span>);
<a name="l02933"></a>02933 
<a name="l02934"></a>02934                   <span class="keywordflow">if</span> (0 == strncasecmp (action_exp, <span class="stringliteral">&quot;$reg&quot;</span>, 4))
<a name="l02935"></a>02935                     <a class="code" href="infcmd_8c.html#a5d921c3417ed2f520a12d2b36fad0ef6">registers_info</a> (NULL, from_tty);
<a name="l02936"></a>02936                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == strncasecmp (action_exp, <span class="stringliteral">&quot;$_ret&quot;</span>, 5))
<a name="l02937"></a>02937                     ;
<a name="l02938"></a>02938                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == strncasecmp (action_exp, <span class="stringliteral">&quot;$loc&quot;</span>, 4))
<a name="l02939"></a>02939                     <a class="code" href="frame_8h.html#ac8096db688dc13edd29e377c964d826d">locals_info</a> (NULL, from_tty);
<a name="l02940"></a>02940                   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == strncasecmp (action_exp, <span class="stringliteral">&quot;$arg&quot;</span>, 4))
<a name="l02941"></a>02941                     <a class="code" href="frame_8h.html#a5b54190e4a3e837cf5a830bf3e646c08">args_info</a> (NULL, from_tty);
<a name="l02942"></a>02942                   <span class="keywordflow">else</span>
<a name="l02943"></a>02943                     {           <span class="comment">/* variable */</span>
<a name="l02944"></a>02944                       <span class="keywordflow">if</span> (next_comma != NULL)
<a name="l02945"></a>02945                         {
<a name="l02946"></a>02946                           <span class="keywordtype">size_t</span> len = next_comma - action_exp;
<a name="l02947"></a>02947 
<a name="l02948"></a>02948                           cmd = <a class="code" href="common-utils_8c.html#af404b7244f442ce8c3069f31af566eae">xrealloc</a> (cmd, len + 1);
<a name="l02949"></a>02949                           <a class="code" href="gdb__string_8h.html#a39ebe6a4e122707997e78b549a1e8c5e">memcpy</a> (cmd, action_exp, len);
<a name="l02950"></a>02950                           cmd[<a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>] = 0;
<a name="l02951"></a>02951                         }
<a name="l02952"></a>02952                       <span class="keywordflow">else</span>
<a name="l02953"></a>02953                         {
<a name="l02954"></a>02954                           <span class="keywordtype">size_t</span> len = strlen (action_exp);
<a name="l02955"></a>02955 
<a name="l02956"></a>02956                           cmd = <a class="code" href="common-utils_8c.html#af404b7244f442ce8c3069f31af566eae">xrealloc</a> (cmd, len + 1);
<a name="l02957"></a>02957                           <a class="code" href="gdb__string_8h.html#a39ebe6a4e122707997e78b549a1e8c5e">memcpy</a> (cmd, action_exp, len + 1);
<a name="l02958"></a>02958                         }
<a name="l02959"></a>02959 
<a name="l02960"></a>02960                       <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;%s = &quot;</span>, cmd);
<a name="l02961"></a>02961                       <a class="code" href="printcmd_8c.html#aef1f1503b0b1bfe21ea5340773b698d2">output_command_const</a> (cmd, from_tty);
<a name="l02962"></a>02962                       <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l02963"></a>02963                     }
<a name="l02964"></a>02964                   action_exp = next_comma;
<a name="l02965"></a>02965                 }
<a name="l02966"></a>02966               <span class="keywordflow">while</span> (action_exp &amp;&amp; *action_exp == <span class="charliteral">&#39;,&#39;</span>);
<a name="l02967"></a>02967 
<a name="l02968"></a>02968               <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l02969"></a>02969             }
<a name="l02970"></a>02970         }
<a name="l02971"></a>02971     }
<a name="l02972"></a>02972 }
<a name="l02973"></a>02973 
<a name="l02974"></a>02974 <span class="comment">/* Return bp_location of the tracepoint associated with the current</span>
<a name="l02975"></a>02975 <span class="comment">   traceframe.  Set *STEPPING_FRAME_P to 1 if the current traceframe</span>
<a name="l02976"></a>02976 <span class="comment">   is a stepping traceframe.  */</span>
<a name="l02977"></a>02977 
<a name="l02978"></a>02978 <span class="keyword">struct </span><a class="code" href="structbp__location.html">bp_location</a> *
<a name="l02979"></a><a class="code" href="tracepoint_8h.html#a3ff862713babf484e1e8f235475cc043">02979</a> <a class="code" href="tracepoint_8c.html#a3ff862713babf484e1e8f235475cc043">get_traceframe_location</a> (<span class="keywordtype">int</span> *stepping_frame_p)
<a name="l02980"></a>02980 {
<a name="l02981"></a>02981   <span class="keyword">struct </span><a class="code" href="structtracepoint.html">tracepoint</a> *t;
<a name="l02982"></a>02982   <span class="keyword">struct </span><a class="code" href="structbp__location.html">bp_location</a> *tloc;
<a name="l02983"></a>02983   <span class="keyword">struct </span>regcache *regcache;
<a name="l02984"></a>02984 
<a name="l02985"></a>02985   <span class="keywordflow">if</span> (tracepoint_number == -1)
<a name="l02986"></a>02986     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No current trace frame.&quot;</span>));
<a name="l02987"></a>02987 
<a name="l02988"></a>02988   t = <a class="code" href="breakpoint_8c.html#a8a2d0403a74a7a2edf8131dc2462df62">get_tracepoint</a> (tracepoint_number);
<a name="l02989"></a>02989 
<a name="l02990"></a>02990   <span class="keywordflow">if</span> (t == NULL)
<a name="l02991"></a>02991     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No known tracepoint matches &#39;current&#39; tracepoint #%d.&quot;</span>),
<a name="l02992"></a>02992            tracepoint_number);
<a name="l02993"></a>02993 
<a name="l02994"></a>02994   <span class="comment">/* The current frame is a trap frame if the frame PC is equal to the</span>
<a name="l02995"></a>02995 <span class="comment">     tracepoint PC.  If not, then the current frame was collected</span>
<a name="l02996"></a>02996 <span class="comment">     during single-stepping.  */</span>
<a name="l02997"></a>02997   regcache = <a class="code" href="regcache_8c.html#a09a386286dc22d882378f639630fecef">get_current_regcache</a> ();
<a name="l02998"></a>02998 
<a name="l02999"></a>02999   <span class="comment">/* If the traceframe&#39;s address matches any of the tracepoint&#39;s</span>
<a name="l03000"></a>03000 <span class="comment">     locations, assume it is a direct hit rather than a while-stepping</span>
<a name="l03001"></a>03001 <span class="comment">     frame.  (FIXME this is not reliable, should record each frame&#39;s</span>
<a name="l03002"></a>03002 <span class="comment">     type.)  */</span>
<a name="l03003"></a>03003   <span class="keywordflow">for</span> (tloc = t-&gt;<a class="code" href="structtracepoint.html#a881af30b18b555e6ff11113da6b01a02">base</a>.<a class="code" href="structbreakpoint.html#aa869260f7e4c94204275861d820bb1a9">loc</a>; tloc; tloc = tloc-&gt;<a class="code" href="structbp__location.html#ab193cb38f87fea89105db96d94191541">next</a>)
<a name="l03004"></a>03004     <span class="keywordflow">if</span> (tloc-&gt;<a class="code" href="structbp__location.html#a6b6cd8b8a488e632200f323309d23823">address</a> == <a class="code" href="regcache_8c.html#a01b72bb2ee2d14e0097af17241cee731">regcache_read_pc</a> (regcache))
<a name="l03005"></a>03005       {
<a name="l03006"></a>03006         *stepping_frame_p = 0;
<a name="l03007"></a>03007         <span class="keywordflow">return</span> tloc;
<a name="l03008"></a>03008       }
<a name="l03009"></a>03009 
<a name="l03010"></a>03010   <span class="comment">/* If this is a stepping frame, we don&#39;t know which location</span>
<a name="l03011"></a>03011 <span class="comment">     triggered.  The first is as good (or bad) a guess as any...  */</span>
<a name="l03012"></a>03012   *stepping_frame_p = 1;
<a name="l03013"></a>03013   <span class="keywordflow">return</span> t-&gt;<a class="code" href="structtracepoint.html#a881af30b18b555e6ff11113da6b01a02">base</a>.<a class="code" href="structbreakpoint.html#aa869260f7e4c94204275861d820bb1a9">loc</a>;
<a name="l03014"></a>03014 }
<a name="l03015"></a>03015 
<a name="l03016"></a>03016 <span class="comment">/* Return all the actions, including default collect, of a tracepoint</span>
<a name="l03017"></a>03017 <span class="comment">   T.  It constructs cleanups into the chain, and leaves the caller to</span>
<a name="l03018"></a>03018 <span class="comment">   handle them (call do_cleanups).  */</span>
<a name="l03019"></a>03019 
<a name="l03020"></a>03020 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structcommand__line.html">command_line</a> *
<a name="l03021"></a>03021 all_tracepoint_actions_and_cleanup (<span class="keyword">struct</span> <a class="code" href="structbreakpoint.html">breakpoint</a> *t)
<a name="l03022"></a>03022 {
<a name="l03023"></a>03023   <span class="keyword">struct </span><a class="code" href="structcommand__line.html">command_line</a> *actions;
<a name="l03024"></a>03024 
<a name="l03025"></a>03025   actions = <a class="code" href="breakpoint_8c.html#a16d90a8a7538ab83a10635a1881af060">breakpoint_commands</a> (t);
<a name="l03026"></a>03026 
<a name="l03027"></a>03027   <span class="comment">/* If there are default expressions to collect, make up a collect</span>
<a name="l03028"></a>03028 <span class="comment">     action and prepend to the action list to encode.  Note that since</span>
<a name="l03029"></a>03029 <span class="comment">     validation is per-tracepoint (local var &quot;xyz&quot; might be valid for</span>
<a name="l03030"></a>03030 <span class="comment">     one tracepoint and not another, etc), we make up the action on</span>
<a name="l03031"></a>03031 <span class="comment">     the fly, and don&#39;t cache it.  */</span>
<a name="l03032"></a>03032   <span class="keywordflow">if</span> (*default_collect)
<a name="l03033"></a>03033     {
<a name="l03034"></a>03034       <span class="keyword">struct </span><a class="code" href="structcommand__line.html">command_line</a> *default_collect_action;
<a name="l03035"></a>03035       <span class="keywordtype">char</span> *default_collect_line;
<a name="l03036"></a>03036 
<a name="l03037"></a>03037       default_collect_line = <a class="code" href="common-utils_8c.html#ab9bf7e1b4e68bdd0078e9e1e55c62cec">xstrprintf</a> (<span class="stringliteral">&quot;collect %s&quot;</span>, default_collect);
<a name="l03038"></a>03038       <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, default_collect_line);
<a name="l03039"></a>03039 
<a name="l03040"></a>03040       <a class="code" href="tracepoint_8c.html#ae9b04bda0e4d8d4de77644aa0da39154">validate_actionline</a> (default_collect_line, t);
<a name="l03041"></a>03041       default_collect_action = <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (<span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structcommand__line.html">command_line</a>));
<a name="l03042"></a>03042       <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, default_collect_action);
<a name="l03043"></a>03043       default_collect_action-&gt;<a class="code" href="structcommand__line.html#aa3aea4183824359fc95edf1bf4e5291c">next</a> = actions;
<a name="l03044"></a>03044       default_collect_action-&gt;<a class="code" href="structcommand__line.html#ac3bdd932f280976d7751ee96783a2c71">line</a> = default_collect_line;
<a name="l03045"></a>03045       actions = default_collect_action;
<a name="l03046"></a>03046     }
<a name="l03047"></a>03047 
<a name="l03048"></a>03048   <span class="keywordflow">return</span> actions;
<a name="l03049"></a>03049 }
<a name="l03050"></a>03050 
<a name="l03051"></a>03051 <span class="comment">/* The tdump command.  */</span>
<a name="l03052"></a>03052 
<a name="l03053"></a>03053 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03054"></a>03054 trace_dump_command (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l03055"></a>03055 {
<a name="l03056"></a>03056   <span class="keywordtype">int</span> stepping_frame = 0;
<a name="l03057"></a>03057   <span class="keyword">struct </span><a class="code" href="structbp__location.html">bp_location</a> *loc;
<a name="l03058"></a>03058   <span class="keyword">struct </span>cleanup *old_chain;
<a name="l03059"></a>03059   <span class="keyword">struct </span><a class="code" href="structcommand__line.html">command_line</a> *actions;
<a name="l03060"></a>03060 
<a name="l03061"></a>03061   <span class="comment">/* This throws an error is not inspecting a trace frame.  */</span>
<a name="l03062"></a>03062   loc = <a class="code" href="tracepoint_8c.html#a3ff862713babf484e1e8f235475cc043">get_traceframe_location</a> (&amp;stepping_frame);
<a name="l03063"></a>03063 
<a name="l03064"></a>03064   <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;Data collected at tracepoint %d, trace frame %d:\n&quot;</span>,
<a name="l03065"></a>03065                    tracepoint_number, traceframe_number);
<a name="l03066"></a>03066 
<a name="l03067"></a>03067   old_chain = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="cleanups_8c.html#a1ec2a3980c2be1f31f2142103d1f7abf">null_cleanup</a>, NULL);
<a name="l03068"></a>03068 
<a name="l03069"></a>03069   <span class="comment">/* This command only makes sense for the current frame, not the</span>
<a name="l03070"></a>03070 <span class="comment">     selected frame.  */</span>
<a name="l03071"></a>03071   <a class="code" href="gdbthread_8h.html#a7a784124700d19ad7da32e2c20d3b0c6">make_cleanup_restore_current_thread</a> ();
<a name="l03072"></a>03072   <a class="code" href="frame_8c.html#a400fa273ac86863322cdc65683ef2356">select_frame</a> (<a class="code" href="frame_8c.html#a5ab254510728049878a232ed1b889820">get_current_frame</a> ());
<a name="l03073"></a>03073 
<a name="l03074"></a>03074   actions = all_tracepoint_actions_and_cleanup (loc-&gt;<a class="code" href="structbp__location.html#ade5cd870d1e7255c36ac84c2c6f1c4c2">owner</a>);
<a name="l03075"></a>03075 
<a name="l03076"></a>03076   trace_dump_actions (actions, 0, stepping_frame, from_tty);
<a name="l03077"></a>03077 
<a name="l03078"></a>03078   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l03079"></a>03079 }
<a name="l03080"></a>03080 
<a name="l03081"></a>03081 <span class="comment">/* Encode a piece of a tracepoint&#39;s source-level definition in a form</span>
<a name="l03082"></a>03082 <span class="comment">   that is suitable for both protocol and saving in files.  */</span>
<a name="l03083"></a>03083 <span class="comment">/* This version does not do multiple encodes for long strings; it should</span>
<a name="l03084"></a>03084 <span class="comment">   return an offset to the next piece to encode.  FIXME  */</span>
<a name="l03085"></a>03085 
<a name="l03086"></a>03086 <span class="keyword">extern</span> <span class="keywordtype">int</span>
<a name="l03087"></a><a class="code" href="tracepoint_8h.html#acb93f67fc6ad422bcc882e1d3515f8f4">03087</a> <a class="code" href="tracepoint_8c.html#a724937175721eed8af548a0b916a3a22">encode_source_string</a> (<span class="keywordtype">int</span> tpnum, <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> addr,
<a name="l03088"></a>03088                       <span class="keywordtype">char</span> *srctype, <span class="keywordtype">char</span> *src, <span class="keywordtype">char</span> *buf, <span class="keywordtype">int</span> buf_size)
<a name="l03089"></a>03089 {
<a name="l03090"></a>03090   <span class="keywordflow">if</span> (80 + strlen (srctype) &gt; buf_size)
<a name="l03091"></a>03091     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Buffer too small for source encoding&quot;</span>));
<a name="l03092"></a>03092   sprintf (buf, <span class="stringliteral">&quot;%x:%s:%s:%x:%x:&quot;</span>,
<a name="l03093"></a>03093            tpnum, <a class="code" href="utils_8c.html#ac2742d41c48dc5ede26d22070fbc486a">phex_nz</a> (addr, <span class="keyword">sizeof</span> (addr)),
<a name="l03094"></a>03094            srctype, 0, (<span class="keywordtype">int</span>) strlen (src));
<a name="l03095"></a>03095   <span class="keywordflow">if</span> (strlen (buf) + strlen (src) * 2 &gt;= buf_size)
<a name="l03096"></a>03096     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Source string too long for buffer&quot;</span>));
<a name="l03097"></a>03097   <a class="code" href="remote_8c.html#adc173beda79856ddc47c7ff6d50e69d8">bin2hex</a> ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) src, buf + strlen (buf), 0);
<a name="l03098"></a>03098   <span class="keywordflow">return</span> -1;
<a name="l03099"></a>03099 }
<a name="l03100"></a>03100 
<a name="l03101"></a>03101 <span class="comment">/* Free trace file writer.  */</span>
<a name="l03102"></a>03102 
<a name="l03103"></a>03103 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03104"></a>03104 trace_file_writer_xfree (<span class="keywordtype">void</span> *arg)
<a name="l03105"></a>03105 {
<a name="l03106"></a>03106   <span class="keyword">struct </span><a class="code" href="structtrace__file__writer.html">trace_file_writer</a> *writer = arg;
<a name="l03107"></a>03107 
<a name="l03108"></a>03108   writer-&gt;<a class="code" href="structtrace__file__writer.html#adbc93937ce01b1d31cb4fa5092ef88b4">ops</a>-&gt;<a class="code" href="structtrace__file__write__ops.html#a3876bbb04cc465f227556040be99f666">dtor</a> (writer);
<a name="l03109"></a>03109   <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (writer);
<a name="l03110"></a>03110 }
<a name="l03111"></a>03111 
<a name="l03112"></a>03112 <span class="comment">/* TFILE trace writer.  */</span>
<a name="l03113"></a>03113 
<a name="l03114"></a>03114 <span class="keyword">struct </span>tfile_trace_file_writer
<a name="l03115"></a>03115 {
<a name="l03116"></a>03116   <span class="keyword">struct </span><a class="code" href="structtrace__file__writer.html">trace_file_writer</a> base;
<a name="l03117"></a>03117 
<a name="l03118"></a>03118   <span class="comment">/* File pointer to tfile trace file.  */</span>
<a name="l03119"></a>03119   FILE *fp;
<a name="l03120"></a>03120   <span class="comment">/* Path name of the tfile trace file.  */</span>
<a name="l03121"></a>03121   <span class="keywordtype">char</span> *pathname;
<a name="l03122"></a>03122 };
<a name="l03123"></a>03123 
<a name="l03124"></a>03124 <span class="comment">/* This is the implementation of trace_file_write_ops method</span>
<a name="l03125"></a>03125 <span class="comment">   target_save.  We just call the generic target</span>
<a name="l03126"></a>03126 <span class="comment">   target_save_trace_data to do target-side saving.  */</span>
<a name="l03127"></a>03127 
<a name="l03128"></a>03128 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l03129"></a>03129 tfile_target_save (<span class="keyword">struct</span> <a class="code" href="structtrace__file__writer.html">trace_file_writer</a> *<span class="keyword">self</span>,
<a name="l03130"></a>03130                    <span class="keyword">const</span> <span class="keywordtype">char</span> *filename)
<a name="l03131"></a>03131 {
<a name="l03132"></a>03132   <span class="keywordtype">int</span> err = <a class="code" href="target_8h.html#adf4241102ca28a091302396997adcf99">target_save_trace_data</a> (filename);
<a name="l03133"></a>03133 
<a name="l03134"></a>03134   <span class="keywordflow">return</span> (err &gt;= 0);
<a name="l03135"></a>03135 }
<a name="l03136"></a>03136 
<a name="l03137"></a>03137 <span class="comment">/* This is the implementation of trace_file_write_ops method</span>
<a name="l03138"></a>03138 <span class="comment">   dtor.  */</span>
<a name="l03139"></a>03139 
<a name="l03140"></a>03140 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03141"></a>03141 tfile_dtor (<span class="keyword">struct</span> <a class="code" href="structtrace__file__writer.html">trace_file_writer</a> *<span class="keyword">self</span>)
<a name="l03142"></a>03142 {
<a name="l03143"></a>03143   <span class="keyword">struct </span>tfile_trace_file_writer *writer
<a name="l03144"></a>03144     = (<span class="keyword">struct </span>tfile_trace_file_writer *) <span class="keyword">self</span>;
<a name="l03145"></a>03145 
<a name="l03146"></a>03146   <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (writer-&gt;pathname);
<a name="l03147"></a>03147 
<a name="l03148"></a>03148   <span class="keywordflow">if</span> (writer-&gt;fp != NULL)
<a name="l03149"></a>03149     fclose (writer-&gt;fp);
<a name="l03150"></a>03150 }
<a name="l03151"></a>03151 
<a name="l03152"></a>03152 <span class="comment">/* This is the implementation of trace_file_write_ops method</span>
<a name="l03153"></a>03153 <span class="comment">   start.  It creates the trace file FILENAME and registers some</span>
<a name="l03154"></a>03154 <span class="comment">   cleanups.  */</span>
<a name="l03155"></a>03155 
<a name="l03156"></a>03156 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03157"></a>03157 tfile_start (<span class="keyword">struct</span> <a class="code" href="structtrace__file__writer.html">trace_file_writer</a> *<span class="keyword">self</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *filename)
<a name="l03158"></a>03158 {
<a name="l03159"></a>03159   <span class="keyword">struct </span>tfile_trace_file_writer *writer
<a name="l03160"></a>03160     = (<span class="keyword">struct </span>tfile_trace_file_writer *) <span class="keyword">self</span>;
<a name="l03161"></a>03161 
<a name="l03162"></a>03162   writer-&gt;pathname = tilde_expand (filename);
<a name="l03163"></a>03163   writer-&gt;fp = <a class="code" href="filestuff_8c.html#a32975d9389800b8d2c632083293e8960">gdb_fopen_cloexec</a> (writer-&gt;pathname, <span class="stringliteral">&quot;wb&quot;</span>);
<a name="l03164"></a>03164   <span class="keywordflow">if</span> (writer-&gt;fp == NULL)
<a name="l03165"></a>03165     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Unable to open file &#39;%s&#39; for saving trace data (%s)&quot;</span>),
<a name="l03166"></a>03166            writer-&gt;pathname, <a class="code" href="mingw-hdep_8c.html#a69f9363599db68d3ff495cd5e78f6b62">safe_strerror</a> (errno));
<a name="l03167"></a>03167 }
<a name="l03168"></a>03168 
<a name="l03169"></a>03169 <span class="comment">/* This is the implementation of trace_file_write_ops method</span>
<a name="l03170"></a>03170 <span class="comment">   write_header.  Write the TFILE header.  */</span>
<a name="l03171"></a>03171 
<a name="l03172"></a>03172 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03173"></a>03173 tfile_write_header (<span class="keyword">struct</span> <a class="code" href="structtrace__file__writer.html">trace_file_writer</a> *<span class="keyword">self</span>)
<a name="l03174"></a>03174 {
<a name="l03175"></a>03175   <span class="keyword">struct </span>tfile_trace_file_writer *writer
<a name="l03176"></a>03176     = (<span class="keyword">struct </span>tfile_trace_file_writer *) <span class="keyword">self</span>;
<a name="l03177"></a>03177   <span class="keywordtype">int</span> written;
<a name="l03178"></a>03178 
<a name="l03179"></a>03179   <span class="comment">/* Write a file header, with a high-bit-set char to indicate a</span>
<a name="l03180"></a>03180 <span class="comment">     binary file, plus a hint as what this file is, and a version</span>
<a name="l03181"></a>03181 <span class="comment">     number in case of future needs.  */</span>
<a name="l03182"></a>03182   written = fwrite (<span class="stringliteral">&quot;\x7fTRACE0\n&quot;</span>, 8, 1, writer-&gt;fp);
<a name="l03183"></a>03183   <span class="keywordflow">if</span> (written &lt; 1)
<a name="l03184"></a>03184     <a class="code" href="utils_8c.html#a14801ceb45147833b8ce111c89ea0d5f">perror_with_name</a> (writer-&gt;pathname);
<a name="l03185"></a>03185 }
<a name="l03186"></a>03186 
<a name="l03187"></a>03187 <span class="comment">/* This is the implementation of trace_file_write_ops method</span>
<a name="l03188"></a>03188 <span class="comment">   write_regblock_type.  Write the size of register block.  */</span>
<a name="l03189"></a>03189 
<a name="l03190"></a>03190 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03191"></a>03191 tfile_write_regblock_type (<span class="keyword">struct</span> <a class="code" href="structtrace__file__writer.html">trace_file_writer</a> *<span class="keyword">self</span>, <span class="keywordtype">int</span> <a class="code" href="go32-nat_8c.html#a854352f53b148adc24983a58a1866d66">size</a>)
<a name="l03192"></a>03192 {
<a name="l03193"></a>03193   <span class="keyword">struct </span>tfile_trace_file_writer *writer
<a name="l03194"></a>03194     = (<span class="keyword">struct </span>tfile_trace_file_writer *) <span class="keyword">self</span>;
<a name="l03195"></a>03195 
<a name="l03196"></a>03196   fprintf (writer-&gt;fp, <span class="stringliteral">&quot;R %x\n&quot;</span>, size);
<a name="l03197"></a>03197 }
<a name="l03198"></a>03198 
<a name="l03199"></a>03199 <span class="comment">/* This is the implementation of trace_file_write_ops method</span>
<a name="l03200"></a>03200 <span class="comment">   write_status.  */</span>
<a name="l03201"></a>03201 
<a name="l03202"></a>03202 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03203"></a>03203 tfile_write_status (<span class="keyword">struct</span> <a class="code" href="structtrace__file__writer.html">trace_file_writer</a> *<span class="keyword">self</span>,
<a name="l03204"></a>03204                     <span class="keyword">struct</span> <a class="code" href="structtrace__status.html">trace_status</a> *ts)
<a name="l03205"></a>03205 {
<a name="l03206"></a>03206   <span class="keyword">struct </span>tfile_trace_file_writer *writer
<a name="l03207"></a>03207     = (<span class="keyword">struct </span>tfile_trace_file_writer *) <span class="keyword">self</span>;
<a name="l03208"></a>03208 
<a name="l03209"></a>03209   fprintf (writer-&gt;fp, <span class="stringliteral">&quot;status %c;%s&quot;</span>,
<a name="l03210"></a>03210            (ts-&gt;<a class="code" href="structtrace__status.html#af1d922d381deda9d03faa4406c0a36de">running</a> ? <span class="charliteral">&#39;1&#39;</span> : <span class="charliteral">&#39;0&#39;</span>), stop_reason_names[ts-&gt;<a class="code" href="structtrace__status.html#af5d4f9904d71961dd065b57fed099644">stop_reason</a>]);
<a name="l03211"></a>03211   <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#af5d4f9904d71961dd065b57fed099644">stop_reason</a> == <a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77a4a52d08e789e2e817131f822384872c3">tracepoint_error</a>
<a name="l03212"></a>03212       || ts-&gt;<a class="code" href="structtrace__status.html#af5d4f9904d71961dd065b57fed099644">stop_reason</a> == <a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77a058a54e86734f1069cf989782b9b9f22">tstop_command</a>)
<a name="l03213"></a>03213     {
<a name="l03214"></a>03214       <span class="keywordtype">char</span> *buf = (<span class="keywordtype">char</span> *) alloca (strlen (ts-&gt;<a class="code" href="structtrace__status.html#a4d5e182f56e3793df49d65abb8e8c456">stop_desc</a>) * 2 + 1);
<a name="l03215"></a>03215 
<a name="l03216"></a>03216       <a class="code" href="remote_8c.html#adc173beda79856ddc47c7ff6d50e69d8">bin2hex</a> ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) ts-&gt;<a class="code" href="structtrace__status.html#a4d5e182f56e3793df49d65abb8e8c456">stop_desc</a>, buf, 0);
<a name="l03217"></a>03217       fprintf (writer-&gt;fp, <span class="stringliteral">&quot;:%s&quot;</span>, buf);
<a name="l03218"></a>03218     }
<a name="l03219"></a>03219   fprintf (writer-&gt;fp, <span class="stringliteral">&quot;:%x&quot;</span>, ts-&gt;<a class="code" href="structtrace__status.html#ad22500bfd24188778985319a545c42d1">stopping_tracepoint</a>);
<a name="l03220"></a>03220   <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#aebfcf3df70568e7ae65480c1f4efe0f6">traceframe_count</a> &gt;= 0)
<a name="l03221"></a>03221     fprintf (writer-&gt;fp, <span class="stringliteral">&quot;;tframes:%x&quot;</span>, ts-&gt;<a class="code" href="structtrace__status.html#aebfcf3df70568e7ae65480c1f4efe0f6">traceframe_count</a>);
<a name="l03222"></a>03222   <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#a96ec1749e52d1943618c0df3ee457979">traceframes_created</a> &gt;= 0)
<a name="l03223"></a>03223     fprintf (writer-&gt;fp, <span class="stringliteral">&quot;;tcreated:%x&quot;</span>, ts-&gt;<a class="code" href="structtrace__status.html#a96ec1749e52d1943618c0df3ee457979">traceframes_created</a>);
<a name="l03224"></a>03224   <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#ac6f0b3903e2ab671c95dec8bf674f15b">buffer_free</a> &gt;= 0)
<a name="l03225"></a>03225     fprintf (writer-&gt;fp, <span class="stringliteral">&quot;;tfree:%x&quot;</span>, ts-&gt;<a class="code" href="structtrace__status.html#ac6f0b3903e2ab671c95dec8bf674f15b">buffer_free</a>);
<a name="l03226"></a>03226   <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#a409141fb583ccaef669f996dd68a2fe0">buffer_size</a> &gt;= 0)
<a name="l03227"></a>03227     fprintf (writer-&gt;fp, <span class="stringliteral">&quot;;tsize:%x&quot;</span>, ts-&gt;<a class="code" href="structtrace__status.html#a409141fb583ccaef669f996dd68a2fe0">buffer_size</a>);
<a name="l03228"></a>03228   <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#a11a975b86259c84816c3341d32e2fca7">disconnected_tracing</a>)
<a name="l03229"></a>03229     fprintf (writer-&gt;fp, <span class="stringliteral">&quot;;disconn:%x&quot;</span>, ts-&gt;<a class="code" href="structtrace__status.html#a11a975b86259c84816c3341d32e2fca7">disconnected_tracing</a>);
<a name="l03230"></a>03230   <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#ad6afd6f38f37406b22b83ea67dd2b027">circular_buffer</a>)
<a name="l03231"></a>03231     fprintf (writer-&gt;fp, <span class="stringliteral">&quot;;circular:%x&quot;</span>, ts-&gt;<a class="code" href="structtrace__status.html#ad6afd6f38f37406b22b83ea67dd2b027">circular_buffer</a>);
<a name="l03232"></a>03232   <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#acaf0437f240f26a40362a34707353e7c">start_time</a>)
<a name="l03233"></a>03233     {
<a name="l03234"></a>03234       fprintf (writer-&gt;fp, <span class="stringliteral">&quot;;starttime:%s&quot;</span>,
<a name="l03235"></a>03235       <a class="code" href="utils_8c.html#ac2742d41c48dc5ede26d22070fbc486a">phex_nz</a> (ts-&gt;<a class="code" href="structtrace__status.html#acaf0437f240f26a40362a34707353e7c">start_time</a>, sizeof (ts-&gt;<a class="code" href="structtrace__status.html#acaf0437f240f26a40362a34707353e7c">start_time</a>)));
<a name="l03236"></a>03236     }
<a name="l03237"></a>03237   <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#a996a6a416f9e35c599215973dc2c6928">stop_time</a>)
<a name="l03238"></a>03238     {
<a name="l03239"></a>03239       fprintf (writer-&gt;fp, <span class="stringliteral">&quot;;stoptime:%s&quot;</span>,
<a name="l03240"></a>03240       <a class="code" href="utils_8c.html#ac2742d41c48dc5ede26d22070fbc486a">phex_nz</a> (ts-&gt;<a class="code" href="structtrace__status.html#a996a6a416f9e35c599215973dc2c6928">stop_time</a>, sizeof (ts-&gt;<a class="code" href="structtrace__status.html#a996a6a416f9e35c599215973dc2c6928">stop_time</a>)));
<a name="l03241"></a>03241     }
<a name="l03242"></a>03242   <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#a114142bb0c3aa89b765bce9e26bd399c">notes</a> != NULL)
<a name="l03243"></a>03243     {
<a name="l03244"></a>03244       <span class="keywordtype">char</span> *buf = (<span class="keywordtype">char</span> *) alloca (strlen (ts-&gt;<a class="code" href="structtrace__status.html#a114142bb0c3aa89b765bce9e26bd399c">notes</a>) * 2 + 1);
<a name="l03245"></a>03245 
<a name="l03246"></a>03246       <a class="code" href="remote_8c.html#adc173beda79856ddc47c7ff6d50e69d8">bin2hex</a> ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) ts-&gt;<a class="code" href="structtrace__status.html#a114142bb0c3aa89b765bce9e26bd399c">notes</a>, buf, 0);
<a name="l03247"></a>03247       fprintf (writer-&gt;fp, <span class="stringliteral">&quot;;notes:%s&quot;</span>, buf);
<a name="l03248"></a>03248     }
<a name="l03249"></a>03249   <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#ae84456b65c09a38fcf8f63ed58a78f04">user_name</a> != NULL)
<a name="l03250"></a>03250     {
<a name="l03251"></a>03251       <span class="keywordtype">char</span> *buf = (<span class="keywordtype">char</span> *) alloca (strlen (ts-&gt;<a class="code" href="structtrace__status.html#ae84456b65c09a38fcf8f63ed58a78f04">user_name</a>) * 2 + 1);
<a name="l03252"></a>03252 
<a name="l03253"></a>03253       <a class="code" href="remote_8c.html#adc173beda79856ddc47c7ff6d50e69d8">bin2hex</a> ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) ts-&gt;<a class="code" href="structtrace__status.html#ae84456b65c09a38fcf8f63ed58a78f04">user_name</a>, buf, 0);
<a name="l03254"></a>03254       fprintf (writer-&gt;fp, <span class="stringliteral">&quot;;username:%s&quot;</span>, buf);
<a name="l03255"></a>03255     }
<a name="l03256"></a>03256   fprintf (writer-&gt;fp, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03257"></a>03257 }
<a name="l03258"></a>03258 
<a name="l03259"></a>03259 <span class="comment">/* This is the implementation of trace_file_write_ops method</span>
<a name="l03260"></a>03260 <span class="comment">   write_uploaded_tsv.  */</span>
<a name="l03261"></a>03261 
<a name="l03262"></a>03262 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03263"></a>03263 tfile_write_uploaded_tsv (<span class="keyword">struct</span> <a class="code" href="structtrace__file__writer.html">trace_file_writer</a> *<span class="keyword">self</span>,
<a name="l03264"></a>03264                           <span class="keyword">struct</span> <a class="code" href="structuploaded__tsv.html">uploaded_tsv</a> *utsv)
<a name="l03265"></a>03265 {
<a name="l03266"></a>03266   <span class="keywordtype">char</span> *buf = <span class="stringliteral">&quot;&quot;</span>;
<a name="l03267"></a>03267   <span class="keyword">struct </span>tfile_trace_file_writer *writer
<a name="l03268"></a>03268     = (<span class="keyword">struct </span>tfile_trace_file_writer *) <span class="keyword">self</span>;
<a name="l03269"></a>03269 
<a name="l03270"></a>03270   <span class="keywordflow">if</span> (utsv-&gt;<a class="code" href="structuploaded__tsv.html#a13b1d8f75f005e4f82f4d26ed3bcef4f">name</a>)
<a name="l03271"></a>03271     {
<a name="l03272"></a>03272       buf = (<span class="keywordtype">char</span> *) <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (strlen (utsv-&gt;<a class="code" href="structuploaded__tsv.html#a13b1d8f75f005e4f82f4d26ed3bcef4f">name</a>) * 2 + 1);
<a name="l03273"></a>03273       <a class="code" href="remote_8c.html#adc173beda79856ddc47c7ff6d50e69d8">bin2hex</a> ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) (utsv-&gt;<a class="code" href="structuploaded__tsv.html#a13b1d8f75f005e4f82f4d26ed3bcef4f">name</a>), buf, 0);
<a name="l03274"></a>03274     }
<a name="l03275"></a>03275 
<a name="l03276"></a>03276   fprintf (writer-&gt;fp, <span class="stringliteral">&quot;tsv %x:%s:%x:%s\n&quot;</span>,
<a name="l03277"></a>03277            utsv-&gt;<a class="code" href="structuploaded__tsv.html#a3a5668fbc028dde6a8d3400bb380ea00">number</a>, <a class="code" href="utils_8c.html#ac2742d41c48dc5ede26d22070fbc486a">phex_nz</a> (utsv-&gt;<a class="code" href="structuploaded__tsv.html#a31a9a71e96aeb2239013d0ab0999f62c">initial_value</a>, 8),
<a name="l03278"></a>03278            utsv-&gt;<a class="code" href="structuploaded__tsv.html#ac461563a4d2d105c86bb3c3f9bee892c">builtin</a>, buf);
<a name="l03279"></a>03279 
<a name="l03280"></a>03280   <span class="keywordflow">if</span> (utsv-&gt;<a class="code" href="structuploaded__tsv.html#a13b1d8f75f005e4f82f4d26ed3bcef4f">name</a>)
<a name="l03281"></a>03281     <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (buf);
<a name="l03282"></a>03282 }
<a name="l03283"></a>03283 
<a name="l03284"></a><a class="code" href="tracepoint_8c.html#aaf15a3a1563a5e8646f5665465f99e3e">03284</a> <span class="preprocessor">#define MAX_TRACE_UPLOAD 2000</span>
<a name="l03285"></a>03285 <span class="preprocessor"></span>
<a name="l03286"></a>03286 <span class="comment">/* This is the implementation of trace_file_write_ops method</span>
<a name="l03287"></a>03287 <span class="comment">   write_uploaded_tp.  */</span>
<a name="l03288"></a>03288 
<a name="l03289"></a>03289 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03290"></a>03290 tfile_write_uploaded_tp (<span class="keyword">struct</span> <a class="code" href="structtrace__file__writer.html">trace_file_writer</a> *<span class="keyword">self</span>,
<a name="l03291"></a>03291                          <span class="keyword">struct</span> <a class="code" href="structuploaded__tp.html">uploaded_tp</a> *utp)
<a name="l03292"></a>03292 {
<a name="l03293"></a>03293   <span class="keyword">struct </span>tfile_trace_file_writer *writer
<a name="l03294"></a>03294     = (<span class="keyword">struct </span>tfile_trace_file_writer *) <span class="keyword">self</span>;
<a name="l03295"></a>03295   <span class="keywordtype">int</span> a;
<a name="l03296"></a>03296   <span class="keywordtype">char</span> *act;
<a name="l03297"></a>03297   <span class="keywordtype">char</span> buf[<a class="code" href="tracepoint_8c.html#aaf15a3a1563a5e8646f5665465f99e3e">MAX_TRACE_UPLOAD</a>];
<a name="l03298"></a>03298 
<a name="l03299"></a>03299   fprintf (writer-&gt;fp, <span class="stringliteral">&quot;tp T%x:%s:%c:%x:%x&quot;</span>,
<a name="l03300"></a>03300            utp-&gt;<a class="code" href="structuploaded__tp.html#a58cc4be1b86f8aa20de77b27929dfe12">number</a>, <a class="code" href="utils_8c.html#ac2742d41c48dc5ede26d22070fbc486a">phex_nz</a> (utp-&gt;<a class="code" href="structuploaded__tp.html#a97572e43a086932e96df20104262d0e8">addr</a>, sizeof (utp-&gt;<a class="code" href="structuploaded__tp.html#a97572e43a086932e96df20104262d0e8">addr</a>)),
<a name="l03301"></a>03301            (utp-&gt;<a class="code" href="structuploaded__tp.html#ac4180327fbf6bbbc002cbe17b8bde381">enabled</a> ? <span class="charliteral">&#39;E&#39;</span> : <span class="charliteral">&#39;D&#39;</span>), utp-&gt;<a class="code" href="structuploaded__tp.html#ae1b0283bc5b2a26b13fedcbe49680575">step</a>, utp-&gt;<a class="code" href="structuploaded__tp.html#ac4636b0feec50663698467304285954d">pass</a>);
<a name="l03302"></a>03302   <span class="keywordflow">if</span> (utp-&gt;<a class="code" href="structuploaded__tp.html#a3e983c135ec77bcb96798d08c683869d">type</a> == <a class="code" href="breakpoint_8h.html#a67735d134567a4ba184d011f1db556cfa563d27bd02a1303a86081828b40002db">bp_fast_tracepoint</a>)
<a name="l03303"></a>03303     fprintf (writer-&gt;fp, <span class="stringliteral">&quot;:F%x&quot;</span>, utp-&gt;<a class="code" href="structuploaded__tp.html#aa2180ba343f7e79e587335f96bb821fb">orig_size</a>);
<a name="l03304"></a>03304   <span class="keywordflow">if</span> (utp-&gt;<a class="code" href="structuploaded__tp.html#aa2faa5d0dcfadebb40ae25a72e3a6f37">cond</a>)
<a name="l03305"></a>03305     fprintf (writer-&gt;fp,
<a name="l03306"></a>03306              <span class="stringliteral">&quot;:X%x,%s&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) strlen (utp-&gt;<a class="code" href="structuploaded__tp.html#aa2faa5d0dcfadebb40ae25a72e3a6f37">cond</a>) / 2,
<a name="l03307"></a>03307              utp-&gt;<a class="code" href="structuploaded__tp.html#aa2faa5d0dcfadebb40ae25a72e3a6f37">cond</a>);
<a name="l03308"></a>03308   fprintf (writer-&gt;fp, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03309"></a>03309   <span class="keywordflow">for</span> (a = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="gdb__vecs_8h.html#a5ea7d3fefa2144d9bddaf2053c9691a1">char_ptr</a>, utp-&gt;actions, a, act); ++a)
<a name="l03310"></a>03310     fprintf (writer-&gt;fp, <span class="stringliteral">&quot;tp A%x:%s:%s\n&quot;</span>,
<a name="l03311"></a>03311              utp-&gt;<a class="code" href="structuploaded__tp.html#a58cc4be1b86f8aa20de77b27929dfe12">number</a>, <a class="code" href="utils_8c.html#ac2742d41c48dc5ede26d22070fbc486a">phex_nz</a> (utp-&gt;<a class="code" href="structuploaded__tp.html#a97572e43a086932e96df20104262d0e8">addr</a>, sizeof (utp-&gt;<a class="code" href="structuploaded__tp.html#a97572e43a086932e96df20104262d0e8">addr</a>)), act);
<a name="l03312"></a>03312   <span class="keywordflow">for</span> (a = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="gdb__vecs_8h.html#a5ea7d3fefa2144d9bddaf2053c9691a1">char_ptr</a>, utp-&gt;step_actions, a, act); ++a)
<a name="l03313"></a>03313     fprintf (writer-&gt;fp, <span class="stringliteral">&quot;tp S%x:%s:%s\n&quot;</span>,
<a name="l03314"></a>03314              utp-&gt;<a class="code" href="structuploaded__tp.html#a58cc4be1b86f8aa20de77b27929dfe12">number</a>, <a class="code" href="utils_8c.html#ac2742d41c48dc5ede26d22070fbc486a">phex_nz</a> (utp-&gt;<a class="code" href="structuploaded__tp.html#a97572e43a086932e96df20104262d0e8">addr</a>, sizeof (utp-&gt;<a class="code" href="structuploaded__tp.html#a97572e43a086932e96df20104262d0e8">addr</a>)), act);
<a name="l03315"></a>03315   <span class="keywordflow">if</span> (utp-&gt;<a class="code" href="structuploaded__tp.html#abad64180bd34a5eef3c928e4909ce8b0">at_string</a>)
<a name="l03316"></a>03316     {
<a name="l03317"></a>03317       <a class="code" href="tracepoint_8c.html#a724937175721eed8af548a0b916a3a22">encode_source_string</a> (utp-&gt;<a class="code" href="structuploaded__tp.html#a58cc4be1b86f8aa20de77b27929dfe12">number</a>, utp-&gt;<a class="code" href="structuploaded__tp.html#a97572e43a086932e96df20104262d0e8">addr</a>,
<a name="l03318"></a>03318                             <span class="stringliteral">&quot;at&quot;</span>, utp-&gt;<a class="code" href="structuploaded__tp.html#abad64180bd34a5eef3c928e4909ce8b0">at_string</a>, buf, <a class="code" href="tracepoint_8c.html#aaf15a3a1563a5e8646f5665465f99e3e">MAX_TRACE_UPLOAD</a>);
<a name="l03319"></a>03319       fprintf (writer-&gt;fp, <span class="stringliteral">&quot;tp Z%s\n&quot;</span>, buf);
<a name="l03320"></a>03320     }
<a name="l03321"></a>03321   <span class="keywordflow">if</span> (utp-&gt;<a class="code" href="structuploaded__tp.html#a6413e606d74685de1dbe098ac06b8d26">cond_string</a>)
<a name="l03322"></a>03322     {
<a name="l03323"></a>03323       <a class="code" href="tracepoint_8c.html#a724937175721eed8af548a0b916a3a22">encode_source_string</a> (utp-&gt;<a class="code" href="structuploaded__tp.html#a58cc4be1b86f8aa20de77b27929dfe12">number</a>, utp-&gt;<a class="code" href="structuploaded__tp.html#a97572e43a086932e96df20104262d0e8">addr</a>,
<a name="l03324"></a>03324                             <span class="stringliteral">&quot;cond&quot;</span>, utp-&gt;<a class="code" href="structuploaded__tp.html#a6413e606d74685de1dbe098ac06b8d26">cond_string</a>,
<a name="l03325"></a>03325                             buf, <a class="code" href="tracepoint_8c.html#aaf15a3a1563a5e8646f5665465f99e3e">MAX_TRACE_UPLOAD</a>);
<a name="l03326"></a>03326       fprintf (writer-&gt;fp, <span class="stringliteral">&quot;tp Z%s\n&quot;</span>, buf);
<a name="l03327"></a>03327     }
<a name="l03328"></a>03328   <span class="keywordflow">for</span> (a = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="gdb__vecs_8h.html#a5ea7d3fefa2144d9bddaf2053c9691a1">char_ptr</a>, utp-&gt;cmd_strings, a, act); ++a)
<a name="l03329"></a>03329     {
<a name="l03330"></a>03330       <a class="code" href="tracepoint_8c.html#a724937175721eed8af548a0b916a3a22">encode_source_string</a> (utp-&gt;<a class="code" href="structuploaded__tp.html#a58cc4be1b86f8aa20de77b27929dfe12">number</a>, utp-&gt;<a class="code" href="structuploaded__tp.html#a97572e43a086932e96df20104262d0e8">addr</a>, <span class="stringliteral">&quot;cmd&quot;</span>, act,
<a name="l03331"></a>03331                             buf, <a class="code" href="tracepoint_8c.html#aaf15a3a1563a5e8646f5665465f99e3e">MAX_TRACE_UPLOAD</a>);
<a name="l03332"></a>03332       fprintf (writer-&gt;fp, <span class="stringliteral">&quot;tp Z%s\n&quot;</span>, buf);
<a name="l03333"></a>03333     }
<a name="l03334"></a>03334   fprintf (writer-&gt;fp, <span class="stringliteral">&quot;tp V%x:%s:%x:%s\n&quot;</span>,
<a name="l03335"></a>03335            utp-&gt;<a class="code" href="structuploaded__tp.html#a58cc4be1b86f8aa20de77b27929dfe12">number</a>, <a class="code" href="utils_8c.html#ac2742d41c48dc5ede26d22070fbc486a">phex_nz</a> (utp-&gt;<a class="code" href="structuploaded__tp.html#a97572e43a086932e96df20104262d0e8">addr</a>, sizeof (utp-&gt;<a class="code" href="structuploaded__tp.html#a97572e43a086932e96df20104262d0e8">addr</a>)),
<a name="l03336"></a>03336            utp-&gt;<a class="code" href="structuploaded__tp.html#af46a3f029b74faa22ce2a4760815edd7">hit_count</a>,
<a name="l03337"></a>03337            <a class="code" href="utils_8c.html#ac2742d41c48dc5ede26d22070fbc486a">phex_nz</a> (utp-&gt;<a class="code" href="structuploaded__tp.html#a719fe3ac2c13968739deef8283512665">traceframe_usage</a>,
<a name="l03338"></a>03338                     sizeof (utp-&gt;<a class="code" href="structuploaded__tp.html#a719fe3ac2c13968739deef8283512665">traceframe_usage</a>)));
<a name="l03339"></a>03339 }
<a name="l03340"></a>03340 
<a name="l03341"></a>03341 <span class="comment">/* This is the implementation of trace_file_write_ops method</span>
<a name="l03342"></a>03342 <span class="comment">   write_definition_end.  */</span>
<a name="l03343"></a>03343 
<a name="l03344"></a>03344 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03345"></a>03345 tfile_write_definition_end (<span class="keyword">struct</span> <a class="code" href="structtrace__file__writer.html">trace_file_writer</a> *<span class="keyword">self</span>)
<a name="l03346"></a>03346 {
<a name="l03347"></a>03347   <span class="keyword">struct </span>tfile_trace_file_writer *writer
<a name="l03348"></a>03348     = (<span class="keyword">struct </span>tfile_trace_file_writer *) <span class="keyword">self</span>;
<a name="l03349"></a>03349 
<a name="l03350"></a>03350   fprintf (writer-&gt;fp, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l03351"></a>03351 }
<a name="l03352"></a>03352 
<a name="l03353"></a>03353 <span class="comment">/* This is the implementation of trace_file_write_ops method</span>
<a name="l03354"></a>03354 <span class="comment">   write_raw_data.  */</span>
<a name="l03355"></a>03355 
<a name="l03356"></a>03356 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03357"></a>03357 tfile_write_raw_data (<span class="keyword">struct</span> <a class="code" href="structtrace__file__writer.html">trace_file_writer</a> *<span class="keyword">self</span>, <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *buf,
<a name="l03358"></a>03358                       <a class="code" href="defs_8h.html#ac7647a3f71533007c9e128f3ddda1987">LONGEST</a> len)
<a name="l03359"></a>03359 {
<a name="l03360"></a>03360   <span class="keyword">struct </span>tfile_trace_file_writer *writer
<a name="l03361"></a>03361     = (<span class="keyword">struct </span>tfile_trace_file_writer *) <span class="keyword">self</span>;
<a name="l03362"></a>03362 
<a name="l03363"></a>03363   <span class="keywordflow">if</span> (fwrite (buf, len, 1, writer-&gt;fp) &lt; 1)
<a name="l03364"></a>03364     <a class="code" href="utils_8c.html#a14801ceb45147833b8ce111c89ea0d5f">perror_with_name</a> (writer-&gt;pathname);
<a name="l03365"></a>03365 }
<a name="l03366"></a>03366 
<a name="l03367"></a>03367 <span class="comment">/* This is the implementation of trace_file_write_ops method</span>
<a name="l03368"></a>03368 <span class="comment">   end.  */</span>
<a name="l03369"></a>03369 
<a name="l03370"></a>03370 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03371"></a>03371 tfile_end (<span class="keyword">struct</span> <a class="code" href="structtrace__file__writer.html">trace_file_writer</a> *<span class="keyword">self</span>)
<a name="l03372"></a>03372 {
<a name="l03373"></a>03373   <span class="keyword">struct </span>tfile_trace_file_writer *writer
<a name="l03374"></a>03374     = (<span class="keyword">struct </span>tfile_trace_file_writer *) <span class="keyword">self</span>;
<a name="l03375"></a>03375   uint32_t gotten = 0;
<a name="l03376"></a>03376 
<a name="l03377"></a>03377   <span class="comment">/* Mark the end of trace data.  */</span>
<a name="l03378"></a>03378   <span class="keywordflow">if</span> (fwrite (&amp;gotten, 4, 1, writer-&gt;fp) &lt; 1)
<a name="l03379"></a>03379     <a class="code" href="utils_8c.html#a14801ceb45147833b8ce111c89ea0d5f">perror_with_name</a> (writer-&gt;pathname);
<a name="l03380"></a>03380 }
<a name="l03381"></a>03381 
<a name="l03382"></a>03382 <span class="comment">/* Operations to write trace buffers into TFILE format.  */</span>
<a name="l03383"></a>03383 
<a name="l03384"></a>03384 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structtrace__file__write__ops.html">trace_file_write_ops</a> tfile_write_ops =
<a name="l03385"></a>03385 {
<a name="l03386"></a>03386   tfile_dtor,
<a name="l03387"></a>03387   tfile_target_save,
<a name="l03388"></a>03388   tfile_start,
<a name="l03389"></a>03389   tfile_write_header,
<a name="l03390"></a>03390   tfile_write_regblock_type,
<a name="l03391"></a>03391   tfile_write_status,
<a name="l03392"></a>03392   tfile_write_uploaded_tsv,
<a name="l03393"></a>03393   tfile_write_uploaded_tp,
<a name="l03394"></a>03394   tfile_write_definition_end,
<a name="l03395"></a>03395   tfile_write_raw_data,
<a name="l03396"></a>03396   NULL,
<a name="l03397"></a>03397   tfile_end,
<a name="l03398"></a>03398 };
<a name="l03399"></a>03399 
<a name="l03400"></a>03400 <span class="comment">/* Helper macros.  */</span>
<a name="l03401"></a>03401 
<a name="l03402"></a><a class="code" href="tracepoint_8c.html#aaedec15013f891df65f7eb5f024ad832">03402</a> <span class="preprocessor">#define TRACE_WRITE_R_BLOCK(writer, buf, size)  \</span>
<a name="l03403"></a>03403 <span class="preprocessor">  writer-&gt;ops-&gt;frame_ops-&gt;write_r_block ((writer), (buf), (size))</span>
<a name="l03404"></a><a class="code" href="tracepoint_8c.html#a6e896ada86617ec778a2f02e8d3029d6">03404</a> <span class="preprocessor"></span><span class="preprocessor">#define TRACE_WRITE_M_BLOCK_HEADER(writer, addr, size)            \</span>
<a name="l03405"></a>03405 <span class="preprocessor">  writer-&gt;ops-&gt;frame_ops-&gt;write_m_block_header ((writer), (addr), \</span>
<a name="l03406"></a>03406 <span class="preprocessor">                                                (size))</span>
<a name="l03407"></a><a class="code" href="tracepoint_8c.html#a66d3fc28e985e7ce9a48bd690a35c7d7">03407</a> <span class="preprocessor"></span><span class="preprocessor">#define TRACE_WRITE_M_BLOCK_MEMORY(writer, buf, size)     \</span>
<a name="l03408"></a>03408 <span class="preprocessor">  writer-&gt;ops-&gt;frame_ops-&gt;write_m_block_memory ((writer), (buf), \</span>
<a name="l03409"></a>03409 <span class="preprocessor">                                                (size))</span>
<a name="l03410"></a><a class="code" href="tracepoint_8c.html#a9607bca62e007058764028a0f052698c">03410</a> <span class="preprocessor"></span><span class="preprocessor">#define TRACE_WRITE_V_BLOCK(writer, num, val)   \</span>
<a name="l03411"></a>03411 <span class="preprocessor">  writer-&gt;ops-&gt;frame_ops-&gt;write_v_block ((writer), (num), (val))</span>
<a name="l03412"></a>03412 <span class="preprocessor"></span>
<a name="l03413"></a>03413 <span class="comment">/* Save tracepoint data to file named FILENAME through WRITER.  WRITER</span>
<a name="l03414"></a>03414 <span class="comment">   determines the trace file format.  If TARGET_DOES_SAVE is non-zero,</span>
<a name="l03415"></a>03415 <span class="comment">   the save is performed on the target, otherwise GDB obtains all trace</span>
<a name="l03416"></a>03416 <span class="comment">   data and saves it locally.  */</span>
<a name="l03417"></a>03417 
<a name="l03418"></a>03418 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03419"></a>03419 trace_save (<span class="keyword">const</span> <span class="keywordtype">char</span> *filename, <span class="keyword">struct</span> <a class="code" href="structtrace__file__writer.html">trace_file_writer</a> *writer,
<a name="l03420"></a>03420             <span class="keywordtype">int</span> target_does_save)
<a name="l03421"></a>03421 {
<a name="l03422"></a>03422   <span class="keyword">struct </span><a class="code" href="structtrace__status.html">trace_status</a> *ts = <a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> ();
<a name="l03423"></a>03423   <span class="keywordtype">int</span> <a class="code" href="namespaceexsummary.html#aa4a2eed06e51a1f73ff9053ec9f2591e">status</a>;
<a name="l03424"></a>03424   <span class="keyword">struct </span><a class="code" href="structuploaded__tp.html">uploaded_tp</a> *uploaded_tps = NULL, *utp;
<a name="l03425"></a>03425   <span class="keyword">struct </span><a class="code" href="structuploaded__tsv.html">uploaded_tsv</a> *uploaded_tsvs = NULL, *utsv;
<a name="l03426"></a>03426 
<a name="l03427"></a>03427   <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> offset = 0;
<a name="l03428"></a>03428   <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> buf[<a class="code" href="tracepoint_8c.html#aaf15a3a1563a5e8646f5665465f99e3e">MAX_TRACE_UPLOAD</a>];
<a name="l03429"></a>03429 <span class="preprocessor">#define MAX_TRACE_UPLOAD 2000</span>
<a name="l03430"></a>03430 <span class="preprocessor"></span>  <span class="keywordtype">int</span> written;
<a name="l03431"></a>03431   <span class="keyword">enum</span> bfd_endian byte_order = <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ());
<a name="l03432"></a>03432 
<a name="l03433"></a>03433   <span class="comment">/* If the target is to save the data to a file on its own, then just</span>
<a name="l03434"></a>03434 <span class="comment">     send the command and be done with it.  */</span>
<a name="l03435"></a>03435   <span class="keywordflow">if</span> (target_does_save)
<a name="l03436"></a>03436     {
<a name="l03437"></a>03437       <span class="keywordflow">if</span> (!writer-&gt;<a class="code" href="structtrace__file__writer.html#adbc93937ce01b1d31cb4fa5092ef88b4">ops</a>-&gt;<a class="code" href="structtrace__file__write__ops.html#a36ee3bb40cd33d8fea73ed47bab7e696">target_save</a> (writer, filename))
<a name="l03438"></a>03438         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Target failed to save trace data to &#39;%s&#39;.&quot;</span>),
<a name="l03439"></a>03439                filename);
<a name="l03440"></a>03440       <span class="keywordflow">return</span>;
<a name="l03441"></a>03441     }
<a name="l03442"></a>03442 
<a name="l03443"></a>03443   <span class="comment">/* Get the trace status first before opening the file, so if the</span>
<a name="l03444"></a>03444 <span class="comment">     target is losing, we can get out without touching files.  */</span>
<a name="l03445"></a>03445   status = <a class="code" href="target_8h.html#ad3a877c0f56ac304d3ddb3b8a19fc4d3">target_get_trace_status</a> (ts);
<a name="l03446"></a>03446 
<a name="l03447"></a>03447   writer-&gt;<a class="code" href="structtrace__file__writer.html#adbc93937ce01b1d31cb4fa5092ef88b4">ops</a>-&gt;<a class="code" href="structtrace__file__write__ops.html#a4b9f2139e8ba6897f16ba9411d7c4105">start</a> (writer, filename);
<a name="l03448"></a>03448 
<a name="l03449"></a>03449   writer-&gt;<a class="code" href="structtrace__file__writer.html#adbc93937ce01b1d31cb4fa5092ef88b4">ops</a>-&gt;<a class="code" href="structtrace__file__write__ops.html#a37379b9dabab7aa0cc1a1cdbc38b9c8f">write_header</a> (writer);
<a name="l03450"></a>03450 
<a name="l03451"></a>03451   <span class="comment">/* Write descriptive info.  */</span>
<a name="l03452"></a>03452 
<a name="l03453"></a>03453   <span class="comment">/* Write out the size of a register block.  */</span>
<a name="l03454"></a>03454   writer-&gt;<a class="code" href="structtrace__file__writer.html#adbc93937ce01b1d31cb4fa5092ef88b4">ops</a>-&gt;<a class="code" href="structtrace__file__write__ops.html#a2c38babe9b8cd575b1abe8330a7c24c4">write_regblock_type</a> (writer, <a class="code" href="tracepoint_8c.html#a5dc5a6689e0bd3501fe98c5e89858e7c">trace_regblock_size</a>);
<a name="l03455"></a>03455 
<a name="l03456"></a>03456   <span class="comment">/* Write out status of the tracing run (aka &quot;tstatus&quot; info).  */</span>
<a name="l03457"></a>03457   writer-&gt;<a class="code" href="structtrace__file__writer.html#adbc93937ce01b1d31cb4fa5092ef88b4">ops</a>-&gt;<a class="code" href="structtrace__file__write__ops.html#afd4b0b46e8621e4710a3f874f13728df">write_status</a> (writer, ts);
<a name="l03458"></a>03458 
<a name="l03459"></a>03459   <span class="comment">/* Note that we want to upload tracepoints and save those, rather</span>
<a name="l03460"></a>03460 <span class="comment">     than simply writing out the local ones, because the user may have</span>
<a name="l03461"></a>03461 <span class="comment">     changed tracepoints in GDB in preparation for a future tracing</span>
<a name="l03462"></a>03462 <span class="comment">     run, or maybe just mass-deleted all types of breakpoints as part</span>
<a name="l03463"></a>03463 <span class="comment">     of cleaning up.  So as not to contaminate the session, leave the</span>
<a name="l03464"></a>03464 <span class="comment">     data in its uploaded form, don&#39;t make into real tracepoints.  */</span>
<a name="l03465"></a>03465 
<a name="l03466"></a>03466   <span class="comment">/* Get trace state variables first, they may be checked when parsing</span>
<a name="l03467"></a>03467 <span class="comment">     uploaded commands.  */</span>
<a name="l03468"></a>03468 
<a name="l03469"></a>03469   <a class="code" href="target_8h.html#a54efebe82a97cf1b2c10f64347dc1950">target_upload_trace_state_variables</a> (&amp;uploaded_tsvs);
<a name="l03470"></a>03470 
<a name="l03471"></a>03471   <span class="keywordflow">for</span> (utsv = uploaded_tsvs; utsv; utsv = utsv-&gt;<a class="code" href="structuploaded__tsv.html#aab1ad86881ad07a1bf1a66ee1e1b1e88">next</a>)
<a name="l03472"></a>03472     writer-&gt;<a class="code" href="structtrace__file__writer.html#adbc93937ce01b1d31cb4fa5092ef88b4">ops</a>-&gt;<a class="code" href="structtrace__file__write__ops.html#a304463141b61aa028bf295d664486af7">write_uploaded_tsv</a> (writer, utsv);
<a name="l03473"></a>03473 
<a name="l03474"></a>03474   free_uploaded_tsvs (&amp;uploaded_tsvs);
<a name="l03475"></a>03475 
<a name="l03476"></a>03476   <a class="code" href="target_8h.html#ab4f3bb125925d8d70e5c552709cb7a2c">target_upload_tracepoints</a> (&amp;uploaded_tps);
<a name="l03477"></a>03477 
<a name="l03478"></a>03478   <span class="keywordflow">for</span> (utp = uploaded_tps; utp; utp = utp-&gt;<a class="code" href="structuploaded__tp.html#a98d537cc2a745d0f53422afd075e9abf">next</a>)
<a name="l03479"></a>03479     <a class="code" href="target_8h.html#a4e32144454bcabb9bf5911a6d6e67a10">target_get_tracepoint_status</a> (NULL, utp);
<a name="l03480"></a>03480 
<a name="l03481"></a>03481   <span class="keywordflow">for</span> (utp = uploaded_tps; utp; utp = utp-&gt;<a class="code" href="structuploaded__tp.html#a98d537cc2a745d0f53422afd075e9abf">next</a>)
<a name="l03482"></a>03482     writer-&gt;<a class="code" href="structtrace__file__writer.html#adbc93937ce01b1d31cb4fa5092ef88b4">ops</a>-&gt;<a class="code" href="structtrace__file__write__ops.html#a0a15a7da130e637d86f1c982edfefac7">write_uploaded_tp</a> (writer, utp);
<a name="l03483"></a>03483 
<a name="l03484"></a>03484   free_uploaded_tps (&amp;uploaded_tps);
<a name="l03485"></a>03485 
<a name="l03486"></a>03486   <span class="comment">/* Mark the end of the definition section.  */</span>
<a name="l03487"></a>03487   writer-&gt;<a class="code" href="structtrace__file__writer.html#adbc93937ce01b1d31cb4fa5092ef88b4">ops</a>-&gt;<a class="code" href="structtrace__file__write__ops.html#ae2d6d094304b51c6fe57c6656237ff7b">write_definition_end</a> (writer);
<a name="l03488"></a>03488 
<a name="l03489"></a>03489   <span class="comment">/* Get and write the trace data proper.  */</span>
<a name="l03490"></a>03490   <span class="keywordflow">while</span> (1)
<a name="l03491"></a>03491     {
<a name="l03492"></a>03492       <a class="code" href="defs_8h.html#ac7647a3f71533007c9e128f3ddda1987">LONGEST</a> gotten = 0;
<a name="l03493"></a>03493 
<a name="l03494"></a>03494       <span class="comment">/* The writer supports writing the contents of trace buffer</span>
<a name="l03495"></a>03495 <span class="comment">          directly to trace file.  Don&#39;t parse the contents of trace</span>
<a name="l03496"></a>03496 <span class="comment">          buffer.  */</span>
<a name="l03497"></a>03497       <span class="keywordflow">if</span> (writer-&gt;<a class="code" href="structtrace__file__writer.html#adbc93937ce01b1d31cb4fa5092ef88b4">ops</a>-&gt;<a class="code" href="structtrace__file__write__ops.html#a529f9fbe42fbc34bb238228ed11b33a9">write_trace_buffer</a> != NULL)
<a name="l03498"></a>03498         {
<a name="l03499"></a>03499           <span class="comment">/* We ask for big blocks, in the hopes of efficiency, but</span>
<a name="l03500"></a>03500 <span class="comment">             will take less if the target has packet size limitations</span>
<a name="l03501"></a>03501 <span class="comment">             or some such.  */</span>
<a name="l03502"></a>03502           gotten = <a class="code" href="target_8h.html#a0fc1199a86c59ca0141a1c39fa4baee2">target_get_raw_trace_data</a> (buf, offset,
<a name="l03503"></a>03503                                               <a class="code" href="tracepoint_8c.html#aaf15a3a1563a5e8646f5665465f99e3e">MAX_TRACE_UPLOAD</a>);
<a name="l03504"></a>03504           <span class="keywordflow">if</span> (gotten &lt; 0)
<a name="l03505"></a>03505             <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Failure to get requested trace buffer data&quot;</span>));
<a name="l03506"></a>03506           <span class="comment">/* No more data is forthcoming, we&#39;re done.  */</span>
<a name="l03507"></a>03507           <span class="keywordflow">if</span> (gotten == 0)
<a name="l03508"></a>03508             <span class="keywordflow">break</span>;
<a name="l03509"></a>03509 
<a name="l03510"></a>03510           writer-&gt;<a class="code" href="structtrace__file__writer.html#adbc93937ce01b1d31cb4fa5092ef88b4">ops</a>-&gt;<a class="code" href="structtrace__file__write__ops.html#a529f9fbe42fbc34bb238228ed11b33a9">write_trace_buffer</a> (writer, buf, gotten);
<a name="l03511"></a>03511 
<a name="l03512"></a>03512           offset += gotten;
<a name="l03513"></a>03513         }
<a name="l03514"></a>03514       <span class="keywordflow">else</span>
<a name="l03515"></a>03515         {
<a name="l03516"></a>03516           uint16_t tp_num;
<a name="l03517"></a>03517           uint32_t tf_size;
<a name="l03518"></a>03518           <span class="comment">/* Parse the trace buffers according to how data are stored</span>
<a name="l03519"></a>03519 <span class="comment">             in trace buffer in GDBserver.  */</span>
<a name="l03520"></a>03520 
<a name="l03521"></a>03521           gotten = <a class="code" href="target_8h.html#a0fc1199a86c59ca0141a1c39fa4baee2">target_get_raw_trace_data</a> (buf, offset, 6);
<a name="l03522"></a>03522 
<a name="l03523"></a>03523           <span class="keywordflow">if</span> (gotten == 0)
<a name="l03524"></a>03524             <span class="keywordflow">break</span>;
<a name="l03525"></a>03525 
<a name="l03526"></a>03526           <span class="comment">/* Read the first six bytes in, which is the tracepoint</span>
<a name="l03527"></a>03527 <span class="comment">             number and trace frame size.  */</span>
<a name="l03528"></a>03528           tp_num = (uint16_t)
<a name="l03529"></a>03529             <a class="code" href="defs_8h.html#a99aec65329508b4d449a4f881026f844">extract_unsigned_integer</a> (&amp;buf[0], 2, byte_order);
<a name="l03530"></a>03530 
<a name="l03531"></a>03531           tf_size = (uint32_t)
<a name="l03532"></a>03532             <a class="code" href="defs_8h.html#a99aec65329508b4d449a4f881026f844">extract_unsigned_integer</a> (&amp;buf[2], 4, byte_order);
<a name="l03533"></a>03533 
<a name="l03534"></a>03534           writer-&gt;<a class="code" href="structtrace__file__writer.html#adbc93937ce01b1d31cb4fa5092ef88b4">ops</a>-&gt;<a class="code" href="structtrace__file__write__ops.html#aad50952dc70c7eb9658032f3f390580b">frame_ops</a>-&gt;<a class="code" href="structtrace__frame__write__ops.html#a4c172ff8245fa28daf03b6340190091f">start</a> (writer, tp_num);
<a name="l03535"></a>03535           gotten = 6;
<a name="l03536"></a>03536 
<a name="l03537"></a>03537           <span class="keywordflow">if</span> (tf_size &gt; 0)
<a name="l03538"></a>03538             {
<a name="l03539"></a>03539               <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> block;
<a name="l03540"></a>03540 
<a name="l03541"></a>03541               offset += 6;
<a name="l03542"></a>03542 
<a name="l03543"></a>03543               <span class="keywordflow">for</span> (block = 0; block &lt; tf_size; )
<a name="l03544"></a>03544                 {
<a name="l03545"></a>03545                   <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> <a class="code" href="mdebugread_8c.html#aa2494894aca52a71313c23c460fe0443">block_type</a>;
<a name="l03546"></a>03546 
<a name="l03547"></a>03547                   <span class="comment">/* We&#39;ll fetch one block each time, in order to</span>
<a name="l03548"></a>03548 <span class="comment">                     handle the extremely large &#39;M&#39; block.  We first</span>
<a name="l03549"></a>03549 <span class="comment">                     fetch one byte to get the type of the block.  */</span>
<a name="l03550"></a>03550                   gotten = <a class="code" href="target_8h.html#a0fc1199a86c59ca0141a1c39fa4baee2">target_get_raw_trace_data</a> (buf, offset, 1);
<a name="l03551"></a>03551                   <span class="keywordflow">if</span> (gotten &lt; 1)
<a name="l03552"></a>03552                     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Failure to get requested trace buffer data&quot;</span>));
<a name="l03553"></a>03553 
<a name="l03554"></a>03554                   gotten = 1;
<a name="l03555"></a>03555                   block += 1;
<a name="l03556"></a>03556                   offset += 1;
<a name="l03557"></a>03557 
<a name="l03558"></a>03558                   block_type = buf[0];
<a name="l03559"></a>03559                   <span class="keywordflow">switch</span> (block_type)
<a name="l03560"></a>03560                     {
<a name="l03561"></a>03561                     <span class="keywordflow">case</span> <span class="charliteral">&#39;R&#39;</span>:
<a name="l03562"></a>03562                       gotten
<a name="l03563"></a>03563                         = <a class="code" href="target_8h.html#a0fc1199a86c59ca0141a1c39fa4baee2">target_get_raw_trace_data</a> (buf, offset,
<a name="l03564"></a>03564                                                      <a class="code" href="tracepoint_8c.html#a5dc5a6689e0bd3501fe98c5e89858e7c">trace_regblock_size</a>);
<a name="l03565"></a>03565                       <span class="keywordflow">if</span> (gotten &lt; <a class="code" href="tracepoint_8c.html#a5dc5a6689e0bd3501fe98c5e89858e7c">trace_regblock_size</a>)
<a name="l03566"></a>03566                         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Failure to get requested trace&quot;</span>
<a name="l03567"></a>03567                                  <span class="stringliteral">&quot; buffer data&quot;</span>));
<a name="l03568"></a>03568 
<a name="l03569"></a>03569                       <a class="code" href="tracepoint_8c.html#aaedec15013f891df65f7eb5f024ad832">TRACE_WRITE_R_BLOCK</a> (writer, buf,
<a name="l03570"></a>03570                                            <a class="code" href="tracepoint_8c.html#a5dc5a6689e0bd3501fe98c5e89858e7c">trace_regblock_size</a>);
<a name="l03571"></a>03571                       <span class="keywordflow">break</span>;
<a name="l03572"></a>03572                     <span class="keywordflow">case</span> <span class="charliteral">&#39;M&#39;</span>:
<a name="l03573"></a>03573                       {
<a name="l03574"></a>03574                         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> mlen;
<a name="l03575"></a>03575                         <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> addr;
<a name="l03576"></a>03576                         <a class="code" href="defs_8h.html#ac7647a3f71533007c9e128f3ddda1987">LONGEST</a> t;
<a name="l03577"></a>03577                         <span class="keywordtype">int</span> j;
<a name="l03578"></a>03578 
<a name="l03579"></a>03579                         t = <a class="code" href="target_8h.html#a0fc1199a86c59ca0141a1c39fa4baee2">target_get_raw_trace_data</a> (buf,offset, 10);
<a name="l03580"></a>03580                         <span class="keywordflow">if</span> (t &lt; 10)
<a name="l03581"></a>03581                           <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Failure to get requested trace&quot;</span>
<a name="l03582"></a>03582                                    <span class="stringliteral">&quot; buffer data&quot;</span>));
<a name="l03583"></a>03583 
<a name="l03584"></a>03584                         offset += 10;
<a name="l03585"></a>03585                         block += 10;
<a name="l03586"></a>03586 
<a name="l03587"></a>03587                         gotten = 0;
<a name="l03588"></a>03588                         addr = (<a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a>)
<a name="l03589"></a>03589                           <a class="code" href="defs_8h.html#a99aec65329508b4d449a4f881026f844">extract_unsigned_integer</a> (buf, 8,
<a name="l03590"></a>03590                                                     byte_order);
<a name="l03591"></a>03591                         mlen = (<span class="keywordtype">unsigned</span> short)
<a name="l03592"></a>03592                           <a class="code" href="defs_8h.html#a99aec65329508b4d449a4f881026f844">extract_unsigned_integer</a> (&amp;buf[8], 2,
<a name="l03593"></a>03593                                                     byte_order);
<a name="l03594"></a>03594 
<a name="l03595"></a>03595                         <a class="code" href="tracepoint_8c.html#a6e896ada86617ec778a2f02e8d3029d6">TRACE_WRITE_M_BLOCK_HEADER</a> (writer, addr,
<a name="l03596"></a>03596                                                     mlen);
<a name="l03597"></a>03597 
<a name="l03598"></a>03598                         <span class="comment">/* The memory contents in &#39;M&#39; block may be</span>
<a name="l03599"></a>03599 <span class="comment">                           very large.  Fetch the data from the target</span>
<a name="l03600"></a>03600 <span class="comment">                           and write them into file one by one.  */</span>
<a name="l03601"></a>03601                         <span class="keywordflow">for</span> (j = 0; j &lt; mlen; )
<a name="l03602"></a>03602                           {
<a name="l03603"></a>03603                             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> read_length;
<a name="l03604"></a>03604 
<a name="l03605"></a>03605                             <span class="keywordflow">if</span> (mlen - j &gt; <a class="code" href="tracepoint_8c.html#aaf15a3a1563a5e8646f5665465f99e3e">MAX_TRACE_UPLOAD</a>)
<a name="l03606"></a>03606                               read_length = <a class="code" href="tracepoint_8c.html#aaf15a3a1563a5e8646f5665465f99e3e">MAX_TRACE_UPLOAD</a>;
<a name="l03607"></a>03607                             <span class="keywordflow">else</span>
<a name="l03608"></a>03608                               read_length = mlen - j;
<a name="l03609"></a>03609 
<a name="l03610"></a>03610                             t = <a class="code" href="target_8h.html#a0fc1199a86c59ca0141a1c39fa4baee2">target_get_raw_trace_data</a> (buf,
<a name="l03611"></a>03611                                                            offset + j,
<a name="l03612"></a>03612                                                            read_length);
<a name="l03613"></a>03613                             <span class="keywordflow">if</span> (t &lt; read_length)
<a name="l03614"></a>03614                               <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Failure to get requested&quot;</span>
<a name="l03615"></a>03615                                        <span class="stringliteral">&quot; trace buffer data&quot;</span>));
<a name="l03616"></a>03616 
<a name="l03617"></a>03617                             <a class="code" href="tracepoint_8c.html#a66d3fc28e985e7ce9a48bd690a35c7d7">TRACE_WRITE_M_BLOCK_MEMORY</a> (writer, buf,
<a name="l03618"></a>03618                                                         read_length);
<a name="l03619"></a>03619 
<a name="l03620"></a>03620                             j += read_length;
<a name="l03621"></a>03621                             gotten += read_length;
<a name="l03622"></a>03622                           }
<a name="l03623"></a>03623 
<a name="l03624"></a>03624                         <span class="keywordflow">break</span>;
<a name="l03625"></a>03625                       }
<a name="l03626"></a>03626                     <span class="keywordflow">case</span> <span class="charliteral">&#39;V&#39;</span>:
<a name="l03627"></a>03627                       {
<a name="l03628"></a>03628                         <span class="keywordtype">int</span> vnum;
<a name="l03629"></a>03629                         <a class="code" href="defs_8h.html#ac7647a3f71533007c9e128f3ddda1987">LONGEST</a> val;
<a name="l03630"></a>03630 
<a name="l03631"></a>03631                         gotten
<a name="l03632"></a>03632                           = <a class="code" href="target_8h.html#a0fc1199a86c59ca0141a1c39fa4baee2">target_get_raw_trace_data</a> (buf, offset,
<a name="l03633"></a>03633                                                        12);
<a name="l03634"></a>03634                         <span class="keywordflow">if</span> (gotten &lt; 12)
<a name="l03635"></a>03635                           <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Failure to get requested&quot;</span>
<a name="l03636"></a>03636                                    <span class="stringliteral">&quot; trace buffer data&quot;</span>));
<a name="l03637"></a>03637 
<a name="l03638"></a>03638                         vnum  = (<a class="code" href="command_8h.html#a74f207b5aa4ba51c3a2ad59b219a423b">int</a>) <a class="code" href="defs_8h.html#afae519602ea9737f24bfa0e24b507faf">extract_signed_integer</a> (buf,
<a name="l03639"></a>03639                                                               4,
<a name="l03640"></a>03640                                                               byte_order);
<a name="l03641"></a>03641                         val
<a name="l03642"></a>03642                           = <a class="code" href="defs_8h.html#afae519602ea9737f24bfa0e24b507faf">extract_signed_integer</a> (&amp;buf[4], 8,
<a name="l03643"></a>03643                                                     byte_order);
<a name="l03644"></a>03644 
<a name="l03645"></a>03645                         <a class="code" href="tracepoint_8c.html#a9607bca62e007058764028a0f052698c">TRACE_WRITE_V_BLOCK</a> (writer, vnum, val);
<a name="l03646"></a>03646                       }
<a name="l03647"></a>03647                       <span class="keywordflow">break</span>;
<a name="l03648"></a>03648                     <span class="keywordflow">default</span>:
<a name="l03649"></a>03649                       <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Unknown block type &#39;%c&#39; (0x%x) in&quot;</span>
<a name="l03650"></a>03650                                <span class="stringliteral">&quot; trace frame&quot;</span>),
<a name="l03651"></a>03651                              block_type, block_type);
<a name="l03652"></a>03652                     }
<a name="l03653"></a>03653 
<a name="l03654"></a>03654                   block += gotten;
<a name="l03655"></a>03655                   offset += gotten;
<a name="l03656"></a>03656                 }
<a name="l03657"></a>03657             }
<a name="l03658"></a>03658           <span class="keywordflow">else</span>
<a name="l03659"></a>03659             offset += gotten;
<a name="l03660"></a>03660 
<a name="l03661"></a>03661           writer-&gt;<a class="code" href="structtrace__file__writer.html#adbc93937ce01b1d31cb4fa5092ef88b4">ops</a>-&gt;<a class="code" href="structtrace__file__write__ops.html#aad50952dc70c7eb9658032f3f390580b">frame_ops</a>-&gt;<a class="code" href="structtrace__frame__write__ops.html#ae630a885ae32e7280f89cad1145a8e7c">end</a> (writer);
<a name="l03662"></a>03662         }
<a name="l03663"></a>03663     }
<a name="l03664"></a>03664 
<a name="l03665"></a>03665   writer-&gt;<a class="code" href="structtrace__file__writer.html#adbc93937ce01b1d31cb4fa5092ef88b4">ops</a>-&gt;<a class="code" href="structtrace__file__write__ops.html#a33c5f53fd13d1b4e63f19e3a6426706c">end</a> (writer);
<a name="l03666"></a>03666 }
<a name="l03667"></a>03667 
<a name="l03668"></a>03668 <span class="comment">/* Return a trace writer for TFILE format.  */</span>
<a name="l03669"></a>03669 
<a name="l03670"></a>03670 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structtrace__file__writer.html">trace_file_writer</a> *
<a name="l03671"></a>03671 tfile_trace_file_writer_new (<span class="keywordtype">void</span>)
<a name="l03672"></a>03672 {
<a name="l03673"></a>03673   <span class="keyword">struct </span>tfile_trace_file_writer *writer
<a name="l03674"></a>03674     = <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (<span class="keyword">sizeof</span> (<span class="keyword">struct</span> tfile_trace_file_writer));
<a name="l03675"></a>03675 
<a name="l03676"></a>03676   writer-&gt;base.ops = &amp;tfile_write_ops;
<a name="l03677"></a>03677   writer-&gt;fp = NULL;
<a name="l03678"></a>03678   writer-&gt;pathname = NULL;
<a name="l03679"></a>03679 
<a name="l03680"></a>03680   <span class="keywordflow">return</span> (<span class="keyword">struct</span> <a class="code" href="structtrace__file__writer.html">trace_file_writer</a> *) writer;
<a name="l03681"></a>03681 }
<a name="l03682"></a>03682 
<a name="l03683"></a>03683 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03684"></a>03684 trace_save_command (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty)
<a name="l03685"></a>03685 {
<a name="l03686"></a>03686   <span class="keywordtype">int</span> target_does_save = 0;
<a name="l03687"></a>03687   <span class="keywordtype">char</span> **argv;
<a name="l03688"></a>03688   <span class="keywordtype">char</span> *filename = NULL;
<a name="l03689"></a>03689   <span class="keyword">struct </span>cleanup *back_to;
<a name="l03690"></a>03690   <span class="keywordtype">int</span> generate_ctf = 0;
<a name="l03691"></a>03691   <span class="keyword">struct </span><a class="code" href="structtrace__file__writer.html">trace_file_writer</a> *writer = NULL;
<a name="l03692"></a>03692 
<a name="l03693"></a>03693   <span class="keywordflow">if</span> (args == NULL)
<a name="l03694"></a>03694     <a class="code" href="cli-cmds_8c.html#a68aef78cdf72abc9df2495a4618842c3">error_no_arg</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;file in which to save trace data&quot;</span>));
<a name="l03695"></a>03695 
<a name="l03696"></a>03696   argv = <a class="code" href="utils_8c.html#a146bf06d6062174a10a36700c40fdae4">gdb_buildargv</a> (args);
<a name="l03697"></a>03697   back_to = <a class="code" href="utils_8c.html#aad1e14fe73668592441775f7346f558e">make_cleanup_freeargv</a> (argv);
<a name="l03698"></a>03698 
<a name="l03699"></a>03699   <span class="keywordflow">for</span> (; *argv; ++argv)
<a name="l03700"></a>03700     {
<a name="l03701"></a>03701       <span class="keywordflow">if</span> (strcmp (*argv, <span class="stringliteral">&quot;-r&quot;</span>) == 0)
<a name="l03702"></a>03702         target_does_save = 1;
<a name="l03703"></a>03703       <span class="keywordflow">if</span> (strcmp (*argv, <span class="stringliteral">&quot;-ctf&quot;</span>) == 0)
<a name="l03704"></a>03704         generate_ctf = 1;
<a name="l03705"></a>03705       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (**argv == <span class="charliteral">&#39;-&#39;</span>)
<a name="l03706"></a>03706         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;unknown option `%s&#39;&quot;</span>), *argv);
<a name="l03707"></a>03707       <span class="keywordflow">else</span>
<a name="l03708"></a>03708         filename = *argv;
<a name="l03709"></a>03709     }
<a name="l03710"></a>03710 
<a name="l03711"></a>03711   <span class="keywordflow">if</span> (!filename)
<a name="l03712"></a>03712     <a class="code" href="cli-cmds_8c.html#a68aef78cdf72abc9df2495a4618842c3">error_no_arg</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;file in which to save trace data&quot;</span>));
<a name="l03713"></a>03713 
<a name="l03714"></a>03714   <span class="keywordflow">if</span> (generate_ctf)
<a name="l03715"></a>03715     writer = <a class="code" href="ctf_8c.html#a0c8c86d575ee443e945c2571d279d24e">ctf_trace_file_writer_new</a> ();
<a name="l03716"></a>03716   <span class="keywordflow">else</span>
<a name="l03717"></a>03717     writer = tfile_trace_file_writer_new ();
<a name="l03718"></a>03718 
<a name="l03719"></a>03719   <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (trace_file_writer_xfree, writer);
<a name="l03720"></a>03720 
<a name="l03721"></a>03721   trace_save (filename, writer, target_does_save);
<a name="l03722"></a>03722 
<a name="l03723"></a>03723   <span class="keywordflow">if</span> (from_tty)
<a name="l03724"></a>03724     <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Trace data saved to %s &#39;%s&#39;.\n&quot;</span>),
<a name="l03725"></a>03725                      generate_ctf ? <span class="stringliteral">&quot;directory&quot;</span> : <span class="stringliteral">&quot;file&quot;</span>, filename);
<a name="l03726"></a>03726 
<a name="l03727"></a>03727   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (back_to);
<a name="l03728"></a>03728 }
<a name="l03729"></a>03729 
<a name="l03730"></a>03730 <span class="comment">/* Save the trace data to file FILENAME of tfile format.  */</span>
<a name="l03731"></a>03731 
<a name="l03732"></a>03732 <span class="keywordtype">void</span>
<a name="l03733"></a><a class="code" href="tracepoint_8h.html#ab28f3690712386b7f482eec1b5754ae9">03733</a> <a class="code" href="tracepoint_8c.html#ab28f3690712386b7f482eec1b5754ae9">trace_save_tfile</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *filename, <span class="keywordtype">int</span> target_does_save)
<a name="l03734"></a>03734 {
<a name="l03735"></a>03735   <span class="keyword">struct </span><a class="code" href="structtrace__file__writer.html">trace_file_writer</a> *writer;
<a name="l03736"></a>03736   <span class="keyword">struct </span>cleanup *back_to;
<a name="l03737"></a>03737 
<a name="l03738"></a>03738   writer = tfile_trace_file_writer_new ();
<a name="l03739"></a>03739   back_to = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (trace_file_writer_xfree, writer);
<a name="l03740"></a>03740   trace_save (filename, writer, target_does_save);
<a name="l03741"></a>03741   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (back_to);
<a name="l03742"></a>03742 }
<a name="l03743"></a>03743 
<a name="l03744"></a>03744 <span class="comment">/* Save the trace data to dir DIRNAME of ctf format.  */</span>
<a name="l03745"></a>03745 
<a name="l03746"></a>03746 <span class="keywordtype">void</span>
<a name="l03747"></a><a class="code" href="tracepoint_8h.html#ab9411fcac1c8ef808ced75e403ec61d7">03747</a> <a class="code" href="tracepoint_8c.html#ab9411fcac1c8ef808ced75e403ec61d7">trace_save_ctf</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *dirname, <span class="keywordtype">int</span> target_does_save)
<a name="l03748"></a>03748 {
<a name="l03749"></a>03749   <span class="keyword">struct </span><a class="code" href="structtrace__file__writer.html">trace_file_writer</a> *writer;
<a name="l03750"></a>03750   <span class="keyword">struct </span>cleanup *back_to;
<a name="l03751"></a>03751 
<a name="l03752"></a>03752   writer = <a class="code" href="ctf_8c.html#a0c8c86d575ee443e945c2571d279d24e">ctf_trace_file_writer_new</a> ();
<a name="l03753"></a>03753   back_to = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (trace_file_writer_xfree, writer);
<a name="l03754"></a>03754 
<a name="l03755"></a>03755   trace_save (dirname, writer, target_does_save);
<a name="l03756"></a>03756   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (back_to);
<a name="l03757"></a>03757 }
<a name="l03758"></a>03758 
<a name="l03759"></a>03759 <span class="comment">/* Tell the target what to do with an ongoing tracing run if GDB</span>
<a name="l03760"></a>03760 <span class="comment">   disconnects for some reason.  */</span>
<a name="l03761"></a>03761 
<a name="l03762"></a>03762 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03763"></a>03763 set_disconnected_tracing (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty,
<a name="l03764"></a>03764                           <span class="keyword">struct</span> <a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c)
<a name="l03765"></a>03765 {
<a name="l03766"></a>03766   <a class="code" href="target_8h.html#afdb0a947ae5efc979edeea4585bd09ad">target_set_disconnected_tracing</a> (disconnected_tracing);
<a name="l03767"></a>03767 }
<a name="l03768"></a>03768 
<a name="l03769"></a>03769 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03770"></a>03770 set_circular_trace_buffer (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty,
<a name="l03771"></a>03771                            <span class="keyword">struct</span> <a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c)
<a name="l03772"></a>03772 {
<a name="l03773"></a>03773   <a class="code" href="target_8h.html#ad01c945e577448f4295956185ae7efba">target_set_circular_trace_buffer</a> (circular_trace_buffer);
<a name="l03774"></a>03774 }
<a name="l03775"></a>03775 
<a name="l03776"></a>03776 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03777"></a>03777 set_trace_buffer_size (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty,
<a name="l03778"></a>03778                            <span class="keyword">struct</span> <a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c)
<a name="l03779"></a>03779 {
<a name="l03780"></a>03780   <a class="code" href="target_8h.html#a384639dc9b25a1caed3311bf193f7274">target_set_trace_buffer_size</a> (trace_buffer_size);
<a name="l03781"></a>03781 }
<a name="l03782"></a>03782 
<a name="l03783"></a>03783 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03784"></a>03784 set_trace_user (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty,
<a name="l03785"></a>03785                 <span class="keyword">struct</span> <a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c)
<a name="l03786"></a>03786 {
<a name="l03787"></a>03787   <span class="keywordtype">int</span> ret;
<a name="l03788"></a>03788 
<a name="l03789"></a>03789   ret = <a class="code" href="target_8h.html#ad4847e47bef87ffacdd66828f2596439">target_set_trace_notes</a> (trace_user, NULL, NULL);
<a name="l03790"></a>03790 
<a name="l03791"></a>03791   <span class="keywordflow">if</span> (!ret)
<a name="l03792"></a>03792     <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Target does not support trace notes, user ignored&quot;</span>));
<a name="l03793"></a>03793 }
<a name="l03794"></a>03794 
<a name="l03795"></a>03795 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03796"></a>03796 set_trace_notes (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty,
<a name="l03797"></a>03797                  <span class="keyword">struct</span> <a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c)
<a name="l03798"></a>03798 {
<a name="l03799"></a>03799   <span class="keywordtype">int</span> ret;
<a name="l03800"></a>03800 
<a name="l03801"></a>03801   ret = <a class="code" href="target_8h.html#ad4847e47bef87ffacdd66828f2596439">target_set_trace_notes</a> (NULL, trace_notes, NULL);
<a name="l03802"></a>03802 
<a name="l03803"></a>03803   <span class="keywordflow">if</span> (!ret)
<a name="l03804"></a>03804     <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Target does not support trace notes, note ignored&quot;</span>));
<a name="l03805"></a>03805 }
<a name="l03806"></a>03806 
<a name="l03807"></a>03807 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03808"></a>03808 set_trace_stop_notes (<span class="keywordtype">char</span> *args, <span class="keywordtype">int</span> from_tty,
<a name="l03809"></a>03809                       <span class="keyword">struct</span> <a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c)
<a name="l03810"></a>03810 {
<a name="l03811"></a>03811   <span class="keywordtype">int</span> ret;
<a name="l03812"></a>03812 
<a name="l03813"></a>03813   ret = <a class="code" href="target_8h.html#ad4847e47bef87ffacdd66828f2596439">target_set_trace_notes</a> (NULL, NULL, trace_stop_notes);
<a name="l03814"></a>03814 
<a name="l03815"></a>03815   <span class="keywordflow">if</span> (!ret)
<a name="l03816"></a>03816     <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Target does not support trace notes, stop note ignored&quot;</span>));
<a name="l03817"></a>03817 }
<a name="l03818"></a>03818 
<a name="l03819"></a>03819 <span class="comment">/* Convert the memory pointed to by mem into hex, placing result in buf.</span>
<a name="l03820"></a>03820 <span class="comment"> * Return a pointer to the last char put in buf (null)</span>
<a name="l03821"></a>03821 <span class="comment"> * &quot;stolen&quot; from sparc-stub.c</span>
<a name="l03822"></a>03822 <span class="comment"> */</span>
<a name="l03823"></a>03823 
<a name="l03824"></a>03824 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> hexchars[] = <span class="stringliteral">&quot;0123456789abcdef&quot;</span>;
<a name="l03825"></a>03825 
<a name="l03826"></a>03826 <span class="keyword">static</span> <span class="keywordtype">char</span> *
<a name="l03827"></a>03827 mem2hex (<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *mem, <span class="keywordtype">char</span> *buf, <span class="keywordtype">int</span> count)
<a name="l03828"></a>03828 {
<a name="l03829"></a>03829   <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> ch;
<a name="l03830"></a>03830 
<a name="l03831"></a>03831   <span class="keywordflow">while</span> (count-- &gt; 0)
<a name="l03832"></a>03832     {
<a name="l03833"></a>03833       ch = *mem++;
<a name="l03834"></a>03834 
<a name="l03835"></a>03835       *buf++ = hexchars[ch &gt;&gt; 4];
<a name="l03836"></a>03836       *buf++ = hexchars[ch &amp; 0xf];
<a name="l03837"></a>03837     }
<a name="l03838"></a>03838 
<a name="l03839"></a>03839   *buf = 0;
<a name="l03840"></a>03840 
<a name="l03841"></a>03841   <span class="keywordflow">return</span> buf;
<a name="l03842"></a>03842 }
<a name="l03843"></a>03843 
<a name="l03844"></a>03844 <span class="keywordtype">int</span>
<a name="l03845"></a><a class="code" href="tracepoint_8h.html#a3bee6ac8afec52230f5314e1f3025511">03845</a> <a class="code" href="tracepoint_8c.html#a3bee6ac8afec52230f5314e1f3025511">get_traceframe_number</a> (<span class="keywordtype">void</span>)
<a name="l03846"></a>03846 {
<a name="l03847"></a>03847   <span class="keywordflow">return</span> traceframe_number;
<a name="l03848"></a>03848 }
<a name="l03849"></a>03849 
<a name="l03850"></a>03850 <span class="keywordtype">int</span>
<a name="l03851"></a><a class="code" href="tracepoint_8h.html#a054654916fdb0f002373b85bccfce196">03851</a> <a class="code" href="tracepoint_8c.html#a054654916fdb0f002373b85bccfce196">get_tracepoint_number</a> (<span class="keywordtype">void</span>)
<a name="l03852"></a>03852 {
<a name="l03853"></a>03853   <span class="keywordflow">return</span> tracepoint_number;
<a name="l03854"></a>03854 }
<a name="l03855"></a>03855 
<a name="l03856"></a>03856 <span class="comment">/* Make the traceframe NUM be the current trace frame.  Does nothing</span>
<a name="l03857"></a>03857 <span class="comment">   if NUM is already current.  */</span>
<a name="l03858"></a>03858 
<a name="l03859"></a>03859 <span class="keywordtype">void</span>
<a name="l03860"></a><a class="code" href="tracepoint_8h.html#ad8bfea40c0a91f07e0683fe176a16e79">03860</a> <a class="code" href="tracepoint_8c.html#ad8bfea40c0a91f07e0683fe176a16e79">set_current_traceframe</a> (<span class="keywordtype">int</span> num)
<a name="l03861"></a>03861 {
<a name="l03862"></a>03862   <span class="keywordtype">int</span> newnum;
<a name="l03863"></a>03863 
<a name="l03864"></a>03864   <span class="keywordflow">if</span> (traceframe_number == num)
<a name="l03865"></a>03865     {
<a name="l03866"></a>03866       <span class="comment">/* Nothing to do.  */</span>
<a name="l03867"></a>03867       <span class="keywordflow">return</span>;
<a name="l03868"></a>03868     }
<a name="l03869"></a>03869 
<a name="l03870"></a>03870   newnum = <a class="code" href="target_8h.html#a9f5b31eeb53ce0049febf03485540f46">target_trace_find</a> (<a class="code" href="target_8h.html#a78f5afcdc128cdd336383668a0f296d7a6c059c3daad01c8165dc1a73498408e7">tfind_number</a>, num, 0, 0, NULL);
<a name="l03871"></a>03871 
<a name="l03872"></a>03872   <span class="keywordflow">if</span> (newnum != num)
<a name="l03873"></a>03873     <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;could not change traceframe&quot;</span>));
<a name="l03874"></a>03874 
<a name="l03875"></a>03875   set_traceframe_num (newnum);
<a name="l03876"></a>03876 
<a name="l03877"></a>03877   <span class="comment">/* Changing the traceframe changes our view of registers and of the</span>
<a name="l03878"></a>03878 <span class="comment">     frame chain.  */</span>
<a name="l03879"></a>03879   <a class="code" href="regcache_8c.html#aeb6b838a0fd42595bcc71f31b24ce51b">registers_changed</a> ();
<a name="l03880"></a>03880 
<a name="l03881"></a>03881   clear_traceframe_info ();
<a name="l03882"></a>03882 }
<a name="l03883"></a>03883 
<a name="l03884"></a>03884 <span class="comment">/* Make the traceframe NUM be the current trace frame, and do nothing</span>
<a name="l03885"></a>03885 <span class="comment">   more.  */</span>
<a name="l03886"></a>03886 
<a name="l03887"></a>03887 <span class="keywordtype">void</span>
<a name="l03888"></a><a class="code" href="tracepoint_8h.html#a6988c1fa9d074d7b898182a69ab13ab5">03888</a> <a class="code" href="tracepoint_8c.html#a080b3a6c81a961117a212d688c02cd64">set_traceframe_number</a> (<span class="keywordtype">int</span> num)
<a name="l03889"></a>03889 {
<a name="l03890"></a>03890   traceframe_number = num;
<a name="l03891"></a>03891 }
<a name="l03892"></a>03892 
<a name="l03893"></a>03893 <span class="comment">/* A cleanup used when switching away and back from tfind mode.  */</span>
<a name="l03894"></a>03894 
<a name="l03895"></a>03895 <span class="keyword">struct </span>current_traceframe_cleanup
<a name="l03896"></a>03896 {
<a name="l03897"></a>03897   <span class="comment">/* The traceframe we were inspecting.  */</span>
<a name="l03898"></a>03898   <span class="keywordtype">int</span> traceframe_number;
<a name="l03899"></a>03899 };
<a name="l03900"></a>03900 
<a name="l03901"></a>03901 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03902"></a>03902 do_restore_current_traceframe_cleanup (<span class="keywordtype">void</span> *arg)
<a name="l03903"></a>03903 {
<a name="l03904"></a>03904   <span class="keyword">struct </span>current_traceframe_cleanup *old = arg;
<a name="l03905"></a>03905 
<a name="l03906"></a>03906   <a class="code" href="tracepoint_8c.html#ad8bfea40c0a91f07e0683fe176a16e79">set_current_traceframe</a> (old-&gt;traceframe_number);
<a name="l03907"></a>03907 }
<a name="l03908"></a>03908 
<a name="l03909"></a>03909 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03910"></a>03910 restore_current_traceframe_cleanup_dtor (<span class="keywordtype">void</span> *arg)
<a name="l03911"></a>03911 {
<a name="l03912"></a>03912   <span class="keyword">struct </span>current_traceframe_cleanup *old = arg;
<a name="l03913"></a>03913 
<a name="l03914"></a>03914   <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (old);
<a name="l03915"></a>03915 }
<a name="l03916"></a>03916 
<a name="l03917"></a>03917 <span class="keyword">struct </span>cleanup *
<a name="l03918"></a><a class="code" href="tracepoint_8h.html#a3907dc0023bb20f021574c2814d5c8f6">03918</a> <a class="code" href="tracepoint_8c.html#a3907dc0023bb20f021574c2814d5c8f6">make_cleanup_restore_current_traceframe</a> (<span class="keywordtype">void</span>)
<a name="l03919"></a>03919 {
<a name="l03920"></a>03920   <span class="keyword">struct </span>current_traceframe_cleanup *old;
<a name="l03921"></a>03921 
<a name="l03922"></a>03922   old = <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (<span class="keyword">sizeof</span> (<span class="keyword">struct</span> current_traceframe_cleanup));
<a name="l03923"></a>03923   old-&gt;traceframe_number = traceframe_number;
<a name="l03924"></a>03924 
<a name="l03925"></a>03925   <span class="keywordflow">return</span> <a class="code" href="cleanups_8c.html#ae88f17d488a67d25182d5ae4ad9550cf">make_cleanup_dtor</a> (do_restore_current_traceframe_cleanup, old,
<a name="l03926"></a>03926                             restore_current_traceframe_cleanup_dtor);
<a name="l03927"></a>03927 }
<a name="l03928"></a>03928 
<a name="l03929"></a>03929 <span class="keyword">struct </span>cleanup *
<a name="l03930"></a><a class="code" href="tracepoint_8h.html#a5feb582b353f17ed6d9f9b79e96e3981">03930</a> <a class="code" href="tracepoint_8c.html#a5feb582b353f17ed6d9f9b79e96e3981">make_cleanup_restore_traceframe_number</a> (<span class="keywordtype">void</span>)
<a name="l03931"></a>03931 {
<a name="l03932"></a>03932   <span class="keywordflow">return</span> <a class="code" href="utils_8c.html#aa4b9e7f0b6abb5f93fc0ac366f7614c0">make_cleanup_restore_integer</a> (&amp;traceframe_number);
<a name="l03933"></a>03933 }
<a name="l03934"></a>03934 
<a name="l03935"></a>03935 <span class="comment">/* Given a number and address, return an uploaded tracepoint with that</span>
<a name="l03936"></a>03936 <span class="comment">   number, creating if necessary.  */</span>
<a name="l03937"></a>03937 
<a name="l03938"></a>03938 <span class="keyword">struct </span><a class="code" href="structuploaded__tp.html">uploaded_tp</a> *
<a name="l03939"></a><a class="code" href="tracepoint_8h.html#acd9d80c3ddd5d5a6bdc5438aabf74fe7">03939</a> <a class="code" href="tracepoint_8c.html#acd9d80c3ddd5d5a6bdc5438aabf74fe7">get_uploaded_tp</a> (<span class="keywordtype">int</span> num, <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> addr, <span class="keyword">struct</span> <a class="code" href="structuploaded__tp.html">uploaded_tp</a> **utpp)
<a name="l03940"></a>03940 {
<a name="l03941"></a>03941   <span class="keyword">struct </span><a class="code" href="structuploaded__tp.html">uploaded_tp</a> *utp;
<a name="l03942"></a>03942 
<a name="l03943"></a>03943   <span class="keywordflow">for</span> (utp = *utpp; utp; utp = utp-&gt;<a class="code" href="structuploaded__tp.html#a98d537cc2a745d0f53422afd075e9abf">next</a>)
<a name="l03944"></a>03944     <span class="keywordflow">if</span> (utp-&gt;<a class="code" href="structuploaded__tp.html#a58cc4be1b86f8aa20de77b27929dfe12">number</a> == num &amp;&amp; utp-&gt;<a class="code" href="structuploaded__tp.html#a97572e43a086932e96df20104262d0e8">addr</a> == addr)
<a name="l03945"></a>03945       <span class="keywordflow">return</span> utp;
<a name="l03946"></a>03946   utp = (<span class="keyword">struct </span><a class="code" href="structuploaded__tp.html">uploaded_tp</a> *) <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (<span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structuploaded__tp.html">uploaded_tp</a>));
<a name="l03947"></a>03947   <a class="code" href="gdb__string_8h.html#adb03df3679ce1445e801310614624ccb">memset</a> (utp, 0, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structuploaded__tp.html">uploaded_tp</a>));
<a name="l03948"></a>03948   utp-&gt;<a class="code" href="structuploaded__tp.html#a58cc4be1b86f8aa20de77b27929dfe12">number</a> = num;
<a name="l03949"></a>03949   utp-&gt;<a class="code" href="structuploaded__tp.html#a97572e43a086932e96df20104262d0e8">addr</a> = <a class="code" href="structuploaded__tp.html#a97572e43a086932e96df20104262d0e8">addr</a>;
<a name="l03950"></a>03950   utp-&gt;actions = NULL;
<a name="l03951"></a>03951   utp-&gt;step_actions = NULL;
<a name="l03952"></a>03952   utp-&gt;cmd_strings = NULL;
<a name="l03953"></a>03953   utp-&gt;<a class="code" href="structuploaded__tp.html#a98d537cc2a745d0f53422afd075e9abf">next</a> = *utpp;
<a name="l03954"></a>03954   *utpp = utp;
<a name="l03955"></a>03955   <span class="keywordflow">return</span> utp;
<a name="l03956"></a>03956 }
<a name="l03957"></a>03957 
<a name="l03958"></a>03958 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03959"></a>03959 free_uploaded_tps (<span class="keyword">struct</span> <a class="code" href="structuploaded__tp.html">uploaded_tp</a> **utpp)
<a name="l03960"></a>03960 {
<a name="l03961"></a>03961   <span class="keyword">struct </span><a class="code" href="structuploaded__tp.html">uploaded_tp</a> *next_one;
<a name="l03962"></a>03962 
<a name="l03963"></a>03963   <span class="keywordflow">while</span> (*utpp)
<a name="l03964"></a>03964     {
<a name="l03965"></a>03965       next_one = (*utpp)-&gt;<a class="code" href="structuploaded__tp.html#a98d537cc2a745d0f53422afd075e9abf">next</a>;
<a name="l03966"></a>03966       <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (*utpp);
<a name="l03967"></a>03967       *utpp = next_one;
<a name="l03968"></a>03968     }
<a name="l03969"></a>03969 }
<a name="l03970"></a>03970 
<a name="l03971"></a>03971 <span class="comment">/* Given a number and address, return an uploaded tracepoint with that</span>
<a name="l03972"></a>03972 <span class="comment">   number, creating if necessary.  */</span>
<a name="l03973"></a>03973 
<a name="l03974"></a>03974 <span class="keyword">struct </span><a class="code" href="structuploaded__tsv.html">uploaded_tsv</a> *
<a name="l03975"></a><a class="code" href="tracepoint_8h.html#aa1d8f79579e195ebdd8f9151e584baff">03975</a> <a class="code" href="tracepoint_8c.html#aa1d8f79579e195ebdd8f9151e584baff">get_uploaded_tsv</a> (<span class="keywordtype">int</span> num, <span class="keyword">struct</span> <a class="code" href="structuploaded__tsv.html">uploaded_tsv</a> **utsvp)
<a name="l03976"></a>03976 {
<a name="l03977"></a>03977   <span class="keyword">struct </span><a class="code" href="structuploaded__tsv.html">uploaded_tsv</a> *utsv;
<a name="l03978"></a>03978 
<a name="l03979"></a>03979   <span class="keywordflow">for</span> (utsv = *utsvp; utsv; utsv = utsv-&gt;<a class="code" href="structuploaded__tsv.html#aab1ad86881ad07a1bf1a66ee1e1b1e88">next</a>)
<a name="l03980"></a>03980     <span class="keywordflow">if</span> (utsv-&gt;<a class="code" href="structuploaded__tsv.html#a3a5668fbc028dde6a8d3400bb380ea00">number</a> == num)
<a name="l03981"></a>03981       <span class="keywordflow">return</span> utsv;
<a name="l03982"></a>03982   utsv = (<span class="keyword">struct </span><a class="code" href="structuploaded__tsv.html">uploaded_tsv</a> *) <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (<span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structuploaded__tsv.html">uploaded_tsv</a>));
<a name="l03983"></a>03983   <a class="code" href="gdb__string_8h.html#adb03df3679ce1445e801310614624ccb">memset</a> (utsv, 0, <span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structuploaded__tsv.html">uploaded_tsv</a>));
<a name="l03984"></a>03984   utsv-&gt;<a class="code" href="structuploaded__tsv.html#a3a5668fbc028dde6a8d3400bb380ea00">number</a> = num;
<a name="l03985"></a>03985   utsv-&gt;<a class="code" href="structuploaded__tsv.html#aab1ad86881ad07a1bf1a66ee1e1b1e88">next</a> = *utsvp;
<a name="l03986"></a>03986   *utsvp = utsv;
<a name="l03987"></a>03987   <span class="keywordflow">return</span> utsv;
<a name="l03988"></a>03988 }
<a name="l03989"></a>03989 
<a name="l03990"></a>03990 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l03991"></a>03991 free_uploaded_tsvs (<span class="keyword">struct</span> <a class="code" href="structuploaded__tsv.html">uploaded_tsv</a> **utsvp)
<a name="l03992"></a>03992 {
<a name="l03993"></a>03993   <span class="keyword">struct </span><a class="code" href="structuploaded__tsv.html">uploaded_tsv</a> *next_one;
<a name="l03994"></a>03994 
<a name="l03995"></a>03995   <span class="keywordflow">while</span> (*utsvp)
<a name="l03996"></a>03996     {
<a name="l03997"></a>03997       next_one = (*utsvp)-&gt;<a class="code" href="structuploaded__tsv.html#aab1ad86881ad07a1bf1a66ee1e1b1e88">next</a>;
<a name="l03998"></a>03998       <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (*utsvp);
<a name="l03999"></a>03999       *utsvp = next_one;
<a name="l04000"></a>04000     }
<a name="l04001"></a>04001 }
<a name="l04002"></a>04002 
<a name="l04003"></a>04003 <span class="comment">/* FIXME this function is heuristic and will miss the cases where the</span>
<a name="l04004"></a>04004 <span class="comment">   conditional is semantically identical but differs in whitespace,</span>
<a name="l04005"></a>04005 <span class="comment">   such as &quot;x == 0&quot; vs &quot;x==0&quot;.  */</span>
<a name="l04006"></a>04006 
<a name="l04007"></a>04007 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l04008"></a>04008 cond_string_is_same (<span class="keywordtype">char</span> *str1, <span class="keywordtype">char</span> *str2)
<a name="l04009"></a>04009 {
<a name="l04010"></a>04010   <span class="keywordflow">if</span> (str1 == NULL || str2 == NULL)
<a name="l04011"></a>04011     <span class="keywordflow">return</span> (str1 == str2);
<a name="l04012"></a>04012 
<a name="l04013"></a>04013   <span class="keywordflow">return</span> (strcmp (str1, str2) == 0);
<a name="l04014"></a>04014 }
<a name="l04015"></a>04015 
<a name="l04016"></a>04016 <span class="comment">/* Look for an existing tracepoint that seems similar enough to the</span>
<a name="l04017"></a>04017 <span class="comment">   uploaded one.  Enablement isn&#39;t compared, because the user can</span>
<a name="l04018"></a>04018 <span class="comment">   toggle that freely, and may have done so in anticipation of the</span>
<a name="l04019"></a>04019 <span class="comment">   next trace run.  Return the location of matched tracepoint.  */</span>
<a name="l04020"></a>04020 
<a name="l04021"></a>04021 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structbp__location.html">bp_location</a> *
<a name="l04022"></a>04022 find_matching_tracepoint_location (<span class="keyword">struct</span> <a class="code" href="structuploaded__tp.html">uploaded_tp</a> *utp)
<a name="l04023"></a>04023 {
<a name="l04024"></a>04024   <a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a>(<a class="code" href="structbreakpoint.html">breakpoint_p</a>) *tp_vec = all_tracepoints ();
<a name="l04025"></a>04025   <span class="keywordtype">int</span> ix;
<a name="l04026"></a>04026   <span class="keyword">struct </span><a class="code" href="structbreakpoint.html">breakpoint</a> *b;
<a name="l04027"></a>04027   <span class="keyword">struct </span><a class="code" href="structbp__location.html">bp_location</a> *loc;
<a name="l04028"></a>04028 
<a name="l04029"></a>04029   <span class="keywordflow">for</span> (ix = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="structbreakpoint.html">breakpoint_p</a>, tp_vec, ix, b); ix++)
<a name="l04030"></a>04030     {
<a name="l04031"></a>04031       <span class="keyword">struct </span><a class="code" href="structtracepoint.html">tracepoint</a> *t = (<span class="keyword">struct </span><a class="code" href="structtracepoint.html">tracepoint</a> *) b;
<a name="l04032"></a>04032 
<a name="l04033"></a>04033       <span class="keywordflow">if</span> (b-&gt;<a class="code" href="structbreakpoint.html#aefce6e7d22540b3fffaecd1264a0f73f">type</a> == utp-&gt;<a class="code" href="structuploaded__tp.html#a3e983c135ec77bcb96798d08c683869d">type</a>
<a name="l04034"></a>04034           &amp;&amp; t-&gt;<a class="code" href="structtracepoint.html#a23f952627bff1b293662478997684f30">step_count</a> == utp-&gt;<a class="code" href="structuploaded__tp.html#ae1b0283bc5b2a26b13fedcbe49680575">step</a>
<a name="l04035"></a>04035           &amp;&amp; t-&gt;<a class="code" href="structtracepoint.html#adaea7cf613860650f86cd9e0ac9cd5f1">pass_count</a> == utp-&gt;<a class="code" href="structuploaded__tp.html#ac4636b0feec50663698467304285954d">pass</a>
<a name="l04036"></a>04036           &amp;&amp; cond_string_is_same (t-&gt;<a class="code" href="structtracepoint.html#a881af30b18b555e6ff11113da6b01a02">base</a>.<a class="code" href="structbreakpoint.html#a817904eee4ded1a9e18ab46709c1245b">cond_string</a>, utp-&gt;<a class="code" href="structuploaded__tp.html#a6413e606d74685de1dbe098ac06b8d26">cond_string</a>)
<a name="l04037"></a>04037           <span class="comment">/* FIXME also test actions.  */</span>
<a name="l04038"></a>04038           )
<a name="l04039"></a>04039         {
<a name="l04040"></a>04040           <span class="comment">/* Scan the locations for an address match.  */</span>
<a name="l04041"></a>04041           <span class="keywordflow">for</span> (loc = b-&gt;<a class="code" href="structbreakpoint.html#aa869260f7e4c94204275861d820bb1a9">loc</a>; loc; loc = loc-&gt;<a class="code" href="structbp__location.html#ab193cb38f87fea89105db96d94191541">next</a>)
<a name="l04042"></a>04042             {
<a name="l04043"></a>04043               <span class="keywordflow">if</span> (loc-&gt;<a class="code" href="structbp__location.html#a6b6cd8b8a488e632200f323309d23823">address</a> == utp-&gt;<a class="code" href="structuploaded__tp.html#a97572e43a086932e96df20104262d0e8">addr</a>)
<a name="l04044"></a>04044                 <span class="keywordflow">return</span> loc;
<a name="l04045"></a>04045             }
<a name="l04046"></a>04046         }
<a name="l04047"></a>04047     }
<a name="l04048"></a>04048   <span class="keywordflow">return</span> NULL;
<a name="l04049"></a>04049 }
<a name="l04050"></a>04050 
<a name="l04051"></a>04051 <span class="comment">/* Given a list of tracepoints uploaded from a target, attempt to</span>
<a name="l04052"></a>04052 <span class="comment">   match them up with existing tracepoints, and create new ones if not</span>
<a name="l04053"></a>04053 <span class="comment">   found.  */</span>
<a name="l04054"></a>04054 
<a name="l04055"></a>04055 <span class="keywordtype">void</span>
<a name="l04056"></a><a class="code" href="tracepoint_8h.html#acc65283b50166a16db6987424e74007c">04056</a> <a class="code" href="tracepoint_8c.html#aad609d453437967df8af749fafcc9a4d">merge_uploaded_tracepoints</a> (<span class="keyword">struct</span> <a class="code" href="structuploaded__tp.html">uploaded_tp</a> **uploaded_tps)
<a name="l04057"></a>04057 {
<a name="l04058"></a>04058   <span class="keyword">struct </span><a class="code" href="structuploaded__tp.html">uploaded_tp</a> *utp;
<a name="l04059"></a>04059   <span class="comment">/* A set of tracepoints which are modified.  */</span>
<a name="l04060"></a>04060   <a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a>(<a class="code" href="structbreakpoint.html">breakpoint_p</a>) *modified_tp = NULL;
<a name="l04061"></a>04061   <span class="keywordtype">int</span> ix;
<a name="l04062"></a>04062   <span class="keyword">struct </span><a class="code" href="structbreakpoint.html">breakpoint</a> *b;
<a name="l04063"></a>04063 
<a name="l04064"></a>04064   <span class="comment">/* Look for GDB tracepoints that match up with our uploaded versions.  */</span>
<a name="l04065"></a>04065   <span class="keywordflow">for</span> (utp = *uploaded_tps; utp; utp = utp-&gt;<a class="code" href="structuploaded__tp.html#a98d537cc2a745d0f53422afd075e9abf">next</a>)
<a name="l04066"></a>04066     {
<a name="l04067"></a>04067       <span class="keyword">struct </span><a class="code" href="structbp__location.html">bp_location</a> *loc;
<a name="l04068"></a>04068       <span class="keyword">struct </span><a class="code" href="structtracepoint.html">tracepoint</a> *t;
<a name="l04069"></a>04069 
<a name="l04070"></a>04070       loc = find_matching_tracepoint_location (utp);
<a name="l04071"></a>04071       <span class="keywordflow">if</span> (loc)
<a name="l04072"></a>04072         {
<a name="l04073"></a>04073           <span class="keywordtype">int</span> found = 0;
<a name="l04074"></a>04074 
<a name="l04075"></a>04075           <span class="comment">/* Mark this location as already inserted.  */</span>
<a name="l04076"></a>04076           loc-&gt;<a class="code" href="structbp__location.html#acb0b475579bbe5dabeb8ed4504527105">inserted</a> = 1;
<a name="l04077"></a>04077           t = (<span class="keyword">struct </span><a class="code" href="structtracepoint.html">tracepoint</a> *) loc-&gt;<a class="code" href="structbp__location.html#ade5cd870d1e7255c36ac84c2c6f1c4c2">owner</a>;
<a name="l04078"></a>04078           <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Assuming tracepoint %d is same &quot;</span>
<a name="l04079"></a>04079                              <span class="stringliteral">&quot;as target&#39;s tracepoint %d at %s.\n&quot;</span>),
<a name="l04080"></a>04080                            loc-&gt;<a class="code" href="structbp__location.html#ade5cd870d1e7255c36ac84c2c6f1c4c2">owner</a>-&gt;<a class="code" href="structbreakpoint.html#aa46a2ab4a5f2ae1e42412c412997871b">number</a>, utp-&gt;<a class="code" href="structuploaded__tp.html#a58cc4be1b86f8aa20de77b27929dfe12">number</a>,
<a name="l04081"></a>04081                            <a class="code" href="utils_8c.html#ab5c76d72090f01d3848b63dda4e37d1c">paddress</a> (loc-&gt;<a class="code" href="structbp__location.html#a55f3ff99d536775f5095f11e5f5c3f3e">gdbarch</a>, utp-&gt;<a class="code" href="structuploaded__tp.html#a97572e43a086932e96df20104262d0e8">addr</a>));
<a name="l04082"></a>04082 
<a name="l04083"></a>04083           <span class="comment">/* The tracepoint LOC-&gt;owner was modified (the location LOC</span>
<a name="l04084"></a>04084 <span class="comment">             was marked as inserted in the target).  Save it in</span>
<a name="l04085"></a>04085 <span class="comment">             MODIFIED_TP if not there yet.  The &#39;breakpoint-modified&#39;</span>
<a name="l04086"></a>04086 <span class="comment">             observers will be notified later once for each tracepoint</span>
<a name="l04087"></a>04087 <span class="comment">             saved in MODIFIED_TP.  */</span>
<a name="l04088"></a>04088           <span class="keywordflow">for</span> (ix = 0;
<a name="l04089"></a>04089                <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="structbreakpoint.html">breakpoint_p</a>, modified_tp, ix, b);
<a name="l04090"></a>04090                ix++)
<a name="l04091"></a>04091             <span class="keywordflow">if</span> (b == loc-&gt;<a class="code" href="structbp__location.html#ade5cd870d1e7255c36ac84c2c6f1c4c2">owner</a>)
<a name="l04092"></a>04092               {
<a name="l04093"></a>04093                 found = 1;
<a name="l04094"></a>04094                 <span class="keywordflow">break</span>;
<a name="l04095"></a>04095               }
<a name="l04096"></a>04096           <span class="keywordflow">if</span> (!found)
<a name="l04097"></a>04097             <a class="code" href="vec_8h.html#a8d090c0524726d00931070e0c438ba3f">VEC_safe_push</a> (<a class="code" href="structbreakpoint.html">breakpoint_p</a>, modified_tp, loc-&gt;<a class="code" href="structbp__location.html#ade5cd870d1e7255c36ac84c2c6f1c4c2">owner</a>);
<a name="l04098"></a>04098         }
<a name="l04099"></a>04099       <span class="keywordflow">else</span>
<a name="l04100"></a>04100         {
<a name="l04101"></a>04101           t = <a class="code" href="breakpoint_8c.html#abb139ab21ba604841b086e5bfe71e196">create_tracepoint_from_upload</a> (utp);
<a name="l04102"></a>04102           <span class="keywordflow">if</span> (t)
<a name="l04103"></a>04103             <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Created tracepoint %d for &quot;</span>
<a name="l04104"></a>04104                                <span class="stringliteral">&quot;target&#39;s tracepoint %d at %s.\n&quot;</span>),
<a name="l04105"></a>04105                              t-&gt;<a class="code" href="structtracepoint.html#a881af30b18b555e6ff11113da6b01a02">base</a>.<a class="code" href="structbreakpoint.html#aa46a2ab4a5f2ae1e42412c412997871b">number</a>, utp-&gt;<a class="code" href="structuploaded__tp.html#a58cc4be1b86f8aa20de77b27929dfe12">number</a>,
<a name="l04106"></a>04106                              <a class="code" href="utils_8c.html#ab5c76d72090f01d3848b63dda4e37d1c">paddress</a> (<a class="code" href="arch-utils_8c.html#a0fe1e68475f442e5d6dda589e0c62454">get_current_arch</a> (), utp-&gt;<a class="code" href="structuploaded__tp.html#a97572e43a086932e96df20104262d0e8">addr</a>));
<a name="l04107"></a>04107           <span class="keywordflow">else</span>
<a name="l04108"></a>04108             <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Failed to create tracepoint for target&#39;s &quot;</span>
<a name="l04109"></a>04109                                <span class="stringliteral">&quot;tracepoint %d at %s, skipping it.\n&quot;</span>),
<a name="l04110"></a>04110                              utp-&gt;<a class="code" href="structuploaded__tp.html#a58cc4be1b86f8aa20de77b27929dfe12">number</a>,
<a name="l04111"></a>04111                              <a class="code" href="utils_8c.html#ab5c76d72090f01d3848b63dda4e37d1c">paddress</a> (<a class="code" href="arch-utils_8c.html#a0fe1e68475f442e5d6dda589e0c62454">get_current_arch</a> (), utp-&gt;<a class="code" href="structuploaded__tp.html#a97572e43a086932e96df20104262d0e8">addr</a>));
<a name="l04112"></a>04112         }
<a name="l04113"></a>04113       <span class="comment">/* Whether found or created, record the number used by the</span>
<a name="l04114"></a>04114 <span class="comment">         target, to help with mapping target tracepoints back to their</span>
<a name="l04115"></a>04115 <span class="comment">         counterparts here.  */</span>
<a name="l04116"></a>04116       <span class="keywordflow">if</span> (t)
<a name="l04117"></a>04117         t-&gt;<a class="code" href="structtracepoint.html#a32f485dd859434fab98013e1738187d7">number_on_target</a> = utp-&gt;<a class="code" href="structuploaded__tp.html#a58cc4be1b86f8aa20de77b27929dfe12">number</a>;
<a name="l04118"></a>04118     }
<a name="l04119"></a>04119 
<a name="l04120"></a>04120   <span class="comment">/* Notify &#39;breakpoint-modified&#39; observer that at least one of B&#39;s</span>
<a name="l04121"></a>04121 <span class="comment">     locations was changed.  */</span>
<a name="l04122"></a>04122   <span class="keywordflow">for</span> (ix = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="structbreakpoint.html">breakpoint_p</a>, modified_tp, ix, b); ix++)
<a name="l04123"></a>04123     <a class="code" href="observer_8h.html#a3edacfe44ac49f71646caded92072cad">observer_notify_breakpoint_modified</a> (b);
<a name="l04124"></a>04124 
<a name="l04125"></a>04125   <a class="code" href="vec_8h.html#af5724b2bbce65103300279f9abe7f577">VEC_free</a> (<a class="code" href="structbreakpoint.html">breakpoint_p</a>, modified_tp);
<a name="l04126"></a>04126   free_uploaded_tps (uploaded_tps);
<a name="l04127"></a>04127 }
<a name="l04128"></a>04128 
<a name="l04129"></a>04129 <span class="comment">/* Trace state variables don&#39;t have much to identify them beyond their</span>
<a name="l04130"></a>04130 <span class="comment">   name, so just use that to detect matches.  */</span>
<a name="l04131"></a>04131 
<a name="l04132"></a>04132 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structtrace__state__variable.html">trace_state_variable</a> *
<a name="l04133"></a>04133 find_matching_tsv (<span class="keyword">struct</span> <a class="code" href="structuploaded__tsv.html">uploaded_tsv</a> *utsv)
<a name="l04134"></a>04134 {
<a name="l04135"></a>04135   <span class="keywordflow">if</span> (!utsv-&gt;<a class="code" href="structuploaded__tsv.html#a13b1d8f75f005e4f82f4d26ed3bcef4f">name</a>)
<a name="l04136"></a>04136     <span class="keywordflow">return</span> NULL;
<a name="l04137"></a>04137 
<a name="l04138"></a>04138   <span class="keywordflow">return</span> <a class="code" href="tracepoint_8c.html#aa1473f9341eceb0b7988d4c459b99da1">find_trace_state_variable</a> (utsv-&gt;<a class="code" href="structuploaded__tsv.html#a13b1d8f75f005e4f82f4d26ed3bcef4f">name</a>);
<a name="l04139"></a>04139 }
<a name="l04140"></a>04140 
<a name="l04141"></a>04141 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structtrace__state__variable.html">trace_state_variable</a> *
<a name="l04142"></a>04142 create_tsv_from_upload (<span class="keyword">struct</span> <a class="code" href="structuploaded__tsv.html">uploaded_tsv</a> *utsv)
<a name="l04143"></a>04143 {
<a name="l04144"></a>04144   <span class="keyword">const</span> <span class="keywordtype">char</span> *namebase;
<a name="l04145"></a>04145   <span class="keywordtype">char</span> *buf;
<a name="l04146"></a>04146   <span class="keywordtype">int</span> try_num = 0;
<a name="l04147"></a>04147   <span class="keyword">struct </span><a class="code" href="structtrace__state__variable.html">trace_state_variable</a> *tsv;
<a name="l04148"></a>04148   <span class="keyword">struct </span>cleanup *old_chain;
<a name="l04149"></a>04149 
<a name="l04150"></a>04150   <span class="keywordflow">if</span> (utsv-&gt;<a class="code" href="structuploaded__tsv.html#a13b1d8f75f005e4f82f4d26ed3bcef4f">name</a>)
<a name="l04151"></a>04151     {
<a name="l04152"></a>04152       namebase = utsv-&gt;<a class="code" href="structuploaded__tsv.html#a13b1d8f75f005e4f82f4d26ed3bcef4f">name</a>;
<a name="l04153"></a>04153       buf = <a class="code" href="common-utils_8c.html#ab9bf7e1b4e68bdd0078e9e1e55c62cec">xstrprintf</a> (<span class="stringliteral">&quot;%s&quot;</span>, namebase);
<a name="l04154"></a>04154     }
<a name="l04155"></a>04155   <span class="keywordflow">else</span>
<a name="l04156"></a>04156     {
<a name="l04157"></a>04157       namebase = <span class="stringliteral">&quot;__tsv&quot;</span>;
<a name="l04158"></a>04158       buf = <a class="code" href="common-utils_8c.html#ab9bf7e1b4e68bdd0078e9e1e55c62cec">xstrprintf</a> (<span class="stringliteral">&quot;%s_%d&quot;</span>, namebase, try_num++);
<a name="l04159"></a>04159     }
<a name="l04160"></a>04160 
<a name="l04161"></a>04161   <span class="comment">/* Fish for a name that is not in use.  */</span>
<a name="l04162"></a>04162   <span class="comment">/* (should check against all internal vars?)  */</span>
<a name="l04163"></a>04163   <span class="keywordflow">while</span> (<a class="code" href="tracepoint_8c.html#aa1473f9341eceb0b7988d4c459b99da1">find_trace_state_variable</a> (buf))
<a name="l04164"></a>04164     {
<a name="l04165"></a>04165       <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (buf);
<a name="l04166"></a>04166       buf = <a class="code" href="common-utils_8c.html#ab9bf7e1b4e68bdd0078e9e1e55c62cec">xstrprintf</a> (<span class="stringliteral">&quot;%s_%d&quot;</span>, namebase, try_num++);
<a name="l04167"></a>04167     }
<a name="l04168"></a>04168 
<a name="l04169"></a>04169   old_chain = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, buf);
<a name="l04170"></a>04170 
<a name="l04171"></a>04171   <span class="comment">/* We have an available name, create the variable.  */</span>
<a name="l04172"></a>04172   tsv = <a class="code" href="tracepoint_8c.html#aa40dd0d7217222beaf2aefa3065c356f">create_trace_state_variable</a> (buf);
<a name="l04173"></a>04173   tsv-&gt;<a class="code" href="structtrace__state__variable.html#aa0332c05c03fbfd925ec6b83c7ec21de">initial_value</a> = utsv-&gt;<a class="code" href="structuploaded__tsv.html#a31a9a71e96aeb2239013d0ab0999f62c">initial_value</a>;
<a name="l04174"></a>04174   tsv-&gt;<a class="code" href="structtrace__state__variable.html#af68c8e82c9d62a3b0cd92f1cdde6cf16">builtin</a> = utsv-&gt;<a class="code" href="structuploaded__tsv.html#ac461563a4d2d105c86bb3c3f9bee892c">builtin</a>;
<a name="l04175"></a>04175 
<a name="l04176"></a>04176   <a class="code" href="observer_8h.html#ad33543e05d0035a88e5d6eeb7ae7a76e">observer_notify_tsv_created</a> (tsv);
<a name="l04177"></a>04177 
<a name="l04178"></a>04178   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l04179"></a>04179 
<a name="l04180"></a>04180   <span class="keywordflow">return</span> tsv;
<a name="l04181"></a>04181 }
<a name="l04182"></a>04182 
<a name="l04183"></a>04183 <span class="comment">/* Given a list of uploaded trace state variables, try to match them</span>
<a name="l04184"></a>04184 <span class="comment">   up with existing variables, or create additional ones.  */</span>
<a name="l04185"></a>04185 
<a name="l04186"></a>04186 <span class="keywordtype">void</span>
<a name="l04187"></a><a class="code" href="tracepoint_8h.html#a5b325ef3f41b9930864899e435659161">04187</a> <a class="code" href="tracepoint_8c.html#ae34f1a23c2e8f24b0f517225dd45c69a">merge_uploaded_trace_state_variables</a> (<span class="keyword">struct</span> <a class="code" href="structuploaded__tsv.html">uploaded_tsv</a> **uploaded_tsvs)
<a name="l04188"></a>04188 {
<a name="l04189"></a>04189   <span class="keywordtype">int</span> ix;
<a name="l04190"></a>04190   <span class="keyword">struct </span><a class="code" href="structuploaded__tsv.html">uploaded_tsv</a> *utsv;
<a name="l04191"></a>04191   <span class="keyword">struct </span><a class="code" href="structtrace__state__variable.html">trace_state_variable</a> *tsv;
<a name="l04192"></a>04192   <span class="keywordtype">int</span> highest;
<a name="l04193"></a>04193 
<a name="l04194"></a>04194   <span class="comment">/* Most likely some numbers will have to be reassigned as part of</span>
<a name="l04195"></a>04195 <span class="comment">     the merge, so clear them all in anticipation.  */</span>
<a name="l04196"></a>04196   <span class="keywordflow">for</span> (ix = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="structtrace__state__variable.html">tsv_s</a>, tvariables, ix, tsv); ++ix)
<a name="l04197"></a>04197     tsv-&gt;<a class="code" href="structtrace__state__variable.html#a6bb7d975f2080b6b52d3d3c49c7fe767">number</a> = 0;
<a name="l04198"></a>04198 
<a name="l04199"></a>04199   for (utsv = *uploaded_tsvs; utsv; utsv = utsv-&gt;<a class="code" href="structuploaded__tsv.html#aab1ad86881ad07a1bf1a66ee1e1b1e88">next</a>)
<a name="l04200"></a>04200     {
<a name="l04201"></a>04201       tsv = find_matching_tsv (utsv);
<a name="l04202"></a>04202       <span class="keywordflow">if</span> (tsv)
<a name="l04203"></a>04203         {
<a name="l04204"></a>04204           <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a3f2f91ed92de5dfaa6d27fb82822f8d5">info_verbose</a>)
<a name="l04205"></a>04205             <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Assuming trace state variable $%s &quot;</span>
<a name="l04206"></a>04206                                <span class="stringliteral">&quot;is same as target&#39;s variable %d.\n&quot;</span>),
<a name="l04207"></a>04207                              tsv-&gt;<a class="code" href="structtrace__state__variable.html#ac86438487a7fe60738afe3ba2699b09f">name</a>, utsv-&gt;<a class="code" href="structuploaded__tsv.html#a3a5668fbc028dde6a8d3400bb380ea00">number</a>);
<a name="l04208"></a>04208         }
<a name="l04209"></a>04209       <span class="keywordflow">else</span>
<a name="l04210"></a>04210         {
<a name="l04211"></a>04211           tsv = create_tsv_from_upload (utsv);
<a name="l04212"></a>04212           <span class="keywordflow">if</span> (<a class="code" href="defs_8h.html#a3f2f91ed92de5dfaa6d27fb82822f8d5">info_verbose</a>)
<a name="l04213"></a>04213             <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Created trace state variable &quot;</span>
<a name="l04214"></a>04214                                <span class="stringliteral">&quot;$%s for target&#39;s variable %d.\n&quot;</span>),
<a name="l04215"></a>04215                              tsv-&gt;<a class="code" href="structtrace__state__variable.html#ac86438487a7fe60738afe3ba2699b09f">name</a>, utsv-&gt;<a class="code" href="structuploaded__tsv.html#a3a5668fbc028dde6a8d3400bb380ea00">number</a>);
<a name="l04216"></a>04216         }
<a name="l04217"></a>04217       <span class="comment">/* Give precedence to numberings that come from the target.  */</span>
<a name="l04218"></a>04218       <span class="keywordflow">if</span> (tsv)
<a name="l04219"></a>04219         tsv-&gt;<a class="code" href="structtrace__state__variable.html#a6bb7d975f2080b6b52d3d3c49c7fe767">number</a> = utsv-&gt;<a class="code" href="structuploaded__tsv.html#a3a5668fbc028dde6a8d3400bb380ea00">number</a>;
<a name="l04220"></a>04220     }
<a name="l04221"></a>04221 
<a name="l04222"></a>04222   <span class="comment">/* Renumber everything that didn&#39;t get a target-assigned number.  */</span>
<a name="l04223"></a>04223   highest = 0;
<a name="l04224"></a>04224   <span class="keywordflow">for</span> (ix = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="structtrace__state__variable.html">tsv_s</a>, tvariables, ix, tsv); ++ix)
<a name="l04225"></a>04225     <span class="keywordflow">if</span> (tsv-&gt;<a class="code" href="structtrace__state__variable.html#a6bb7d975f2080b6b52d3d3c49c7fe767">number</a> &gt; highest)
<a name="l04226"></a>04226       highest = tsv-&gt;<a class="code" href="structtrace__state__variable.html#a6bb7d975f2080b6b52d3d3c49c7fe767">number</a>;
<a name="l04227"></a>04227 
<a name="l04228"></a>04228   ++highest;
<a name="l04229"></a>04229   <span class="keywordflow">for</span> (ix = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="structtrace__state__variable.html">tsv_s</a>, tvariables, ix, tsv); ++ix)
<a name="l04230"></a>04230     <span class="keywordflow">if</span> (tsv-&gt;<a class="code" href="structtrace__state__variable.html#a6bb7d975f2080b6b52d3d3c49c7fe767">number</a> == 0)
<a name="l04231"></a>04231       tsv-&gt;<a class="code" href="structtrace__state__variable.html#a6bb7d975f2080b6b52d3d3c49c7fe767">number</a> = highest++;
<a name="l04232"></a>04232 
<a name="l04233"></a>04233   free_uploaded_tsvs (uploaded_tsvs);
<a name="l04234"></a>04234 }
<a name="l04235"></a>04235 
<a name="l04236"></a>04236 <span class="comment">/* target tfile command */</span>
<a name="l04237"></a>04237 
<a name="l04238"></a>04238 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structtarget__ops.html">target_ops</a> tfile_ops;
<a name="l04239"></a>04239 
<a name="l04240"></a>04240 <span class="comment">/* Fill in tfile_ops with its defined operations and properties.  */</span>
<a name="l04241"></a>04241 
<a name="l04242"></a><a class="code" href="tracepoint_8c.html#a2f93d581900cc5afea1f532d1564c45e">04242</a> <span class="preprocessor">#define TRACE_HEADER_SIZE 8</span>
<a name="l04243"></a>04243 <span class="preprocessor"></span>
<a name="l04244"></a>04244 <span class="keyword">static</span> <span class="keywordtype">char</span> *trace_filename;
<a name="l04245"></a>04245 <span class="keyword">static</span> <span class="keywordtype">int</span> trace_fd = -1;
<a name="l04246"></a>04246 <span class="keyword">static</span> off_t trace_frames_offset;
<a name="l04247"></a>04247 <span class="keyword">static</span> off_t cur_offset;
<a name="l04248"></a>04248 <span class="keyword">static</span> <span class="keywordtype">int</span> cur_data_size;
<a name="l04249"></a><a class="code" href="tracepoint_8h.html#a5dc5a6689e0bd3501fe98c5e89858e7c">04249</a> <span class="keywordtype">int</span> <a class="code" href="tracepoint_8c.html#a5dc5a6689e0bd3501fe98c5e89858e7c">trace_regblock_size</a>;
<a name="l04250"></a>04250 
<a name="l04251"></a>04251 <span class="keyword">static</span> <span class="keywordtype">void</span> tfile_interp_line (<span class="keywordtype">char</span> *<a class="code" href="symtab_8h.html#a41ebd28ef1d7c6ade45642cb6acc1039">line</a>,
<a name="l04252"></a>04252                                <span class="keyword">struct</span> <a class="code" href="structuploaded__tp.html">uploaded_tp</a> **utpp,
<a name="l04253"></a>04253                                <span class="keyword">struct</span> <a class="code" href="structuploaded__tsv.html">uploaded_tsv</a> **utsvp);
<a name="l04254"></a>04254 
<a name="l04255"></a>04255 <span class="comment">/* Read SIZE bytes into READBUF from the trace frame, starting at</span>
<a name="l04256"></a>04256 <span class="comment">   TRACE_FD&#39;s current position.  Note that this call `read&#39;</span>
<a name="l04257"></a>04257 <span class="comment">   underneath, hence it advances the file&#39;s seek position.  Throws an</span>
<a name="l04258"></a>04258 <span class="comment">   error if the `read&#39; syscall fails, or less than SIZE bytes are</span>
<a name="l04259"></a>04259 <span class="comment">   read.  */</span>
<a name="l04260"></a>04260 
<a name="l04261"></a>04261 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l04262"></a>04262 tfile_read (<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *readbuf, <span class="keywordtype">int</span> <a class="code" href="go32-nat_8c.html#a854352f53b148adc24983a58a1866d66">size</a>)
<a name="l04263"></a>04263 {
<a name="l04264"></a>04264   <span class="keywordtype">int</span> gotten;
<a name="l04265"></a>04265 
<a name="l04266"></a>04266   gotten = <a class="code" href="expect-read1_8c.html#af32a16ad2dd9e48482f8f790db7dbbd2">read</a> (trace_fd, readbuf, size);
<a name="l04267"></a>04267   <span class="keywordflow">if</span> (gotten &lt; 0)
<a name="l04268"></a>04268     <a class="code" href="utils_8c.html#a14801ceb45147833b8ce111c89ea0d5f">perror_with_name</a> (trace_filename);
<a name="l04269"></a>04269   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (gotten &lt; size)
<a name="l04270"></a>04270     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Premature end of file while reading trace file&quot;</span>));
<a name="l04271"></a>04271 }
<a name="l04272"></a>04272 
<a name="l04273"></a>04273 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l04274"></a>04274 tfile_open (<span class="keywordtype">char</span> *filename, <span class="keywordtype">int</span> from_tty)
<a name="l04275"></a>04275 {
<a name="l04276"></a>04276   <span class="keyword">volatile</span> <span class="keyword">struct </span><a class="code" href="structgdb__exception.html">gdb_exception</a> ex;
<a name="l04277"></a>04277   <span class="keywordtype">char</span> *temp;
<a name="l04278"></a>04278   <span class="keyword">struct </span>cleanup *old_chain;
<a name="l04279"></a>04279   <span class="keywordtype">int</span> <a class="code" href="solib-som_8c.html#a555096840020c318e34b205419e98cca">flags</a>;
<a name="l04280"></a>04280   <span class="keywordtype">int</span> scratch_chan;
<a name="l04281"></a>04281   <span class="keywordtype">char</span> header[<a class="code" href="tracepoint_8c.html#a2f93d581900cc5afea1f532d1564c45e">TRACE_HEADER_SIZE</a>];
<a name="l04282"></a>04282   <span class="keywordtype">char</span> linebuf[1000]; <span class="comment">/* Should be max remote packet size or so.  */</span>
<a name="l04283"></a>04283   <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> byte;
<a name="l04284"></a>04284   <span class="keywordtype">int</span> bytes, i;
<a name="l04285"></a>04285   <span class="keyword">struct </span><a class="code" href="structtrace__status.html">trace_status</a> *ts;
<a name="l04286"></a>04286   <span class="keyword">struct </span><a class="code" href="structuploaded__tp.html">uploaded_tp</a> *uploaded_tps = NULL;
<a name="l04287"></a>04287   <span class="keyword">struct </span><a class="code" href="structuploaded__tsv.html">uploaded_tsv</a> *uploaded_tsvs = NULL;
<a name="l04288"></a>04288 
<a name="l04289"></a>04289   <a class="code" href="target_8c.html#acc9e6257009bd3dd81f0577b44f924d9">target_preopen</a> (from_tty);
<a name="l04290"></a>04290   <span class="keywordflow">if</span> (!filename)
<a name="l04291"></a>04291     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No trace file specified.&quot;</span>));
<a name="l04292"></a>04292 
<a name="l04293"></a>04293   filename = tilde_expand (filename);
<a name="l04294"></a>04294   <span class="keywordflow">if</span> (!IS_ABSOLUTE_PATH(filename))
<a name="l04295"></a>04295     {
<a name="l04296"></a>04296       temp = concat (<a class="code" href="defs_8h.html#a6dd03da55f1ccd4375343b3a93aaf421">current_directory</a>, <span class="stringliteral">&quot;/&quot;</span>, filename, (<span class="keywordtype">char</span> *) NULL);
<a name="l04297"></a>04297       <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (filename);
<a name="l04298"></a>04298       filename = temp;
<a name="l04299"></a>04299     }
<a name="l04300"></a>04300 
<a name="l04301"></a>04301   old_chain = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, filename);
<a name="l04302"></a>04302 
<a name="l04303"></a>04303   flags = O_BINARY | <a class="code" href="tracepoint_8c.html#a1126309aa58e7c99553c7f6be1bc7348">O_LARGEFILE</a>;
<a name="l04304"></a>04304   flags |= O_RDONLY;
<a name="l04305"></a>04305   scratch_chan = <a class="code" href="filestuff_8c.html#adf94e72f9c914500c8b9b5d1e66de811">gdb_open_cloexec</a> (filename, flags, 0);
<a name="l04306"></a>04306   <span class="keywordflow">if</span> (scratch_chan &lt; 0)
<a name="l04307"></a>04307     <a class="code" href="utils_8c.html#a14801ceb45147833b8ce111c89ea0d5f">perror_with_name</a> (filename);
<a name="l04308"></a>04308 
<a name="l04309"></a>04309   <span class="comment">/* Looks semi-reasonable.  Toss the old trace file and work on the new.  */</span>
<a name="l04310"></a>04310 
<a name="l04311"></a>04311   <a class="code" href="cleanups_8c.html#a5ec3987bf995edcc44def9e17ada6eba">discard_cleanups</a> (old_chain); <span class="comment">/* Don&#39;t free filename any more.  */</span>
<a name="l04312"></a>04312   <a class="code" href="target_8c.html#a9599d37847d1388531abb3f2aeba6616">unpush_target</a> (&amp;tfile_ops);
<a name="l04313"></a>04313 
<a name="l04314"></a>04314   trace_filename = xstrdup (filename);
<a name="l04315"></a>04315   trace_fd = scratch_chan;
<a name="l04316"></a>04316 
<a name="l04317"></a>04317   bytes = 0;
<a name="l04318"></a>04318   <span class="comment">/* Read the file header and test for validity.  */</span>
<a name="l04319"></a>04319   tfile_read ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) &amp;header, <a class="code" href="tracepoint_8c.html#a2f93d581900cc5afea1f532d1564c45e">TRACE_HEADER_SIZE</a>);
<a name="l04320"></a>04320 
<a name="l04321"></a>04321   bytes += <a class="code" href="tracepoint_8c.html#a2f93d581900cc5afea1f532d1564c45e">TRACE_HEADER_SIZE</a>;
<a name="l04322"></a>04322   <span class="keywordflow">if</span> (!(header[0] == 0x7f
<a name="l04323"></a>04323         &amp;&amp; (strncmp (header + 1, <span class="stringliteral">&quot;TRACE0\n&quot;</span>, 7) == 0)))
<a name="l04324"></a>04324     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;File is not a valid trace file.&quot;</span>));
<a name="l04325"></a>04325 
<a name="l04326"></a>04326   <a class="code" href="target_8c.html#ada1b9dc1eeb0546d39b86ba7ac645e67">push_target</a> (&amp;tfile_ops);
<a name="l04327"></a>04327 
<a name="l04328"></a>04328   trace_regblock_size = 0;
<a name="l04329"></a>04329   ts = <a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> ();
<a name="l04330"></a>04330   <span class="comment">/* We know we&#39;re working with a file.  Record its name.  */</span>
<a name="l04331"></a>04331   ts-&gt;<a class="code" href="structtrace__status.html#af3f61c2f2d9622d13b58138c9a38bdbd">filename</a> = trace_filename;
<a name="l04332"></a>04332   <span class="comment">/* Set defaults in case there is no status line.  */</span>
<a name="l04333"></a>04333   ts-&gt;<a class="code" href="structtrace__status.html#a22da5a4e4555b5b86e8b2aeaf80763d2">running_known</a> = 0;
<a name="l04334"></a>04334   ts-&gt;<a class="code" href="structtrace__status.html#af5d4f9904d71961dd065b57fed099644">stop_reason</a> = <a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77aeac56e2eee7510675fa2c3fd1306b67d">trace_stop_reason_unknown</a>;
<a name="l04335"></a>04335   ts-&gt;<a class="code" href="structtrace__status.html#aebfcf3df70568e7ae65480c1f4efe0f6">traceframe_count</a> = -1;
<a name="l04336"></a>04336   ts-&gt;<a class="code" href="structtrace__status.html#ac6f0b3903e2ab671c95dec8bf674f15b">buffer_free</a> = 0;
<a name="l04337"></a>04337   ts-&gt;<a class="code" href="structtrace__status.html#a11a975b86259c84816c3341d32e2fca7">disconnected_tracing</a> = 0;
<a name="l04338"></a>04338   ts-&gt;<a class="code" href="structtrace__status.html#ad6afd6f38f37406b22b83ea67dd2b027">circular_buffer</a> = 0;
<a name="l04339"></a>04339 
<a name="l04340"></a>04340   <a class="code" href="exceptions_8h.html#aef4514ee39b9305fddee27f49c7c34eb">TRY_CATCH</a> (ex, <a class="code" href="exceptions_8h.html#abfa3a3b99557b11f5766baf69465fdf6ab50fde886a7de8c013bf2bd4e7c073a4">RETURN_MASK_ALL</a>)
<a name="l04341"></a>04341     {
<a name="l04342"></a>04342       <span class="comment">/* Read through a section of newline-terminated lines that</span>
<a name="l04343"></a>04343 <span class="comment">         define things like tracepoints.  */</span>
<a name="l04344"></a>04344       i = 0;
<a name="l04345"></a>04345       <span class="keywordflow">while</span> (1)
<a name="l04346"></a>04346         {
<a name="l04347"></a>04347           tfile_read (&amp;byte, 1);
<a name="l04348"></a>04348 
<a name="l04349"></a>04349           ++bytes;
<a name="l04350"></a>04350           <span class="keywordflow">if</span> (byte == <span class="charliteral">&#39;\n&#39;</span>)
<a name="l04351"></a>04351             {
<a name="l04352"></a>04352               <span class="comment">/* Empty line marks end of the definition section.  */</span>
<a name="l04353"></a>04353               <span class="keywordflow">if</span> (i == 0)
<a name="l04354"></a>04354                 <span class="keywordflow">break</span>;
<a name="l04355"></a>04355               linebuf[i] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l04356"></a>04356               i = 0;
<a name="l04357"></a>04357               tfile_interp_line (linebuf, &amp;uploaded_tps, &amp;uploaded_tsvs);
<a name="l04358"></a>04358             }
<a name="l04359"></a>04359           <span class="keywordflow">else</span>
<a name="l04360"></a>04360             linebuf[i++] = byte;
<a name="l04361"></a>04361           <span class="keywordflow">if</span> (i &gt;= 1000)
<a name="l04362"></a>04362             <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Excessively long lines in trace file&quot;</span>));
<a name="l04363"></a>04363         }
<a name="l04364"></a>04364 
<a name="l04365"></a>04365       <span class="comment">/* Record the starting offset of the binary trace data.  */</span>
<a name="l04366"></a>04366       trace_frames_offset = bytes;
<a name="l04367"></a>04367 
<a name="l04368"></a>04368       <span class="comment">/* If we don&#39;t have a blocksize, we can&#39;t interpret the</span>
<a name="l04369"></a>04369 <span class="comment">         traceframes.  */</span>
<a name="l04370"></a>04370       <span class="keywordflow">if</span> (trace_regblock_size == 0)
<a name="l04371"></a>04371         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No register block size recorded in trace file&quot;</span>));
<a name="l04372"></a>04372     }
<a name="l04373"></a>04373   <span class="keywordflow">if</span> (ex.reason &lt; 0)
<a name="l04374"></a>04374     {
<a name="l04375"></a>04375       <span class="comment">/* Remove the partially set up target.  */</span>
<a name="l04376"></a>04376       <a class="code" href="target_8c.html#a9599d37847d1388531abb3f2aeba6616">unpush_target</a> (&amp;tfile_ops);
<a name="l04377"></a>04377       <a class="code" href="exceptions_8c.html#a541d1b545da68efe4f8b729a945f83e7">throw_exception</a> (ex);
<a name="l04378"></a>04378     }
<a name="l04379"></a>04379 
<a name="l04380"></a>04380   <span class="keywordflow">if</span> (ts-&gt;<a class="code" href="structtrace__status.html#aebfcf3df70568e7ae65480c1f4efe0f6">traceframe_count</a> &lt;= 0)
<a name="l04381"></a>04381     <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;No traceframes present in this file.&quot;</span>));
<a name="l04382"></a>04382 
<a name="l04383"></a>04383   <span class="comment">/* Add the file&#39;s tracepoints and variables into the current mix.  */</span>
<a name="l04384"></a>04384 
<a name="l04385"></a>04385   <span class="comment">/* Get trace state variables first, they may be checked when parsing</span>
<a name="l04386"></a>04386 <span class="comment">     uploaded commands.  */</span>
<a name="l04387"></a>04387   <a class="code" href="tracepoint_8c.html#ae34f1a23c2e8f24b0f517225dd45c69a">merge_uploaded_trace_state_variables</a> (&amp;uploaded_tsvs);
<a name="l04388"></a>04388 
<a name="l04389"></a>04389   <a class="code" href="tracepoint_8c.html#aad609d453437967df8af749fafcc9a4d">merge_uploaded_tracepoints</a> (&amp;uploaded_tps);
<a name="l04390"></a>04390 }
<a name="l04391"></a>04391 
<a name="l04392"></a>04392 <span class="comment">/* Interpret the given line from the definitions part of the trace</span>
<a name="l04393"></a>04393 <span class="comment">   file.  */</span>
<a name="l04394"></a>04394 
<a name="l04395"></a>04395 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l04396"></a>04396 tfile_interp_line (<span class="keywordtype">char</span> *<a class="code" href="symtab_8h.html#a41ebd28ef1d7c6ade45642cb6acc1039">line</a>, <span class="keyword">struct</span> <a class="code" href="structuploaded__tp.html">uploaded_tp</a> **utpp,
<a name="l04397"></a>04397                    <span class="keyword">struct</span> <a class="code" href="structuploaded__tsv.html">uploaded_tsv</a> **utsvp)
<a name="l04398"></a>04398 {
<a name="l04399"></a>04399   <span class="keywordtype">char</span> *p = <a class="code" href="symtab_8h.html#a41ebd28ef1d7c6ade45642cb6acc1039">line</a>;
<a name="l04400"></a>04400 
<a name="l04401"></a>04401   <span class="keywordflow">if</span> (strncmp (p, <span class="stringliteral">&quot;R &quot;</span>, strlen (<span class="stringliteral">&quot;R &quot;</span>)) == 0)
<a name="l04402"></a>04402     {
<a name="l04403"></a>04403       p += strlen (<span class="stringliteral">&quot;R &quot;</span>);
<a name="l04404"></a>04404       trace_regblock_size = strtol (p, &amp;p, 16);
<a name="l04405"></a>04405     }
<a name="l04406"></a>04406   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (p, <span class="stringliteral">&quot;status &quot;</span>, strlen (<span class="stringliteral">&quot;status &quot;</span>)) == 0)
<a name="l04407"></a>04407     {
<a name="l04408"></a>04408       p += strlen (<span class="stringliteral">&quot;status &quot;</span>);
<a name="l04409"></a>04409       <a class="code" href="tracepoint_8c.html#a7312beb23dcd273ec3f3551a5e6be51d">parse_trace_status</a> (p, <a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> ());
<a name="l04410"></a>04410     }
<a name="l04411"></a>04411   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (p, <span class="stringliteral">&quot;tp &quot;</span>, strlen (<span class="stringliteral">&quot;tp &quot;</span>)) == 0)
<a name="l04412"></a>04412     {
<a name="l04413"></a>04413       p += strlen (<span class="stringliteral">&quot;tp &quot;</span>);
<a name="l04414"></a>04414       <a class="code" href="tracepoint_8c.html#abb8ec4a188965aae1168a53566bb96ce">parse_tracepoint_definition</a> (p, utpp);
<a name="l04415"></a>04415     }
<a name="l04416"></a>04416   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (p, <span class="stringliteral">&quot;tsv &quot;</span>, strlen (<span class="stringliteral">&quot;tsv &quot;</span>)) == 0)
<a name="l04417"></a>04417     {
<a name="l04418"></a>04418       p += strlen (<span class="stringliteral">&quot;tsv &quot;</span>);
<a name="l04419"></a>04419       <a class="code" href="tracepoint_8c.html#ad6098d89dba7c28fd6a898130e0f6aac">parse_tsv_definition</a> (p, utsvp);
<a name="l04420"></a>04420     }
<a name="l04421"></a>04421   <span class="keywordflow">else</span>
<a name="l04422"></a>04422     <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Ignoring trace file definition \&quot;%s\&quot;&quot;</span>), line);
<a name="l04423"></a>04423 }
<a name="l04424"></a>04424 
<a name="l04425"></a>04425 <span class="comment">/* Parse the part of trace status syntax that is shared between</span>
<a name="l04426"></a>04426 <span class="comment">   the remote protocol and the trace file reader.  */</span>
<a name="l04427"></a>04427 
<a name="l04428"></a>04428 <span class="keywordtype">void</span>
<a name="l04429"></a><a class="code" href="tracepoint_8h.html#a7312beb23dcd273ec3f3551a5e6be51d">04429</a> <a class="code" href="tracepoint_8c.html#a7312beb23dcd273ec3f3551a5e6be51d">parse_trace_status</a> (<span class="keywordtype">char</span> *line, <span class="keyword">struct</span> <a class="code" href="structtrace__status.html">trace_status</a> *ts)
<a name="l04430"></a>04430 {
<a name="l04431"></a>04431   <span class="keywordtype">char</span> *p = <a class="code" href="symtab_8h.html#a41ebd28ef1d7c6ade45642cb6acc1039">line</a>, *p1, *p2, *p3, *p_temp;
<a name="l04432"></a>04432   <span class="keywordtype">int</span> end;
<a name="l04433"></a>04433   <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> val;
<a name="l04434"></a>04434 
<a name="l04435"></a>04435   ts-&gt;<a class="code" href="structtrace__status.html#a22da5a4e4555b5b86e8b2aeaf80763d2">running_known</a> = 1;
<a name="l04436"></a>04436   ts-&gt;<a class="code" href="structtrace__status.html#af1d922d381deda9d03faa4406c0a36de">running</a> = (*p++ == <span class="charliteral">&#39;1&#39;</span>);
<a name="l04437"></a>04437   ts-&gt;<a class="code" href="structtrace__status.html#af5d4f9904d71961dd065b57fed099644">stop_reason</a> = <a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77aeac56e2eee7510675fa2c3fd1306b67d">trace_stop_reason_unknown</a>;
<a name="l04438"></a>04438   <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (ts-&gt;<a class="code" href="structtrace__status.html#a4d5e182f56e3793df49d65abb8e8c456">stop_desc</a>);
<a name="l04439"></a>04439   ts-&gt;<a class="code" href="structtrace__status.html#a4d5e182f56e3793df49d65abb8e8c456">stop_desc</a> = NULL;
<a name="l04440"></a>04440   ts-&gt;<a class="code" href="structtrace__status.html#aebfcf3df70568e7ae65480c1f4efe0f6">traceframe_count</a> = -1;
<a name="l04441"></a>04441   ts-&gt;<a class="code" href="structtrace__status.html#a96ec1749e52d1943618c0df3ee457979">traceframes_created</a> = -1;
<a name="l04442"></a>04442   ts-&gt;<a class="code" href="structtrace__status.html#ac6f0b3903e2ab671c95dec8bf674f15b">buffer_free</a> = -1;
<a name="l04443"></a>04443   ts-&gt;<a class="code" href="structtrace__status.html#a409141fb583ccaef669f996dd68a2fe0">buffer_size</a> = -1;
<a name="l04444"></a>04444   ts-&gt;<a class="code" href="structtrace__status.html#a11a975b86259c84816c3341d32e2fca7">disconnected_tracing</a> = 0;
<a name="l04445"></a>04445   ts-&gt;<a class="code" href="structtrace__status.html#ad6afd6f38f37406b22b83ea67dd2b027">circular_buffer</a> = 0;
<a name="l04446"></a>04446   <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (ts-&gt;<a class="code" href="structtrace__status.html#ae84456b65c09a38fcf8f63ed58a78f04">user_name</a>);
<a name="l04447"></a>04447   ts-&gt;<a class="code" href="structtrace__status.html#ae84456b65c09a38fcf8f63ed58a78f04">user_name</a> = NULL;
<a name="l04448"></a>04448   <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (ts-&gt;<a class="code" href="structtrace__status.html#a114142bb0c3aa89b765bce9e26bd399c">notes</a>);
<a name="l04449"></a>04449   ts-&gt;<a class="code" href="structtrace__status.html#a114142bb0c3aa89b765bce9e26bd399c">notes</a> = NULL;
<a name="l04450"></a>04450   ts-&gt;<a class="code" href="structtrace__status.html#acaf0437f240f26a40362a34707353e7c">start_time</a> = ts-&gt;<a class="code" href="structtrace__status.html#a996a6a416f9e35c599215973dc2c6928">stop_time</a> = 0;
<a name="l04451"></a>04451 
<a name="l04452"></a>04452   <span class="keywordflow">while</span> (*p++)
<a name="l04453"></a>04453     {
<a name="l04454"></a>04454       p1 = <a class="code" href="gdb__string_8h.html#adf46aa8f2e08cfb505868bbfc88b5fd4">strchr</a> (p, <span class="charliteral">&#39;:&#39;</span>);
<a name="l04455"></a>04455       <span class="keywordflow">if</span> (p1 == NULL)
<a name="l04456"></a>04456         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Malformed trace status, at %s\n\</span>
<a name="l04457"></a>04457 <span class="stringliteral">Status line: &#39;%s&#39;\n&quot;</span>), p, line);
<a name="l04458"></a>04458       p3 = <a class="code" href="gdb__string_8h.html#adf46aa8f2e08cfb505868bbfc88b5fd4">strchr</a> (p, <span class="charliteral">&#39;;&#39;</span>);
<a name="l04459"></a>04459       <span class="keywordflow">if</span> (p3 == NULL)
<a name="l04460"></a>04460         p3 = p + strlen (p);
<a name="l04461"></a>04461       <span class="keywordflow">if</span> (strncmp (p, stop_reason_names[<a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77a058f3c6aa59a1d63de69842e78774620">trace_buffer_full</a>], p1 - p) == 0)
<a name="l04462"></a>04462         {
<a name="l04463"></a>04463           p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (++p1, &amp;val);
<a name="l04464"></a>04464           ts-&gt;<a class="code" href="structtrace__status.html#af5d4f9904d71961dd065b57fed099644">stop_reason</a> = <a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77a058f3c6aa59a1d63de69842e78774620">trace_buffer_full</a>;
<a name="l04465"></a>04465         }
<a name="l04466"></a>04466       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (p, stop_reason_names[<a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77ad90bfa1c8b065d0f315d52c00991d313">trace_never_run</a>], p1 - p) == 0)
<a name="l04467"></a>04467         {
<a name="l04468"></a>04468           p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (++p1, &amp;val);
<a name="l04469"></a>04469           ts-&gt;<a class="code" href="structtrace__status.html#af5d4f9904d71961dd065b57fed099644">stop_reason</a> = <a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77ad90bfa1c8b065d0f315d52c00991d313">trace_never_run</a>;
<a name="l04470"></a>04470         }
<a name="l04471"></a>04471       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (p, stop_reason_names[<a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77ad5383255900f5832f492c7b0937ea741">tracepoint_passcount</a>],
<a name="l04472"></a>04472                         p1 - p) == 0)
<a name="l04473"></a>04473         {
<a name="l04474"></a>04474           p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (++p1, &amp;val);
<a name="l04475"></a>04475           ts-&gt;<a class="code" href="structtrace__status.html#af5d4f9904d71961dd065b57fed099644">stop_reason</a> = <a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77ad5383255900f5832f492c7b0937ea741">tracepoint_passcount</a>;
<a name="l04476"></a>04476           ts-&gt;<a class="code" href="structtrace__status.html#ad22500bfd24188778985319a545c42d1">stopping_tracepoint</a> = val;
<a name="l04477"></a>04477         }
<a name="l04478"></a>04478       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (p, stop_reason_names[<a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77a058a54e86734f1069cf989782b9b9f22">tstop_command</a>], p1 - p) == 0)
<a name="l04479"></a>04479         {
<a name="l04480"></a>04480           p2 = <a class="code" href="gdb__string_8h.html#adf46aa8f2e08cfb505868bbfc88b5fd4">strchr</a> (++p1, <span class="charliteral">&#39;:&#39;</span>);
<a name="l04481"></a>04481           <span class="keywordflow">if</span> (!p2 || p2 &gt; p3)
<a name="l04482"></a>04482             {
<a name="l04483"></a>04483               <span class="comment">/*older style*/</span>
<a name="l04484"></a>04484               p2 = p1;
<a name="l04485"></a>04485             }
<a name="l04486"></a>04486           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p2 != p1)
<a name="l04487"></a>04487             {
<a name="l04488"></a>04488               ts-&gt;<a class="code" href="structtrace__status.html#a4d5e182f56e3793df49d65abb8e8c456">stop_desc</a> = <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (strlen (line));
<a name="l04489"></a>04489               end = <a class="code" href="remote_8c.html#aa9701b4d16cb5e4e31c5a952478edaae">hex2bin</a> (p1, (<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) ts-&gt;<a class="code" href="structtrace__status.html#a4d5e182f56e3793df49d65abb8e8c456">stop_desc</a>, (p2 - p1) / 2);
<a name="l04490"></a>04490               ts-&gt;<a class="code" href="structtrace__status.html#a4d5e182f56e3793df49d65abb8e8c456">stop_desc</a>[end] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l04491"></a>04491             }
<a name="l04492"></a>04492           <span class="keywordflow">else</span>
<a name="l04493"></a>04493             ts-&gt;<a class="code" href="structtrace__status.html#a4d5e182f56e3793df49d65abb8e8c456">stop_desc</a> = xstrdup (<span class="stringliteral">&quot;&quot;</span>);
<a name="l04494"></a>04494 
<a name="l04495"></a>04495           p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (++p2, &amp;val);
<a name="l04496"></a>04496           ts-&gt;<a class="code" href="structtrace__status.html#af5d4f9904d71961dd065b57fed099644">stop_reason</a> = <a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77a058a54e86734f1069cf989782b9b9f22">tstop_command</a>;
<a name="l04497"></a>04497         }
<a name="l04498"></a>04498       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (p, stop_reason_names[<a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77ad1f9afda06631fe6c07ac32cac341f27">trace_disconnected</a>], p1 - p) == 0)
<a name="l04499"></a>04499         {
<a name="l04500"></a>04500           p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (++p1, &amp;val);
<a name="l04501"></a>04501           ts-&gt;<a class="code" href="structtrace__status.html#af5d4f9904d71961dd065b57fed099644">stop_reason</a> = <a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77ad1f9afda06631fe6c07ac32cac341f27">trace_disconnected</a>;
<a name="l04502"></a>04502         }
<a name="l04503"></a>04503       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (p, stop_reason_names[<a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77a4a52d08e789e2e817131f822384872c3">tracepoint_error</a>], p1 - p) == 0)
<a name="l04504"></a>04504         {
<a name="l04505"></a>04505           p2 = <a class="code" href="gdb__string_8h.html#adf46aa8f2e08cfb505868bbfc88b5fd4">strchr</a> (++p1, <span class="charliteral">&#39;:&#39;</span>);
<a name="l04506"></a>04506           <span class="keywordflow">if</span> (p2 != p1)
<a name="l04507"></a>04507             {
<a name="l04508"></a>04508               ts-&gt;<a class="code" href="structtrace__status.html#a4d5e182f56e3793df49d65abb8e8c456">stop_desc</a> = <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> ((p2 - p1) / 2 + 1);
<a name="l04509"></a>04509               end = <a class="code" href="remote_8c.html#aa9701b4d16cb5e4e31c5a952478edaae">hex2bin</a> (p1, (<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) ts-&gt;<a class="code" href="structtrace__status.html#a4d5e182f56e3793df49d65abb8e8c456">stop_desc</a>, (p2 - p1) / 2);
<a name="l04510"></a>04510               ts-&gt;<a class="code" href="structtrace__status.html#a4d5e182f56e3793df49d65abb8e8c456">stop_desc</a>[end] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l04511"></a>04511             }
<a name="l04512"></a>04512           <span class="keywordflow">else</span>
<a name="l04513"></a>04513             ts-&gt;<a class="code" href="structtrace__status.html#a4d5e182f56e3793df49d65abb8e8c456">stop_desc</a> = xstrdup (<span class="stringliteral">&quot;&quot;</span>);
<a name="l04514"></a>04514 
<a name="l04515"></a>04515           p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (++p2, &amp;val);
<a name="l04516"></a>04516           ts-&gt;<a class="code" href="structtrace__status.html#ad22500bfd24188778985319a545c42d1">stopping_tracepoint</a> = val;
<a name="l04517"></a>04517           ts-&gt;<a class="code" href="structtrace__status.html#af5d4f9904d71961dd065b57fed099644">stop_reason</a> = <a class="code" href="tracepoint_8h.html#a71ec0d96ef86158a242ef492b373cd77a4a52d08e789e2e817131f822384872c3">tracepoint_error</a>;
<a name="l04518"></a>04518         }
<a name="l04519"></a>04519       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (p, <span class="stringliteral">&quot;tframes&quot;</span>, p1 - p) == 0)
<a name="l04520"></a>04520         {
<a name="l04521"></a>04521           p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (++p1, &amp;val);
<a name="l04522"></a>04522           ts-&gt;<a class="code" href="structtrace__status.html#aebfcf3df70568e7ae65480c1f4efe0f6">traceframe_count</a> = val;
<a name="l04523"></a>04523         }
<a name="l04524"></a>04524       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (p, <span class="stringliteral">&quot;tcreated&quot;</span>, p1 - p) == 0)
<a name="l04525"></a>04525         {
<a name="l04526"></a>04526           p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (++p1, &amp;val);
<a name="l04527"></a>04527           ts-&gt;<a class="code" href="structtrace__status.html#a96ec1749e52d1943618c0df3ee457979">traceframes_created</a> = val;
<a name="l04528"></a>04528         }
<a name="l04529"></a>04529       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (p, <span class="stringliteral">&quot;tfree&quot;</span>, p1 - p) == 0)
<a name="l04530"></a>04530         {
<a name="l04531"></a>04531           p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (++p1, &amp;val);
<a name="l04532"></a>04532           ts-&gt;<a class="code" href="structtrace__status.html#ac6f0b3903e2ab671c95dec8bf674f15b">buffer_free</a> = val;
<a name="l04533"></a>04533         }
<a name="l04534"></a>04534       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (p, <span class="stringliteral">&quot;tsize&quot;</span>, p1 - p) == 0)
<a name="l04535"></a>04535         {
<a name="l04536"></a>04536           p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (++p1, &amp;val);
<a name="l04537"></a>04537           ts-&gt;<a class="code" href="structtrace__status.html#a409141fb583ccaef669f996dd68a2fe0">buffer_size</a> = val;
<a name="l04538"></a>04538         }
<a name="l04539"></a>04539       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (p, <span class="stringliteral">&quot;disconn&quot;</span>, p1 - p) == 0)
<a name="l04540"></a>04540         {
<a name="l04541"></a>04541           p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (++p1, &amp;val);
<a name="l04542"></a>04542           ts-&gt;<a class="code" href="structtrace__status.html#a11a975b86259c84816c3341d32e2fca7">disconnected_tracing</a> = val;
<a name="l04543"></a>04543         }
<a name="l04544"></a>04544       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (p, <span class="stringliteral">&quot;circular&quot;</span>, p1 - p) == 0)
<a name="l04545"></a>04545         {
<a name="l04546"></a>04546           p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (++p1, &amp;val);
<a name="l04547"></a>04547           ts-&gt;<a class="code" href="structtrace__status.html#ad6afd6f38f37406b22b83ea67dd2b027">circular_buffer</a> = val;
<a name="l04548"></a>04548         }
<a name="l04549"></a>04549       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (p, <span class="stringliteral">&quot;starttime&quot;</span>, p1 - p) == 0)
<a name="l04550"></a>04550         {
<a name="l04551"></a>04551           p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (++p1, &amp;val);
<a name="l04552"></a>04552           ts-&gt;<a class="code" href="structtrace__status.html#acaf0437f240f26a40362a34707353e7c">start_time</a> = val;
<a name="l04553"></a>04553         }
<a name="l04554"></a>04554       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (p, <span class="stringliteral">&quot;stoptime&quot;</span>, p1 - p) == 0)
<a name="l04555"></a>04555         {
<a name="l04556"></a>04556           p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (++p1, &amp;val);
<a name="l04557"></a>04557           ts-&gt;<a class="code" href="structtrace__status.html#a996a6a416f9e35c599215973dc2c6928">stop_time</a> = val;
<a name="l04558"></a>04558         }
<a name="l04559"></a>04559       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (p, <span class="stringliteral">&quot;username&quot;</span>, p1 - p) == 0)
<a name="l04560"></a>04560         {
<a name="l04561"></a>04561           ++p1;
<a name="l04562"></a>04562           ts-&gt;<a class="code" href="structtrace__status.html#ae84456b65c09a38fcf8f63ed58a78f04">user_name</a> = <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (strlen (p) / 2);
<a name="l04563"></a>04563           end = <a class="code" href="remote_8c.html#aa9701b4d16cb5e4e31c5a952478edaae">hex2bin</a> (p1, (<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) ts-&gt;<a class="code" href="structtrace__status.html#ae84456b65c09a38fcf8f63ed58a78f04">user_name</a>, (p3 - p1)  / 2);
<a name="l04564"></a>04564           ts-&gt;<a class="code" href="structtrace__status.html#ae84456b65c09a38fcf8f63ed58a78f04">user_name</a>[end] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l04565"></a>04565           p = p3;
<a name="l04566"></a>04566         }
<a name="l04567"></a>04567       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (p, <span class="stringliteral">&quot;notes&quot;</span>, p1 - p) == 0)
<a name="l04568"></a>04568         {
<a name="l04569"></a>04569           ++p1;
<a name="l04570"></a>04570           ts-&gt;<a class="code" href="structtrace__status.html#a114142bb0c3aa89b765bce9e26bd399c">notes</a> = <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (strlen (p) / 2);
<a name="l04571"></a>04571           end = <a class="code" href="remote_8c.html#aa9701b4d16cb5e4e31c5a952478edaae">hex2bin</a> (p1, (<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) ts-&gt;<a class="code" href="structtrace__status.html#a114142bb0c3aa89b765bce9e26bd399c">notes</a>, (p3 - p1) / 2);
<a name="l04572"></a>04572           ts-&gt;<a class="code" href="structtrace__status.html#a114142bb0c3aa89b765bce9e26bd399c">notes</a>[end] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l04573"></a>04573           p = p3;
<a name="l04574"></a>04574         }
<a name="l04575"></a>04575       <span class="keywordflow">else</span>
<a name="l04576"></a>04576         {
<a name="l04577"></a>04577           <span class="comment">/* Silently skip unknown optional info.  */</span>
<a name="l04578"></a>04578           p_temp = <a class="code" href="gdb__string_8h.html#adf46aa8f2e08cfb505868bbfc88b5fd4">strchr</a> (p1 + 1, <span class="charliteral">&#39;;&#39;</span>);
<a name="l04579"></a>04579           <span class="keywordflow">if</span> (p_temp)
<a name="l04580"></a>04580             p = p_temp;
<a name="l04581"></a>04581           <span class="keywordflow">else</span>
<a name="l04582"></a>04582             <span class="comment">/* Must be at the end.  */</span>
<a name="l04583"></a>04583             <span class="keywordflow">break</span>;
<a name="l04584"></a>04584         }
<a name="l04585"></a>04585     }
<a name="l04586"></a>04586 }
<a name="l04587"></a>04587 
<a name="l04588"></a>04588 <span class="keywordtype">void</span>
<a name="l04589"></a><a class="code" href="tracepoint_8h.html#ae2a8c5f50e21b1207f313f91436722b6">04589</a> <a class="code" href="tracepoint_8c.html#a9517820f5c212d17076d3db524c97392">parse_tracepoint_status</a> (<span class="keywordtype">char</span> *p, <span class="keyword">struct</span> <a class="code" href="structbreakpoint.html">breakpoint</a> *bp,
<a name="l04590"></a>04590                          <span class="keyword">struct</span> <a class="code" href="structuploaded__tp.html">uploaded_tp</a> *utp)
<a name="l04591"></a>04591 {
<a name="l04592"></a>04592   <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> uval;
<a name="l04593"></a>04593   <span class="keyword">struct </span><a class="code" href="structtracepoint.html">tracepoint</a> *tp = (<span class="keyword">struct </span><a class="code" href="structtracepoint.html">tracepoint</a> *) bp;
<a name="l04594"></a>04594 
<a name="l04595"></a>04595   p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (p, &amp;uval);
<a name="l04596"></a>04596   <span class="keywordflow">if</span> (tp)
<a name="l04597"></a>04597     tp-&gt;<a class="code" href="structtracepoint.html#a881af30b18b555e6ff11113da6b01a02">base</a>.<a class="code" href="structbreakpoint.html#a4431b9e9db0a123962a90e8a82419494">hit_count</a> += uval;
<a name="l04598"></a>04598   <span class="keywordflow">else</span>
<a name="l04599"></a>04599     utp-&gt;<a class="code" href="structuploaded__tp.html#af46a3f029b74faa22ce2a4760815edd7">hit_count</a> += uval;
<a name="l04600"></a>04600   p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (p + 1, &amp;uval);
<a name="l04601"></a>04601   <span class="keywordflow">if</span> (tp)
<a name="l04602"></a>04602     tp-&gt;<a class="code" href="structtracepoint.html#a37aed89a4e99207a4854199a834ca7d3">traceframe_usage</a> += uval;
<a name="l04603"></a>04603   <span class="keywordflow">else</span>
<a name="l04604"></a>04604     utp-&gt;<a class="code" href="structuploaded__tp.html#a719fe3ac2c13968739deef8283512665">traceframe_usage</a> += uval;
<a name="l04605"></a>04605   <span class="comment">/* Ignore any extra, allowing for future extensions.  */</span>
<a name="l04606"></a>04606 }
<a name="l04607"></a>04607 
<a name="l04608"></a>04608 <span class="comment">/* Given a line of text defining a part of a tracepoint, parse it into</span>
<a name="l04609"></a>04609 <span class="comment">   an &quot;uploaded tracepoint&quot;.  */</span>
<a name="l04610"></a>04610 
<a name="l04611"></a>04611 <span class="keywordtype">void</span>
<a name="l04612"></a><a class="code" href="tracepoint_8h.html#abb8ec4a188965aae1168a53566bb96ce">04612</a> <a class="code" href="tracepoint_8c.html#abb8ec4a188965aae1168a53566bb96ce">parse_tracepoint_definition</a> (<span class="keywordtype">char</span> *line, <span class="keyword">struct</span> <a class="code" href="structuploaded__tp.html">uploaded_tp</a> **utpp)
<a name="l04613"></a>04613 {
<a name="l04614"></a>04614   <span class="keywordtype">char</span> *p;
<a name="l04615"></a>04615   <span class="keywordtype">char</span> piece;
<a name="l04616"></a>04616   <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> num, addr, step, pass, orig_size, xlen, start;
<a name="l04617"></a>04617   <span class="keywordtype">int</span> enabled, end;
<a name="l04618"></a>04618   <span class="keyword">enum</span> <a class="code" href="breakpoint_8h.html#a67735d134567a4ba184d011f1db556cf">bptype</a> type;
<a name="l04619"></a>04619   <span class="keywordtype">char</span> *cond, *srctype, *buf;
<a name="l04620"></a>04620   <span class="keyword">struct </span><a class="code" href="structuploaded__tp.html">uploaded_tp</a> *utp = NULL;
<a name="l04621"></a>04621 
<a name="l04622"></a>04622   p = <a class="code" href="symtab_8h.html#a41ebd28ef1d7c6ade45642cb6acc1039">line</a>;
<a name="l04623"></a>04623   <span class="comment">/* Both tracepoint and action definitions start with the same number</span>
<a name="l04624"></a>04624 <span class="comment">     and address sequence.  */</span>
<a name="l04625"></a>04625   piece = *p++;
<a name="l04626"></a>04626   p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (p, &amp;num);
<a name="l04627"></a>04627   p++;  <span class="comment">/* skip a colon */</span>
<a name="l04628"></a>04628   p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (p, &amp;addr);
<a name="l04629"></a>04629   p++;  <span class="comment">/* skip a colon */</span>
<a name="l04630"></a>04630   <span class="keywordflow">if</span> (piece == <span class="charliteral">&#39;T&#39;</span>)
<a name="l04631"></a>04631     {
<a name="l04632"></a>04632       enabled = (*p++ == <span class="charliteral">&#39;E&#39;</span>);
<a name="l04633"></a>04633       p++;  <span class="comment">/* skip a colon */</span>
<a name="l04634"></a>04634       p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (p, &amp;step);
<a name="l04635"></a>04635       p++;  <span class="comment">/* skip a colon */</span>
<a name="l04636"></a>04636       p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (p, &amp;pass);
<a name="l04637"></a>04637       type = <a class="code" href="breakpoint_8h.html#a67735d134567a4ba184d011f1db556cfae87f3c5422e7ecec815f5cb7254b4b4c">bp_tracepoint</a>;
<a name="l04638"></a>04638       cond = NULL;
<a name="l04639"></a>04639       <span class="comment">/* Thumb through optional fields.  */</span>
<a name="l04640"></a>04640       <span class="keywordflow">while</span> (*p == <span class="charliteral">&#39;:&#39;</span>)
<a name="l04641"></a>04641         {
<a name="l04642"></a>04642           p++;  <span class="comment">/* skip a colon */</span>
<a name="l04643"></a>04643           <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;F&#39;</span>)
<a name="l04644"></a>04644             {
<a name="l04645"></a>04645               type = <a class="code" href="breakpoint_8h.html#a67735d134567a4ba184d011f1db556cfa563d27bd02a1303a86081828b40002db">bp_fast_tracepoint</a>;
<a name="l04646"></a>04646               p++;
<a name="l04647"></a>04647               p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (p, &amp;orig_size);
<a name="l04648"></a>04648             }
<a name="l04649"></a>04649           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;S&#39;</span>)
<a name="l04650"></a>04650             {
<a name="l04651"></a>04651               type = <a class="code" href="breakpoint_8h.html#a67735d134567a4ba184d011f1db556cfae4357544e8e764b68ef3729aa9ac2be3">bp_static_tracepoint</a>;
<a name="l04652"></a>04652               p++;
<a name="l04653"></a>04653             }
<a name="l04654"></a>04654           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;X&#39;</span>)
<a name="l04655"></a>04655             {
<a name="l04656"></a>04656               p++;
<a name="l04657"></a>04657               p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (p, &amp;xlen);
<a name="l04658"></a>04658               p++;  <span class="comment">/* skip a comma */</span>
<a name="l04659"></a>04659               cond = (<span class="keywordtype">char</span> *) <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (2 * xlen + 1);
<a name="l04660"></a>04660               strncpy (cond, p, 2 * xlen);
<a name="l04661"></a>04661               cond[2 * xlen] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l04662"></a>04662               p += 2 * xlen;
<a name="l04663"></a>04663             }
<a name="l04664"></a>04664           <span class="keywordflow">else</span>
<a name="l04665"></a>04665             <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Unrecognized char &#39;%c&#39; in tracepoint &quot;</span>
<a name="l04666"></a>04666                        <span class="stringliteral">&quot;definition, skipping rest&quot;</span>), *p);
<a name="l04667"></a>04667         }
<a name="l04668"></a>04668       utp = <a class="code" href="tracepoint_8c.html#acd9d80c3ddd5d5a6bdc5438aabf74fe7">get_uploaded_tp</a> (num, addr, utpp);
<a name="l04669"></a>04669       utp-&gt;<a class="code" href="structuploaded__tp.html#a3e983c135ec77bcb96798d08c683869d">type</a> = <a class="code" href="structuploaded__tp.html#a3e983c135ec77bcb96798d08c683869d">type</a>;
<a name="l04670"></a>04670       utp-&gt;<a class="code" href="structuploaded__tp.html#ac4180327fbf6bbbc002cbe17b8bde381">enabled</a> = <a class="code" href="structuploaded__tp.html#ac4180327fbf6bbbc002cbe17b8bde381">enabled</a>;
<a name="l04671"></a>04671       utp-&gt;<a class="code" href="structuploaded__tp.html#ae1b0283bc5b2a26b13fedcbe49680575">step</a> = <a class="code" href="structuploaded__tp.html#ae1b0283bc5b2a26b13fedcbe49680575">step</a>;
<a name="l04672"></a>04672       utp-&gt;<a class="code" href="structuploaded__tp.html#ac4636b0feec50663698467304285954d">pass</a> = <a class="code" href="structuploaded__tp.html#ac4636b0feec50663698467304285954d">pass</a>;
<a name="l04673"></a>04673       utp-&gt;<a class="code" href="structuploaded__tp.html#aa2faa5d0dcfadebb40ae25a72e3a6f37">cond</a> = <a class="code" href="structuploaded__tp.html#aa2faa5d0dcfadebb40ae25a72e3a6f37">cond</a>;
<a name="l04674"></a>04674     }
<a name="l04675"></a>04675   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (piece == <span class="charliteral">&#39;A&#39;</span>)
<a name="l04676"></a>04676     {
<a name="l04677"></a>04677       utp = <a class="code" href="tracepoint_8c.html#acd9d80c3ddd5d5a6bdc5438aabf74fe7">get_uploaded_tp</a> (num, addr, utpp);
<a name="l04678"></a>04678       <a class="code" href="vec_8h.html#a8d090c0524726d00931070e0c438ba3f">VEC_safe_push</a> (<a class="code" href="gdb__vecs_8h.html#a5ea7d3fefa2144d9bddaf2053c9691a1">char_ptr</a>, utp-&gt;actions, xstrdup (p));
<a name="l04679"></a>04679     }
<a name="l04680"></a>04680   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (piece == <span class="charliteral">&#39;S&#39;</span>)
<a name="l04681"></a>04681     {
<a name="l04682"></a>04682       utp = <a class="code" href="tracepoint_8c.html#acd9d80c3ddd5d5a6bdc5438aabf74fe7">get_uploaded_tp</a> (num, addr, utpp);
<a name="l04683"></a>04683       <a class="code" href="vec_8h.html#a8d090c0524726d00931070e0c438ba3f">VEC_safe_push</a> (<a class="code" href="gdb__vecs_8h.html#a5ea7d3fefa2144d9bddaf2053c9691a1">char_ptr</a>, utp-&gt;step_actions, xstrdup (p));
<a name="l04684"></a>04684     }
<a name="l04685"></a>04685   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (piece == <span class="charliteral">&#39;Z&#39;</span>)
<a name="l04686"></a>04686     {
<a name="l04687"></a>04687       <span class="comment">/* Parse a chunk of source form definition.  */</span>
<a name="l04688"></a>04688       utp = <a class="code" href="tracepoint_8c.html#acd9d80c3ddd5d5a6bdc5438aabf74fe7">get_uploaded_tp</a> (num, addr, utpp);
<a name="l04689"></a>04689       srctype = p;
<a name="l04690"></a>04690       p = <a class="code" href="gdb__string_8h.html#adf46aa8f2e08cfb505868bbfc88b5fd4">strchr</a> (p, <span class="charliteral">&#39;:&#39;</span>);
<a name="l04691"></a>04691       p++;  <span class="comment">/* skip a colon */</span>
<a name="l04692"></a>04692       p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (p, &amp;start);
<a name="l04693"></a>04693       p++;  <span class="comment">/* skip a colon */</span>
<a name="l04694"></a>04694       p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (p, &amp;xlen);
<a name="l04695"></a>04695       p++;  <span class="comment">/* skip a colon */</span>
<a name="l04696"></a>04696 
<a name="l04697"></a>04697       buf = alloca (strlen (line));
<a name="l04698"></a>04698 
<a name="l04699"></a>04699       end = <a class="code" href="remote_8c.html#aa9701b4d16cb5e4e31c5a952478edaae">hex2bin</a> (p, (<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) buf, strlen (p) / 2);
<a name="l04700"></a>04700       buf[end] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l04701"></a>04701 
<a name="l04702"></a>04702       <span class="keywordflow">if</span> (strncmp (srctype, <span class="stringliteral">&quot;at:&quot;</span>, strlen (<span class="stringliteral">&quot;at:&quot;</span>)) == 0)
<a name="l04703"></a>04703         utp-&gt;<a class="code" href="structuploaded__tp.html#abad64180bd34a5eef3c928e4909ce8b0">at_string</a> = xstrdup (buf);
<a name="l04704"></a>04704       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (srctype, <span class="stringliteral">&quot;cond:&quot;</span>, strlen (<span class="stringliteral">&quot;cond:&quot;</span>)) == 0)
<a name="l04705"></a>04705         utp-&gt;<a class="code" href="structuploaded__tp.html#a6413e606d74685de1dbe098ac06b8d26">cond_string</a> = xstrdup (buf);
<a name="l04706"></a>04706       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strncmp (srctype, <span class="stringliteral">&quot;cmd:&quot;</span>, strlen (<span class="stringliteral">&quot;cmd:&quot;</span>)) == 0)
<a name="l04707"></a>04707         <a class="code" href="vec_8h.html#a8d090c0524726d00931070e0c438ba3f">VEC_safe_push</a> (<a class="code" href="gdb__vecs_8h.html#a5ea7d3fefa2144d9bddaf2053c9691a1">char_ptr</a>, utp-&gt;cmd_strings, xstrdup (buf));
<a name="l04708"></a>04708     }
<a name="l04709"></a>04709   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (piece == <span class="charliteral">&#39;V&#39;</span>)
<a name="l04710"></a>04710     {
<a name="l04711"></a>04711       utp = <a class="code" href="tracepoint_8c.html#acd9d80c3ddd5d5a6bdc5438aabf74fe7">get_uploaded_tp</a> (num, addr, utpp);
<a name="l04712"></a>04712 
<a name="l04713"></a>04713       <a class="code" href="tracepoint_8c.html#a9517820f5c212d17076d3db524c97392">parse_tracepoint_status</a> (p, NULL, utp);
<a name="l04714"></a>04714     }
<a name="l04715"></a>04715   <span class="keywordflow">else</span>
<a name="l04716"></a>04716     {
<a name="l04717"></a>04717       <span class="comment">/* Don&#39;t error out, the target might be sending us optional</span>
<a name="l04718"></a>04718 <span class="comment">         info that we don&#39;t care about.  */</span>
<a name="l04719"></a>04719       <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Unrecognized tracepoint piece &#39;%c&#39;, ignoring&quot;</span>), piece);
<a name="l04720"></a>04720     }
<a name="l04721"></a>04721 }
<a name="l04722"></a>04722 
<a name="l04723"></a>04723 <span class="comment">/* Convert a textual description of a trace state variable into an</span>
<a name="l04724"></a>04724 <span class="comment">   uploaded object.  */</span>
<a name="l04725"></a>04725 
<a name="l04726"></a>04726 <span class="keywordtype">void</span>
<a name="l04727"></a><a class="code" href="tracepoint_8h.html#ad6098d89dba7c28fd6a898130e0f6aac">04727</a> <a class="code" href="tracepoint_8c.html#ad6098d89dba7c28fd6a898130e0f6aac">parse_tsv_definition</a> (<span class="keywordtype">char</span> *line, <span class="keyword">struct</span> <a class="code" href="structuploaded__tsv.html">uploaded_tsv</a> **utsvp)
<a name="l04728"></a>04728 {
<a name="l04729"></a>04729   <span class="keywordtype">char</span> *p, *buf;
<a name="l04730"></a>04730   <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> num, initval, builtin;
<a name="l04731"></a>04731   <span class="keywordtype">int</span> end;
<a name="l04732"></a>04732   <span class="keyword">struct </span><a class="code" href="structuploaded__tsv.html">uploaded_tsv</a> *utsv = NULL;
<a name="l04733"></a>04733 
<a name="l04734"></a>04734   buf = alloca (strlen (line));
<a name="l04735"></a>04735 
<a name="l04736"></a>04736   p = <a class="code" href="symtab_8h.html#a41ebd28ef1d7c6ade45642cb6acc1039">line</a>;
<a name="l04737"></a>04737   p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (p, &amp;num);
<a name="l04738"></a>04738   p++; <span class="comment">/* skip a colon */</span>
<a name="l04739"></a>04739   p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (p, &amp;initval);
<a name="l04740"></a>04740   p++; <span class="comment">/* skip a colon */</span>
<a name="l04741"></a>04741   p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (p, &amp;builtin);
<a name="l04742"></a>04742   p++; <span class="comment">/* skip a colon */</span>
<a name="l04743"></a>04743   end = <a class="code" href="remote_8c.html#aa9701b4d16cb5e4e31c5a952478edaae">hex2bin</a> (p, (<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) buf, strlen (p) / 2);
<a name="l04744"></a>04744   buf[end] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l04745"></a>04745 
<a name="l04746"></a>04746   utsv = <a class="code" href="tracepoint_8c.html#aa1d8f79579e195ebdd8f9151e584baff">get_uploaded_tsv</a> (num, utsvp);
<a name="l04747"></a>04747   utsv-&gt;<a class="code" href="structuploaded__tsv.html#a31a9a71e96aeb2239013d0ab0999f62c">initial_value</a> = initval;
<a name="l04748"></a>04748   utsv-&gt;<a class="code" href="structuploaded__tsv.html#ac461563a4d2d105c86bb3c3f9bee892c">builtin</a> = <a class="code" href="structuploaded__tsv.html#ac461563a4d2d105c86bb3c3f9bee892c">builtin</a>;
<a name="l04749"></a>04749   utsv-&gt;<a class="code" href="structuploaded__tsv.html#a13b1d8f75f005e4f82f4d26ed3bcef4f">name</a> = xstrdup (buf);
<a name="l04750"></a>04750 }
<a name="l04751"></a>04751 
<a name="l04752"></a>04752 <span class="comment">/* Close the trace file and generally clean up.  */</span>
<a name="l04753"></a>04753 
<a name="l04754"></a>04754 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l04755"></a>04755 tfile_close (<span class="keywordtype">void</span>)
<a name="l04756"></a>04756 {
<a name="l04757"></a>04757   <span class="keywordtype">int</span> pid;
<a name="l04758"></a>04758 
<a name="l04759"></a>04759   <span class="keywordflow">if</span> (trace_fd &lt; 0)
<a name="l04760"></a>04760     <span class="keywordflow">return</span>;
<a name="l04761"></a>04761 
<a name="l04762"></a>04762   close (trace_fd);
<a name="l04763"></a>04763   trace_fd = -1;
<a name="l04764"></a>04764   <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (trace_filename);
<a name="l04765"></a>04765   trace_filename = NULL;
<a name="l04766"></a>04766 
<a name="l04767"></a>04767   <a class="code" href="tracepoint_8c.html#a8ab20f1eb477238f562e37831e9f6038">trace_reset_local_state</a> ();
<a name="l04768"></a>04768 }
<a name="l04769"></a>04769 
<a name="l04770"></a>04770 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l04771"></a>04771 tfile_files_info (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *t)
<a name="l04772"></a>04772 {
<a name="l04773"></a>04773   <a class="code" href="utils_8c.html#a8a83ee04701e157bf53e23d8682874e8">printf_filtered</a> (<span class="stringliteral">&quot;\t`%s&#39;\n&quot;</span>, trace_filename);
<a name="l04774"></a>04774 }
<a name="l04775"></a>04775 
<a name="l04776"></a>04776 <span class="comment">/* The trace status for a file is that tracing can never be run.  */</span>
<a name="l04777"></a>04777 
<a name="l04778"></a>04778 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l04779"></a>04779 tfile_get_trace_status (<span class="keyword">struct</span> <a class="code" href="structtrace__status.html">trace_status</a> *ts)
<a name="l04780"></a>04780 {
<a name="l04781"></a>04781   <span class="comment">/* Other bits of trace status were collected as part of opening the</span>
<a name="l04782"></a>04782 <span class="comment">     trace files, so nothing to do here.  */</span>
<a name="l04783"></a>04783 
<a name="l04784"></a>04784   <span class="keywordflow">return</span> -1;
<a name="l04785"></a>04785 }
<a name="l04786"></a>04786 
<a name="l04787"></a>04787 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l04788"></a>04788 tfile_get_tracepoint_status (<span class="keyword">struct</span> <a class="code" href="structbreakpoint.html">breakpoint</a> *tp, <span class="keyword">struct</span> <a class="code" href="structuploaded__tp.html">uploaded_tp</a> *utp)
<a name="l04789"></a>04789 {
<a name="l04790"></a>04790   <span class="comment">/* Other bits of trace status were collected as part of opening the</span>
<a name="l04791"></a>04791 <span class="comment">     trace files, so nothing to do here.  */</span>
<a name="l04792"></a>04792 }
<a name="l04793"></a>04793 
<a name="l04794"></a>04794 <span class="comment">/* Given the position of a traceframe in the file, figure out what</span>
<a name="l04795"></a>04795 <span class="comment">   address the frame was collected at.  This would normally be the</span>
<a name="l04796"></a>04796 <span class="comment">   value of a collected PC register, but if not available, we</span>
<a name="l04797"></a>04797 <span class="comment">   improvise.  */</span>
<a name="l04798"></a>04798 
<a name="l04799"></a>04799 <span class="keyword">static</span> <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a>
<a name="l04800"></a>04800 tfile_get_traceframe_address (off_t tframe_offset)
<a name="l04801"></a>04801 {
<a name="l04802"></a>04802   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> addr = 0;
<a name="l04803"></a>04803   <span class="keywordtype">short</span> tpnum;
<a name="l04804"></a>04804   <span class="keyword">struct </span><a class="code" href="structtracepoint.html">tracepoint</a> *tp;
<a name="l04805"></a>04805   off_t saved_offset = cur_offset;
<a name="l04806"></a>04806 
<a name="l04807"></a>04807   <span class="comment">/* FIXME dig pc out of collected registers.  */</span>
<a name="l04808"></a>04808 
<a name="l04809"></a>04809   <span class="comment">/* Fall back to using tracepoint address.  */</span>
<a name="l04810"></a>04810   lseek (trace_fd, tframe_offset, SEEK_SET);
<a name="l04811"></a>04811   tfile_read ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) &amp;tpnum, 2);
<a name="l04812"></a>04812   tpnum = (short) <a class="code" href="defs_8h.html#afae519602ea9737f24bfa0e24b507faf">extract_signed_integer</a> ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) &amp;tpnum, 2,
<a name="l04813"></a>04813                                           <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a>
<a name="l04814"></a>04814                                               (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ()));
<a name="l04815"></a>04815 
<a name="l04816"></a>04816   tp = <a class="code" href="breakpoint_8c.html#ac6160629aa4fcd8afc53503d861f7f90">get_tracepoint_by_number_on_target</a> (tpnum);
<a name="l04817"></a>04817   <span class="comment">/* FIXME this is a poor heuristic if multiple locations.  */</span>
<a name="l04818"></a>04818   <span class="keywordflow">if</span> (tp &amp;&amp; tp-&gt;<a class="code" href="structtracepoint.html#a881af30b18b555e6ff11113da6b01a02">base</a>.<a class="code" href="structbreakpoint.html#aa869260f7e4c94204275861d820bb1a9">loc</a>)
<a name="l04819"></a>04819     addr = tp-&gt;<a class="code" href="structtracepoint.html#a881af30b18b555e6ff11113da6b01a02">base</a>.<a class="code" href="structbreakpoint.html#aa869260f7e4c94204275861d820bb1a9">loc</a>-&gt;<a class="code" href="structbp__location.html#a6b6cd8b8a488e632200f323309d23823">address</a>;
<a name="l04820"></a>04820 
<a name="l04821"></a>04821   <span class="comment">/* Restore our seek position.  */</span>
<a name="l04822"></a>04822   cur_offset = saved_offset;
<a name="l04823"></a>04823   lseek (trace_fd, cur_offset, SEEK_SET);
<a name="l04824"></a>04824   <span class="keywordflow">return</span> addr;
<a name="l04825"></a>04825 }
<a name="l04826"></a>04826 
<a name="l04827"></a>04827 <span class="comment">/* Given a type of search and some parameters, scan the collection of</span>
<a name="l04828"></a>04828 <span class="comment">   traceframes in the file looking for a match.  When found, return</span>
<a name="l04829"></a>04829 <span class="comment">   both the traceframe and tracepoint number, otherwise -1 for</span>
<a name="l04830"></a>04830 <span class="comment">   each.  */</span>
<a name="l04831"></a>04831 
<a name="l04832"></a>04832 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l04833"></a>04833 tfile_trace_find (<span class="keyword">enum</span> <a class="code" href="target_8h.html#a78f5afcdc128cdd336383668a0f296d7">trace_find_type</a> type, <span class="keywordtype">int</span> num,
<a name="l04834"></a>04834                   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> addr1, <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> addr2, <span class="keywordtype">int</span> *tpp)
<a name="l04835"></a>04835 {
<a name="l04836"></a>04836   <span class="keywordtype">short</span> tpnum;
<a name="l04837"></a>04837   <span class="keywordtype">int</span> tfnum = 0, found = 0;
<a name="l04838"></a>04838   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> data_size;
<a name="l04839"></a>04839   <span class="keyword">struct </span><a class="code" href="structtracepoint.html">tracepoint</a> *tp;
<a name="l04840"></a>04840   off_t <a class="code" href="common_2agent_8c.html#aed7ea92f45bd273dde380a45ddced592">offset</a>, tframe_offset;
<a name="l04841"></a>04841   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> tfaddr;
<a name="l04842"></a>04842 
<a name="l04843"></a>04843   <span class="keywordflow">if</span> (num == -1)
<a name="l04844"></a>04844     {
<a name="l04845"></a>04845       <span class="keywordflow">if</span> (tpp)
<a name="l04846"></a>04846         *tpp = -1;
<a name="l04847"></a>04847       <span class="keywordflow">return</span> -1;
<a name="l04848"></a>04848     }
<a name="l04849"></a>04849 
<a name="l04850"></a>04850   lseek (trace_fd, trace_frames_offset, SEEK_SET);
<a name="l04851"></a>04851   offset = trace_frames_offset;
<a name="l04852"></a>04852   <span class="keywordflow">while</span> (1)
<a name="l04853"></a>04853     {
<a name="l04854"></a>04854       tframe_offset = <a class="code" href="common_2agent_8c.html#aed7ea92f45bd273dde380a45ddced592">offset</a>;
<a name="l04855"></a>04855       tfile_read ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) &amp;tpnum, 2);
<a name="l04856"></a>04856       tpnum = (short) <a class="code" href="defs_8h.html#afae519602ea9737f24bfa0e24b507faf">extract_signed_integer</a> ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) &amp;tpnum, 2,
<a name="l04857"></a>04857                                               <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a>
<a name="l04858"></a>04858                                                   (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ()));
<a name="l04859"></a>04859       offset += 2;
<a name="l04860"></a>04860       <span class="keywordflow">if</span> (tpnum == 0)
<a name="l04861"></a>04861         <span class="keywordflow">break</span>;
<a name="l04862"></a>04862       tfile_read ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) &amp;data_size, 4);
<a name="l04863"></a>04863       data_size = (<span class="keywordtype">unsigned</span> <a class="code" href="command_8h.html#a74f207b5aa4ba51c3a2ad59b219a423b">int</a>) <a class="code" href="defs_8h.html#a99aec65329508b4d449a4f881026f844">extract_unsigned_integer</a>
<a name="l04864"></a>04864                                      ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) &amp;data_size, 4,
<a name="l04865"></a>04865                                       <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ()));
<a name="l04866"></a>04866       offset += 4;
<a name="l04867"></a>04867 
<a name="l04868"></a>04868       <span class="keywordflow">if</span> (type == <a class="code" href="target_8h.html#a78f5afcdc128cdd336383668a0f296d7a6c059c3daad01c8165dc1a73498408e7">tfind_number</a>)
<a name="l04869"></a>04869         {
<a name="l04870"></a>04870           <span class="comment">/* Looking for a specific trace frame.  */</span>
<a name="l04871"></a>04871           <span class="keywordflow">if</span> (tfnum == num)
<a name="l04872"></a>04872             found = 1;
<a name="l04873"></a>04873         }
<a name="l04874"></a>04874       <span class="keywordflow">else</span>
<a name="l04875"></a>04875         {
<a name="l04876"></a>04876           <span class="comment">/* Start from the _next_ trace frame.  */</span>
<a name="l04877"></a>04877           <span class="keywordflow">if</span> (tfnum &gt; traceframe_number)
<a name="l04878"></a>04878             {
<a name="l04879"></a>04879               <span class="keywordflow">switch</span> (type)
<a name="l04880"></a>04880                 {
<a name="l04881"></a>04881                 <span class="keywordflow">case</span> <a class="code" href="target_8h.html#a78f5afcdc128cdd336383668a0f296d7a4bb077c323c7395699b412e2c73b9855">tfind_pc</a>:
<a name="l04882"></a>04882                   tfaddr = tfile_get_traceframe_address (tframe_offset);
<a name="l04883"></a>04883                   <span class="keywordflow">if</span> (tfaddr == addr1)
<a name="l04884"></a>04884                     found = 1;
<a name="l04885"></a>04885                   <span class="keywordflow">break</span>;
<a name="l04886"></a>04886                 <span class="keywordflow">case</span> <a class="code" href="target_8h.html#a78f5afcdc128cdd336383668a0f296d7adec7c45210c9adaf5b4bff37cf713de2">tfind_tp</a>:
<a name="l04887"></a>04887                   tp = <a class="code" href="breakpoint_8c.html#a8a2d0403a74a7a2edf8131dc2462df62">get_tracepoint</a> (num);
<a name="l04888"></a>04888                   <span class="keywordflow">if</span> (tp &amp;&amp; tpnum == tp-&gt;<a class="code" href="structtracepoint.html#a32f485dd859434fab98013e1738187d7">number_on_target</a>)
<a name="l04889"></a>04889                     found = 1;
<a name="l04890"></a>04890                   <span class="keywordflow">break</span>;
<a name="l04891"></a>04891                 <span class="keywordflow">case</span> <a class="code" href="target_8h.html#a78f5afcdc128cdd336383668a0f296d7a8bb5fb54065004f1abad4a8278288c6d">tfind_range</a>:
<a name="l04892"></a>04892                   tfaddr = tfile_get_traceframe_address (tframe_offset);
<a name="l04893"></a>04893                   <span class="keywordflow">if</span> (addr1 &lt;= tfaddr &amp;&amp; tfaddr &lt;= addr2)
<a name="l04894"></a>04894                     found = 1;
<a name="l04895"></a>04895                   <span class="keywordflow">break</span>;
<a name="l04896"></a>04896                 <span class="keywordflow">case</span> <a class="code" href="target_8h.html#a78f5afcdc128cdd336383668a0f296d7a173984a815b231ae8aff2e0d5c3374d2">tfind_outside</a>:
<a name="l04897"></a>04897                   tfaddr = tfile_get_traceframe_address (tframe_offset);
<a name="l04898"></a>04898                   <span class="keywordflow">if</span> (!(addr1 &lt;= tfaddr &amp;&amp; tfaddr &lt;= addr2))
<a name="l04899"></a>04899                     found = 1;
<a name="l04900"></a>04900                   <span class="keywordflow">break</span>;
<a name="l04901"></a>04901                 <span class="keywordflow">default</span>:
<a name="l04902"></a>04902                   <a class="code" href="common-utils_8h.html#aa14285d9d3d4171016ef9cf09447e8bb">internal_error</a> (__FILE__, __LINE__, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;unknown tfind type&quot;</span>));
<a name="l04903"></a>04903                 }
<a name="l04904"></a>04904             }
<a name="l04905"></a>04905         }
<a name="l04906"></a>04906 
<a name="l04907"></a>04907       <span class="keywordflow">if</span> (found)
<a name="l04908"></a>04908         {
<a name="l04909"></a>04909           <span class="keywordflow">if</span> (tpp)
<a name="l04910"></a>04910             *tpp = tpnum;
<a name="l04911"></a>04911           cur_offset = <a class="code" href="common_2agent_8c.html#aed7ea92f45bd273dde380a45ddced592">offset</a>;
<a name="l04912"></a>04912           cur_data_size = data_size;
<a name="l04913"></a>04913 
<a name="l04914"></a>04914           <span class="keywordflow">return</span> tfnum;
<a name="l04915"></a>04915         }
<a name="l04916"></a>04916       <span class="comment">/* Skip past the traceframe&#39;s data.  */</span>
<a name="l04917"></a>04917       lseek (trace_fd, data_size, SEEK_CUR);
<a name="l04918"></a>04918       offset += data_size;
<a name="l04919"></a>04919       <span class="comment">/* Update our own count of traceframes.  */</span>
<a name="l04920"></a>04920       ++tfnum;
<a name="l04921"></a>04921     }
<a name="l04922"></a>04922   <span class="comment">/* Did not find what we were looking for.  */</span>
<a name="l04923"></a>04923   <span class="keywordflow">if</span> (tpp)
<a name="l04924"></a>04924     *tpp = -1;
<a name="l04925"></a>04925   <span class="keywordflow">return</span> -1;
<a name="l04926"></a>04926 }
<a name="l04927"></a>04927 
<a name="l04928"></a>04928 <span class="comment">/* Prototype of the callback passed to tframe_walk_blocks.  */</span>
<a name="l04929"></a><a class="code" href="tracepoint_8c.html#af3dd983fad19ff13f9cd41fa23f73654">04929</a> <span class="keyword">typedef</span> <a class="code" href="command_8h.html#a74f207b5aa4ba51c3a2ad59b219a423b">int</a> (*<a class="code" href="tracepoint_8c.html#af3dd983fad19ff13f9cd41fa23f73654">walk_blocks_callback_func</a>) (<span class="keywordtype">char</span> blocktype, <span class="keywordtype">void</span> *data);
<a name="l04930"></a>04930 
<a name="l04931"></a>04931 <span class="comment">/* Callback for traceframe_walk_blocks, used to find a given block</span>
<a name="l04932"></a>04932 <span class="comment">   type in a traceframe.  */</span>
<a name="l04933"></a>04933 
<a name="l04934"></a>04934 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l04935"></a>04935 match_blocktype (<span class="keywordtype">char</span> blocktype, <span class="keywordtype">void</span> *data)
<a name="l04936"></a>04936 {
<a name="l04937"></a>04937   <span class="keywordtype">char</span> *wantedp = data;
<a name="l04938"></a>04938 
<a name="l04939"></a>04939   <span class="keywordflow">if</span> (*wantedp == blocktype)
<a name="l04940"></a>04940     <span class="keywordflow">return</span> 1;
<a name="l04941"></a>04941 
<a name="l04942"></a>04942   <span class="keywordflow">return</span> 0;
<a name="l04943"></a>04943 }
<a name="l04944"></a>04944 
<a name="l04945"></a>04945 <span class="comment">/* Walk over all traceframe block starting at POS offset from</span>
<a name="l04946"></a>04946 <span class="comment">   CUR_OFFSET, and call CALLBACK for each block found, passing in DATA</span>
<a name="l04947"></a>04947 <span class="comment">   unmodified.  If CALLBACK returns true, this returns the position in</span>
<a name="l04948"></a>04948 <span class="comment">   the traceframe where the block is found, relative to the start of</span>
<a name="l04949"></a>04949 <span class="comment">   the traceframe (cur_offset).  Returns -1 if no callback call</span>
<a name="l04950"></a>04950 <span class="comment">   returned true, indicating that all blocks have been walked.  */</span>
<a name="l04951"></a>04951 
<a name="l04952"></a>04952 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l04953"></a>04953 traceframe_walk_blocks (<a class="code" href="tracepoint_8c.html#af3dd983fad19ff13f9cd41fa23f73654">walk_blocks_callback_func</a> callback,
<a name="l04954"></a>04954                         <span class="keywordtype">int</span> pos, <span class="keywordtype">void</span> *data)
<a name="l04955"></a>04955 {
<a name="l04956"></a>04956   <span class="comment">/* Iterate through a traceframe&#39;s blocks, looking for a block of the</span>
<a name="l04957"></a>04957 <span class="comment">     requested type.  */</span>
<a name="l04958"></a>04958 
<a name="l04959"></a>04959   lseek (trace_fd, cur_offset + pos, SEEK_SET);
<a name="l04960"></a>04960   <span class="keywordflow">while</span> (pos &lt; cur_data_size)
<a name="l04961"></a>04961     {
<a name="l04962"></a>04962       <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> mlen;
<a name="l04963"></a>04963       <span class="keywordtype">char</span> <a class="code" href="mdebugread_8c.html#aa2494894aca52a71313c23c460fe0443">block_type</a>;
<a name="l04964"></a>04964 
<a name="l04965"></a>04965       tfile_read ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) &amp;block_type, 1);
<a name="l04966"></a>04966 
<a name="l04967"></a>04967       ++pos;
<a name="l04968"></a>04968 
<a name="l04969"></a>04969       <span class="keywordflow">if</span> ((*callback) (block_type, data))
<a name="l04970"></a>04970         <span class="keywordflow">return</span> pos;
<a name="l04971"></a>04971 
<a name="l04972"></a>04972       <span class="keywordflow">switch</span> (block_type)
<a name="l04973"></a>04973         {
<a name="l04974"></a>04974         <span class="keywordflow">case</span> <span class="charliteral">&#39;R&#39;</span>:
<a name="l04975"></a>04975           lseek (trace_fd, cur_offset + pos + trace_regblock_size, SEEK_SET);
<a name="l04976"></a>04976           pos += <a class="code" href="tracepoint_8c.html#a5dc5a6689e0bd3501fe98c5e89858e7c">trace_regblock_size</a>;
<a name="l04977"></a>04977           <span class="keywordflow">break</span>;
<a name="l04978"></a>04978         <span class="keywordflow">case</span> <span class="charliteral">&#39;M&#39;</span>:
<a name="l04979"></a>04979           lseek (trace_fd, cur_offset + pos + 8, SEEK_SET);
<a name="l04980"></a>04980           tfile_read ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) &amp;mlen, 2);
<a name="l04981"></a>04981           mlen = (<span class="keywordtype">unsigned</span> short)
<a name="l04982"></a>04982                 <a class="code" href="defs_8h.html#a99aec65329508b4d449a4f881026f844">extract_unsigned_integer</a> ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) &amp;mlen, 2,
<a name="l04983"></a>04983                                           <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a>
<a name="l04984"></a>04984                                               (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ()));
<a name="l04985"></a>04985           lseek (trace_fd, mlen, SEEK_CUR);
<a name="l04986"></a>04986           pos += (8 + 2 + mlen);
<a name="l04987"></a>04987           <span class="keywordflow">break</span>;
<a name="l04988"></a>04988         <span class="keywordflow">case</span> <span class="charliteral">&#39;V&#39;</span>:
<a name="l04989"></a>04989           lseek (trace_fd, cur_offset + pos + 4 + 8, SEEK_SET);
<a name="l04990"></a>04990           pos += (4 + 8);
<a name="l04991"></a>04991           <span class="keywordflow">break</span>;
<a name="l04992"></a>04992         <span class="keywordflow">default</span>:
<a name="l04993"></a>04993           <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Unknown block type &#39;%c&#39; (0x%x) in trace frame&quot;</span>),
<a name="l04994"></a>04994                  block_type, block_type);
<a name="l04995"></a>04995           <span class="keywordflow">break</span>;
<a name="l04996"></a>04996         }
<a name="l04997"></a>04997     }
<a name="l04998"></a>04998 
<a name="l04999"></a>04999   <span class="keywordflow">return</span> -1;
<a name="l05000"></a>05000 }
<a name="l05001"></a>05001 
<a name="l05002"></a>05002 <span class="comment">/* Convenience wrapper around traceframe_walk_blocks.  Looks for the</span>
<a name="l05003"></a>05003 <span class="comment">   position offset of a block of type TYPE_WANTED in the current trace</span>
<a name="l05004"></a>05004 <span class="comment">   frame, starting at POS.  Returns -1 if no such block was found.  */</span>
<a name="l05005"></a>05005 
<a name="l05006"></a>05006 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l05007"></a>05007 traceframe_find_block_type (<span class="keywordtype">char</span> type_wanted, <span class="keywordtype">int</span> pos)
<a name="l05008"></a>05008 {
<a name="l05009"></a>05009   <span class="keywordflow">return</span> traceframe_walk_blocks (match_blocktype, pos, &amp;type_wanted);
<a name="l05010"></a>05010 }
<a name="l05011"></a>05011 
<a name="l05012"></a>05012 <span class="comment">/* Look for a block of saved registers in the traceframe, and get the</span>
<a name="l05013"></a>05013 <span class="comment">   requested register from it.  */</span>
<a name="l05014"></a>05014 
<a name="l05015"></a>05015 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l05016"></a>05016 tfile_fetch_registers (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *ops,
<a name="l05017"></a>05017                        <span class="keyword">struct</span> regcache *regcache, <span class="keywordtype">int</span> regno)
<a name="l05018"></a>05018 {
<a name="l05019"></a>05019   <span class="keyword">struct </span>gdbarch *gdbarch = <a class="code" href="regcache_8c.html#ad4f6d0cdf256b1fa45d59a6d71b50659">get_regcache_arch</a> (regcache);
<a name="l05020"></a>05020   <span class="keywordtype">int</span> <a class="code" href="common_2agent_8c.html#aed7ea92f45bd273dde380a45ddced592">offset</a>, regn, regsize, pc_regno;
<a name="l05021"></a>05021   <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *regs;
<a name="l05022"></a>05022 
<a name="l05023"></a>05023   <span class="comment">/* An uninitialized reg size says we&#39;re not going to be</span>
<a name="l05024"></a>05024 <span class="comment">     successful at getting register blocks.  */</span>
<a name="l05025"></a>05025   <span class="keywordflow">if</span> (!trace_regblock_size)
<a name="l05026"></a>05026     <span class="keywordflow">return</span>;
<a name="l05027"></a>05027 
<a name="l05028"></a>05028   regs = alloca (trace_regblock_size);
<a name="l05029"></a>05029 
<a name="l05030"></a>05030   <span class="keywordflow">if</span> (traceframe_find_block_type (<span class="charliteral">&#39;R&#39;</span>, 0) &gt;= 0)
<a name="l05031"></a>05031     {
<a name="l05032"></a>05032       tfile_read (regs, trace_regblock_size);
<a name="l05033"></a>05033 
<a name="l05034"></a>05034       <span class="comment">/* Assume the block is laid out in GDB register number order,</span>
<a name="l05035"></a>05035 <span class="comment">         each register with the size that it has in GDB.  */</span>
<a name="l05036"></a>05036       offset = 0;
<a name="l05037"></a>05037       <span class="keywordflow">for</span> (regn = 0; regn &lt; <a class="code" href="gdbarch_8c.html#a69069435754d0b434c7043a21d247325">gdbarch_num_regs</a> (gdbarch); regn++)
<a name="l05038"></a>05038         {
<a name="l05039"></a>05039           regsize = <a class="code" href="regcache_8c.html#a4c51fa25edb9ce25451b9dc7bd127aac">register_size</a> (gdbarch, regn);
<a name="l05040"></a>05040           <span class="comment">/* Make sure we stay within block bounds.  */</span>
<a name="l05041"></a>05041           <span class="keywordflow">if</span> (offset + regsize &gt;= trace_regblock_size)
<a name="l05042"></a>05042             <span class="keywordflow">break</span>;
<a name="l05043"></a>05043           <span class="keywordflow">if</span> (<a class="code" href="regcache_8c.html#a92715226424ce71c1a85e32bf3d39a37">regcache_register_status</a> (regcache, regn) == <a class="code" href="regcache_8h.html#af900cc04e1a55ea5ae1edc80570f91f7ab92967949885504141f1f69efc986fb2">REG_UNKNOWN</a>)
<a name="l05044"></a>05044             {
<a name="l05045"></a>05045               <span class="keywordflow">if</span> (regno == regn)
<a name="l05046"></a>05046                 {
<a name="l05047"></a>05047                   <a class="code" href="regcache_8c.html#a127ceeb6f30d3bab748c60570ac077a6">regcache_raw_supply</a> (regcache, regno, regs + offset);
<a name="l05048"></a>05048                   <span class="keywordflow">break</span>;
<a name="l05049"></a>05049                 }
<a name="l05050"></a>05050               <span class="keywordflow">else</span> <span class="keywordflow">if</span> (regno == -1)
<a name="l05051"></a>05051                 {
<a name="l05052"></a>05052                   <a class="code" href="regcache_8c.html#a127ceeb6f30d3bab748c60570ac077a6">regcache_raw_supply</a> (regcache, regn, regs + offset);
<a name="l05053"></a>05053                 }
<a name="l05054"></a>05054             }
<a name="l05055"></a>05055           offset += regsize;
<a name="l05056"></a>05056         }
<a name="l05057"></a>05057       <span class="keywordflow">return</span>;
<a name="l05058"></a>05058     }
<a name="l05059"></a>05059 
<a name="l05060"></a>05060   <span class="comment">/* We get here if no register data has been found.  Mark registers</span>
<a name="l05061"></a>05061 <span class="comment">     as unavailable.  */</span>
<a name="l05062"></a>05062   <span class="keywordflow">for</span> (regn = 0; regn &lt; <a class="code" href="gdbarch_8c.html#a69069435754d0b434c7043a21d247325">gdbarch_num_regs</a> (gdbarch); regn++)
<a name="l05063"></a>05063     <a class="code" href="regcache_8c.html#a127ceeb6f30d3bab748c60570ac077a6">regcache_raw_supply</a> (regcache, regn, NULL);
<a name="l05064"></a>05064 
<a name="l05065"></a>05065   <span class="comment">/* We can often usefully guess that the PC is going to be the same</span>
<a name="l05066"></a>05066 <span class="comment">     as the address of the tracepoint.  */</span>
<a name="l05067"></a>05067   pc_regno = <a class="code" href="gdbarch_8c.html#a07a162ebafea1269eb8f341db44e53e7">gdbarch_pc_regnum</a> (gdbarch);
<a name="l05068"></a>05068   <span class="keywordflow">if</span> (pc_regno &gt;= 0 &amp;&amp; (regno == -1 || regno == pc_regno))
<a name="l05069"></a>05069     {
<a name="l05070"></a>05070       <span class="keyword">struct </span><a class="code" href="structtracepoint.html">tracepoint</a> *tp = <a class="code" href="breakpoint_8c.html#a8a2d0403a74a7a2edf8131dc2462df62">get_tracepoint</a> (tracepoint_number);
<a name="l05071"></a>05071 
<a name="l05072"></a>05072       <span class="keywordflow">if</span> (tp &amp;&amp; tp-&gt;<a class="code" href="structtracepoint.html#a881af30b18b555e6ff11113da6b01a02">base</a>.<a class="code" href="structbreakpoint.html#aa869260f7e4c94204275861d820bb1a9">loc</a>)
<a name="l05073"></a>05073         {
<a name="l05074"></a>05074           <span class="comment">/* But don&#39;t try to guess if tracepoint is multi-location...  */</span>
<a name="l05075"></a>05075           <span class="keywordflow">if</span> (tp-&gt;<a class="code" href="structtracepoint.html#a881af30b18b555e6ff11113da6b01a02">base</a>.<a class="code" href="structbreakpoint.html#aa869260f7e4c94204275861d820bb1a9">loc</a>-&gt;<a class="code" href="structbp__location.html#ab193cb38f87fea89105db96d94191541">next</a>)
<a name="l05076"></a>05076             {
<a name="l05077"></a>05077               <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Tracepoint %d has multiple &quot;</span>
<a name="l05078"></a>05078                          <span class="stringliteral">&quot;locations, cannot infer $pc&quot;</span>),
<a name="l05079"></a>05079                        tp-&gt;<a class="code" href="structtracepoint.html#a881af30b18b555e6ff11113da6b01a02">base</a>.<a class="code" href="structbreakpoint.html#aa46a2ab4a5f2ae1e42412c412997871b">number</a>);
<a name="l05080"></a>05080               <span class="keywordflow">return</span>;
<a name="l05081"></a>05081             }
<a name="l05082"></a>05082           <span class="comment">/* ... or does while-stepping.  */</span>
<a name="l05083"></a>05083           <span class="keywordflow">if</span> (tp-&gt;<a class="code" href="structtracepoint.html#a23f952627bff1b293662478997684f30">step_count</a> &gt; 0)
<a name="l05084"></a>05084             {
<a name="l05085"></a>05085               <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Tracepoint %d does while-stepping, &quot;</span>
<a name="l05086"></a>05086                          <span class="stringliteral">&quot;cannot infer $pc&quot;</span>),
<a name="l05087"></a>05087                        tp-&gt;<a class="code" href="structtracepoint.html#a881af30b18b555e6ff11113da6b01a02">base</a>.<a class="code" href="structbreakpoint.html#aa46a2ab4a5f2ae1e42412c412997871b">number</a>);
<a name="l05088"></a>05088               <span class="keywordflow">return</span>;
<a name="l05089"></a>05089             }
<a name="l05090"></a>05090 
<a name="l05091"></a>05091           <a class="code" href="defs_8h.html#ad11c013c83c64d9d0ee2e4bdeb1fb62d">store_unsigned_integer</a> (regs, <a class="code" href="regcache_8c.html#a4c51fa25edb9ce25451b9dc7bd127aac">register_size</a> (gdbarch, pc_regno),
<a name="l05092"></a>05092                                   <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (gdbarch),
<a name="l05093"></a>05093                                   tp-&gt;<a class="code" href="structtracepoint.html#a881af30b18b555e6ff11113da6b01a02">base</a>.<a class="code" href="structbreakpoint.html#aa869260f7e4c94204275861d820bb1a9">loc</a>-&gt;<a class="code" href="structbp__location.html#a6b6cd8b8a488e632200f323309d23823">address</a>);
<a name="l05094"></a>05094           <a class="code" href="regcache_8c.html#a127ceeb6f30d3bab748c60570ac077a6">regcache_raw_supply</a> (regcache, pc_regno, regs);
<a name="l05095"></a>05095         }
<a name="l05096"></a>05096     }
<a name="l05097"></a>05097 }
<a name="l05098"></a>05098 
<a name="l05099"></a>05099 <span class="keyword">static</span> <a class="code" href="defs_8h.html#ac7647a3f71533007c9e128f3ddda1987">LONGEST</a>
<a name="l05100"></a>05100 tfile_xfer_partial (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *ops, <span class="keyword">enum</span> <a class="code" href="target_8h.html#aa5a3e4ceb377c9f5822cdc68c6f138e2">target_object</a> <span class="keywordtype">object</span>,
<a name="l05101"></a>05101                     <span class="keyword">const</span> <span class="keywordtype">char</span> *annex, <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *readbuf,
<a name="l05102"></a>05102                     <span class="keyword">const</span> <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *writebuf, <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> offset, <a class="code" href="defs_8h.html#ac7647a3f71533007c9e128f3ddda1987">LONGEST</a> len)
<a name="l05103"></a>05103 {
<a name="l05104"></a>05104   <span class="comment">/* We&#39;re only doing regular memory for now.  */</span>
<a name="l05105"></a>05105   <span class="keywordflow">if</span> (<span class="keywordtype">object</span> != <a class="code" href="target_8h.html#aa5a3e4ceb377c9f5822cdc68c6f138e2a8d0adeab7f35c7245692a63b5a2a9f3a">TARGET_OBJECT_MEMORY</a>)
<a name="l05106"></a>05106     <span class="keywordflow">return</span> -1;
<a name="l05107"></a>05107 
<a name="l05108"></a>05108   <span class="keywordflow">if</span> (readbuf == NULL)
<a name="l05109"></a>05109     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;tfile_xfer_partial: trace file is read-only&quot;</span>));
<a name="l05110"></a>05110 
<a name="l05111"></a>05111  <span class="keywordflow">if</span> (traceframe_number != -1)
<a name="l05112"></a>05112     {
<a name="l05113"></a>05113       <span class="keywordtype">int</span> pos = 0;
<a name="l05114"></a>05114 
<a name="l05115"></a>05115       <span class="comment">/* Iterate through the traceframe&#39;s blocks, looking for</span>
<a name="l05116"></a>05116 <span class="comment">         memory.  */</span>
<a name="l05117"></a>05117       <span class="keywordflow">while</span> ((pos = traceframe_find_block_type (<span class="charliteral">&#39;M&#39;</span>, pos)) &gt;= 0)
<a name="l05118"></a>05118         {
<a name="l05119"></a>05119           <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> maddr, amt;
<a name="l05120"></a>05120           <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> mlen;
<a name="l05121"></a>05121           <span class="keyword">enum</span> bfd_endian byte_order = <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ());
<a name="l05122"></a>05122 
<a name="l05123"></a>05123           tfile_read ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) &amp;maddr, 8);
<a name="l05124"></a>05124           maddr = <a class="code" href="defs_8h.html#a99aec65329508b4d449a4f881026f844">extract_unsigned_integer</a> ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) &amp;maddr, 8,
<a name="l05125"></a>05125                                             byte_order);
<a name="l05126"></a>05126           tfile_read ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) &amp;mlen, 2);
<a name="l05127"></a>05127           mlen = (<span class="keywordtype">unsigned</span> short)
<a name="l05128"></a>05128             <a class="code" href="defs_8h.html#a99aec65329508b4d449a4f881026f844">extract_unsigned_integer</a> ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) &amp;mlen, 2, byte_order);
<a name="l05129"></a>05129 
<a name="l05130"></a>05130           <span class="comment">/* If the block includes the first part of the desired</span>
<a name="l05131"></a>05131 <span class="comment">             range, return as much it has; GDB will re-request the</span>
<a name="l05132"></a>05132 <span class="comment">             remainder, which might be in a different block of this</span>
<a name="l05133"></a>05133 <span class="comment">             trace frame.  */</span>
<a name="l05134"></a>05134           <span class="keywordflow">if</span> (maddr &lt;= offset &amp;&amp; offset &lt; (maddr + mlen))
<a name="l05135"></a>05135             {
<a name="l05136"></a>05136               amt = (maddr + mlen) - offset;
<a name="l05137"></a>05137               <span class="keywordflow">if</span> (amt &gt; len)
<a name="l05138"></a>05138                 amt = <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>;
<a name="l05139"></a>05139 
<a name="l05140"></a>05140               <span class="keywordflow">if</span> (maddr != offset)
<a name="l05141"></a>05141                 lseek (trace_fd, offset - maddr, SEEK_CUR);
<a name="l05142"></a>05142               tfile_read (readbuf, amt);
<a name="l05143"></a>05143               <span class="keywordflow">return</span> amt;
<a name="l05144"></a>05144             }
<a name="l05145"></a>05145 
<a name="l05146"></a>05146           <span class="comment">/* Skip over this block.  */</span>
<a name="l05147"></a>05147           pos += (8 + 2 + mlen);
<a name="l05148"></a>05148         }
<a name="l05149"></a>05149     }
<a name="l05150"></a>05150 
<a name="l05151"></a>05151   <span class="comment">/* It&#39;s unduly pedantic to refuse to look at the executable for</span>
<a name="l05152"></a>05152 <span class="comment">     read-only pieces; so do the equivalent of readonly regions aka</span>
<a name="l05153"></a>05153 <span class="comment">     QTro packet.  */</span>
<a name="l05154"></a>05154   <span class="comment">/* FIXME account for relocation at some point.  */</span>
<a name="l05155"></a>05155   <span class="keywordflow">if</span> (<a class="code" href="exec_8h.html#ac2e2e739fca42163e235e8521b9fbbab">exec_bfd</a>)
<a name="l05156"></a>05156     {
<a name="l05157"></a>05157       asection *s;
<a name="l05158"></a>05158       bfd_size_type <a class="code" href="go32-nat_8c.html#a854352f53b148adc24983a58a1866d66">size</a>;
<a name="l05159"></a>05159       bfd_vma vma;
<a name="l05160"></a>05160 
<a name="l05161"></a>05161       <span class="keywordflow">for</span> (s = <a class="code" href="exec_8h.html#ac2e2e739fca42163e235e8521b9fbbab">exec_bfd</a>-&gt;sections; s; s = s-&gt;next)
<a name="l05162"></a>05162         {
<a name="l05163"></a>05163           <span class="keywordflow">if</span> ((s-&gt;flags &amp; SEC_LOAD) == 0
<a name="l05164"></a>05164               || (s-&gt;flags &amp; SEC_READONLY) == 0)
<a name="l05165"></a>05165             <span class="keywordflow">continue</span>;
<a name="l05166"></a>05166 
<a name="l05167"></a>05167           vma = s-&gt;vma;
<a name="l05168"></a>05168           size = bfd_get_section_size (s);
<a name="l05169"></a>05169           <span class="keywordflow">if</span> (vma &lt;= offset &amp;&amp; offset &lt; (vma + size))
<a name="l05170"></a>05170             {
<a name="l05171"></a>05171               <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> amt;
<a name="l05172"></a>05172 
<a name="l05173"></a>05173               amt = (vma + <a class="code" href="go32-nat_8c.html#a854352f53b148adc24983a58a1866d66">size</a>) - offset;
<a name="l05174"></a>05174               <span class="keywordflow">if</span> (amt &gt; len)
<a name="l05175"></a>05175                 amt = <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>;
<a name="l05176"></a>05176 
<a name="l05177"></a>05177               amt = bfd_get_section_contents (<a class="code" href="exec_8h.html#ac2e2e739fca42163e235e8521b9fbbab">exec_bfd</a>, s,
<a name="l05178"></a>05178                                               readbuf, offset - vma, amt);
<a name="l05179"></a>05179               <span class="keywordflow">return</span> amt;
<a name="l05180"></a>05180             }
<a name="l05181"></a>05181         }
<a name="l05182"></a>05182     }
<a name="l05183"></a>05183 
<a name="l05184"></a>05184   <span class="comment">/* Indicate failure to find the requested memory block.  */</span>
<a name="l05185"></a>05185   <span class="keywordflow">return</span> -1;
<a name="l05186"></a>05186 }
<a name="l05187"></a>05187 
<a name="l05188"></a>05188 <span class="comment">/* Iterate through the blocks of a trace frame, looking for a &#39;V&#39;</span>
<a name="l05189"></a>05189 <span class="comment">   block with a matching tsv number.  */</span>
<a name="l05190"></a>05190 
<a name="l05191"></a>05191 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l05192"></a>05192 tfile_get_trace_state_variable_value (<span class="keywordtype">int</span> tsvnum, <a class="code" href="defs_8h.html#ac7647a3f71533007c9e128f3ddda1987">LONGEST</a> *val)
<a name="l05193"></a>05193 {
<a name="l05194"></a>05194   <span class="keywordtype">int</span> pos;
<a name="l05195"></a>05195   <span class="keywordtype">int</span> found = 0;
<a name="l05196"></a>05196 
<a name="l05197"></a>05197   <span class="comment">/* Iterate over blocks in current frame and find the last &#39;V&#39;</span>
<a name="l05198"></a>05198 <span class="comment">     block in which tsv number is TSVNUM.  In one trace frame, there</span>
<a name="l05199"></a>05199 <span class="comment">     may be multiple &#39;V&#39; blocks created for a given trace variable,</span>
<a name="l05200"></a>05200 <span class="comment">     and the last matched &#39;V&#39; block contains the updated value.  */</span>
<a name="l05201"></a>05201   pos = 0;
<a name="l05202"></a>05202   <span class="keywordflow">while</span> ((pos = traceframe_find_block_type (<span class="charliteral">&#39;V&#39;</span>, pos)) &gt;= 0)
<a name="l05203"></a>05203     {
<a name="l05204"></a>05204       <span class="keywordtype">int</span> vnum;
<a name="l05205"></a>05205 
<a name="l05206"></a>05206       tfile_read ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) &amp;vnum, 4);
<a name="l05207"></a>05207       vnum = (<a class="code" href="command_8h.html#a74f207b5aa4ba51c3a2ad59b219a423b">int</a>) <a class="code" href="defs_8h.html#afae519602ea9737f24bfa0e24b507faf">extract_signed_integer</a> ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) &amp;vnum, 4,
<a name="l05208"></a>05208                                            <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a>
<a name="l05209"></a>05209                                            (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ()));
<a name="l05210"></a>05210       <span class="keywordflow">if</span> (tsvnum == vnum)
<a name="l05211"></a>05211         {
<a name="l05212"></a>05212           tfile_read ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) val, 8);
<a name="l05213"></a>05213           *val = <a class="code" href="defs_8h.html#afae519602ea9737f24bfa0e24b507faf">extract_signed_integer</a> ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) val, 8,
<a name="l05214"></a>05214                                          <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a>
<a name="l05215"></a>05215                                          (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ()));
<a name="l05216"></a>05216           found = 1;
<a name="l05217"></a>05217         }
<a name="l05218"></a>05218       pos += (4 + 8);
<a name="l05219"></a>05219     }
<a name="l05220"></a>05220 
<a name="l05221"></a>05221   <span class="keywordflow">return</span> found;
<a name="l05222"></a>05222 }
<a name="l05223"></a>05223 
<a name="l05224"></a>05224 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l05225"></a>05225 tfile_has_all_memory (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *ops)
<a name="l05226"></a>05226 {
<a name="l05227"></a>05227   <span class="keywordflow">return</span> 1;
<a name="l05228"></a>05228 }
<a name="l05229"></a>05229 
<a name="l05230"></a>05230 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l05231"></a>05231 tfile_has_memory (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *ops)
<a name="l05232"></a>05232 {
<a name="l05233"></a>05233   <span class="keywordflow">return</span> 1;
<a name="l05234"></a>05234 }
<a name="l05235"></a>05235 
<a name="l05236"></a>05236 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l05237"></a>05237 tfile_has_stack (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *ops)
<a name="l05238"></a>05238 {
<a name="l05239"></a>05239   <span class="keywordflow">return</span> traceframe_number != -1;
<a name="l05240"></a>05240 }
<a name="l05241"></a>05241 
<a name="l05242"></a>05242 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l05243"></a>05243 tfile_has_registers (<span class="keyword">struct</span> <a class="code" href="structtarget__ops.html">target_ops</a> *ops)
<a name="l05244"></a>05244 {
<a name="l05245"></a>05245   <span class="keywordflow">return</span> traceframe_number != -1;
<a name="l05246"></a>05246 }
<a name="l05247"></a>05247 
<a name="l05248"></a>05248 <span class="comment">/* Callback for traceframe_walk_blocks.  Builds a traceframe_info</span>
<a name="l05249"></a>05249 <span class="comment">   object for the tfile target&#39;s current traceframe.  */</span>
<a name="l05250"></a>05250 
<a name="l05251"></a>05251 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l05252"></a>05252 build_traceframe_info (<span class="keywordtype">char</span> blocktype, <span class="keywordtype">void</span> *data)
<a name="l05253"></a>05253 {
<a name="l05254"></a>05254   <span class="keyword">struct </span>traceframe_info *info = data;
<a name="l05255"></a>05255 
<a name="l05256"></a>05256   <span class="keywordflow">switch</span> (blocktype)
<a name="l05257"></a>05257     {
<a name="l05258"></a>05258     <span class="keywordflow">case</span> <span class="charliteral">&#39;M&#39;</span>:
<a name="l05259"></a>05259       {
<a name="l05260"></a>05260         <span class="keyword">struct </span><a class="code" href="structmem__range.html">mem_range</a> *r;
<a name="l05261"></a>05261         <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> maddr;
<a name="l05262"></a>05262         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> mlen;
<a name="l05263"></a>05263 
<a name="l05264"></a>05264         tfile_read ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) &amp;maddr, 8);
<a name="l05265"></a>05265         maddr = <a class="code" href="defs_8h.html#a99aec65329508b4d449a4f881026f844">extract_unsigned_integer</a> ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) &amp;maddr, 8,
<a name="l05266"></a>05266                                           <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a>
<a name="l05267"></a>05267                                           (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ()));
<a name="l05268"></a>05268         tfile_read ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) &amp;mlen, 2);
<a name="l05269"></a>05269         mlen = (<span class="keywordtype">unsigned</span> short)
<a name="l05270"></a>05270                 <a class="code" href="defs_8h.html#a99aec65329508b4d449a4f881026f844">extract_unsigned_integer</a> ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) &amp;mlen,
<a name="l05271"></a>05271                                           2, <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a>
<a name="l05272"></a>05272                                           (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ()));
<a name="l05273"></a>05273 
<a name="l05274"></a>05274         r = <a class="code" href="vec_8h.html#a8d090c0524726d00931070e0c438ba3f">VEC_safe_push</a> (<a class="code" href="structmem__range.html">mem_range_s</a>, info-&gt;memory, NULL);
<a name="l05275"></a>05275 
<a name="l05276"></a>05276         r-&gt;<a class="code" href="structmem__range.html#af0c57d66bc3b5fc21cfba6dfb161f618">start</a> = maddr;
<a name="l05277"></a>05277         r-&gt;<a class="code" href="structmem__range.html#a7dd2d185dbacbc0a099e55a2cffb0696">length</a> = mlen;
<a name="l05278"></a>05278         <span class="keywordflow">break</span>;
<a name="l05279"></a>05279       }
<a name="l05280"></a>05280     <span class="keywordflow">case</span> <span class="charliteral">&#39;V&#39;</span>:
<a name="l05281"></a>05281       {
<a name="l05282"></a>05282         <span class="keywordtype">int</span> vnum;
<a name="l05283"></a>05283 
<a name="l05284"></a>05284         tfile_read ((<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) &amp;vnum, 4);
<a name="l05285"></a>05285         <a class="code" href="vec_8h.html#a8d090c0524726d00931070e0c438ba3f">VEC_safe_push</a> (<span class="keywordtype">int</span>, info-&gt;tvars, vnum);
<a name="l05286"></a>05286       }
<a name="l05287"></a>05287     <span class="keywordflow">case</span> <span class="charliteral">&#39;R&#39;</span>:
<a name="l05288"></a>05288     <span class="keywordflow">case</span> <span class="charliteral">&#39;S&#39;</span>:
<a name="l05289"></a>05289       {
<a name="l05290"></a>05290         <span class="keywordflow">break</span>;
<a name="l05291"></a>05291       }
<a name="l05292"></a>05292     <span class="keywordflow">default</span>:
<a name="l05293"></a>05293       <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Unhandled trace block type (%d) &#39;%c &#39; &quot;</span>
<a name="l05294"></a>05294                  <span class="stringliteral">&quot;while building trace frame info.&quot;</span>),
<a name="l05295"></a>05295                blocktype, blocktype);
<a name="l05296"></a>05296       <span class="keywordflow">break</span>;
<a name="l05297"></a>05297     }
<a name="l05298"></a>05298 
<a name="l05299"></a>05299   <span class="keywordflow">return</span> 0;
<a name="l05300"></a>05300 }
<a name="l05301"></a>05301 
<a name="l05302"></a>05302 <span class="keyword">static</span> <span class="keyword">struct </span>traceframe_info *
<a name="l05303"></a>05303 tfile_traceframe_info (<span class="keywordtype">void</span>)
<a name="l05304"></a>05304 {
<a name="l05305"></a>05305   <span class="keyword">struct </span>traceframe_info *info = XCNEW (<span class="keyword">struct</span> traceframe_info);
<a name="l05306"></a>05306 
<a name="l05307"></a>05307   traceframe_walk_blocks (build_traceframe_info, 0, info);
<a name="l05308"></a>05308   <span class="keywordflow">return</span> info;
<a name="l05309"></a>05309 }
<a name="l05310"></a>05310 
<a name="l05311"></a>05311 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l05312"></a>05312 init_tfile_ops (<span class="keywordtype">void</span>)
<a name="l05313"></a>05313 {
<a name="l05314"></a>05314   tfile_ops.<a class="code" href="structtarget__ops.html#a9326c3129ee116786b1ca1a95713f125">to_shortname</a> = <span class="stringliteral">&quot;tfile&quot;</span>;
<a name="l05315"></a>05315   tfile_ops.<a class="code" href="structtarget__ops.html#a184ee9aa071d32ec535cf7394aba0bd1">to_longname</a> = <span class="stringliteral">&quot;Local trace dump file&quot;</span>;
<a name="l05316"></a>05316   tfile_ops.<a class="code" href="structtarget__ops.html#a1b0c848329708688e3816263b16fe664">to_doc</a>
<a name="l05317"></a>05317     = <span class="stringliteral">&quot;Use a trace file as a target.  Specify the filename of the trace file.&quot;</span>;
<a name="l05318"></a>05318   tfile_ops.<a class="code" href="structtarget__ops.html#a5a0cfeca4b463ea49d8c2f5913a93eae">to_open</a> = tfile_open;
<a name="l05319"></a>05319   tfile_ops.<a class="code" href="structtarget__ops.html#a3a192fb4ed386bc561179111e53b5ccb">to_close</a> = tfile_close;
<a name="l05320"></a>05320   tfile_ops.<a class="code" href="structtarget__ops.html#a117d2a74c4c794d5b309b106a413ef10">to_fetch_registers</a> = tfile_fetch_registers;
<a name="l05321"></a>05321   tfile_ops.<a class="code" href="structtarget__ops.html#a095389eb9862ff7550e8286c54e33ad3">to_xfer_partial</a> = tfile_xfer_partial;
<a name="l05322"></a>05322   tfile_ops.<a class="code" href="structtarget__ops.html#a2cb65189c2ab4edb8dbe4f18adcaaf78">to_files_info</a> = tfile_files_info;
<a name="l05323"></a>05323   tfile_ops.<a class="code" href="structtarget__ops.html#ab177785f2ae3f4bcd6b1b7063a0270ee">to_get_trace_status</a> = tfile_get_trace_status;
<a name="l05324"></a>05324   tfile_ops.<a class="code" href="structtarget__ops.html#abba80ea854cdc12d7b7c862ca28a7d03">to_get_tracepoint_status</a> = tfile_get_tracepoint_status;
<a name="l05325"></a>05325   tfile_ops.<a class="code" href="structtarget__ops.html#ab7c0848931d3d01ec0a1575f57ea5152">to_trace_find</a> = tfile_trace_find;
<a name="l05326"></a>05326   tfile_ops.<a class="code" href="structtarget__ops.html#a956c3ec3cdd59ec4a00b92bb753a6601">to_get_trace_state_variable_value</a>
<a name="l05327"></a>05327     = tfile_get_trace_state_variable_value;
<a name="l05328"></a>05328   tfile_ops.<a class="code" href="structtarget__ops.html#aaf1f75f86ec2b948e5df3548198aae4b">to_stratum</a> = <a class="code" href="target_8h.html#abf9ea8b4aa7bddf6a8aa3882d0dadd00a4178bf9e6b076f5d0e36cc5727f9e168">process_stratum</a>;
<a name="l05329"></a>05329   tfile_ops.<a class="code" href="structtarget__ops.html#ad625bdaf8afca492722a20deb7f120c3">to_has_all_memory</a> = tfile_has_all_memory;
<a name="l05330"></a>05330   tfile_ops.<a class="code" href="structtarget__ops.html#aa672926e3d72e596d67efde607d13b86">to_has_memory</a> = tfile_has_memory;
<a name="l05331"></a>05331   tfile_ops.<a class="code" href="structtarget__ops.html#aded338ce92e6ae64169ece3b6666ff6a">to_has_stack</a> = tfile_has_stack;
<a name="l05332"></a>05332   tfile_ops.<a class="code" href="structtarget__ops.html#a6392e322d5a0b45f5fd487cf8d94caaf">to_has_registers</a> = tfile_has_registers;
<a name="l05333"></a>05333   tfile_ops.<a class="code" href="structtarget__ops.html#a5ce8851a7f7b70bc7d2d8a45c51672e9">to_traceframe_info</a> = tfile_traceframe_info;
<a name="l05334"></a>05334   tfile_ops.<a class="code" href="structtarget__ops.html#a97a3b404ed5a64b8f6229fdaf43d30fb">to_magic</a> = <a class="code" href="target_8h.html#a52de2938b46ac35e4a8c50fead44fd4d">OPS_MAGIC</a>;
<a name="l05335"></a>05335 }
<a name="l05336"></a>05336 
<a name="l05337"></a>05337 <span class="keywordtype">void</span>
<a name="l05338"></a><a class="code" href="tracepoint_8h.html#a6164d72967601424057189bb776ae4e1">05338</a> <a class="code" href="tracepoint_8c.html#a6164d72967601424057189bb776ae4e1">free_current_marker</a> (<span class="keywordtype">void</span> *arg)
<a name="l05339"></a>05339 {
<a name="l05340"></a>05340   <span class="keyword">struct </span><a class="code" href="structstatic__tracepoint__marker.html">static_tracepoint_marker</a> **marker_p = arg;
<a name="l05341"></a>05341 
<a name="l05342"></a>05342   <span class="keywordflow">if</span> (*marker_p != NULL)
<a name="l05343"></a>05343     {
<a name="l05344"></a>05344       <a class="code" href="tracepoint_8c.html#a6eb95e5022deae349e0523ceb87e6252">release_static_tracepoint_marker</a> (*marker_p);
<a name="l05345"></a>05345       <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (*marker_p);
<a name="l05346"></a>05346     }
<a name="l05347"></a>05347   <span class="keywordflow">else</span>
<a name="l05348"></a>05348     *marker_p = NULL;
<a name="l05349"></a>05349 }
<a name="l05350"></a>05350 
<a name="l05351"></a>05351 <span class="comment">/* Given a line of text defining a static tracepoint marker, parse it</span>
<a name="l05352"></a>05352 <span class="comment">   into a &quot;static tracepoint marker&quot; object.  Throws an error is</span>
<a name="l05353"></a>05353 <span class="comment">   parsing fails.  If PP is non-null, it points to one past the end of</span>
<a name="l05354"></a>05354 <span class="comment">   the parsed marker definition.  */</span>
<a name="l05355"></a>05355 
<a name="l05356"></a>05356 <span class="keywordtype">void</span>
<a name="l05357"></a><a class="code" href="tracepoint_8h.html#acf440bf2ff0e831eb90ff71fdc277c55">05357</a> <a class="code" href="tracepoint_8c.html#acf440bf2ff0e831eb90ff71fdc277c55">parse_static_tracepoint_marker_definition</a> (<span class="keywordtype">char</span> *line, <span class="keywordtype">char</span> **pp,
<a name="l05358"></a>05358                                            <span class="keyword">struct</span> <a class="code" href="structstatic__tracepoint__marker.html">static_tracepoint_marker</a> *marker)
<a name="l05359"></a>05359 {
<a name="l05360"></a>05360   <span class="keywordtype">char</span> *p, *endp;
<a name="l05361"></a>05361   <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> addr;
<a name="l05362"></a>05362   <span class="keywordtype">int</span> end;
<a name="l05363"></a>05363 
<a name="l05364"></a>05364   p = <a class="code" href="symtab_8h.html#a41ebd28ef1d7c6ade45642cb6acc1039">line</a>;
<a name="l05365"></a>05365   p = <a class="code" href="remote_8c.html#a02fe0338da7e5e6c07f713b26fc1cdd6">unpack_varlen_hex</a> (p, &amp;addr);
<a name="l05366"></a>05366   p++;  <span class="comment">/* skip a colon */</span>
<a name="l05367"></a>05367 
<a name="l05368"></a>05368   marker-&gt;<a class="code" href="structstatic__tracepoint__marker.html#a0db83d9a61b08c6e3294ebe06eaf6d8c">gdbarch</a> = <a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ();
<a name="l05369"></a>05369   marker-&gt;<a class="code" href="structstatic__tracepoint__marker.html#aa5ab18cb7b106119a67b22528f98f89d">address</a> = (<a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a>) addr;
<a name="l05370"></a>05370 
<a name="l05371"></a>05371   endp = <a class="code" href="gdb__string_8h.html#adf46aa8f2e08cfb505868bbfc88b5fd4">strchr</a> (p, <span class="charliteral">&#39;:&#39;</span>);
<a name="l05372"></a>05372   <span class="keywordflow">if</span> (endp == NULL)
<a name="l05373"></a>05373     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;bad marker definition: %s&quot;</span>), line);
<a name="l05374"></a>05374 
<a name="l05375"></a>05375   marker-&gt;<a class="code" href="structstatic__tracepoint__marker.html#a8e6faa0cf36d03b0a2d8bff0f53e0118">str_id</a> = <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (endp - p + 1);
<a name="l05376"></a>05376   end = <a class="code" href="remote_8c.html#aa9701b4d16cb5e4e31c5a952478edaae">hex2bin</a> (p, (<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) marker-&gt;<a class="code" href="structstatic__tracepoint__marker.html#a8e6faa0cf36d03b0a2d8bff0f53e0118">str_id</a>, (endp - p + 1) / 2);
<a name="l05377"></a>05377   marker-&gt;<a class="code" href="structstatic__tracepoint__marker.html#a8e6faa0cf36d03b0a2d8bff0f53e0118">str_id</a>[end] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l05378"></a>05378 
<a name="l05379"></a>05379   p += 2 * end;
<a name="l05380"></a>05380   p++;  <span class="comment">/* skip a colon */</span>
<a name="l05381"></a>05381 
<a name="l05382"></a>05382   marker-&gt;<a class="code" href="structstatic__tracepoint__marker.html#ae1abf3e33a235c07de23df6c53928f42">extra</a> = <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (strlen (p) + 1);
<a name="l05383"></a>05383   end = <a class="code" href="remote_8c.html#aa9701b4d16cb5e4e31c5a952478edaae">hex2bin</a> (p, (<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *) marker-&gt;<a class="code" href="structstatic__tracepoint__marker.html#ae1abf3e33a235c07de23df6c53928f42">extra</a>, strlen (p) / 2);
<a name="l05384"></a>05384   marker-&gt;<a class="code" href="structstatic__tracepoint__marker.html#ae1abf3e33a235c07de23df6c53928f42">extra</a>[end] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l05385"></a>05385 
<a name="l05386"></a>05386   <span class="keywordflow">if</span> (pp)
<a name="l05387"></a>05387     *pp = p;
<a name="l05388"></a>05388 }
<a name="l05389"></a>05389 
<a name="l05390"></a>05390 <span class="comment">/* Release a static tracepoint marker&#39;s contents.  Note that the</span>
<a name="l05391"></a>05391 <span class="comment">   object itself isn&#39;t released here.  There objects are usually on</span>
<a name="l05392"></a>05392 <span class="comment">   the stack.  */</span>
<a name="l05393"></a>05393 
<a name="l05394"></a>05394 <span class="keywordtype">void</span>
<a name="l05395"></a><a class="code" href="tracepoint_8h.html#a58b06d041f26ec232a380cf8670afb6d">05395</a> <a class="code" href="tracepoint_8c.html#a6eb95e5022deae349e0523ceb87e6252">release_static_tracepoint_marker</a> (<span class="keyword">struct</span> <a class="code" href="structstatic__tracepoint__marker.html">static_tracepoint_marker</a> *marker)
<a name="l05396"></a>05396 {
<a name="l05397"></a>05397   <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (marker-&gt;<a class="code" href="structstatic__tracepoint__marker.html#a8e6faa0cf36d03b0a2d8bff0f53e0118">str_id</a>);
<a name="l05398"></a>05398   marker-&gt;<a class="code" href="structstatic__tracepoint__marker.html#a8e6faa0cf36d03b0a2d8bff0f53e0118">str_id</a> = NULL;
<a name="l05399"></a>05399 }
<a name="l05400"></a>05400 
<a name="l05401"></a>05401 <span class="comment">/* Print MARKER to gdb_stdout.  */</span>
<a name="l05402"></a>05402 
<a name="l05403"></a>05403 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l05404"></a>05404 print_one_static_tracepoint_marker (<span class="keywordtype">int</span> count,
<a name="l05405"></a>05405                                     <span class="keyword">struct</span> <a class="code" href="structstatic__tracepoint__marker.html">static_tracepoint_marker</a> *marker)
<a name="l05406"></a>05406 {
<a name="l05407"></a>05407   <span class="keyword">struct </span><a class="code" href="structcommand__line.html">command_line</a> *l;
<a name="l05408"></a>05408   <span class="keyword">struct </span><a class="code" href="structsymbol.html">symbol</a> *sym;
<a name="l05409"></a>05409 
<a name="l05410"></a>05410   <span class="keywordtype">char</span> wrap_indent[80];
<a name="l05411"></a>05411   <span class="keywordtype">char</span> extra_field_indent[80];
<a name="l05412"></a>05412   <span class="keyword">struct </span>ui_out *uiout = <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>;
<a name="l05413"></a>05413   <span class="keyword">struct </span>cleanup *bkpt_chain;
<a name="l05414"></a>05414   <a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a>(<a class="code" href="structbreakpoint.html">breakpoint_p</a>) *tracepoints;
<a name="l05415"></a>05415 
<a name="l05416"></a>05416   <span class="keyword">struct </span><a class="code" href="structsymtab__and__line.html">symtab_and_line</a> sal;
<a name="l05417"></a>05417 
<a name="l05418"></a>05418   <a class="code" href="symtab_8c.html#aca3a01a4f0e1a09f99e8308faecc9028">init_sal</a> (&amp;sal);
<a name="l05419"></a>05419 
<a name="l05420"></a>05420   sal.pc = marker-&gt;<a class="code" href="structstatic__tracepoint__marker.html#aa5ab18cb7b106119a67b22528f98f89d">address</a>;
<a name="l05421"></a>05421 
<a name="l05422"></a>05422   tracepoints = static_tracepoints_here (marker-&gt;<a class="code" href="structstatic__tracepoint__marker.html#aa5ab18cb7b106119a67b22528f98f89d">address</a>);
<a name="l05423"></a>05423 
<a name="l05424"></a>05424   bkpt_chain = <a class="code" href="ui-out_8c.html#aaf5a0c991d74ad2e486f420d5c2ff058">make_cleanup_ui_out_tuple_begin_end</a> (uiout, <span class="stringliteral">&quot;marker&quot;</span>);
<a name="l05425"></a>05425 
<a name="l05426"></a>05426   <span class="comment">/* A counter field to help readability.  This is not a stable</span>
<a name="l05427"></a>05427 <span class="comment">     identifier!  */</span>
<a name="l05428"></a>05428   <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, <span class="stringliteral">&quot;count&quot;</span>, count);
<a name="l05429"></a>05429 
<a name="l05430"></a>05430   <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;marker-id&quot;</span>, marker-&gt;<a class="code" href="structstatic__tracepoint__marker.html#a8e6faa0cf36d03b0a2d8bff0f53e0118">str_id</a>);
<a name="l05431"></a>05431 
<a name="l05432"></a>05432   <a class="code" href="ui-out_8c.html#ac29596ba86f387928e0d3e6b7385f998">ui_out_field_fmt</a> (uiout, <span class="stringliteral">&quot;enabled&quot;</span>, <span class="stringliteral">&quot;%c&quot;</span>,
<a name="l05433"></a>05433                     !<a class="code" href="vec_8h.html#ac9981d313a5e114db0e05b7b9cd16319">VEC_empty</a> (<a class="code" href="structbreakpoint.html">breakpoint_p</a>, tracepoints) ? <span class="charliteral">&#39;y&#39;</span> : <span class="charliteral">&#39;n&#39;</span>);
<a name="l05434"></a>05434   <a class="code" href="ui-out_8c.html#a2a4b4f5c17e354b68a3486e0e129907b">ui_out_spaces</a> (uiout, 2);
<a name="l05435"></a>05435 
<a name="l05436"></a>05436   strcpy (wrap_indent, <span class="stringliteral">&quot;                                   &quot;</span>);
<a name="l05437"></a>05437 
<a name="l05438"></a>05438   <span class="keywordflow">if</span> (<a class="code" href="gdbarch_8c.html#a3ee335ac98782b6633ab7fc235182cc9">gdbarch_addr_bit</a> (marker-&gt;<a class="code" href="structstatic__tracepoint__marker.html#a0db83d9a61b08c6e3294ebe06eaf6d8c">gdbarch</a>) &lt;= 32)
<a name="l05439"></a>05439     strcat (wrap_indent, <span class="stringliteral">&quot;           &quot;</span>);
<a name="l05440"></a>05440   <span class="keywordflow">else</span>
<a name="l05441"></a>05441     strcat (wrap_indent, <span class="stringliteral">&quot;                   &quot;</span>);
<a name="l05442"></a>05442 
<a name="l05443"></a>05443   strcpy (extra_field_indent, <span class="stringliteral">&quot;         &quot;</span>);
<a name="l05444"></a>05444 
<a name="l05445"></a>05445   <a class="code" href="ui-out_8c.html#ada85ed653fecf3c2a80027de6f71ef71">ui_out_field_core_addr</a> (uiout, <span class="stringliteral">&quot;addr&quot;</span>, marker-&gt;<a class="code" href="structstatic__tracepoint__marker.html#a0db83d9a61b08c6e3294ebe06eaf6d8c">gdbarch</a>, marker-&gt;<a class="code" href="structstatic__tracepoint__marker.html#aa5ab18cb7b106119a67b22528f98f89d">address</a>);
<a name="l05446"></a>05446 
<a name="l05447"></a>05447   sal = <a class="code" href="symtab_8c.html#ad9bbd85700e3d7fa50e7ba0e32f37846">find_pc_line</a> (marker-&gt;<a class="code" href="structstatic__tracepoint__marker.html#aa5ab18cb7b106119a67b22528f98f89d">address</a>, 0);
<a name="l05448"></a>05448   sym = <a class="code" href="blockframe_8c.html#a255def7e64445af1e9b15dfaa24b07a5">find_pc_sect_function</a> (marker-&gt;<a class="code" href="structstatic__tracepoint__marker.html#aa5ab18cb7b106119a67b22528f98f89d">address</a>, NULL);
<a name="l05449"></a>05449   <span class="keywordflow">if</span> (sym)
<a name="l05450"></a>05450     {
<a name="l05451"></a>05451       <a class="code" href="ui-out_8c.html#a6a23596295dce32ba2a5bd2fd2d309f8">ui_out_text</a> (uiout, <span class="stringliteral">&quot;in &quot;</span>);
<a name="l05452"></a>05452       <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;func&quot;</span>,
<a name="l05453"></a>05453                            <a class="code" href="symtab_8h.html#ac7f4cb1648125545fbd0e4f13b0c572c">SYMBOL_PRINT_NAME</a> (sym));
<a name="l05454"></a>05454       <a class="code" href="ui-out_8c.html#a24e0ad942242d807edb27cd3fe6aaa39">ui_out_wrap_hint</a> (uiout, wrap_indent);
<a name="l05455"></a>05455       <a class="code" href="ui-out_8c.html#a6a23596295dce32ba2a5bd2fd2d309f8">ui_out_text</a> (uiout, <span class="stringliteral">&quot; at &quot;</span>);
<a name="l05456"></a>05456     }
<a name="l05457"></a>05457   <span class="keywordflow">else</span>
<a name="l05458"></a>05458     <a class="code" href="ui-out_8c.html#a5366a822858ecedafef54625bec57442">ui_out_field_skip</a> (uiout, <span class="stringliteral">&quot;func&quot;</span>);
<a name="l05459"></a>05459 
<a name="l05460"></a>05460   <span class="keywordflow">if</span> (sal.symtab != NULL)
<a name="l05461"></a>05461     {
<a name="l05462"></a>05462       <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;file&quot;</span>,
<a name="l05463"></a>05463                            <a class="code" href="source_8c.html#ae251616cab166301d5fed95cbdd31232">symtab_to_filename_for_display</a> (sal.symtab));
<a name="l05464"></a>05464       <a class="code" href="ui-out_8c.html#a6a23596295dce32ba2a5bd2fd2d309f8">ui_out_text</a> (uiout, <span class="stringliteral">&quot;:&quot;</span>);
<a name="l05465"></a>05465 
<a name="l05466"></a>05466       <span class="keywordflow">if</span> (<a class="code" href="ui-out_8c.html#a473db54efcfbc60feeb5a4f54f27af46">ui_out_is_mi_like_p</a> (uiout))
<a name="l05467"></a>05467         {
<a name="l05468"></a>05468           <span class="keyword">const</span> <span class="keywordtype">char</span> *fullname = <a class="code" href="source_8c.html#aa78177718e9d6c01595600975e8254df">symtab_to_fullname</a> (sal.symtab);
<a name="l05469"></a>05469 
<a name="l05470"></a>05470           <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;fullname&quot;</span>, fullname);
<a name="l05471"></a>05471         }
<a name="l05472"></a>05472       <span class="keywordflow">else</span>
<a name="l05473"></a>05473         <a class="code" href="ui-out_8c.html#a5366a822858ecedafef54625bec57442">ui_out_field_skip</a> (uiout, <span class="stringliteral">&quot;fullname&quot;</span>);
<a name="l05474"></a>05474 
<a name="l05475"></a>05475       <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, <span class="stringliteral">&quot;line&quot;</span>, sal.line);
<a name="l05476"></a>05476     }
<a name="l05477"></a>05477   <span class="keywordflow">else</span>
<a name="l05478"></a>05478     {
<a name="l05479"></a>05479       <a class="code" href="ui-out_8c.html#a5366a822858ecedafef54625bec57442">ui_out_field_skip</a> (uiout, <span class="stringliteral">&quot;fullname&quot;</span>);
<a name="l05480"></a>05480       <a class="code" href="ui-out_8c.html#a5366a822858ecedafef54625bec57442">ui_out_field_skip</a> (uiout, <span class="stringliteral">&quot;line&quot;</span>);
<a name="l05481"></a>05481     }
<a name="l05482"></a>05482 
<a name="l05483"></a>05483   <a class="code" href="ui-out_8c.html#a6a23596295dce32ba2a5bd2fd2d309f8">ui_out_text</a> (uiout, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l05484"></a>05484   <a class="code" href="ui-out_8c.html#a6a23596295dce32ba2a5bd2fd2d309f8">ui_out_text</a> (uiout, extra_field_indent);
<a name="l05485"></a>05485   <a class="code" href="ui-out_8c.html#a6a23596295dce32ba2a5bd2fd2d309f8">ui_out_text</a> (uiout, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Data: \&quot;&quot;</span>));
<a name="l05486"></a>05486   <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;extra-data&quot;</span>, marker-&gt;<a class="code" href="structstatic__tracepoint__marker.html#ae1abf3e33a235c07de23df6c53928f42">extra</a>);
<a name="l05487"></a>05487   <a class="code" href="ui-out_8c.html#a6a23596295dce32ba2a5bd2fd2d309f8">ui_out_text</a> (uiout, <span class="stringliteral">&quot;\&quot;\n&quot;</span>);
<a name="l05488"></a>05488 
<a name="l05489"></a>05489   <span class="keywordflow">if</span> (!<a class="code" href="vec_8h.html#ac9981d313a5e114db0e05b7b9cd16319">VEC_empty</a> (<a class="code" href="structbreakpoint.html">breakpoint_p</a>, tracepoints))
<a name="l05490"></a>05490     {
<a name="l05491"></a>05491       <span class="keyword">struct </span>cleanup *cleanup_chain;
<a name="l05492"></a>05492       <span class="keywordtype">int</span> ix;
<a name="l05493"></a>05493       <span class="keyword">struct </span><a class="code" href="structbreakpoint.html">breakpoint</a> *b;
<a name="l05494"></a>05494 
<a name="l05495"></a>05495       cleanup_chain = <a class="code" href="ui-out_8c.html#aaf5a0c991d74ad2e486f420d5c2ff058">make_cleanup_ui_out_tuple_begin_end</a> (uiout,
<a name="l05496"></a>05496                                                            <span class="stringliteral">&quot;tracepoints-at&quot;</span>);
<a name="l05497"></a>05497 
<a name="l05498"></a>05498       <a class="code" href="ui-out_8c.html#a6a23596295dce32ba2a5bd2fd2d309f8">ui_out_text</a> (uiout, extra_field_indent);
<a name="l05499"></a>05499       <a class="code" href="ui-out_8c.html#a6a23596295dce32ba2a5bd2fd2d309f8">ui_out_text</a> (uiout, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Probed by static tracepoints: &quot;</span>));
<a name="l05500"></a>05500       <span class="keywordflow">for</span> (ix = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a>(<a class="code" href="structbreakpoint.html">breakpoint_p</a>, tracepoints, ix, b); ix++)
<a name="l05501"></a>05501         {
<a name="l05502"></a>05502           <span class="keywordflow">if</span> (ix &gt; 0)
<a name="l05503"></a>05503             <a class="code" href="ui-out_8c.html#a6a23596295dce32ba2a5bd2fd2d309f8">ui_out_text</a> (uiout, <span class="stringliteral">&quot;, &quot;</span>);
<a name="l05504"></a>05504           <a class="code" href="ui-out_8c.html#a6a23596295dce32ba2a5bd2fd2d309f8">ui_out_text</a> (uiout, <span class="stringliteral">&quot;#&quot;</span>);
<a name="l05505"></a>05505           <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, <span class="stringliteral">&quot;tracepoint-id&quot;</span>, b-&gt;<a class="code" href="structbreakpoint.html#aa46a2ab4a5f2ae1e42412c412997871b">number</a>);
<a name="l05506"></a>05506         }
<a name="l05507"></a>05507 
<a name="l05508"></a>05508       <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup_chain);
<a name="l05509"></a>05509 
<a name="l05510"></a>05510       <span class="keywordflow">if</span> (<a class="code" href="ui-out_8c.html#a473db54efcfbc60feeb5a4f54f27af46">ui_out_is_mi_like_p</a> (uiout))
<a name="l05511"></a>05511         <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, <span class="stringliteral">&quot;number-of-tracepoints&quot;</span>,
<a name="l05512"></a>05512                           <a class="code" href="vec_8h.html#a844523bba6d0565ef73a0f4a63e48d19">VEC_length</a>(<a class="code" href="structbreakpoint.html">breakpoint_p</a>, tracepoints));
<a name="l05513"></a>05513       <span class="keywordflow">else</span>
<a name="l05514"></a>05514         <a class="code" href="ui-out_8c.html#a6a23596295dce32ba2a5bd2fd2d309f8">ui_out_text</a> (uiout, <span class="stringliteral">&quot;\n&quot;</span>);
<a name="l05515"></a>05515     }
<a name="l05516"></a>05516   <a class="code" href="vec_8h.html#af5724b2bbce65103300279f9abe7f577">VEC_free</a> (<a class="code" href="structbreakpoint.html">breakpoint_p</a>, tracepoints);
<a name="l05517"></a>05517 
<a name="l05518"></a>05518   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (bkpt_chain);
<a name="l05519"></a>05519 }
<a name="l05520"></a>05520 
<a name="l05521"></a>05521 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l05522"></a>05522 info_static_tracepoint_markers_command (<span class="keywordtype">char</span> *arg, <span class="keywordtype">int</span> from_tty)
<a name="l05523"></a>05523 {
<a name="l05524"></a>05524   <a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a>(<a class="code" href="structstatic__tracepoint__marker.html">static_tracepoint_marker_p</a>) *markers;
<a name="l05525"></a>05525   <span class="keyword">struct </span>cleanup *old_chain;
<a name="l05526"></a>05526   <span class="keyword">struct </span><a class="code" href="structstatic__tracepoint__marker.html">static_tracepoint_marker</a> *marker;
<a name="l05527"></a>05527   <span class="keyword">struct </span>ui_out *uiout = <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>;
<a name="l05528"></a>05528   <span class="keywordtype">int</span> i;
<a name="l05529"></a>05529 
<a name="l05530"></a>05530   <span class="comment">/* We don&#39;t have to check target_can_use_agent and agent&#39;s capability on</span>
<a name="l05531"></a>05531 <span class="comment">     static tracepoint here, in order to be compatible with older GDBserver.</span>
<a name="l05532"></a>05532 <span class="comment">     We don&#39;t check USE_AGENT is true or not, because static tracepoints</span>
<a name="l05533"></a>05533 <span class="comment">     don&#39;t work without in-process agent, so we don&#39;t bother users to type</span>
<a name="l05534"></a>05534 <span class="comment">     `set agent on&#39; when to use static tracepoint.  */</span>
<a name="l05535"></a>05535 
<a name="l05536"></a>05536   old_chain
<a name="l05537"></a>05537     = <a class="code" href="ui-out_8c.html#a9675e3968a06325a214ffe2fbb10bdc8">make_cleanup_ui_out_table_begin_end</a> (uiout, 5, -1,
<a name="l05538"></a>05538                                            <span class="stringliteral">&quot;StaticTracepointMarkersTable&quot;</span>);
<a name="l05539"></a>05539 
<a name="l05540"></a>05540   <a class="code" href="ui-out_8c.html#a6a85ff75fa4ac345725a2fd58498173f">ui_out_table_header</a> (uiout, 7, <a class="code" href="ui-out_8h.html#ac5d0187f97768dc203458ddf644e0c7aac8a02f1b44706ba412f42aa3fc249695">ui_left</a>, <span class="stringliteral">&quot;counter&quot;</span>, <span class="stringliteral">&quot;Cnt&quot;</span>);
<a name="l05541"></a>05541 
<a name="l05542"></a>05542   <a class="code" href="ui-out_8c.html#a6a85ff75fa4ac345725a2fd58498173f">ui_out_table_header</a> (uiout, 40, <a class="code" href="ui-out_8h.html#ac5d0187f97768dc203458ddf644e0c7aac8a02f1b44706ba412f42aa3fc249695">ui_left</a>, <span class="stringliteral">&quot;marker-id&quot;</span>, <span class="stringliteral">&quot;ID&quot;</span>);
<a name="l05543"></a>05543 
<a name="l05544"></a>05544   <a class="code" href="ui-out_8c.html#a6a85ff75fa4ac345725a2fd58498173f">ui_out_table_header</a> (uiout, 3, <a class="code" href="ui-out_8h.html#ac5d0187f97768dc203458ddf644e0c7aac8a02f1b44706ba412f42aa3fc249695">ui_left</a>, <span class="stringliteral">&quot;enabled&quot;</span>, <span class="stringliteral">&quot;Enb&quot;</span>);
<a name="l05545"></a>05545   <span class="keywordflow">if</span> (<a class="code" href="gdbarch_8c.html#a3ee335ac98782b6633ab7fc235182cc9">gdbarch_addr_bit</a> (<a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ()) &lt;= 32)
<a name="l05546"></a>05546     <a class="code" href="ui-out_8c.html#a6a85ff75fa4ac345725a2fd58498173f">ui_out_table_header</a> (uiout, 10, <a class="code" href="ui-out_8h.html#ac5d0187f97768dc203458ddf644e0c7aac8a02f1b44706ba412f42aa3fc249695">ui_left</a>, <span class="stringliteral">&quot;addr&quot;</span>, <span class="stringliteral">&quot;Address&quot;</span>);
<a name="l05547"></a>05547   <span class="keywordflow">else</span>
<a name="l05548"></a>05548     <a class="code" href="ui-out_8c.html#a6a85ff75fa4ac345725a2fd58498173f">ui_out_table_header</a> (uiout, 18, <a class="code" href="ui-out_8h.html#ac5d0187f97768dc203458ddf644e0c7aac8a02f1b44706ba412f42aa3fc249695">ui_left</a>, <span class="stringliteral">&quot;addr&quot;</span>, <span class="stringliteral">&quot;Address&quot;</span>);
<a name="l05549"></a>05549   <a class="code" href="ui-out_8c.html#a6a85ff75fa4ac345725a2fd58498173f">ui_out_table_header</a> (uiout, 40, <a class="code" href="ui-out_8h.html#ac5d0187f97768dc203458ddf644e0c7aa0483b30a9b89be72a51d076fcd02be30">ui_noalign</a>, <span class="stringliteral">&quot;what&quot;</span>, <span class="stringliteral">&quot;What&quot;</span>);
<a name="l05550"></a>05550 
<a name="l05551"></a>05551   <a class="code" href="ui-out_8c.html#a07042144a117bc974f5c41761b68975e">ui_out_table_body</a> (uiout);
<a name="l05552"></a>05552 
<a name="l05553"></a>05553   markers = <a class="code" href="target_8h.html#a0a86c51b45e40100c97b3dd4540455e8">target_static_tracepoint_markers_by_strid</a> (NULL);
<a name="l05554"></a>05554   <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="vec_8h.html#a92a6114eb727b9274e1523d0e9dd2e61">VEC_cleanup</a> (<a class="code" href="structstatic__tracepoint__marker.html">static_tracepoint_marker_p</a>), &amp;markers);
<a name="l05555"></a>05555 
<a name="l05556"></a>05556   <span class="keywordflow">for</span> (i = 0;
<a name="l05557"></a>05557        <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="structstatic__tracepoint__marker.html">static_tracepoint_marker_p</a>,
<a name="l05558"></a>05558                     markers, i, marker);
<a name="l05559"></a>05559        i++)
<a name="l05560"></a>05560     {
<a name="l05561"></a>05561       print_one_static_tracepoint_marker (i + 1, marker);
<a name="l05562"></a>05562       <a class="code" href="tracepoint_8c.html#a6eb95e5022deae349e0523ceb87e6252">release_static_tracepoint_marker</a> (marker);
<a name="l05563"></a>05563     }
<a name="l05564"></a>05564 
<a name="l05565"></a>05565   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l05566"></a>05566 }
<a name="l05567"></a>05567 
<a name="l05568"></a>05568 <span class="comment">/* The $_sdata convenience variable is a bit special.  We don&#39;t know</span>
<a name="l05569"></a>05569 <span class="comment">   for sure type of the value until we actually have a chance to fetch</span>
<a name="l05570"></a>05570 <span class="comment">   the data --- the size of the object depends on what has been</span>
<a name="l05571"></a>05571 <span class="comment">   collected.  We solve this by making $_sdata be an internalvar that</span>
<a name="l05572"></a>05572 <span class="comment">   creates a new value on access.  */</span>
<a name="l05573"></a>05573 
<a name="l05574"></a>05574 <span class="comment">/* Return a new value with the correct type for the sdata object of</span>
<a name="l05575"></a>05575 <span class="comment">   the current trace frame.  Return a void value if there&#39;s no object</span>
<a name="l05576"></a>05576 <span class="comment">   available.  */</span>
<a name="l05577"></a>05577 
<a name="l05578"></a>05578 <span class="keyword">static</span> <span class="keyword">struct </span>value *
<a name="l05579"></a>05579 sdata_make_value (<span class="keyword">struct</span> gdbarch *gdbarch, <span class="keyword">struct</span> internalvar *var,
<a name="l05580"></a>05580                   <span class="keywordtype">void</span> *ignore)
<a name="l05581"></a>05581 {
<a name="l05582"></a>05582   <a class="code" href="defs_8h.html#ac7647a3f71533007c9e128f3ddda1987">LONGEST</a> <a class="code" href="go32-nat_8c.html#a854352f53b148adc24983a58a1866d66">size</a>;
<a name="l05583"></a>05583   <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *buf;
<a name="l05584"></a>05584 
<a name="l05585"></a>05585   <span class="comment">/* We need to read the whole object before we know its size.  */</span>
<a name="l05586"></a>05586   size = <a class="code" href="target_8c.html#a3fa3cddea970cd3b7fb5a5ecfb62eeac">target_read_alloc</a> (&amp;current_target,
<a name="l05587"></a>05587                             <a class="code" href="target_8h.html#aa5a3e4ceb377c9f5822cdc68c6f138e2af9172e2048fe0b4903136ca6168fb8c9">TARGET_OBJECT_STATIC_TRACE_DATA</a>,
<a name="l05588"></a>05588                             NULL, &amp;buf);
<a name="l05589"></a>05589   <span class="keywordflow">if</span> (size &gt;= 0)
<a name="l05590"></a>05590     {
<a name="l05591"></a>05591       <span class="keyword">struct </span>value *v;
<a name="l05592"></a>05592       <span class="keyword">struct </span>type *type;
<a name="l05593"></a>05593 
<a name="l05594"></a>05594       type = <a class="code" href="gdbtypes_8c.html#a93eefcbb5ac6aec0f3f1c96e186bfdef">init_vector_type</a> (<a class="code" href="structbuiltin__type.html">builtin_type</a> (gdbarch)-&gt;builtin_true_char,
<a name="l05595"></a>05595                                size);
<a name="l05596"></a>05596       v = <a class="code" href="value_8c.html#a37cac41e59c768c42e801aeb969b566e">allocate_value</a> (type);
<a name="l05597"></a>05597       <a class="code" href="gdb__string_8h.html#a39ebe6a4e122707997e78b549a1e8c5e">memcpy</a> (<a class="code" href="value_8c.html#a9f59e572fabef6e1905632fb81cc00e1">value_contents_raw</a> (v), buf, size);
<a name="l05598"></a>05598       <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (buf);
<a name="l05599"></a>05599       <span class="keywordflow">return</span> v;
<a name="l05600"></a>05600     }
<a name="l05601"></a>05601   <span class="keywordflow">else</span>
<a name="l05602"></a>05602     <span class="keywordflow">return</span> <a class="code" href="value_8c.html#a37cac41e59c768c42e801aeb969b566e">allocate_value</a> (<a class="code" href="structbuiltin__type.html">builtin_type</a> (gdbarch)-&gt;builtin_void);
<a name="l05603"></a>05603 }
<a name="l05604"></a>05604 
<a name="l05605"></a>05605 <span class="preprocessor">#if !defined(HAVE_LIBEXPAT)</span>
<a name="l05606"></a>05606 <span class="preprocessor"></span>
<a name="l05607"></a>05607 <span class="keyword">struct </span>traceframe_info *
<a name="l05608"></a><a class="code" href="tracepoint_8h.html#a6d877e8adde731cbc4ec8db79b33b681">05608</a> <a class="code" href="tracepoint_8c.html#a6d877e8adde731cbc4ec8db79b33b681">parse_traceframe_info</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *tframe_info)
<a name="l05609"></a>05609 {
<a name="l05610"></a>05610   <span class="keyword">static</span> <span class="keywordtype">int</span> have_warned;
<a name="l05611"></a>05611 
<a name="l05612"></a>05612   <span class="keywordflow">if</span> (!have_warned)
<a name="l05613"></a>05613     {
<a name="l05614"></a>05614       have_warned = 1;
<a name="l05615"></a>05615       <a class="code" href="utils_8c.html#a5fc201a4181499a6b4057a6caa15b5e2">warning</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Can not parse XML trace frame info; XML support &quot;</span>
<a name="l05616"></a>05616                  <span class="stringliteral">&quot;was disabled at compile time&quot;</span>));
<a name="l05617"></a>05617     }
<a name="l05618"></a>05618 
<a name="l05619"></a>05619   <span class="keywordflow">return</span> NULL;
<a name="l05620"></a>05620 }
<a name="l05621"></a>05621 
<a name="l05622"></a>05622 <span class="preprocessor">#else </span><span class="comment">/* HAVE_LIBEXPAT */</span>
<a name="l05623"></a>05623 
<a name="l05624"></a>05624 <span class="preprocessor">#include &quot;<a class="code" href="xml-support_8h.html">xml-support.h</a>&quot;</span>
<a name="l05625"></a>05625 
<a name="l05626"></a>05626 <span class="comment">/* Handle the start of a &lt;memory&gt; element.  */</span>
<a name="l05627"></a>05627 
<a name="l05628"></a>05628 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l05629"></a>05629 traceframe_info_start_memory (<span class="keyword">struct</span> gdb_xml_parser *parser,
<a name="l05630"></a>05630                               <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structgdb__xml__element.html">gdb_xml_element</a> *element,
<a name="l05631"></a>05631                               <span class="keywordtype">void</span> *user_data, <a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a>(<a class="code" href="structgdb__xml__value.html">gdb_xml_value_s</a>) *attributes)
<a name="l05632"></a>05632 {
<a name="l05633"></a>05633   <span class="keyword">struct </span>traceframe_info *info = user_data;
<a name="l05634"></a>05634   <span class="keyword">struct </span><a class="code" href="structmem__range.html">mem_range</a> *r = <a class="code" href="vec_8h.html#a8d090c0524726d00931070e0c438ba3f">VEC_safe_push</a> (<a class="code" href="structmem__range.html">mem_range_s</a>, info-&gt;memory, NULL);
<a name="l05635"></a>05635   <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> *start_p, *length_p;
<a name="l05636"></a>05636 
<a name="l05637"></a>05637   start_p = <a class="code" href="xml-support_8h.html#a74f5337b744544eaea0c0c503794bccb">xml_find_attribute</a> (attributes, <span class="stringliteral">&quot;start&quot;</span>)-&gt;<a class="code" href="structgdb__xml__value.html#a9c355edbd7f0b2a5158a039a324b9137">value</a>;
<a name="l05638"></a>05638   length_p = <a class="code" href="xml-support_8h.html#a74f5337b744544eaea0c0c503794bccb">xml_find_attribute</a> (attributes, <span class="stringliteral">&quot;length&quot;</span>)-&gt;<a class="code" href="structgdb__xml__value.html#a9c355edbd7f0b2a5158a039a324b9137">value</a>;
<a name="l05639"></a>05639 
<a name="l05640"></a>05640   r-&gt;<a class="code" href="structmem__range.html#af0c57d66bc3b5fc21cfba6dfb161f618">start</a> = *start_p;
<a name="l05641"></a>05641   r-&gt;<a class="code" href="structmem__range.html#a7dd2d185dbacbc0a099e55a2cffb0696">length</a> = *length_p;
<a name="l05642"></a>05642 }
<a name="l05643"></a>05643 
<a name="l05644"></a>05644 <span class="comment">/* Handle the start of a &lt;tvar&gt; element.  */</span>
<a name="l05645"></a>05645 
<a name="l05646"></a>05646 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l05647"></a>05647 traceframe_info_start_tvar (<span class="keyword">struct</span> gdb_xml_parser *parser,
<a name="l05648"></a>05648                              <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structgdb__xml__element.html">gdb_xml_element</a> *element,
<a name="l05649"></a>05649                              <span class="keywordtype">void</span> *user_data,
<a name="l05650"></a>05650                              <a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a>(<a class="code" href="structgdb__xml__value.html">gdb_xml_value_s</a>) *attributes)
<a name="l05651"></a>05651 {
<a name="l05652"></a>05652   <span class="keyword">struct </span>traceframe_info *info = user_data;
<a name="l05653"></a>05653   <span class="keyword">const</span> <span class="keywordtype">char</span> *id_attrib = <a class="code" href="xml-support_8h.html#a74f5337b744544eaea0c0c503794bccb">xml_find_attribute</a> (attributes, <span class="stringliteral">&quot;id&quot;</span>)-&gt;<a class="code" href="structgdb__xml__value.html#a9c355edbd7f0b2a5158a039a324b9137">value</a>;
<a name="l05654"></a>05654   <span class="keywordtype">int</span> <span class="keywordtype">id</span> = <a class="code" href="xml-support_8h.html#af54bbb2ff29049761a079ab318fa87b6">gdb_xml_parse_ulongest</a> (parser, id_attrib);
<a name="l05655"></a>05655 
<a name="l05656"></a>05656   <a class="code" href="vec_8h.html#a8d090c0524726d00931070e0c438ba3f">VEC_safe_push</a> (<span class="keywordtype">int</span>, info-&gt;tvars, <span class="keywordtype">id</span>);
<a name="l05657"></a>05657 }
<a name="l05658"></a>05658 
<a name="l05659"></a>05659 <span class="comment">/* Discard the constructed trace frame info (if an error occurs).  */</span>
<a name="l05660"></a>05660 
<a name="l05661"></a>05661 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l05662"></a>05662 free_result (<span class="keywordtype">void</span> *p)
<a name="l05663"></a>05663 {
<a name="l05664"></a>05664   <span class="keyword">struct </span>traceframe_info *result = p;
<a name="l05665"></a>05665 
<a name="l05666"></a>05666   free_traceframe_info (result);
<a name="l05667"></a>05667 }
<a name="l05668"></a>05668 
<a name="l05669"></a>05669 <span class="comment">/* The allowed elements and attributes for an XML memory map.  */</span>
<a name="l05670"></a>05670 
<a name="l05671"></a>05671 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structgdb__xml__attribute.html">gdb_xml_attribute</a> memory_attributes[] = {
<a name="l05672"></a>05672   { <span class="stringliteral">&quot;start&quot;</span>, <a class="code" href="xml-support_8h.html#ad7590aac3d719e762ee403f8a636909cacb1c51f59f5ba5ff98df901325f0f36a">GDB_XML_AF_NONE</a>, <a class="code" href="xml-support_8h.html#a7f77f5efa6a92dde241b527acc6f0289">gdb_xml_parse_attr_ulongest</a>, NULL },
<a name="l05673"></a>05673   { <span class="stringliteral">&quot;length&quot;</span>, <a class="code" href="xml-support_8h.html#ad7590aac3d719e762ee403f8a636909cacb1c51f59f5ba5ff98df901325f0f36a">GDB_XML_AF_NONE</a>, <a class="code" href="xml-support_8h.html#a7f77f5efa6a92dde241b527acc6f0289">gdb_xml_parse_attr_ulongest</a>, NULL },
<a name="l05674"></a>05674   { NULL, <a class="code" href="xml-support_8h.html#ad7590aac3d719e762ee403f8a636909cacb1c51f59f5ba5ff98df901325f0f36a">GDB_XML_AF_NONE</a>, NULL, NULL }
<a name="l05675"></a>05675 };
<a name="l05676"></a>05676 
<a name="l05677"></a>05677 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structgdb__xml__attribute.html">gdb_xml_attribute</a> tvar_attributes[] = {
<a name="l05678"></a>05678   { <span class="stringliteral">&quot;id&quot;</span>, <a class="code" href="xml-support_8h.html#ad7590aac3d719e762ee403f8a636909cacb1c51f59f5ba5ff98df901325f0f36a">GDB_XML_AF_NONE</a>, NULL, NULL },
<a name="l05679"></a>05679   { NULL, <a class="code" href="xml-support_8h.html#ad7590aac3d719e762ee403f8a636909cacb1c51f59f5ba5ff98df901325f0f36a">GDB_XML_AF_NONE</a>, NULL, NULL }
<a name="l05680"></a>05680 };
<a name="l05681"></a>05681 
<a name="l05682"></a>05682 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structgdb__xml__element.html">gdb_xml_element</a> traceframe_info_children[] = {
<a name="l05683"></a>05683   { <span class="stringliteral">&quot;memory&quot;</span>, memory_attributes, NULL,
<a name="l05684"></a>05684     <a class="code" href="xml-support_8h.html#a227ce2d3226a4071f6f6e24533d7294fa59b5e6c57fa749b144c9a2b124477da1">GDB_XML_EF_REPEATABLE</a> | <a class="code" href="xml-support_8h.html#a227ce2d3226a4071f6f6e24533d7294fa77819149b72011fbf5f296e5fc6b24ec">GDB_XML_EF_OPTIONAL</a>,
<a name="l05685"></a>05685     traceframe_info_start_memory, NULL },
<a name="l05686"></a>05686   { <span class="stringliteral">&quot;tvar&quot;</span>, tvar_attributes, NULL,
<a name="l05687"></a>05687     <a class="code" href="xml-support_8h.html#a227ce2d3226a4071f6f6e24533d7294fa59b5e6c57fa749b144c9a2b124477da1">GDB_XML_EF_REPEATABLE</a> | <a class="code" href="xml-support_8h.html#a227ce2d3226a4071f6f6e24533d7294fa77819149b72011fbf5f296e5fc6b24ec">GDB_XML_EF_OPTIONAL</a>,
<a name="l05688"></a>05688     traceframe_info_start_tvar, NULL },
<a name="l05689"></a>05689   { NULL, NULL, NULL, <a class="code" href="xml-support_8h.html#a227ce2d3226a4071f6f6e24533d7294fa3f9d0cb35bcb974ebe336db3f90c2105">GDB_XML_EF_NONE</a>, NULL, NULL }
<a name="l05690"></a>05690 };
<a name="l05691"></a>05691 
<a name="l05692"></a>05692 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structgdb__xml__element.html">gdb_xml_element</a> traceframe_info_elements[] = {
<a name="l05693"></a>05693   { <span class="stringliteral">&quot;traceframe-info&quot;</span>, NULL, traceframe_info_children, <a class="code" href="xml-support_8h.html#a227ce2d3226a4071f6f6e24533d7294fa3f9d0cb35bcb974ebe336db3f90c2105">GDB_XML_EF_NONE</a>,
<a name="l05694"></a>05694     NULL, NULL },
<a name="l05695"></a>05695   { NULL, NULL, NULL, <a class="code" href="xml-support_8h.html#a227ce2d3226a4071f6f6e24533d7294fa3f9d0cb35bcb974ebe336db3f90c2105">GDB_XML_EF_NONE</a>, NULL, NULL }
<a name="l05696"></a>05696 };
<a name="l05697"></a>05697 
<a name="l05698"></a>05698 <span class="comment">/* Parse a traceframe-info XML document.  */</span>
<a name="l05699"></a>05699 
<a name="l05700"></a>05700 <span class="keyword">struct </span>traceframe_info *
<a name="l05701"></a>05701 <a class="code" href="tracepoint_8c.html#a6d877e8adde731cbc4ec8db79b33b681">parse_traceframe_info</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *tframe_info)
<a name="l05702"></a>05702 {
<a name="l05703"></a>05703   <span class="keyword">struct </span>traceframe_info *result;
<a name="l05704"></a>05704   <span class="keyword">struct </span>cleanup *back_to;
<a name="l05705"></a>05705 
<a name="l05706"></a>05706   result = XCNEW (<span class="keyword">struct</span> traceframe_info);
<a name="l05707"></a>05707   back_to = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (free_result, result);
<a name="l05708"></a>05708 
<a name="l05709"></a>05709   <span class="keywordflow">if</span> (<a class="code" href="xml-support_8h.html#a4aec0961d01ba8211f356ef9503f7a4b">gdb_xml_parse_quick</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;trace frame info&quot;</span>),
<a name="l05710"></a>05710                            <span class="stringliteral">&quot;traceframe-info.dtd&quot;</span>, traceframe_info_elements,
<a name="l05711"></a>05711                            tframe_info, result) == 0)
<a name="l05712"></a>05712     {
<a name="l05713"></a>05713       <span class="comment">/* Parsed successfully, keep the result.  */</span>
<a name="l05714"></a>05714       <a class="code" href="cleanups_8c.html#a5ec3987bf995edcc44def9e17ada6eba">discard_cleanups</a> (back_to);
<a name="l05715"></a>05715 
<a name="l05716"></a>05716       <span class="keywordflow">return</span> result;
<a name="l05717"></a>05717     }
<a name="l05718"></a>05718 
<a name="l05719"></a>05719   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (back_to);
<a name="l05720"></a>05720   <span class="keywordflow">return</span> NULL;
<a name="l05721"></a>05721 }
<a name="l05722"></a>05722 
<a name="l05723"></a>05723 <span class="preprocessor">#endif </span><span class="comment">/* HAVE_LIBEXPAT */</span>
<a name="l05724"></a>05724 
<a name="l05725"></a>05725 <span class="comment">/* Returns the traceframe_info object for the current traceframe.</span>
<a name="l05726"></a>05726 <span class="comment">   This is where we avoid re-fetching the object from the target if we</span>
<a name="l05727"></a>05727 <span class="comment">   already have it cached.  */</span>
<a name="l05728"></a>05728 
<a name="l05729"></a>05729 <span class="keyword">struct </span>traceframe_info *
<a name="l05730"></a><a class="code" href="tracepoint_8h.html#abb3dd8b5472553fe9a5b222fd23ea177">05730</a> <a class="code" href="tracepoint_8c.html#abb3dd8b5472553fe9a5b222fd23ea177">get_traceframe_info</a> (<span class="keywordtype">void</span>)
<a name="l05731"></a>05731 {
<a name="l05732"></a>05732   <span class="keywordflow">if</span> (traceframe_info == NULL)
<a name="l05733"></a>05733     traceframe_info = <a class="code" href="target_8h.html#a04b719c1438b72f8495748a2551384d1">target_traceframe_info</a> ();
<a name="l05734"></a>05734 
<a name="l05735"></a>05735   <span class="keywordflow">return</span> traceframe_info;
<a name="l05736"></a>05736 }
<a name="l05737"></a>05737 
<a name="l05738"></a>05738 <span class="comment">/* If the target supports the query, return in RESULT the set of</span>
<a name="l05739"></a>05739 <span class="comment">   collected memory in the current traceframe, found within the LEN</span>
<a name="l05740"></a>05740 <span class="comment">   bytes range starting at MEMADDR.  Returns true if the target</span>
<a name="l05741"></a>05741 <span class="comment">   supports the query, otherwise returns false, and RESULT is left</span>
<a name="l05742"></a>05742 <span class="comment">   undefined.  */</span>
<a name="l05743"></a>05743 
<a name="l05744"></a>05744 <span class="keywordtype">int</span>
<a name="l05745"></a><a class="code" href="tracepoint_8h.html#a7a4773385bc6ad9ca1704981f3186867">05745</a> <a class="code" href="tracepoint_8c.html#a7a4773385bc6ad9ca1704981f3186867">traceframe_available_memory</a> (<a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a>(<a class="code" href="structmem__range.html">mem_range_s</a>) **result,
<a name="l05746"></a>05746                              <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> <a class="code" href="exec_8h.html#ab268c3184bf49615e16de006a296a542">memaddr</a>, <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> len)
<a name="l05747"></a>05747 {
<a name="l05748"></a>05748   <span class="keyword">struct </span>traceframe_info *info = <a class="code" href="tracepoint_8c.html#abb3dd8b5472553fe9a5b222fd23ea177">get_traceframe_info</a> ();
<a name="l05749"></a>05749 
<a name="l05750"></a>05750   <span class="keywordflow">if</span> (info != NULL)
<a name="l05751"></a>05751     {
<a name="l05752"></a>05752       <span class="keyword">struct </span><a class="code" href="structmem__range.html">mem_range</a> *r;
<a name="l05753"></a>05753       <span class="keywordtype">int</span> i;
<a name="l05754"></a>05754 
<a name="l05755"></a>05755       *result = NULL;
<a name="l05756"></a>05756 
<a name="l05757"></a>05757       <span class="keywordflow">for</span> (i = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="structmem__range.html">mem_range_s</a>, info-&gt;memory, i, r); i++)
<a name="l05758"></a>05758         <span class="keywordflow">if</span> (<a class="code" href="memrange_8c.html#a3d1f4c93febac91bd950ea20743947bf">mem_ranges_overlap</a> (r-&gt;<a class="code" href="structmem__range.html#af0c57d66bc3b5fc21cfba6dfb161f618">start</a>, r-&gt;<a class="code" href="structmem__range.html#a7dd2d185dbacbc0a099e55a2cffb0696">length</a>, memaddr, len))
<a name="l05759"></a>05759           {
<a name="l05760"></a>05760             <a class="code" href="defs_8h.html#a4df4af8771b1016a24976757026f4984">ULONGEST</a> lo1, hi1, lo2, hi2;
<a name="l05761"></a>05761             <span class="keyword">struct </span><a class="code" href="structmem__range.html">mem_range</a> *nr;
<a name="l05762"></a>05762 
<a name="l05763"></a>05763             lo1 = <a class="code" href="exec_8h.html#ab268c3184bf49615e16de006a296a542">memaddr</a>;
<a name="l05764"></a>05764             hi1 = memaddr + <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>;
<a name="l05765"></a>05765 
<a name="l05766"></a>05766             lo2 = r-&gt;<a class="code" href="structmem__range.html#af0c57d66bc3b5fc21cfba6dfb161f618">start</a>;
<a name="l05767"></a>05767             hi2 = r-&gt;<a class="code" href="structmem__range.html#af0c57d66bc3b5fc21cfba6dfb161f618">start</a> + r-&gt;<a class="code" href="structmem__range.html#a7dd2d185dbacbc0a099e55a2cffb0696">length</a>;
<a name="l05768"></a>05768 
<a name="l05769"></a>05769             nr = <a class="code" href="vec_8h.html#a8d090c0524726d00931070e0c438ba3f">VEC_safe_push</a> (<a class="code" href="structmem__range.html">mem_range_s</a>, *result, NULL);
<a name="l05770"></a>05770 
<a name="l05771"></a>05771             nr-&gt;<a class="code" href="structmem__range.html#af0c57d66bc3b5fc21cfba6dfb161f618">start</a> = <a class="code" href="environ_8c.html#affe776513b24d84b39af8ab0930fef7f">max</a> (lo1, lo2);
<a name="l05772"></a>05772             nr-&gt;<a class="code" href="structmem__range.html#a7dd2d185dbacbc0a099e55a2cffb0696">length</a> = <a class="code" href="environ_8c.html#ac6afabdc09a49a433ee19d8a9486056d">min</a> (hi1, hi2) - nr-&gt;<a class="code" href="structmem__range.html#af0c57d66bc3b5fc21cfba6dfb161f618">start</a>;
<a name="l05773"></a>05773           }
<a name="l05774"></a>05774 
<a name="l05775"></a>05775       <a class="code" href="memrange_8c.html#aed28e0f23b22120dc9c43e54d7812366">normalize_mem_ranges</a> (*result);
<a name="l05776"></a>05776       <span class="keywordflow">return</span> 1;
<a name="l05777"></a>05777     }
<a name="l05778"></a>05778 
<a name="l05779"></a>05779   <span class="keywordflow">return</span> 0;
<a name="l05780"></a>05780 }
<a name="l05781"></a>05781 
<a name="l05782"></a>05782 <span class="comment">/* Implementation of `sdata&#39; variable.  */</span>
<a name="l05783"></a>05783 
<a name="l05784"></a>05784 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structinternalvar__funcs.html">internalvar_funcs</a> sdata_funcs =
<a name="l05785"></a>05785 {
<a name="l05786"></a>05786   sdata_make_value,
<a name="l05787"></a>05787   NULL,
<a name="l05788"></a>05788   NULL
<a name="l05789"></a>05789 };
<a name="l05790"></a>05790 
<a name="l05791"></a>05791 <span class="comment">/* module initialization */</span>
<a name="l05792"></a>05792 <span class="keywordtype">void</span>
<a name="l05793"></a><a class="code" href="tracepoint_8c.html#ad3ee17b05fd1f5dfb9188d86fd1902ca">05793</a> <a class="code" href="init_8c.html#acf96db222e05df15fa3504e873004299">_initialize_tracepoint</a> (<span class="keywordtype">void</span>)
<a name="l05794"></a>05794 {
<a name="l05795"></a>05795   <span class="keyword">struct </span><a class="code" href="structcmd__list__element.html">cmd_list_element</a> *c;
<a name="l05796"></a>05796 
<a name="l05797"></a>05797   <span class="comment">/* Explicitly create without lookup, since that tries to create a</span>
<a name="l05798"></a>05798 <span class="comment">     value with a void typed value, and when we get here, gdbarch</span>
<a name="l05799"></a>05799 <span class="comment">     isn&#39;t initialized yet.  At this point, we&#39;re quite sure there</span>
<a name="l05800"></a>05800 <span class="comment">     isn&#39;t another convenience variable of the same name.  */</span>
<a name="l05801"></a>05801   <a class="code" href="value_8c.html#ae5de63598ca03e10e1cfbb5586771d66">create_internalvar_type_lazy</a> (<span class="stringliteral">&quot;_sdata&quot;</span>, &amp;sdata_funcs, NULL);
<a name="l05802"></a>05802 
<a name="l05803"></a>05803   traceframe_number = -1;
<a name="l05804"></a>05804   tracepoint_number = -1;
<a name="l05805"></a>05805 
<a name="l05806"></a>05806   <a class="code" href="cli-decode_8c.html#a9f6cd2f7798c32a7a27cab617e71cf6a">add_info</a> (<span class="stringliteral">&quot;scope&quot;</span>, scope_info,
<a name="l05807"></a>05807             <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;List the variables local to a scope&quot;</span>));
<a name="l05808"></a>05808 
<a name="l05809"></a>05809   <a class="code" href="cli-decode_8c.html#ab87b0ba51ed9aa4c8aac0c96373537f8">add_cmd</a> (<span class="stringliteral">&quot;tracepoints&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ad11a6f2eabeb9fa4cfd96d211d58581f">class_trace</a>, NULL,
<a name="l05810"></a>05810            <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Tracing of program execution without stopping the program.&quot;</span>),
<a name="l05811"></a>05811            &amp;<a class="code" href="cli-cmds_8c.html#a6b7ab0355d0fa8d6ce7d5feb83ff78e7">cmdlist</a>);
<a name="l05812"></a>05812 
<a name="l05813"></a>05813   <a class="code" href="cli-decode_8c.html#a0df0ca36d9acd96440e24407cbef593c">add_com</a> (<span class="stringliteral">&quot;tdump&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ad11a6f2eabeb9fa4cfd96d211d58581f">class_trace</a>, trace_dump_command,
<a name="l05814"></a>05814            <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Print everything collected at the current tracepoint.&quot;</span>));
<a name="l05815"></a>05815 
<a name="l05816"></a>05816   <a class="code" href="cli-decode_8c.html#a0df0ca36d9acd96440e24407cbef593c">add_com</a> (<span class="stringliteral">&quot;tsave&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ad11a6f2eabeb9fa4cfd96d211d58581f">class_trace</a>, trace_save_command, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05817"></a>05817 <span class="stringliteral">Save the trace data to a file.\n\</span>
<a name="l05818"></a>05818 <span class="stringliteral">Use the &#39;-ctf&#39; option to save the data to CTF format.\n\</span>
<a name="l05819"></a>05819 <span class="stringliteral">Use the &#39;-r&#39; option to direct the target to save directly to the file,\n\</span>
<a name="l05820"></a>05820 <span class="stringliteral">using its own filesystem.&quot;</span>));
<a name="l05821"></a>05821 
<a name="l05822"></a>05822   c = <a class="code" href="cli-decode_8c.html#a0df0ca36d9acd96440e24407cbef593c">add_com</a> (<span class="stringliteral">&quot;tvariable&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ad11a6f2eabeb9fa4cfd96d211d58581f">class_trace</a>, trace_variable_command,<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05823"></a>05823 <span class="stringliteral">Define a trace state variable.\n\</span>
<a name="l05824"></a>05824 <span class="stringliteral">Argument is a $-prefixed name, optionally followed\n\</span>
<a name="l05825"></a>05825 <span class="stringliteral">by &#39;=&#39; and an expression that sets the initial value\n\</span>
<a name="l05826"></a>05826 <span class="stringliteral">at the start of tracing.&quot;</span>));
<a name="l05827"></a>05827   <a class="code" href="command_8h.html#abe42a75e35cfa78e2574e94904d86713">set_cmd_completer</a> (c, expression_completer);
<a name="l05828"></a>05828 
<a name="l05829"></a>05829   <a class="code" href="cli-decode_8c.html#ab87b0ba51ed9aa4c8aac0c96373537f8">add_cmd</a> (<span class="stringliteral">&quot;tvariable&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ad11a6f2eabeb9fa4cfd96d211d58581f">class_trace</a>, delete_trace_variable_command, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05830"></a>05830 <span class="stringliteral">Delete one or more trace state variables.\n\</span>
<a name="l05831"></a>05831 <span class="stringliteral">Arguments are the names of the variables to delete.\n\</span>
<a name="l05832"></a>05832 <span class="stringliteral">If no arguments are supplied, delete all variables.&quot;</span>), &amp;<a class="code" href="cli-cmds_8c.html#a38161c9c3dd4b9956acc3ba4456bcdd7">deletelist</a>);
<a name="l05833"></a>05833   <span class="comment">/* FIXME add a trace variable completer.  */</span>
<a name="l05834"></a>05834 
<a name="l05835"></a>05835   <a class="code" href="cli-decode_8c.html#a9f6cd2f7798c32a7a27cab617e71cf6a">add_info</a> (<span class="stringliteral">&quot;tvariables&quot;</span>, tvariables_info, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05836"></a>05836 <span class="stringliteral">Status of trace state variables and their values.\n\</span>
<a name="l05837"></a>05837 <span class="stringliteral">&quot;</span>));
<a name="l05838"></a>05838 
<a name="l05839"></a>05839   <a class="code" href="cli-decode_8c.html#a9f6cd2f7798c32a7a27cab617e71cf6a">add_info</a> (<span class="stringliteral">&quot;static-tracepoint-markers&quot;</span>,
<a name="l05840"></a>05840             info_static_tracepoint_markers_command, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05841"></a>05841 <span class="stringliteral">List target static tracepoints markers.\n\</span>
<a name="l05842"></a>05842 <span class="stringliteral">&quot;</span>));
<a name="l05843"></a>05843 
<a name="l05844"></a>05844   <a class="code" href="cli-decode_8c.html#a8abc1e9af59eb3cb12bb03977d5e8e5a">add_prefix_cmd</a> (<span class="stringliteral">&quot;tfind&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ad11a6f2eabeb9fa4cfd96d211d58581f">class_trace</a>, trace_find_command, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05845"></a>05845 <span class="stringliteral">Select a trace frame;\n\</span>
<a name="l05846"></a>05846 <span class="stringliteral">No argument means forward by one frame; &#39;-&#39; means backward by one frame.&quot;</span>),
<a name="l05847"></a>05847                   &amp;tfindlist, <span class="stringliteral">&quot;tfind &quot;</span>, 1, &amp;<a class="code" href="cli-cmds_8c.html#a6b7ab0355d0fa8d6ce7d5feb83ff78e7">cmdlist</a>);
<a name="l05848"></a>05848 
<a name="l05849"></a>05849   <a class="code" href="cli-decode_8c.html#ab87b0ba51ed9aa4c8aac0c96373537f8">add_cmd</a> (<span class="stringliteral">&quot;outside&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ad11a6f2eabeb9fa4cfd96d211d58581f">class_trace</a>, trace_find_outside_command, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05850"></a>05850 <span class="stringliteral">Select a trace frame whose PC is outside the given range (exclusive).\n\</span>
<a name="l05851"></a>05851 <span class="stringliteral">Usage: tfind outside addr1, addr2&quot;</span>),
<a name="l05852"></a>05852            &amp;tfindlist);
<a name="l05853"></a>05853 
<a name="l05854"></a>05854   <a class="code" href="cli-decode_8c.html#ab87b0ba51ed9aa4c8aac0c96373537f8">add_cmd</a> (<span class="stringliteral">&quot;range&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ad11a6f2eabeb9fa4cfd96d211d58581f">class_trace</a>, trace_find_range_command, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05855"></a>05855 <span class="stringliteral">Select a trace frame whose PC is in the given range (inclusive).\n\</span>
<a name="l05856"></a>05856 <span class="stringliteral">Usage: tfind range addr1,addr2&quot;</span>),
<a name="l05857"></a>05857            &amp;tfindlist);
<a name="l05858"></a>05858 
<a name="l05859"></a>05859   <a class="code" href="cli-decode_8c.html#ab87b0ba51ed9aa4c8aac0c96373537f8">add_cmd</a> (<span class="stringliteral">&quot;line&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ad11a6f2eabeb9fa4cfd96d211d58581f">class_trace</a>, trace_find_line_command, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05860"></a>05860 <span class="stringliteral">Select a trace frame by source line.\n\</span>
<a name="l05861"></a>05861 <span class="stringliteral">Argument can be a line number (with optional source file),\n\</span>
<a name="l05862"></a>05862 <span class="stringliteral">a function name, or &#39;*&#39; followed by an address.\n\</span>
<a name="l05863"></a>05863 <span class="stringliteral">Default argument is &#39;the next source line that was traced&#39;.&quot;</span>),
<a name="l05864"></a>05864            &amp;tfindlist);
<a name="l05865"></a>05865 
<a name="l05866"></a>05866   <a class="code" href="cli-decode_8c.html#ab87b0ba51ed9aa4c8aac0c96373537f8">add_cmd</a> (<span class="stringliteral">&quot;tracepoint&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ad11a6f2eabeb9fa4cfd96d211d58581f">class_trace</a>, trace_find_tracepoint_command, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05867"></a>05867 <span class="stringliteral">Select a trace frame by tracepoint number.\n\</span>
<a name="l05868"></a>05868 <span class="stringliteral">Default is the tracepoint for the current trace frame.&quot;</span>),
<a name="l05869"></a>05869            &amp;tfindlist);
<a name="l05870"></a>05870 
<a name="l05871"></a>05871   <a class="code" href="cli-decode_8c.html#ab87b0ba51ed9aa4c8aac0c96373537f8">add_cmd</a> (<span class="stringliteral">&quot;pc&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ad11a6f2eabeb9fa4cfd96d211d58581f">class_trace</a>, trace_find_pc_command, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05872"></a>05872 <span class="stringliteral">Select a trace frame by PC.\n\</span>
<a name="l05873"></a>05873 <span class="stringliteral">Default is the current PC, or the PC of the current trace frame.&quot;</span>),
<a name="l05874"></a>05874            &amp;tfindlist);
<a name="l05875"></a>05875 
<a name="l05876"></a>05876   <a class="code" href="cli-decode_8c.html#ab87b0ba51ed9aa4c8aac0c96373537f8">add_cmd</a> (<span class="stringliteral">&quot;end&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ad11a6f2eabeb9fa4cfd96d211d58581f">class_trace</a>, trace_find_end_command, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05877"></a>05877 <span class="stringliteral">De-select any trace frame and resume &#39;live&#39; debugging.&quot;</span>),
<a name="l05878"></a>05878            &amp;tfindlist);
<a name="l05879"></a>05879 
<a name="l05880"></a>05880   <a class="code" href="cli-decode_8c.html#a81a250b03b0a6626b31d35be82961c38">add_alias_cmd</a> (<span class="stringliteral">&quot;none&quot;</span>, <span class="stringliteral">&quot;end&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ad11a6f2eabeb9fa4cfd96d211d58581f">class_trace</a>, 0, &amp;tfindlist);
<a name="l05881"></a>05881 
<a name="l05882"></a>05882   <a class="code" href="cli-decode_8c.html#ab87b0ba51ed9aa4c8aac0c96373537f8">add_cmd</a> (<span class="stringliteral">&quot;start&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ad11a6f2eabeb9fa4cfd96d211d58581f">class_trace</a>, trace_find_start_command,
<a name="l05883"></a>05883            <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Select the first trace frame in the trace buffer.&quot;</span>),
<a name="l05884"></a>05884            &amp;tfindlist);
<a name="l05885"></a>05885 
<a name="l05886"></a>05886   <a class="code" href="cli-decode_8c.html#a0df0ca36d9acd96440e24407cbef593c">add_com</a> (<span class="stringliteral">&quot;tstatus&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ad11a6f2eabeb9fa4cfd96d211d58581f">class_trace</a>, trace_status_command,
<a name="l05887"></a>05887            <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Display the status of the current trace data collection.&quot;</span>));
<a name="l05888"></a>05888 
<a name="l05889"></a>05889   <a class="code" href="cli-decode_8c.html#a0df0ca36d9acd96440e24407cbef593c">add_com</a> (<span class="stringliteral">&quot;tstop&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ad11a6f2eabeb9fa4cfd96d211d58581f">class_trace</a>, trace_stop_command, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05890"></a>05890 <span class="stringliteral">Stop trace data collection.\n\</span>
<a name="l05891"></a>05891 <span class="stringliteral">Usage: tstop [ &lt;notes&gt; ... ]\n\</span>
<a name="l05892"></a>05892 <span class="stringliteral">Any arguments supplied are recorded with the trace as a stop reason and\n\</span>
<a name="l05893"></a>05893 <span class="stringliteral">reported by tstatus (if the target supports trace notes).&quot;</span>));
<a name="l05894"></a>05894 
<a name="l05895"></a>05895   <a class="code" href="cli-decode_8c.html#a0df0ca36d9acd96440e24407cbef593c">add_com</a> (<span class="stringliteral">&quot;tstart&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ad11a6f2eabeb9fa4cfd96d211d58581f">class_trace</a>, trace_start_command, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05896"></a>05896 <span class="stringliteral">Start trace data collection.\n\</span>
<a name="l05897"></a>05897 <span class="stringliteral">Usage: tstart [ &lt;notes&gt; ... ]\n\</span>
<a name="l05898"></a>05898 <span class="stringliteral">Any arguments supplied are recorded with the trace as a note and\n\</span>
<a name="l05899"></a>05899 <span class="stringliteral">reported by tstatus (if the target supports trace notes).&quot;</span>));
<a name="l05900"></a>05900 
<a name="l05901"></a>05901   <a class="code" href="cli-decode_8c.html#a0df0ca36d9acd96440e24407cbef593c">add_com</a> (<span class="stringliteral">&quot;end&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ad11a6f2eabeb9fa4cfd96d211d58581f">class_trace</a>, end_actions_pseudocommand, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05902"></a>05902 <span class="stringliteral">Ends a list of commands or actions.\n\</span>
<a name="l05903"></a>05903 <span class="stringliteral">Several GDB commands allow you to enter a list of commands or actions.\n\</span>
<a name="l05904"></a>05904 <span class="stringliteral">Entering \&quot;end\&quot; on a line by itself is the normal way to terminate\n\</span>
<a name="l05905"></a>05905 <span class="stringliteral">such a list.\n\n\</span>
<a name="l05906"></a>05906 <span class="stringliteral">Note: the \&quot;end\&quot; command cannot be used at the gdb prompt.&quot;</span>));
<a name="l05907"></a>05907 
<a name="l05908"></a>05908   <a class="code" href="cli-decode_8c.html#a0df0ca36d9acd96440e24407cbef593c">add_com</a> (<span class="stringliteral">&quot;while-stepping&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ad11a6f2eabeb9fa4cfd96d211d58581f">class_trace</a>, while_stepping_pseudocommand, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05909"></a>05909 <span class="stringliteral">Specify single-stepping behavior at a tracepoint.\n\</span>
<a name="l05910"></a>05910 <span class="stringliteral">Argument is number of instructions to trace in single-step mode\n\</span>
<a name="l05911"></a>05911 <span class="stringliteral">following the tracepoint.  This command is normally followed by\n\</span>
<a name="l05912"></a>05912 <span class="stringliteral">one or more \&quot;collect\&quot; commands, to specify what to collect\n\</span>
<a name="l05913"></a>05913 <span class="stringliteral">while single-stepping.\n\n\</span>
<a name="l05914"></a>05914 <span class="stringliteral">Note: this command can only be used in a tracepoint \&quot;actions\&quot; list.&quot;</span>));
<a name="l05915"></a>05915 
<a name="l05916"></a>05916   <a class="code" href="cli-decode_8c.html#aeeea74da863db26c8d7fee1573f26a05">add_com_alias</a> (<span class="stringliteral">&quot;ws&quot;</span>, <span class="stringliteral">&quot;while-stepping&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ab3f4371cd43a9a1392c164b37cdef36f">class_alias</a>, 0);
<a name="l05917"></a>05917   <a class="code" href="cli-decode_8c.html#aeeea74da863db26c8d7fee1573f26a05">add_com_alias</a> (<span class="stringliteral">&quot;stepping&quot;</span>, <span class="stringliteral">&quot;while-stepping&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ab3f4371cd43a9a1392c164b37cdef36f">class_alias</a>, 0);
<a name="l05918"></a>05918 
<a name="l05919"></a>05919   <a class="code" href="cli-decode_8c.html#a0df0ca36d9acd96440e24407cbef593c">add_com</a> (<span class="stringliteral">&quot;collect&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ad11a6f2eabeb9fa4cfd96d211d58581f">class_trace</a>, collect_pseudocommand, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05920"></a>05920 <span class="stringliteral">Specify one or more data items to be collected at a tracepoint.\n\</span>
<a name="l05921"></a>05921 <span class="stringliteral">Accepts a comma-separated list of (one or more) expressions.  GDB will\n\</span>
<a name="l05922"></a>05922 <span class="stringliteral">collect all data (variables, registers) referenced by that expression.\n\</span>
<a name="l05923"></a>05923 <span class="stringliteral">Also accepts the following special arguments:\n\</span>
<a name="l05924"></a>05924 <span class="stringliteral">    $regs   -- all registers.\n\</span>
<a name="l05925"></a>05925 <span class="stringliteral">    $args   -- all function arguments.\n\</span>
<a name="l05926"></a>05926 <span class="stringliteral">    $locals -- all variables local to the block/function scope.\n\</span>
<a name="l05927"></a>05927 <span class="stringliteral">    $_sdata -- static tracepoint data (ignored for non-static tracepoints).\n\</span>
<a name="l05928"></a>05928 <span class="stringliteral">Note: this command can only be used in a tracepoint \&quot;actions\&quot; list.&quot;</span>));
<a name="l05929"></a>05929 
<a name="l05930"></a>05930   <a class="code" href="cli-decode_8c.html#a0df0ca36d9acd96440e24407cbef593c">add_com</a> (<span class="stringliteral">&quot;teval&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ad11a6f2eabeb9fa4cfd96d211d58581f">class_trace</a>, teval_pseudocommand, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05931"></a>05931 <span class="stringliteral">Specify one or more expressions to be evaluated at a tracepoint.\n\</span>
<a name="l05932"></a>05932 <span class="stringliteral">Accepts a comma-separated list of (one or more) expressions.\n\</span>
<a name="l05933"></a>05933 <span class="stringliteral">The result of each evaluation will be discarded.\n\</span>
<a name="l05934"></a>05934 <span class="stringliteral">Note: this command can only be used in a tracepoint \&quot;actions\&quot; list.&quot;</span>));
<a name="l05935"></a>05935 
<a name="l05936"></a>05936   <a class="code" href="cli-decode_8c.html#a0df0ca36d9acd96440e24407cbef593c">add_com</a> (<span class="stringliteral">&quot;actions&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ad11a6f2eabeb9fa4cfd96d211d58581f">class_trace</a>, trace_actions_command, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05937"></a>05937 <span class="stringliteral">Specify the actions to be taken at a tracepoint.\n\</span>
<a name="l05938"></a>05938 <span class="stringliteral">Tracepoint actions may include collecting of specified data,\n\</span>
<a name="l05939"></a>05939 <span class="stringliteral">single-stepping, or enabling/disabling other tracepoints,\n\</span>
<a name="l05940"></a>05940 <span class="stringliteral">depending on target&#39;s capabilities.&quot;</span>));
<a name="l05941"></a>05941 
<a name="l05942"></a>05942   <a class="code" href="tracepoint_8h.html#a60e1b54e67c4c56da92593798803789e">default_collect</a> = xstrdup (<span class="stringliteral">&quot;&quot;</span>);
<a name="l05943"></a>05943   <a class="code" href="cli-decode_8c.html#ae1abcdc8b2f24a182f5ba065cf50c81b">add_setshow_string_cmd</a> (<span class="stringliteral">&quot;default-collect&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ad11a6f2eabeb9fa4cfd96d211d58581f">class_trace</a>,
<a name="l05944"></a>05944                           &amp;<a class="code" href="tracepoint_8h.html#a60e1b54e67c4c56da92593798803789e">default_collect</a>, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05945"></a>05945 <span class="stringliteral">Set the list of expressions to collect by default&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05946"></a>05946 <span class="stringliteral">Show the list of expressions to collect by default&quot;</span>), NULL,
<a name="l05947"></a>05947                           NULL, NULL,
<a name="l05948"></a>05948                           &amp;<a class="code" href="cli-cmds_8c.html#a723e0174d833cba0aa82fb936a56c8fa">setlist</a>, &amp;<a class="code" href="cli-cmds_8c.html#a003932aa76fd3f41763ecc6bee5e2ca8">showlist</a>);
<a name="l05949"></a>05949 
<a name="l05950"></a>05950   <a class="code" href="cli-decode_8c.html#ad86a0f135b6c546ae7ffbb41fd72e14f">add_setshow_boolean_cmd</a> (<span class="stringliteral">&quot;disconnected-tracing&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49afbf489a4abce7e8770b178aa54f0908b">no_class</a>,
<a name="l05951"></a>05951                            &amp;disconnected_tracing, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05952"></a>05952 <span class="stringliteral">Set whether tracing continues after GDB disconnects.&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05953"></a>05953 <span class="stringliteral">Show whether tracing continues after GDB disconnects.&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05954"></a>05954 <span class="stringliteral">Use this to continue a tracing run even if GDB disconnects\n\</span>
<a name="l05955"></a>05955 <span class="stringliteral">or detaches from the target.  You can reconnect later and look at\n\</span>
<a name="l05956"></a>05956 <span class="stringliteral">trace data collected in the meantime.&quot;</span>),
<a name="l05957"></a>05957                            set_disconnected_tracing,
<a name="l05958"></a>05958                            NULL,
<a name="l05959"></a>05959                            &amp;<a class="code" href="cli-cmds_8c.html#a723e0174d833cba0aa82fb936a56c8fa">setlist</a>,
<a name="l05960"></a>05960                            &amp;<a class="code" href="cli-cmds_8c.html#a003932aa76fd3f41763ecc6bee5e2ca8">showlist</a>);
<a name="l05961"></a>05961 
<a name="l05962"></a>05962   <a class="code" href="cli-decode_8c.html#ad86a0f135b6c546ae7ffbb41fd72e14f">add_setshow_boolean_cmd</a> (<span class="stringliteral">&quot;circular-trace-buffer&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49afbf489a4abce7e8770b178aa54f0908b">no_class</a>,
<a name="l05963"></a>05963                            &amp;circular_trace_buffer, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05964"></a>05964 <span class="stringliteral">Set target&#39;s use of circular trace buffer.&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05965"></a>05965 <span class="stringliteral">Show target&#39;s use of circular trace buffer.&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05966"></a>05966 <span class="stringliteral">Use this to make the trace buffer into a circular buffer,\n\</span>
<a name="l05967"></a>05967 <span class="stringliteral">which will discard traceframes (oldest first) instead of filling\n\</span>
<a name="l05968"></a>05968 <span class="stringliteral">up and stopping the trace run.&quot;</span>),
<a name="l05969"></a>05969                            set_circular_trace_buffer,
<a name="l05970"></a>05970                            NULL,
<a name="l05971"></a>05971                            &amp;<a class="code" href="cli-cmds_8c.html#a723e0174d833cba0aa82fb936a56c8fa">setlist</a>,
<a name="l05972"></a>05972                            &amp;<a class="code" href="cli-cmds_8c.html#a003932aa76fd3f41763ecc6bee5e2ca8">showlist</a>);
<a name="l05973"></a>05973 
<a name="l05974"></a>05974   <a class="code" href="cli-decode_8c.html#a612ef4761e6c629ff1e0d2d79ab44fdd">add_setshow_zuinteger_unlimited_cmd</a> (<span class="stringliteral">&quot;trace-buffer-size&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49afbf489a4abce7e8770b178aa54f0908b">no_class</a>,
<a name="l05975"></a>05975                                        &amp;trace_buffer_size, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05976"></a>05976 <span class="stringliteral">Set requested size of trace buffer.&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05977"></a>05977 <span class="stringliteral">Show requested size of trace buffer.&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05978"></a>05978 <span class="stringliteral">Use this to choose a size for the trace buffer.  Some targets\n\</span>
<a name="l05979"></a>05979 <span class="stringliteral">may have fixed or limited buffer sizes.  Specifying \&quot;unlimited\&quot; or -1\n\</span>
<a name="l05980"></a>05980 <span class="stringliteral">disables any attempt to set the buffer size and lets the target choose.&quot;</span>),
<a name="l05981"></a>05981                                        set_trace_buffer_size, NULL,
<a name="l05982"></a>05982                                        &amp;<a class="code" href="cli-cmds_8c.html#a723e0174d833cba0aa82fb936a56c8fa">setlist</a>, &amp;<a class="code" href="cli-cmds_8c.html#a003932aa76fd3f41763ecc6bee5e2ca8">showlist</a>);
<a name="l05983"></a>05983 
<a name="l05984"></a>05984   <a class="code" href="cli-decode_8c.html#ae1abcdc8b2f24a182f5ba065cf50c81b">add_setshow_string_cmd</a> (<span class="stringliteral">&quot;trace-user&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ad11a6f2eabeb9fa4cfd96d211d58581f">class_trace</a>,
<a name="l05985"></a>05985                           &amp;trace_user, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05986"></a>05986 <span class="stringliteral">Set the user name to use for current and future trace runs&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05987"></a>05987 <span class="stringliteral">Show the user name to use for current and future trace runs&quot;</span>), NULL,
<a name="l05988"></a>05988                           set_trace_user, NULL,
<a name="l05989"></a>05989                           &amp;<a class="code" href="cli-cmds_8c.html#a723e0174d833cba0aa82fb936a56c8fa">setlist</a>, &amp;<a class="code" href="cli-cmds_8c.html#a003932aa76fd3f41763ecc6bee5e2ca8">showlist</a>);
<a name="l05990"></a>05990 
<a name="l05991"></a>05991   <a class="code" href="cli-decode_8c.html#ae1abcdc8b2f24a182f5ba065cf50c81b">add_setshow_string_cmd</a> (<span class="stringliteral">&quot;trace-notes&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ad11a6f2eabeb9fa4cfd96d211d58581f">class_trace</a>,
<a name="l05992"></a>05992                           &amp;trace_notes, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05993"></a>05993 <span class="stringliteral">Set notes string to use for current and future trace runs&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l05994"></a>05994 <span class="stringliteral">Show the notes string to use for current and future trace runs&quot;</span>), NULL,
<a name="l05995"></a>05995                           set_trace_notes, NULL,
<a name="l05996"></a>05996                           &amp;<a class="code" href="cli-cmds_8c.html#a723e0174d833cba0aa82fb936a56c8fa">setlist</a>, &amp;<a class="code" href="cli-cmds_8c.html#a003932aa76fd3f41763ecc6bee5e2ca8">showlist</a>);
<a name="l05997"></a>05997 
<a name="l05998"></a>05998   <a class="code" href="cli-decode_8c.html#ae1abcdc8b2f24a182f5ba065cf50c81b">add_setshow_string_cmd</a> (<span class="stringliteral">&quot;trace-stop-notes&quot;</span>, <a class="code" href="command_8h.html#ad71b5a938f3966cf81293bca79acef49ad11a6f2eabeb9fa4cfd96d211d58581f">class_trace</a>,
<a name="l05999"></a>05999                           &amp;trace_stop_notes, <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l06000"></a>06000 <span class="stringliteral">Set notes string to use for future tstop commands&quot;</span>), <a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;\</span>
<a name="l06001"></a>06001 <span class="stringliteral">Show the notes string to use for future tstop commands&quot;</span>), NULL,
<a name="l06002"></a>06002                           set_trace_stop_notes, NULL,
<a name="l06003"></a>06003                           &amp;<a class="code" href="cli-cmds_8c.html#a723e0174d833cba0aa82fb936a56c8fa">setlist</a>, &amp;<a class="code" href="cli-cmds_8c.html#a003932aa76fd3f41763ecc6bee5e2ca8">showlist</a>);
<a name="l06004"></a>06004 
<a name="l06005"></a>06005   init_tfile_ops ();
<a name="l06006"></a>06006 
<a name="l06007"></a>06007   <a class="code" href="target_8c.html#a7ca52d89a2cdf56c2c9fef612d6f2674">add_target_with_completer</a> (&amp;tfile_ops, filename_completer);
<a name="l06008"></a>06008 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Fri Oct 11 2013 14:12:27 for GDB (API) by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
