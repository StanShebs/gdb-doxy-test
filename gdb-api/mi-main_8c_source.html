<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>GDB (API): /home/stan/gdb/src/gdb/mi/mi-main.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">GDB (API)
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">/home/stan/gdb/src/gdb/mi/mi-main.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="mi-main_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* MI Command Set.</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">   Copyright (C) 2000-2013 Free Software Foundation, Inc.</span>
<a name="l00004"></a>00004 <span class="comment"></span>
<a name="l00005"></a>00005 <span class="comment">   Contributed by Cygnus Solutions (a Red Hat company).</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">   This file is part of GDB.</span>
<a name="l00008"></a>00008 <span class="comment"></span>
<a name="l00009"></a>00009 <span class="comment">   This program is free software; you can redistribute it and/or modify</span>
<a name="l00010"></a>00010 <span class="comment">   it under the terms of the GNU General Public License as published by</span>
<a name="l00011"></a>00011 <span class="comment">   the Free Software Foundation; either version 3 of the License, or</span>
<a name="l00012"></a>00012 <span class="comment">   (at your option) any later version.</span>
<a name="l00013"></a>00013 <span class="comment"></span>
<a name="l00014"></a>00014 <span class="comment">   This program is distributed in the hope that it will be useful,</span>
<a name="l00015"></a>00015 <span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00016"></a>00016 <span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00017"></a>00017 <span class="comment">   GNU General Public License for more details.</span>
<a name="l00018"></a>00018 <span class="comment"></span>
<a name="l00019"></a>00019 <span class="comment">   You should have received a copy of the GNU General Public License</span>
<a name="l00020"></a>00020 <span class="comment">   along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.  */</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="defs_8h.html">defs.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="arch-utils_8h.html">arch-utils.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="target_8h.html">target.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="inferior_8h.html">inferior.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="gdb__string_8h.html">gdb_string.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="exceptions_8h.html">exceptions.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="top_8h.html">top.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="gdbthread_8h.html">gdbthread.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="mi-cmds_8h.html">mi-cmds.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="mi-parse_8h.html">mi-parse.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="mi-getopt_8h.html">mi-getopt.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="mi-console_8h.html">mi-console.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="ui-out_8h.html">ui-out.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="mi-out_8h.html">mi-out.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="interps_8h.html">interps.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="event-loop_8h.html">event-loop.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="event-top_8h.html">event-top.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="gdbcore_8h.html">gdbcore.h</a>&quot;</span>            <span class="comment">/* For write_memory().  */</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="value_8h.html">value.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="regcache_8h.html">regcache.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="gdb_8h.html">gdb.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="frame_8h.html">frame.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="mi-main_8h.html">mi-main.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="mi-common_8h.html">mi-common.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="language_8h.html">language.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="valprint_8h.html">valprint.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="inferior_8h.html">inferior.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="osdata_8h.html">osdata.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;splay-tree.h&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="tracepoint_8h.html">tracepoint.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="ctf_8h.html">ctf.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="ada-lang_8h.html">ada-lang.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="linespec_8h.html">linespec.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#ifdef HAVE_PYTHON</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="python-internal_8h.html">python/python-internal.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#endif</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &lt;sys/time.h&gt;</span>
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 <span class="preprocessor">#if defined HAVE_SYS_RESOURCE_H</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span><span class="preprocessor">#include &lt;sys/resource.h&gt;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#endif</span>
<a name="l00065"></a>00065 <span class="preprocessor"></span>
<a name="l00066"></a>00066 <span class="preprocessor">#ifdef HAVE_GETRUSAGE</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span><span class="keyword">struct </span>rusage rusage;
<a name="l00068"></a>00068 <span class="preprocessor">#endif</span>
<a name="l00069"></a>00069 <span class="preprocessor"></span>
<a name="l00070"></a>00070 <span class="keyword">enum</span>
<a name="l00071"></a>00071   {
<a name="l00072"></a><a class="code" href="mi-main_8c.html#aa57e16cd48de3b9a989056ff8df26f84a12979d5360cf19b2d8d78b120084eae0">00072</a>     <a class="code" href="mi-cmd-break_8c.html#aa491173a6b1628f4ff82067b2e1ceaa9a12979d5360cf19b2d8d78b120084eae0">FROM_TTY</a> = 0
<a name="l00073"></a>00073   };
<a name="l00074"></a>00074 
<a name="l00075"></a><a class="code" href="mi-main_8c.html#af8ca1d2185e5fbf7cb113d43f0994ae9">00075</a> <span class="keywordtype">int</span> <a class="code" href="mi-cmds_8h.html#af8ca1d2185e5fbf7cb113d43f0994ae9">mi_debug_p</a>;
<a name="l00076"></a>00076 
<a name="l00077"></a><a class="code" href="mi-main_8c.html#a291315c01d39483f0026b8a849b70fba">00077</a> <span class="keyword">struct </span>ui_file *<a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>;
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="comment">/* This is used to pass the current command timestamp down to</span>
<a name="l00080"></a>00080 <span class="comment">   continuation routines.  */</span>
<a name="l00081"></a>00081 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structmi__timestamp.html">mi_timestamp</a> *current_command_ts;
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 <span class="keyword">static</span> <span class="keywordtype">int</span> do_timings = 0;
<a name="l00084"></a>00084 
<a name="l00085"></a><a class="code" href="mi-main_8h.html#a4f31fe20e2b760c8d54d42910947ef2d">00085</a> <span class="keywordtype">char</span> *<a class="code" href="mi-main_8c.html#a4f31fe20e2b760c8d54d42910947ef2d">current_token</a>;
<a name="l00086"></a>00086 <span class="comment">/* Few commands would like to know if options like --thread-group were</span>
<a name="l00087"></a>00087 <span class="comment">   explicitly specified.  This variable keeps the current parsed</span>
<a name="l00088"></a>00088 <span class="comment">   command including all option, and make it possible.  */</span>
<a name="l00089"></a>00089 <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="structmi__parse.html">mi_parse</a> *current_context;
<a name="l00090"></a>00090 
<a name="l00091"></a><a class="code" href="mi-main_8h.html#a974a29ac0dd1dbabd96ff5f85e378419">00091</a> <span class="keywordtype">int</span> <a class="code" href="mi-main_8c.html#a974a29ac0dd1dbabd96ff5f85e378419">running_result_record_printed</a> = 1;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093 <span class="comment">/* Flag indicating that the target has proceeded since the last</span>
<a name="l00094"></a>00094 <span class="comment">   command was issued.  */</span>
<a name="l00095"></a><a class="code" href="mi-main_8h.html#a987c1fbb7cbe6c0bf8abd268085acb0a">00095</a> <span class="keywordtype">int</span> <a class="code" href="mi-main_8c.html#a987c1fbb7cbe6c0bf8abd268085acb0a">mi_proceeded</a>;
<a name="l00096"></a>00096 
<a name="l00097"></a>00097 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="mi-main_8c.html#a15040a1734978c87f69e35c3271190a9">_initialize_mi_main</a> (<span class="keywordtype">void</span>);
<a name="l00098"></a>00098 <span class="keyword">static</span> <span class="keywordtype">void</span> mi_cmd_execute (<span class="keyword">struct</span> <a class="code" href="structmi__parse.html">mi_parse</a> *parse);
<a name="l00099"></a>00099 
<a name="l00100"></a>00100 <span class="keyword">static</span> <span class="keywordtype">void</span> mi_execute_cli_command (<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structmi__parse.html#a3fa5f533f6ec4666256acb88f33a4c11">cmd</a>, <span class="keywordtype">int</span> args_p,
<a name="l00101"></a>00101                                     <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structmi__parse.html#a2a3b25c334a4baddc6185fed4cb90c78">args</a>);
<a name="l00102"></a>00102 <span class="keyword">static</span> <span class="keywordtype">void</span> mi_execute_async_cli_command (<span class="keywordtype">char</span> *cli_command, 
<a name="l00103"></a>00103                                           <span class="keywordtype">char</span> **<a class="code" href="structmi__parse.html#a2caa41cd025f3b2e6ad7e35be03e2f24">argv</a>, <span class="keywordtype">int</span> <a class="code" href="structmi__parse.html#a6c0ecf896befd0f1d67c0c304a1f7b99">argc</a>);
<a name="l00104"></a>00104 <span class="keyword">static</span> <span class="keywordtype">int</span> register_changed_p (<span class="keywordtype">int</span> <a class="code" href="aarch64-tdep_8c.html#a6b3d1ad0bca4067ccaef1366bea0db04">regnum</a>, <span class="keyword">struct</span> regcache *,
<a name="l00105"></a>00105                                <span class="keyword">struct</span> regcache *);
<a name="l00106"></a>00106 <span class="keyword">static</span> <span class="keywordtype">void</span> output_register (<span class="keyword">struct</span> frame_info *, <span class="keywordtype">int</span> <a class="code" href="aarch64-tdep_8c.html#a6b3d1ad0bca4067ccaef1366bea0db04">regnum</a>, <span class="keywordtype">int</span> format,
<a name="l00107"></a>00107                              <span class="keywordtype">int</span> skip_unavailable);
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 <span class="comment">/* Command implementations.  FIXME: Is this libgdb?  No.  This is the MI</span>
<a name="l00110"></a>00110 <span class="comment">   layer that calls libgdb.  Any operation used in the below should be</span>
<a name="l00111"></a>00111 <span class="comment">   formalized.  */</span>
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 <span class="keyword">static</span> <span class="keywordtype">void</span> timestamp (<span class="keyword">struct</span> <a class="code" href="structmi__timestamp.html">mi_timestamp</a> *tv);
<a name="l00114"></a>00114 
<a name="l00115"></a>00115 <span class="keyword">static</span> <span class="keywordtype">void</span> print_diff_now (<span class="keyword">struct</span> <a class="code" href="structmi__timestamp.html">mi_timestamp</a> *start);
<a name="l00116"></a>00116 <span class="keyword">static</span> <span class="keywordtype">void</span> print_diff (<span class="keyword">struct</span> <a class="code" href="structmi__timestamp.html">mi_timestamp</a> *start, <span class="keyword">struct</span> <a class="code" href="structmi__timestamp.html">mi_timestamp</a> *end);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 <span class="keywordtype">void</span>
<a name="l00119"></a><a class="code" href="mi-main_8c.html#a3b585ff5bde63dc57dc8ccff63aabbf8">00119</a> <a class="code" href="mi-cmds_8h.html#aeea9a77019342b669872e46718e9e082">mi_cmd_gdb_exit</a> (<span class="keywordtype">char</span> *<a class="code" href="structmi__parse.html#ae875047151207dac2c533978fc572115">command</a>, <span class="keywordtype">char</span> **<a class="code" href="structmi__parse.html#a2caa41cd025f3b2e6ad7e35be03e2f24">argv</a>, <span class="keywordtype">int</span> <a class="code" href="structmi__parse.html#a6c0ecf896befd0f1d67c0c304a1f7b99">argc</a>)
<a name="l00120"></a>00120 {
<a name="l00121"></a>00121   <span class="comment">/* We have to print everything right here because we never return.  */</span>
<a name="l00122"></a>00122   <span class="keywordflow">if</span> (<a class="code" href="mi-main_8c.html#a4f31fe20e2b760c8d54d42910947ef2d">current_token</a>)
<a name="l00123"></a>00123     <a class="code" href="ui-file_8c.html#aae3b905f888b1dcdce586f77b9554153">fputs_unfiltered</a> (<a class="code" href="mi-main_8c.html#a4f31fe20e2b760c8d54d42910947ef2d">current_token</a>, <a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);
<a name="l00124"></a>00124   <a class="code" href="ui-file_8c.html#aae3b905f888b1dcdce586f77b9554153">fputs_unfiltered</a> (<span class="stringliteral">&quot;^exit\n&quot;</span>, <a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);
<a name="l00125"></a>00125   <a class="code" href="mi-out_8c.html#a395eec86cb794425014fa789e78d18f9">mi_out_put</a> (<a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>, <a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);
<a name="l00126"></a>00126   <a class="code" href="ui-file_8c.html#a046f07b5ef1bcc35c28b4be983e39998">gdb_flush</a> (<a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);
<a name="l00127"></a>00127   <span class="comment">/* FIXME: The function called is not yet a formal libgdb function.  */</span>
<a name="l00128"></a>00128   <a class="code" href="top_8c.html#a9b81bdd279e1b463def08b40b70853bb">quit_force</a> (NULL, <a class="code" href="mi-cmd-break_8c.html#aa491173a6b1628f4ff82067b2e1ceaa9a12979d5360cf19b2d8d78b120084eae0">FROM_TTY</a>);
<a name="l00129"></a>00129 }
<a name="l00130"></a>00130 
<a name="l00131"></a>00131 <span class="keywordtype">void</span>
<a name="l00132"></a><a class="code" href="mi-main_8c.html#aeb6886c67c554605633559b3c320aecc">00132</a> <a class="code" href="mi-cmds_8h.html#a4691900b3236e728acf893b0039a26fc">mi_cmd_exec_next</a> (<span class="keywordtype">char</span> *<a class="code" href="structmi__parse.html#ae875047151207dac2c533978fc572115">command</a>, <span class="keywordtype">char</span> **<a class="code" href="structmi__parse.html#a2caa41cd025f3b2e6ad7e35be03e2f24">argv</a>, <span class="keywordtype">int</span> <a class="code" href="structmi__parse.html#a6c0ecf896befd0f1d67c0c304a1f7b99">argc</a>)
<a name="l00133"></a>00133 {
<a name="l00134"></a>00134   <span class="comment">/* FIXME: Should call a libgdb function, not a cli wrapper.  */</span>
<a name="l00135"></a>00135   <span class="keywordflow">if</span> (argc &gt; 0 &amp;&amp; strcmp(argv[0], <span class="stringliteral">&quot;--reverse&quot;</span>) == 0)
<a name="l00136"></a>00136     mi_execute_async_cli_command (<span class="stringliteral">&quot;reverse-next&quot;</span>, argv + 1, argc - 1);
<a name="l00137"></a>00137   <span class="keywordflow">else</span>
<a name="l00138"></a>00138     mi_execute_async_cli_command (<span class="stringliteral">&quot;next&quot;</span>, argv, argc);
<a name="l00139"></a>00139 }
<a name="l00140"></a>00140 
<a name="l00141"></a>00141 <span class="keywordtype">void</span>
<a name="l00142"></a><a class="code" href="mi-main_8c.html#ad4124f699e5e7b7d1d8b4f0c74ce147e">00142</a> <a class="code" href="mi-cmds_8h.html#a0998c1cb81e7520cdb0496efefb98410">mi_cmd_exec_next_instruction</a> (<span class="keywordtype">char</span> *<a class="code" href="structmi__parse.html#ae875047151207dac2c533978fc572115">command</a>, <span class="keywordtype">char</span> **<a class="code" href="structmi__parse.html#a2caa41cd025f3b2e6ad7e35be03e2f24">argv</a>, <span class="keywordtype">int</span> <a class="code" href="structmi__parse.html#a6c0ecf896befd0f1d67c0c304a1f7b99">argc</a>)
<a name="l00143"></a>00143 {
<a name="l00144"></a>00144   <span class="comment">/* FIXME: Should call a libgdb function, not a cli wrapper.  */</span>
<a name="l00145"></a>00145   <span class="keywordflow">if</span> (argc &gt; 0 &amp;&amp; strcmp(argv[0], <span class="stringliteral">&quot;--reverse&quot;</span>) == 0)
<a name="l00146"></a>00146     mi_execute_async_cli_command (<span class="stringliteral">&quot;reverse-nexti&quot;</span>, argv + 1, argc - 1);
<a name="l00147"></a>00147   <span class="keywordflow">else</span>
<a name="l00148"></a>00148     mi_execute_async_cli_command (<span class="stringliteral">&quot;nexti&quot;</span>, argv, argc);
<a name="l00149"></a>00149 }
<a name="l00150"></a>00150 
<a name="l00151"></a>00151 <span class="keywordtype">void</span>
<a name="l00152"></a><a class="code" href="mi-main_8c.html#aec437ca5cae4dfebf85a1823497b0ff1">00152</a> <a class="code" href="mi-cmds_8h.html#a4801f56028d68c86416b63f8f3e7149f">mi_cmd_exec_step</a> (<span class="keywordtype">char</span> *<a class="code" href="structmi__parse.html#ae875047151207dac2c533978fc572115">command</a>, <span class="keywordtype">char</span> **<a class="code" href="structmi__parse.html#a2caa41cd025f3b2e6ad7e35be03e2f24">argv</a>, <span class="keywordtype">int</span> <a class="code" href="structmi__parse.html#a6c0ecf896befd0f1d67c0c304a1f7b99">argc</a>)
<a name="l00153"></a>00153 {
<a name="l00154"></a>00154   <span class="comment">/* FIXME: Should call a libgdb function, not a cli wrapper.  */</span>
<a name="l00155"></a>00155   <span class="keywordflow">if</span> (argc &gt; 0 &amp;&amp; strcmp(argv[0], <span class="stringliteral">&quot;--reverse&quot;</span>) == 0)
<a name="l00156"></a>00156     mi_execute_async_cli_command (<span class="stringliteral">&quot;reverse-step&quot;</span>, argv + 1, argc - 1);
<a name="l00157"></a>00157   <span class="keywordflow">else</span>
<a name="l00158"></a>00158     mi_execute_async_cli_command (<span class="stringliteral">&quot;step&quot;</span>, argv, argc);
<a name="l00159"></a>00159 }
<a name="l00160"></a>00160 
<a name="l00161"></a>00161 <span class="keywordtype">void</span>
<a name="l00162"></a><a class="code" href="mi-main_8c.html#ab1fcc2c897e03805bb46de26896bee58">00162</a> <a class="code" href="mi-cmds_8h.html#a80f48a0cbca5ee31c2e9298e5f06b9cd">mi_cmd_exec_step_instruction</a> (<span class="keywordtype">char</span> *<a class="code" href="structmi__parse.html#ae875047151207dac2c533978fc572115">command</a>, <span class="keywordtype">char</span> **<a class="code" href="structmi__parse.html#a2caa41cd025f3b2e6ad7e35be03e2f24">argv</a>, <span class="keywordtype">int</span> <a class="code" href="structmi__parse.html#a6c0ecf896befd0f1d67c0c304a1f7b99">argc</a>)
<a name="l00163"></a>00163 {
<a name="l00164"></a>00164   <span class="comment">/* FIXME: Should call a libgdb function, not a cli wrapper.  */</span>
<a name="l00165"></a>00165   <span class="keywordflow">if</span> (argc &gt; 0 &amp;&amp; strcmp(argv[0], <span class="stringliteral">&quot;--reverse&quot;</span>) == 0)
<a name="l00166"></a>00166     mi_execute_async_cli_command (<span class="stringliteral">&quot;reverse-stepi&quot;</span>, argv + 1, argc - 1);
<a name="l00167"></a>00167   <span class="keywordflow">else</span>
<a name="l00168"></a>00168     mi_execute_async_cli_command (<span class="stringliteral">&quot;stepi&quot;</span>, argv, argc);
<a name="l00169"></a>00169 }
<a name="l00170"></a>00170 
<a name="l00171"></a>00171 <span class="keywordtype">void</span>
<a name="l00172"></a><a class="code" href="mi-main_8c.html#a79d6167093a28309e54bc933929276d3">00172</a> <a class="code" href="mi-cmds_8h.html#a3072bd3242581967723e71b9398d57c5">mi_cmd_exec_finish</a> (<span class="keywordtype">char</span> *<a class="code" href="structmi__parse.html#ae875047151207dac2c533978fc572115">command</a>, <span class="keywordtype">char</span> **<a class="code" href="structmi__parse.html#a2caa41cd025f3b2e6ad7e35be03e2f24">argv</a>, <span class="keywordtype">int</span> <a class="code" href="structmi__parse.html#a6c0ecf896befd0f1d67c0c304a1f7b99">argc</a>)
<a name="l00173"></a>00173 {
<a name="l00174"></a>00174   <span class="comment">/* FIXME: Should call a libgdb function, not a cli wrapper.  */</span>
<a name="l00175"></a>00175   <span class="keywordflow">if</span> (argc &gt; 0 &amp;&amp; strcmp(argv[0], <span class="stringliteral">&quot;--reverse&quot;</span>) == 0)
<a name="l00176"></a>00176     mi_execute_async_cli_command (<span class="stringliteral">&quot;reverse-finish&quot;</span>, argv + 1, argc - 1);
<a name="l00177"></a>00177   <span class="keywordflow">else</span>
<a name="l00178"></a>00178     mi_execute_async_cli_command (<span class="stringliteral">&quot;finish&quot;</span>, argv, argc);
<a name="l00179"></a>00179 }
<a name="l00180"></a>00180 
<a name="l00181"></a>00181 <span class="keywordtype">void</span>
<a name="l00182"></a><a class="code" href="mi-main_8c.html#ab2d30452b84f55d44558fa2b022456bd">00182</a> <a class="code" href="mi-cmds_8h.html#a41f1f933844a2ecb5d488e15b6caa36a">mi_cmd_exec_return</a> (<span class="keywordtype">char</span> *<a class="code" href="structmi__parse.html#ae875047151207dac2c533978fc572115">command</a>, <span class="keywordtype">char</span> **<a class="code" href="structmi__parse.html#a2caa41cd025f3b2e6ad7e35be03e2f24">argv</a>, <span class="keywordtype">int</span> <a class="code" href="structmi__parse.html#a6c0ecf896befd0f1d67c0c304a1f7b99">argc</a>)
<a name="l00183"></a>00183 {
<a name="l00184"></a>00184   <span class="comment">/* This command doesn&#39;t really execute the target, it just pops the</span>
<a name="l00185"></a>00185 <span class="comment">     specified number of frames.  */</span>
<a name="l00186"></a>00186   <span class="keywordflow">if</span> (argc)
<a name="l00187"></a>00187     <span class="comment">/* Call return_command with from_tty argument equal to 0 so as to</span>
<a name="l00188"></a>00188 <span class="comment">       avoid being queried.  */</span>
<a name="l00189"></a>00189     <a class="code" href="frame_8h.html#ab5e52b8372e53e7f7099b0bee2413a6a">return_command</a> (*argv, 0);
<a name="l00190"></a>00190   <span class="keywordflow">else</span>
<a name="l00191"></a>00191     <span class="comment">/* Call return_command with from_tty argument equal to 0 so as to</span>
<a name="l00192"></a>00192 <span class="comment">       avoid being queried.  */</span>
<a name="l00193"></a>00193     <a class="code" href="frame_8h.html#ab5e52b8372e53e7f7099b0bee2413a6a">return_command</a> (NULL, 0);
<a name="l00194"></a>00194 
<a name="l00195"></a>00195   <span class="comment">/* Because we have called return_command with from_tty = 0, we need</span>
<a name="l00196"></a>00196 <span class="comment">     to print the frame here.  */</span>
<a name="l00197"></a>00197   <a class="code" href="frame_8h.html#a849748a17da39e76cc4648e83c64c344">print_stack_frame</a> (<a class="code" href="frame_8c.html#a8b714a78478670e14a297eba8d1a9915">get_selected_frame</a> (NULL), 1, <a class="code" href="frame_8h.html#a2431f51963af6773c12937f24f7525a4ac928790b2192fa6a3fb9dddb1f6acbf9">LOC_AND_ADDRESS</a>, 1);
<a name="l00198"></a>00198 }
<a name="l00199"></a>00199 
<a name="l00200"></a>00200 <span class="keywordtype">void</span>
<a name="l00201"></a><a class="code" href="mi-main_8c.html#a6335d338faa9fea06ecf8f0ad1de053b">00201</a> <a class="code" href="mi-cmds_8h.html#a03e0b8c5e0ec1a34388680581414735c">mi_cmd_exec_jump</a> (<span class="keywordtype">char</span> *<a class="code" href="structmi__parse.html#a2a3b25c334a4baddc6185fed4cb90c78">args</a>, <span class="keywordtype">char</span> **<a class="code" href="structmi__parse.html#a2caa41cd025f3b2e6ad7e35be03e2f24">argv</a>, <span class="keywordtype">int</span> <a class="code" href="structmi__parse.html#a6c0ecf896befd0f1d67c0c304a1f7b99">argc</a>)
<a name="l00202"></a>00202 {
<a name="l00203"></a>00203   <span class="comment">/* FIXME: Should call a libgdb function, not a cli wrapper.  */</span>
<a name="l00204"></a>00204   mi_execute_async_cli_command (<span class="stringliteral">&quot;jump&quot;</span>, argv, argc);
<a name="l00205"></a>00205 }
<a name="l00206"></a>00206  
<a name="l00207"></a>00207 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00208"></a>00208 proceed_thread (<span class="keyword">struct</span> <a class="code" href="structthread__info.html">thread_info</a> *<a class="code" href="structmi__parse.html#af7814daf1bca73119bdcedf715f1fe71">thread</a>, <span class="keywordtype">int</span> pid)
<a name="l00209"></a>00209 {
<a name="l00210"></a>00210   <span class="keywordflow">if</span> (!<a class="code" href="gdbthread_8h.html#a23ca934651a9656c6322057a3c2afc64">is_stopped</a> (thread-&gt;<a class="code" href="structthread__info.html#a533aa3979b60affd446e9fbff93fdd2c">ptid</a>))
<a name="l00211"></a>00211     <span class="keywordflow">return</span>;
<a name="l00212"></a>00212 
<a name="l00213"></a>00213   <span class="keywordflow">if</span> (pid != 0 &amp;&amp; <a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (thread-&gt;<a class="code" href="structthread__info.html#a533aa3979b60affd446e9fbff93fdd2c">ptid</a>) != pid)
<a name="l00214"></a>00214     <span class="keywordflow">return</span>;
<a name="l00215"></a>00215 
<a name="l00216"></a>00216   <a class="code" href="gdbthread_8h.html#aee26ee8d9825599b321b73d2ecb5ac54">switch_to_thread</a> (thread-&gt;<a class="code" href="structthread__info.html#a533aa3979b60affd446e9fbff93fdd2c">ptid</a>);
<a name="l00217"></a>00217   <a class="code" href="inferior_8h.html#a8c032d638c8cc6a62945a19c70a64f71">clear_proceed_status</a> ();
<a name="l00218"></a>00218   <a class="code" href="inferior_8h.html#ad878811546bb02b06fc111d939a1ab9a">proceed</a> ((<a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a>) -1, GDB_SIGNAL_DEFAULT, 0);
<a name="l00219"></a>00219 }
<a name="l00220"></a>00220 
<a name="l00221"></a>00221 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00222"></a>00222 proceed_thread_callback (<span class="keyword">struct</span> <a class="code" href="structthread__info.html">thread_info</a> *thread, <span class="keywordtype">void</span> *arg)
<a name="l00223"></a>00223 {
<a name="l00224"></a>00224   <span class="keywordtype">int</span> pid = *(<span class="keywordtype">int</span> *)arg;
<a name="l00225"></a>00225 
<a name="l00226"></a>00226   proceed_thread (thread, pid);
<a name="l00227"></a>00227   <span class="keywordflow">return</span> 0;
<a name="l00228"></a>00228 }
<a name="l00229"></a>00229 
<a name="l00230"></a>00230 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00231"></a>00231 exec_continue (<span class="keywordtype">char</span> **<a class="code" href="structmi__parse.html#a2caa41cd025f3b2e6ad7e35be03e2f24">argv</a>, <span class="keywordtype">int</span> <a class="code" href="structmi__parse.html#a6c0ecf896befd0f1d67c0c304a1f7b99">argc</a>)
<a name="l00232"></a>00232 {
<a name="l00233"></a>00233   <span class="keywordflow">if</span> (<a class="code" href="inferior_8h.html#af01b8288bc30e83805793d6908408e81">non_stop</a>)
<a name="l00234"></a>00234     {
<a name="l00235"></a>00235       <span class="comment">/* In non-stop mode, &#39;resume&#39; always resumes a single thread.</span>
<a name="l00236"></a>00236 <span class="comment">         Therefore, to resume all threads of the current inferior, or</span>
<a name="l00237"></a>00237 <span class="comment">         all threads in all inferiors, we need to iterate over</span>
<a name="l00238"></a>00238 <span class="comment">         threads.</span>
<a name="l00239"></a>00239 <span class="comment"></span>
<a name="l00240"></a>00240 <span class="comment">         See comment on infcmd.c:proceed_thread_callback for rationale.  */</span>
<a name="l00241"></a>00241       <span class="keywordflow">if</span> (current_context-&gt;<a class="code" href="structmi__parse.html#a506e97d5a305357f6e6800dad1dd0c3c">all</a> || current_context-&gt;<a class="code" href="structmi__parse.html#a7ae59f1e586fbea831da584650ebb9c1">thread_group</a> != -1)
<a name="l00242"></a>00242         {
<a name="l00243"></a>00243           <span class="keywordtype">int</span> pid = 0;
<a name="l00244"></a>00244           <span class="keyword">struct </span>cleanup *back_to = <a class="code" href="gdbthread_8h.html#a7a784124700d19ad7da32e2c20d3b0c6">make_cleanup_restore_current_thread</a> ();
<a name="l00245"></a>00245 
<a name="l00246"></a>00246           <span class="keywordflow">if</span> (!current_context-&gt;<a class="code" href="structmi__parse.html#a506e97d5a305357f6e6800dad1dd0c3c">all</a>)
<a name="l00247"></a>00247             {
<a name="l00248"></a>00248               <span class="keyword">struct </span><a class="code" href="structinferior.html">inferior</a> *<a class="code" href="namespacearm-linux.html#aaf6bae53545ee96f24d7ba560ed0a205">inf</a>
<a name="l00249"></a>00249                 = <a class="code" href="inferior_8c.html#a3522179a3919bac51a689cb3c0ad98f5">find_inferior_id</a> (current_context-&gt;<a class="code" href="structmi__parse.html#a7ae59f1e586fbea831da584650ebb9c1">thread_group</a>);
<a name="l00250"></a>00250 
<a name="l00251"></a>00251               pid = inf-&gt;<a class="code" href="structinferior.html#a1be87f581dbb6c893dbe1f2ff701636a">pid</a>;
<a name="l00252"></a>00252             }
<a name="l00253"></a>00253           <a class="code" href="gdbthread_8h.html#a5dc20fee3cc8a79f615f2f5d695ae1bc">iterate_over_threads</a> (proceed_thread_callback, &amp;pid);
<a name="l00254"></a>00254           <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (back_to);
<a name="l00255"></a>00255         }
<a name="l00256"></a>00256       <span class="keywordflow">else</span>
<a name="l00257"></a>00257         {
<a name="l00258"></a>00258           <a class="code" href="infcmd_8c.html#a11b182c9db3adf2e39b66cb4912c229a">continue_1</a> (0);
<a name="l00259"></a>00259         }
<a name="l00260"></a>00260     }
<a name="l00261"></a>00261   <span class="keywordflow">else</span>
<a name="l00262"></a>00262     {
<a name="l00263"></a>00263       <span class="keyword">struct </span>cleanup *back_to = <a class="code" href="utils_8c.html#aa4b9e7f0b6abb5f93fc0ac366f7614c0">make_cleanup_restore_integer</a> (&amp;<a class="code" href="inferior_8h.html#a7fdba73a81e50b94d3c98ef7f3866cd8">sched_multi</a>);
<a name="l00264"></a>00264 
<a name="l00265"></a>00265       <span class="keywordflow">if</span> (current_context-&gt;<a class="code" href="structmi__parse.html#a506e97d5a305357f6e6800dad1dd0c3c">all</a>)
<a name="l00266"></a>00266         {
<a name="l00267"></a>00267           <a class="code" href="inferior_8h.html#a7fdba73a81e50b94d3c98ef7f3866cd8">sched_multi</a> = 1;
<a name="l00268"></a>00268           <a class="code" href="infcmd_8c.html#a11b182c9db3adf2e39b66cb4912c229a">continue_1</a> (0);
<a name="l00269"></a>00269         }
<a name="l00270"></a>00270       <span class="keywordflow">else</span>
<a name="l00271"></a>00271         {
<a name="l00272"></a>00272           <span class="comment">/* In all-stop mode, -exec-continue traditionally resumed</span>
<a name="l00273"></a>00273 <span class="comment">             either all threads, or one thread, depending on the</span>
<a name="l00274"></a>00274 <span class="comment">             &#39;scheduler-locking&#39; variable.  Let&#39;s continue to do the</span>
<a name="l00275"></a>00275 <span class="comment">             same.  */</span>
<a name="l00276"></a>00276           <a class="code" href="infcmd_8c.html#a11b182c9db3adf2e39b66cb4912c229a">continue_1</a> (1);
<a name="l00277"></a>00277         }
<a name="l00278"></a>00278       <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (back_to);
<a name="l00279"></a>00279     }
<a name="l00280"></a>00280 }
<a name="l00281"></a>00281 
<a name="l00282"></a>00282 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00283"></a>00283 exec_direction_forward (<span class="keywordtype">void</span> *notused)
<a name="l00284"></a>00284 {
<a name="l00285"></a>00285   <a class="code" href="inferior_8h.html#aac6c786e4dd1abbcd0dcff4b84cb67a8">execution_direction</a> = <a class="code" href="inferior_8h.html#a48ab4325cf8e590f251b859335443e86a7f3e3560f26b8a9675a5b581406dc3ff">EXEC_FORWARD</a>;
<a name="l00286"></a>00286 }
<a name="l00287"></a>00287 
<a name="l00288"></a>00288 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00289"></a>00289 exec_reverse_continue (<span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l00290"></a>00290 {
<a name="l00291"></a>00291   <span class="keyword">enum</span> <a class="code" href="inferior_8h.html#a48ab4325cf8e590f251b859335443e86">exec_direction_kind</a> dir = <a class="code" href="inferior_8h.html#aac6c786e4dd1abbcd0dcff4b84cb67a8">execution_direction</a>;
<a name="l00292"></a>00292   <span class="keyword">struct </span>cleanup *old_chain;
<a name="l00293"></a>00293 
<a name="l00294"></a>00294   <span class="keywordflow">if</span> (dir == <a class="code" href="inferior_8h.html#a48ab4325cf8e590f251b859335443e86a23def41134d0bef77bbe31227d0806fb">EXEC_REVERSE</a>)
<a name="l00295"></a>00295     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Already in reverse mode.&quot;</span>));
<a name="l00296"></a>00296 
<a name="l00297"></a>00297   <span class="keywordflow">if</span> (!<a class="code" href="target_8h.html#a9d505a2eeddd080948e3f40957b7b264">target_can_execute_reverse</a>)
<a name="l00298"></a>00298     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Target %s does not support this command.&quot;</span>), <a class="code" href="target_8h.html#a82f16780537e85ac9b42873b0008108c">target_shortname</a>);
<a name="l00299"></a>00299 
<a name="l00300"></a>00300   old_chain = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (exec_direction_forward, NULL);
<a name="l00301"></a>00301   <a class="code" href="inferior_8h.html#aac6c786e4dd1abbcd0dcff4b84cb67a8">execution_direction</a> = <a class="code" href="inferior_8h.html#a48ab4325cf8e590f251b859335443e86a23def41134d0bef77bbe31227d0806fb">EXEC_REVERSE</a>;
<a name="l00302"></a>00302   exec_continue (argv, argc);
<a name="l00303"></a>00303   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l00304"></a>00304 }
<a name="l00305"></a>00305 
<a name="l00306"></a>00306 <span class="keywordtype">void</span>
<a name="l00307"></a><a class="code" href="mi-main_8c.html#a89ace014e3e265955c37a6cec7ab8284">00307</a> <a class="code" href="mi-cmds_8h.html#abcf27fc8b38d877aab7640a1624d1048">mi_cmd_exec_continue</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l00308"></a>00308 {
<a name="l00309"></a>00309   <span class="keywordflow">if</span> (argc &gt; 0 &amp;&amp; strcmp (argv[0], <span class="stringliteral">&quot;--reverse&quot;</span>) == 0)
<a name="l00310"></a>00310     exec_reverse_continue (argv + 1, argc - 1);
<a name="l00311"></a>00311   <span class="keywordflow">else</span>
<a name="l00312"></a>00312     exec_continue (argv, argc);
<a name="l00313"></a>00313 }
<a name="l00314"></a>00314 
<a name="l00315"></a>00315 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00316"></a>00316 interrupt_thread_callback (<span class="keyword">struct</span> <a class="code" href="structthread__info.html">thread_info</a> *thread, <span class="keywordtype">void</span> *arg)
<a name="l00317"></a>00317 {
<a name="l00318"></a>00318   <span class="keywordtype">int</span> pid = *(<span class="keywordtype">int</span> *)arg;
<a name="l00319"></a>00319 
<a name="l00320"></a>00320   <span class="keywordflow">if</span> (!<a class="code" href="gdbthread_8h.html#aa728736310c4867f1b7477f4ebec62c6">is_running</a> (thread-&gt;<a class="code" href="structthread__info.html#a533aa3979b60affd446e9fbff93fdd2c">ptid</a>))
<a name="l00321"></a>00321     <span class="keywordflow">return</span> 0;
<a name="l00322"></a>00322 
<a name="l00323"></a>00323   <span class="keywordflow">if</span> (<a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (thread-&gt;<a class="code" href="structthread__info.html#a533aa3979b60affd446e9fbff93fdd2c">ptid</a>) != pid)
<a name="l00324"></a>00324     <span class="keywordflow">return</span> 0;
<a name="l00325"></a>00325 
<a name="l00326"></a>00326   <a class="code" href="target_8c.html#aa853c4b246e9b51f98345775fc29163a">target_stop</a> (thread-&gt;<a class="code" href="structthread__info.html#a533aa3979b60affd446e9fbff93fdd2c">ptid</a>);
<a name="l00327"></a>00327   <span class="keywordflow">return</span> 0;
<a name="l00328"></a>00328 }
<a name="l00329"></a>00329 
<a name="l00330"></a>00330 <span class="comment">/* Interrupt the execution of the target.  Note how we must play</span>
<a name="l00331"></a>00331 <span class="comment">   around with the token variables, in order to display the current</span>
<a name="l00332"></a>00332 <span class="comment">   token in the result of the interrupt command, and the previous</span>
<a name="l00333"></a>00333 <span class="comment">   execution token when the target finally stops.  See comments in</span>
<a name="l00334"></a>00334 <span class="comment">   mi_cmd_execute.  */</span>
<a name="l00335"></a>00335 
<a name="l00336"></a>00336 <span class="keywordtype">void</span>
<a name="l00337"></a><a class="code" href="mi-main_8c.html#a3b3dce7df9a85c646bb7acf0b8d6ee14">00337</a> <a class="code" href="mi-cmds_8h.html#a7b6b05b6f799b268febf0d29d291cf0b">mi_cmd_exec_interrupt</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l00338"></a>00338 {
<a name="l00339"></a>00339   <span class="comment">/* In all-stop mode, everything stops, so we don&#39;t need to try</span>
<a name="l00340"></a>00340 <span class="comment">     anything specific.  */</span>
<a name="l00341"></a>00341   <span class="keywordflow">if</span> (!<a class="code" href="inferior_8h.html#af01b8288bc30e83805793d6908408e81">non_stop</a>)
<a name="l00342"></a>00342     {
<a name="l00343"></a>00343       <a class="code" href="infcmd_8c.html#a097f075072d5d287162dbed408801541">interrupt_target_1</a> (0);
<a name="l00344"></a>00344       <span class="keywordflow">return</span>;
<a name="l00345"></a>00345     }
<a name="l00346"></a>00346 
<a name="l00347"></a>00347   <span class="keywordflow">if</span> (current_context-&gt;<a class="code" href="structmi__parse.html#a506e97d5a305357f6e6800dad1dd0c3c">all</a>)
<a name="l00348"></a>00348     {
<a name="l00349"></a>00349       <span class="comment">/* This will interrupt all threads in all inferiors.  */</span>
<a name="l00350"></a>00350       <a class="code" href="infcmd_8c.html#a097f075072d5d287162dbed408801541">interrupt_target_1</a> (1);
<a name="l00351"></a>00351     }
<a name="l00352"></a>00352   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (current_context-&gt;<a class="code" href="structmi__parse.html#a7ae59f1e586fbea831da584650ebb9c1">thread_group</a> != -1)
<a name="l00353"></a>00353     {
<a name="l00354"></a>00354       <span class="keyword">struct </span><a class="code" href="structinferior.html">inferior</a> *<a class="code" href="namespacearm-linux.html#aaf6bae53545ee96f24d7ba560ed0a205">inf</a> = <a class="code" href="inferior_8c.html#a3522179a3919bac51a689cb3c0ad98f5">find_inferior_id</a> (current_context-&gt;<a class="code" href="structmi__parse.html#a7ae59f1e586fbea831da584650ebb9c1">thread_group</a>);
<a name="l00355"></a>00355 
<a name="l00356"></a>00356       <a class="code" href="gdbthread_8h.html#a5dc20fee3cc8a79f615f2f5d695ae1bc">iterate_over_threads</a> (interrupt_thread_callback, &amp;inf-&gt;<a class="code" href="structinferior.html#a1be87f581dbb6c893dbe1f2ff701636a">pid</a>);
<a name="l00357"></a>00357     }
<a name="l00358"></a>00358   <span class="keywordflow">else</span>
<a name="l00359"></a>00359     {
<a name="l00360"></a>00360       <span class="comment">/* Interrupt just the current thread -- either explicitly</span>
<a name="l00361"></a>00361 <span class="comment">         specified via --thread or whatever was current before</span>
<a name="l00362"></a>00362 <span class="comment">         MI command was sent.  */</span>
<a name="l00363"></a>00363       <a class="code" href="infcmd_8c.html#a097f075072d5d287162dbed408801541">interrupt_target_1</a> (0);
<a name="l00364"></a>00364     }
<a name="l00365"></a>00365 }
<a name="l00366"></a>00366 
<a name="l00367"></a>00367 <span class="comment">/* Callback for iterate_over_inferiors which starts the execution</span>
<a name="l00368"></a>00368 <span class="comment">   of the given inferior.</span>
<a name="l00369"></a>00369 <span class="comment"></span>
<a name="l00370"></a>00370 <span class="comment">   ARG is a pointer to an integer whose value, if non-zero, indicates</span>
<a name="l00371"></a>00371 <span class="comment">   that the program should be stopped when reaching the main subprogram</span>
<a name="l00372"></a>00372 <span class="comment">   (similar to what the CLI &quot;start&quot; command does).  */</span>
<a name="l00373"></a>00373 
<a name="l00374"></a>00374 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00375"></a>00375 run_one_inferior (<span class="keyword">struct</span> <a class="code" href="structinferior.html">inferior</a> *<a class="code" href="namespacearm-linux.html#aaf6bae53545ee96f24d7ba560ed0a205">inf</a>, <span class="keywordtype">void</span> *arg)
<a name="l00376"></a>00376 {
<a name="l00377"></a>00377   <span class="keywordtype">int</span> start_p = *(<span class="keywordtype">int</span> *) arg;
<a name="l00378"></a>00378   <span class="keyword">const</span> <span class="keywordtype">char</span> *run_cmd = start_p ? <span class="stringliteral">&quot;start&quot;</span> : <span class="stringliteral">&quot;run&quot;</span>;
<a name="l00379"></a>00379 
<a name="l00380"></a>00380   <span class="keywordflow">if</span> (inf-&gt;<a class="code" href="structinferior.html#a1be87f581dbb6c893dbe1f2ff701636a">pid</a> != 0)
<a name="l00381"></a>00381     {
<a name="l00382"></a>00382       <span class="keywordflow">if</span> (inf-&gt;<a class="code" href="structinferior.html#a1be87f581dbb6c893dbe1f2ff701636a">pid</a> != <a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>))
<a name="l00383"></a>00383         {
<a name="l00384"></a>00384           <span class="keyword">struct </span><a class="code" href="structthread__info.html">thread_info</a> *tp;
<a name="l00385"></a>00385 
<a name="l00386"></a>00386           tp = <a class="code" href="gdbthread_8h.html#a5be9dac86c4806d929f3e3d8f9c37ffc">any_thread_of_process</a> (inf-&gt;<a class="code" href="structinferior.html#a1be87f581dbb6c893dbe1f2ff701636a">pid</a>);
<a name="l00387"></a>00387           <span class="keywordflow">if</span> (!tp)
<a name="l00388"></a>00388             <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Inferior has no threads.&quot;</span>));
<a name="l00389"></a>00389 
<a name="l00390"></a>00390           <a class="code" href="gdbthread_8h.html#aee26ee8d9825599b321b73d2ecb5ac54">switch_to_thread</a> (tp-&gt;<a class="code" href="structthread__info.html#a533aa3979b60affd446e9fbff93fdd2c">ptid</a>);
<a name="l00391"></a>00391         }
<a name="l00392"></a>00392     }
<a name="l00393"></a>00393   <span class="keywordflow">else</span>
<a name="l00394"></a>00394     {
<a name="l00395"></a>00395       <a class="code" href="inferior_8c.html#a5e82a0bf51f4554e1e639c7b48de5e57">set_current_inferior</a> (inf);
<a name="l00396"></a>00396       <a class="code" href="gdbthread_8h.html#aee26ee8d9825599b321b73d2ecb5ac54">switch_to_thread</a> (<a class="code" href="ptid_8c.html#acba69c857786546b204883bbcc90a64e">null_ptid</a>);
<a name="l00397"></a>00397       <a class="code" href="progspace_8c.html#a394457638b3e584a3ecd019df372209f">set_current_program_space</a> (inf-&gt;<a class="code" href="structinferior.html#afc6a557206fd753b89e34bd33e038cfe">pspace</a>);
<a name="l00398"></a>00398     }
<a name="l00399"></a>00399   mi_execute_cli_command (run_cmd, <a class="code" href="target_8h.html#a2b6015c90130096b2e9757013e49c1e9">target_can_async_p</a> (),
<a name="l00400"></a>00400                           <a class="code" href="target_8h.html#a2b6015c90130096b2e9757013e49c1e9">target_can_async_p</a> () ? <span class="stringliteral">&quot;&amp;&quot;</span> : NULL);
<a name="l00401"></a>00401   <span class="keywordflow">return</span> 0;
<a name="l00402"></a>00402 }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404 <span class="keywordtype">void</span>
<a name="l00405"></a><a class="code" href="mi-main_8c.html#a18cb5e008c4f28c23e10ccb0d09fccf9">00405</a> <a class="code" href="mi-cmds_8h.html#af721b9cad89800d6afdc1ed91992509a">mi_cmd_exec_run</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l00406"></a>00406 {
<a name="l00407"></a>00407   <span class="keywordtype">int</span> i;
<a name="l00408"></a>00408   <span class="keywordtype">int</span> start_p = 0;
<a name="l00409"></a>00409 
<a name="l00410"></a>00410   <span class="comment">/* Parse the command options.  */</span>
<a name="l00411"></a>00411   <span class="keyword">enum</span> opt
<a name="l00412"></a>00412     {
<a name="l00413"></a>00413       START_OPT,
<a name="l00414"></a>00414     };
<a name="l00415"></a>00415   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structmi__opt.html">mi_opt</a> opts[] =
<a name="l00416"></a>00416     {
<a name="l00417"></a>00417         {<span class="stringliteral">&quot;-start&quot;</span>, START_OPT, 0},
<a name="l00418"></a>00418         {NULL, 0, 0},
<a name="l00419"></a>00419     };
<a name="l00420"></a>00420 
<a name="l00421"></a>00421   <span class="keywordtype">int</span> oind = 0;
<a name="l00422"></a>00422   <span class="keywordtype">char</span> *oarg;
<a name="l00423"></a>00423 
<a name="l00424"></a>00424   <span class="keywordflow">while</span> (1)
<a name="l00425"></a>00425     {
<a name="l00426"></a>00426       <span class="keywordtype">int</span> opt = <a class="code" href="mi-getopt_8c.html#af7bb1a80abf57e9afae0149d3af20b9c">mi_getopt</a> (<span class="stringliteral">&quot;-exec-run&quot;</span>, argc, argv, opts, &amp;oind, &amp;oarg);
<a name="l00427"></a>00427 
<a name="l00428"></a>00428       <span class="keywordflow">if</span> (opt &lt; 0)
<a name="l00429"></a>00429         <span class="keywordflow">break</span>;
<a name="l00430"></a>00430       <span class="keywordflow">switch</span> ((<span class="keyword">enum</span> opt) opt)
<a name="l00431"></a>00431         {
<a name="l00432"></a>00432         <span class="keywordflow">case</span> START_OPT:
<a name="l00433"></a>00433           start_p = 1;
<a name="l00434"></a>00434           <span class="keywordflow">break</span>;
<a name="l00435"></a>00435         }
<a name="l00436"></a>00436     }
<a name="l00437"></a>00437 
<a name="l00438"></a>00438   <span class="comment">/* This command does not accept any argument.  Make sure the user</span>
<a name="l00439"></a>00439 <span class="comment">     did not provide any.  */</span>
<a name="l00440"></a>00440   <span class="keywordflow">if</span> (oind != argc)
<a name="l00441"></a>00441     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Invalid argument: %s&quot;</span>), argv[oind]);
<a name="l00442"></a>00442 
<a name="l00443"></a>00443   <span class="keywordflow">if</span> (current_context-&gt;<a class="code" href="structmi__parse.html#a506e97d5a305357f6e6800dad1dd0c3c">all</a>)
<a name="l00444"></a>00444     {
<a name="l00445"></a>00445       <span class="keyword">struct </span>cleanup *back_to = <a class="code" href="progspace_8c.html#a6326460454db4e192e2bc221cb322977">save_current_space_and_thread</a> ();
<a name="l00446"></a>00446 
<a name="l00447"></a>00447       <a class="code" href="inferior_8c.html#afcb3f43a2669a8ad733c575dc07d3a80">iterate_over_inferiors</a> (run_one_inferior, &amp;start_p);
<a name="l00448"></a>00448       <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (back_to);
<a name="l00449"></a>00449     }
<a name="l00450"></a>00450   <span class="keywordflow">else</span>
<a name="l00451"></a>00451     {
<a name="l00452"></a>00452       <span class="keyword">const</span> <span class="keywordtype">char</span> *run_cmd = start_p ? <span class="stringliteral">&quot;start&quot;</span> : <span class="stringliteral">&quot;run&quot;</span>;
<a name="l00453"></a>00453 
<a name="l00454"></a>00454       mi_execute_cli_command (run_cmd, <a class="code" href="target_8h.html#a2b6015c90130096b2e9757013e49c1e9">target_can_async_p</a> (),
<a name="l00455"></a>00455                               <a class="code" href="target_8h.html#a2b6015c90130096b2e9757013e49c1e9">target_can_async_p</a> () ? <span class="stringliteral">&quot;&amp;&quot;</span> : NULL);
<a name="l00456"></a>00456     }
<a name="l00457"></a>00457 }
<a name="l00458"></a>00458 
<a name="l00459"></a>00459 
<a name="l00460"></a>00460 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00461"></a>00461 find_thread_of_process (<span class="keyword">struct</span> <a class="code" href="structthread__info.html">thread_info</a> *ti, <span class="keywordtype">void</span> *p)
<a name="l00462"></a>00462 {
<a name="l00463"></a>00463   <span class="keywordtype">int</span> pid = *(<span class="keywordtype">int</span> *)p;
<a name="l00464"></a>00464 
<a name="l00465"></a>00465   <span class="keywordflow">if</span> (<a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (ti-&gt;<a class="code" href="structthread__info.html#a533aa3979b60affd446e9fbff93fdd2c">ptid</a>) == pid &amp;&amp; !<a class="code" href="gdbthread_8h.html#a4b919e1603e4636f9bc421f4a89c1d5d">is_exited</a> (ti-&gt;<a class="code" href="structthread__info.html#a533aa3979b60affd446e9fbff93fdd2c">ptid</a>))
<a name="l00466"></a>00466     <span class="keywordflow">return</span> 1;
<a name="l00467"></a>00467 
<a name="l00468"></a>00468   <span class="keywordflow">return</span> 0;
<a name="l00469"></a>00469 }
<a name="l00470"></a>00470 
<a name="l00471"></a>00471 <span class="keywordtype">void</span>
<a name="l00472"></a><a class="code" href="mi-main_8c.html#ac49369e91b90ce835bd98b2abe4cbbbd">00472</a> <a class="code" href="mi-cmds_8h.html#a737d65c89451db425371a8eba95f4ef2">mi_cmd_target_detach</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l00473"></a>00473 {
<a name="l00474"></a>00474   <span class="keywordflow">if</span> (argc != 0 &amp;&amp; argc != 1)
<a name="l00475"></a>00475     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Usage: -target-detach [pid | thread-group]&quot;</span>));
<a name="l00476"></a>00476 
<a name="l00477"></a>00477   <span class="keywordflow">if</span> (argc == 1)
<a name="l00478"></a>00478     {
<a name="l00479"></a>00479       <span class="keyword">struct </span><a class="code" href="structthread__info.html">thread_info</a> *tp;
<a name="l00480"></a>00480       <span class="keywordtype">char</span> *end = argv[0];
<a name="l00481"></a>00481       <span class="keywordtype">int</span> pid;
<a name="l00482"></a>00482 
<a name="l00483"></a>00483       <span class="comment">/* First see if we are dealing with a thread-group id.  */</span>
<a name="l00484"></a>00484       <span class="keywordflow">if</span> (*argv[0] == <span class="charliteral">&#39;i&#39;</span>)
<a name="l00485"></a>00485         {
<a name="l00486"></a>00486           <span class="keyword">struct </span><a class="code" href="structinferior.html">inferior</a> *<a class="code" href="namespacearm-linux.html#aaf6bae53545ee96f24d7ba560ed0a205">inf</a>;
<a name="l00487"></a>00487           <span class="keywordtype">int</span> <span class="keywordtype">id</span> = strtoul (argv[0] + 1, &amp;end, 0);
<a name="l00488"></a>00488 
<a name="l00489"></a>00489           <span class="keywordflow">if</span> (*end != <span class="charliteral">&#39;\0&#39;</span>)
<a name="l00490"></a>00490             <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Invalid syntax of thread-group id &#39;%s&#39;&quot;</span>), argv[0]);
<a name="l00491"></a>00491 
<a name="l00492"></a>00492           inf = <a class="code" href="inferior_8c.html#a3522179a3919bac51a689cb3c0ad98f5">find_inferior_id</a> (<span class="keywordtype">id</span>);
<a name="l00493"></a>00493           <span class="keywordflow">if</span> (!inf)
<a name="l00494"></a>00494             <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Non-existent thread-group id &#39;%d&#39;&quot;</span>), <span class="keywordtype">id</span>);
<a name="l00495"></a>00495 
<a name="l00496"></a>00496           pid = inf-&gt;<a class="code" href="structinferior.html#a1be87f581dbb6c893dbe1f2ff701636a">pid</a>;
<a name="l00497"></a>00497         }
<a name="l00498"></a>00498       <span class="keywordflow">else</span>
<a name="l00499"></a>00499         {
<a name="l00500"></a>00500           <span class="comment">/* We must be dealing with a pid.  */</span>
<a name="l00501"></a>00501           pid = strtol (argv[0], &amp;end, 10);
<a name="l00502"></a>00502 
<a name="l00503"></a>00503           <span class="keywordflow">if</span> (*end != <span class="charliteral">&#39;\0&#39;</span>)
<a name="l00504"></a>00504             <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Invalid identifier &#39;%s&#39;&quot;</span>), argv[0]);
<a name="l00505"></a>00505         }
<a name="l00506"></a>00506 
<a name="l00507"></a>00507       <span class="comment">/* Pick any thread in the desired process.  Current</span>
<a name="l00508"></a>00508 <span class="comment">         target_detach detaches from the parent of inferior_ptid.  */</span>
<a name="l00509"></a>00509       tp = <a class="code" href="gdbthread_8h.html#a5dc20fee3cc8a79f615f2f5d695ae1bc">iterate_over_threads</a> (find_thread_of_process, &amp;pid);
<a name="l00510"></a>00510       <span class="keywordflow">if</span> (!tp)
<a name="l00511"></a>00511         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Thread group is empty&quot;</span>));
<a name="l00512"></a>00512 
<a name="l00513"></a>00513       <a class="code" href="gdbthread_8h.html#aee26ee8d9825599b321b73d2ecb5ac54">switch_to_thread</a> (tp-&gt;<a class="code" href="structthread__info.html#a533aa3979b60affd446e9fbff93fdd2c">ptid</a>);
<a name="l00514"></a>00514     }
<a name="l00515"></a>00515 
<a name="l00516"></a>00516   <a class="code" href="infcmd_8c.html#a0a68bf21cfb5c9529d4195d694f9822d">detach_command</a> (NULL, 0);
<a name="l00517"></a>00517 }
<a name="l00518"></a>00518 
<a name="l00519"></a>00519 <span class="keywordtype">void</span>
<a name="l00520"></a><a class="code" href="mi-main_8c.html#a73ba3af589eca826e8f63cb50a27901c">00520</a> <a class="code" href="mi-cmds_8h.html#ac4f33527ea30508c71fcacfc239ea143">mi_cmd_thread_select</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l00521"></a>00521 {
<a name="l00522"></a>00522   <span class="keyword">enum</span> <a class="code" href="gdb_8h.html#a99b632589c180c686ae0b53f01cc0d05">gdb_rc</a> rc;
<a name="l00523"></a>00523   <span class="keywordtype">char</span> *mi_error_message;
<a name="l00524"></a>00524 
<a name="l00525"></a>00525   <span class="keywordflow">if</span> (argc != 1)
<a name="l00526"></a>00526     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;-thread-select: USAGE: threadnum.&quot;</span>));
<a name="l00527"></a>00527 
<a name="l00528"></a>00528   rc = <a class="code" href="gdb_8h.html#ab8faf136589d10846dc87457748de65c">gdb_thread_select</a> (<a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>, argv[0], &amp;mi_error_message);
<a name="l00529"></a>00529 
<a name="l00530"></a>00530   <span class="keywordflow">if</span> (rc == <a class="code" href="gdb_8h.html#a99b632589c180c686ae0b53f01cc0d05a41261cc565cd108ae6c24fff5f96f349">GDB_RC_FAIL</a>)
<a name="l00531"></a>00531     {
<a name="l00532"></a>00532       <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, mi_error_message);
<a name="l00533"></a>00533       <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<span class="stringliteral">&quot;%s&quot;</span>, mi_error_message);
<a name="l00534"></a>00534     }
<a name="l00535"></a>00535 }
<a name="l00536"></a>00536 
<a name="l00537"></a>00537 <span class="keywordtype">void</span>
<a name="l00538"></a><a class="code" href="mi-main_8c.html#a45f8ecff8b0dbe49ec4aa7d6e76d2025">00538</a> <a class="code" href="mi-cmds_8h.html#aee1cdac53365fa36392cecfe79e502f8">mi_cmd_thread_list_ids</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l00539"></a>00539 {
<a name="l00540"></a>00540   <span class="keyword">enum</span> <a class="code" href="gdb_8h.html#a99b632589c180c686ae0b53f01cc0d05">gdb_rc</a> rc;
<a name="l00541"></a>00541   <span class="keywordtype">char</span> *mi_error_message;
<a name="l00542"></a>00542 
<a name="l00543"></a>00543   <span class="keywordflow">if</span> (argc != 0)
<a name="l00544"></a>00544     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;-thread-list-ids: No arguments required.&quot;</span>));
<a name="l00545"></a>00545 
<a name="l00546"></a>00546   rc = <a class="code" href="gdb_8h.html#a20a55c9d1164a6f3df0fa8300850b768">gdb_list_thread_ids</a> (<a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>, &amp;mi_error_message);
<a name="l00547"></a>00547 
<a name="l00548"></a>00548   <span class="keywordflow">if</span> (rc == <a class="code" href="gdb_8h.html#a99b632589c180c686ae0b53f01cc0d05a41261cc565cd108ae6c24fff5f96f349">GDB_RC_FAIL</a>)
<a name="l00549"></a>00549     {
<a name="l00550"></a>00550       <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, mi_error_message);
<a name="l00551"></a>00551       <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<span class="stringliteral">&quot;%s&quot;</span>, mi_error_message);
<a name="l00552"></a>00552     }
<a name="l00553"></a>00553 }
<a name="l00554"></a>00554 
<a name="l00555"></a>00555 <span class="keywordtype">void</span>
<a name="l00556"></a><a class="code" href="mi-main_8c.html#a5a84b78af16207c91a2c11c0870b94d1">00556</a> <a class="code" href="mi-cmds_8h.html#a7779bfde3ab7e056636757b38c7089cf">mi_cmd_thread_info</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l00557"></a>00557 {
<a name="l00558"></a>00558   <span class="keywordflow">if</span> (argc != 0 &amp;&amp; argc != 1)
<a name="l00559"></a>00559     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Invalid MI command&quot;</span>));
<a name="l00560"></a>00560 
<a name="l00561"></a>00561   <a class="code" href="gdbthread_8h.html#a167c975e367a3fda8ae5fcc3fd2278e9">print_thread_info</a> (<a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>, argv[0], -1);
<a name="l00562"></a>00562 }
<a name="l00563"></a>00563 
<a name="l00564"></a>00564 <span class="keyword">struct </span>collect_cores_data
<a name="l00565"></a>00565 {
<a name="l00566"></a>00566   <span class="keywordtype">int</span> pid;
<a name="l00567"></a>00567 
<a name="l00568"></a>00568   <a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a> (<span class="keywordtype">int</span>) *cores;
<a name="l00569"></a>00569 };
<a name="l00570"></a>00570 
<a name="l00571"></a>00571 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00572"></a>00572 collect_cores (<span class="keyword">struct</span> <a class="code" href="structthread__info.html">thread_info</a> *ti, <span class="keywordtype">void</span> *xdata)
<a name="l00573"></a>00573 {
<a name="l00574"></a>00574   <span class="keyword">struct </span>collect_cores_data *data = xdata;
<a name="l00575"></a>00575 
<a name="l00576"></a>00576   <span class="keywordflow">if</span> (<a class="code" href="ptid_8c.html#a264ba40fc2a0cf3d4fb24a55fe32aede">ptid_get_pid</a> (ti-&gt;<a class="code" href="structthread__info.html#a533aa3979b60affd446e9fbff93fdd2c">ptid</a>) == data-&gt;pid)
<a name="l00577"></a>00577     {
<a name="l00578"></a>00578       <span class="keywordtype">int</span> core = <a class="code" href="target_8c.html#a71e29bd9cb12824ec46394190d8b08c7">target_core_of_thread</a> (ti-&gt;<a class="code" href="structthread__info.html#a533aa3979b60affd446e9fbff93fdd2c">ptid</a>);
<a name="l00579"></a>00579 
<a name="l00580"></a>00580       <span class="keywordflow">if</span> (core != -1)
<a name="l00581"></a>00581         <a class="code" href="vec_8h.html#a8d090c0524726d00931070e0c438ba3f">VEC_safe_push</a> (<span class="keywordtype">int</span>, data-&gt;cores, core);
<a name="l00582"></a>00582     }
<a name="l00583"></a>00583 
<a name="l00584"></a>00584   <span class="keywordflow">return</span> 0;
<a name="l00585"></a>00585 }
<a name="l00586"></a>00586 
<a name="l00587"></a>00587 <span class="keyword">static</span> <span class="keywordtype">int</span> *
<a name="l00588"></a>00588 unique (<span class="keywordtype">int</span> *b, <span class="keywordtype">int</span> *e)
<a name="l00589"></a>00589 {
<a name="l00590"></a>00590   <span class="keywordtype">int</span> *d = b;
<a name="l00591"></a>00591 
<a name="l00592"></a>00592   <span class="keywordflow">while</span> (++b != e)
<a name="l00593"></a>00593     <span class="keywordflow">if</span> (*d != *b)
<a name="l00594"></a>00594       *++d = *b;
<a name="l00595"></a>00595   <span class="keywordflow">return</span> ++d;
<a name="l00596"></a>00596 }
<a name="l00597"></a>00597 
<a name="l00598"></a>00598 <span class="keyword">struct </span>print_one_inferior_data
<a name="l00599"></a>00599 {
<a name="l00600"></a>00600   <span class="keywordtype">int</span> recurse;
<a name="l00601"></a>00601   <a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a> (<span class="keywordtype">int</span>) *inferiors;
<a name="l00602"></a>00602 };
<a name="l00603"></a>00603 
<a name="l00604"></a>00604 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00605"></a>00605 print_one_inferior (<span class="keyword">struct</span> <a class="code" href="structinferior.html">inferior</a> *<a class="code" href="structinferior.html">inferior</a>, <span class="keywordtype">void</span> *xdata)
<a name="l00606"></a>00606 {
<a name="l00607"></a>00607   <span class="keyword">struct </span>print_one_inferior_data *top_data = xdata;
<a name="l00608"></a>00608   <span class="keyword">struct </span>ui_out *uiout = <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>;
<a name="l00609"></a>00609 
<a name="l00610"></a>00610   <span class="keywordflow">if</span> (<a class="code" href="vec_8h.html#ac9981d313a5e114db0e05b7b9cd16319">VEC_empty</a> (<span class="keywordtype">int</span>, top_data-&gt;inferiors)
<a name="l00611"></a>00611       || bsearch (&amp;(inferior-&gt;<a class="code" href="structinferior.html#a1be87f581dbb6c893dbe1f2ff701636a">pid</a>), <a class="code" href="vec_8h.html#a99adc2006a668acc675e3758d9375ad5">VEC_address</a> (<span class="keywordtype">int</span>, top_data-&gt;inferiors),
<a name="l00612"></a>00612                   <a class="code" href="vec_8h.html#a844523bba6d0565ef73a0f4a63e48d19">VEC_length</a> (<span class="keywordtype">int</span>, top_data-&gt;inferiors), sizeof (<span class="keywordtype">int</span>),
<a name="l00613"></a>00613                   <a class="code" href="utils_8c.html#a00f163b156a7016aea4a27a9d76cc484">compare_positive_ints</a>))
<a name="l00614"></a>00614     {
<a name="l00615"></a>00615       <span class="keyword">struct </span>collect_cores_data data;
<a name="l00616"></a>00616       <span class="keyword">struct </span>cleanup *back_to
<a name="l00617"></a>00617         = <a class="code" href="ui-out_8c.html#aaf5a0c991d74ad2e486f420d5c2ff058">make_cleanup_ui_out_tuple_begin_end</a> (uiout, NULL);
<a name="l00618"></a>00618 
<a name="l00619"></a>00619       <a class="code" href="ui-out_8c.html#ac29596ba86f387928e0d3e6b7385f998">ui_out_field_fmt</a> (uiout, <span class="stringliteral">&quot;id&quot;</span>, <span class="stringliteral">&quot;i%d&quot;</span>, inferior-&gt;<a class="code" href="structinferior.html#af9e2350a56bd124ce14020ccc0c93f9e">num</a>);
<a name="l00620"></a>00620       <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;process&quot;</span>);
<a name="l00621"></a>00621       <span class="keywordflow">if</span> (inferior-&gt;<a class="code" href="structinferior.html#a1be87f581dbb6c893dbe1f2ff701636a">pid</a> != 0)
<a name="l00622"></a>00622         <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, <span class="stringliteral">&quot;pid&quot;</span>, inferior-&gt;<a class="code" href="structinferior.html#a1be87f581dbb6c893dbe1f2ff701636a">pid</a>);
<a name="l00623"></a>00623 
<a name="l00624"></a>00624       <span class="keywordflow">if</span> (inferior-&gt;<a class="code" href="structinferior.html#afc6a557206fd753b89e34bd33e038cfe">pspace</a>-&gt;<a class="code" href="structprogram__space.html#af70c73ab805f969f5717ac984eb52cee">pspace_exec_filename</a> != NULL)
<a name="l00625"></a>00625         {
<a name="l00626"></a>00626           <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;executable&quot;</span>,
<a name="l00627"></a>00627                                inferior-&gt;<a class="code" href="structinferior.html#afc6a557206fd753b89e34bd33e038cfe">pspace</a>-&gt;<a class="code" href="structprogram__space.html#af70c73ab805f969f5717ac984eb52cee">pspace_exec_filename</a>);
<a name="l00628"></a>00628         }
<a name="l00629"></a>00629 
<a name="l00630"></a>00630       data.cores = 0;
<a name="l00631"></a>00631       <span class="keywordflow">if</span> (inferior-&gt;<a class="code" href="structinferior.html#a1be87f581dbb6c893dbe1f2ff701636a">pid</a> != 0)
<a name="l00632"></a>00632         {
<a name="l00633"></a>00633           data.pid = inferior-&gt;<a class="code" href="structinferior.html#a1be87f581dbb6c893dbe1f2ff701636a">pid</a>;
<a name="l00634"></a>00634           <a class="code" href="gdbthread_8h.html#a5dc20fee3cc8a79f615f2f5d695ae1bc">iterate_over_threads</a> (collect_cores, &amp;data);
<a name="l00635"></a>00635         }
<a name="l00636"></a>00636 
<a name="l00637"></a>00637       <span class="keywordflow">if</span> (!<a class="code" href="vec_8h.html#ac9981d313a5e114db0e05b7b9cd16319">VEC_empty</a> (<span class="keywordtype">int</span>, data.cores))
<a name="l00638"></a>00638         {
<a name="l00639"></a>00639           <span class="keywordtype">int</span> *b, *e;
<a name="l00640"></a>00640           <span class="keyword">struct </span>cleanup *back_to_2 =
<a name="l00641"></a>00641             <a class="code" href="ui-out_8c.html#aa6e8e9b18ba11e13617a6c56cbfab08f">make_cleanup_ui_out_list_begin_end</a> (uiout, <span class="stringliteral">&quot;cores&quot;</span>);
<a name="l00642"></a>00642 
<a name="l00643"></a>00643           <a class="code" href="ada-exp_8c.html#a849e2297facde4d3c80dc4f45f8abbdb">qsort</a> (<a class="code" href="vec_8h.html#a99adc2006a668acc675e3758d9375ad5">VEC_address</a> (<span class="keywordtype">int</span>, data.cores),
<a name="l00644"></a>00644                  <a class="code" href="vec_8h.html#a844523bba6d0565ef73a0f4a63e48d19">VEC_length</a> (<span class="keywordtype">int</span>, data.cores), sizeof (<span class="keywordtype">int</span>),
<a name="l00645"></a>00645                  <a class="code" href="utils_8c.html#a00f163b156a7016aea4a27a9d76cc484">compare_positive_ints</a>);
<a name="l00646"></a>00646 
<a name="l00647"></a>00647           b = <a class="code" href="vec_8h.html#a99adc2006a668acc675e3758d9375ad5">VEC_address</a> (<span class="keywordtype">int</span>, data.cores);
<a name="l00648"></a>00648           e = b + <a class="code" href="vec_8h.html#a844523bba6d0565ef73a0f4a63e48d19">VEC_length</a> (<span class="keywordtype">int</span>, data.cores);
<a name="l00649"></a>00649           e = unique (b, e);
<a name="l00650"></a>00650 
<a name="l00651"></a>00651           <span class="keywordflow">for</span> (; b != e; ++b)
<a name="l00652"></a>00652             <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, NULL, *b);
<a name="l00653"></a>00653 
<a name="l00654"></a>00654           <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (back_to_2);
<a name="l00655"></a>00655         }
<a name="l00656"></a>00656 
<a name="l00657"></a>00657       <span class="keywordflow">if</span> (top_data-&gt;recurse)
<a name="l00658"></a>00658         <a class="code" href="gdbthread_8h.html#a167c975e367a3fda8ae5fcc3fd2278e9">print_thread_info</a> (uiout, NULL, inferior-&gt;<a class="code" href="structinferior.html#a1be87f581dbb6c893dbe1f2ff701636a">pid</a>);
<a name="l00659"></a>00659 
<a name="l00660"></a>00660       <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (back_to);
<a name="l00661"></a>00661     }
<a name="l00662"></a>00662 
<a name="l00663"></a>00663   <span class="keywordflow">return</span> 0;
<a name="l00664"></a>00664 }
<a name="l00665"></a>00665 
<a name="l00666"></a>00666 <span class="comment">/* Output a field named &#39;cores&#39; with a list as the value.  The</span>
<a name="l00667"></a>00667 <span class="comment">   elements of the list are obtained by splitting &#39;cores&#39; on</span>
<a name="l00668"></a>00668 <span class="comment">   comma.  */</span>
<a name="l00669"></a>00669 
<a name="l00670"></a>00670 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00671"></a>00671 output_cores (<span class="keyword">struct</span> ui_out *uiout, <span class="keyword">const</span> <span class="keywordtype">char</span> *field_name, <span class="keyword">const</span> <span class="keywordtype">char</span> *xcores)
<a name="l00672"></a>00672 {
<a name="l00673"></a>00673   <span class="keyword">struct </span>cleanup *back_to = <a class="code" href="ui-out_8c.html#aa6e8e9b18ba11e13617a6c56cbfab08f">make_cleanup_ui_out_list_begin_end</a> (uiout,
<a name="l00674"></a>00674                                                                 field_name);
<a name="l00675"></a>00675   <span class="keywordtype">char</span> *cores = xstrdup (xcores);
<a name="l00676"></a>00676   <span class="keywordtype">char</span> *p = cores;
<a name="l00677"></a>00677 
<a name="l00678"></a>00678   <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, cores);
<a name="l00679"></a>00679 
<a name="l00680"></a>00680   <span class="keywordflow">for</span> (p = <a class="code" href="gdb__string_8h.html#a982a35856962b3ac6151cdc0b6e893f6">strtok</a> (p, <span class="stringliteral">&quot;,&quot;</span>); p;  p = <a class="code" href="gdb__string_8h.html#a982a35856962b3ac6151cdc0b6e893f6">strtok</a> (NULL, <span class="stringliteral">&quot;,&quot;</span>))
<a name="l00681"></a>00681     <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, NULL, p);
<a name="l00682"></a>00682 
<a name="l00683"></a>00683   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (back_to);
<a name="l00684"></a>00684 }
<a name="l00685"></a>00685 
<a name="l00686"></a>00686 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00687"></a>00687 free_vector_of_ints (<span class="keywordtype">void</span> *xvector)
<a name="l00688"></a>00688 {
<a name="l00689"></a>00689   <a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a> (<span class="keywordtype">int</span>) **vector = xvector;
<a name="l00690"></a>00690 
<a name="l00691"></a>00691   <a class="code" href="vec_8h.html#af5724b2bbce65103300279f9abe7f577">VEC_free</a> (<span class="keywordtype">int</span>, *vector);
<a name="l00692"></a>00692 }
<a name="l00693"></a>00693 
<a name="l00694"></a>00694 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00695"></a>00695 do_nothing (splay_tree_key k)
<a name="l00696"></a>00696 {
<a name="l00697"></a>00697 }
<a name="l00698"></a>00698 
<a name="l00699"></a>00699 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00700"></a>00700 free_vector_of_osdata_items (splay_tree_value xvalue)
<a name="l00701"></a>00701 {
<a name="l00702"></a>00702   <a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a> (<a class="code" href="structosdata__item.html">osdata_item_s</a>) *value = (<a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a> (<a class="code" href="structosdata__item.html">osdata_item_s</a>) *) xvalue;
<a name="l00703"></a>00703 
<a name="l00704"></a>00704   <span class="comment">/* We don&#39;t free the items itself, it will be done separately.  */</span>
<a name="l00705"></a>00705   <a class="code" href="vec_8h.html#af5724b2bbce65103300279f9abe7f577">VEC_free</a> (<a class="code" href="structosdata__item.html">osdata_item_s</a>, value);
<a name="l00706"></a>00706 }
<a name="l00707"></a>00707 
<a name="l00708"></a>00708 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l00709"></a>00709 splay_tree_int_comparator (splay_tree_key xa, splay_tree_key xb)
<a name="l00710"></a>00710 {
<a name="l00711"></a>00711   <span class="keywordtype">int</span> a = xa;
<a name="l00712"></a>00712   <span class="keywordtype">int</span> b = xb;
<a name="l00713"></a>00713 
<a name="l00714"></a>00714   <span class="keywordflow">return</span> a - b;
<a name="l00715"></a>00715 }
<a name="l00716"></a>00716 
<a name="l00717"></a>00717 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00718"></a>00718 free_splay_tree (<span class="keywordtype">void</span> *xt)
<a name="l00719"></a>00719 {
<a name="l00720"></a>00720   splay_tree t = xt;
<a name="l00721"></a>00721   splay_tree_delete (t);
<a name="l00722"></a>00722 }
<a name="l00723"></a>00723 
<a name="l00724"></a>00724 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00725"></a>00725 list_available_thread_groups (<a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a> (<span class="keywordtype">int</span>) *ids, <span class="keywordtype">int</span> recurse)
<a name="l00726"></a>00726 {
<a name="l00727"></a>00727   <span class="keyword">struct </span><a class="code" href="structosdata.html">osdata</a> *data;
<a name="l00728"></a>00728   <span class="keyword">struct </span><a class="code" href="structosdata__item.html">osdata_item</a> *item;
<a name="l00729"></a>00729   <span class="keywordtype">int</span> ix_items;
<a name="l00730"></a>00730   <span class="keyword">struct </span>ui_out *uiout = <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>;
<a name="l00731"></a>00731   <span class="keyword">struct </span>cleanup *cleanup;
<a name="l00732"></a>00732 
<a name="l00733"></a>00733   <span class="comment">/* This keeps a map from integer (pid) to VEC (struct osdata_item *)*</span>
<a name="l00734"></a>00734 <span class="comment">     The vector contains information about all threads for the given pid.</span>
<a name="l00735"></a>00735 <span class="comment">     This is assigned an initial value to avoid &quot;may be used uninitialized&quot;</span>
<a name="l00736"></a>00736 <span class="comment">     warning from gcc.  */</span>
<a name="l00737"></a>00737   splay_tree tree = NULL;
<a name="l00738"></a>00738 
<a name="l00739"></a>00739   <span class="comment">/* get_osdata will throw if it cannot return data.  */</span>
<a name="l00740"></a>00740   data = <a class="code" href="osdata_8c.html#a979351c044e443cfe300a5859592aa96">get_osdata</a> (<span class="stringliteral">&quot;processes&quot;</span>);
<a name="l00741"></a>00741   cleanup = <a class="code" href="osdata_8c.html#a6bc40dc4a9c22c5acff592c6afe02405">make_cleanup_osdata_free</a> (data);
<a name="l00742"></a>00742 
<a name="l00743"></a>00743   <span class="keywordflow">if</span> (recurse)
<a name="l00744"></a>00744     {
<a name="l00745"></a>00745       <span class="keyword">struct </span><a class="code" href="structosdata.html">osdata</a> *threads = <a class="code" href="osdata_8c.html#a979351c044e443cfe300a5859592aa96">get_osdata</a> (<span class="stringliteral">&quot;threads&quot;</span>);
<a name="l00746"></a>00746 
<a name="l00747"></a>00747       <a class="code" href="osdata_8c.html#a6bc40dc4a9c22c5acff592c6afe02405">make_cleanup_osdata_free</a> (threads);
<a name="l00748"></a>00748       tree = splay_tree_new (splay_tree_int_comparator,
<a name="l00749"></a>00749                              do_nothing,
<a name="l00750"></a>00750                              free_vector_of_osdata_items);
<a name="l00751"></a>00751       <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (free_splay_tree, tree);
<a name="l00752"></a>00752 
<a name="l00753"></a>00753       <span class="keywordflow">for</span> (ix_items = 0;
<a name="l00754"></a>00754            <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="structosdata__item.html">osdata_item_s</a>, threads-&gt;items,
<a name="l00755"></a>00755                         ix_items, item);
<a name="l00756"></a>00756            ix_items++)
<a name="l00757"></a>00757         {
<a name="l00758"></a>00758           <span class="keyword">const</span> <span class="keywordtype">char</span> *pid = <a class="code" href="osdata_8c.html#a1ace2baafa4035aca28130a66f1b7384">get_osdata_column</a> (item, <span class="stringliteral">&quot;pid&quot;</span>);
<a name="l00759"></a>00759           <span class="keywordtype">int</span> pid_i = strtoul (pid, NULL, 0);
<a name="l00760"></a>00760           <a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a> (<a class="code" href="structosdata__item.html">osdata_item_s</a>) *vec = 0;
<a name="l00761"></a>00761 
<a name="l00762"></a>00762           splay_tree_node n = splay_tree_lookup (tree, pid_i);
<a name="l00763"></a>00763           <span class="keywordflow">if</span> (!n)
<a name="l00764"></a>00764             {
<a name="l00765"></a>00765               <a class="code" href="vec_8h.html#a8d090c0524726d00931070e0c438ba3f">VEC_safe_push</a> (<a class="code" href="structosdata__item.html">osdata_item_s</a>, vec, item);
<a name="l00766"></a>00766               splay_tree_insert (tree, pid_i, (splay_tree_value)vec);
<a name="l00767"></a>00767             }
<a name="l00768"></a>00768           <span class="keywordflow">else</span>
<a name="l00769"></a>00769             {
<a name="l00770"></a>00770               vec = (<a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a> (<a class="code" href="structosdata__item.html">osdata_item_s</a>) *) n-&gt;value;
<a name="l00771"></a>00771               <a class="code" href="vec_8h.html#a8d090c0524726d00931070e0c438ba3f">VEC_safe_push</a> (<a class="code" href="structosdata__item.html">osdata_item_s</a>, vec, item);
<a name="l00772"></a>00772               n-&gt;value = (splay_tree_value) vec;
<a name="l00773"></a>00773             }
<a name="l00774"></a>00774         }
<a name="l00775"></a>00775     }
<a name="l00776"></a>00776 
<a name="l00777"></a>00777   <a class="code" href="ui-out_8c.html#aa6e8e9b18ba11e13617a6c56cbfab08f">make_cleanup_ui_out_list_begin_end</a> (uiout, <span class="stringliteral">&quot;groups&quot;</span>);
<a name="l00778"></a>00778 
<a name="l00779"></a>00779   <span class="keywordflow">for</span> (ix_items = 0;
<a name="l00780"></a>00780        <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="structosdata__item.html">osdata_item_s</a>, data-&gt;items,
<a name="l00781"></a>00781                     ix_items, item);
<a name="l00782"></a>00782        ix_items++)
<a name="l00783"></a>00783     {
<a name="l00784"></a>00784       <span class="keyword">struct </span>cleanup *back_to;
<a name="l00785"></a>00785 
<a name="l00786"></a>00786       <span class="keyword">const</span> <span class="keywordtype">char</span> *pid = <a class="code" href="osdata_8c.html#a1ace2baafa4035aca28130a66f1b7384">get_osdata_column</a> (item, <span class="stringliteral">&quot;pid&quot;</span>);
<a name="l00787"></a>00787       <span class="keyword">const</span> <span class="keywordtype">char</span> *cmd = <a class="code" href="osdata_8c.html#a1ace2baafa4035aca28130a66f1b7384">get_osdata_column</a> (item, <span class="stringliteral">&quot;command&quot;</span>);
<a name="l00788"></a>00788       <span class="keyword">const</span> <span class="keywordtype">char</span> *user = <a class="code" href="osdata_8c.html#a1ace2baafa4035aca28130a66f1b7384">get_osdata_column</a> (item, <span class="stringliteral">&quot;user&quot;</span>);
<a name="l00789"></a>00789       <span class="keyword">const</span> <span class="keywordtype">char</span> *cores = <a class="code" href="osdata_8c.html#a1ace2baafa4035aca28130a66f1b7384">get_osdata_column</a> (item, <span class="stringliteral">&quot;cores&quot;</span>);
<a name="l00790"></a>00790 
<a name="l00791"></a>00791       <span class="keywordtype">int</span> pid_i = strtoul (pid, NULL, 0);
<a name="l00792"></a>00792 
<a name="l00793"></a>00793       <span class="comment">/* At present, the target will return all available processes</span>
<a name="l00794"></a>00794 <span class="comment">         and if information about specific ones was required, we filter</span>
<a name="l00795"></a>00795 <span class="comment">         undesired processes here.  */</span>
<a name="l00796"></a>00796       <span class="keywordflow">if</span> (ids &amp;&amp; bsearch (&amp;pid_i, <a class="code" href="vec_8h.html#a99adc2006a668acc675e3758d9375ad5">VEC_address</a> (<span class="keywordtype">int</span>, ids),
<a name="l00797"></a>00797                           <a class="code" href="vec_8h.html#a844523bba6d0565ef73a0f4a63e48d19">VEC_length</a> (<span class="keywordtype">int</span>, ids),
<a name="l00798"></a>00798                           <span class="keyword">sizeof</span> (<span class="keywordtype">int</span>), <a class="code" href="utils_8c.html#a00f163b156a7016aea4a27a9d76cc484">compare_positive_ints</a>) == NULL)
<a name="l00799"></a>00799         <span class="keywordflow">continue</span>;
<a name="l00800"></a>00800 
<a name="l00801"></a>00801 
<a name="l00802"></a>00802       back_to = <a class="code" href="ui-out_8c.html#aaf5a0c991d74ad2e486f420d5c2ff058">make_cleanup_ui_out_tuple_begin_end</a> (uiout, NULL);
<a name="l00803"></a>00803 
<a name="l00804"></a>00804       <a class="code" href="ui-out_8c.html#ac29596ba86f387928e0d3e6b7385f998">ui_out_field_fmt</a> (uiout, <span class="stringliteral">&quot;id&quot;</span>, <span class="stringliteral">&quot;%s&quot;</span>, pid);
<a name="l00805"></a>00805       <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;process&quot;</span>);
<a name="l00806"></a>00806       <span class="keywordflow">if</span> (cmd)
<a name="l00807"></a>00807         <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;description&quot;</span>, cmd);
<a name="l00808"></a>00808       <span class="keywordflow">if</span> (user)
<a name="l00809"></a>00809         <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;user&quot;</span>, user);
<a name="l00810"></a>00810       <span class="keywordflow">if</span> (cores)
<a name="l00811"></a>00811         output_cores (uiout, <span class="stringliteral">&quot;cores&quot;</span>, cores);
<a name="l00812"></a>00812 
<a name="l00813"></a>00813       <span class="keywordflow">if</span> (recurse)
<a name="l00814"></a>00814         {
<a name="l00815"></a>00815           splay_tree_node n = splay_tree_lookup (tree, pid_i);
<a name="l00816"></a>00816           <span class="keywordflow">if</span> (n)
<a name="l00817"></a>00817             {
<a name="l00818"></a>00818               <a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a> (<a class="code" href="structosdata__item.html">osdata_item_s</a>) *children = (<a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a> (<a class="code" href="structosdata__item.html">osdata_item_s</a>) *) n-&gt;value;
<a name="l00819"></a>00819               <span class="keyword">struct</span> <a class="code" href="structosdata__item.html">osdata_item</a> *child;
<a name="l00820"></a>00820               <span class="keywordtype">int</span> ix_child;
<a name="l00821"></a>00821 
<a name="l00822"></a>00822               <a class="code" href="ui-out_8c.html#aa6e8e9b18ba11e13617a6c56cbfab08f">make_cleanup_ui_out_list_begin_end</a> (uiout, <span class="stringliteral">&quot;threads&quot;</span>);
<a name="l00823"></a>00823 
<a name="l00824"></a>00824               <span class="keywordflow">for</span> (ix_child = 0;
<a name="l00825"></a>00825                    <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="structosdata__item.html">osdata_item_s</a>, children, ix_child, child);
<a name="l00826"></a>00826                    ++ix_child)
<a name="l00827"></a>00827                 {
<a name="l00828"></a>00828                   <span class="keyword">struct </span>cleanup *back_to_2 =
<a name="l00829"></a>00829                     <a class="code" href="ui-out_8c.html#aaf5a0c991d74ad2e486f420d5c2ff058">make_cleanup_ui_out_tuple_begin_end</a> (uiout, NULL);
<a name="l00830"></a>00830                   <span class="keyword">const</span> <span class="keywordtype">char</span> *tid = <a class="code" href="osdata_8c.html#a1ace2baafa4035aca28130a66f1b7384">get_osdata_column</a> (child, <span class="stringliteral">&quot;tid&quot;</span>);
<a name="l00831"></a>00831                   <span class="keyword">const</span> <span class="keywordtype">char</span> *tcore = <a class="code" href="osdata_8c.html#a1ace2baafa4035aca28130a66f1b7384">get_osdata_column</a> (child, <span class="stringliteral">&quot;core&quot;</span>);
<a name="l00832"></a>00832 
<a name="l00833"></a>00833                   <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;id&quot;</span>, tid);
<a name="l00834"></a>00834                   <span class="keywordflow">if</span> (tcore)
<a name="l00835"></a>00835                     <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;core&quot;</span>, tcore);
<a name="l00836"></a>00836 
<a name="l00837"></a>00837                   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (back_to_2);
<a name="l00838"></a>00838                 }
<a name="l00839"></a>00839             }
<a name="l00840"></a>00840         }
<a name="l00841"></a>00841 
<a name="l00842"></a>00842       <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (back_to);
<a name="l00843"></a>00843     }
<a name="l00844"></a>00844 
<a name="l00845"></a>00845   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup);
<a name="l00846"></a>00846 }
<a name="l00847"></a>00847 
<a name="l00848"></a>00848 <span class="keywordtype">void</span>
<a name="l00849"></a><a class="code" href="mi-main_8c.html#ad104fa4a253449529d5273d9337a8669">00849</a> <a class="code" href="mi-cmds_8h.html#ad641dd302393d9b85f1db39002ffe684">mi_cmd_list_thread_groups</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l00850"></a>00850 {
<a name="l00851"></a>00851   <span class="keyword">struct </span>ui_out *uiout = <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>;
<a name="l00852"></a>00852   <span class="keyword">struct </span>cleanup *back_to;
<a name="l00853"></a>00853   <span class="keywordtype">int</span> <a class="code" href="go32-nat_8c.html#a895490fe498cd5a3d7e7002b5bba55dd">available</a> = 0;
<a name="l00854"></a>00854   <span class="keywordtype">int</span> recurse = 0;
<a name="l00855"></a>00855   <a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a> (<span class="keywordtype">int</span>) *ids = 0;
<a name="l00856"></a>00856 
<a name="l00857"></a>00857   <span class="keyword">enum</span> opt
<a name="l00858"></a>00858   {
<a name="l00859"></a>00859     AVAILABLE_OPT, RECURSE_OPT
<a name="l00860"></a>00860   };
<a name="l00861"></a>00861   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structmi__opt.html">mi_opt</a> opts[] =
<a name="l00862"></a>00862     {
<a name="l00863"></a>00863       {<span class="stringliteral">&quot;-available&quot;</span>, AVAILABLE_OPT, 0},
<a name="l00864"></a>00864       {<span class="stringliteral">&quot;-recurse&quot;</span>, RECURSE_OPT, 1},
<a name="l00865"></a>00865       { 0, 0, 0 }
<a name="l00866"></a>00866     };
<a name="l00867"></a>00867 
<a name="l00868"></a>00868   <span class="keywordtype">int</span> oind = 0;
<a name="l00869"></a>00869   <span class="keywordtype">char</span> *oarg;
<a name="l00870"></a>00870 
<a name="l00871"></a>00871   <span class="keywordflow">while</span> (1)
<a name="l00872"></a>00872     {
<a name="l00873"></a>00873       <span class="keywordtype">int</span> opt = <a class="code" href="mi-getopt_8c.html#af7bb1a80abf57e9afae0149d3af20b9c">mi_getopt</a> (<span class="stringliteral">&quot;-list-thread-groups&quot;</span>, argc, argv, opts,
<a name="l00874"></a>00874                            &amp;oind, &amp;oarg);
<a name="l00875"></a>00875 
<a name="l00876"></a>00876       <span class="keywordflow">if</span> (opt &lt; 0)
<a name="l00877"></a>00877         <span class="keywordflow">break</span>;
<a name="l00878"></a>00878       <span class="keywordflow">switch</span> ((<span class="keyword">enum</span> opt) opt)
<a name="l00879"></a>00879         {
<a name="l00880"></a>00880         <span class="keywordflow">case</span> AVAILABLE_OPT:
<a name="l00881"></a>00881           available = 1;
<a name="l00882"></a>00882           <span class="keywordflow">break</span>;
<a name="l00883"></a>00883         <span class="keywordflow">case</span> RECURSE_OPT:
<a name="l00884"></a>00884           <span class="keywordflow">if</span> (strcmp (oarg, <span class="stringliteral">&quot;0&quot;</span>) == 0)
<a name="l00885"></a>00885             ;
<a name="l00886"></a>00886           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (oarg, <span class="stringliteral">&quot;1&quot;</span>) == 0)
<a name="l00887"></a>00887             recurse = 1;
<a name="l00888"></a>00888           <span class="keywordflow">else</span>
<a name="l00889"></a>00889             <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;only &#39;0&#39; and &#39;1&#39; are valid values &quot;</span>
<a name="l00890"></a>00890                      <span class="stringliteral">&quot;for the &#39;--recurse&#39; option&quot;</span>));
<a name="l00891"></a>00891           <span class="keywordflow">break</span>;
<a name="l00892"></a>00892         }
<a name="l00893"></a>00893     }
<a name="l00894"></a>00894 
<a name="l00895"></a>00895   <span class="keywordflow">for</span> (; oind &lt; argc; ++oind)
<a name="l00896"></a>00896     {
<a name="l00897"></a>00897       <span class="keywordtype">char</span> *end;
<a name="l00898"></a>00898       <span class="keywordtype">int</span> <a class="code" href="namespacearm-linux.html#aaf6bae53545ee96f24d7ba560ed0a205">inf</a>;
<a name="l00899"></a>00899 
<a name="l00900"></a>00900       <span class="keywordflow">if</span> (*(argv[oind]) != <span class="charliteral">&#39;i&#39;</span>)
<a name="l00901"></a>00901         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;invalid syntax of group id &#39;%s&#39;&quot;</span>), argv[oind]);
<a name="l00902"></a>00902 
<a name="l00903"></a>00903       inf = strtoul (argv[oind] + 1, &amp;end, 0);
<a name="l00904"></a>00904 
<a name="l00905"></a>00905       <span class="keywordflow">if</span> (*end != <span class="charliteral">&#39;\0&#39;</span>)
<a name="l00906"></a>00906         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;invalid syntax of group id &#39;%s&#39;&quot;</span>), argv[oind]);
<a name="l00907"></a>00907       <a class="code" href="vec_8h.html#a8d090c0524726d00931070e0c438ba3f">VEC_safe_push</a> (<span class="keywordtype">int</span>, ids, inf);
<a name="l00908"></a>00908     }
<a name="l00909"></a>00909   <span class="keywordflow">if</span> (<a class="code" href="vec_8h.html#a844523bba6d0565ef73a0f4a63e48d19">VEC_length</a> (<span class="keywordtype">int</span>, ids) &gt; 1)
<a name="l00910"></a>00910     <a class="code" href="ada-exp_8c.html#a849e2297facde4d3c80dc4f45f8abbdb">qsort</a> (<a class="code" href="vec_8h.html#a99adc2006a668acc675e3758d9375ad5">VEC_address</a> (<span class="keywordtype">int</span>, ids),
<a name="l00911"></a>00911            <a class="code" href="vec_8h.html#a844523bba6d0565ef73a0f4a63e48d19">VEC_length</a> (<span class="keywordtype">int</span>, ids),
<a name="l00912"></a>00912            <span class="keyword">sizeof</span> (<span class="keywordtype">int</span>), <a class="code" href="utils_8c.html#a00f163b156a7016aea4a27a9d76cc484">compare_positive_ints</a>);
<a name="l00913"></a>00913 
<a name="l00914"></a>00914   back_to = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (free_vector_of_ints, &amp;ids);
<a name="l00915"></a>00915 
<a name="l00916"></a>00916   <span class="keywordflow">if</span> (available)
<a name="l00917"></a>00917     {
<a name="l00918"></a>00918       list_available_thread_groups (ids, recurse);
<a name="l00919"></a>00919     }
<a name="l00920"></a>00920   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="vec_8h.html#a844523bba6d0565ef73a0f4a63e48d19">VEC_length</a> (<span class="keywordtype">int</span>, ids) == 1)
<a name="l00921"></a>00921     {
<a name="l00922"></a>00922       <span class="comment">/* Local thread groups, single id.  */</span>
<a name="l00923"></a>00923       <span class="keywordtype">int</span> <span class="keywordtype">id</span> = *<a class="code" href="vec_8h.html#a99adc2006a668acc675e3758d9375ad5">VEC_address</a> (<span class="keywordtype">int</span>, ids);
<a name="l00924"></a>00924       <span class="keyword">struct </span>inferior *inf = <a class="code" href="inferior_8c.html#a3522179a3919bac51a689cb3c0ad98f5">find_inferior_id</a> (<span class="keywordtype">id</span>);
<a name="l00925"></a>00925 
<a name="l00926"></a>00926       <span class="keywordflow">if</span> (!inf)
<a name="l00927"></a>00927         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Non-existent thread group id &#39;%d&#39;&quot;</span>), <span class="keywordtype">id</span>);
<a name="l00928"></a>00928       
<a name="l00929"></a>00929       <a class="code" href="gdbthread_8h.html#a167c975e367a3fda8ae5fcc3fd2278e9">print_thread_info</a> (uiout, NULL, inf-&gt;<a class="code" href="structinferior.html#a1be87f581dbb6c893dbe1f2ff701636a">pid</a>);
<a name="l00930"></a>00930     }
<a name="l00931"></a>00931   <span class="keywordflow">else</span>
<a name="l00932"></a>00932     {
<a name="l00933"></a>00933       <span class="keyword">struct </span>print_one_inferior_data data;
<a name="l00934"></a>00934 
<a name="l00935"></a>00935       data.recurse = recurse;
<a name="l00936"></a>00936       data.inferiors = ids;
<a name="l00937"></a>00937 
<a name="l00938"></a>00938       <span class="comment">/* Local thread groups.  Either no explicit ids -- and we</span>
<a name="l00939"></a>00939 <span class="comment">         print everything, or several explicit ids.  In both cases,</span>
<a name="l00940"></a>00940 <span class="comment">         we print more than one group, and have to use &#39;groups&#39;</span>
<a name="l00941"></a>00941 <span class="comment">         as the top-level element.  */</span>
<a name="l00942"></a>00942       <a class="code" href="ui-out_8c.html#aa6e8e9b18ba11e13617a6c56cbfab08f">make_cleanup_ui_out_list_begin_end</a> (uiout, <span class="stringliteral">&quot;groups&quot;</span>);
<a name="l00943"></a>00943       <a class="code" href="gdbthread_8h.html#a8de493c5470df788de1e599a88a45879">update_thread_list</a> ();
<a name="l00944"></a>00944       <a class="code" href="inferior_8c.html#afcb3f43a2669a8ad733c575dc07d3a80">iterate_over_inferiors</a> (print_one_inferior, &amp;data);
<a name="l00945"></a>00945     }
<a name="l00946"></a>00946 
<a name="l00947"></a>00947   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (back_to);
<a name="l00948"></a>00948 }
<a name="l00949"></a>00949 
<a name="l00950"></a>00950 <span class="keywordtype">void</span>
<a name="l00951"></a><a class="code" href="mi-main_8c.html#a0ce42c79d91c1f117d3e52093e218d87">00951</a> <a class="code" href="mi-cmds_8h.html#a04ec07eed182379a1ae95b1be3d3685b">mi_cmd_data_list_register_names</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l00952"></a>00952 {
<a name="l00953"></a>00953   <span class="keyword">struct </span>gdbarch *gdbarch;
<a name="l00954"></a>00954   <span class="keyword">struct </span>ui_out *uiout = <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>;
<a name="l00955"></a>00955   <span class="keywordtype">int</span> <a class="code" href="aarch64-tdep_8c.html#a6b3d1ad0bca4067ccaef1366bea0db04">regnum</a>, numregs;
<a name="l00956"></a>00956   <span class="keywordtype">int</span> i;
<a name="l00957"></a>00957   <span class="keyword">struct </span>cleanup *cleanup;
<a name="l00958"></a>00958 
<a name="l00959"></a>00959   <span class="comment">/* Note that the test for a valid register must include checking the</span>
<a name="l00960"></a>00960 <span class="comment">     gdbarch_register_name because gdbarch_num_regs may be allocated</span>
<a name="l00961"></a>00961 <span class="comment">     for the union of the register sets within a family of related</span>
<a name="l00962"></a>00962 <span class="comment">     processors.  In this case, some entries of gdbarch_register_name</span>
<a name="l00963"></a>00963 <span class="comment">     will change depending upon the particular processor being</span>
<a name="l00964"></a>00964 <span class="comment">     debugged.  */</span>
<a name="l00965"></a>00965 
<a name="l00966"></a>00966   gdbarch = <a class="code" href="arch-utils_8c.html#a0fe1e68475f442e5d6dda589e0c62454">get_current_arch</a> ();
<a name="l00967"></a>00967   numregs = <a class="code" href="gdbarch_8c.html#a69069435754d0b434c7043a21d247325">gdbarch_num_regs</a> (gdbarch) + <a class="code" href="gdbarch_8c.html#a8e0e40f42e5969ee4559ee47717aa9f3">gdbarch_num_pseudo_regs</a> (gdbarch);
<a name="l00968"></a>00968 
<a name="l00969"></a>00969   cleanup = <a class="code" href="ui-out_8c.html#aa6e8e9b18ba11e13617a6c56cbfab08f">make_cleanup_ui_out_list_begin_end</a> (uiout, <span class="stringliteral">&quot;register-names&quot;</span>);
<a name="l00970"></a>00970 
<a name="l00971"></a>00971   <span class="keywordflow">if</span> (argc == 0)                <span class="comment">/* No args, just do all the regs.  */</span>
<a name="l00972"></a>00972     {
<a name="l00973"></a>00973       <span class="keywordflow">for</span> (regnum = 0;
<a name="l00974"></a>00974            regnum &lt; numregs;
<a name="l00975"></a>00975            regnum++)
<a name="l00976"></a>00976         {
<a name="l00977"></a>00977           <span class="keywordflow">if</span> (<a class="code" href="gdbarch_8c.html#a86c0cf41eb88c54e943cd80e79af36e5">gdbarch_register_name</a> (gdbarch, regnum) == NULL
<a name="l00978"></a>00978               || *(<a class="code" href="gdbarch_8c.html#a86c0cf41eb88c54e943cd80e79af36e5">gdbarch_register_name</a> (gdbarch, regnum)) == <span class="charliteral">&#39;\0&#39;</span>)
<a name="l00979"></a>00979             <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, NULL, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00980"></a>00980           <span class="keywordflow">else</span>
<a name="l00981"></a>00981             <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, NULL,
<a name="l00982"></a>00982                                  <a class="code" href="gdbarch_8c.html#a86c0cf41eb88c54e943cd80e79af36e5">gdbarch_register_name</a> (gdbarch, regnum));
<a name="l00983"></a>00983         }
<a name="l00984"></a>00984     }
<a name="l00985"></a>00985 
<a name="l00986"></a>00986   <span class="comment">/* Else, list of register #s, just do listed regs.  */</span>
<a name="l00987"></a>00987   <span class="keywordflow">for</span> (i = 0; i &lt; argc; i++)
<a name="l00988"></a>00988     {
<a name="l00989"></a>00989       regnum = atoi (argv[i]);
<a name="l00990"></a>00990       <span class="keywordflow">if</span> (regnum &lt; 0 || regnum &gt;= numregs)
<a name="l00991"></a>00991         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;bad register number&quot;</span>));
<a name="l00992"></a>00992 
<a name="l00993"></a>00993       <span class="keywordflow">if</span> (<a class="code" href="gdbarch_8c.html#a86c0cf41eb88c54e943cd80e79af36e5">gdbarch_register_name</a> (gdbarch, regnum) == NULL
<a name="l00994"></a>00994           || *(<a class="code" href="gdbarch_8c.html#a86c0cf41eb88c54e943cd80e79af36e5">gdbarch_register_name</a> (gdbarch, regnum)) == <span class="charliteral">&#39;\0&#39;</span>)
<a name="l00995"></a>00995         <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, NULL, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00996"></a>00996       <span class="keywordflow">else</span>
<a name="l00997"></a>00997         <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, NULL,
<a name="l00998"></a>00998                              <a class="code" href="gdbarch_8c.html#a86c0cf41eb88c54e943cd80e79af36e5">gdbarch_register_name</a> (gdbarch, regnum));
<a name="l00999"></a>00999     }
<a name="l01000"></a>01000   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup);
<a name="l01001"></a>01001 }
<a name="l01002"></a>01002 
<a name="l01003"></a>01003 <span class="keywordtype">void</span>
<a name="l01004"></a><a class="code" href="mi-main_8c.html#a6df756ccdd93ebe08db049815c32046d">01004</a> <a class="code" href="mi-cmds_8h.html#a3a18dd84cf6212e03977f77c847adf2a">mi_cmd_data_list_changed_registers</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l01005"></a>01005 {
<a name="l01006"></a>01006   <span class="keyword">static</span> <span class="keyword">struct </span>regcache *this_regs = NULL;
<a name="l01007"></a>01007   <span class="keyword">struct </span>ui_out *uiout = <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>;
<a name="l01008"></a>01008   <span class="keyword">struct </span>regcache *prev_regs;
<a name="l01009"></a>01009   <span class="keyword">struct </span>gdbarch *gdbarch;
<a name="l01010"></a>01010   <span class="keywordtype">int</span> <a class="code" href="aarch64-tdep_8c.html#a6b3d1ad0bca4067ccaef1366bea0db04">regnum</a>, numregs, changed;
<a name="l01011"></a>01011   <span class="keywordtype">int</span> i;
<a name="l01012"></a>01012   <span class="keyword">struct </span>cleanup *cleanup;
<a name="l01013"></a>01013 
<a name="l01014"></a>01014   <span class="comment">/* The last time we visited this function, the current frame&#39;s</span>
<a name="l01015"></a>01015 <span class="comment">     register contents were saved in THIS_REGS.  Move THIS_REGS over</span>
<a name="l01016"></a>01016 <span class="comment">     to PREV_REGS, and refresh THIS_REGS with the now-current register</span>
<a name="l01017"></a>01017 <span class="comment">     contents.  */</span>
<a name="l01018"></a>01018 
<a name="l01019"></a>01019   prev_regs = this_regs;
<a name="l01020"></a>01020   this_regs = <a class="code" href="frame_8c.html#a2f7482cb26f04433a174151e008433a1">frame_save_as_regcache</a> (<a class="code" href="frame_8c.html#a8b714a78478670e14a297eba8d1a9915">get_selected_frame</a> (NULL));
<a name="l01021"></a>01021   cleanup = <a class="code" href="regcache_8c.html#af449433caeca012d77fe65713822e41a">make_cleanup_regcache_xfree</a> (prev_regs);
<a name="l01022"></a>01022 
<a name="l01023"></a>01023   <span class="comment">/* Note that the test for a valid register must include checking the</span>
<a name="l01024"></a>01024 <span class="comment">     gdbarch_register_name because gdbarch_num_regs may be allocated</span>
<a name="l01025"></a>01025 <span class="comment">     for the union of the register sets within a family of related</span>
<a name="l01026"></a>01026 <span class="comment">     processors.  In this case, some entries of gdbarch_register_name</span>
<a name="l01027"></a>01027 <span class="comment">     will change depending upon the particular processor being</span>
<a name="l01028"></a>01028 <span class="comment">     debugged.  */</span>
<a name="l01029"></a>01029 
<a name="l01030"></a>01030   gdbarch = <a class="code" href="regcache_8c.html#ad4f6d0cdf256b1fa45d59a6d71b50659">get_regcache_arch</a> (this_regs);
<a name="l01031"></a>01031   numregs = <a class="code" href="gdbarch_8c.html#a69069435754d0b434c7043a21d247325">gdbarch_num_regs</a> (gdbarch) + <a class="code" href="gdbarch_8c.html#a8e0e40f42e5969ee4559ee47717aa9f3">gdbarch_num_pseudo_regs</a> (gdbarch);
<a name="l01032"></a>01032 
<a name="l01033"></a>01033   <a class="code" href="ui-out_8c.html#aa6e8e9b18ba11e13617a6c56cbfab08f">make_cleanup_ui_out_list_begin_end</a> (uiout, <span class="stringliteral">&quot;changed-registers&quot;</span>);
<a name="l01034"></a>01034 
<a name="l01035"></a>01035   <span class="keywordflow">if</span> (argc == 0)
<a name="l01036"></a>01036     {
<a name="l01037"></a>01037       <span class="comment">/* No args, just do all the regs.  */</span>
<a name="l01038"></a>01038       <span class="keywordflow">for</span> (regnum = 0;
<a name="l01039"></a>01039            regnum &lt; numregs;
<a name="l01040"></a>01040            regnum++)
<a name="l01041"></a>01041         {
<a name="l01042"></a>01042           <span class="keywordflow">if</span> (<a class="code" href="gdbarch_8c.html#a86c0cf41eb88c54e943cd80e79af36e5">gdbarch_register_name</a> (gdbarch, regnum) == NULL
<a name="l01043"></a>01043               || *(<a class="code" href="gdbarch_8c.html#a86c0cf41eb88c54e943cd80e79af36e5">gdbarch_register_name</a> (gdbarch, regnum)) == <span class="charliteral">&#39;\0&#39;</span>)
<a name="l01044"></a>01044             <span class="keywordflow">continue</span>;
<a name="l01045"></a>01045           changed = register_changed_p (regnum, prev_regs, this_regs);
<a name="l01046"></a>01046           <span class="keywordflow">if</span> (changed &lt; 0)
<a name="l01047"></a>01047             <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;-data-list-changed-registers: &quot;</span>
<a name="l01048"></a>01048                      <span class="stringliteral">&quot;Unable to read register contents.&quot;</span>));
<a name="l01049"></a>01049           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (changed)
<a name="l01050"></a>01050             <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, NULL, regnum);
<a name="l01051"></a>01051         }
<a name="l01052"></a>01052     }
<a name="l01053"></a>01053 
<a name="l01054"></a>01054   <span class="comment">/* Else, list of register #s, just do listed regs.  */</span>
<a name="l01055"></a>01055   <span class="keywordflow">for</span> (i = 0; i &lt; argc; i++)
<a name="l01056"></a>01056     {
<a name="l01057"></a>01057       regnum = atoi (argv[i]);
<a name="l01058"></a>01058 
<a name="l01059"></a>01059       <span class="keywordflow">if</span> (regnum &gt;= 0
<a name="l01060"></a>01060           &amp;&amp; regnum &lt; numregs
<a name="l01061"></a>01061           &amp;&amp; <a class="code" href="gdbarch_8c.html#a86c0cf41eb88c54e943cd80e79af36e5">gdbarch_register_name</a> (gdbarch, regnum) != NULL
<a name="l01062"></a>01062           &amp;&amp; *<a class="code" href="gdbarch_8c.html#a86c0cf41eb88c54e943cd80e79af36e5">gdbarch_register_name</a> (gdbarch, regnum) != <span class="charliteral">&#39;\000&#39;</span>)
<a name="l01063"></a>01063         {
<a name="l01064"></a>01064           changed = register_changed_p (regnum, prev_regs, this_regs);
<a name="l01065"></a>01065           <span class="keywordflow">if</span> (changed &lt; 0)
<a name="l01066"></a>01066             <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;-data-list-changed-registers: &quot;</span>
<a name="l01067"></a>01067                      <span class="stringliteral">&quot;Unable to read register contents.&quot;</span>));
<a name="l01068"></a>01068           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (changed)
<a name="l01069"></a>01069             <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, NULL, regnum);
<a name="l01070"></a>01070         }
<a name="l01071"></a>01071       <span class="keywordflow">else</span>
<a name="l01072"></a>01072         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;bad register number&quot;</span>));
<a name="l01073"></a>01073     }
<a name="l01074"></a>01074   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup);
<a name="l01075"></a>01075 }
<a name="l01076"></a>01076 
<a name="l01077"></a>01077 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01078"></a>01078 register_changed_p (<span class="keywordtype">int</span> <a class="code" href="aarch64-tdep_8c.html#a6b3d1ad0bca4067ccaef1366bea0db04">regnum</a>, <span class="keyword">struct</span> regcache *prev_regs,
<a name="l01079"></a>01079                     <span class="keyword">struct</span> regcache *this_regs)
<a name="l01080"></a>01080 {
<a name="l01081"></a>01081   <span class="keyword">struct </span>gdbarch *gdbarch = <a class="code" href="regcache_8c.html#ad4f6d0cdf256b1fa45d59a6d71b50659">get_regcache_arch</a> (this_regs);
<a name="l01082"></a>01082   <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> prev_buffer[<a class="code" href="defs_8h.html#a1f9aebf1de3ebbf4283a4dcf73308562a4f3d67bb99ae292178850a8930ab8252">MAX_REGISTER_SIZE</a>];
<a name="l01083"></a>01083   <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> this_buffer[<a class="code" href="defs_8h.html#a1f9aebf1de3ebbf4283a4dcf73308562a4f3d67bb99ae292178850a8930ab8252">MAX_REGISTER_SIZE</a>];
<a name="l01084"></a>01084   <span class="keyword">enum</span> <a class="code" href="regcache_8h.html#af900cc04e1a55ea5ae1edc80570f91f7">register_status</a> prev_status;
<a name="l01085"></a>01085   <span class="keyword">enum</span> <a class="code" href="regcache_8h.html#af900cc04e1a55ea5ae1edc80570f91f7">register_status</a> this_status;
<a name="l01086"></a>01086 
<a name="l01087"></a>01087   <span class="comment">/* First time through or after gdbarch change consider all registers</span>
<a name="l01088"></a>01088 <span class="comment">     as changed.  */</span>
<a name="l01089"></a>01089   <span class="keywordflow">if</span> (!prev_regs || <a class="code" href="regcache_8c.html#ad4f6d0cdf256b1fa45d59a6d71b50659">get_regcache_arch</a> (prev_regs) != gdbarch)
<a name="l01090"></a>01090     <span class="keywordflow">return</span> 1;
<a name="l01091"></a>01091 
<a name="l01092"></a>01092   <span class="comment">/* Get register contents and compare.  */</span>
<a name="l01093"></a>01093   prev_status = <a class="code" href="regcache_8c.html#a7056a5ea585aa0938893952f52d95e2e">regcache_cooked_read</a> (prev_regs, regnum, prev_buffer);
<a name="l01094"></a>01094   this_status = <a class="code" href="regcache_8c.html#a7056a5ea585aa0938893952f52d95e2e">regcache_cooked_read</a> (this_regs, regnum, this_buffer);
<a name="l01095"></a>01095 
<a name="l01096"></a>01096   <span class="keywordflow">if</span> (this_status != prev_status)
<a name="l01097"></a>01097     <span class="keywordflow">return</span> 1;
<a name="l01098"></a>01098   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (this_status == <a class="code" href="regcache_8h.html#af900cc04e1a55ea5ae1edc80570f91f7a0155a2fd1e7e3b53cf1d75cf675d2ea2">REG_VALID</a>)
<a name="l01099"></a>01099     <span class="keywordflow">return</span> <a class="code" href="gdb__string_8h.html#a65c3e6b23d6855c86acaf147853c82cc">memcmp</a> (prev_buffer, this_buffer,
<a name="l01100"></a>01100                    <a class="code" href="regcache_8c.html#a4c51fa25edb9ce25451b9dc7bd127aac">register_size</a> (gdbarch, regnum)) != 0;
<a name="l01101"></a>01101   <span class="keywordflow">else</span>
<a name="l01102"></a>01102     <span class="keywordflow">return</span> 0;
<a name="l01103"></a>01103 }
<a name="l01104"></a>01104 
<a name="l01105"></a>01105 <span class="comment">/* Return a list of register number and value pairs.  The valid</span>
<a name="l01106"></a>01106 <span class="comment">   arguments expected are: a letter indicating the format in which to</span>
<a name="l01107"></a>01107 <span class="comment">   display the registers contents.  This can be one of: x</span>
<a name="l01108"></a>01108 <span class="comment">   (hexadecimal), d (decimal), N (natural), t (binary), o (octal), r</span>
<a name="l01109"></a>01109 <span class="comment">   (raw).  After the format argument there can be a sequence of</span>
<a name="l01110"></a>01110 <span class="comment">   numbers, indicating which registers to fetch the content of.  If</span>
<a name="l01111"></a>01111 <span class="comment">   the format is the only argument, a list of all the registers with</span>
<a name="l01112"></a>01112 <span class="comment">   their values is returned.  */</span>
<a name="l01113"></a>01113 
<a name="l01114"></a>01114 <span class="keywordtype">void</span>
<a name="l01115"></a><a class="code" href="mi-main_8c.html#a6ac90cf2b1a4c66e12743c6bc6d31e96">01115</a> <a class="code" href="mi-cmds_8h.html#af90b852f90eae95b93db38c8ff6b2b55">mi_cmd_data_list_register_values</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l01116"></a>01116 {
<a name="l01117"></a>01117   <span class="keyword">struct </span>ui_out *uiout = <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>;
<a name="l01118"></a>01118   <span class="keyword">struct </span>frame_info *frame;
<a name="l01119"></a>01119   <span class="keyword">struct </span>gdbarch *gdbarch;
<a name="l01120"></a>01120   <span class="keywordtype">int</span> <a class="code" href="aarch64-tdep_8c.html#a6b3d1ad0bca4067ccaef1366bea0db04">regnum</a>, numregs, format;
<a name="l01121"></a>01121   <span class="keywordtype">int</span> i;
<a name="l01122"></a>01122   <span class="keyword">struct </span>cleanup *list_cleanup;
<a name="l01123"></a>01123   <span class="keywordtype">int</span> skip_unavailable = 0;
<a name="l01124"></a>01124   <span class="keywordtype">int</span> oind = 0;
<a name="l01125"></a>01125   <span class="keyword">enum</span> opt
<a name="l01126"></a>01126   {
<a name="l01127"></a>01127     SKIP_UNAVAILABLE,
<a name="l01128"></a>01128   };
<a name="l01129"></a>01129   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structmi__opt.html">mi_opt</a> opts[] =
<a name="l01130"></a>01130     {
<a name="l01131"></a>01131       {<span class="stringliteral">&quot;-skip-unavailable&quot;</span>, SKIP_UNAVAILABLE, 0},
<a name="l01132"></a>01132       { 0, 0, 0 }
<a name="l01133"></a>01133     };
<a name="l01134"></a>01134 
<a name="l01135"></a>01135   <span class="comment">/* Note that the test for a valid register must include checking the</span>
<a name="l01136"></a>01136 <span class="comment">     gdbarch_register_name because gdbarch_num_regs may be allocated</span>
<a name="l01137"></a>01137 <span class="comment">     for the union of the register sets within a family of related</span>
<a name="l01138"></a>01138 <span class="comment">     processors.  In this case, some entries of gdbarch_register_name</span>
<a name="l01139"></a>01139 <span class="comment">     will change depending upon the particular processor being</span>
<a name="l01140"></a>01140 <span class="comment">     debugged.  */</span>
<a name="l01141"></a>01141 
<a name="l01142"></a>01142   <span class="keywordflow">while</span> (1)
<a name="l01143"></a>01143     {
<a name="l01144"></a>01144       <span class="keywordtype">char</span> *oarg;
<a name="l01145"></a>01145       <span class="keywordtype">int</span> opt = <a class="code" href="mi-getopt_8c.html#af7bb1a80abf57e9afae0149d3af20b9c">mi_getopt</a> (<span class="stringliteral">&quot;-data-list-register-values&quot;</span>, argc, argv,
<a name="l01146"></a>01146                            opts, &amp;oind, &amp;oarg);
<a name="l01147"></a>01147 
<a name="l01148"></a>01148       <span class="keywordflow">if</span> (opt &lt; 0)
<a name="l01149"></a>01149         <span class="keywordflow">break</span>;
<a name="l01150"></a>01150       <span class="keywordflow">switch</span> ((<span class="keyword">enum</span> opt) opt)
<a name="l01151"></a>01151         {
<a name="l01152"></a>01152         <span class="keywordflow">case</span> SKIP_UNAVAILABLE:
<a name="l01153"></a>01153           skip_unavailable = 1;
<a name="l01154"></a>01154           <span class="keywordflow">break</span>;
<a name="l01155"></a>01155         }
<a name="l01156"></a>01156     }
<a name="l01157"></a>01157 
<a name="l01158"></a>01158   <span class="keywordflow">if</span> (argc - oind &lt; 1)
<a name="l01159"></a>01159     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;-data-list-register-values: Usage: &quot;</span>
<a name="l01160"></a>01160              <span class="stringliteral">&quot;-data-list-register-values [--skip-unavailable] &lt;format&gt;&quot;</span>
<a name="l01161"></a>01161              <span class="stringliteral">&quot; [&lt;regnum1&gt;...&lt;regnumN&gt;]&quot;</span>));
<a name="l01162"></a>01162 
<a name="l01163"></a>01163   format = (<a class="code" href="command_8h.html#a74f207b5aa4ba51c3a2ad59b219a423b">int</a>) argv[oind][0];
<a name="l01164"></a>01164 
<a name="l01165"></a>01165   frame = <a class="code" href="frame_8c.html#a8b714a78478670e14a297eba8d1a9915">get_selected_frame</a> (NULL);
<a name="l01166"></a>01166   gdbarch = <a class="code" href="frame_8c.html#ab44507b5655da44e522ed5857835ede7">get_frame_arch</a> (frame);
<a name="l01167"></a>01167   numregs = <a class="code" href="gdbarch_8c.html#a69069435754d0b434c7043a21d247325">gdbarch_num_regs</a> (gdbarch) + <a class="code" href="gdbarch_8c.html#a8e0e40f42e5969ee4559ee47717aa9f3">gdbarch_num_pseudo_regs</a> (gdbarch);
<a name="l01168"></a>01168 
<a name="l01169"></a>01169   list_cleanup = <a class="code" href="ui-out_8c.html#aa6e8e9b18ba11e13617a6c56cbfab08f">make_cleanup_ui_out_list_begin_end</a> (uiout, <span class="stringliteral">&quot;register-values&quot;</span>);
<a name="l01170"></a>01170 
<a name="l01171"></a>01171   <span class="keywordflow">if</span> (argc - oind == 1)
<a name="l01172"></a>01172     {
<a name="l01173"></a>01173       <span class="comment">/* No args, beside the format: do all the regs.  */</span>
<a name="l01174"></a>01174       <span class="keywordflow">for</span> (regnum = 0;
<a name="l01175"></a>01175            regnum &lt; numregs;
<a name="l01176"></a>01176            regnum++)
<a name="l01177"></a>01177         {
<a name="l01178"></a>01178           <span class="keywordflow">if</span> (<a class="code" href="gdbarch_8c.html#a86c0cf41eb88c54e943cd80e79af36e5">gdbarch_register_name</a> (gdbarch, regnum) == NULL
<a name="l01179"></a>01179               || *(<a class="code" href="gdbarch_8c.html#a86c0cf41eb88c54e943cd80e79af36e5">gdbarch_register_name</a> (gdbarch, regnum)) == <span class="charliteral">&#39;\0&#39;</span>)
<a name="l01180"></a>01180             <span class="keywordflow">continue</span>;
<a name="l01181"></a>01181 
<a name="l01182"></a>01182           output_register (frame, regnum, format, skip_unavailable);
<a name="l01183"></a>01183         }
<a name="l01184"></a>01184     }
<a name="l01185"></a>01185 
<a name="l01186"></a>01186   <span class="comment">/* Else, list of register #s, just do listed regs.  */</span>
<a name="l01187"></a>01187   <span class="keywordflow">for</span> (i = 1 + oind; i &lt; argc; i++)
<a name="l01188"></a>01188     {
<a name="l01189"></a>01189       regnum = atoi (argv[i]);
<a name="l01190"></a>01190 
<a name="l01191"></a>01191       <span class="keywordflow">if</span> (regnum &gt;= 0
<a name="l01192"></a>01192           &amp;&amp; regnum &lt; numregs
<a name="l01193"></a>01193           &amp;&amp; <a class="code" href="gdbarch_8c.html#a86c0cf41eb88c54e943cd80e79af36e5">gdbarch_register_name</a> (gdbarch, regnum) != NULL
<a name="l01194"></a>01194           &amp;&amp; *<a class="code" href="gdbarch_8c.html#a86c0cf41eb88c54e943cd80e79af36e5">gdbarch_register_name</a> (gdbarch, regnum) != <span class="charliteral">&#39;\000&#39;</span>)
<a name="l01195"></a>01195         output_register (frame, regnum, format, skip_unavailable);
<a name="l01196"></a>01196       <span class="keywordflow">else</span>
<a name="l01197"></a>01197         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;bad register number&quot;</span>));
<a name="l01198"></a>01198     }
<a name="l01199"></a>01199   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (list_cleanup);
<a name="l01200"></a>01200 }
<a name="l01201"></a>01201 
<a name="l01202"></a>01202 <span class="comment">/* Output one register REGNUM&#39;s contents in the desired FORMAT.  If</span>
<a name="l01203"></a>01203 <span class="comment">   SKIP_UNAVAILABLE is true, skip the register if it is</span>
<a name="l01204"></a>01204 <span class="comment">   unavailable.  */</span>
<a name="l01205"></a>01205 
<a name="l01206"></a>01206 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01207"></a>01207 output_register (<span class="keyword">struct</span> frame_info *frame, <span class="keywordtype">int</span> regnum, <span class="keywordtype">int</span> format,
<a name="l01208"></a>01208                  <span class="keywordtype">int</span> skip_unavailable)
<a name="l01209"></a>01209 {
<a name="l01210"></a>01210   <span class="keyword">struct </span>gdbarch *gdbarch = <a class="code" href="frame_8c.html#ab44507b5655da44e522ed5857835ede7">get_frame_arch</a> (frame);
<a name="l01211"></a>01211   <span class="keyword">struct </span>ui_out *uiout = <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>;
<a name="l01212"></a>01212   <span class="keyword">struct </span>value *val = <a class="code" href="findvar_8c.html#a4ed0b2d0013e393d2391ff10de16ab52">value_of_register</a> (regnum, frame);
<a name="l01213"></a>01213   <span class="keyword">struct </span>cleanup *tuple_cleanup;
<a name="l01214"></a>01214   <span class="keyword">struct </span><a class="code" href="structvalue__print__options.html">value_print_options</a> opts;
<a name="l01215"></a>01215   <span class="keyword">struct </span>ui_file *stb;
<a name="l01216"></a>01216 
<a name="l01217"></a>01217   <span class="keywordflow">if</span> (skip_unavailable &amp;&amp; !<a class="code" href="value_8c.html#a19cd59597b84c6184cce31525906a318">value_entirely_available</a> (val))
<a name="l01218"></a>01218     <span class="keywordflow">return</span>;
<a name="l01219"></a>01219 
<a name="l01220"></a>01220   tuple_cleanup = <a class="code" href="ui-out_8c.html#aaf5a0c991d74ad2e486f420d5c2ff058">make_cleanup_ui_out_tuple_begin_end</a> (uiout, NULL);
<a name="l01221"></a>01221   <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, <span class="stringliteral">&quot;number&quot;</span>, regnum);
<a name="l01222"></a>01222 
<a name="l01223"></a>01223   <span class="keywordflow">if</span> (format == <span class="charliteral">&#39;N&#39;</span>)
<a name="l01224"></a>01224     format = 0;
<a name="l01225"></a>01225 
<a name="l01226"></a>01226   <span class="keywordflow">if</span> (format == <span class="charliteral">&#39;r&#39;</span>)
<a name="l01227"></a>01227     format = <span class="charliteral">&#39;z&#39;</span>;
<a name="l01228"></a>01228 
<a name="l01229"></a>01229   stb = <a class="code" href="ui-file_8c.html#a340771735f105582d314e191a399a45c">mem_fileopen</a> ();
<a name="l01230"></a>01230   <a class="code" href="utils_8c.html#a94dc56baeb57791e114136764f7763aa">make_cleanup_ui_file_delete</a> (stb);
<a name="l01231"></a>01231 
<a name="l01232"></a>01232   <a class="code" href="valprint_8c.html#a1177f66ae5a60db2a75604f268dba57f">get_formatted_print_options</a> (&amp;opts, format);
<a name="l01233"></a>01233   opts.deref_ref = 1;
<a name="l01234"></a>01234   <a class="code" href="valprint_8c.html#aaa35f37b88a48db0487978850847a913">val_print</a> (<a class="code" href="value_8c.html#a263a4c0bee0b0df41074b952d3c121d0">value_type</a> (val),
<a name="l01235"></a>01235              <a class="code" href="value_8c.html#a77fb759fae03d1a1c2a4e1500aa13adb">value_contents_for_printing</a> (val),
<a name="l01236"></a>01236              <a class="code" href="value_8c.html#acbd6146ab9bd4c54f994a895a66f3f3d">value_embedded_offset</a> (val), 0,
<a name="l01237"></a>01237              stb, 0, val, &amp;opts, <a class="code" href="language_8c.html#acd2505a014a95629da9c836f8914fc79">current_language</a>);
<a name="l01238"></a>01238   <a class="code" href="ui-out_8c.html#a40106bb0446639417c75a408194a8eee">ui_out_field_stream</a> (uiout, <span class="stringliteral">&quot;value&quot;</span>, stb);
<a name="l01239"></a>01239 
<a name="l01240"></a>01240   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (tuple_cleanup);
<a name="l01241"></a>01241 }
<a name="l01242"></a>01242 
<a name="l01243"></a>01243 <span class="comment">/* Write given values into registers. The registers and values are</span>
<a name="l01244"></a>01244 <span class="comment">   given as pairs.  The corresponding MI command is </span>
<a name="l01245"></a>01245 <span class="comment">   -data-write-register-values &lt;format&gt;</span>
<a name="l01246"></a>01246 <span class="comment">                               [&lt;regnum1&gt; &lt;value1&gt;...&lt;regnumN&gt; &lt;valueN&gt;] */</span>
<a name="l01247"></a>01247 <span class="keywordtype">void</span>
<a name="l01248"></a><a class="code" href="mi-main_8c.html#a3bba9ad1d1488462198cb12b7df10a80">01248</a> <a class="code" href="mi-cmds_8h.html#aa959b337331a7af5d88cc8b7bfd41c61">mi_cmd_data_write_register_values</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l01249"></a>01249 {
<a name="l01250"></a>01250   <span class="keyword">struct </span>regcache *regcache;
<a name="l01251"></a>01251   <span class="keyword">struct </span>gdbarch *gdbarch;
<a name="l01252"></a>01252   <span class="keywordtype">int</span> numregs, i;
<a name="l01253"></a>01253 
<a name="l01254"></a>01254   <span class="comment">/* Note that the test for a valid register must include checking the</span>
<a name="l01255"></a>01255 <span class="comment">     gdbarch_register_name because gdbarch_num_regs may be allocated</span>
<a name="l01256"></a>01256 <span class="comment">     for the union of the register sets within a family of related</span>
<a name="l01257"></a>01257 <span class="comment">     processors.  In this case, some entries of gdbarch_register_name</span>
<a name="l01258"></a>01258 <span class="comment">     will change depending upon the particular processor being</span>
<a name="l01259"></a>01259 <span class="comment">     debugged.  */</span>
<a name="l01260"></a>01260 
<a name="l01261"></a>01261   regcache = <a class="code" href="regcache_8c.html#a09a386286dc22d882378f639630fecef">get_current_regcache</a> ();
<a name="l01262"></a>01262   gdbarch = <a class="code" href="regcache_8c.html#ad4f6d0cdf256b1fa45d59a6d71b50659">get_regcache_arch</a> (regcache);
<a name="l01263"></a>01263   numregs = <a class="code" href="gdbarch_8c.html#a69069435754d0b434c7043a21d247325">gdbarch_num_regs</a> (gdbarch) + <a class="code" href="gdbarch_8c.html#a8e0e40f42e5969ee4559ee47717aa9f3">gdbarch_num_pseudo_regs</a> (gdbarch);
<a name="l01264"></a>01264 
<a name="l01265"></a>01265   <span class="keywordflow">if</span> (argc == 0)
<a name="l01266"></a>01266     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;-data-write-register-values: Usage: -data-write-register-&quot;</span>
<a name="l01267"></a>01267              <span class="stringliteral">&quot;values &lt;format&gt; [&lt;regnum1&gt; &lt;value1&gt;...&lt;regnumN&gt; &lt;valueN&gt;]&quot;</span>));
<a name="l01268"></a>01268 
<a name="l01269"></a>01269   <span class="keywordflow">if</span> (!<a class="code" href="target_8h.html#aa9a1009541e63ce36c030b1bd55d292d">target_has_registers</a>)
<a name="l01270"></a>01270     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;-data-write-register-values: No registers.&quot;</span>));
<a name="l01271"></a>01271 
<a name="l01272"></a>01272   <span class="keywordflow">if</span> (!(argc - 1))
<a name="l01273"></a>01273     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;-data-write-register-values: No regs and values specified.&quot;</span>));
<a name="l01274"></a>01274 
<a name="l01275"></a>01275   <span class="keywordflow">if</span> ((argc - 1) % 2)
<a name="l01276"></a>01276     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;-data-write-register-values: &quot;</span>
<a name="l01277"></a>01277              <span class="stringliteral">&quot;Regs and vals are not in pairs.&quot;</span>));
<a name="l01278"></a>01278 
<a name="l01279"></a>01279   <span class="keywordflow">for</span> (i = 1; i &lt; argc; i = i + 2)
<a name="l01280"></a>01280     {
<a name="l01281"></a>01281       <span class="keywordtype">int</span> regnum = atoi (argv[i]);
<a name="l01282"></a>01282 
<a name="l01283"></a>01283       <span class="keywordflow">if</span> (regnum &gt;= 0 &amp;&amp; regnum &lt; numregs
<a name="l01284"></a>01284           &amp;&amp; <a class="code" href="gdbarch_8c.html#a86c0cf41eb88c54e943cd80e79af36e5">gdbarch_register_name</a> (gdbarch, regnum)
<a name="l01285"></a>01285           &amp;&amp; *<a class="code" href="gdbarch_8c.html#a86c0cf41eb88c54e943cd80e79af36e5">gdbarch_register_name</a> (gdbarch, regnum))
<a name="l01286"></a>01286         {
<a name="l01287"></a>01287           <a class="code" href="defs_8h.html#ac7647a3f71533007c9e128f3ddda1987">LONGEST</a> value;
<a name="l01288"></a>01288 
<a name="l01289"></a>01289           <span class="comment">/* Get the value as a number.  */</span>
<a name="l01290"></a>01290           value = <a class="code" href="eval_8c.html#adc1b596b06e274a83197cdeaa0c2809c">parse_and_eval_address</a> (argv[i + 1]);
<a name="l01291"></a>01291 
<a name="l01292"></a>01292           <span class="comment">/* Write it down.  */</span>
<a name="l01293"></a>01293           <a class="code" href="regcache_8c.html#a81b7aed5cdcbde3896b0522e932d251a">regcache_cooked_write_signed</a> (regcache, regnum, value);
<a name="l01294"></a>01294         }
<a name="l01295"></a>01295       <span class="keywordflow">else</span>
<a name="l01296"></a>01296         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;bad register number&quot;</span>));
<a name="l01297"></a>01297     }
<a name="l01298"></a>01298 }
<a name="l01299"></a>01299 
<a name="l01300"></a>01300 <span class="comment">/* Evaluate the value of the argument.  The argument is an</span>
<a name="l01301"></a>01301 <span class="comment">   expression. If the expression contains spaces it needs to be</span>
<a name="l01302"></a>01302 <span class="comment">   included in double quotes.  */</span>
<a name="l01303"></a>01303 
<a name="l01304"></a>01304 <span class="keywordtype">void</span>
<a name="l01305"></a><a class="code" href="mi-main_8c.html#a0b3dc8062b7d6d3c15e4390e3e957316">01305</a> <a class="code" href="mi-cmds_8h.html#a6c673872af63c271b25d3047703d6196">mi_cmd_data_evaluate_expression</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l01306"></a>01306 {
<a name="l01307"></a>01307   <span class="keyword">struct </span><a class="code" href="structexpression.html">expression</a> *expr;
<a name="l01308"></a>01308   <span class="keyword">struct </span>cleanup *old_chain;
<a name="l01309"></a>01309   <span class="keyword">struct </span>value *val;
<a name="l01310"></a>01310   <span class="keyword">struct </span>ui_file *stb;
<a name="l01311"></a>01311   <span class="keyword">struct </span><a class="code" href="structvalue__print__options.html">value_print_options</a> opts;
<a name="l01312"></a>01312   <span class="keyword">struct </span>ui_out *uiout = <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>;
<a name="l01313"></a>01313 
<a name="l01314"></a>01314   stb = <a class="code" href="ui-file_8c.html#a340771735f105582d314e191a399a45c">mem_fileopen</a> ();
<a name="l01315"></a>01315   old_chain = <a class="code" href="utils_8c.html#a94dc56baeb57791e114136764f7763aa">make_cleanup_ui_file_delete</a> (stb);
<a name="l01316"></a>01316 
<a name="l01317"></a>01317   <span class="keywordflow">if</span> (argc != 1)
<a name="l01318"></a>01318     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;-data-evaluate-expression: &quot;</span>
<a name="l01319"></a>01319              <span class="stringliteral">&quot;Usage: -data-evaluate-expression expression&quot;</span>));
<a name="l01320"></a>01320 
<a name="l01321"></a>01321   expr = <a class="code" href="expression_8h.html#a286599225dbfecf78c83d1eb5261f25a">parse_expression</a> (argv[0]);
<a name="l01322"></a>01322 
<a name="l01323"></a>01323   <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="utils_8c.html#a6d8c21606d3f67a431a7bfbb1f47d12e">free_current_contents</a>, &amp;expr);
<a name="l01324"></a>01324 
<a name="l01325"></a>01325   val = <a class="code" href="eval_8c.html#ab50151ccba3ea3184c114121d6bed422">evaluate_expression</a> (expr);
<a name="l01326"></a>01326 
<a name="l01327"></a>01327   <span class="comment">/* Print the result of the expression evaluation.  */</span>
<a name="l01328"></a>01328   <a class="code" href="valprint_8c.html#aa2d4dfe4b11841ccafc4d0c0d410095d">get_user_print_options</a> (&amp;opts);
<a name="l01329"></a>01329   opts.<a class="code" href="structvalue__print__options.html#a60ebf7f26982bd56f13befa7ef7cc686">deref_ref</a> = 0;
<a name="l01330"></a>01330   <a class="code" href="valprint_8c.html#a3b8220f1b9270a2f8b8f4e197f2be9db">common_val_print</a> (val, stb, 0, &amp;opts, <a class="code" href="language_8c.html#acd2505a014a95629da9c836f8914fc79">current_language</a>);
<a name="l01331"></a>01331 
<a name="l01332"></a>01332   <a class="code" href="ui-out_8c.html#a40106bb0446639417c75a408194a8eee">ui_out_field_stream</a> (uiout, <span class="stringliteral">&quot;value&quot;</span>, stb);
<a name="l01333"></a>01333 
<a name="l01334"></a>01334   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l01335"></a>01335 }
<a name="l01336"></a>01336 
<a name="l01337"></a>01337 <span class="comment">/* This is the -data-read-memory command.</span>
<a name="l01338"></a>01338 <span class="comment"></span>
<a name="l01339"></a>01339 <span class="comment">   ADDR: start address of data to be dumped.</span>
<a name="l01340"></a>01340 <span class="comment">   WORD-FORMAT: a char indicating format for the ``word&#39;&#39;.  See </span>
<a name="l01341"></a>01341 <span class="comment">   the ``x&#39;&#39; command.</span>
<a name="l01342"></a>01342 <span class="comment">   WORD-SIZE: size of each ``word&#39;&#39;; 1,2,4, or 8 bytes.</span>
<a name="l01343"></a>01343 <span class="comment">   NR_ROW: Number of rows.</span>
<a name="l01344"></a>01344 <span class="comment">   NR_COL: The number of colums (words per row).</span>
<a name="l01345"></a>01345 <span class="comment">   ASCHAR: (OPTIONAL) Append an ascii character dump to each row.  Use</span>
<a name="l01346"></a>01346 <span class="comment">   ASCHAR for unprintable characters.</span>
<a name="l01347"></a>01347 <span class="comment"></span>
<a name="l01348"></a>01348 <span class="comment">   Reads SIZE*NR_ROW*NR_COL bytes starting at ADDR from memory and</span>
<a name="l01349"></a>01349 <span class="comment">   displayes them.  Returns:</span>
<a name="l01350"></a>01350 <span class="comment"></span>
<a name="l01351"></a>01351 <span class="comment">   {addr=&quot;...&quot;,rowN={wordN=&quot;...&quot; ,... [,ascii=&quot;...&quot;]}, ...}</span>
<a name="l01352"></a>01352 <span class="comment"></span>
<a name="l01353"></a>01353 <span class="comment">   Returns: </span>
<a name="l01354"></a>01354 <span class="comment">   The number of bytes read is SIZE*ROW*COL.  */</span>
<a name="l01355"></a>01355 
<a name="l01356"></a>01356 <span class="keywordtype">void</span>
<a name="l01357"></a><a class="code" href="mi-main_8c.html#a117e0a4c64e26dc7d61144cbada13976">01357</a> <a class="code" href="mi-cmds_8h.html#a722f65caea8a7d4f9ad9e595460dd79c">mi_cmd_data_read_memory</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l01358"></a>01358 {
<a name="l01359"></a>01359   <span class="keyword">struct </span>gdbarch *gdbarch = <a class="code" href="arch-utils_8c.html#a0fe1e68475f442e5d6dda589e0c62454">get_current_arch</a> ();
<a name="l01360"></a>01360   <span class="keyword">struct </span>ui_out *uiout = <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>;
<a name="l01361"></a>01361   <span class="keyword">struct </span>cleanup *cleanups = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="cleanups_8c.html#a1ec2a3980c2be1f31f2142103d1f7abf">null_cleanup</a>, NULL);
<a name="l01362"></a>01362   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> addr;
<a name="l01363"></a>01363   <span class="keywordtype">long</span> total_bytes, nr_cols, nr_rows;
<a name="l01364"></a>01364   <span class="keywordtype">char</span> word_format;
<a name="l01365"></a>01365   <span class="keyword">struct </span><a class="code" href="structtype.html">type</a> *word_type;
<a name="l01366"></a>01366   <span class="keywordtype">long</span> word_size;
<a name="l01367"></a>01367   <span class="keywordtype">char</span> word_asize;
<a name="l01368"></a>01368   <span class="keywordtype">char</span> aschar;
<a name="l01369"></a>01369   <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *mbuf;
<a name="l01370"></a>01370   <span class="keywordtype">int</span> nr_bytes;
<a name="l01371"></a>01371   <span class="keywordtype">long</span> <a class="code" href="common_2agent_8c.html#aed7ea92f45bd273dde380a45ddced592">offset</a> = 0;
<a name="l01372"></a>01372   <span class="keywordtype">int</span> oind = 0;
<a name="l01373"></a>01373   <span class="keywordtype">char</span> *oarg;
<a name="l01374"></a>01374   <span class="keyword">enum</span> opt
<a name="l01375"></a>01375   {
<a name="l01376"></a>01376     OFFSET_OPT
<a name="l01377"></a>01377   };
<a name="l01378"></a>01378   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structmi__opt.html">mi_opt</a> opts[] =
<a name="l01379"></a>01379     {
<a name="l01380"></a>01380       {<span class="stringliteral">&quot;o&quot;</span>, OFFSET_OPT, 1},
<a name="l01381"></a>01381       { 0, 0, 0 }
<a name="l01382"></a>01382     };
<a name="l01383"></a>01383 
<a name="l01384"></a>01384   <span class="keywordflow">while</span> (1)
<a name="l01385"></a>01385     {
<a name="l01386"></a>01386       <span class="keywordtype">int</span> opt = <a class="code" href="mi-getopt_8c.html#af7bb1a80abf57e9afae0149d3af20b9c">mi_getopt</a> (<span class="stringliteral">&quot;-data-read-memory&quot;</span>, argc, argv, opts,
<a name="l01387"></a>01387                            &amp;oind, &amp;oarg);
<a name="l01388"></a>01388 
<a name="l01389"></a>01389       <span class="keywordflow">if</span> (opt &lt; 0)
<a name="l01390"></a>01390         <span class="keywordflow">break</span>;
<a name="l01391"></a>01391       <span class="keywordflow">switch</span> ((<span class="keyword">enum</span> opt) opt)
<a name="l01392"></a>01392         {
<a name="l01393"></a>01393         <span class="keywordflow">case</span> OFFSET_OPT:
<a name="l01394"></a>01394           offset = atol (oarg);
<a name="l01395"></a>01395           <span class="keywordflow">break</span>;
<a name="l01396"></a>01396         }
<a name="l01397"></a>01397     }
<a name="l01398"></a>01398   argv += oind;
<a name="l01399"></a>01399   argc -= oind;
<a name="l01400"></a>01400 
<a name="l01401"></a>01401   <span class="keywordflow">if</span> (argc &lt; 5 || argc &gt; 6)
<a name="l01402"></a>01402     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;-data-read-memory: Usage: &quot;</span>
<a name="l01403"></a>01403              <span class="stringliteral">&quot;ADDR WORD-FORMAT WORD-SIZE NR-ROWS NR-COLS [ASCHAR].&quot;</span>));
<a name="l01404"></a>01404 
<a name="l01405"></a>01405   <span class="comment">/* Extract all the arguments. */</span>
<a name="l01406"></a>01406 
<a name="l01407"></a>01407   <span class="comment">/* Start address of the memory dump.  */</span>
<a name="l01408"></a>01408   addr = <a class="code" href="eval_8c.html#adc1b596b06e274a83197cdeaa0c2809c">parse_and_eval_address</a> (argv[0]) + <a class="code" href="common_2agent_8c.html#aed7ea92f45bd273dde380a45ddced592">offset</a>;
<a name="l01409"></a>01409   <span class="comment">/* The format character to use when displaying a memory word.  See</span>
<a name="l01410"></a>01410 <span class="comment">     the ``x&#39;&#39; command.  */</span>
<a name="l01411"></a>01411   word_format = argv[1][0];
<a name="l01412"></a>01412   <span class="comment">/* The size of the memory word.  */</span>
<a name="l01413"></a>01413   word_size = atol (argv[2]);
<a name="l01414"></a>01414   <span class="keywordflow">switch</span> (word_size)
<a name="l01415"></a>01415     {
<a name="l01416"></a>01416     <span class="keywordflow">case</span> 1:
<a name="l01417"></a>01417       word_type = <a class="code" href="gdbtypes_8c.html#addd01ebc9ccdf2cacb33ab01e281ddb8">builtin_type</a> (gdbarch)-&gt;<a class="code" href="structbuiltin__type.html#a3bda6904e80e6a0de09549a1b51fb088">builtin_int8</a>;
<a name="l01418"></a>01418       word_asize = <span class="charliteral">&#39;b&#39;</span>;
<a name="l01419"></a>01419       <span class="keywordflow">break</span>;
<a name="l01420"></a>01420     <span class="keywordflow">case</span> 2:
<a name="l01421"></a>01421       word_type = <a class="code" href="gdbtypes_8c.html#addd01ebc9ccdf2cacb33ab01e281ddb8">builtin_type</a> (gdbarch)-&gt;<a class="code" href="structbuiltin__type.html#adfd7e6377d8b18a3a019bdc9a7eff0b8">builtin_int16</a>;
<a name="l01422"></a>01422       word_asize = <span class="charliteral">&#39;h&#39;</span>;
<a name="l01423"></a>01423       <span class="keywordflow">break</span>;
<a name="l01424"></a>01424     <span class="keywordflow">case</span> 4:
<a name="l01425"></a>01425       word_type = <a class="code" href="gdbtypes_8c.html#addd01ebc9ccdf2cacb33ab01e281ddb8">builtin_type</a> (gdbarch)-&gt;<a class="code" href="structbuiltin__type.html#ab514809bc3e50d6db51f7b1b0729f2cb">builtin_int32</a>;
<a name="l01426"></a>01426       word_asize = <span class="charliteral">&#39;w&#39;</span>;
<a name="l01427"></a>01427       <span class="keywordflow">break</span>;
<a name="l01428"></a>01428     <span class="keywordflow">case</span> 8:
<a name="l01429"></a>01429       word_type = <a class="code" href="gdbtypes_8c.html#addd01ebc9ccdf2cacb33ab01e281ddb8">builtin_type</a> (gdbarch)-&gt;<a class="code" href="structbuiltin__type.html#a96f3cd71c9619fa5a5ae644402e841ec">builtin_int64</a>;
<a name="l01430"></a>01430       word_asize = <span class="charliteral">&#39;g&#39;</span>;
<a name="l01431"></a>01431       <span class="keywordflow">break</span>;
<a name="l01432"></a>01432     <span class="keywordflow">default</span>:
<a name="l01433"></a>01433       word_type = <a class="code" href="gdbtypes_8c.html#addd01ebc9ccdf2cacb33ab01e281ddb8">builtin_type</a> (gdbarch)-&gt;<a class="code" href="structbuiltin__type.html#a3bda6904e80e6a0de09549a1b51fb088">builtin_int8</a>;
<a name="l01434"></a>01434       word_asize = <span class="charliteral">&#39;b&#39;</span>;
<a name="l01435"></a>01435     }
<a name="l01436"></a>01436   <span class="comment">/* The number of rows.  */</span>
<a name="l01437"></a>01437   nr_rows = atol (argv[3]);
<a name="l01438"></a>01438   <span class="keywordflow">if</span> (nr_rows &lt;= 0)
<a name="l01439"></a>01439     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;-data-read-memory: invalid number of rows.&quot;</span>));
<a name="l01440"></a>01440 
<a name="l01441"></a>01441   <span class="comment">/* Number of bytes per row.  */</span>
<a name="l01442"></a>01442   nr_cols = atol (argv[4]);
<a name="l01443"></a>01443   <span class="keywordflow">if</span> (nr_cols &lt;= 0)
<a name="l01444"></a>01444     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;-data-read-memory: invalid number of columns.&quot;</span>));
<a name="l01445"></a>01445 
<a name="l01446"></a>01446   <span class="comment">/* The un-printable character when printing ascii.  */</span>
<a name="l01447"></a>01447   <span class="keywordflow">if</span> (argc == 6)
<a name="l01448"></a>01448     aschar = *argv[5];
<a name="l01449"></a>01449   <span class="keywordflow">else</span>
<a name="l01450"></a>01450     aschar = 0;
<a name="l01451"></a>01451 
<a name="l01452"></a>01452   <span class="comment">/* Create a buffer and read it in.  */</span>
<a name="l01453"></a>01453   total_bytes = word_size * nr_rows * nr_cols;
<a name="l01454"></a>01454   mbuf = <a class="code" href="common-utils_8c.html#a05a0a3435b91a07d6cc1a0b4c8788a4d">xcalloc</a> (total_bytes, 1);
<a name="l01455"></a>01455   <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, mbuf);
<a name="l01456"></a>01456 
<a name="l01457"></a>01457   <span class="comment">/* Dispatch memory reads to the topmost target, not the flattened</span>
<a name="l01458"></a>01458 <span class="comment">     current_target.  */</span>
<a name="l01459"></a>01459   nr_bytes = <a class="code" href="target_8c.html#aac7df8f3a1d061c97c45219ed0cace6c">target_read</a> (<a class="code" href="target_8h.html#a2d8640b030266b58d3821eb5cfd112b9">current_target</a>.<a class="code" href="structtarget__ops.html#a1b180ccb4db2afccf46e691862bf2ddf">beneath</a>,
<a name="l01460"></a>01460                           <a class="code" href="target_8h.html#aa5a3e4ceb377c9f5822cdc68c6f138e2a8d0adeab7f35c7245692a63b5a2a9f3a">TARGET_OBJECT_MEMORY</a>, NULL, mbuf,
<a name="l01461"></a>01461                           addr, total_bytes);
<a name="l01462"></a>01462   <span class="keywordflow">if</span> (nr_bytes &lt;= 0)
<a name="l01463"></a>01463     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Unable to read memory.&quot;</span>));
<a name="l01464"></a>01464 
<a name="l01465"></a>01465   <span class="comment">/* Output the header information.  */</span>
<a name="l01466"></a>01466   <a class="code" href="ui-out_8c.html#ada85ed653fecf3c2a80027de6f71ef71">ui_out_field_core_addr</a> (uiout, <span class="stringliteral">&quot;addr&quot;</span>, gdbarch, addr);
<a name="l01467"></a>01467   <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, <span class="stringliteral">&quot;nr-bytes&quot;</span>, nr_bytes);
<a name="l01468"></a>01468   <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, <span class="stringliteral">&quot;total-bytes&quot;</span>, total_bytes);
<a name="l01469"></a>01469   <a class="code" href="ui-out_8c.html#ada85ed653fecf3c2a80027de6f71ef71">ui_out_field_core_addr</a> (uiout, <span class="stringliteral">&quot;next-row&quot;</span>,
<a name="l01470"></a>01470                           gdbarch, addr + word_size * nr_cols);
<a name="l01471"></a>01471   <a class="code" href="ui-out_8c.html#ada85ed653fecf3c2a80027de6f71ef71">ui_out_field_core_addr</a> (uiout, <span class="stringliteral">&quot;prev-row&quot;</span>,
<a name="l01472"></a>01472                           gdbarch, addr - word_size * nr_cols);
<a name="l01473"></a>01473   <a class="code" href="ui-out_8c.html#ada85ed653fecf3c2a80027de6f71ef71">ui_out_field_core_addr</a> (uiout, <span class="stringliteral">&quot;next-page&quot;</span>, gdbarch, addr + total_bytes);
<a name="l01474"></a>01474   <a class="code" href="ui-out_8c.html#ada85ed653fecf3c2a80027de6f71ef71">ui_out_field_core_addr</a> (uiout, <span class="stringliteral">&quot;prev-page&quot;</span>, gdbarch, addr - total_bytes);
<a name="l01475"></a>01475 
<a name="l01476"></a>01476   <span class="comment">/* Build the result as a two dimentional table.  */</span>
<a name="l01477"></a>01477   {
<a name="l01478"></a>01478     <span class="keyword">struct </span>ui_file *stream;
<a name="l01479"></a>01479     <span class="keyword">struct </span>cleanup *cleanup_stream;
<a name="l01480"></a>01480     <span class="keywordtype">int</span> row;
<a name="l01481"></a>01481     <span class="keywordtype">int</span> row_byte;
<a name="l01482"></a>01482 
<a name="l01483"></a>01483     stream = <a class="code" href="ui-file_8c.html#a340771735f105582d314e191a399a45c">mem_fileopen</a> ();
<a name="l01484"></a>01484     cleanup_stream = <a class="code" href="utils_8c.html#a94dc56baeb57791e114136764f7763aa">make_cleanup_ui_file_delete</a> (stream);
<a name="l01485"></a>01485 
<a name="l01486"></a>01486     <a class="code" href="ui-out_8c.html#aa6e8e9b18ba11e13617a6c56cbfab08f">make_cleanup_ui_out_list_begin_end</a> (uiout, <span class="stringliteral">&quot;memory&quot;</span>);
<a name="l01487"></a>01487     <span class="keywordflow">for</span> (row = 0, row_byte = 0;
<a name="l01488"></a>01488          row &lt; nr_rows;
<a name="l01489"></a>01489          row++, row_byte += nr_cols * word_size)
<a name="l01490"></a>01490       {
<a name="l01491"></a>01491         <span class="keywordtype">int</span> col;
<a name="l01492"></a>01492         <span class="keywordtype">int</span> col_byte;
<a name="l01493"></a>01493         <span class="keyword">struct </span>cleanup *cleanup_tuple;
<a name="l01494"></a>01494         <span class="keyword">struct </span>cleanup *cleanup_list_data;
<a name="l01495"></a>01495         <span class="keyword">struct </span><a class="code" href="structvalue__print__options.html">value_print_options</a> opts;
<a name="l01496"></a>01496 
<a name="l01497"></a>01497         cleanup_tuple = <a class="code" href="ui-out_8c.html#aaf5a0c991d74ad2e486f420d5c2ff058">make_cleanup_ui_out_tuple_begin_end</a> (uiout, NULL);
<a name="l01498"></a>01498         <a class="code" href="ui-out_8c.html#ada85ed653fecf3c2a80027de6f71ef71">ui_out_field_core_addr</a> (uiout, <span class="stringliteral">&quot;addr&quot;</span>, gdbarch, addr + row_byte);
<a name="l01499"></a>01499         <span class="comment">/* ui_out_field_core_addr_symbolic (uiout, &quot;saddr&quot;, addr +</span>
<a name="l01500"></a>01500 <span class="comment">           row_byte); */</span>
<a name="l01501"></a>01501         cleanup_list_data = <a class="code" href="ui-out_8c.html#aa6e8e9b18ba11e13617a6c56cbfab08f">make_cleanup_ui_out_list_begin_end</a> (uiout, <span class="stringliteral">&quot;data&quot;</span>);
<a name="l01502"></a>01502         <a class="code" href="valprint_8c.html#a1177f66ae5a60db2a75604f268dba57f">get_formatted_print_options</a> (&amp;opts, word_format);
<a name="l01503"></a>01503         <span class="keywordflow">for</span> (col = 0, col_byte = row_byte;
<a name="l01504"></a>01504              col &lt; nr_cols;
<a name="l01505"></a>01505              col++, col_byte += word_size)
<a name="l01506"></a>01506           {
<a name="l01507"></a>01507             <span class="keywordflow">if</span> (col_byte + word_size &gt; nr_bytes)
<a name="l01508"></a>01508               {
<a name="l01509"></a>01509                 <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, NULL, <span class="stringliteral">&quot;N/A&quot;</span>);
<a name="l01510"></a>01510               }
<a name="l01511"></a>01511             <span class="keywordflow">else</span>
<a name="l01512"></a>01512               {
<a name="l01513"></a>01513                 <a class="code" href="ui-file_8c.html#a6fb0cfd369b36cf6237439e80cf3d60c">ui_file_rewind</a> (stream);
<a name="l01514"></a>01514                 <a class="code" href="gdbtypes_8h.html#a7b01a75e18ea7083fc6abaebc996f70e">print_scalar_formatted</a> (mbuf + col_byte, word_type, &amp;opts,
<a name="l01515"></a>01515                                         word_asize, stream);
<a name="l01516"></a>01516                 <a class="code" href="ui-out_8c.html#a40106bb0446639417c75a408194a8eee">ui_out_field_stream</a> (uiout, NULL, stream);
<a name="l01517"></a>01517               }
<a name="l01518"></a>01518           }
<a name="l01519"></a>01519         <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup_list_data);
<a name="l01520"></a>01520         <span class="keywordflow">if</span> (aschar)
<a name="l01521"></a>01521           {
<a name="l01522"></a>01522             <span class="keywordtype">int</span> byte;
<a name="l01523"></a>01523 
<a name="l01524"></a>01524             <a class="code" href="ui-file_8c.html#a6fb0cfd369b36cf6237439e80cf3d60c">ui_file_rewind</a> (stream);
<a name="l01525"></a>01525             <span class="keywordflow">for</span> (byte = row_byte;
<a name="l01526"></a>01526                  byte &lt; row_byte + word_size * nr_cols; byte++)
<a name="l01527"></a>01527               {
<a name="l01528"></a>01528                 <span class="keywordflow">if</span> (byte &gt;= nr_bytes)
<a name="l01529"></a>01529                   <a class="code" href="utils_8c.html#ad68fe4a88bf7dc2738de79643ce8f927">fputc_unfiltered</a> (<span class="charliteral">&#39;X&#39;</span>, stream);
<a name="l01530"></a>01530                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mbuf[byte] &lt; 32 || mbuf[byte] &gt; 126)
<a name="l01531"></a>01531                   <a class="code" href="utils_8c.html#ad68fe4a88bf7dc2738de79643ce8f927">fputc_unfiltered</a> (aschar, stream);
<a name="l01532"></a>01532                 <span class="keywordflow">else</span>
<a name="l01533"></a>01533                   <a class="code" href="utils_8c.html#ad68fe4a88bf7dc2738de79643ce8f927">fputc_unfiltered</a> (mbuf[byte], stream);
<a name="l01534"></a>01534               }
<a name="l01535"></a>01535             <a class="code" href="ui-out_8c.html#a40106bb0446639417c75a408194a8eee">ui_out_field_stream</a> (uiout, <span class="stringliteral">&quot;ascii&quot;</span>, stream);
<a name="l01536"></a>01536           }
<a name="l01537"></a>01537         <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup_tuple);
<a name="l01538"></a>01538       }
<a name="l01539"></a>01539     <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup_stream);
<a name="l01540"></a>01540   }
<a name="l01541"></a>01541   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanups);
<a name="l01542"></a>01542 }
<a name="l01543"></a>01543 
<a name="l01544"></a>01544 <span class="keywordtype">void</span>
<a name="l01545"></a><a class="code" href="mi-main_8c.html#a29a7462fc0f6eb0b8a67738f1a7c684f">01545</a> <a class="code" href="mi-cmds_8h.html#a112fb9d36ccc18889f3f8305814f855b">mi_cmd_data_read_memory_bytes</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l01546"></a>01546 {
<a name="l01547"></a>01547   <span class="keyword">struct </span>gdbarch *gdbarch = <a class="code" href="arch-utils_8c.html#a0fe1e68475f442e5d6dda589e0c62454">get_current_arch</a> ();
<a name="l01548"></a>01548   <span class="keyword">struct </span>ui_out *uiout = <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>;
<a name="l01549"></a>01549   <span class="keyword">struct </span>cleanup *cleanups;
<a name="l01550"></a>01550   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> addr;
<a name="l01551"></a>01551   <a class="code" href="defs_8h.html#ac7647a3f71533007c9e128f3ddda1987">LONGEST</a> length;
<a name="l01552"></a>01552   <a class="code" href="structmemory__read__result.html">memory_read_result_s</a> *read_result;
<a name="l01553"></a>01553   <span class="keywordtype">int</span> ix;
<a name="l01554"></a>01554   <a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a>(<a class="code" href="structmemory__read__result.html">memory_read_result_s</a>) *result;
<a name="l01555"></a>01555   <span class="keywordtype">long</span> <a class="code" href="common_2agent_8c.html#aed7ea92f45bd273dde380a45ddced592">offset</a> = 0;
<a name="l01556"></a>01556   <span class="keywordtype">int</span> oind = 0;
<a name="l01557"></a>01557   <span class="keywordtype">char</span> *oarg;
<a name="l01558"></a>01558   <span class="keyword">enum</span> opt
<a name="l01559"></a>01559   {
<a name="l01560"></a>01560     OFFSET_OPT
<a name="l01561"></a>01561   };
<a name="l01562"></a>01562   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structmi__opt.html">mi_opt</a> opts[] =
<a name="l01563"></a>01563     {
<a name="l01564"></a>01564       {<span class="stringliteral">&quot;o&quot;</span>, OFFSET_OPT, 1},
<a name="l01565"></a>01565       { 0, 0, 0 }
<a name="l01566"></a>01566     };
<a name="l01567"></a>01567 
<a name="l01568"></a>01568   <span class="keywordflow">while</span> (1)
<a name="l01569"></a>01569     {
<a name="l01570"></a>01570       <span class="keywordtype">int</span> opt = <a class="code" href="mi-getopt_8c.html#af7bb1a80abf57e9afae0149d3af20b9c">mi_getopt</a> (<span class="stringliteral">&quot;-data-read-memory-bytes&quot;</span>, argc, argv, opts,
<a name="l01571"></a>01571                            &amp;oind, &amp;oarg);
<a name="l01572"></a>01572       <span class="keywordflow">if</span> (opt &lt; 0)
<a name="l01573"></a>01573         <span class="keywordflow">break</span>;
<a name="l01574"></a>01574       <span class="keywordflow">switch</span> ((<span class="keyword">enum</span> opt) opt)
<a name="l01575"></a>01575         {
<a name="l01576"></a>01576         <span class="keywordflow">case</span> OFFSET_OPT:
<a name="l01577"></a>01577           offset = atol (oarg);
<a name="l01578"></a>01578           <span class="keywordflow">break</span>;
<a name="l01579"></a>01579         }
<a name="l01580"></a>01580     }
<a name="l01581"></a>01581   argv += oind;
<a name="l01582"></a>01582   argc -= oind;
<a name="l01583"></a>01583 
<a name="l01584"></a>01584   <span class="keywordflow">if</span> (argc != 2)
<a name="l01585"></a>01585     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Usage: [ -o OFFSET ] ADDR LENGTH.&quot;</span>));
<a name="l01586"></a>01586 
<a name="l01587"></a>01587   addr = <a class="code" href="eval_8c.html#adc1b596b06e274a83197cdeaa0c2809c">parse_and_eval_address</a> (argv[0]) + <a class="code" href="common_2agent_8c.html#aed7ea92f45bd273dde380a45ddced592">offset</a>;
<a name="l01588"></a>01588   length = atol (argv[1]);
<a name="l01589"></a>01589 
<a name="l01590"></a>01590   result = read_memory_robust (<a class="code" href="target_8h.html#a2d8640b030266b58d3821eb5cfd112b9">current_target</a>.<a class="code" href="structtarget__ops.html#a1b180ccb4db2afccf46e691862bf2ddf">beneath</a>, addr, length);
<a name="l01591"></a>01591 
<a name="l01592"></a>01592   cleanups = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="target_8c.html#ace14b59a83987779313984dadc7b781a">free_memory_read_result_vector</a>, result);
<a name="l01593"></a>01593 
<a name="l01594"></a>01594   <span class="keywordflow">if</span> (<a class="code" href="vec_8h.html#a844523bba6d0565ef73a0f4a63e48d19">VEC_length</a> (<a class="code" href="structmemory__read__result.html">memory_read_result_s</a>, result) == 0)
<a name="l01595"></a>01595     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Unable to read memory.&quot;</span>));
<a name="l01596"></a>01596 
<a name="l01597"></a>01597   <a class="code" href="ui-out_8c.html#aa6e8e9b18ba11e13617a6c56cbfab08f">make_cleanup_ui_out_list_begin_end</a> (uiout, <span class="stringliteral">&quot;memory&quot;</span>);
<a name="l01598"></a>01598   <span class="keywordflow">for</span> (ix = 0;
<a name="l01599"></a>01599        <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="structmemory__read__result.html">memory_read_result_s</a>, result, ix, read_result);
<a name="l01600"></a>01600        ++ix)
<a name="l01601"></a>01601     {
<a name="l01602"></a>01602       <span class="keyword">struct </span>cleanup *t = <a class="code" href="ui-out_8c.html#aaf5a0c991d74ad2e486f420d5c2ff058">make_cleanup_ui_out_tuple_begin_end</a> (uiout, NULL);
<a name="l01603"></a>01603       <span class="keywordtype">char</span> *data, *p;
<a name="l01604"></a>01604       <span class="keywordtype">int</span> i;
<a name="l01605"></a>01605 
<a name="l01606"></a>01606       <a class="code" href="ui-out_8c.html#ada85ed653fecf3c2a80027de6f71ef71">ui_out_field_core_addr</a> (uiout, <span class="stringliteral">&quot;begin&quot;</span>, gdbarch, read_result-&gt;<a class="code" href="structmemory__read__result.html#adadeb5f2f283c5c1ab5aa2bcf4939009">begin</a>);
<a name="l01607"></a>01607       <a class="code" href="ui-out_8c.html#ada85ed653fecf3c2a80027de6f71ef71">ui_out_field_core_addr</a> (uiout, <span class="stringliteral">&quot;offset&quot;</span>, gdbarch, read_result-&gt;<a class="code" href="structmemory__read__result.html#adadeb5f2f283c5c1ab5aa2bcf4939009">begin</a>
<a name="l01608"></a>01608                               - addr);
<a name="l01609"></a>01609       <a class="code" href="ui-out_8c.html#ada85ed653fecf3c2a80027de6f71ef71">ui_out_field_core_addr</a> (uiout, <span class="stringliteral">&quot;end&quot;</span>, gdbarch, read_result-&gt;<a class="code" href="structmemory__read__result.html#aafabc84f972ba2ade634094f25f4f87a">end</a>);
<a name="l01610"></a>01610 
<a name="l01611"></a>01611       data = <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> ((read_result-&gt;<a class="code" href="structmemory__read__result.html#aafabc84f972ba2ade634094f25f4f87a">end</a> - read_result-&gt;<a class="code" href="structmemory__read__result.html#adadeb5f2f283c5c1ab5aa2bcf4939009">begin</a>) * 2 + 1);
<a name="l01612"></a>01612 
<a name="l01613"></a>01613       <span class="keywordflow">for</span> (i = 0, p = data;
<a name="l01614"></a>01614            i &lt; (read_result-&gt;<a class="code" href="structmemory__read__result.html#aafabc84f972ba2ade634094f25f4f87a">end</a> - read_result-&gt;<a class="code" href="structmemory__read__result.html#adadeb5f2f283c5c1ab5aa2bcf4939009">begin</a>);
<a name="l01615"></a>01615            ++i, p += 2)
<a name="l01616"></a>01616         {
<a name="l01617"></a>01617           sprintf (p, <span class="stringliteral">&quot;%02x&quot;</span>, read_result-&gt;<a class="code" href="structmemory__read__result.html#ae5a522187d5a2adc2adfefec0a0e2220">data</a>[i]);
<a name="l01618"></a>01618         }
<a name="l01619"></a>01619       <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;contents&quot;</span>, data);
<a name="l01620"></a>01620       <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (data);
<a name="l01621"></a>01621       <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (t);
<a name="l01622"></a>01622     }
<a name="l01623"></a>01623   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanups);
<a name="l01624"></a>01624 }
<a name="l01625"></a>01625 
<a name="l01626"></a>01626 <span class="comment">/* Implementation of the -data-write_memory command.</span>
<a name="l01627"></a>01627 <span class="comment"></span>
<a name="l01628"></a>01628 <span class="comment">   COLUMN_OFFSET: optional argument. Must be preceded by &#39;-o&#39;. The</span>
<a name="l01629"></a>01629 <span class="comment">   offset from the beginning of the memory grid row where the cell to</span>
<a name="l01630"></a>01630 <span class="comment">   be written is.</span>
<a name="l01631"></a>01631 <span class="comment">   ADDR: start address of the row in the memory grid where the memory</span>
<a name="l01632"></a>01632 <span class="comment">   cell is, if OFFSET_COLUMN is specified.  Otherwise, the address of</span>
<a name="l01633"></a>01633 <span class="comment">   the location to write to.</span>
<a name="l01634"></a>01634 <span class="comment">   FORMAT: a char indicating format for the ``word&#39;&#39;.  See </span>
<a name="l01635"></a>01635 <span class="comment">   the ``x&#39;&#39; command.</span>
<a name="l01636"></a>01636 <span class="comment">   WORD_SIZE: size of each ``word&#39;&#39;; 1,2,4, or 8 bytes</span>
<a name="l01637"></a>01637 <span class="comment">   VALUE: value to be written into the memory address.</span>
<a name="l01638"></a>01638 <span class="comment"></span>
<a name="l01639"></a>01639 <span class="comment">   Writes VALUE into ADDR + (COLUMN_OFFSET * WORD_SIZE).</span>
<a name="l01640"></a>01640 <span class="comment"></span>
<a name="l01641"></a>01641 <span class="comment">   Prints nothing.  */</span>
<a name="l01642"></a>01642 
<a name="l01643"></a>01643 <span class="keywordtype">void</span>
<a name="l01644"></a><a class="code" href="mi-main_8c.html#a990180a9605dfe4f657400d02577b720">01644</a> <a class="code" href="mi-cmds_8h.html#ab20300195346cbabe9b2bd331a4fe327">mi_cmd_data_write_memory</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l01645"></a>01645 {
<a name="l01646"></a>01646   <span class="keyword">struct </span>gdbarch *gdbarch = <a class="code" href="arch-utils_8c.html#a0fe1e68475f442e5d6dda589e0c62454">get_current_arch</a> ();
<a name="l01647"></a>01647   <span class="keyword">enum</span> bfd_endian byte_order = <a class="code" href="gdbarch_8c.html#abc300a3797421aa7342b288e1637483e">gdbarch_byte_order</a> (gdbarch);
<a name="l01648"></a>01648   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> addr;
<a name="l01649"></a>01649   <span class="keywordtype">long</span> word_size;
<a name="l01650"></a>01650   <span class="comment">/* FIXME: ezannoni 2000-02-17 LONGEST could possibly not be big</span>
<a name="l01651"></a>01651 <span class="comment">     enough when using a compiler other than GCC.  */</span>
<a name="l01652"></a>01652   <a class="code" href="defs_8h.html#ac7647a3f71533007c9e128f3ddda1987">LONGEST</a> value;
<a name="l01653"></a>01653   <span class="keywordtype">void</span> *<a class="code" href="structbuffer.html">buffer</a>;
<a name="l01654"></a>01654   <span class="keyword">struct </span>cleanup *old_chain;
<a name="l01655"></a>01655   <span class="keywordtype">long</span> <a class="code" href="common_2agent_8c.html#aed7ea92f45bd273dde380a45ddced592">offset</a> = 0;
<a name="l01656"></a>01656   <span class="keywordtype">int</span> oind = 0;
<a name="l01657"></a>01657   <span class="keywordtype">char</span> *oarg;
<a name="l01658"></a>01658   <span class="keyword">enum</span> opt
<a name="l01659"></a>01659   {
<a name="l01660"></a>01660     OFFSET_OPT
<a name="l01661"></a>01661   };
<a name="l01662"></a>01662   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structmi__opt.html">mi_opt</a> opts[] =
<a name="l01663"></a>01663     {
<a name="l01664"></a>01664       {<span class="stringliteral">&quot;o&quot;</span>, OFFSET_OPT, 1},
<a name="l01665"></a>01665       { 0, 0, 0 }
<a name="l01666"></a>01666     };
<a name="l01667"></a>01667 
<a name="l01668"></a>01668   <span class="keywordflow">while</span> (1)
<a name="l01669"></a>01669     {
<a name="l01670"></a>01670       <span class="keywordtype">int</span> opt = <a class="code" href="mi-getopt_8c.html#af7bb1a80abf57e9afae0149d3af20b9c">mi_getopt</a> (<span class="stringliteral">&quot;-data-write-memory&quot;</span>, argc, argv, opts,
<a name="l01671"></a>01671                            &amp;oind, &amp;oarg);
<a name="l01672"></a>01672 
<a name="l01673"></a>01673       <span class="keywordflow">if</span> (opt &lt; 0)
<a name="l01674"></a>01674         <span class="keywordflow">break</span>;
<a name="l01675"></a>01675       <span class="keywordflow">switch</span> ((<span class="keyword">enum</span> opt) opt)
<a name="l01676"></a>01676         {
<a name="l01677"></a>01677         <span class="keywordflow">case</span> OFFSET_OPT:
<a name="l01678"></a>01678           offset = atol (oarg);
<a name="l01679"></a>01679           <span class="keywordflow">break</span>;
<a name="l01680"></a>01680         }
<a name="l01681"></a>01681     }
<a name="l01682"></a>01682   argv += oind;
<a name="l01683"></a>01683   argc -= oind;
<a name="l01684"></a>01684 
<a name="l01685"></a>01685   <span class="keywordflow">if</span> (argc != 4)
<a name="l01686"></a>01686     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;-data-write-memory: Usage: &quot;</span>
<a name="l01687"></a>01687              <span class="stringliteral">&quot;[-o COLUMN_OFFSET] ADDR FORMAT WORD-SIZE VALUE.&quot;</span>));
<a name="l01688"></a>01688 
<a name="l01689"></a>01689   <span class="comment">/* Extract all the arguments.  */</span>
<a name="l01690"></a>01690   <span class="comment">/* Start address of the memory dump.  */</span>
<a name="l01691"></a>01691   addr = <a class="code" href="eval_8c.html#adc1b596b06e274a83197cdeaa0c2809c">parse_and_eval_address</a> (argv[0]);
<a name="l01692"></a>01692   <span class="comment">/* The size of the memory word.  */</span>
<a name="l01693"></a>01693   word_size = atol (argv[2]);
<a name="l01694"></a>01694 
<a name="l01695"></a>01695   <span class="comment">/* Calculate the real address of the write destination.  */</span>
<a name="l01696"></a>01696   addr += (offset * word_size);
<a name="l01697"></a>01697 
<a name="l01698"></a>01698   <span class="comment">/* Get the value as a number.  */</span>
<a name="l01699"></a>01699   value = <a class="code" href="eval_8c.html#adc1b596b06e274a83197cdeaa0c2809c">parse_and_eval_address</a> (argv[3]);
<a name="l01700"></a>01700   <span class="comment">/* Get the value into an array.  */</span>
<a name="l01701"></a>01701   buffer = <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (word_size);
<a name="l01702"></a>01702   old_chain = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, buffer);
<a name="l01703"></a>01703   <a class="code" href="defs_8h.html#a7617dac62d71b03b2a4c546ced8fccbb">store_signed_integer</a> (buffer, word_size, byte_order, value);
<a name="l01704"></a>01704   <span class="comment">/* Write it down to memory.  */</span>
<a name="l01705"></a>01705   <a class="code" href="corefile_8c.html#a79bfa0e1eb4062f8c9e8448b47e7b3ea">write_memory_with_notification</a> (addr, buffer, word_size);
<a name="l01706"></a>01706   <span class="comment">/* Free the buffer.  */</span>
<a name="l01707"></a>01707   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l01708"></a>01708 }
<a name="l01709"></a>01709 
<a name="l01710"></a>01710 <span class="comment">/* Implementation of the -data-write-memory-bytes command.</span>
<a name="l01711"></a>01711 <span class="comment"></span>
<a name="l01712"></a>01712 <span class="comment">   ADDR: start address</span>
<a name="l01713"></a>01713 <span class="comment">   DATA: string of bytes to write at that address</span>
<a name="l01714"></a>01714 <span class="comment">   COUNT: number of bytes to be filled (decimal integer).  */</span>
<a name="l01715"></a>01715 
<a name="l01716"></a>01716 <span class="keywordtype">void</span>
<a name="l01717"></a><a class="code" href="mi-main_8c.html#a2892b33640fdfb616fc7a8c7b83ee9e6">01717</a> <a class="code" href="mi-cmds_8h.html#ab626606b684113bd11ce32db503224ed">mi_cmd_data_write_memory_bytes</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l01718"></a>01718 {
<a name="l01719"></a>01719   <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> addr;
<a name="l01720"></a>01720   <span class="keywordtype">char</span> *cdata;
<a name="l01721"></a>01721   <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *data;
<a name="l01722"></a>01722   <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *databuf;
<a name="l01723"></a>01723   <span class="keywordtype">size_t</span> <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>, i, steps, remainder;
<a name="l01724"></a>01724   <span class="keywordtype">long</span> <span class="keywordtype">int</span> count, j;
<a name="l01725"></a>01725   <span class="keyword">struct </span>cleanup *back_to;
<a name="l01726"></a>01726 
<a name="l01727"></a>01727   <span class="keywordflow">if</span> (argc != 2 &amp;&amp; argc != 3)
<a name="l01728"></a>01728     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Usage: ADDR DATA [COUNT].&quot;</span>));
<a name="l01729"></a>01729 
<a name="l01730"></a>01730   addr = <a class="code" href="eval_8c.html#adc1b596b06e274a83197cdeaa0c2809c">parse_and_eval_address</a> (argv[0]);
<a name="l01731"></a>01731   cdata = argv[1];
<a name="l01732"></a>01732   <span class="keywordflow">if</span> (strlen (cdata) % 2)
<a name="l01733"></a>01733     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Hex-encoded &#39;%s&#39; must have an even number of characters.&quot;</span>),
<a name="l01734"></a>01734            cdata);
<a name="l01735"></a>01735 
<a name="l01736"></a>01736   len = strlen (cdata)/2;
<a name="l01737"></a>01737   <span class="keywordflow">if</span> (argc == 3)
<a name="l01738"></a>01738     count = strtoul (argv[2], NULL, 10);
<a name="l01739"></a>01739   <span class="keywordflow">else</span>
<a name="l01740"></a>01740     count = <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>;
<a name="l01741"></a>01741 
<a name="l01742"></a>01742   databuf = <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (len * <span class="keyword">sizeof</span> (<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a>));
<a name="l01743"></a>01743   back_to = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, databuf);
<a name="l01744"></a>01744 
<a name="l01745"></a>01745   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>; ++i)
<a name="l01746"></a>01746     {
<a name="l01747"></a>01747       <span class="keywordtype">int</span> x;
<a name="l01748"></a>01748       <span class="keywordflow">if</span> (sscanf (cdata + i * 2, <span class="stringliteral">&quot;%02x&quot;</span>, &amp;x) != 1)
<a name="l01749"></a>01749         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Invalid argument&quot;</span>));
<a name="l01750"></a>01750       databuf[i] = (<a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a>) x;
<a name="l01751"></a>01751     }
<a name="l01752"></a>01752 
<a name="l01753"></a>01753   <span class="keywordflow">if</span> (len &lt; count)
<a name="l01754"></a>01754     {
<a name="l01755"></a>01755       <span class="comment">/* Pattern is made of less bytes than count: </span>
<a name="l01756"></a>01756 <span class="comment">         repeat pattern to fill memory.  */</span>
<a name="l01757"></a>01757       data = <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (count);
<a name="l01758"></a>01758       <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, data);
<a name="l01759"></a>01759     
<a name="l01760"></a>01760       steps = count / <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>;
<a name="l01761"></a>01761       remainder = count % <a class="code" href="exec_8h.html#a00f945351279d3c8935f13d2b9f9b808">len</a>;
<a name="l01762"></a>01762       <span class="keywordflow">for</span> (j = 0; j &lt; steps; j++)
<a name="l01763"></a>01763         <a class="code" href="gdb__string_8h.html#a39ebe6a4e122707997e78b549a1e8c5e">memcpy</a> (data + j * len, databuf, len);
<a name="l01764"></a>01764 
<a name="l01765"></a>01765       <span class="keywordflow">if</span> (remainder &gt; 0)
<a name="l01766"></a>01766         <a class="code" href="gdb__string_8h.html#a39ebe6a4e122707997e78b549a1e8c5e">memcpy</a> (data + steps * len, databuf, remainder);
<a name="l01767"></a>01767     }
<a name="l01768"></a>01768   <span class="keywordflow">else</span> 
<a name="l01769"></a>01769     {
<a name="l01770"></a>01770       <span class="comment">/* Pattern is longer than or equal to count: </span>
<a name="l01771"></a>01771 <span class="comment">         just copy len bytes.  */</span>
<a name="l01772"></a>01772       data = databuf;
<a name="l01773"></a>01773     }
<a name="l01774"></a>01774 
<a name="l01775"></a>01775   <a class="code" href="corefile_8c.html#a79bfa0e1eb4062f8c9e8448b47e7b3ea">write_memory_with_notification</a> (addr, data, count);
<a name="l01776"></a>01776 
<a name="l01777"></a>01777   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (back_to);
<a name="l01778"></a>01778 }
<a name="l01779"></a>01779 
<a name="l01780"></a>01780 <span class="keywordtype">void</span>
<a name="l01781"></a><a class="code" href="mi-main_8c.html#a5ed6093b2e1e1da973d340e54829e1f6">01781</a> <a class="code" href="mi-cmds_8h.html#a535014043fa0f2b73342f7bcc84e4bb9">mi_cmd_enable_timings</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l01782"></a>01782 {
<a name="l01783"></a>01783   <span class="keywordflow">if</span> (argc == 0)
<a name="l01784"></a>01784     do_timings = 1;
<a name="l01785"></a>01785   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (argc == 1)
<a name="l01786"></a>01786     {
<a name="l01787"></a>01787       <span class="keywordflow">if</span> (strcmp (argv[0], <span class="stringliteral">&quot;yes&quot;</span>) == 0)
<a name="l01788"></a>01788         do_timings = 1;
<a name="l01789"></a>01789       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (argv[0], <span class="stringliteral">&quot;no&quot;</span>) == 0)
<a name="l01790"></a>01790         do_timings = 0;
<a name="l01791"></a>01791       <span class="keywordflow">else</span>
<a name="l01792"></a>01792         <span class="keywordflow">goto</span> usage_error;
<a name="l01793"></a>01793     }
<a name="l01794"></a>01794   <span class="keywordflow">else</span>
<a name="l01795"></a>01795     <span class="keywordflow">goto</span> usage_error;
<a name="l01796"></a>01796     
<a name="l01797"></a>01797   <span class="keywordflow">return</span>;
<a name="l01798"></a>01798 
<a name="l01799"></a>01799  usage_error:
<a name="l01800"></a>01800   <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;-enable-timings: Usage: %s {yes|no}&quot;</span>), command);
<a name="l01801"></a>01801 }
<a name="l01802"></a>01802 
<a name="l01803"></a>01803 <span class="keywordtype">void</span>
<a name="l01804"></a><a class="code" href="mi-main_8c.html#a53b47bf7f921f3cbeff44241e452a8d4">01804</a> <a class="code" href="mi-cmds_8h.html#ab0381d933c25fe376675a4b936da407f">mi_cmd_list_features</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l01805"></a>01805 {
<a name="l01806"></a>01806   <span class="keywordflow">if</span> (argc == 0)
<a name="l01807"></a>01807     {
<a name="l01808"></a>01808       <span class="keyword">struct </span>cleanup *cleanup = NULL;
<a name="l01809"></a>01809       <span class="keyword">struct </span>ui_out *uiout = <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>;
<a name="l01810"></a>01810 
<a name="l01811"></a>01811       cleanup = <a class="code" href="ui-out_8c.html#aa6e8e9b18ba11e13617a6c56cbfab08f">make_cleanup_ui_out_list_begin_end</a> (uiout, <span class="stringliteral">&quot;features&quot;</span>);      
<a name="l01812"></a>01812       <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, NULL, <span class="stringliteral">&quot;frozen-varobjs&quot;</span>);
<a name="l01813"></a>01813       <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, NULL, <span class="stringliteral">&quot;pending-breakpoints&quot;</span>);
<a name="l01814"></a>01814       <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, NULL, <span class="stringliteral">&quot;thread-info&quot;</span>);
<a name="l01815"></a>01815       <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, NULL, <span class="stringliteral">&quot;data-read-memory-bytes&quot;</span>);
<a name="l01816"></a>01816       <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, NULL, <span class="stringliteral">&quot;breakpoint-notifications&quot;</span>);
<a name="l01817"></a>01817       <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, NULL, <span class="stringliteral">&quot;ada-task-info&quot;</span>);
<a name="l01818"></a>01818       
<a name="l01819"></a>01819 <span class="preprocessor">#if HAVE_PYTHON</span>
<a name="l01820"></a>01820 <span class="preprocessor"></span>      <span class="keywordflow">if</span> (<a class="code" href="python-internal_8h.html#a2f9782caf78c6a6f300ce14c165d9605">gdb_python_initialized</a>)
<a name="l01821"></a>01821         <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, NULL, <span class="stringliteral">&quot;python&quot;</span>);
<a name="l01822"></a>01822 <span class="preprocessor">#endif</span>
<a name="l01823"></a>01823 <span class="preprocessor"></span>      
<a name="l01824"></a>01824       <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup);
<a name="l01825"></a>01825       <span class="keywordflow">return</span>;
<a name="l01826"></a>01826     }
<a name="l01827"></a>01827 
<a name="l01828"></a>01828   <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;-list-features should be passed no arguments&quot;</span>));
<a name="l01829"></a>01829 }
<a name="l01830"></a>01830 
<a name="l01831"></a>01831 <span class="keywordtype">void</span>
<a name="l01832"></a><a class="code" href="mi-main_8c.html#aed86f5a116621238f21bb9abd1da19cc">01832</a> <a class="code" href="mi-cmds_8h.html#af0dd3465504dba4e01fc02852f937f3f">mi_cmd_list_target_features</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l01833"></a>01833 {
<a name="l01834"></a>01834   <span class="keywordflow">if</span> (argc == 0)
<a name="l01835"></a>01835     {
<a name="l01836"></a>01836       <span class="keyword">struct </span>cleanup *cleanup = NULL;
<a name="l01837"></a>01837       <span class="keyword">struct </span>ui_out *uiout = <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>;
<a name="l01838"></a>01838 
<a name="l01839"></a>01839       cleanup = <a class="code" href="ui-out_8c.html#aa6e8e9b18ba11e13617a6c56cbfab08f">make_cleanup_ui_out_list_begin_end</a> (uiout, <span class="stringliteral">&quot;features&quot;</span>);      
<a name="l01840"></a>01840       <span class="keywordflow">if</span> (<a class="code" href="target_8h.html#a2b6015c90130096b2e9757013e49c1e9">target_can_async_p</a> ())
<a name="l01841"></a>01841         <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, NULL, <span class="stringliteral">&quot;async&quot;</span>);
<a name="l01842"></a>01842       <span class="keywordflow">if</span> (<a class="code" href="target_8h.html#a9d505a2eeddd080948e3f40957b7b264">target_can_execute_reverse</a>)
<a name="l01843"></a>01843         <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, NULL, <span class="stringliteral">&quot;reverse&quot;</span>);
<a name="l01844"></a>01844       
<a name="l01845"></a>01845       <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup);
<a name="l01846"></a>01846       <span class="keywordflow">return</span>;
<a name="l01847"></a>01847     }
<a name="l01848"></a>01848 
<a name="l01849"></a>01849   <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;-list-target-features should be passed no arguments&quot;</span>));
<a name="l01850"></a>01850 }
<a name="l01851"></a>01851 
<a name="l01852"></a>01852 <span class="keywordtype">void</span>
<a name="l01853"></a><a class="code" href="mi-main_8c.html#ac31666977a69e4737e3f6c32a9589500">01853</a> <a class="code" href="mi-cmds_8h.html#a4e1fcad3f031c0bcdce5eec0ae02eeec">mi_cmd_add_inferior</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l01854"></a>01854 {
<a name="l01855"></a>01855   <span class="keyword">struct </span>inferior *<a class="code" href="namespacearm-linux.html#aaf6bae53545ee96f24d7ba560ed0a205">inf</a>;
<a name="l01856"></a>01856 
<a name="l01857"></a>01857   <span class="keywordflow">if</span> (argc != 0)
<a name="l01858"></a>01858     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;-add-inferior should be passed no arguments&quot;</span>));
<a name="l01859"></a>01859 
<a name="l01860"></a>01860   inf = <a class="code" href="inferior_8c.html#a92e5892ec5613d7a30bf2d71f9e6ccaf">add_inferior_with_spaces</a> ();
<a name="l01861"></a>01861 
<a name="l01862"></a>01862   <a class="code" href="ui-out_8c.html#ac29596ba86f387928e0d3e6b7385f998">ui_out_field_fmt</a> (<a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>, <span class="stringliteral">&quot;inferior&quot;</span>, <span class="stringliteral">&quot;i%d&quot;</span>, inf-&gt;<a class="code" href="structinferior.html#af9e2350a56bd124ce14020ccc0c93f9e">num</a>);
<a name="l01863"></a>01863 }
<a name="l01864"></a>01864 
<a name="l01865"></a>01865 <span class="comment">/* Callback used to find the first inferior other than the current</span>
<a name="l01866"></a>01866 <span class="comment">   one.  */</span>
<a name="l01867"></a>01867    
<a name="l01868"></a>01868 <span class="keyword">static</span> <span class="keywordtype">int</span>
<a name="l01869"></a>01869 get_other_inferior (<span class="keyword">struct</span> inferior *inf, <span class="keywordtype">void</span> *arg)
<a name="l01870"></a>01870 {
<a name="l01871"></a>01871   <span class="keywordflow">if</span> (inf == <a class="code" href="inferior_8c.html#a9e592c83e7c0c1f89f1a4a392bd1a277">current_inferior</a> ())
<a name="l01872"></a>01872     <span class="keywordflow">return</span> 0;
<a name="l01873"></a>01873 
<a name="l01874"></a>01874   <span class="keywordflow">return</span> 1;
<a name="l01875"></a>01875 }
<a name="l01876"></a>01876 
<a name="l01877"></a>01877 <span class="keywordtype">void</span>
<a name="l01878"></a><a class="code" href="mi-main_8c.html#a35b7890620b98c2ef5cc5e82f2bcabff">01878</a> <a class="code" href="mi-cmds_8h.html#aa4cf5b6a076c783615c52dd093645551">mi_cmd_remove_inferior</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l01879"></a>01879 {
<a name="l01880"></a>01880   <span class="keywordtype">int</span> id;
<a name="l01881"></a>01881   <span class="keyword">struct </span>inferior *<a class="code" href="namespacearm-linux.html#aaf6bae53545ee96f24d7ba560ed0a205">inf</a>;
<a name="l01882"></a>01882 
<a name="l01883"></a>01883   <span class="keywordflow">if</span> (argc != 1)
<a name="l01884"></a>01884     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;-remove-inferior should be passed a single argument&quot;</span>));
<a name="l01885"></a>01885 
<a name="l01886"></a>01886   <span class="keywordflow">if</span> (sscanf (argv[0], <span class="stringliteral">&quot;i%d&quot;</span>, &amp;<span class="keywordtype">id</span>) != 1)
<a name="l01887"></a>01887     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;the thread group id is syntactically invalid&quot;</span>));
<a name="l01888"></a>01888 
<a name="l01889"></a>01889   inf = <a class="code" href="inferior_8c.html#a3522179a3919bac51a689cb3c0ad98f5">find_inferior_id</a> (<span class="keywordtype">id</span>);
<a name="l01890"></a>01890   <span class="keywordflow">if</span> (!inf)
<a name="l01891"></a>01891     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;the specified thread group does not exist&quot;</span>));
<a name="l01892"></a>01892 
<a name="l01893"></a>01893   <span class="keywordflow">if</span> (inf-&gt;<a class="code" href="structinferior.html#a1be87f581dbb6c893dbe1f2ff701636a">pid</a> != 0)
<a name="l01894"></a>01894     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;cannot remove an active inferior&quot;</span>));
<a name="l01895"></a>01895 
<a name="l01896"></a>01896   <span class="keywordflow">if</span> (inf == <a class="code" href="inferior_8c.html#a9e592c83e7c0c1f89f1a4a392bd1a277">current_inferior</a> ())
<a name="l01897"></a>01897     {
<a name="l01898"></a>01898       <span class="keyword">struct </span><a class="code" href="structthread__info.html">thread_info</a> *tp = 0;
<a name="l01899"></a>01899       <span class="keyword">struct </span>inferior *new_inferior 
<a name="l01900"></a>01900         = <a class="code" href="inferior_8c.html#afcb3f43a2669a8ad733c575dc07d3a80">iterate_over_inferiors</a> (get_other_inferior, NULL);
<a name="l01901"></a>01901 
<a name="l01902"></a>01902       <span class="keywordflow">if</span> (new_inferior == NULL)
<a name="l01903"></a>01903         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Cannot remove last inferior&quot;</span>));
<a name="l01904"></a>01904 
<a name="l01905"></a>01905       <a class="code" href="inferior_8c.html#a5e82a0bf51f4554e1e639c7b48de5e57">set_current_inferior</a> (new_inferior);
<a name="l01906"></a>01906       <span class="keywordflow">if</span> (new_inferior-&gt;<a class="code" href="structinferior.html#a1be87f581dbb6c893dbe1f2ff701636a">pid</a> != 0)
<a name="l01907"></a>01907         tp = <a class="code" href="gdbthread_8h.html#a5be9dac86c4806d929f3e3d8f9c37ffc">any_thread_of_process</a> (new_inferior-&gt;<a class="code" href="structinferior.html#a1be87f581dbb6c893dbe1f2ff701636a">pid</a>);
<a name="l01908"></a>01908       <a class="code" href="gdbthread_8h.html#aee26ee8d9825599b321b73d2ecb5ac54">switch_to_thread</a> (tp ? tp-&gt;<a class="code" href="structthread__info.html#a533aa3979b60affd446e9fbff93fdd2c">ptid</a> : <a class="code" href="ptid_8c.html#acba69c857786546b204883bbcc90a64e">null_ptid</a>);
<a name="l01909"></a>01909       <a class="code" href="progspace_8c.html#a394457638b3e584a3ecd019df372209f">set_current_program_space</a> (new_inferior-&gt;<a class="code" href="structinferior.html#afc6a557206fd753b89e34bd33e038cfe">pspace</a>);
<a name="l01910"></a>01910     }
<a name="l01911"></a>01911 
<a name="l01912"></a>01912   <a class="code" href="inferior_8c.html#a53f6f47db4984f82cf37b329fbc4a950">delete_inferior_1</a> (inf, 1 <span class="comment">/* silent */</span>);
<a name="l01913"></a>01913 }
<a name="l01914"></a>01914 
<a name="l01915"></a>01915 
<a name="l01916"></a>01916 
<a name="l01917"></a>01917 <span class="comment">/* Execute a command within a safe environment.</span>
<a name="l01918"></a>01918 <span class="comment">   Return &lt;0 for error; &gt;=0 for ok.</span>
<a name="l01919"></a>01919 <span class="comment"></span>
<a name="l01920"></a>01920 <span class="comment">   args-&gt;action will tell mi_execute_command what action</span>
<a name="l01921"></a>01921 <span class="comment">   to perfrom after the given command has executed (display/suppress</span>
<a name="l01922"></a>01922 <span class="comment">   prompt, display error).  */</span>
<a name="l01923"></a>01923 
<a name="l01924"></a>01924 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l01925"></a>01925 captured_mi_execute_command (<span class="keyword">struct</span> ui_out *uiout, <span class="keyword">struct</span> <a class="code" href="structmi__parse.html">mi_parse</a> *context)
<a name="l01926"></a>01926 {
<a name="l01927"></a>01927   <span class="keyword">struct </span>cleanup *cleanup;
<a name="l01928"></a>01928 
<a name="l01929"></a>01929   <span class="keywordflow">if</span> (do_timings)
<a name="l01930"></a>01930     current_command_ts = context-&gt;<a class="code" href="structmi__parse.html#a3e1add4fa3c621d6ce4b4051df968a47">cmd_start</a>;
<a name="l01931"></a>01931 
<a name="l01932"></a>01932   <a class="code" href="mi-main_8c.html#a4f31fe20e2b760c8d54d42910947ef2d">current_token</a> = xstrdup (context-&gt;<a class="code" href="structmi__parse.html#ab717580dd67552e6a72df84ae00ffe65">token</a>);
<a name="l01933"></a>01933   cleanup = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="utils_8c.html#a6d8c21606d3f67a431a7bfbb1f47d12e">free_current_contents</a>, &amp;<a class="code" href="mi-main_8c.html#a4f31fe20e2b760c8d54d42910947ef2d">current_token</a>);
<a name="l01934"></a>01934 
<a name="l01935"></a>01935   <a class="code" href="mi-main_8c.html#a974a29ac0dd1dbabd96ff5f85e378419">running_result_record_printed</a> = 0;
<a name="l01936"></a>01936   <a class="code" href="mi-main_8c.html#a987c1fbb7cbe6c0bf8abd268085acb0a">mi_proceeded</a> = 0;
<a name="l01937"></a>01937   <span class="keywordflow">switch</span> (context-&gt;<a class="code" href="structmi__parse.html#ad365e7b18bdda40491c001d5de94ded7">op</a>)
<a name="l01938"></a>01938     {
<a name="l01939"></a>01939     <span class="keywordflow">case</span> <a class="code" href="mi-parse_8h.html#a4ff0bfe7f44845d18a4395c1c6821378a160cb81e4b221874828d13fad7e8f41d">MI_COMMAND</a>:
<a name="l01940"></a>01940       <span class="comment">/* A MI command was read from the input stream.  */</span>
<a name="l01941"></a>01941       <span class="keywordflow">if</span> (<a class="code" href="mi-cmds_8h.html#af8ca1d2185e5fbf7cb113d43f0994ae9">mi_debug_p</a>)
<a name="l01942"></a>01942         <span class="comment">/* FIXME: gdb_???? */</span>
<a name="l01943"></a>01943         <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>, <span class="stringliteral">&quot; token=`%s&#39; command=`%s&#39; args=`%s&#39;\n&quot;</span>,
<a name="l01944"></a>01944                             context-&gt;<a class="code" href="structmi__parse.html#ab717580dd67552e6a72df84ae00ffe65">token</a>, context-&gt;<a class="code" href="structmi__parse.html#ae875047151207dac2c533978fc572115">command</a>, context-&gt;<a class="code" href="structmi__parse.html#a2a3b25c334a4baddc6185fed4cb90c78">args</a>);
<a name="l01945"></a>01945 
<a name="l01946"></a>01946       mi_cmd_execute (context);
<a name="l01947"></a>01947 
<a name="l01948"></a>01948       <span class="comment">/* Print the result if there were no errors.</span>
<a name="l01949"></a>01949 <span class="comment"></span>
<a name="l01950"></a>01950 <span class="comment">         Remember that on the way out of executing a command, you have</span>
<a name="l01951"></a>01951 <span class="comment">         to directly use the mi_interp&#39;s uiout, since the command</span>
<a name="l01952"></a>01952 <span class="comment">         could have reset the interpreter, in which case the current</span>
<a name="l01953"></a>01953 <span class="comment">         uiout will most likely crash in the mi_out_* routines.  */</span>
<a name="l01954"></a>01954       <span class="keywordflow">if</span> (!<a class="code" href="mi-main_8c.html#a974a29ac0dd1dbabd96ff5f85e378419">running_result_record_printed</a>)
<a name="l01955"></a>01955         {
<a name="l01956"></a>01956           <a class="code" href="ui-file_8c.html#aae3b905f888b1dcdce586f77b9554153">fputs_unfiltered</a> (context-&gt;<a class="code" href="structmi__parse.html#ab717580dd67552e6a72df84ae00ffe65">token</a>, <a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);
<a name="l01957"></a>01957           <span class="comment">/* There&#39;s no particularly good reason why target-connect results</span>
<a name="l01958"></a>01958 <span class="comment">             in not ^done.  Should kill ^connected for MI3.  */</span>
<a name="l01959"></a>01959           <a class="code" href="ui-file_8c.html#aae3b905f888b1dcdce586f77b9554153">fputs_unfiltered</a> (strcmp (context-&gt;<a class="code" href="structmi__parse.html#ae875047151207dac2c533978fc572115">command</a>, <span class="stringliteral">&quot;target-select&quot;</span>) == 0
<a name="l01960"></a>01960                             ? <span class="stringliteral">&quot;^connected&quot;</span> : <span class="stringliteral">&quot;^done&quot;</span>, <a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);
<a name="l01961"></a>01961           <a class="code" href="mi-out_8c.html#a395eec86cb794425014fa789e78d18f9">mi_out_put</a> (uiout, <a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);
<a name="l01962"></a>01962           <a class="code" href="mi-out_8c.html#a5586f83db70f70a26abc03703c9b177e">mi_out_rewind</a> (uiout);
<a name="l01963"></a>01963           <a class="code" href="mi-main_8c.html#a000d4dec4db900d06f900cfde3eb1f93">mi_print_timing_maybe</a> ();
<a name="l01964"></a>01964           <a class="code" href="ui-file_8c.html#aae3b905f888b1dcdce586f77b9554153">fputs_unfiltered</a> (<span class="stringliteral">&quot;\n&quot;</span>, <a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);
<a name="l01965"></a>01965         }
<a name="l01966"></a>01966       <span class="keywordflow">else</span>
<a name="l01967"></a>01967         <span class="comment">/* The command does not want anything to be printed.  In that</span>
<a name="l01968"></a>01968 <span class="comment">           case, the command probably should not have written anything</span>
<a name="l01969"></a>01969 <span class="comment">           to uiout, but in case it has written something, discard it.  */</span>
<a name="l01970"></a>01970         <a class="code" href="mi-out_8c.html#a5586f83db70f70a26abc03703c9b177e">mi_out_rewind</a> (uiout);
<a name="l01971"></a>01971       <span class="keywordflow">break</span>;
<a name="l01972"></a>01972 
<a name="l01973"></a>01973     <span class="keywordflow">case</span> <a class="code" href="mi-parse_8h.html#a4ff0bfe7f44845d18a4395c1c6821378a3795e7d6003fbb00b8f7f9f781382a20">CLI_COMMAND</a>:
<a name="l01974"></a>01974       {
<a name="l01975"></a>01975         <span class="keywordtype">char</span> *argv[2];
<a name="l01976"></a>01976 
<a name="l01977"></a>01977         <span class="comment">/* A CLI command was read from the input stream.  */</span>
<a name="l01978"></a>01978         <span class="comment">/* This &quot;feature&quot; will be removed as soon as we have a</span>
<a name="l01979"></a>01979 <span class="comment">           complete set of mi commands.  */</span>
<a name="l01980"></a>01980         <span class="comment">/* Echo the command on the console.  */</span>
<a name="l01981"></a>01981         <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a097b10b28c07237b554c73fbf42a8e9e">gdb_stdlog</a>, <span class="stringliteral">&quot;%s\n&quot;</span>, context-&gt;<a class="code" href="structmi__parse.html#ae875047151207dac2c533978fc572115">command</a>);
<a name="l01982"></a>01982         <span class="comment">/* Call the &quot;console&quot; interpreter.  */</span>
<a name="l01983"></a>01983         argv[0] = <span class="stringliteral">&quot;console&quot;</span>;
<a name="l01984"></a>01984         argv[1] = context-&gt;<a class="code" href="structmi__parse.html#ae875047151207dac2c533978fc572115">command</a>;
<a name="l01985"></a>01985         <a class="code" href="mi-cmds_8h.html#a9a4db220f38b23313b2dab7670778a7c">mi_cmd_interpreter_exec</a> (<span class="stringliteral">&quot;-interpreter-exec&quot;</span>, argv, 2);
<a name="l01986"></a>01986 
<a name="l01987"></a>01987         <span class="comment">/* If we changed interpreters, DON&#39;T print out anything.  */</span>
<a name="l01988"></a>01988         <span class="keywordflow">if</span> (<a class="code" href="interps_8c.html#a4d45481037bf232e3c058c7f386d379a">current_interp_named_p</a> (<a class="code" href="interps_8h.html#a8ef82a15f52b124715117c7dcfbfa829">INTERP_MI</a>)
<a name="l01989"></a>01989             || <a class="code" href="interps_8c.html#a4d45481037bf232e3c058c7f386d379a">current_interp_named_p</a> (<a class="code" href="interps_8h.html#aaa97c8c73c091bcc516f07ded3c74d34">INTERP_MI1</a>)
<a name="l01990"></a>01990             || <a class="code" href="interps_8c.html#a4d45481037bf232e3c058c7f386d379a">current_interp_named_p</a> (<a class="code" href="interps_8h.html#a0afb639c3352bbe39c403870a94b12c4">INTERP_MI2</a>)
<a name="l01991"></a>01991             || <a class="code" href="interps_8c.html#a4d45481037bf232e3c058c7f386d379a">current_interp_named_p</a> (<a class="code" href="interps_8h.html#aa4032fae75b2d0583f79c5c2221727bf">INTERP_MI3</a>))
<a name="l01992"></a>01992           {
<a name="l01993"></a>01993             <span class="keywordflow">if</span> (!<a class="code" href="mi-main_8c.html#a974a29ac0dd1dbabd96ff5f85e378419">running_result_record_printed</a>)
<a name="l01994"></a>01994               {
<a name="l01995"></a>01995                 <a class="code" href="ui-file_8c.html#aae3b905f888b1dcdce586f77b9554153">fputs_unfiltered</a> (context-&gt;<a class="code" href="structmi__parse.html#ab717580dd67552e6a72df84ae00ffe65">token</a>, <a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);
<a name="l01996"></a>01996                 <a class="code" href="ui-file_8c.html#aae3b905f888b1dcdce586f77b9554153">fputs_unfiltered</a> (<span class="stringliteral">&quot;^done&quot;</span>, <a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);
<a name="l01997"></a>01997                 <a class="code" href="mi-out_8c.html#a395eec86cb794425014fa789e78d18f9">mi_out_put</a> (uiout, <a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);
<a name="l01998"></a>01998                 <a class="code" href="mi-out_8c.html#a5586f83db70f70a26abc03703c9b177e">mi_out_rewind</a> (uiout);
<a name="l01999"></a>01999                 <a class="code" href="mi-main_8c.html#a000d4dec4db900d06f900cfde3eb1f93">mi_print_timing_maybe</a> ();
<a name="l02000"></a>02000                 <a class="code" href="ui-file_8c.html#aae3b905f888b1dcdce586f77b9554153">fputs_unfiltered</a> (<span class="stringliteral">&quot;\n&quot;</span>, <a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);            
<a name="l02001"></a>02001               }
<a name="l02002"></a>02002             <span class="keywordflow">else</span>
<a name="l02003"></a>02003               <a class="code" href="mi-out_8c.html#a5586f83db70f70a26abc03703c9b177e">mi_out_rewind</a> (uiout);
<a name="l02004"></a>02004           }
<a name="l02005"></a>02005         <span class="keywordflow">break</span>;
<a name="l02006"></a>02006       }
<a name="l02007"></a>02007     }
<a name="l02008"></a>02008 
<a name="l02009"></a>02009   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup);
<a name="l02010"></a>02010 }
<a name="l02011"></a>02011 
<a name="l02012"></a>02012 <span class="comment">/* Print a gdb exception to the MI output stream.  */</span>
<a name="l02013"></a>02013 
<a name="l02014"></a>02014 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02015"></a>02015 mi_print_exception (<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="m2-exp_8c.html#a8abb7e972adc09624edab301e021dc5f">token</a>, <span class="keyword">struct</span> <a class="code" href="structgdb__exception.html">gdb_exception</a> exception)
<a name="l02016"></a>02016 {
<a name="l02017"></a>02017   <a class="code" href="ui-file_8c.html#aae3b905f888b1dcdce586f77b9554153">fputs_unfiltered</a> (token, <a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);
<a name="l02018"></a>02018   <a class="code" href="ui-file_8c.html#aae3b905f888b1dcdce586f77b9554153">fputs_unfiltered</a> (<span class="stringliteral">&quot;^error,msg=\&quot;&quot;</span>, <a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);
<a name="l02019"></a>02019   <span class="keywordflow">if</span> (exception.<a class="code" href="structgdb__exception.html#a7f57f80c4d36200d121cee8cce513e5f">message</a> == NULL)
<a name="l02020"></a>02020     <a class="code" href="ui-file_8c.html#aae3b905f888b1dcdce586f77b9554153">fputs_unfiltered</a> (<span class="stringliteral">&quot;unknown error&quot;</span>, <a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);
<a name="l02021"></a>02021   <span class="keywordflow">else</span>
<a name="l02022"></a>02022     <a class="code" href="utils_8c.html#ab629df33d4f46809fe42be4de5b4cab4">fputstr_unfiltered</a> (exception.<a class="code" href="structgdb__exception.html#a7f57f80c4d36200d121cee8cce513e5f">message</a>, <span class="charliteral">&#39;&quot;&#39;</span>, <a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);
<a name="l02023"></a>02023   <a class="code" href="ui-file_8c.html#aae3b905f888b1dcdce586f77b9554153">fputs_unfiltered</a> (<span class="stringliteral">&quot;\&quot;\n&quot;</span>, <a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);
<a name="l02024"></a>02024 }
<a name="l02025"></a>02025 
<a name="l02026"></a>02026 <span class="keywordtype">void</span>
<a name="l02027"></a><a class="code" href="mi-main_8c.html#ac7b7e16aaef3a6955fdd2c8c6a022d15">02027</a> <a class="code" href="mi-cmds_8h.html#ac7b7e16aaef3a6955fdd2c8c6a022d15">mi_execute_command</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *cmd, <span class="keywordtype">int</span> from_tty)
<a name="l02028"></a>02028 {
<a name="l02029"></a>02029   <span class="keywordtype">char</span> *<a class="code" href="m2-exp_8c.html#a8abb7e972adc09624edab301e021dc5f">token</a>;
<a name="l02030"></a>02030   <span class="keyword">struct </span><a class="code" href="structmi__parse.html">mi_parse</a> *<a class="code" href="structmi__parse.html#ae875047151207dac2c533978fc572115">command</a> = NULL;
<a name="l02031"></a>02031   <span class="keyword">volatile</span> <span class="keyword">struct </span><a class="code" href="structgdb__exception.html">gdb_exception</a> exception;
<a name="l02032"></a>02032 
<a name="l02033"></a>02033   <span class="comment">/* This is to handle EOF (^D). We just quit gdb.  */</span>
<a name="l02034"></a>02034   <span class="comment">/* FIXME: we should call some API function here.  */</span>
<a name="l02035"></a>02035   <span class="keywordflow">if</span> (cmd == 0)
<a name="l02036"></a>02036     <a class="code" href="top_8c.html#a9b81bdd279e1b463def08b40b70853bb">quit_force</a> (NULL, from_tty);
<a name="l02037"></a>02037 
<a name="l02038"></a>02038   <a class="code" href="target_8h.html#ab4547ca4a306cdcf484e863f56f8d210">target_log_command</a> (cmd);
<a name="l02039"></a>02039 
<a name="l02040"></a>02040   <a class="code" href="exceptions_8h.html#aef4514ee39b9305fddee27f49c7c34eb">TRY_CATCH</a> (exception, <a class="code" href="exceptions_8h.html#abfa3a3b99557b11f5766baf69465fdf6ab50fde886a7de8c013bf2bd4e7c073a4">RETURN_MASK_ALL</a>)
<a name="l02041"></a>02041     {
<a name="l02042"></a>02042       command = <a class="code" href="mi-parse_8c.html#ad1c114289ace1b7b3618157ae2183971">mi_parse</a> (cmd, &amp;token);
<a name="l02043"></a>02043     }
<a name="l02044"></a>02044   <span class="keywordflow">if</span> (exception.<a class="code" href="structgdb__exception.html#ae0e14189c63f830024865d557c1122cc">reason</a> &lt; 0)
<a name="l02045"></a>02045     {
<a name="l02046"></a>02046       mi_print_exception (token, exception);
<a name="l02047"></a>02047       <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (token);
<a name="l02048"></a>02048     }
<a name="l02049"></a>02049   <span class="keywordflow">else</span>
<a name="l02050"></a>02050     {
<a name="l02051"></a>02051       <span class="keyword">volatile</span> <span class="keyword">struct </span><a class="code" href="structgdb__exception.html">gdb_exception</a> result;
<a name="l02052"></a>02052       <a class="code" href="structptid.html">ptid_t</a> previous_ptid = <a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>;
<a name="l02053"></a>02053 
<a name="l02054"></a>02054       command-&gt;<a class="code" href="structmi__parse.html#ab717580dd67552e6a72df84ae00ffe65">token</a> = <a class="code" href="m2-exp_8c.html#a8abb7e972adc09624edab301e021dc5f">token</a>;
<a name="l02055"></a>02055 
<a name="l02056"></a>02056       <span class="keywordflow">if</span> (do_timings)
<a name="l02057"></a>02057         {
<a name="l02058"></a>02058           command-&gt;<a class="code" href="structmi__parse.html#a3e1add4fa3c621d6ce4b4051df968a47">cmd_start</a> = (<span class="keyword">struct </span><a class="code" href="structmi__timestamp.html">mi_timestamp</a> *)
<a name="l02059"></a>02059             <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (<span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structmi__timestamp.html">mi_timestamp</a>));
<a name="l02060"></a>02060           timestamp (command-&gt;<a class="code" href="structmi__parse.html#a3e1add4fa3c621d6ce4b4051df968a47">cmd_start</a>);
<a name="l02061"></a>02061         }
<a name="l02062"></a>02062 
<a name="l02063"></a>02063       <a class="code" href="exceptions_8h.html#aef4514ee39b9305fddee27f49c7c34eb">TRY_CATCH</a> (result, <a class="code" href="exceptions_8h.html#abfa3a3b99557b11f5766baf69465fdf6ab50fde886a7de8c013bf2bd4e7c073a4">RETURN_MASK_ALL</a>)
<a name="l02064"></a>02064         {
<a name="l02065"></a>02065           captured_mi_execute_command (<a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>, command);
<a name="l02066"></a>02066         }
<a name="l02067"></a>02067       <span class="keywordflow">if</span> (result.<a class="code" href="structgdb__exception.html#ae0e14189c63f830024865d557c1122cc">reason</a> &lt; 0)
<a name="l02068"></a>02068         {
<a name="l02069"></a>02069           <span class="comment">/* The command execution failed and error() was called</span>
<a name="l02070"></a>02070 <span class="comment">             somewhere.  */</span>
<a name="l02071"></a>02071           mi_print_exception (command-&gt;<a class="code" href="structmi__parse.html#ab717580dd67552e6a72df84ae00ffe65">token</a>, result);
<a name="l02072"></a>02072           <a class="code" href="mi-out_8c.html#a5586f83db70f70a26abc03703c9b177e">mi_out_rewind</a> (<a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>);
<a name="l02073"></a>02073         }
<a name="l02074"></a>02074 
<a name="l02075"></a>02075       <a class="code" href="breakpoint_8c.html#a79945bcb0451d40f8a21f2d2c266e4d6">bpstat_do_actions</a> ();
<a name="l02076"></a>02076 
<a name="l02077"></a>02077       <span class="keywordflow">if</span> (<span class="comment">/* The notifications are only output when the top-level</span>
<a name="l02078"></a>02078 <span class="comment">             interpreter (specified on the command line) is MI.  */</span>      
<a name="l02079"></a>02079           <a class="code" href="ui-out_8c.html#a473db54efcfbc60feeb5a4f54f27af46">ui_out_is_mi_like_p</a> (<a class="code" href="interps_8c.html#a8e9dd8dc026ec4b76ae0c0a27a97383d">interp_ui_out</a> (<a class="code" href="interps_8c.html#a55d2f9afbe93d6b241b23fdffb5f17a4">top_level_interpreter</a> ()))
<a name="l02080"></a>02080           <span class="comment">/* Don&#39;t try report anything if there are no threads -- </span>
<a name="l02081"></a>02081 <span class="comment">             the program is dead.  */</span>
<a name="l02082"></a>02082           &amp;&amp; <a class="code" href="gdbthread_8h.html#a1b936e50d518844f9b9b8e09a6dc9a7d">thread_count</a> () != 0
<a name="l02083"></a>02083           <span class="comment">/* -thread-select explicitly changes thread. If frontend uses that</span>
<a name="l02084"></a>02084 <span class="comment">             internally, we don&#39;t want to emit =thread-selected, since</span>
<a name="l02085"></a>02085 <span class="comment">             =thread-selected is supposed to indicate user&#39;s intentions.  */</span>
<a name="l02086"></a>02086           &amp;&amp; strcmp (command-&gt;<a class="code" href="structmi__parse.html#ae875047151207dac2c533978fc572115">command</a>, <span class="stringliteral">&quot;thread-select&quot;</span>) != 0)
<a name="l02087"></a>02087         {
<a name="l02088"></a>02088           <span class="keyword">struct </span><a class="code" href="structmi__interp.html">mi_interp</a> *mi = <a class="code" href="interps_8c.html#a045aa3f9489496bd379f36c7ace015cf">top_level_interpreter_data</a> ();
<a name="l02089"></a>02089           <span class="keywordtype">int</span> report_change = 0;
<a name="l02090"></a>02090 
<a name="l02091"></a>02091           <span class="keywordflow">if</span> (command-&gt;<a class="code" href="structmi__parse.html#af7814daf1bca73119bdcedf715f1fe71">thread</a> == -1)
<a name="l02092"></a>02092             {
<a name="l02093"></a>02093               report_change = (!<a class="code" href="ptid_8c.html#a0df58c8db2620a2cec647934b4f77266">ptid_equal</a> (previous_ptid, <a class="code" href="ptid_8c.html#acba69c857786546b204883bbcc90a64e">null_ptid</a>)
<a name="l02094"></a>02094                                &amp;&amp; !<a class="code" href="ptid_8c.html#a0df58c8db2620a2cec647934b4f77266">ptid_equal</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>, previous_ptid)
<a name="l02095"></a>02095                                &amp;&amp; !<a class="code" href="ptid_8c.html#a0df58c8db2620a2cec647934b4f77266">ptid_equal</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>, <a class="code" href="ptid_8c.html#acba69c857786546b204883bbcc90a64e">null_ptid</a>));
<a name="l02096"></a>02096             }
<a name="l02097"></a>02097           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="ptid_8c.html#a0df58c8db2620a2cec647934b4f77266">ptid_equal</a> (<a class="code" href="infcmd_8c.html#a428c5be9ce5e70bd03760e828e19c6b7">inferior_ptid</a>, <a class="code" href="ptid_8c.html#acba69c857786546b204883bbcc90a64e">null_ptid</a>))
<a name="l02098"></a>02098             {
<a name="l02099"></a>02099               <span class="keyword">struct </span><a class="code" href="structthread__info.html">thread_info</a> *ti = <a class="code" href="gdbthread_8h.html#a668af1dd99cac24599dc0f3ef6458924">inferior_thread</a> ();
<a name="l02100"></a>02100 
<a name="l02101"></a>02101               report_change = (ti-&gt;<a class="code" href="structthread__info.html#a64accc7e3d39da1d926c23877f9f9d0d">num</a> != command-&gt;<a class="code" href="structmi__parse.html#af7814daf1bca73119bdcedf715f1fe71">thread</a>);
<a name="l02102"></a>02102             }
<a name="l02103"></a>02103 
<a name="l02104"></a>02104           <span class="keywordflow">if</span> (report_change)
<a name="l02105"></a>02105             {     
<a name="l02106"></a>02106               <span class="keyword">struct </span><a class="code" href="structthread__info.html">thread_info</a> *ti = <a class="code" href="gdbthread_8h.html#a668af1dd99cac24599dc0f3ef6458924">inferior_thread</a> ();
<a name="l02107"></a>02107 
<a name="l02108"></a>02108               <a class="code" href="target_8h.html#a7128a26aa3c50e663201b4a6633636fe">target_terminal_ours</a> ();
<a name="l02109"></a>02109               <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (mi-&gt;<a class="code" href="structmi__interp.html#a9789f994da11c82cd9217afb3355c28b">event_channel</a>, 
<a name="l02110"></a>02110                                   <span class="stringliteral">&quot;thread-selected,id=\&quot;%d\&quot;&quot;</span>,
<a name="l02111"></a>02111                                   ti-&gt;<a class="code" href="structthread__info.html#a64accc7e3d39da1d926c23877f9f9d0d">num</a>);
<a name="l02112"></a>02112               <a class="code" href="ui-file_8c.html#a046f07b5ef1bcc35c28b4be983e39998">gdb_flush</a> (mi-&gt;<a class="code" href="structmi__interp.html#a9789f994da11c82cd9217afb3355c28b">event_channel</a>);
<a name="l02113"></a>02113             }
<a name="l02114"></a>02114         }
<a name="l02115"></a>02115 
<a name="l02116"></a>02116       <a class="code" href="mi-parse_8c.html#a882932f1e6383913a2c16ac97d7cf794">mi_parse_free</a> (command);
<a name="l02117"></a>02117     }
<a name="l02118"></a>02118 }
<a name="l02119"></a>02119 
<a name="l02120"></a>02120 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02121"></a>02121 mi_cmd_execute (<span class="keyword">struct</span> <a class="code" href="structmi__parse.html">mi_parse</a> *parse)
<a name="l02122"></a>02122 {
<a name="l02123"></a>02123   <span class="keyword">struct </span>cleanup *cleanup;
<a name="l02124"></a>02124 
<a name="l02125"></a>02125   cleanup = <a class="code" href="top_8c.html#a86d6b8ddea84be908c7be8e56f5e5dcd">prepare_execute_command</a> ();
<a name="l02126"></a>02126 
<a name="l02127"></a>02127   <span class="keywordflow">if</span> (parse-&gt;<a class="code" href="structmi__parse.html#a506e97d5a305357f6e6800dad1dd0c3c">all</a> &amp;&amp; parse-&gt;<a class="code" href="structmi__parse.html#a7ae59f1e586fbea831da584650ebb9c1">thread_group</a> != -1)
<a name="l02128"></a>02128     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Cannot specify --thread-group together with --all&quot;</span>));
<a name="l02129"></a>02129 
<a name="l02130"></a>02130   <span class="keywordflow">if</span> (parse-&gt;<a class="code" href="structmi__parse.html#a506e97d5a305357f6e6800dad1dd0c3c">all</a> &amp;&amp; parse-&gt;<a class="code" href="structmi__parse.html#af7814daf1bca73119bdcedf715f1fe71">thread</a> != -1)
<a name="l02131"></a>02131     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Cannot specify --thread together with --all&quot;</span>));
<a name="l02132"></a>02132 
<a name="l02133"></a>02133   <span class="keywordflow">if</span> (parse-&gt;<a class="code" href="structmi__parse.html#a7ae59f1e586fbea831da584650ebb9c1">thread_group</a> != -1 &amp;&amp; parse-&gt;<a class="code" href="structmi__parse.html#af7814daf1bca73119bdcedf715f1fe71">thread</a> != -1)
<a name="l02134"></a>02134     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Cannot specify --thread together with --thread-group&quot;</span>));
<a name="l02135"></a>02135 
<a name="l02136"></a>02136   <span class="keywordflow">if</span> (parse-&gt;<a class="code" href="structmi__parse.html#aa762c6650ce543ad774d6c71627fbdb7">frame</a> != -1 &amp;&amp; parse-&gt;<a class="code" href="structmi__parse.html#af7814daf1bca73119bdcedf715f1fe71">thread</a> == -1)
<a name="l02137"></a>02137     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Cannot specify --frame without --thread&quot;</span>));
<a name="l02138"></a>02138 
<a name="l02139"></a>02139   <span class="keywordflow">if</span> (parse-&gt;<a class="code" href="structmi__parse.html#a7ae59f1e586fbea831da584650ebb9c1">thread_group</a> != -1)
<a name="l02140"></a>02140     {
<a name="l02141"></a>02141       <span class="keyword">struct </span>inferior *inf = <a class="code" href="inferior_8c.html#a3522179a3919bac51a689cb3c0ad98f5">find_inferior_id</a> (parse-&gt;<a class="code" href="structmi__parse.html#a7ae59f1e586fbea831da584650ebb9c1">thread_group</a>);
<a name="l02142"></a>02142       <span class="keyword">struct </span><a class="code" href="structthread__info.html">thread_info</a> *tp = 0;
<a name="l02143"></a>02143 
<a name="l02144"></a>02144       <span class="keywordflow">if</span> (!inf)
<a name="l02145"></a>02145         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Invalid thread group for the --thread-group option&quot;</span>));
<a name="l02146"></a>02146 
<a name="l02147"></a>02147       <a class="code" href="inferior_8c.html#a5e82a0bf51f4554e1e639c7b48de5e57">set_current_inferior</a> (inf);
<a name="l02148"></a>02148       <span class="comment">/* This behaviour means that if --thread-group option identifies</span>
<a name="l02149"></a>02149 <span class="comment">         an inferior with multiple threads, then a random one will be</span>
<a name="l02150"></a>02150 <span class="comment">         picked.  This is not a problem -- frontend should always</span>
<a name="l02151"></a>02151 <span class="comment">         provide --thread if it wishes to operate on a specific</span>
<a name="l02152"></a>02152 <span class="comment">         thread.  */</span>
<a name="l02153"></a>02153       <span class="keywordflow">if</span> (inf-&gt;<a class="code" href="structinferior.html#a1be87f581dbb6c893dbe1f2ff701636a">pid</a> != 0)
<a name="l02154"></a>02154         tp = <a class="code" href="gdbthread_8h.html#a57e86f519208adb580413258d6992f85">any_live_thread_of_process</a> (inf-&gt;<a class="code" href="structinferior.html#a1be87f581dbb6c893dbe1f2ff701636a">pid</a>);
<a name="l02155"></a>02155       <a class="code" href="gdbthread_8h.html#aee26ee8d9825599b321b73d2ecb5ac54">switch_to_thread</a> (tp ? tp-&gt;<a class="code" href="structthread__info.html#a533aa3979b60affd446e9fbff93fdd2c">ptid</a> : <a class="code" href="ptid_8c.html#acba69c857786546b204883bbcc90a64e">null_ptid</a>);
<a name="l02156"></a>02156       <a class="code" href="progspace_8c.html#a394457638b3e584a3ecd019df372209f">set_current_program_space</a> (inf-&gt;<a class="code" href="structinferior.html#afc6a557206fd753b89e34bd33e038cfe">pspace</a>);
<a name="l02157"></a>02157     }
<a name="l02158"></a>02158 
<a name="l02159"></a>02159   <span class="keywordflow">if</span> (parse-&gt;<a class="code" href="structmi__parse.html#af7814daf1bca73119bdcedf715f1fe71">thread</a> != -1)
<a name="l02160"></a>02160     {
<a name="l02161"></a>02161       <span class="keyword">struct </span><a class="code" href="structthread__info.html">thread_info</a> *tp = <a class="code" href="gdbthread_8h.html#aa42b391e60deba0c8c4c2ef4496334f0">find_thread_id</a> (parse-&gt;<a class="code" href="structmi__parse.html#af7814daf1bca73119bdcedf715f1fe71">thread</a>);
<a name="l02162"></a>02162 
<a name="l02163"></a>02163       <span class="keywordflow">if</span> (!tp)
<a name="l02164"></a>02164         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Invalid thread id: %d&quot;</span>), parse-&gt;<a class="code" href="structmi__parse.html#af7814daf1bca73119bdcedf715f1fe71">thread</a>);
<a name="l02165"></a>02165 
<a name="l02166"></a>02166       <span class="keywordflow">if</span> (<a class="code" href="gdbthread_8h.html#a4b919e1603e4636f9bc421f4a89c1d5d">is_exited</a> (tp-&gt;<a class="code" href="structthread__info.html#a533aa3979b60affd446e9fbff93fdd2c">ptid</a>))
<a name="l02167"></a>02167         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Thread id: %d has terminated&quot;</span>), parse-&gt;<a class="code" href="structmi__parse.html#af7814daf1bca73119bdcedf715f1fe71">thread</a>);
<a name="l02168"></a>02168 
<a name="l02169"></a>02169       <a class="code" href="gdbthread_8h.html#aee26ee8d9825599b321b73d2ecb5ac54">switch_to_thread</a> (tp-&gt;<a class="code" href="structthread__info.html#a533aa3979b60affd446e9fbff93fdd2c">ptid</a>);
<a name="l02170"></a>02170     }
<a name="l02171"></a>02171 
<a name="l02172"></a>02172   <span class="keywordflow">if</span> (parse-&gt;<a class="code" href="structmi__parse.html#aa762c6650ce543ad774d6c71627fbdb7">frame</a> != -1)
<a name="l02173"></a>02173     {
<a name="l02174"></a>02174       <span class="keyword">struct </span>frame_info *fid;
<a name="l02175"></a>02175       <span class="keywordtype">int</span> frame = parse-&gt;<a class="code" href="structmi__parse.html#aa762c6650ce543ad774d6c71627fbdb7">frame</a>;
<a name="l02176"></a>02176 
<a name="l02177"></a>02177       fid = <a class="code" href="frame_8h.html#a11bc71bb842ee9f30b990aec07f4399a">find_relative_frame</a> (<a class="code" href="frame_8c.html#a5ab254510728049878a232ed1b889820">get_current_frame</a> (), &amp;frame);
<a name="l02178"></a>02178       <span class="keywordflow">if</span> (frame == 0)
<a name="l02179"></a>02179         <span class="comment">/* find_relative_frame was successful */</span>
<a name="l02180"></a>02180         <a class="code" href="frame_8c.html#a400fa273ac86863322cdc65683ef2356">select_frame</a> (fid);
<a name="l02181"></a>02181       <span class="keywordflow">else</span>
<a name="l02182"></a>02182         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Invalid frame id: %d&quot;</span>), frame);
<a name="l02183"></a>02183     }
<a name="l02184"></a>02184 
<a name="l02185"></a>02185   current_context = parse;
<a name="l02186"></a>02186 
<a name="l02187"></a>02187   <span class="keywordflow">if</span> (parse-&gt;<a class="code" href="structmi__parse.html#a3fa5f533f6ec4666256acb88f33a4c11">cmd</a>-&gt;<a class="code" href="structmi__cmd.html#ac7313919b498c0006fef18bf235b3251">suppress_notification</a> != NULL)
<a name="l02188"></a>02188     {
<a name="l02189"></a>02189       <a class="code" href="utils_8c.html#aa4b9e7f0b6abb5f93fc0ac366f7614c0">make_cleanup_restore_integer</a> (parse-&gt;<a class="code" href="structmi__parse.html#a3fa5f533f6ec4666256acb88f33a4c11">cmd</a>-&gt;<a class="code" href="structmi__cmd.html#ac7313919b498c0006fef18bf235b3251">suppress_notification</a>);
<a name="l02190"></a>02190       *parse-&gt;<a class="code" href="structmi__parse.html#a3fa5f533f6ec4666256acb88f33a4c11">cmd</a>-&gt;<a class="code" href="structmi__cmd.html#ac7313919b498c0006fef18bf235b3251">suppress_notification</a> = 1;
<a name="l02191"></a>02191     }
<a name="l02192"></a>02192 
<a name="l02193"></a>02193   <span class="keywordflow">if</span> (parse-&gt;<a class="code" href="structmi__parse.html#a3fa5f533f6ec4666256acb88f33a4c11">cmd</a>-&gt;<a class="code" href="structmi__cmd.html#a2094dba418c8a624920c9524ab795419">argv_func</a> != NULL)
<a name="l02194"></a>02194     {
<a name="l02195"></a>02195       parse-&gt;<a class="code" href="structmi__parse.html#a3fa5f533f6ec4666256acb88f33a4c11">cmd</a>-&gt;<a class="code" href="structmi__cmd.html#a2094dba418c8a624920c9524ab795419">argv_func</a> (parse-&gt;<a class="code" href="structmi__parse.html#ae875047151207dac2c533978fc572115">command</a>, parse-&gt;<a class="code" href="structmi__parse.html#a2caa41cd025f3b2e6ad7e35be03e2f24">argv</a>, parse-&gt;<a class="code" href="structmi__parse.html#a6c0ecf896befd0f1d67c0c304a1f7b99">argc</a>);
<a name="l02196"></a>02196     }
<a name="l02197"></a>02197   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (parse-&gt;<a class="code" href="structmi__parse.html#a3fa5f533f6ec4666256acb88f33a4c11">cmd</a>-&gt;<a class="code" href="structmi__cmd.html#a5fba15affa72e64e8a6ad82a6b894aec">cli</a>.<a class="code" href="structmi__cli.html#a6800d36a7c2591454b2c52af4f4339ac">cmd</a> != 0)
<a name="l02198"></a>02198     {
<a name="l02199"></a>02199       <span class="comment">/* FIXME: DELETE THIS. */</span>
<a name="l02200"></a>02200       <span class="comment">/* The operation is still implemented by a cli command.  */</span>
<a name="l02201"></a>02201       <span class="comment">/* Must be a synchronous one.  */</span>
<a name="l02202"></a>02202       mi_execute_cli_command (parse-&gt;<a class="code" href="structmi__parse.html#a3fa5f533f6ec4666256acb88f33a4c11">cmd</a>-&gt;<a class="code" href="structmi__cmd.html#a5fba15affa72e64e8a6ad82a6b894aec">cli</a>.<a class="code" href="structmi__cli.html#a6800d36a7c2591454b2c52af4f4339ac">cmd</a>, parse-&gt;<a class="code" href="structmi__parse.html#a3fa5f533f6ec4666256acb88f33a4c11">cmd</a>-&gt;<a class="code" href="structmi__cmd.html#a5fba15affa72e64e8a6ad82a6b894aec">cli</a>.<a class="code" href="structmi__cli.html#a3c1b12256339f2c8a17c70f493bbde1a">args_p</a>,
<a name="l02203"></a>02203                               parse-&gt;<a class="code" href="structmi__parse.html#a2a3b25c334a4baddc6185fed4cb90c78">args</a>);
<a name="l02204"></a>02204     }
<a name="l02205"></a>02205   <span class="keywordflow">else</span>
<a name="l02206"></a>02206     {
<a name="l02207"></a>02207       <span class="comment">/* FIXME: DELETE THIS.  */</span>
<a name="l02208"></a>02208       <span class="keyword">struct </span>ui_file *stb;
<a name="l02209"></a>02209 
<a name="l02210"></a>02210       stb = <a class="code" href="ui-file_8c.html#a340771735f105582d314e191a399a45c">mem_fileopen</a> ();
<a name="l02211"></a>02211 
<a name="l02212"></a>02212       <a class="code" href="ui-file_8c.html#aae3b905f888b1dcdce586f77b9554153">fputs_unfiltered</a> (<span class="stringliteral">&quot;Undefined mi command: &quot;</span>, stb);
<a name="l02213"></a>02213       <a class="code" href="utils_8c.html#ab629df33d4f46809fe42be4de5b4cab4">fputstr_unfiltered</a> (parse-&gt;<a class="code" href="structmi__parse.html#ae875047151207dac2c533978fc572115">command</a>, <span class="charliteral">&#39;&quot;&#39;</span>, stb);
<a name="l02214"></a>02214       <a class="code" href="ui-file_8c.html#aae3b905f888b1dcdce586f77b9554153">fputs_unfiltered</a> (<span class="stringliteral">&quot; (missing implementation)&quot;</span>, stb);
<a name="l02215"></a>02215 
<a name="l02216"></a>02216       <a class="code" href="utils_8c.html#a94dc56baeb57791e114136764f7763aa">make_cleanup_ui_file_delete</a> (stb);
<a name="l02217"></a>02217       <a class="code" href="utils_8c.html#a69e8a646c36b9b168a29f57ceb282cec">error_stream</a> (stb);
<a name="l02218"></a>02218     }
<a name="l02219"></a>02219   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup);
<a name="l02220"></a>02220 }
<a name="l02221"></a>02221 
<a name="l02222"></a>02222 <span class="comment">/* FIXME: This is just a hack so we can get some extra commands going.</span>
<a name="l02223"></a>02223 <span class="comment">   We don&#39;t want to channel things through the CLI, but call libgdb directly.</span>
<a name="l02224"></a>02224 <span class="comment">   Use only for synchronous commands.  */</span>
<a name="l02225"></a>02225 
<a name="l02226"></a>02226 <span class="keywordtype">void</span>
<a name="l02227"></a>02227 mi_execute_cli_command (<span class="keyword">const</span> <span class="keywordtype">char</span> *cmd, <span class="keywordtype">int</span> args_p, <span class="keyword">const</span> <span class="keywordtype">char</span> *args)
<a name="l02228"></a>02228 {
<a name="l02229"></a>02229   <span class="keywordflow">if</span> (cmd != 0)
<a name="l02230"></a>02230     {
<a name="l02231"></a>02231       <span class="keyword">struct </span>cleanup *old_cleanups;
<a name="l02232"></a>02232       <span class="keywordtype">char</span> *run;
<a name="l02233"></a>02233 
<a name="l02234"></a>02234       <span class="keywordflow">if</span> (args_p)
<a name="l02235"></a>02235         run = <a class="code" href="common-utils_8c.html#ab9bf7e1b4e68bdd0078e9e1e55c62cec">xstrprintf</a> (<span class="stringliteral">&quot;%s %s&quot;</span>, cmd, args);
<a name="l02236"></a>02236       <span class="keywordflow">else</span>
<a name="l02237"></a>02237         run = xstrdup (cmd);
<a name="l02238"></a>02238       <span class="keywordflow">if</span> (<a class="code" href="mi-cmds_8h.html#af8ca1d2185e5fbf7cb113d43f0994ae9">mi_debug_p</a>)
<a name="l02239"></a>02239         <span class="comment">/* FIXME: gdb_???? */</span>
<a name="l02240"></a>02240         <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a> (<a class="code" href="main_8c.html#a41a2b997ba5454df787d61f051dd918c">gdb_stdout</a>, <span class="stringliteral">&quot;cli=%s run=%s\n&quot;</span>,
<a name="l02241"></a>02241                             cmd, run);
<a name="l02242"></a>02242       old_cleanups = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, run);
<a name="l02243"></a>02243       <a class="code" href="gdbcmd_8h.html#ac4a1e7a1c71e9c45368a6c32bfe5637d">execute_command</a> (run, 0 <span class="comment">/* from_tty */</span> );
<a name="l02244"></a>02244       <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_cleanups);
<a name="l02245"></a>02245       <span class="keywordflow">return</span>;
<a name="l02246"></a>02246     }
<a name="l02247"></a>02247 }
<a name="l02248"></a>02248 
<a name="l02249"></a>02249 <span class="keywordtype">void</span>
<a name="l02250"></a>02250 mi_execute_async_cli_command (<span class="keywordtype">char</span> *cli_command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l02251"></a>02251 {
<a name="l02252"></a>02252   <span class="keyword">struct </span>cleanup *old_cleanups;
<a name="l02253"></a>02253   <span class="keywordtype">char</span> *run;
<a name="l02254"></a>02254 
<a name="l02255"></a>02255   <span class="keywordflow">if</span> (<a class="code" href="target_8h.html#a2b6015c90130096b2e9757013e49c1e9">target_can_async_p</a> ())
<a name="l02256"></a>02256     run = <a class="code" href="common-utils_8c.html#ab9bf7e1b4e68bdd0078e9e1e55c62cec">xstrprintf</a> (<span class="stringliteral">&quot;%s %s&amp;&quot;</span>, cli_command, argc ? *argv : <span class="stringliteral">&quot;&quot;</span>);
<a name="l02257"></a>02257   <span class="keywordflow">else</span>
<a name="l02258"></a>02258     run = <a class="code" href="common-utils_8c.html#ab9bf7e1b4e68bdd0078e9e1e55c62cec">xstrprintf</a> (<span class="stringliteral">&quot;%s %s&quot;</span>, cli_command, argc ? *argv : <span class="stringliteral">&quot;&quot;</span>);
<a name="l02259"></a>02259   old_cleanups = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, run);  
<a name="l02260"></a>02260 
<a name="l02261"></a>02261   <a class="code" href="gdbcmd_8h.html#ac4a1e7a1c71e9c45368a6c32bfe5637d">execute_command</a> (run, 0 <span class="comment">/* from_tty */</span> );
<a name="l02262"></a>02262 
<a name="l02263"></a>02263   <span class="comment">/* Do this before doing any printing.  It would appear that some</span>
<a name="l02264"></a>02264 <span class="comment">     print code leaves garbage around in the buffer.  */</span>
<a name="l02265"></a>02265   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_cleanups);
<a name="l02266"></a>02266 }
<a name="l02267"></a>02267 
<a name="l02268"></a>02268 <span class="keywordtype">void</span>
<a name="l02269"></a><a class="code" href="mi-main_8h.html#a0753a905a014fa59648704e1e6f9f51a">02269</a> <a class="code" href="mi-main_8c.html#a0753a905a014fa59648704e1e6f9f51a">mi_load_progress</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *section_name,
<a name="l02270"></a>02270                   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> sent_so_far,
<a name="l02271"></a>02271                   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> total_section,
<a name="l02272"></a>02272                   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> total_sent,
<a name="l02273"></a>02273                   <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> grand_total)
<a name="l02274"></a>02274 {
<a name="l02275"></a>02275   <span class="keyword">struct </span>timeval time_now, delta, update_threshold;
<a name="l02276"></a>02276   <span class="keyword">static</span> <span class="keyword">struct </span>timeval last_update;
<a name="l02277"></a>02277   <span class="keyword">static</span> <span class="keywordtype">char</span> *previous_sect_name = NULL;
<a name="l02278"></a>02278   <span class="keywordtype">int</span> new_section;
<a name="l02279"></a>02279   <span class="keyword">struct </span>ui_out *saved_uiout;
<a name="l02280"></a>02280   <span class="keyword">struct </span>ui_out *uiout;
<a name="l02281"></a>02281 
<a name="l02282"></a>02282   <span class="comment">/* This function is called through deprecated_show_load_progress</span>
<a name="l02283"></a>02283 <span class="comment">     which means uiout may not be correct.  Fix it for the duration</span>
<a name="l02284"></a>02284 <span class="comment">     of this function.  */</span>
<a name="l02285"></a>02285   saved_uiout = <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>;
<a name="l02286"></a>02286 
<a name="l02287"></a>02287   <span class="keywordflow">if</span> (<a class="code" href="interps_8c.html#a4d45481037bf232e3c058c7f386d379a">current_interp_named_p</a> (<a class="code" href="interps_8h.html#a8ef82a15f52b124715117c7dcfbfa829">INTERP_MI</a>)
<a name="l02288"></a>02288       || <a class="code" href="interps_8c.html#a4d45481037bf232e3c058c7f386d379a">current_interp_named_p</a> (<a class="code" href="interps_8h.html#a0afb639c3352bbe39c403870a94b12c4">INTERP_MI2</a>))
<a name="l02289"></a>02289     <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a> = <a class="code" href="mi-out_8c.html#a44a884acb396bcc6a3960b20504542fe">mi_out_new</a> (2);
<a name="l02290"></a>02290   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="interps_8c.html#a4d45481037bf232e3c058c7f386d379a">current_interp_named_p</a> (<a class="code" href="interps_8h.html#aaa97c8c73c091bcc516f07ded3c74d34">INTERP_MI1</a>))
<a name="l02291"></a>02291     <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a> = <a class="code" href="mi-out_8c.html#a44a884acb396bcc6a3960b20504542fe">mi_out_new</a> (1);
<a name="l02292"></a>02292   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="interps_8c.html#a4d45481037bf232e3c058c7f386d379a">current_interp_named_p</a> (<a class="code" href="interps_8h.html#aa4032fae75b2d0583f79c5c2221727bf">INTERP_MI3</a>))
<a name="l02293"></a>02293     <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a> = <a class="code" href="mi-out_8c.html#a44a884acb396bcc6a3960b20504542fe">mi_out_new</a> (3);
<a name="l02294"></a>02294   <span class="keywordflow">else</span>
<a name="l02295"></a>02295     <span class="keywordflow">return</span>;
<a name="l02296"></a>02296 
<a name="l02297"></a>02297   uiout = <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>;
<a name="l02298"></a>02298 
<a name="l02299"></a>02299   update_threshold.tv_sec = 0;
<a name="l02300"></a>02300   update_threshold.tv_usec = 500000;
<a name="l02301"></a>02301   gettimeofday (&amp;time_now, NULL);
<a name="l02302"></a>02302 
<a name="l02303"></a>02303   delta.tv_usec = time_now.tv_usec - last_update.tv_usec;
<a name="l02304"></a>02304   delta.tv_sec = time_now.tv_sec - last_update.tv_sec;
<a name="l02305"></a>02305 
<a name="l02306"></a>02306   <span class="keywordflow">if</span> (delta.tv_usec &lt; 0)
<a name="l02307"></a>02307     {
<a name="l02308"></a>02308       delta.tv_sec -= 1;
<a name="l02309"></a>02309       delta.tv_usec += 1000000<a class="code" href="ia64-tdep_8c.html#aa7fb549cf7936f8264053676ad5a5115aef31cc6fe9479955961311ee18ac205f">L</a>;
<a name="l02310"></a>02310     }
<a name="l02311"></a>02311 
<a name="l02312"></a>02312   new_section = (previous_sect_name ?
<a name="l02313"></a>02313                  strcmp (previous_sect_name, section_name) : 1);
<a name="l02314"></a>02314   <span class="keywordflow">if</span> (new_section)
<a name="l02315"></a>02315     {
<a name="l02316"></a>02316       <span class="keyword">struct </span>cleanup *cleanup_tuple;
<a name="l02317"></a>02317 
<a name="l02318"></a>02318       <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (previous_sect_name);
<a name="l02319"></a>02319       previous_sect_name = xstrdup (section_name);
<a name="l02320"></a>02320 
<a name="l02321"></a>02321       <span class="keywordflow">if</span> (<a class="code" href="mi-main_8c.html#a4f31fe20e2b760c8d54d42910947ef2d">current_token</a>)
<a name="l02322"></a>02322         <a class="code" href="ui-file_8c.html#aae3b905f888b1dcdce586f77b9554153">fputs_unfiltered</a> (<a class="code" href="mi-main_8c.html#a4f31fe20e2b760c8d54d42910947ef2d">current_token</a>, <a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);
<a name="l02323"></a>02323       <a class="code" href="ui-file_8c.html#aae3b905f888b1dcdce586f77b9554153">fputs_unfiltered</a> (<span class="stringliteral">&quot;+download&quot;</span>, <a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);
<a name="l02324"></a>02324       cleanup_tuple = <a class="code" href="ui-out_8c.html#aaf5a0c991d74ad2e486f420d5c2ff058">make_cleanup_ui_out_tuple_begin_end</a> (uiout, NULL);
<a name="l02325"></a>02325       <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;section&quot;</span>, section_name);
<a name="l02326"></a>02326       <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, <span class="stringliteral">&quot;section-size&quot;</span>, total_section);
<a name="l02327"></a>02327       <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, <span class="stringliteral">&quot;total-size&quot;</span>, grand_total);
<a name="l02328"></a>02328       <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup_tuple);
<a name="l02329"></a>02329       <a class="code" href="mi-out_8c.html#a395eec86cb794425014fa789e78d18f9">mi_out_put</a> (uiout, <a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);
<a name="l02330"></a>02330       <a class="code" href="ui-file_8c.html#aae3b905f888b1dcdce586f77b9554153">fputs_unfiltered</a> (<span class="stringliteral">&quot;\n&quot;</span>, <a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);
<a name="l02331"></a>02331       <a class="code" href="ui-file_8c.html#a046f07b5ef1bcc35c28b4be983e39998">gdb_flush</a> (<a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);
<a name="l02332"></a>02332     }
<a name="l02333"></a>02333 
<a name="l02334"></a>02334   <span class="keywordflow">if</span> (delta.tv_sec &gt;= update_threshold.tv_sec &amp;&amp;
<a name="l02335"></a>02335       delta.tv_usec &gt;= update_threshold.tv_usec)
<a name="l02336"></a>02336     {
<a name="l02337"></a>02337       <span class="keyword">struct </span>cleanup *cleanup_tuple;
<a name="l02338"></a>02338 
<a name="l02339"></a>02339       last_update.tv_sec = time_now.tv_sec;
<a name="l02340"></a>02340       last_update.tv_usec = time_now.tv_usec;
<a name="l02341"></a>02341       <span class="keywordflow">if</span> (<a class="code" href="mi-main_8c.html#a4f31fe20e2b760c8d54d42910947ef2d">current_token</a>)
<a name="l02342"></a>02342         <a class="code" href="ui-file_8c.html#aae3b905f888b1dcdce586f77b9554153">fputs_unfiltered</a> (<a class="code" href="mi-main_8c.html#a4f31fe20e2b760c8d54d42910947ef2d">current_token</a>, <a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);
<a name="l02343"></a>02343       <a class="code" href="ui-file_8c.html#aae3b905f888b1dcdce586f77b9554153">fputs_unfiltered</a> (<span class="stringliteral">&quot;+download&quot;</span>, <a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);
<a name="l02344"></a>02344       cleanup_tuple = <a class="code" href="ui-out_8c.html#aaf5a0c991d74ad2e486f420d5c2ff058">make_cleanup_ui_out_tuple_begin_end</a> (uiout, NULL);
<a name="l02345"></a>02345       <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;section&quot;</span>, section_name);
<a name="l02346"></a>02346       <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, <span class="stringliteral">&quot;section-sent&quot;</span>, sent_so_far);
<a name="l02347"></a>02347       <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, <span class="stringliteral">&quot;section-size&quot;</span>, total_section);
<a name="l02348"></a>02348       <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, <span class="stringliteral">&quot;total-sent&quot;</span>, total_sent);
<a name="l02349"></a>02349       <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, <span class="stringliteral">&quot;total-size&quot;</span>, grand_total);
<a name="l02350"></a>02350       <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup_tuple);
<a name="l02351"></a>02351       <a class="code" href="mi-out_8c.html#a395eec86cb794425014fa789e78d18f9">mi_out_put</a> (uiout, <a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);
<a name="l02352"></a>02352       <a class="code" href="ui-file_8c.html#aae3b905f888b1dcdce586f77b9554153">fputs_unfiltered</a> (<span class="stringliteral">&quot;\n&quot;</span>, <a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);
<a name="l02353"></a>02353       <a class="code" href="ui-file_8c.html#a046f07b5ef1bcc35c28b4be983e39998">gdb_flush</a> (<a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>);
<a name="l02354"></a>02354     }
<a name="l02355"></a>02355 
<a name="l02356"></a>02356   <a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a> (uiout);
<a name="l02357"></a>02357   <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a> = saved_uiout;
<a name="l02358"></a>02358 }
<a name="l02359"></a>02359 
<a name="l02360"></a>02360 <span class="keyword">static</span> <span class="keywordtype">void</span> 
<a name="l02361"></a>02361 timestamp (<span class="keyword">struct</span> <a class="code" href="structmi__timestamp.html">mi_timestamp</a> *tv)
<a name="l02362"></a>02362 {
<a name="l02363"></a>02363   gettimeofday (&amp;tv-&gt;<a class="code" href="structmi__timestamp.html#a6a75dcda2d1707acf8cf7d8c3cd71391">wallclock</a>, NULL);
<a name="l02364"></a>02364 <span class="preprocessor">#ifdef HAVE_GETRUSAGE</span>
<a name="l02365"></a>02365 <span class="preprocessor"></span>  getrusage (RUSAGE_SELF, &amp;rusage);
<a name="l02366"></a>02366   tv-&gt;<a class="code" href="structmi__timestamp.html#a163e8deeae2fb8117e856cc4dfc27c2e">utime</a>.tv_sec = rusage.ru_utime.tv_sec;
<a name="l02367"></a>02367   tv-&gt;<a class="code" href="structmi__timestamp.html#a163e8deeae2fb8117e856cc4dfc27c2e">utime</a>.tv_usec = rusage.ru_utime.tv_usec;
<a name="l02368"></a>02368   tv-&gt;<a class="code" href="structmi__timestamp.html#ae1e1fcad756f25fe2299c4dcc89a64af">stime</a>.tv_sec = rusage.ru_stime.tv_sec;
<a name="l02369"></a>02369   tv-&gt;<a class="code" href="structmi__timestamp.html#ae1e1fcad756f25fe2299c4dcc89a64af">stime</a>.tv_usec = rusage.ru_stime.tv_usec;
<a name="l02370"></a>02370 <span class="preprocessor">#else</span>
<a name="l02371"></a>02371 <span class="preprocessor"></span>  {
<a name="l02372"></a>02372     <span class="keywordtype">long</span> usec = get_run_time ();
<a name="l02373"></a>02373 
<a name="l02374"></a>02374     tv-&gt;<a class="code" href="structmi__timestamp.html#a163e8deeae2fb8117e856cc4dfc27c2e">utime</a>.tv_sec = usec/1000000<a class="code" href="ia64-tdep_8c.html#aa7fb549cf7936f8264053676ad5a5115aef31cc6fe9479955961311ee18ac205f">L</a>;
<a name="l02375"></a>02375     tv-&gt;<a class="code" href="structmi__timestamp.html#a163e8deeae2fb8117e856cc4dfc27c2e">utime</a>.tv_usec = usec - 1000000<a class="code" href="ia64-tdep_8c.html#aa7fb549cf7936f8264053676ad5a5115aef31cc6fe9479955961311ee18ac205f">L</a>*tv-&gt;<a class="code" href="structmi__timestamp.html#a163e8deeae2fb8117e856cc4dfc27c2e">utime</a>.tv_sec;
<a name="l02376"></a>02376     tv-&gt;<a class="code" href="structmi__timestamp.html#ae1e1fcad756f25fe2299c4dcc89a64af">stime</a>.tv_sec = 0;
<a name="l02377"></a>02377     tv-&gt;<a class="code" href="structmi__timestamp.html#ae1e1fcad756f25fe2299c4dcc89a64af">stime</a>.tv_usec = 0;
<a name="l02378"></a>02378   }
<a name="l02379"></a>02379 <span class="preprocessor">#endif</span>
<a name="l02380"></a>02380 <span class="preprocessor"></span>}
<a name="l02381"></a>02381 
<a name="l02382"></a>02382 <span class="keyword">static</span> <span class="keywordtype">void</span> 
<a name="l02383"></a>02383 print_diff_now (<span class="keyword">struct</span> <a class="code" href="structmi__timestamp.html">mi_timestamp</a> *start)
<a name="l02384"></a>02384 {
<a name="l02385"></a>02385   <span class="keyword">struct </span><a class="code" href="structmi__timestamp.html">mi_timestamp</a> now;
<a name="l02386"></a>02386 
<a name="l02387"></a>02387   timestamp (&amp;now);
<a name="l02388"></a>02388   print_diff (start, &amp;now);
<a name="l02389"></a>02389 }
<a name="l02390"></a>02390 
<a name="l02391"></a>02391 <span class="keywordtype">void</span>
<a name="l02392"></a><a class="code" href="mi-main_8h.html#a000d4dec4db900d06f900cfde3eb1f93">02392</a> <a class="code" href="mi-main_8c.html#a000d4dec4db900d06f900cfde3eb1f93">mi_print_timing_maybe</a> (<span class="keywordtype">void</span>)
<a name="l02393"></a>02393 {
<a name="l02394"></a>02394   <span class="comment">/* If the command is -enable-timing then do_timings may be true</span>
<a name="l02395"></a>02395 <span class="comment">     whilst current_command_ts is not initialized.  */</span>
<a name="l02396"></a>02396   <span class="keywordflow">if</span> (do_timings &amp;&amp; current_command_ts)
<a name="l02397"></a>02397     print_diff_now (current_command_ts);
<a name="l02398"></a>02398 }
<a name="l02399"></a>02399 
<a name="l02400"></a>02400 <span class="keyword">static</span> <span class="keywordtype">long</span> 
<a name="l02401"></a>02401 timeval_diff (<span class="keyword">struct</span> timeval start, <span class="keyword">struct</span> timeval end)
<a name="l02402"></a>02402 {
<a name="l02403"></a>02403   <span class="keywordflow">return</span> ((end.tv_sec - start.tv_sec) * 1000000<a class="code" href="ia64-tdep_8c.html#aa7fb549cf7936f8264053676ad5a5115aef31cc6fe9479955961311ee18ac205f">L</a>)
<a name="l02404"></a>02404     + (end.tv_usec - start.tv_usec);
<a name="l02405"></a>02405 }
<a name="l02406"></a>02406 
<a name="l02407"></a>02407 <span class="keyword">static</span> <span class="keywordtype">void</span> 
<a name="l02408"></a>02408 print_diff (<span class="keyword">struct</span> <a class="code" href="structmi__timestamp.html">mi_timestamp</a> *start, <span class="keyword">struct</span> <a class="code" href="structmi__timestamp.html">mi_timestamp</a> *end)
<a name="l02409"></a>02409 {
<a name="l02410"></a>02410   <a class="code" href="utils_8c.html#aa624d49eae7e3e3ee9124fde6c631392">fprintf_unfiltered</a>
<a name="l02411"></a>02411     (<a class="code" href="mi-cmds_8h.html#a291315c01d39483f0026b8a849b70fba">raw_stdout</a>,
<a name="l02412"></a>02412      <span class="stringliteral">&quot;,time={wallclock=\&quot;%0.5f\&quot;,user=\&quot;%0.5f\&quot;,system=\&quot;%0.5f\&quot;}&quot;</span>, 
<a name="l02413"></a>02413      timeval_diff (start-&gt;<a class="code" href="structmi__timestamp.html#a6a75dcda2d1707acf8cf7d8c3cd71391">wallclock</a>, end-&gt;<a class="code" href="structmi__timestamp.html#a6a75dcda2d1707acf8cf7d8c3cd71391">wallclock</a>) / 1000000.0, 
<a name="l02414"></a>02414      timeval_diff (start-&gt;<a class="code" href="structmi__timestamp.html#a163e8deeae2fb8117e856cc4dfc27c2e">utime</a>, end-&gt;<a class="code" href="structmi__timestamp.html#a163e8deeae2fb8117e856cc4dfc27c2e">utime</a>) / 1000000.0, 
<a name="l02415"></a>02415      timeval_diff (start-&gt;<a class="code" href="structmi__timestamp.html#ae1e1fcad756f25fe2299c4dcc89a64af">stime</a>, end-&gt;<a class="code" href="structmi__timestamp.html#ae1e1fcad756f25fe2299c4dcc89a64af">stime</a>) / 1000000.0);
<a name="l02416"></a>02416 }
<a name="l02417"></a>02417 
<a name="l02418"></a>02418 <span class="keywordtype">void</span>
<a name="l02419"></a><a class="code" href="mi-main_8c.html#aea94972f5e090e3cdb0f329308da9352">02419</a> <a class="code" href="mi-cmds_8h.html#ad70d908a004ea4e9ca1da6cac35a7132">mi_cmd_trace_define_variable</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l02420"></a>02420 {
<a name="l02421"></a>02421   <span class="keyword">struct </span><a class="code" href="structexpression.html">expression</a> *expr;
<a name="l02422"></a>02422   <a class="code" href="defs_8h.html#ac7647a3f71533007c9e128f3ddda1987">LONGEST</a> initval = 0;
<a name="l02423"></a>02423   <span class="keyword">struct </span><a class="code" href="structtrace__state__variable.html">trace_state_variable</a> *tsv;
<a name="l02424"></a>02424   <span class="keywordtype">char</span> *<a class="code" href="aarch64-tdep_8c.html#acc128f98d9ceca227038c771308eff39">name</a> = 0;
<a name="l02425"></a>02425 
<a name="l02426"></a>02426   <span class="keywordflow">if</span> (argc != 1 &amp;&amp; argc != 2)
<a name="l02427"></a>02427     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Usage: -trace-define-variable VARIABLE [VALUE]&quot;</span>));
<a name="l02428"></a>02428 
<a name="l02429"></a>02429   name = argv[0];
<a name="l02430"></a>02430   <span class="keywordflow">if</span> (*name++ != <span class="charliteral">&#39;$&#39;</span>)
<a name="l02431"></a>02431     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Name of trace variable should start with &#39;$&#39;&quot;</span>));
<a name="l02432"></a>02432 
<a name="l02433"></a>02433   <a class="code" href="tracepoint_8c.html#a5d6e5deeec055c5e4af55b20e3128cee">validate_trace_state_variable_name</a> (name);
<a name="l02434"></a>02434 
<a name="l02435"></a>02435   tsv = <a class="code" href="tracepoint_8c.html#aa1473f9341eceb0b7988d4c459b99da1">find_trace_state_variable</a> (name);
<a name="l02436"></a>02436   <span class="keywordflow">if</span> (!tsv)
<a name="l02437"></a>02437     tsv = <a class="code" href="tracepoint_8c.html#aa40dd0d7217222beaf2aefa3065c356f">create_trace_state_variable</a> (name);
<a name="l02438"></a>02438 
<a name="l02439"></a>02439   <span class="keywordflow">if</span> (argc == 2)
<a name="l02440"></a>02440     initval = <a class="code" href="value_8c.html#aa95e2692a6e5338edb5db75909064bc1">value_as_long</a> (<a class="code" href="eval_8c.html#a4e744c8c383f947f6e3da4112541c2f7">parse_and_eval</a> (argv[1]));
<a name="l02441"></a>02441 
<a name="l02442"></a>02442   tsv-&gt;<a class="code" href="structtrace__state__variable.html#aa0332c05c03fbfd925ec6b83c7ec21de">initial_value</a> = initval;
<a name="l02443"></a>02443 }
<a name="l02444"></a>02444 
<a name="l02445"></a>02445 <span class="keywordtype">void</span>
<a name="l02446"></a><a class="code" href="mi-main_8c.html#a4bae26b02912cebf77a8a55fb57d3f88">02446</a> <a class="code" href="mi-cmds_8h.html#af670bd7e784210b7237e2b0c70f2d5d0">mi_cmd_trace_list_variables</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l02447"></a>02447 {
<a name="l02448"></a>02448   <span class="keywordflow">if</span> (argc != 0)
<a name="l02449"></a>02449     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;-trace-list-variables: no arguments allowed&quot;</span>));
<a name="l02450"></a>02450 
<a name="l02451"></a>02451   <a class="code" href="tracepoint_8c.html#aa69fcc3d057f311d9838f62b65afd4c8">tvariables_info_1</a> ();
<a name="l02452"></a>02452 }
<a name="l02453"></a>02453 
<a name="l02454"></a>02454 <span class="keywordtype">void</span>
<a name="l02455"></a><a class="code" href="mi-main_8c.html#ad5ef566aad43ba40cf0e78d50749b292">02455</a> <a class="code" href="mi-cmds_8h.html#a7d682e02e380d63ff1a200cb7c3d3d78">mi_cmd_trace_find</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l02456"></a>02456 {
<a name="l02457"></a>02457   <span class="keywordtype">char</span> *mode;
<a name="l02458"></a>02458 
<a name="l02459"></a>02459   <span class="keywordflow">if</span> (argc == 0)
<a name="l02460"></a>02460     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;trace selection mode is required&quot;</span>));
<a name="l02461"></a>02461 
<a name="l02462"></a>02462   mode = argv[0];
<a name="l02463"></a>02463 
<a name="l02464"></a>02464   <span class="keywordflow">if</span> (strcmp (mode, <span class="stringliteral">&quot;none&quot;</span>) == 0)
<a name="l02465"></a>02465     {
<a name="l02466"></a>02466       <a class="code" href="tracepoint_8c.html#a7a8ae2744aacb4e032507bcf90263e5f">tfind_1</a> (<a class="code" href="target_8h.html#a78f5afcdc128cdd336383668a0f296d7a6c059c3daad01c8165dc1a73498408e7">tfind_number</a>, -1, 0, 0, 0);
<a name="l02467"></a>02467       <span class="keywordflow">return</span>;
<a name="l02468"></a>02468     }
<a name="l02469"></a>02469 
<a name="l02470"></a>02470   <span class="keywordflow">if</span> (<a class="code" href="tracepoint_8c.html#af4041987a9ba21b88378bb6a3873baca">current_trace_status</a> ()-&gt;running)
<a name="l02471"></a>02471     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;May not look at trace frames while trace is running.&quot;</span>));
<a name="l02472"></a>02472 
<a name="l02473"></a>02473   <span class="keywordflow">if</span> (strcmp (mode, <span class="stringliteral">&quot;frame-number&quot;</span>) == 0)
<a name="l02474"></a>02474     {
<a name="l02475"></a>02475       <span class="keywordflow">if</span> (argc != 2)
<a name="l02476"></a>02476         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;frame number is required&quot;</span>));
<a name="l02477"></a>02477       <a class="code" href="tracepoint_8c.html#a7a8ae2744aacb4e032507bcf90263e5f">tfind_1</a> (<a class="code" href="target_8h.html#a78f5afcdc128cdd336383668a0f296d7a6c059c3daad01c8165dc1a73498408e7">tfind_number</a>, atoi (argv[1]), 0, 0, 0);
<a name="l02478"></a>02478     }
<a name="l02479"></a>02479   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (mode, <span class="stringliteral">&quot;tracepoint-number&quot;</span>) == 0)
<a name="l02480"></a>02480     {
<a name="l02481"></a>02481       <span class="keywordflow">if</span> (argc != 2)
<a name="l02482"></a>02482         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;tracepoint number is required&quot;</span>));
<a name="l02483"></a>02483       <a class="code" href="tracepoint_8c.html#a7a8ae2744aacb4e032507bcf90263e5f">tfind_1</a> (<a class="code" href="target_8h.html#a78f5afcdc128cdd336383668a0f296d7adec7c45210c9adaf5b4bff37cf713de2">tfind_tp</a>, atoi (argv[1]), 0, 0, 0);
<a name="l02484"></a>02484     }
<a name="l02485"></a>02485   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (mode, <span class="stringliteral">&quot;pc&quot;</span>) == 0)
<a name="l02486"></a>02486     {
<a name="l02487"></a>02487       <span class="keywordflow">if</span> (argc != 2)
<a name="l02488"></a>02488         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;PC is required&quot;</span>));
<a name="l02489"></a>02489       <a class="code" href="tracepoint_8c.html#a7a8ae2744aacb4e032507bcf90263e5f">tfind_1</a> (<a class="code" href="target_8h.html#a78f5afcdc128cdd336383668a0f296d7a4bb077c323c7395699b412e2c73b9855">tfind_pc</a>, 0, <a class="code" href="eval_8c.html#adc1b596b06e274a83197cdeaa0c2809c">parse_and_eval_address</a> (argv[1]), 0, 0);
<a name="l02490"></a>02490     }
<a name="l02491"></a>02491   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (mode, <span class="stringliteral">&quot;pc-inside-range&quot;</span>) == 0)
<a name="l02492"></a>02492     {
<a name="l02493"></a>02493       <span class="keywordflow">if</span> (argc != 3)
<a name="l02494"></a>02494         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Start and end PC are required&quot;</span>));
<a name="l02495"></a>02495       <a class="code" href="tracepoint_8c.html#a7a8ae2744aacb4e032507bcf90263e5f">tfind_1</a> (<a class="code" href="target_8h.html#a78f5afcdc128cdd336383668a0f296d7a8bb5fb54065004f1abad4a8278288c6d">tfind_range</a>, 0, <a class="code" href="eval_8c.html#adc1b596b06e274a83197cdeaa0c2809c">parse_and_eval_address</a> (argv[1]),
<a name="l02496"></a>02496                <a class="code" href="eval_8c.html#adc1b596b06e274a83197cdeaa0c2809c">parse_and_eval_address</a> (argv[2]), 0);
<a name="l02497"></a>02497     }
<a name="l02498"></a>02498   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (mode, <span class="stringliteral">&quot;pc-outside-range&quot;</span>) == 0)
<a name="l02499"></a>02499     {
<a name="l02500"></a>02500       <span class="keywordflow">if</span> (argc != 3)
<a name="l02501"></a>02501         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Start and end PC are required&quot;</span>));
<a name="l02502"></a>02502       <a class="code" href="tracepoint_8c.html#a7a8ae2744aacb4e032507bcf90263e5f">tfind_1</a> (<a class="code" href="target_8h.html#a78f5afcdc128cdd336383668a0f296d7a173984a815b231ae8aff2e0d5c3374d2">tfind_outside</a>, 0, <a class="code" href="eval_8c.html#adc1b596b06e274a83197cdeaa0c2809c">parse_and_eval_address</a> (argv[1]),
<a name="l02503"></a>02503                <a class="code" href="eval_8c.html#adc1b596b06e274a83197cdeaa0c2809c">parse_and_eval_address</a> (argv[2]), 0);
<a name="l02504"></a>02504     }
<a name="l02505"></a>02505   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp (mode, <span class="stringliteral">&quot;line&quot;</span>) == 0)
<a name="l02506"></a>02506     {
<a name="l02507"></a>02507       <span class="keyword">struct </span><a class="code" href="structsymtabs__and__lines.html">symtabs_and_lines</a> sals;
<a name="l02508"></a>02508       <span class="keyword">struct </span><a class="code" href="structsymtab__and__line.html">symtab_and_line</a> sal;
<a name="l02509"></a>02509       <span class="keyword">static</span> <a class="code" href="defs_8h.html#aba5d0eb4e938c80ae1112a4439aaf71a">CORE_ADDR</a> start_pc, end_pc;
<a name="l02510"></a>02510       <span class="keyword">struct </span>cleanup *back_to;
<a name="l02511"></a>02511 
<a name="l02512"></a>02512       <span class="keywordflow">if</span> (argc != 2)
<a name="l02513"></a>02513         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Line is required&quot;</span>));
<a name="l02514"></a>02514 
<a name="l02515"></a>02515       sals = <a class="code" href="linespec_8c.html#a99c1ec5e07db5d8ffc64de454d190650">decode_line_with_current_source</a> (argv[1],
<a name="l02516"></a>02516                                               <a class="code" href="linespec_8h.html#a66db0c56cdf6b7d07a996c374a0572caadb5b3965c89f02bfa79f8871fde72588">DECODE_LINE_FUNFIRSTLINE</a>);
<a name="l02517"></a>02517       back_to = <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, sals.<a class="code" href="structsymtabs__and__lines.html#ab601f48fdf29c3b190ba068f57983df4">sals</a>);
<a name="l02518"></a>02518 
<a name="l02519"></a>02519       sal = sals.<a class="code" href="structsymtabs__and__lines.html#ab601f48fdf29c3b190ba068f57983df4">sals</a>[0];
<a name="l02520"></a>02520 
<a name="l02521"></a>02521       <span class="keywordflow">if</span> (sal.<a class="code" href="structsymtab__and__line.html#a74216e171a96d8bcaab43fe69b49c599">symtab</a> == 0)
<a name="l02522"></a>02522         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Could not find the specified line&quot;</span>));
<a name="l02523"></a>02523 
<a name="l02524"></a>02524       <span class="keywordflow">if</span> (sal.<a class="code" href="structsymtab__and__line.html#a6a0468be675b9ac19a5b3ef26f471eaf">line</a> &gt; 0 &amp;&amp; <a class="code" href="symtab_8c.html#ad7abbdf5f7a0d49ce1b12200beda7d96">find_line_pc_range</a> (sal, &amp;start_pc, &amp;end_pc))
<a name="l02525"></a>02525         <a class="code" href="tracepoint_8c.html#a7a8ae2744aacb4e032507bcf90263e5f">tfind_1</a> (<a class="code" href="target_8h.html#a78f5afcdc128cdd336383668a0f296d7a8bb5fb54065004f1abad4a8278288c6d">tfind_range</a>, 0, start_pc, end_pc - 1, 0);
<a name="l02526"></a>02526       <span class="keywordflow">else</span>
<a name="l02527"></a>02527         <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Could not find the specified line&quot;</span>));
<a name="l02528"></a>02528 
<a name="l02529"></a>02529       <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (back_to);
<a name="l02530"></a>02530     }
<a name="l02531"></a>02531   <span class="keywordflow">else</span>
<a name="l02532"></a>02532     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Invalid mode &#39;%s&#39;&quot;</span>), mode);
<a name="l02533"></a>02533 
<a name="l02534"></a>02534   <span class="keywordflow">if</span> (<a class="code" href="frame_8c.html#ad1e8bd5ac45df219a168640934f891cc">has_stack_frames</a> () || <a class="code" href="tracepoint_8c.html#a3bee6ac8afec52230f5314e1f3025511">get_traceframe_number</a> () &gt;= 0)
<a name="l02535"></a>02535     <a class="code" href="frame_8h.html#a849748a17da39e76cc4648e83c64c344">print_stack_frame</a> (<a class="code" href="frame_8c.html#a8b714a78478670e14a297eba8d1a9915">get_selected_frame</a> (NULL), 1, <a class="code" href="frame_8h.html#a2431f51963af6773c12937f24f7525a4ac928790b2192fa6a3fb9dddb1f6acbf9">LOC_AND_ADDRESS</a>, 1);
<a name="l02536"></a>02536 }
<a name="l02537"></a>02537 
<a name="l02538"></a>02538 <span class="keywordtype">void</span>
<a name="l02539"></a><a class="code" href="mi-main_8c.html#a2c1b91c2c64ebd6975400f85201913fd">02539</a> <a class="code" href="mi-cmds_8h.html#aa2d155d4a8f9b8a84bddde60f5717434">mi_cmd_trace_save</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l02540"></a>02540 {
<a name="l02541"></a>02541   <span class="keywordtype">int</span> target_saves = 0;
<a name="l02542"></a>02542   <span class="keywordtype">int</span> generate_ctf = 0;
<a name="l02543"></a>02543   <span class="keywordtype">char</span> *filename;
<a name="l02544"></a>02544   <span class="keywordtype">int</span> oind = 0;
<a name="l02545"></a>02545   <span class="keywordtype">char</span> *oarg;
<a name="l02546"></a>02546 
<a name="l02547"></a>02547   <span class="keyword">enum</span> opt
<a name="l02548"></a>02548   {
<a name="l02549"></a>02549     TARGET_SAVE_OPT, CTF_OPT
<a name="l02550"></a>02550   };
<a name="l02551"></a>02551   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structmi__opt.html">mi_opt</a> opts[] =
<a name="l02552"></a>02552     {
<a name="l02553"></a>02553       {<span class="stringliteral">&quot;r&quot;</span>, TARGET_SAVE_OPT, 0},
<a name="l02554"></a>02554       {<span class="stringliteral">&quot;ctf&quot;</span>, CTF_OPT, 0},
<a name="l02555"></a>02555       { 0, 0, 0 }
<a name="l02556"></a>02556     };
<a name="l02557"></a>02557 
<a name="l02558"></a>02558   <span class="keywordflow">while</span> (1)
<a name="l02559"></a>02559     {
<a name="l02560"></a>02560       <span class="keywordtype">int</span> opt = <a class="code" href="mi-getopt_8c.html#af7bb1a80abf57e9afae0149d3af20b9c">mi_getopt</a> (<span class="stringliteral">&quot;-trace-save&quot;</span>, argc, argv, opts,
<a name="l02561"></a>02561                            &amp;oind, &amp;oarg);
<a name="l02562"></a>02562 
<a name="l02563"></a>02563       <span class="keywordflow">if</span> (opt &lt; 0)
<a name="l02564"></a>02564         <span class="keywordflow">break</span>;
<a name="l02565"></a>02565       <span class="keywordflow">switch</span> ((<span class="keyword">enum</span> opt) opt)
<a name="l02566"></a>02566         {
<a name="l02567"></a>02567         <span class="keywordflow">case</span> TARGET_SAVE_OPT:
<a name="l02568"></a>02568           target_saves = 1;
<a name="l02569"></a>02569           <span class="keywordflow">break</span>;
<a name="l02570"></a>02570         <span class="keywordflow">case</span> CTF_OPT:
<a name="l02571"></a>02571           generate_ctf = 1;
<a name="l02572"></a>02572           <span class="keywordflow">break</span>;
<a name="l02573"></a>02573         }
<a name="l02574"></a>02574     }
<a name="l02575"></a>02575   filename = argv[oind];
<a name="l02576"></a>02576 
<a name="l02577"></a>02577   <span class="keywordflow">if</span> (generate_ctf)
<a name="l02578"></a>02578     <a class="code" href="tracepoint_8c.html#ab9411fcac1c8ef808ced75e403ec61d7">trace_save_ctf</a> (filename, target_saves);
<a name="l02579"></a>02579   <span class="keywordflow">else</span>
<a name="l02580"></a>02580     <a class="code" href="tracepoint_8c.html#ab28f3690712386b7f482eec1b5754ae9">trace_save_tfile</a> (filename, target_saves);
<a name="l02581"></a>02581 }
<a name="l02582"></a>02582 
<a name="l02583"></a>02583 <span class="keywordtype">void</span>
<a name="l02584"></a><a class="code" href="mi-main_8c.html#ac4508ea5c668224a0d864a77c8cec9db">02584</a> <a class="code" href="mi-cmds_8h.html#a9739c82e46d058659ed3cd861d459dab">mi_cmd_trace_start</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l02585"></a>02585 {
<a name="l02586"></a>02586   <a class="code" href="tracepoint_8c.html#a8bc87fc32433bb5c4df5a2774c2dc2cc">start_tracing</a> (NULL);
<a name="l02587"></a>02587 }
<a name="l02588"></a>02588 
<a name="l02589"></a>02589 <span class="keywordtype">void</span>
<a name="l02590"></a><a class="code" href="mi-main_8c.html#aac016ba72dd36f9e5abd05ed7b76634b">02590</a> <a class="code" href="mi-cmds_8h.html#af21080c45696af923802f6501760c101">mi_cmd_trace_status</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l02591"></a>02591 {
<a name="l02592"></a>02592   <a class="code" href="tracepoint_8c.html#ab313b62472b352ee3bb0abd5cf2a190d">trace_status_mi</a> (0);
<a name="l02593"></a>02593 }
<a name="l02594"></a>02594 
<a name="l02595"></a>02595 <span class="keywordtype">void</span>
<a name="l02596"></a><a class="code" href="mi-main_8c.html#a86e09d73c005111319751d0b171c2194">02596</a> <a class="code" href="mi-cmds_8h.html#a221f5112bb598fbc29a5b46ebe829004">mi_cmd_trace_stop</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l02597"></a>02597 {
<a name="l02598"></a>02598   <a class="code" href="tracepoint_8c.html#a26bc954d51daa144c78d9649e02c2091">stop_tracing</a> (NULL);
<a name="l02599"></a>02599   <a class="code" href="tracepoint_8c.html#ab313b62472b352ee3bb0abd5cf2a190d">trace_status_mi</a> (1);
<a name="l02600"></a>02600 }
<a name="l02601"></a>02601 
<a name="l02602"></a>02602 <span class="comment">/* Implement the &quot;-ada-task-info&quot; command.  */</span>
<a name="l02603"></a>02603 
<a name="l02604"></a>02604 <span class="keywordtype">void</span>
<a name="l02605"></a><a class="code" href="mi-main_8c.html#a9ddce396991fd5ba3a0b0785a1f42023">02605</a> <a class="code" href="mi-cmds_8h.html#a336111ff602b0ca86e0cb0d45914efe7">mi_cmd_ada_task_info</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l02606"></a>02606 {
<a name="l02607"></a>02607   <span class="keywordflow">if</span> (argc != 0 &amp;&amp; argc != 1)
<a name="l02608"></a>02608     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Invalid MI command&quot;</span>));
<a name="l02609"></a>02609 
<a name="l02610"></a>02610   <a class="code" href="ada-lang_8h.html#a2c3ba989a6ff5a7e6083b49375ed6ac7">print_ada_task_info</a> (<a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>, argv[0], <a class="code" href="inferior_8c.html#a9e592c83e7c0c1f89f1a4a392bd1a277">current_inferior</a> ());
<a name="l02611"></a>02611 }
<a name="l02612"></a>02612 
<a name="l02613"></a>02613 <span class="comment">/* Print EXPRESSION according to VALUES.  */</span>
<a name="l02614"></a>02614 
<a name="l02615"></a>02615 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l02616"></a>02616 print_variable_or_computed (<span class="keywordtype">char</span> *<a class="code" href="structexpression.html">expression</a>, <span class="keyword">enum</span> <a class="code" href="mi-cmds_8h.html#a720a36ba162207ce321b491d019fe3f0">print_values</a> values)
<a name="l02617"></a>02617 {
<a name="l02618"></a>02618   <span class="keyword">struct </span>expression *expr;
<a name="l02619"></a>02619   <span class="keyword">struct </span>cleanup *old_chain;
<a name="l02620"></a>02620   <span class="keyword">struct </span>value *val;
<a name="l02621"></a>02621   <span class="keyword">struct </span>ui_file *stb;
<a name="l02622"></a>02622   <span class="keyword">struct </span><a class="code" href="structvalue__print__options.html">value_print_options</a> opts;
<a name="l02623"></a>02623   <span class="keyword">struct </span><a class="code" href="structtype.html">type</a> *<a class="code" href="structtype.html">type</a>;
<a name="l02624"></a>02624   <span class="keyword">struct </span>ui_out *uiout = <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>;
<a name="l02625"></a>02625 
<a name="l02626"></a>02626   stb = <a class="code" href="ui-file_8c.html#a340771735f105582d314e191a399a45c">mem_fileopen</a> ();
<a name="l02627"></a>02627   old_chain = <a class="code" href="utils_8c.html#a94dc56baeb57791e114136764f7763aa">make_cleanup_ui_file_delete</a> (stb);
<a name="l02628"></a>02628 
<a name="l02629"></a>02629   expr = <a class="code" href="expression_8h.html#a286599225dbfecf78c83d1eb5261f25a">parse_expression</a> (expression);
<a name="l02630"></a>02630 
<a name="l02631"></a>02631   <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="utils_8c.html#a6d8c21606d3f67a431a7bfbb1f47d12e">free_current_contents</a>, &amp;expr);
<a name="l02632"></a>02632 
<a name="l02633"></a>02633   <span class="keywordflow">if</span> (values == <a class="code" href="mi-cmds_8h.html#a720a36ba162207ce321b491d019fe3f0a2484e4b8158ebd266c5d0b3718b0d3d3">PRINT_SIMPLE_VALUES</a>)
<a name="l02634"></a>02634     val = <a class="code" href="eval_8c.html#aae8f92c8e1cc2f3844384361c7a50e9b">evaluate_type</a> (expr);
<a name="l02635"></a>02635   <span class="keywordflow">else</span>
<a name="l02636"></a>02636     val = <a class="code" href="eval_8c.html#ab50151ccba3ea3184c114121d6bed422">evaluate_expression</a> (expr);
<a name="l02637"></a>02637 
<a name="l02638"></a>02638   <span class="keywordflow">if</span> (values != <a class="code" href="mi-cmds_8h.html#a720a36ba162207ce321b491d019fe3f0ae63adc0b3d0644a887299986759c13bf">PRINT_NO_VALUES</a>)
<a name="l02639"></a>02639     <a class="code" href="ui-out_8c.html#aaf5a0c991d74ad2e486f420d5c2ff058">make_cleanup_ui_out_tuple_begin_end</a> (uiout, NULL);
<a name="l02640"></a>02640   <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;name&quot;</span>, expression);
<a name="l02641"></a>02641 
<a name="l02642"></a>02642   <span class="keywordflow">switch</span> (values)
<a name="l02643"></a>02643     {
<a name="l02644"></a>02644     <span class="keywordflow">case</span> <a class="code" href="mi-cmds_8h.html#a720a36ba162207ce321b491d019fe3f0a2484e4b8158ebd266c5d0b3718b0d3d3">PRINT_SIMPLE_VALUES</a>:
<a name="l02645"></a>02645       type = <a class="code" href="gdbtypes_8c.html#a0bf29d7521d8a8b8735b9a259e380386">check_typedef</a> (<a class="code" href="value_8c.html#a263a4c0bee0b0df41074b952d3c121d0">value_type</a> (val));
<a name="l02646"></a>02646       <a class="code" href="typeprint_8c.html#ad50c90b55385094557cceaa1ea985e47">type_print</a> (<a class="code" href="value_8c.html#a263a4c0bee0b0df41074b952d3c121d0">value_type</a> (val), <span class="stringliteral">&quot;&quot;</span>, stb, -1);
<a name="l02647"></a>02647       <a class="code" href="ui-out_8c.html#a40106bb0446639417c75a408194a8eee">ui_out_field_stream</a> (uiout, <span class="stringliteral">&quot;type&quot;</span>, stb);
<a name="l02648"></a>02648       <span class="keywordflow">if</span> (<a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (type) != <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a00c795b43d1a39f57d3e222385f14fc0">TYPE_CODE_ARRAY</a>
<a name="l02649"></a>02649           &amp;&amp; <a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (type) != <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462af3b3fc76f66c95e12946c0ef84409365">TYPE_CODE_STRUCT</a>
<a name="l02650"></a>02650           &amp;&amp; <a class="code" href="gdbtypes_8h.html#a9505f41c7012665947c6b4065ce190e1">TYPE_CODE</a> (type) != <a class="code" href="gdbtypes_8h.html#a90e2a0fddaa6afff6a0a489ff4da3462a8c3218d2f780665395d57dcd4d909191">TYPE_CODE_UNION</a>)
<a name="l02651"></a>02651         {
<a name="l02652"></a>02652           <span class="keyword">struct </span><a class="code" href="structvalue__print__options.html">value_print_options</a> opts;
<a name="l02653"></a>02653 
<a name="l02654"></a>02654           <a class="code" href="valprint_8c.html#a22fae251967271a4a965010e47e484ae">get_no_prettyformat_print_options</a> (&amp;opts);
<a name="l02655"></a>02655           opts.deref_ref = 1;
<a name="l02656"></a>02656           <a class="code" href="valprint_8c.html#a3b8220f1b9270a2f8b8f4e197f2be9db">common_val_print</a> (val, stb, 0, &amp;opts, <a class="code" href="language_8c.html#acd2505a014a95629da9c836f8914fc79">current_language</a>);
<a name="l02657"></a>02657           <a class="code" href="ui-out_8c.html#a40106bb0446639417c75a408194a8eee">ui_out_field_stream</a> (uiout, <span class="stringliteral">&quot;value&quot;</span>, stb);
<a name="l02658"></a>02658         }
<a name="l02659"></a>02659       <span class="keywordflow">break</span>;
<a name="l02660"></a>02660     <span class="keywordflow">case</span> <a class="code" href="mi-cmds_8h.html#a720a36ba162207ce321b491d019fe3f0a3e86c23e14ec9e2f1701a8a54897e6d6">PRINT_ALL_VALUES</a>:
<a name="l02661"></a>02661       {
<a name="l02662"></a>02662         <span class="keyword">struct </span><a class="code" href="structvalue__print__options.html">value_print_options</a> opts;
<a name="l02663"></a>02663 
<a name="l02664"></a>02664         <a class="code" href="valprint_8c.html#a22fae251967271a4a965010e47e484ae">get_no_prettyformat_print_options</a> (&amp;opts);
<a name="l02665"></a>02665         opts.deref_ref = 1;
<a name="l02666"></a>02666         <a class="code" href="valprint_8c.html#a3b8220f1b9270a2f8b8f4e197f2be9db">common_val_print</a> (val, stb, 0, &amp;opts, <a class="code" href="language_8c.html#acd2505a014a95629da9c836f8914fc79">current_language</a>);
<a name="l02667"></a>02667         <a class="code" href="ui-out_8c.html#a40106bb0446639417c75a408194a8eee">ui_out_field_stream</a> (uiout, <span class="stringliteral">&quot;value&quot;</span>, stb);
<a name="l02668"></a>02668       }
<a name="l02669"></a>02669       <span class="keywordflow">break</span>;
<a name="l02670"></a>02670     }
<a name="l02671"></a>02671 
<a name="l02672"></a>02672   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l02673"></a>02673 }
<a name="l02674"></a>02674 
<a name="l02675"></a>02675 <span class="comment">/* Implement the &quot;-trace-frame-collected&quot; command.  */</span>
<a name="l02676"></a>02676 
<a name="l02677"></a>02677 <span class="keywordtype">void</span>
<a name="l02678"></a><a class="code" href="mi-main_8c.html#ab750834d92d3c84b188b31c96db0256b">02678</a> <a class="code" href="mi-cmds_8h.html#a8e3e5c68ff65f1ec681888798d100237">mi_cmd_trace_frame_collected</a> (<span class="keywordtype">char</span> *command, <span class="keywordtype">char</span> **argv, <span class="keywordtype">int</span> argc)
<a name="l02679"></a>02679 {
<a name="l02680"></a>02680   <span class="keyword">struct </span>cleanup *old_chain;
<a name="l02681"></a>02681   <span class="keyword">struct </span><a class="code" href="structbp__location.html">bp_location</a> *tloc;
<a name="l02682"></a>02682   <span class="keywordtype">int</span> stepping_frame;
<a name="l02683"></a>02683   <span class="keyword">struct </span><a class="code" href="structcollection__list.html">collection_list</a> *clist;
<a name="l02684"></a>02684   <span class="keyword">struct </span><a class="code" href="structcollection__list.html">collection_list</a> tracepoint_list, stepping_list;
<a name="l02685"></a>02685   <span class="keyword">struct </span><a class="code" href="structtraceframe__info.html">traceframe_info</a> *tinfo;
<a name="l02686"></a>02686   <span class="keywordtype">int</span> oind = 0;
<a name="l02687"></a>02687   <span class="keywordtype">int</span> var_print_values = <a class="code" href="mi-cmds_8h.html#a720a36ba162207ce321b491d019fe3f0a3e86c23e14ec9e2f1701a8a54897e6d6">PRINT_ALL_VALUES</a>;
<a name="l02688"></a>02688   <span class="keywordtype">int</span> comp_print_values = <a class="code" href="mi-cmds_8h.html#a720a36ba162207ce321b491d019fe3f0a3e86c23e14ec9e2f1701a8a54897e6d6">PRINT_ALL_VALUES</a>;
<a name="l02689"></a>02689   <span class="keywordtype">int</span> registers_format = <span class="charliteral">&#39;x&#39;</span>;
<a name="l02690"></a>02690   <span class="keywordtype">int</span> memory_contents = 0;
<a name="l02691"></a>02691   <span class="keyword">struct </span>ui_out *uiout = <a class="code" href="ui-out_8c.html#a3d9e2a5710f076cc035ef73920eb8c87">current_uiout</a>;
<a name="l02692"></a>02692   <span class="keyword">enum</span> opt
<a name="l02693"></a>02693   {
<a name="l02694"></a>02694     VAR_PRINT_VALUES,
<a name="l02695"></a>02695     COMP_PRINT_VALUES,
<a name="l02696"></a>02696     REGISTERS_FORMAT,
<a name="l02697"></a>02697     MEMORY_CONTENTS,
<a name="l02698"></a>02698   };
<a name="l02699"></a>02699   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structmi__opt.html">mi_opt</a> opts[] =
<a name="l02700"></a>02700     {
<a name="l02701"></a>02701       {<span class="stringliteral">&quot;-var-print-values&quot;</span>, VAR_PRINT_VALUES, 1},
<a name="l02702"></a>02702       {<span class="stringliteral">&quot;-comp-print-values&quot;</span>, COMP_PRINT_VALUES, 1},
<a name="l02703"></a>02703       {<span class="stringliteral">&quot;-registers-format&quot;</span>, REGISTERS_FORMAT, 1},
<a name="l02704"></a>02704       {<span class="stringliteral">&quot;-memory-contents&quot;</span>, MEMORY_CONTENTS, 0},
<a name="l02705"></a>02705       { 0, 0, 0 }
<a name="l02706"></a>02706     };
<a name="l02707"></a>02707 
<a name="l02708"></a>02708   <span class="keywordflow">while</span> (1)
<a name="l02709"></a>02709     {
<a name="l02710"></a>02710       <span class="keywordtype">char</span> *oarg;
<a name="l02711"></a>02711       <span class="keywordtype">int</span> opt = <a class="code" href="mi-getopt_8c.html#af7bb1a80abf57e9afae0149d3af20b9c">mi_getopt</a> (<span class="stringliteral">&quot;-trace-frame-collected&quot;</span>, argc, argv, opts,
<a name="l02712"></a>02712                            &amp;oind, &amp;oarg);
<a name="l02713"></a>02713       <span class="keywordflow">if</span> (opt &lt; 0)
<a name="l02714"></a>02714         <span class="keywordflow">break</span>;
<a name="l02715"></a>02715       <span class="keywordflow">switch</span> ((<span class="keyword">enum</span> opt) opt)
<a name="l02716"></a>02716         {
<a name="l02717"></a>02717         <span class="keywordflow">case</span> VAR_PRINT_VALUES:
<a name="l02718"></a>02718           var_print_values = <a class="code" href="mi-parse_8c.html#af9fbaa0f768723c650201386acb94630">mi_parse_print_values</a> (oarg);
<a name="l02719"></a>02719           <span class="keywordflow">break</span>;
<a name="l02720"></a>02720         <span class="keywordflow">case</span> COMP_PRINT_VALUES:
<a name="l02721"></a>02721           comp_print_values = <a class="code" href="mi-parse_8c.html#af9fbaa0f768723c650201386acb94630">mi_parse_print_values</a> (oarg);
<a name="l02722"></a>02722           <span class="keywordflow">break</span>;
<a name="l02723"></a>02723         <span class="keywordflow">case</span> REGISTERS_FORMAT:
<a name="l02724"></a>02724           registers_format = oarg[0];
<a name="l02725"></a>02725         <span class="keywordflow">case</span> MEMORY_CONTENTS:
<a name="l02726"></a>02726           memory_contents = 1;
<a name="l02727"></a>02727           <span class="keywordflow">break</span>;
<a name="l02728"></a>02728         }
<a name="l02729"></a>02729     }
<a name="l02730"></a>02730 
<a name="l02731"></a>02731   <span class="keywordflow">if</span> (oind != argc)
<a name="l02732"></a>02732     <a class="code" href="utils_8c.html#a279e952362d12544d9bebc26660fec4b">error</a> (<a class="code" href="gdb__locale_8h.html#a32a3cf3d9dd914f5aeeca5423c157934">_</a>(<span class="stringliteral">&quot;Usage: -trace-frame-collected &quot;</span>
<a name="l02733"></a>02733              <span class="stringliteral">&quot;[--var-print-values PRINT_VALUES] &quot;</span>
<a name="l02734"></a>02734              <span class="stringliteral">&quot;[--comp-print-values PRINT_VALUES] &quot;</span>
<a name="l02735"></a>02735              <span class="stringliteral">&quot;[--registers-format FORMAT]&quot;</span>
<a name="l02736"></a>02736              <span class="stringliteral">&quot;[--memory-contents]&quot;</span>));
<a name="l02737"></a>02737 
<a name="l02738"></a>02738   <span class="comment">/* This throws an error is not inspecting a trace frame.  */</span>
<a name="l02739"></a>02739   tloc = <a class="code" href="tracepoint_8c.html#a3ff862713babf484e1e8f235475cc043">get_traceframe_location</a> (&amp;stepping_frame);
<a name="l02740"></a>02740 
<a name="l02741"></a>02741   <span class="comment">/* This command only makes sense for the current frame, not the</span>
<a name="l02742"></a>02742 <span class="comment">     selected frame.  */</span>
<a name="l02743"></a>02743   old_chain = <a class="code" href="gdbthread_8h.html#a7a784124700d19ad7da32e2c20d3b0c6">make_cleanup_restore_current_thread</a> ();
<a name="l02744"></a>02744   <a class="code" href="frame_8c.html#a400fa273ac86863322cdc65683ef2356">select_frame</a> (<a class="code" href="frame_8c.html#a5ab254510728049878a232ed1b889820">get_current_frame</a> ());
<a name="l02745"></a>02745 
<a name="l02746"></a>02746   <a class="code" href="tracepoint_8c.html#ace750d67a6f8504b71c126d7238a84a4">encode_actions_and_make_cleanup</a> (tloc, &amp;tracepoint_list,
<a name="l02747"></a>02747                                    &amp;stepping_list);
<a name="l02748"></a>02748 
<a name="l02749"></a>02749   <span class="keywordflow">if</span> (stepping_frame)
<a name="l02750"></a>02750     clist = &amp;stepping_list;
<a name="l02751"></a>02751   <span class="keywordflow">else</span>
<a name="l02752"></a>02752     clist = &amp;tracepoint_list;
<a name="l02753"></a>02753 
<a name="l02754"></a>02754   tinfo = <a class="code" href="tracepoint_8c.html#abb3dd8b5472553fe9a5b222fd23ea177">get_traceframe_info</a> ();
<a name="l02755"></a>02755 
<a name="l02756"></a>02756   <span class="comment">/* Explicitly wholly collected variables.  */</span>
<a name="l02757"></a>02757   {
<a name="l02758"></a>02758     <span class="keyword">struct </span>cleanup *list_cleanup;
<a name="l02759"></a>02759     <span class="keywordtype">char</span> *p;
<a name="l02760"></a>02760     <span class="keywordtype">int</span> i;
<a name="l02761"></a>02761 
<a name="l02762"></a>02762     list_cleanup = <a class="code" href="ui-out_8c.html#aa6e8e9b18ba11e13617a6c56cbfab08f">make_cleanup_ui_out_list_begin_end</a> (uiout,
<a name="l02763"></a>02763                                                        <span class="stringliteral">&quot;explicit-variables&quot;</span>);
<a name="l02764"></a>02764     <span class="keywordflow">for</span> (i = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="gdb__vecs_8h.html#a5ea7d3fefa2144d9bddaf2053c9691a1">char_ptr</a>, clist-&gt;wholly_collected, i, p); i++)
<a name="l02765"></a>02765       print_variable_or_computed (p, var_print_values);
<a name="l02766"></a>02766     <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (list_cleanup);
<a name="l02767"></a>02767   }
<a name="l02768"></a>02768 
<a name="l02769"></a>02769   <span class="comment">/* Computed expressions.  */</span>
<a name="l02770"></a>02770   {
<a name="l02771"></a>02771     <span class="keyword">struct </span>cleanup *list_cleanup;
<a name="l02772"></a>02772     <span class="keywordtype">char</span> *p;
<a name="l02773"></a>02773     <span class="keywordtype">int</span> i;
<a name="l02774"></a>02774 
<a name="l02775"></a>02775     list_cleanup
<a name="l02776"></a>02776       = <a class="code" href="ui-out_8c.html#aa6e8e9b18ba11e13617a6c56cbfab08f">make_cleanup_ui_out_list_begin_end</a> (uiout,
<a name="l02777"></a>02777                                             <span class="stringliteral">&quot;computed-expressions&quot;</span>);
<a name="l02778"></a>02778     <span class="keywordflow">for</span> (i = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="gdb__vecs_8h.html#a5ea7d3fefa2144d9bddaf2053c9691a1">char_ptr</a>, clist-&gt;computed, i, p); i++)
<a name="l02779"></a>02779       print_variable_or_computed (p, comp_print_values);
<a name="l02780"></a>02780     <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (list_cleanup);
<a name="l02781"></a>02781   }
<a name="l02782"></a>02782 
<a name="l02783"></a>02783   <span class="comment">/* Registers.  Given pseudo-registers, and that some architectures</span>
<a name="l02784"></a>02784 <span class="comment">     (like MIPS) actually hide the raw registers, we don&#39;t go through</span>
<a name="l02785"></a>02785 <span class="comment">     the trace frame info, but instead consult the register cache for</span>
<a name="l02786"></a>02786 <span class="comment">     register availability.  */</span>
<a name="l02787"></a>02787   {
<a name="l02788"></a>02788     <span class="keyword">struct </span>cleanup *list_cleanup;
<a name="l02789"></a>02789     <span class="keyword">struct </span>frame_info *frame;
<a name="l02790"></a>02790     <span class="keyword">struct </span>gdbarch *gdbarch;
<a name="l02791"></a>02791     <span class="keywordtype">int</span> <a class="code" href="aarch64-tdep_8c.html#a6b3d1ad0bca4067ccaef1366bea0db04">regnum</a>;
<a name="l02792"></a>02792     <span class="keywordtype">int</span> numregs;
<a name="l02793"></a>02793 
<a name="l02794"></a>02794     list_cleanup = <a class="code" href="ui-out_8c.html#aa6e8e9b18ba11e13617a6c56cbfab08f">make_cleanup_ui_out_list_begin_end</a> (uiout, <span class="stringliteral">&quot;registers&quot;</span>);
<a name="l02795"></a>02795 
<a name="l02796"></a>02796     frame = <a class="code" href="frame_8c.html#a8b714a78478670e14a297eba8d1a9915">get_selected_frame</a> (NULL);
<a name="l02797"></a>02797     gdbarch = <a class="code" href="frame_8c.html#ab44507b5655da44e522ed5857835ede7">get_frame_arch</a> (frame);
<a name="l02798"></a>02798     numregs = <a class="code" href="gdbarch_8c.html#a69069435754d0b434c7043a21d247325">gdbarch_num_regs</a> (gdbarch) + <a class="code" href="gdbarch_8c.html#a8e0e40f42e5969ee4559ee47717aa9f3">gdbarch_num_pseudo_regs</a> (gdbarch);
<a name="l02799"></a>02799 
<a name="l02800"></a>02800     <span class="keywordflow">for</span> (regnum = 0; regnum &lt; numregs; regnum++)
<a name="l02801"></a>02801       {
<a name="l02802"></a>02802         <span class="keywordflow">if</span> (<a class="code" href="gdbarch_8c.html#a86c0cf41eb88c54e943cd80e79af36e5">gdbarch_register_name</a> (gdbarch, regnum) == NULL
<a name="l02803"></a>02803             || *(<a class="code" href="gdbarch_8c.html#a86c0cf41eb88c54e943cd80e79af36e5">gdbarch_register_name</a> (gdbarch, regnum)) == <span class="charliteral">&#39;\0&#39;</span>)
<a name="l02804"></a>02804           <span class="keywordflow">continue</span>;
<a name="l02805"></a>02805 
<a name="l02806"></a>02806         output_register (frame, regnum, registers_format, 1);
<a name="l02807"></a>02807       }
<a name="l02808"></a>02808 
<a name="l02809"></a>02809     <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (list_cleanup);
<a name="l02810"></a>02810   }
<a name="l02811"></a>02811 
<a name="l02812"></a>02812   <span class="comment">/* Trace state variables.  */</span>
<a name="l02813"></a>02813   {
<a name="l02814"></a>02814     <span class="keyword">struct </span>cleanup *list_cleanup;
<a name="l02815"></a>02815     <span class="keywordtype">int</span> tvar;
<a name="l02816"></a>02816     <span class="keywordtype">char</span> *tsvname;
<a name="l02817"></a>02817     <span class="keywordtype">int</span> i;
<a name="l02818"></a>02818 
<a name="l02819"></a>02819     list_cleanup = <a class="code" href="ui-out_8c.html#aa6e8e9b18ba11e13617a6c56cbfab08f">make_cleanup_ui_out_list_begin_end</a> (uiout, <span class="stringliteral">&quot;tvars&quot;</span>);
<a name="l02820"></a>02820 
<a name="l02821"></a>02821     tsvname = NULL;
<a name="l02822"></a>02822     <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="utils_8c.html#a6d8c21606d3f67a431a7bfbb1f47d12e">free_current_contents</a>, &amp;tsvname);
<a name="l02823"></a>02823 
<a name="l02824"></a>02824     <span class="keywordflow">for</span> (i = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<span class="keywordtype">int</span>, tinfo-&gt;tvars, i, tvar); i++)
<a name="l02825"></a>02825       {
<a name="l02826"></a>02826         <span class="keyword">struct </span>cleanup *cleanup_child;
<a name="l02827"></a>02827         <span class="keyword">struct </span><a class="code" href="structtrace__state__variable.html">trace_state_variable</a> *tsv;
<a name="l02828"></a>02828 
<a name="l02829"></a>02829         tsv = <a class="code" href="tracepoint_8c.html#a2fe5dc5cafe81a044b1ba70d5db5b597">find_trace_state_variable_by_number</a> (tvar);
<a name="l02830"></a>02830 
<a name="l02831"></a>02831         cleanup_child = <a class="code" href="ui-out_8c.html#aaf5a0c991d74ad2e486f420d5c2ff058">make_cleanup_ui_out_tuple_begin_end</a> (uiout, NULL);
<a name="l02832"></a>02832 
<a name="l02833"></a>02833         <span class="keywordflow">if</span> (tsv != NULL)
<a name="l02834"></a>02834           {
<a name="l02835"></a>02835             tsvname = <a class="code" href="common-utils_8c.html#af404b7244f442ce8c3069f31af566eae">xrealloc</a> (tsvname, strlen (tsv-&gt;<a class="code" href="structtrace__state__variable.html#ac86438487a7fe60738afe3ba2699b09f">name</a>) + 2);
<a name="l02836"></a>02836             tsvname[0] = <span class="charliteral">&#39;$&#39;</span>;
<a name="l02837"></a>02837             strcpy (tsvname + 1, tsv-&gt;<a class="code" href="structtrace__state__variable.html#ac86438487a7fe60738afe3ba2699b09f">name</a>);
<a name="l02838"></a>02838             <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;name&quot;</span>, tsvname);
<a name="l02839"></a>02839 
<a name="l02840"></a>02840             tsv-&gt;<a class="code" href="structtrace__state__variable.html#a477de2307634454e6eba5730e76f71ce">value_known</a> = <a class="code" href="target_8h.html#a8628c39fd21979c3a0382fa374343872">target_get_trace_state_variable_value</a> (tsv-&gt;<a class="code" href="structtrace__state__variable.html#a6bb7d975f2080b6b52d3d3c49c7fe767">number</a>,
<a name="l02841"></a>02841                                                                       &amp;tsv-&gt;<a class="code" href="structtrace__state__variable.html#af724d35de7189b31747e0e39d51e3719">value</a>);
<a name="l02842"></a>02842             <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, <span class="stringliteral">&quot;current&quot;</span>, tsv-&gt;<a class="code" href="structtrace__state__variable.html#af724d35de7189b31747e0e39d51e3719">value</a>);
<a name="l02843"></a>02843           }
<a name="l02844"></a>02844         <span class="keywordflow">else</span>
<a name="l02845"></a>02845           {
<a name="l02846"></a>02846             <a class="code" href="ui-out_8c.html#a5366a822858ecedafef54625bec57442">ui_out_field_skip</a> (uiout, <span class="stringliteral">&quot;name&quot;</span>);
<a name="l02847"></a>02847             <a class="code" href="ui-out_8c.html#a5366a822858ecedafef54625bec57442">ui_out_field_skip</a> (uiout, <span class="stringliteral">&quot;current&quot;</span>);
<a name="l02848"></a>02848           }
<a name="l02849"></a>02849 
<a name="l02850"></a>02850         <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup_child);
<a name="l02851"></a>02851       }
<a name="l02852"></a>02852 
<a name="l02853"></a>02853     <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (list_cleanup);
<a name="l02854"></a>02854   }
<a name="l02855"></a>02855 
<a name="l02856"></a>02856   <span class="comment">/* Memory.  */</span>
<a name="l02857"></a>02857   {
<a name="l02858"></a>02858     <span class="keyword">struct </span>cleanup *list_cleanup;
<a name="l02859"></a>02859     <a class="code" href="vec_8h.html#ab084f6f29fcf16a6b15d15feb653d414">VEC</a>(<a class="code" href="structmem__range.html">mem_range_s</a>) *available_memory = NULL;
<a name="l02860"></a>02860     <span class="keyword">struct </span><a class="code" href="structmem__range.html">mem_range</a> *r;
<a name="l02861"></a>02861     <span class="keywordtype">int</span> i;
<a name="l02862"></a>02862 
<a name="l02863"></a>02863     <a class="code" href="tracepoint_8c.html#a7a4773385bc6ad9ca1704981f3186867">traceframe_available_memory</a> (&amp;available_memory, 0, ULONGEST_MAX);
<a name="l02864"></a>02864     <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="vec_8h.html#a92a6114eb727b9274e1523d0e9dd2e61">VEC_cleanup</a>(<a class="code" href="structmem__range.html">mem_range_s</a>), &amp;available_memory);
<a name="l02865"></a>02865 
<a name="l02866"></a>02866     list_cleanup = <a class="code" href="ui-out_8c.html#aa6e8e9b18ba11e13617a6c56cbfab08f">make_cleanup_ui_out_list_begin_end</a> (uiout, <span class="stringliteral">&quot;memory&quot;</span>);
<a name="l02867"></a>02867 
<a name="l02868"></a>02868     <span class="keywordflow">for</span> (i = 0; <a class="code" href="vec_8h.html#ae7795b0c8e65f45eb49aac5ec2c0fa52">VEC_iterate</a> (<a class="code" href="structmem__range.html">mem_range_s</a>, available_memory, i, r); i++)
<a name="l02869"></a>02869       {
<a name="l02870"></a>02870         <span class="keyword">struct </span>cleanup *cleanup_child;
<a name="l02871"></a>02871         <a class="code" href="defs_8h.html#a336b399b3b83dbcc61f176c33f26b607">gdb_byte</a> *data;
<a name="l02872"></a>02872         <span class="keyword">struct </span>gdbarch *gdbarch = <a class="code" href="gdbarch_8c.html#ad648a33f69abe34e9679744a0c5a0580">target_gdbarch</a> ();
<a name="l02873"></a>02873 
<a name="l02874"></a>02874         cleanup_child = <a class="code" href="ui-out_8c.html#aaf5a0c991d74ad2e486f420d5c2ff058">make_cleanup_ui_out_tuple_begin_end</a> (uiout, NULL);
<a name="l02875"></a>02875 
<a name="l02876"></a>02876         <a class="code" href="ui-out_8c.html#ada85ed653fecf3c2a80027de6f71ef71">ui_out_field_core_addr</a> (uiout, <span class="stringliteral">&quot;address&quot;</span>, gdbarch, r-&gt;<a class="code" href="structmem__range.html#af0c57d66bc3b5fc21cfba6dfb161f618">start</a>);
<a name="l02877"></a>02877         <a class="code" href="ui-out_8c.html#aa6f66551d03db456fb94ca1c9038f5a0">ui_out_field_int</a> (uiout, <span class="stringliteral">&quot;length&quot;</span>, r-&gt;<a class="code" href="structmem__range.html#a7dd2d185dbacbc0a099e55a2cffb0696">length</a>);
<a name="l02878"></a>02878 
<a name="l02879"></a>02879         data = <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (r-&gt;<a class="code" href="structmem__range.html#a7dd2d185dbacbc0a099e55a2cffb0696">length</a>);
<a name="l02880"></a>02880         <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, data);
<a name="l02881"></a>02881 
<a name="l02882"></a>02882         <span class="keywordflow">if</span> (memory_contents)
<a name="l02883"></a>02883           {
<a name="l02884"></a>02884             <span class="keywordflow">if</span> (<a class="code" href="target_8c.html#ac579515fbccfb9e6b1a45766a71c1d4f">target_read_memory</a> (r-&gt;<a class="code" href="structmem__range.html#af0c57d66bc3b5fc21cfba6dfb161f618">start</a>, data, r-&gt;<a class="code" href="structmem__range.html#a7dd2d185dbacbc0a099e55a2cffb0696">length</a>) == 0)
<a name="l02885"></a>02885               {
<a name="l02886"></a>02886                 <span class="keywordtype">int</span> <a class="code" href="namespacearm-linux.html#a8594a1214bfb32c5d61201101374a289">m</a>;
<a name="l02887"></a>02887                 <span class="keywordtype">char</span> *data_str, *p;
<a name="l02888"></a>02888 
<a name="l02889"></a>02889                 data_str = <a class="code" href="common-utils_8c.html#a634d6cd850bb831afebc499579303b3b">xmalloc</a> (r-&gt;<a class="code" href="structmem__range.html#a7dd2d185dbacbc0a099e55a2cffb0696">length</a> * 2 + 1);
<a name="l02890"></a>02890                 <a class="code" href="cleanups_8c.html#a3d418f8af424aec399898c2d48b26224">make_cleanup</a> (<a class="code" href="common-utils_8c.html#a976e14808b9247ec952c262553f09f8f">xfree</a>, data_str);
<a name="l02891"></a>02891 
<a name="l02892"></a>02892                 <span class="keywordflow">for</span> (m = 0, p = data_str; m &lt; r-&gt;<a class="code" href="structmem__range.html#a7dd2d185dbacbc0a099e55a2cffb0696">length</a>; ++<a class="code" href="namespacearm-linux.html#a8594a1214bfb32c5d61201101374a289">m</a>, p += 2)
<a name="l02893"></a>02893                   sprintf (p, <span class="stringliteral">&quot;%02x&quot;</span>, data[m]);
<a name="l02894"></a>02894                 <a class="code" href="ui-out_8c.html#a58efe771979c53ca23a30573d06dc291">ui_out_field_string</a> (uiout, <span class="stringliteral">&quot;contents&quot;</span>, data_str);
<a name="l02895"></a>02895               }
<a name="l02896"></a>02896             <span class="keywordflow">else</span>
<a name="l02897"></a>02897               <a class="code" href="ui-out_8c.html#a5366a822858ecedafef54625bec57442">ui_out_field_skip</a> (uiout, <span class="stringliteral">&quot;contents&quot;</span>);
<a name="l02898"></a>02898           }
<a name="l02899"></a>02899         <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (cleanup_child);
<a name="l02900"></a>02900       }
<a name="l02901"></a>02901 
<a name="l02902"></a>02902     <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (list_cleanup);
<a name="l02903"></a>02903   }
<a name="l02904"></a>02904 
<a name="l02905"></a>02905   <a class="code" href="cleanups_8c.html#a8b313a4f1c613973ea444e5fa54976f8">do_cleanups</a> (old_chain);
<a name="l02906"></a>02906 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Fri Oct 11 2013 14:12:20 for GDB (API) by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
